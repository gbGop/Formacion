<?php
function QR_Dashboard($PRINCIPAL, $id_imparticion)
{
    echo "<br>QR_Dashboard $id_imparticion";
    $SesRelatores=QR_IdInscripcion_Sesiones_Relatores($id_imparticion);
    //echo "<pre>";        print_r($SesRelatores);    echo "</pre>";


    $Preg_Respuestas=EncuestaCheckRespuestasEncSatQRFull($id_imparticion);
    //echo "<pre>";        print_r($Preg_Respuestas);    echo "</pre>";
    $ultima_dimension="";
    foreach ($Preg_Respuestas as $P){
        $id_encuesta    =$P->id_encuesta;
        $id_pregunta    =$P->id_pregunta;
        $respuesta      =$P->respuesta;
        $dimension      =$P->dimension;
        $pregunta       =$P->pregunta;

        if($dimension<>$ultima_dimension){
            $row_encuestas_notas_2023.="<div class='col-lg-12'>".utf8_encode($dimension)."</div>";
        }
        //echo "<br>$id_pregunta<br>".$P->tipo_pregunta."<br>";
        if($P->tipo_pregunta=="NIV1_7"){
            //echo "<br>A NIV1_7<br>";
                $suma_respuestas=0;
                $cuenta_respuestas=0;
                //recorro respuestas
                $R=EncuestaCheckRespuestasDetailEncSatQRFull($id_encuesta, $id_pregunta, $id_imparticion);
                foreach ($R as $resp){
                    $cuenta_respuestas++;
                    //echo "<br>respuesta ".$resp->respuesta;
                    $suma_respuestas=$resp->respuesta+$suma_respuestas;
                }
                if($cuenta_respuestas>0){
                    $promedio_respuestas=round($suma_respuestas/$cuenta_respuestas,1);
                } else {
                    $promedio_respuestas="-";
                }
        }
        elseif($P->tipo_pregunta=="PREGUNTAS_RELATORES"){
                //recorrer relatores
        }
        elseif($P->tipo_pregunta=="LIKE_NO_LIKE"){
                //recorro SI
                //recorro NO
            //echo "<br>B LIKE_NO_LIKE<br>";
                $suma_respuestas=0;
                $cuenta_respuestas=0;
                $cuenta_si=0;
                $cuenta_no=0;
                $R=EncuestaCheckRespuestasDetailEncSatQRFull($id_encuesta, $id_pregunta, $id_imparticion);
                foreach ($R as $resp){
                    $cuenta_respuestas++;
                    //echo "<br>respuesta ".$resp->respuesta;
                    if($resp->respuesta=="SI"){
                        $cuenta_si++;
                    } elseif($resp->respuesta=="NO"){
                        $cuenta_no++;
                    }
                    if($cuenta_respuestas>0){
                            $promedio_respuestas_si=round(100*$cuenta_si/$cuenta_respuestas,1);
                            $promedio_respuestas_no=round(100*$cuenta_no/$cuenta_respuestas,1);
                    } else {
                            $promedio_respuestas_si="";
                            $promedio_respuestas_no="";
                    }
                        $promedio_respuestas=" SI $promedio_respuestas_si% NO $promedio_respuestas_no%";
                }
        }
        elseif($P->tipo_pregunta=="TEXTAREA"){
              $suma_respuestas=0;
                $cuenta_respuestas=0;
                $cuenta_si=0;
                $cuenta_no=0;
                $promedio_respuestas="";
        }

            $row_encuestas_notas_2023.="<div class='col-lg-4'>".utf8_encode($pregunta)."</div>
                             <div class='col-lg-4' >".$cuenta_respuestas."</div>
                             <div class='col-lg-4' >".$promedio_respuestas."</div>";

        $ultima_dimension=$dimension;
    }
    $PRINCIPAL = str_replace("{TABLE_PREGUNTAS_CATEGORIA_CANTIDAD_NOTA_PROMEDIO_2023}", ($row_encuestas_notas_2023), $PRINCIPAL);

    return ($PRINCIPAL);

}
function transformDateSp($inputDate) {
    // Create a DateTime object from the input date
    $date = DateTime::createFromFormat('Y-m-d', $inputDate);

    // Format the date in the desired "dd-mm-YYYY" format
    if ($date) {
        return $date->format('d-m-Y');
    } else {
       // return "Invalid date format"; // Handle invalid input
    }
}
function VerificaCodImparticion_2023($id_inscripcion) {
    $siguiente_codigo = $id_inscripcion;
    while (true) {
        $existe_array = BuscaIdImparticionFull_2021($siguiente_codigo);
        if ($existe_array[0]->id > 0) {
            $trae_imparticiones_ultima = IMPARTICIONES_traeImparticionesCreadasUltima_2021($id_empresa);
            $codigo_ultima = $trae_imparticiones_ultima;
            $siguiente_codigo = NuevoCodigoImparticion_2021($codigo_ultima);
        } else {
            break;
        }
    }
    echo "<script>alert('OTA Creada: ".$siguiente_codigo."')</script>";
    return $siguiente_codigo;
}

function Tickets_SubirArchivosTickets($FILES, $extension_doc, $prefijo, $ruta, $numero, $nombre_file)
{
    //echo "<br>Tickets_SubirArchivosTickets extension ".$extension_doc."                prefijo ".$prefijo." ruta ".$ruta." numero ".$numero." nombre_file ".$nombre_file;

    $ruta_con_archivo = $ruta . "/" . $prefijo . "." . $extension_doc;
    copy($FILES["archivo"]['tmp_name'], $ruta_con_archivo);
    $nombre_imagen_video = $prefijo . "." . $extension_doc;
    $arreglo[0]          = $ruta_con_archivo; //Ruta Completa
    $arreglo[1]          = $prefijo . "." . $extension_doc; //Nombre del Archivo
    $arreglo[2]          = $ruta . "/" . $prefijo; //Ruta del Objeto sin el index
    if($extension_doc==""){$arreglo[1]="";}
    return ($arreglo);
}
function ListaDocsPorImparticiones_2021($PRINCIPAL, $id_imparticion, $id_empresa)
{

    print_r($datos_imparticion);
    return ($PRINCIPAL);

}
function ReporteFullSincronico_2023($PRINCIPAL, $id_curso, $id_empresa)
{

    //echo "FormularioCurso2 id_curso $id_curso";
    $datos_curso = DatosCurso_2($id_curso);
    //print_r($datos_curso);
    if ($datos_curso) {
        $id_curso = $datos_curso[0]->id;
    } else {
        $idNuevo = ListasPresenciales_CodigoIdCurso($id_empresa);
        $id_curso = $idNuevo;
    }


    $PRINCIPAL = str_replace("{NOM_CURSO}", utf8_encode($datos_curso[0]->nombre), $PRINCIPAL);
    $PRINCIPAL = str_replace("{NOMBRE_CURSO_SENCE}", utf8_encode($datos_curso[0]->nombre_curso_sence), $PRINCIPAL);
    $PRINCIPAL = str_replace("{COD_CURSO}", $id_curso, $PRINCIPAL);
    $PRINCIPAL = str_replace("{DES_CURSO}", utf8_encode($datos_curso[0]->descripcion), $PRINCIPAL);
    $PRINCIPAL = str_replace("{OBJETIVO_CURSO}", utf8_encode($datos_curso[0]->objetivo_curso), $PRINCIPAL);
    $PRINCIPAL = str_replace("{NUMERO_HORAS}", utf8_encode($datos_curso[0]->numero_horas), $PRINCIPAL);
    $PRINCIPAL = str_replace("{CANTIDAD_MAXIMA_PARTICIPANTES}", utf8_encode($datos_curso[0]->cantidad_maxima_participantes), $PRINCIPAL);
    $PRINCIPAL = str_replace("{TIPO_CURSO}", utf8_encode($datos_curso[0]->tipo), $PRINCIPAL);
    $PRINCIPAL = str_replace("{CHECKED" . $datos_curso[0]->sence . "}", "checked", $PRINCIPAL);
    $PRINCIPAL = str_replace("{CHECKED" . $datos_curso[0]->cbc . "CBC}", "checked", $PRINCIPAL);
    $PRINCIPAL = str_replace("{PREREQUISITO_CURSO}", utf8_encode($datos_curso[0]->prerequisito), $PRINCIPAL);
    $PRINCIPAL = str_replace("{COD_SENCE}", utf8_encode($datos_curso[0]->cod_sence), $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALOR_HORA}", utf8_encode($datos_curso[0]->valor_hora), $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALOR_HORA_SENCE}", utf8_encode($datos_curso[0]->valor_hora_sence), $PRINCIPAL);
    $PRINCIPAL = str_replace("{COD_IDENTIFICADOR}", utf8_encode($datos_curso[0]->numero_identificador), $PRINCIPAL);
    $PRINCIPAL = str_replace("{NUMERO_IDENTIFICADOR}", utf8_encode($datos_curso[0]->numero_identificador), $PRINCIPAL);
    $PRINCIPAL = str_replace("{CONTENIDOS_CURSO}", utf8_encode($datos_curso[0]->contenidos_cursos), $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALUE_COD_SENCE}", utf8_encode($datos_curso[0]->codigosence), $PRINCIPAL);

    if (utf8_encode($datos_curso[0]->imagen)) {
        $PRINCIPAL = str_replace("{BLOQUE_IMAGEN}", file_get_contents("views/capacitacion/curso/bloque_imagen_curso.html"), $PRINCIPAL);
        $PRINCIPAL = str_replace("{URL_IMAGEN}", "" . utf8_encode($datos_curso[0]->imagen), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BLOQUE_IMAGEN}", "", $PRINCIPAL);
    }

    $PRINCIPAL = str_replace("{SELECTED_" . $datos_curso[0]->sence . "}", "selected='selected'", $PRINCIPAL);
    if ($datos_curso) {
        $PRINCIPAL = str_replace("{VALOR_BOTON}", "Editar Curso", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ACTION}", "?sw=edcurso2", $PRINCIPAL);
        $PRINCIPAL = str_replace("{TITULO}", "Formulario Edici&oacute;n de Cursos", $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{VALOR_BOTON}", "Ingresar Curso", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ACTION}", "?sw=adcurso2", $PRINCIPAL);
        $PRINCIPAL = str_replace("{TITULO}", "Formulario Ingreso de Cursos", $PRINCIPAL);
    }
    $PRINCIPAL = str_replace("{NOMBRE_FORMULARIO}", "FormCurso", $PRINCIPAL);
    $PRINCIPAL = str_replace("{OPTIONS_MODALIDAD}", OptionsModalidad($datos_curso[0]->modalidad), $PRINCIPAL);
    $clasificacion = TotalClasificacion($id_empresa);
    foreach ($clasificacion as $cla) {
        if ($cla->id_clasificacion == $datos_curso[0]->clasificacion) {
            $select = "selected='selected'";
        } else {
            $select = "";
        }
        $opcionClasificacion .= '<option value=' . $cla->id_clasificacion . ' ' . $select . ' >' . utf8_encode($cla->clasificacion) . '</option>';
    }
    $otecs = TraeOtec($id_empresa);
    foreach ($otecs as $otec) {
        if ($cla->rut == $datos_curso[0]->rut_otec) {
            $select2 = "selected";
        } else {
            $select2 = "";
        }
        $opcionOtect .= '<option value=' . $otec->rut . ' ' . $select2 . ' >' . utf8_encode($otec->nombre) . ' (' . utf8_encode($otec->rut) . ')</option>';
    }
    $PRINCIPAL = str_replace("{OPTIONS_CLASIFICACION}", $opcionClasificacion, $PRINCIPAL);
    $focos = ListasPresenciales_Obtienefocos($id_empresa);
    $options_focos = "";
    foreach ($focos as $foc) {
        if ($foc->codigo_foco == $datos_curso[0]->id_foco) {
            $options_focos .= "<option value='" . $foc->codigo_foco . "' selected='selected'>" . $foc->descripcion . "</option>";
        } else {
            $options_focos .= "<option value='" . $foc->codigo_foco . "'>" . $foc->descripcion . "</option>";
        }
    }
    $PRINCIPAL = str_replace("{OPTIONS_FOCOS}", utf8_encode($options_focos), $PRINCIPAL);
    //$programas_bbdd=IMPARTCION_ObtieneProgramasBBDD($id_empresa);
    $programas_bbdd = ListaProgramasDadoFocoDeTabla_2022_data_sinanidacion($id_empresa);

    $options_programas_bbdd = "";
    foreach ($programas_bbdd as $prog_bbdd) {
        if ($prog_bbdd->id_programa == $datos_curso[0]->id_empresa_programa) {
            $options_programas_bbdd .= "<option value='" . $prog_bbdd->id_programa . "' selected='selected'>" . $prog_bbdd->nombre_programa . "</option>";
        } else {
            $options_programas_bbdd .= "<option value='" . $prog_bbdd->id_programa . "'>" . $prog_bbdd->nombre_programa . "</option>";
        }
    }
    $PRINCIPAL = str_replace("{OPTIONS_PROGRAMAS_BBDD_2022_sinanidacion}", utf8_encode($options_programas_bbdd), $PRINCIPAL);
    $PRINCIPAL = str_replace("{OPTIONS_RUT_OTEC}", $opcionOtect, $PRINCIPAL);
    $PRINCIPAL = str_replace("{ID_CURSO_ENCODEADO}", (Encodear3($datos_curso[0]->id)), $PRINCIPAL);
    $PRINCIPAL = str_replace("{OPTIONS_TIPO_CURSO}", Lista_OptionsGenericoNombreDadoValores("tbl_curso_tipo", $datos_curso[0]->tipo, "nombre", "id"), $PRINCIPAL);
    $PRINCIPAL = str_replace("{SELSENCE" . trim($datos_curso[0]->sence) . "}", "selected='selected'", $PRINCIPAL);
    $PRINCIPAL = str_replace("{SELCBC" . trim($datos_curso[0]->cbc) . "}", "selected='selected'", $PRINCIPAL);
    if ($datos_curso[0]->sence == "si") {
        $PRINCIPAL = str_replace("{STYLE_DISPLAY_COD_SENCE}", '', $PRINCIPAL);
        $PRINCIPAL = str_replace("{STYLE_DISPLAY_NUM_IDEN}", 'style="display:none;"', $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{STYLE_DISPLAY_COD_SENCE}", 'style="display:none;"', $PRINCIPAL);
        $PRINCIPAL = str_replace("{STYLE_DISPLAY_NUM_IDEN}", '', $PRINCIPAL);
    }
    return ($PRINCIPAL);
}


function  CopiaParticipantes_InscripcionPotencial_($id_inscripcion_malla)
{
    $activa=0;
    $Id_inscripciones=Id_cursos_id_Inscripcion_por_id_inscripcion_idMalla_2022($id_inscripcion_malla);
    foreach ( $Id_inscripciones as $u){
        $u->nombre_imparticion=utf8_decode($u->nombre_imparticion);
        //echo "<br>--> ";print_r($u);
            $Usu=DescargaRut_IdMalla_IdInscripcion2022($id_inscripcion_malla);
            BorraUsuariosParaVolveraCrearlos($u->id_inscripcion);
            foreach ($Usu as $us){
                $check1=Verifica_Aprobacion_2023($u->id_curso, $us->rut);
                //echo "<br>check1 $check1";
                $check2=Verifica_Ota_Activa_2023($u->id_curso, $us->rut, $u->id_inscripcion);
                //echo "<br>check2 $check2";
                $check3=Verifica_Ota_Futura_2023($u->id_curso, $us->rut, $u->id_inscripcion);
                //echo "<br>check3 $check3";
                $check4=Verifica_Otra_malla_Futura_2023($us->rut,$id_inscripcion_malla);

                if($check1>0 or $check2>0 or $check3>0){
                    echo "<script>alert('El rut ' + '" . $us->rut . "' + ' en el curso ' + '" . $u->id_curso . "' + ' y OTA ' + '" . $u->id_inscripcion . "' + ' ya está aprobado o bien tiene una inscripción activa');</script>";
                } else {

                    //cvaso alerta 4.
                    if($check4[0]->id>0){
                        //echo "alerta 4 rut ".$us->rut." malla antigua ".$check4[0]->id_malla_inscrita." id malla ".$check4[0]->id_malla_inscribir." curso ".$u->id_curso;
                        echo "<script>alert('El rut ' + '" . $us->rut . "' + ' se modificara su malla a  ' + '" . $check4[0]->id_malla_inscribir . "' + '');</script>";
                        Update_lms_Malla_2023_full($us->rut,$check4[0]->id_malla_inscribir, $check4[0]->id_malla_inscrita, $u->id_curso);
                        //exit();
                    }
                    Inserta_rel_lms_rut_id_curso_id_inscripcion_2022($us->rut, $u->id_curso, $u->id_inscripcion, $u->nombre_imparticion, $u->fecha_inicio, $u->fecha_termino, $_SESSION["id_empresa"], $u->opcional, $activa, $u->ejecutivo);
                }
            }
    }
}




function NuevoCodigoImparticion_2021($codigo_anterior)
{
    //echo "<br>codigo_anterior $codigo_anterior";
    $cuentaCaracteres = strlen($codigo_anterior);
    //echo "<br>-> cuentaCaracteres $cuentaCaracteres";
    if ($cuentaCaracteres == "10") {
    } else {
        $codigo_anterior = 0;
    }
    $Y = date("Y");
    $M = date("m");
    $Ultimos4Digitos = substr($codigo_anterior, -4);
    $ultimos4DigitosMasUno = round($Ultimos4Digitos) + 1;
    $cuentaCaracteres4Digitos = strlen($ultimos4DigitosMasUno);
    if ($cuentaCaracteres4Digitos == 4) {
        $cuatrodigitosmasuno = $ultimos4DigitosMasUno;
    } elseif ($cuentaCaracteres4Digitos == 3) {
        $cuatrodigitosmasuno = "0" . $ultimos4DigitosMasUno;
    } elseif ($cuentaCaracteres4Digitos == 2) {
        $cuatrodigitosmasuno = "00" . $ultimos4DigitosMasUno;
    } elseif ($cuentaCaracteres4Digitos == 1) {
        $cuatrodigitosmasuno = "000" . $ultimos4DigitosMasUno;
    }
    //echo "<br>-> YYYY $Y";
    //echo "<br>-> MM $M";
    //echo "<br>-> Ultimos4Digitos $Ultimos4Digitos";
    //echo "<br>-> ultimos4DigitosMasUno $ultimos4DigitosMasUno";
    $nuevo_codigo = $Y . $M . $cuatrodigitosmasuno;
    //yyymm0001
    //echo "<br>-> <h4>nuevo_codigo $nuevo_codigo</h4>";
    //exit();
    return $nuevo_codigo;
}


function ListaImparticiones($PRINCIPAL, $id_curso, $Empresa, $excel, $id_modalidad)
{
    $Imparticiones = TraeImparticionEmpresa($id_curso, $Empresa, $id_modalidad);

    //print_r($Imparticiones);
    $perfil = AdminPerfil2021($_SESSION["admin_"]);
    //print_r($_SESSION);  				//echo "perfil $perfil";
    $rows_ = "";
    $rows1_ = "";
    foreach ($Imparticiones as $unico) {

        $muestra_alerta_row = "";
        $display_none_participantes = "";

        if ($perfil == "relator") {
            $vista_id = AdminPerfilVistaImparticion($_SESSION["admin_"], $unico->codigo_inscripcion);
            //echo "<br>dista id<br>";//print_r($vista_id);
            if ($vista_id > 0) {
                //echo "->muestra";
            } else {
                continue;
            }
        }
        if ($excel == "1") {
            $rows_ = file_get_contents("views/capacitacion/imparticion/row_listado_excel.html");
        } else {
            if ($unico->modalidad == "1") {

                $PRINCIPAL = str_replace("{DISPLAYNONE_MODALIDAD1}", "display:none !important;", $PRINCIPAL);

                $rows_ = file_get_contents("views/capacitacion/imparticion/row_listado_1.html");
                $rows_ = str_replace("{FECHAS_SESIONES}", $unico->fecha_inicio . " - " . $unico->fecha_termino, $rows_);


            } else {

                if ($unico->modalidad == "2") {
                    //echo "<br>->Modalidad 2";
                    $alerta_horas = DatosImparticiones_SumaHoras($id_curso, $unico->codigo_inscripcion, $unico->tipo_audiencia, $unico->fecha_inicio, $unico->fecha_termino, $unico->hora_inicio, $unico->hora_termino, $unico->modalidad, $unico->numero_horas);
                    //echo " -> alerta $alerta_horas";

                    $alerta_horas_strpos = strpos($alerta_horas, "alert alert-danger");
                    //echo "<br>";
                    //print_r($alerta_horas_strpos);

                    if ($alerta_horas_strpos <> "") {
                        //echo "MUESTRA ALERTA y oculta Participantes";
                        $muestra_alerta_row = $alerta_horas;
                        $display_none_participantes = "display:none!important";
                    }

                }


                $rows_ = file_get_contents("views/capacitacion/imparticion/row_listado.html");
            }

        }

        $rows_ = str_replace("{DISPLAY_NONE_PARTICIPANTES}", $display_none_participantes, $rows_);
        $rows_ = str_replace("{ALERTA_MAL_CONFIGURADO}", $muestra_alerta_row, $rows_);


        $rows_ = str_replace("{CODIGOINCRIPCION}", $unico->codigo_inscripcion, $rows_);
        $rows_ = str_replace("{NOMBRE_INSCRIPCION}", $unico->nombre_imparticion, $rows_);
        $rows_ = str_replace("{ID_INSCRIPCION_ENCODEADO}", Encodear3($unico->codigo_inscripcion), $rows_);
        //$arreglo_objetos[0]->codigo_inscripcion=$unico->codigo_inscripcion;
        $arreglo_post["id_empresa"] = $Empresa;
        $arreglo_post["codigo_imparticion_escrito"] = $unico->codigo_inscripcion;
        $arreglo_post["imparticion"] = $unico->codigo_inscripcion;
        //$arreglo_objetos=Lms_Busca_Objetos_Enc_sat_Imparticion($arreglo_post, $Empresa);
        //$rows_=Lms_reporte_MuestraInformeDimEncNota($rows_, $Empresa, $arreglo_objetos, "", "", $excel, $arreglo_post);
        $arreglo_post_objeto = $arreglo_objetos;
        $array_para_enviar_via_url_objetos = serialize($arreglo_post_objeto);
        $array_para_enviar_via_url_objetos = urlencode($array_para_enviar_via_url_objetos);
        //$rows_ = str_replace("{ARREGLO_OBJETO}",$array_para_enviar_via_url_objetos ,$rows_);
        $array_para_enviar_via_url_post = serialize($arreglo_post);
        $array_para_enviar_via_url_post = urlencode($array_para_enviar_via_url_post);
        $rows_ = str_replace("{ARREGLO_POST}", $array_para_enviar_via_url_post, $rows_);
        if ($unico->modalidad == "1") {
            $inscritos = "<strong>" . $unico->inscritos . "</strong> Inscritos";
        } else {
            $inscritos = "<br><strong>" . $unico->inscritos . "</strong> Inscritos";
        }

        $inscritos_numero = $unico->inscritos;
        $cupos = "<br><strong>" . $unico->cupos . "</strong> Cupos";
        $cupos_numero = $unico->cupos;
        $chequeados = "<strong>" . $unico->chequeados . "</strong> Asistentes";
        $chequeados_numero = $unico->chequeados;
        if ($unico->preinscritos > 0) {
            $preinscritos = "<br><strong>" . $unico->preinscritos . "</strong> Preinscritos";
            $preinscritos_numero = $unico->preinscritos;
        } else {
            $preinscritos = "<br><strong>0</strong> Preinscritos";
            $preinscritos_numero = 0;
        }
        if ($unico->postulantes > 0) {
            $postulantes = "<br><strong>" . $unico->postulantes . "</strong> Postulantes";
            $postulantes_numero = $unico->postulantes;
        } else {
            $postulantes = "<br><strong>0</strong> Postulantes";
            $postulantes_numero = 0;
        }
        if ($unico->asistentes > 0) {
            $asistentes = "<strong>" . $unico->asistentes . "</strong> Asistentes";
            $asistentes_numero = $unico->asistentes;
        } else {
            $asistentes = "<strong>0</strong> Asistentes";
            $asistentes_numero = 0;
        }
        if ($unico->modalidad == 1) {
            $modalidad_curso = "ELEARNING";
        } else {
            $modalidad_curso = "PRESENCIAL";
        }
        $rows_ = str_replace("{MODALIDAD_CURSO}", $modalidad_curso, $rows_);

        //echo "<br>codigo_inscripcion $unico->codigo_inscripcion,";
        $Prog_Foco = data_rel_id_inscripcion_curso_groupby_id_imparticion_data($unico->codigo_inscripcion);
        //print_r($Prog_Foco);


        $rows_ = str_replace("{FOCO}", $Prog_Foco[0]->foco, $rows_);
        $rows_ = str_replace("{PROGRAMA}", $Prog_Foco[0]->programa, $rows_);
        $rows_ = str_replace("{NUM_PARTICIPANTES}", $unico->num_participantes, $rows_);
        $rows_ = str_replace("{INSCRITOS}", $inscritos, $rows_);
        $rows_ = str_replace("{INSCRITOS_NUMERO}", $inscritos_numero, $rows_);
        $rows_ = str_replace("{ASISTENTES}", $asistentes, $rows_);
        $rows_ = str_replace("{ASISTENTES_NUMERO}", $asistentes_numero, $rows_);
        $rows_ = str_replace("{PREINSCRITOS}", $preinscritos, $rows_);
        $rows_ = str_replace("{PREINSCRITOS_NUMERO}", $preinscritos_numero, $rows_);
        $rows_ = str_replace("{POSTULANTES}", $postulantes, $rows_);
        $rows_ = str_replace("{POSTULANTES_NUMERO}", $postulantes_numero, $rows_);
        $rows_ = str_replace("{CUPOS}", $cupos, $rows_);
        $rows_ = str_replace("{CUPOS_NUMERO}", $cupos_numero, $rows_);
        $rows_ = str_replace("{CHEQUEADOS}", $chequeados, $rows_);
        $rows_ = str_replace("{CHEQUEADOS_NUMERO}", $chequeados_numero, $rows_);
        if ($unico->modalidad == 1) {
            $tipo = "Elearning";
        }
        if ($unico->modalidad == 2) {
            $tipo = "Presencial";
        }
        $rows_ = str_replace("{TIPO}", $tipo, $rows_);
        $rows_ = str_replace("{DESCARGA_PARTICIPANTES}", "<a href='?sw=descargarInscritosPorImpart_2021&ci=" . encodear3($unico->codigo_inscripcion) . "' title='Descargar Participantes a Excel'><i class='fas fa-download'></i></a>", $rows_);
        $rows_ = str_replace("{DESCARGA_ASISTENTES}", "<a href='?sw=descargarInscritosPorImpart_2021&ci=" . encodear3($unico->codigo_inscripcion) . "&asistentes=1' title='Descargar Participantes a Excel'><i class='fas fa-download'></i></a>", $rows_);
        $rows_ = str_replace("{CLASIFICACION}", $unico->clasificacion, $rows_);
        $rows_ = str_replace("{CURSO}", $unico->nombre, $rows_);
        $rows_ = str_replace("{ID_CURSO}", $unico->id_curso, $rows_);


        $rows_ = str_replace("{i}", Encodear3($unico->id_curso), $rows_);
        if ($id_modalidad == "3") {
            $cupos = "Cupos: " . $unico->cupos;
            $rows_ = str_replace("{DIRECCION}", ($cupos), $rows_);
        }
        $rows_ = str_replace("{DIRECCION}", ($unico->direccion), $rows_);
        $rows_ = str_replace("{CIUDAD}", ($unico->nombre_proveedor), $rows_);
        $rows_ = str_replace("{EJECUTIVO}", $unico->nombre_ejecutivo . "", $rows_);
        $rows_ = str_replace("{CUPOS}", ($unico->cupos), $rows_);
        //echo $unico->numero_horas;echo "<br>";
        $segundos = TransformaHoraASegundos($unico->numero_horas);
        //echo $segundos;echo " segundos del curso <br>";
        //$rows_ = str_replace("{NUMSESIONES}",($unico->sesiones),$rows_);
        $lista_sesiones_reales = "";
        $lista_sesiones_reales_XLS = "";
        $lista_objetos_reales = "";

        $rows_ = str_replace("{DETALLE_OBJETOS}", ($lista_objetos_reales), $rows_);
        $Incripcion2 = Total_Inscripciones($Empresa, $unico->codigo_inscripcion);
        $total_html2 = "";
        $rows1_ = "";
        $cuenta = "";
        $relator = "";
        $nombre_relator = "";
        $lista_sesiones = "";
        $Sesiones = DatosImparticiones_Sesiones_data_2021($unico->codigo_inscripcion);
        foreach ($Sesiones as $UniSes) {
            $lista_sesiones .= "" . formatearFechaSmall($UniSes->fecha) . " " . $UniSes->hora_desde . " - " . $UniSes->hora_hasta . "<br>";
        }

        if ($unico->tipo_audiencia == "fecha_inicio_termino") {

            if ($unico->id_audiencia <> "") {
                $relator = TraeRelatores2021porId($unico->id_audiencia);
                $nombre_relator = $relator[0]->nombre . " (" . $relator[0]->tipo . ")";
            }
            $lista_sesiones .= "" . formatearFechaSmall($unico->fecha_inicio) . " " . $unico->hora_inicio . " <br>" . formatearFechaSmall($unico->fecha_termino) . " " . $unico->hora_termino . "<br>$nombre_relator
							";
        }
        //echo "<br>-->".$unico->tipo_audiencia;
        $rows_ = str_replace("{FECHAS_SESIONES}", $lista_sesiones, $rows_);
        $rows_ = str_replace("{TABLA}", $cab . $total_html2 . "</tbody></table>", $rows_);
        $fecha_actual = date("Y-m-d");
        $rows_ = str_replace("{ESTADO}", $estado, $rows_);
        $rows_ = str_replace("{ESTADONOMBRE}", $estadonom, $rows_);
        $EstadoImparticion2022 = EstadoImparticion2022($unico->fecha_inicio, $unico->fecha_termino);
        $rows_ = str_replace("{ESTADO_EJECUCION}", $EstadoImparticion2022[0], $rows_);

        $total_html .= $rows_;
        if ($excel == 1) {
            $row_excel .= $unico->id_curso . ";";
            $row_excel .= $unico->nombre . ";";
            $row_excel .= $modalidad_curso . ";";
            $row_excel .= $unico->codigo_inscripcion . ";";
            $row_excel .= $EstadoImparticion2022[1] . ";";
            $row_excel .= $unico->fecha_inicio . ";";
            $row_excel .= $unico->fecha_termino . ";";
            $row_excel .= $unico->nombre_ejecutivo . ";";

            $row_excel .= $unico->nombre_proveedor . ";";
            $row_excel .= $unico->direccion . ";";

            $row_excel .= $asistentes_numero . ";";
            $row_excel .= $inscritos_numero . "";
            $row_excel .= "\r\n";
            //$EstadoImparticion2022[1];
            echo $row_excel;
        }
    }

    $PRINCIPAL = str_replace("{REGISTROS" . $registros_pagina . "}", "selected", $PRINCIPAL);
    $PRINCIPAL = str_replace("{PAGINACION}", $paginacion, $PRINCIPAL);
    $PRINCIPAL = str_replace("{RANGO_FECHAS}", "", $PRINCIPAL);
    $PRINCIPAL = str_replace("{BCODIGO}", $codigo, $PRINCIPAL);
    $PRINCIPAL = str_replace("{BFECHA1}", $fecha1, $PRINCIPAL);
    $PRINCIPAL = str_replace("{BFECHA2}", $fecha2, $PRINCIPAL);
    $PRINCIPAL = str_replace("{RESUMEN}", "Hay un total de " . $registros_total . " Inscripciones", $PRINCIPAL);
    $PRINCIPAL = str_replace("{ID_EMPRESA}", $Empresa, $PRINCIPAL);
    $PRINCIPAL = str_replace("{ROW_LISTADO}", utf8_encode($total_html), $PRINCIPAL);
    return ($PRINCIPAL);
}

function ListaImparticiones_malla($PRINCIPAL, $id_malla, $Empresa, $excel, $id_modalidad)
{
    $Imparticiones = BuscaIdImparticiondadoMalla($id_malla, $id_empresa);
    //echo "<pre>";print_r($Imparticiones);echo "</pre>";
    $perfil = AdminPerfil2021($_SESSION["admin_"]);
    //print_r($_SESSION);  				//echo "perfil $perfil";
    $rows_ = "";
    $rows1_ = "";
    foreach ($Imparticiones as $unico) {
        $muestra_alerta_row = "";
        $display_none_participantes = "";
        if ($perfil == "relator") {
            $vista_id = AdminPerfilVistaImparticion($_SESSION["admin_"], $unico->codigo_inscripcion);
            //echo "<br>dista id<br>";//print_r($vista_id);
            if ($vista_id > 0) {
                //echo "->muestra";
            } else {
                continue;
            }
        }
        if ($excel == "1") {
            $rows_ = file_get_contents("views/capacitacion/imparticion/row_listado_excel.html");
        } else {
                $PRINCIPAL = str_replace("{DISPLAYNONE_MODALIDAD1}", "display:none !important;", $PRINCIPAL);
                $rows_ = file_get_contents("views/capacitacion/imparticion/row_listado_1_mallas.html");
                $rows_ = str_replace("{FECHAS_SESIONES}", $unico->fecha_inicio . " - " . $unico->fecha_termino, $rows_);
        }
        $rows_ = str_replace("{DISPLAY_NONE_PARTICIPANTES}", $display_none_participantes, $rows_);
        $rows_ = str_replace("{ALERTA_MAL_CONFIGURADO}", $muestra_alerta_row, $rows_);
        $rows_ = str_replace("{CODIGOINCRIPCION}", $unico->codigo_inscripcion, $rows_);
        $rows_ = str_replace("{ID_INSCRIPCION_ENCODEADO}", Encodear3($unico->codigo_inscripcion), $rows_);
        $rows_ = str_replace("{NOMBRE_IMPARTICION_MALLA}", ($unico->nombre_imparticion), $rows_);
        $rows_ = str_replace("{ID_IMPARTICION_MALLA}", utf8_encode($unico->id_malla), $rows_);
        $rows_ = str_replace("{ID_IMPARTICION_MALLA_ENC}", Encodear3($unico->id_malla), $rows_);
        $rows_ = str_replace("{ID_IMPARTICION_ENC}", Encodear3($unico->id_inscripcion), $rows_);
        $rows_ = str_replace("{ID_PROGRAMA_ENCODEAR}", Encodear3(IdProgramaIdMalla_2022($unico->id_malla)), $rows_);

        $id_programa=IdProgramaIdMalla_2022($unico->id_malla);
        $malla_array=DatosMalla_2022($unico->id_malla);
        $programa_adday=DatosPrograma_2022($id_programa);
         //   echo "<br>-> id_programa $id_programa";
        $PRINCIPAL = str_replace("{NOMBRE_MALLA}",      utf8_encode($malla_array[0]->nombre), $PRINCIPAL);
        $PRINCIPAL = str_replace("{NOMBRE_PROGRAMA}",   utf8_encode($programa_adday[0]->nombre_programa), $PRINCIPAL);

        //echo "<br>-> ejecutivo ".$unico->ejecutivo;
        $ejecutivo_relator=TraeDatosEjecutivos($unico->ejecutivo);
        $rows_ = str_replace("{EJECUTIVO_MALLA}", utf8_encode( $ejecutivo_relator[0]->nombre), $rows_);
        $arreglo_post["id_empresa"] = $Empresa;
        $arreglo_post["codigo_imparticion_escrito"] = $unico->codigo_inscripcion;
        $arreglo_post["imparticion"] = $unico->codigo_inscripcion;
        $arreglo_post_objeto = $arreglo_objetos;
        $array_para_enviar_via_url_objetos = serialize($arreglo_post_objeto);
        $array_para_enviar_via_url_objetos = urlencode($array_para_enviar_via_url_objetos);
        $array_para_enviar_via_url_post = serialize($arreglo_post);
        $array_para_enviar_via_url_post = urlencode($array_para_enviar_via_url_post);
        $rows_ = str_replace("{ARREGLO_POST}", $array_para_enviar_via_url_post, $rows_);
        if ($unico->modalidad == "1") {
            $inscritos = "<strong>" . $unico->participantes . "</strong> Inscritos";
        } else {
            $inscritos = "<strong>" . $unico->participantes . "</strong> Inscritos";
        }

        $inscritos_numero = $unico->inscritos;


        $cupos = "<br><strong>" . $unico->cupos . "</strong> Cupos";
        $cupos_numero = $unico->cupos;
        $chequeados = "<strong>" . $unico->chequeados . "</strong> Asistentes";
        $chequeados_numero = $unico->chequeados;
        if ($unico->preinscritos > 0) {
            $preinscritos = "<br><strong>" . $unico->preinscritos . "</strong> Preinscritos";
            $preinscritos_numero = $unico->preinscritos;
        } else {
            $preinscritos = "<br><strong>0</strong> Preinscritos";
            $preinscritos_numero = 0;
        }
        if ($unico->postulantes > 0) {
            $postulantes = "<br><strong>" . $unico->postulantes . "</strong> Postulantes";
            $postulantes_numero = $unico->postulantes;
        } else {
            $postulantes = "<br><strong>0</strong> Postulantes";
            $postulantes_numero = 0;
        }
        if ($unico->asistentes > 0) {
            $asistentes = "<strong>" . $unico->asistentes . "</strong> Asistentes";
            $asistentes_numero = $unico->asistentes;
        } else {
            $asistentes = "<strong>0</strong> Asistentes";
            $asistentes_numero = 0;
        }
        if ($unico->modalidad == 1) {
            $modalidad_curso = "ELEARNING";
        } else {
            $modalidad_curso = "PRESENCIAL";
        }
        $rows_ = str_replace("{MODALIDAD_CURSO}", $modalidad_curso, $rows_);
        //echo "<br>codigo_inscripcion $unico->codigo_inscripcion,";
        $Prog_Foco = data_rel_id_inscripcion_curso_groupby_id_imparticion_data($unico->codigo_inscripcion);
        //print_r($Prog_Foco);
        $rows_ = str_replace("{FOCO}", $Prog_Foco[0]->foco, $rows_);
        $rows_ = str_replace("{PROGRAMA}", $Prog_Foco[0]->programa, $rows_);
        $rows_ = str_replace("{NUM_PARTICIPANTES}", $unico->num_participantes, $rows_);
        $rows_ = str_replace("{INSCRITOS}", $inscritos, $rows_);
        $rows_ = str_replace("{INSCRITOS_NUMERO}", $inscritos_numero, $rows_);
        $rows_ = str_replace("{ASISTENTES}", $asistentes, $rows_);
        $rows_ = str_replace("{ASISTENTES_NUMERO}", $asistentes_numero, $rows_);
        $rows_ = str_replace("{PREINSCRITOS}", $preinscritos, $rows_);
        $rows_ = str_replace("{PREINSCRITOS_NUMERO}", $preinscritos_numero, $rows_);
        $rows_ = str_replace("{POSTULANTES}", $postulantes, $rows_);
        $rows_ = str_replace("{POSTULANTES_NUMERO}", $postulantes_numero, $rows_);
        $rows_ = str_replace("{CUPOS}", $cupos, $rows_);
        $rows_ = str_replace("{CUPOS_NUMERO}", $cupos_numero, $rows_);
        $rows_ = str_replace("{CHEQUEADOS}", $chequeados, $rows_);
        $rows_ = str_replace("{CHEQUEADOS_NUMERO}", $chequeados_numero, $rows_);
        if ($unico->modalidad == 1) {
            $tipo = "Elearning";
        }
        if ($unico->modalidad == 2) {
            $tipo = "Presencial";
        }
        $rows_ = str_replace("{TIPO}", $tipo, $rows_);
        $rows_ = str_replace("{DESCARGA_PARTICIPANTES}", "<a href='?sw=descargarInscritosPorImpart_2021&ci=" . encodear3($unico->codigo_inscripcion) . "' title='Descargar Participantes a Excel'><i class='fas fa-download'></i></a>", $rows_);
        $rows_ = str_replace("{DESCARGA_ASISTENTES}", "<a href='?sw=descargarInscritosPorImpart_2021&ci=" . encodear3($unico->codigo_inscripcion) . "&asistentes=1' title='Descargar Participantes a Excel'><i class='fas fa-download'></i></a>", $rows_);
        $rows_ = str_replace("{CLASIFICACION}", $unico->clasificacion, $rows_);
        $rows_ = str_replace("{CURSO}", $unico->nombre, $rows_);
        $rows_ = str_replace("{ID_CURSO}", $unico->id_curso, $rows_);


        $rows_ = str_replace("{i}", Encodear3($unico->id_curso), $rows_);
        if ($id_modalidad == "3") {
            $cupos = "Cupos: " . $unico->cupos;
            $rows_ = str_replace("{DIRECCION}", ($cupos), $rows_);
        }
        $rows_ = str_replace("{DIRECCION}", ($unico->direccion), $rows_);
        $rows_ = str_replace("{CIUDAD}", ($unico->nombre_proveedor), $rows_);
        $rows_ = str_replace("{EJECUTIVO}", $unico->nombre_ejecutivo . "", $rows_);
        $rows_ = str_replace("{CUPOS}", ($unico->cupos), $rows_);
        //echo $unico->numero_horas;echo "<br>";
        $segundos = TransformaHoraASegundos($unico->numero_horas);
        //echo $segundos;echo " segundos del curso <br>";
        //$rows_ = str_replace("{NUMSESIONES}",($unico->sesiones),$rows_);
        $lista_sesiones_reales = "";
        $lista_sesiones_reales_XLS = "";
        $lista_objetos_reales = "";

        $rows_ = str_replace("{DETALLE_OBJETOS}", ($lista_objetos_reales), $rows_);
        $Incripcion2 = Total_Inscripciones($Empresa, $unico->codigo_inscripcion);
        $total_html2 = "";
        $rows1_ = "";
        $cuenta = "";
        $relator = "";
        $nombre_relator = "";
        $lista_sesiones = "";
        $Sesiones = DatosImparticiones_Sesiones_data_2021($unico->codigo_inscripcion);
        foreach ($Sesiones as $UniSes) {
            $lista_sesiones .= "" . formatearFechaSmall($UniSes->fecha) . " " . $UniSes->hora_desde . " - " . $UniSes->hora_hasta . "<br>";
        }

        if ($unico->tipo_audiencia == "fecha_inicio_termino") {

            if ($unico->id_audiencia <> "") {
                $relator = TraeRelatores2021porId($unico->id_audiencia);
                $nombre_relator = $relator[0]->nombre . " (" . $relator[0]->tipo . ")";
            }
            $lista_sesiones .= "" . formatearFechaSmall($unico->fecha_inicio) . " " . $unico->hora_inicio . " <br>" . formatearFechaSmall($unico->fecha_termino) . " " . $unico->hora_termino . "<br>$nombre_relator
							";
        }
        //echo "<br>-->".$unico->tipo_audiencia;
        $rows_ = str_replace("{FECHAS_SESIONES}", $lista_sesiones, $rows_);
        $rows_ = str_replace("{TABLA}", $cab . $total_html2 . "</tbody></table>", $rows_);
        $fecha_actual = date("Y-m-d");
        $rows_ = str_replace("{ESTADO}", $estado, $rows_);
        $rows_ = str_replace("{ESTADONOMBRE}", $estadonom, $rows_);
        $EstadoImparticion2022 = EstadoImparticion2022($unico->fecha_inicio, $unico->fecha_termino);
        $rows_ = str_replace("{ESTADO_EJECUCION}", $EstadoImparticion2022[0], $rows_);

        $total_html .= $rows_;
        if ($excel == 1) {
            $row_excel .= $unico->id_curso . ";";
            $row_excel .= $unico->nombre . ";";
            $row_excel .= $modalidad_curso . ";";
            $row_excel .= $unico->codigo_inscripcion . ";";
            $row_excel .= $EstadoImparticion2022[1] . ";";
            $row_excel .= $unico->fecha_inicio . ";";
            $row_excel .= $unico->fecha_termino . ";";
            $row_excel .= $unico->nombre_ejecutivo . ";";

            $row_excel .= $unico->nombre_proveedor . ";";
            $row_excel .= $unico->direccion . ";";

            $row_excel .= $asistentes_numero . ";";
            $row_excel .= $inscritos_numero . "";
            $row_excel .= "\r\n";
            //$EstadoImparticion2022[1];
            echo $row_excel;
        }
    }

    $PRINCIPAL = str_replace("{REGISTROS" . $registros_pagina . "}", "selected", $PRINCIPAL);
    $PRINCIPAL = str_replace("{PAGINACION}", $paginacion, $PRINCIPAL);
    $PRINCIPAL = str_replace("{RANGO_FECHAS}", "", $PRINCIPAL);
    $PRINCIPAL = str_replace("{BCODIGO}", $codigo, $PRINCIPAL);
    $PRINCIPAL = str_replace("{BFECHA1}", $fecha1, $PRINCIPAL);
    $PRINCIPAL = str_replace("{BFECHA2}", $fecha2, $PRINCIPAL);
    $PRINCIPAL = str_replace("{RESUMEN}", "Hay un total de " . $registros_total . " Inscripciones", $PRINCIPAL);
    $PRINCIPAL = str_replace("{ID_EMPRESA}", $Empresa, $PRINCIPAL);
    $PRINCIPAL = str_replace("{ROW_LISTADO}", utf8_encode($total_html), $PRINCIPAL);
    return ($PRINCIPAL);
}

function EstadoImparticion2022($fecha_inicio, $fecha_termino)
{

    $hoy = date("Y-m-d");
    if ($hoy > $fecha_termino) {
        $icono_estado = "
		Finalizada 
			<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-calendar-check' viewBox='0 0 16 16'>
			  <path d='M10.854 7.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7.5 9.793l2.646-2.647a.5.5 0 0 1 .708 0z'/>
			  <path d='M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z'/>
			</svg>		
		";
        $texto_estado = "Finalizada";
    } elseif ($hoy <= $fecha_termino and $hoy >= $fecha_inicio) {
        $icono_estado = "
		Ejecutando
			<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-person-workspace' viewBox='0 0 16 16'>
			  <path d='M4 16s-1 0-1-1 1-4 5-4 5 3 5 4-1 1-1 1H4Zm4-5.95a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5Z'/>
			  <path d='M2 1a2 2 0 0 0-2 2v9.5A1.5 1.5 0 0 0 1.5 14h.653a5.373 5.373 0 0 1 1.066-2H1V3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v9h-2.219c.554.654.89 1.373 1.066 2h.653a1.5 1.5 0 0 0 1.5-1.5V3a2 2 0 0 0-2-2H2Z'/>
			</svg>
		 ";
        $texto_estado = "Ejecutando";
    } else {
        $icono_estado = "
		Programada
			<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-alarm' viewBox='0 0 16 16'>
			  <path d='M8.5 5.5a.5.5 0 0 0-1 0v3.362l-1.429 2.38a.5.5 0 1 0 .858.515l1.5-2.5A.5.5 0 0 0 8.5 9V5.5z'/>
			  <path d='M6.5 0a.5.5 0 0 0 0 1H7v1.07a7.001 7.001 0 0 0-3.273 12.474l-.602.602a.5.5 0 0 0 .707.708l.746-.746A6.97 6.97 0 0 0 8 16a6.97 6.97 0 0 0 3.422-.892l.746.746a.5.5 0 0 0 .707-.708l-.601-.602A7.001 7.001 0 0 0 9 2.07V1h.5a.5.5 0 0 0 0-1h-3zm1.038 3.018a6.093 6.093 0 0 1 .924 0 6 6 0 1 1-.924 0zM0 3.5c0 .753.333 1.429.86 1.887A8.035 8.035 0 0 1 4.387 1.86 2.5 2.5 0 0 0 0 3.5zM13.5 1c-.753 0-1.429.333-1.887.86a8.035 8.035 0 0 1 3.527 3.527A2.5 2.5 0 0 0 13.5 1z'/>
			</svg>		
		 ";
        $texto_estado = "Programada";
    }

    $arreglo[0] = $icono_estado;
    $arreglo[1] = $texto_estado;
    return $arreglo;


}

function FormularioImparticion($PRINCIPAL, $id_empresa, $id_imparticion)
{



    if (!$id_imparticion) {
        //si no hay codigo de imparticion creo uno
        $trae_imparticiones = IMPARTICIONES_traeImparticionesCreadas($id_empresa);
        $trae_imparticiones_ultima = IMPARTICIONES_traeImparticionesCreadasUltima_2021($id_empresa);
        $codigo_ultima = $trae_imparticiones_ultima;
        $siguiente_codigo = NuevoCodigoImparticion_2021($codigo_ultima);


        //traigo la ultima imparticion
        if ($trae_imparticiones) {
            //$codigo_imparticion=$trae_imparticiones[0]->prefijo."_impart_".(count($trae_imparticiones)+1);
            $codigo_imparticion = $trae_imparticiones[0]->prefijo . "_impart_" . $siguiente_codigo;
            $codigo_imparticion = $siguiente_codigo;
        } else {
            $datos_empresa = DatosEmpresa($id_empresa);
            //$codigo_imparticion=$datos_empresa[0]->prefijo."_impart_".(count($trae_imparticiones)+1);
            $codigo_imparticion = $datos_empresa[0]->prefijo . "_impart_" . $siguiente_codigo;
            $codigo_imparticion = $siguiente_codigo;
        }
    } else {
        $codigo_imparticion = $id_imparticion;
    }

    //echo " codigo_imparticion ".$codigo_imparticion." id imparticion ".$id_imparticion;
    //$datos_imparticion=DatosInscripcionImparticiones($id_imparticion, $id_empresa);
    $datos_imparticion = DatosInscripcionImparticionesV2($id_imparticion, $id_empresa);
    // print_r($datos_imparticion);

    $cursos = TraeCursos("-1", $id_empresa, "");
    $option_cursos = "";
    foreach ($cursos as $curso) {
        //if($arreglo_post["curso"]==$curso->id){
        if ($datos_imparticion[0]->id_curso == $curso->id) {
            $option_cursos .= '<option value="' . $curso->id . '" selected>' . $curso->id . ' - ' . $curso->nombre . '</option>';
        } else {
            $option_cursos .= '<option value="' . $curso->id . '">' . $curso->id . ' - ' . $curso->nombre . '</option>';
        }
    }
    $PRINCIPAL = str_replace("{OPCIONES_CURSOS}", utf8_encode($option_cursos), $PRINCIPAL);

    //$ejecutivos=TraeEjecutivosPorEmpresa($id_empresa);
    $ejecutivos = TraeEjecutivos2021($id_empresa);
    $options_ejecutivos = "";
    foreach ($ejecutivos as $ejec) {

        if ($datos_imparticion[0]->ejecutivo == $ejec->rut) {
            $checked = " selected ";
        } else {
            $checked = "  ";
        }
        $options_ejecutivos .= '<option value="' . $ejec->rut . '" ' . $checked . '>' . $ejec->nombre . ' - ' . $ejec->rut . '</option>';
    }
    $PRINCIPAL = str_replace("{OPTIONS_EJECUTIVOS}", utf8_encode($options_ejecutivos), $PRINCIPAL);

    $ejecutivos_interno = TraeEjecutivos2022_tipo($id_empresa, "interno");
    $options_ejecutivos_interno = "";
    foreach ($ejecutivos_interno as $ejec) {

        if ($datos_imparticion[0]->ejecutivo == $ejec->rut) {
            $checked = " selected ";
        } else {
            $checked = "  ";
        }
        $options_ejecutivos_interno .= '<option value="' . $ejec->rut . '" ' . $checked . '>' . $ejec->nombre . ' - ' . $ejec->rut . '</option>';
    }
    $PRINCIPAL = str_replace("{OPTIONS_EJECUTIVOS_INTERNO}", utf8_encode($options_ejecutivos_interno), $PRINCIPAL);


    $ejecutivos_externo = TraeEjecutivos2022_tipo($id_empresa, "externo");
    $options_ejecutivos_externo = "";
    foreach ($ejecutivos_externo as $ejec) {

        if ($datos_imparticion[0]->archivo == $ejec->rut) {
            $checked = " selected ";
        } else {
            $checked = "  ";
        }
        $options_ejecutivos_externo .= '<option value="' . $ejec->rut . '" ' . $checked . '>' . $ejec->nombre . ' - ' . $ejec->rut . '</option>';
    }
    $PRINCIPAL = str_replace("{OPTIONS_EJECUTIVOS_EXTERNO}", utf8_encode($options_ejecutivos_externo), $PRINCIPAL);


    $otecs = TraeOtec2021($id_empresa);
    $options_otec = "";
    foreach ($otecs as $otec) {
        if ($datos_imparticion[0]->ciudad == $otec->rut) {
            $checked = " selected ";
        } else {
            $checked = "  ";
        }
        $options_otec .= '<option value="' . $otec->rut . '" ' . $checked . '>' . $otec->nombre . ' - ' . $otec->rut . '</option>';
    }
    $PRINCIPAL = str_replace("{OPTIONS_OTEC}", utf8_encode($options_otec), $PRINCIPAL);

    $direcciones = TraeDirecciones2021($id_empresa);
    $options_direcciones = "";
    foreach ($direcciones as $direccion) {
        if ($datos_imparticion[0]->direccion == $direccion->tipo . "-" . $direccion->nombre) {
            $checkedDireccion = " selected ";
        } else {
            $checkedDireccion = "  ";
        }
        $options_direcciones .= '<option value="' . $direccion->tipo . '-' . $direccion->nombre . '" ' . $checkedDireccion . '>' . $direccion->tipo . "-" . $direccion->nombre . '</option>';
    }


    //echo $datos_imparticion[0]->id_modalidad_imparticion;
    if($datos_imparticion[0]->id_modalidad_imparticion=="1"){$select_modalidad_01=" selected ";}
    if($datos_imparticion[0]->id_modalidad_imparticion=="2"){$select_modalidad_02=" selected ";}
    if($datos_imparticion[0]->id_modalidad_imparticion=="3"){$select_modalidad_03=" selected ";}
    if($datos_imparticion[0]->id_modalidad_imparticion=="4"){$select_modalidad_04=" selected ";}
    if($datos_imparticion[0]->id_modalidad_imparticion=="5"){$select_modalidad_05=" selected ";}
    if($datos_imparticion[0]->id_modalidad_imparticion=="6"){$select_modalidad_06=" selected ";}
    if($datos_imparticion[0]->id_modalidad_imparticion=="7"){$select_modalidad_07=" selected ";}

    $PRINCIPAL = str_replace("{SELECT_MODALIDAD_01}", utf8_encode($select_modalidad_01), $PRINCIPAL);
    $PRINCIPAL = str_replace("{SELECT_MODALIDAD_02}", utf8_encode($select_modalidad_02), $PRINCIPAL);
    $PRINCIPAL = str_replace("{SELECT_MODALIDAD_03}", utf8_encode($select_modalidad_03), $PRINCIPAL);
    $PRINCIPAL = str_replace("{SELECT_MODALIDAD_04}", utf8_encode($select_modalidad_04), $PRINCIPAL);
    $PRINCIPAL = str_replace("{SELECT_MODALIDAD_05}", utf8_encode($select_modalidad_05), $PRINCIPAL);
    $PRINCIPAL = str_replace("{SELECT_MODALIDAD_06}", utf8_encode($select_modalidad_06), $PRINCIPAL);
    $PRINCIPAL = str_replace("{SELECT_MODALIDAD_07}", utf8_encode($select_modalidad_07), $PRINCIPAL);

    $PRINCIPAL = str_replace("{VALUE_DIRECCION}", utf8_encode($options_direcciones), $PRINCIPAL);

    if($datos_imparticion[0]->valor_curso=="SI")    {   $select_costos_asociados_SI=" selected ";}
    if($datos_imparticion[0]->valor_curso=="NO")    {   $select_costos_asociados_NO=" selected ";}

    $PRINCIPAL = str_replace("{COSTOS_ASOCIADOS_SI}", utf8_encode($select_costos_asociados_SI), $PRINCIPAL);
    $PRINCIPAL = str_replace("{COSTOS_ASOCIADOS_NO}", utf8_encode($select_costos_asociados_NO), $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALOR_BOTON}", "Ingresar Imparticion", $PRINCIPAL);
    //Veo cuantos usuarios hay en la tabla inscripcion_usuario, para colocar la cantidad
    $usuarios_por_inscripcion = IMPARTICION_UsuariosPorInscripcion($codigo_imparticion, $id_empresa);
    $PRINCIPAL = str_replace("{TOTAL_USUARIOS_POR_INSCRIPCION}", count($usuarios_por_inscripcion), $PRINCIPAL);
    //Postulantes por Imparticion, tabla tbl_inscripcion_postulantes
    $postulantes_por_inscripcion = IMPARTICION_PostulantesPorInscripcion($codigo_imparticion, $id_empresa);
    $PRINCIPAL = str_replace("{TOTAL_POSTULANTES_POR_INSCRIPCION}", count($postulantes_por_inscripcion), $PRINCIPAL);

    $nombre_Curso_array = BuscaNombreCursoDadoID($datos_imparticion[0]->id_curso);
    $nombre_curso = $nombre_Curso_array[0]->nombre;

    $PRINCIPAL = str_replace("{VALUE_COD_IMPARTICION_FECHA}", $datos_imparticion[0]->fecha_inicio, $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALUE_COD_IMPARTICION_FECHA_HASTA}", $datos_imparticion[0]->fecha_termino, $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALUE_COD_IMPARTICION_HORA_DESDE}", $datos_imparticion[0]->hora_inicio, $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALUE_COD_IMPARTICION_HORA_HASTA}", $datos_imparticion[0]->hora_termino, $PRINCIPAL);


    $PRINCIPAL = str_replace("{SCRIPT_ACTIVA_TIPO_HORARIO}", $script_activa_radio_horarios, $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALUE_COD_IMPARTICION_OBSERVACION}", $datos_imparticion[0]->observacion, $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALUE_COD_IMPARTICION_OBSERVACION_NEW2}", $datos_imparticion[0]->observacion, $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALUE_COD_IMPARTICION_FECHA_HASTA}", $datos_imparticion[0]->observacion, $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALUE_NOMBRE}", utf8_encode($datos_imparticion[0]->nombre), $PRINCIPAL);
    $PRINCIPAL = str_replace("{NOMBRE_CURSO}", utf8_encode($nombre_Curso_array[0]->nombre), $PRINCIPAL);

    if($_GET["dup"]==1){
 $trae_imparticiones = IMPARTICIONES_traeImparticionesCreadas($id_empresa);
        $trae_imparticiones_ultima = IMPARTICIONES_traeImparticionesCreadasUltima_2021($id_empresa);
        //$codigo_ultima=$trae_imparticiones_ultima[0]->codigo_inscripcion;
        //$codigo_ultima=$trae_imparticiones_ultima[0]->id;

        // echo "<br>trae_imparticiones_ultima $trae_imparticiones_ultima<br>";
        $codigo_ultima = $trae_imparticiones_ultima;
        ///////////////$arreglo=explode("_", $codigo_ultima);
        //print_r($arreglo);
        ///////////////$siguiente_codigo=$arreglo[2]+1;
        $siguiente_codigo = NuevoCodigoImparticion_2021($codigo_ultima);


        //traigo la ultima imparticion
        if ($trae_imparticiones) {
            //$codigo_imparticion=$trae_imparticiones[0]->prefijo."_impart_".(count($trae_imparticiones)+1);
            $codigo_imparticion = $trae_imparticiones[0]->prefijo . "_impart_" . $siguiente_codigo;
            $codigo_imparticion = $siguiente_codigo;
        } else {
            $datos_empresa = DatosEmpresa($id_empresa);
            //$codigo_imparticion=$datos_empresa[0]->prefijo."_impart_".(count($trae_imparticiones)+1);
            $codigo_imparticion = $datos_empresa[0]->prefijo . "_impart_" . $siguiente_codigo;
            $codigo_imparticion = $siguiente_codigo;
        }
        //$codigo_imparticion="000022222";
    }

    $PRINCIPAL = str_replace("{VALUE_COD_IMPARTICION}", $codigo_imparticion, $PRINCIPAL);
    $PRINCIPAL = str_replace("{COD_IMPARTICION_ENCODEADO}", Encodear3($codigo_imparticion), $PRINCIPAL);
    $PRINCIPAL = str_replace("{ID_EMPRESA_ENCODEADO}", Encodear3($id_empresa), $PRINCIPAL);
    $PRINCIPAL = str_replace("{FECHAINICIO}", $datos_imparticion[0]->fecha_inicio, $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALUE_FECHA_TERMINO}", $datos_imparticion[0]->fecha_termino, $PRINCIPAL);
    $fecha_inicio = str_replace("-", "/", $datos_imparticion[0]->fecha_inicio);
    $fecha_termino = str_replace("-", "/", $datos_imparticion[0]->fecha_termino);
    $PRINCIPAL = str_replace("{VALUE_FECHAS}", $fecha_inicio . " - " . $fecha_termino, $PRINCIPAL);
    $PRINCIPAL = str_replace("{COMENTARIOS}", utf8_encode($datos_imparticion[0]->comentarios), $PRINCIPAL);

    $PRINCIPAL = str_replace("{VALUE_STREAMING}", utf8_encode($datos_imparticion[0]->direccion), $PRINCIPAL);


    $PRINCIPAL = str_replace("{VALUE_SESIONES}", $datos_imparticion[0]->sesiones, $PRINCIPAL);
    if ($datos_imparticion[0]->id_curso) {
        $PRINCIPAL = str_replace("{VALUE_COD_CURSO}", $datos_imparticion[0]->id_curso, $PRINCIPAL);
    } else {
        $id_curso = Decodear3($_GET["i"]);
        //echo "<br>id_curso $id_curso";
        $PRINCIPAL = str_replace("{VALUE_COD_CURSO}", $id_curso, $PRINCIPAL);
    }


    $PRINCIPAL = str_replace("{VALUE_DIRECCION}", utf8_encode($datos_imparticion[0]->direccion), $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALUE_CIUDAD}", utf8_encode($datos_imparticion[0]->ciudad), $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALUE_CUPOS}", $datos_imparticion[0]->cupos, $PRINCIPAL);
    $PRINCIPAL = str_replace("{TEXTO_HORARIOS}", $datos_imparticion[0]->texto_horarios, $PRINCIPAL);
    $PRINCIPAL = str_replace("{ACTION}", "?sw=adimparti", $PRINCIPAL);
    $PRINCIPAL = str_replace("{TITULO}", "Formulario Ingreso de Imparticiones", $PRINCIPAL);
    $PRINCIPAL = str_replace("{NOMBRE_FORMULARIO}", "FormCurso", $PRINCIPAL);
    $PRINCIPAL = str_replace("{L1H}", $datos_imparticion[0]->lunes_d_am, $PRINCIPAL);
    $PRINCIPAL = str_replace("{L2H}", $datos_imparticion[0]->lunes_h_am, $PRINCIPAL);
    $PRINCIPAL = str_replace("{L3H}", $datos_imparticion[0]->lunes_d_pm, $PRINCIPAL);
    $PRINCIPAL = str_replace("{L4H}", $datos_imparticion[0]->lunes_h_pm, $PRINCIPAL);
    $PRINCIPAL = str_replace("{L5H}", $datos_imparticion[0]->martes_d_am, $PRINCIPAL);
    $PRINCIPAL = str_replace("{L6H}", $datos_imparticion[0]->martes_h_am, $PRINCIPAL);
    $PRINCIPAL = str_replace("{L7H}", $datos_imparticion[0]->martes_d_pm, $PRINCIPAL);
    $PRINCIPAL = str_replace("{L8H}", $datos_imparticion[0]->martes_h_pm, $PRINCIPAL);
    $PRINCIPAL = str_replace("{L9H}", $datos_imparticion[0]->miercoles_d_am, $PRINCIPAL);
    $PRINCIPAL = str_replace("{L10H}", $datos_imparticion[0]->miercoles_h_am, $PRINCIPAL);
    $PRINCIPAL = str_replace("{L11H}", $datos_imparticion[0]->miercoles_d_pm, $PRINCIPAL);
    $PRINCIPAL = str_replace("{L12H}", $datos_imparticion[0]->miercoles_h_pm, $PRINCIPAL);
    $PRINCIPAL = str_replace("{L13H}", $datos_imparticion[0]->jueves_d_am, $PRINCIPAL);
    $PRINCIPAL = str_replace("{L14H}", $datos_imparticion[0]->jueves_h_am, $PRINCIPAL);
    $PRINCIPAL = str_replace("{L15H}", $datos_imparticion[0]->jueves_d_pm, $PRINCIPAL);
    $PRINCIPAL = str_replace("{L16H}", $datos_imparticion[0]->jueves_h_pm, $PRINCIPAL);
    $PRINCIPAL = str_replace("{L17H}", $datos_imparticion[0]->viernes_d_am, $PRINCIPAL);
    $PRINCIPAL = str_replace("{L18H}", $datos_imparticion[0]->viernes_h_am, $PRINCIPAL);
    $PRINCIPAL = str_replace("{L19H}", $datos_imparticion[0]->viernes_d_pm, $PRINCIPAL);
    $PRINCIPAL = str_replace("{L20H}", $datos_imparticion[0]->viernes_h_pm, $PRINCIPAL);
    return ($PRINCIPAL);
}



function FormularioImparticionMallas($PRINCIPAL, $id_empresa, $id_imparticion, $id_curso)
{

    if (!$id_imparticion) {
        //si no hay codigo de imparticion creo uno
        $trae_imparticiones = IMPARTICIONES_traeImparticionesCreadas($id_empresa);
        $trae_imparticiones_ultima = IMPARTICIONES_traeImparticionesCreadasUltima_2021($id_empresa);
        //$codigo_ultima=$trae_imparticiones_ultima[0]->codigo_inscripcion;
        //$codigo_ultima=$trae_imparticiones_ultima[0]->id;

        // echo "<br>trae_imparticiones_ultima $trae_imparticiones_ultima<br>";
        $codigo_ultima = $trae_imparticiones_ultima;
        ///////////////$arreglo=explode("_", $codigo_ultima);
        //print_r($arreglo);
        ///////////////$siguiente_codigo=$arreglo[2]+1;
        $siguiente_codigo = NuevoCodigoImparticion_2021($codigo_ultima);


        //traigo la ultima imparticion
        if ($trae_imparticiones) {
            //$codigo_imparticion=$trae_imparticiones[0]->prefijo."_impart_".(count($trae_imparticiones)+1);
            $codigo_imparticion = $trae_imparticiones[0]->prefijo . "_impart_" . $siguiente_codigo;
            $codigo_imparticion = $siguiente_codigo;
        } else {
            $datos_empresa = DatosEmpresa($id_empresa);
            //$codigo_imparticion=$datos_empresa[0]->prefijo."_impart_".(count($trae_imparticiones)+1);
            $codigo_imparticion = $datos_empresa[0]->prefijo . "_impart_" . $siguiente_codigo;
            $codigo_imparticion = $siguiente_codigo;
        }
    } else {
        $codigo_imparticion = $id_imparticion;
    }

    //echo " codigo_imparticion ".$codigo_imparticion." id imparticion ".$id_imparticion;
    //$datos_imparticion=DatosInscripcionImparticiones($id_imparticion, $id_empresa);
    $datos_imparticion = DatosInscripcionImparticionesV2($id_imparticion, $id_empresa);
    // print_r($datos_imparticion);

    $datos_curso = VerificoCursoPorEmpresa($id_curso, $id_empresa);
    //$ejecutivos=TraeEjecutivosPorEmpresa($id_empresa);
    $ejecutivos = TraeEjecutivos2021($id_empresa);
    $options_ejecutivos = "";
    foreach ($ejecutivos as $ejec) {

        if ($datos_imparticion[0]->ejecutivo == $ejec->rut) {
            $checked = " selected ";
        } else {
            $checked = "  ";
        }
        $options_ejecutivos .= '<option value="' . $ejec->rut . '" ' . $checked . '>' . $ejec->nombre . ' - ' . $ejec->rut . '</option>';
    }
    $PRINCIPAL = str_replace("{OPTIONS_EJECUTIVOS}", utf8_encode($options_ejecutivos), $PRINCIPAL);

    $ejecutivos_interno = TraeEjecutivos2022_tipo($id_empresa, "interno");
    $options_ejecutivos_interno = "";
    foreach ($ejecutivos_interno as $ejec) {

        if ($datos_imparticion[0]->ejecutivo == $ejec->rut) {
            $checked = " selected ";
        } else {
            $checked = "  ";
        }
        $options_ejecutivos_interno .= '<option value="' . $ejec->rut . '" ' . $checked . '>' . $ejec->nombre . ' - ' . $ejec->rut . '</option>';
    }
    $PRINCIPAL = str_replace("{OPTIONS_EJECUTIVOS_INTERNO}", utf8_encode($options_ejecutivos_interno), $PRINCIPAL);


    $ejecutivos_externo = TraeEjecutivos2022_tipo($id_empresa, "externo");
    $options_ejecutivos_externo = "";
    foreach ($ejecutivos_externo as $ejec) {

        if ($datos_imparticion[0]->archivo == $ejec->rut) {
            $checked = " selected ";
        } else {
            $checked = "  ";
        }
        $options_ejecutivos_externo .= '<option value="' . $ejec->rut . '" ' . $checked . '>' . $ejec->nombre . ' - ' . $ejec->rut . '</option>';
    }
    $PRINCIPAL = str_replace("{OPTIONS_EJECUTIVOS_EXTERNO}", utf8_encode($options_ejecutivos_externo), $PRINCIPAL);


    $otecs = TraeOtec2021($id_empresa);
    $options_otec = "";
    foreach ($otecs as $otec) {
        if ($datos_imparticion[0]->ciudad == $otec->rut) {
            $checked = " selected ";
        } else {
            $checked = "  ";
        }
        $options_otec .= '<option value="' . $otec->rut . '" ' . $checked . '>' . $otec->nombre . ' - ' . $otec->rut . '</option>';
    }
    $PRINCIPAL = str_replace("{OPTIONS_OTEC}", utf8_encode($options_otec), $PRINCIPAL);

    $direcciones = TraeDirecciones2021($id_empresa);
    $options_direcciones = "";
    foreach ($direcciones as $direccion) {
        if ($datos_imparticion[0]->direccion == $direccion->tipo . "-" . $direccion->nombre) {
            $checkedDireccion = " selected ";
        } else {
            $checkedDireccion = "  ";
        }
        $options_direcciones .= '<option value="' . $direccion->tipo . '-' . $direccion->nombre . '" ' . $checkedDireccion . '>' . $direccion->tipo . "-" . $direccion->nombre . '</option>';
    }
    $PRINCIPAL = str_replace("{VALUE_DIRECCION}", utf8_encode($options_direcciones), $PRINCIPAL);

    $PRINCIPAL = str_replace("{VALOR_BOTON}", "Ingresar Imparticion", $PRINCIPAL);
    //Veo cuantos usuarios hay en la tabla inscripcion_usuario, para colocar la cantidad
    $usuarios_por_inscripcion = IMPARTICION_UsuariosPorInscripcion($codigo_imparticion, $id_empresa);
    $PRINCIPAL = str_replace("{TOTAL_USUARIOS_POR_INSCRIPCION}", count($usuarios_por_inscripcion), $PRINCIPAL);
    //Postulantes por Imparticion, tabla tbl_inscripcion_postulantes
    $postulantes_por_inscripcion = IMPARTICION_PostulantesPorInscripcion($codigo_imparticion, $id_empresa);
    $PRINCIPAL = str_replace("{TOTAL_POSTULANTES_POR_INSCRIPCION}", count($postulantes_por_inscripcion), $PRINCIPAL);

    $nombre_Curso_array = BuscaNombreCursoDadoID($datos_imparticion[0]->id_curso);
    $nombre_curso = $nombre_Curso_array[0]->nombre;

    $PRINCIPAL = str_replace("{VALUE_COD_IMPARTICION_FECHA}", $datos_imparticion[0]->fecha_inicio, $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALUE_COD_IMPARTICION_FECHA_HASTA}", $datos_imparticion[0]->fecha_termino, $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALUE_COD_IMPARTICION_HORA_DESDE}", $datos_imparticion[0]->hora_inicio, $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALUE_COD_IMPARTICION_HORA_HASTA}", $datos_imparticion[0]->hora_termino, $PRINCIPAL);

    $PRINCIPAL = str_replace("{NOMBRE_CURSO_DESDE_MALLA}", utf8_encode($datos_curso[0]->nombre), $PRINCIPAL);
    $PRINCIPAL = str_replace("{ID_CURSO_DESDE_MALLA}",      $datos_curso[0]->id, $PRINCIPAL);



    $PRINCIPAL = str_replace("{SCRIPT_ACTIVA_TIPO_HORARIO}", $script_activa_radio_horarios, $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALUE_COD_IMPARTICION_OBSERVACION}", $datos_imparticion[0]->observacion, $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALUE_COD_IMPARTICION_OBSERVACION_NEW2}", $datos_imparticion[0]->observacion, $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALUE_COD_IMPARTICION_FECHA_HASTA}", $datos_imparticion[0]->observacion, $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALUE_NOMBRE}", utf8_encode($datos_imparticion[0]->nombre), $PRINCIPAL);
    $PRINCIPAL = str_replace("{NOMBRE_CURSO}", utf8_encode($nombre_Curso_array[0]->nombre), $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALUE_COD_IMPARTICION}", $codigo_imparticion, $PRINCIPAL);
    $PRINCIPAL = str_replace("{COD_IMPARTICION_ENCODEADO}", Encodear3($codigo_imparticion), $PRINCIPAL);
    $PRINCIPAL = str_replace("{ID_EMPRESA_ENCODEADO}", Encodear3($id_empresa), $PRINCIPAL);
    $PRINCIPAL = str_replace("{FECHAINICIO}", $datos_imparticion[0]->fecha_inicio, $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALUE_FECHA_TERMINO}", $datos_imparticion[0]->fecha_termino, $PRINCIPAL);
    $fecha_inicio = str_replace("-", "/", $datos_imparticion[0]->fecha_inicio);
    $fecha_termino = str_replace("-", "/", $datos_imparticion[0]->fecha_termino);
    $PRINCIPAL = str_replace("{VALUE_FECHAS}", $fecha_inicio . " - " . $fecha_termino, $PRINCIPAL);
    $PRINCIPAL = str_replace("{COMENTARIOS}", utf8_encode($datos_imparticion[0]->comentarios), $PRINCIPAL);

    $PRINCIPAL = str_replace("{VALUE_STREAMING}", utf8_encode($datos_imparticion[0]->direccion), $PRINCIPAL);


    $PRINCIPAL = str_replace("{VALUE_SESIONES}", $datos_imparticion[0]->sesiones, $PRINCIPAL);
    if ($datos_imparticion[0]->id_curso) {
        $PRINCIPAL = str_replace("{VALUE_COD_CURSO}", $datos_imparticion[0]->id_curso, $PRINCIPAL);
    } else {
        $id_curso = Decodear3($_GET["i"]);
        //echo "<br>id_curso $id_curso";
        $PRINCIPAL = str_replace("{VALUE_COD_CURSO}", $id_curso, $PRINCIPAL);
    }


    $PRINCIPAL = str_replace("{VALUE_DIRECCION}", utf8_encode($datos_imparticion[0]->direccion), $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALUE_CIUDAD}", utf8_encode($datos_imparticion[0]->ciudad), $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALUE_CUPOS}", $datos_imparticion[0]->cupos, $PRINCIPAL);
    $PRINCIPAL = str_replace("{TEXTO_HORARIOS}", $datos_imparticion[0]->texto_horarios, $PRINCIPAL);
    $PRINCIPAL = str_replace("{ACTION}", "?sw=adimparti", $PRINCIPAL);
    $PRINCIPAL = str_replace("{TITULO}", "Formulario Ingreso de Imparticiones", $PRINCIPAL);
    $PRINCIPAL = str_replace("{NOMBRE_FORMULARIO}", "FormCurso", $PRINCIPAL);
    $PRINCIPAL = str_replace("{L1H}", $datos_imparticion[0]->lunes_d_am, $PRINCIPAL);
    $PRINCIPAL = str_replace("{L2H}", $datos_imparticion[0]->lunes_h_am, $PRINCIPAL);
    $PRINCIPAL = str_replace("{L3H}", $datos_imparticion[0]->lunes_d_pm, $PRINCIPAL);
    $PRINCIPAL = str_replace("{L4H}", $datos_imparticion[0]->lunes_h_pm, $PRINCIPAL);
    $PRINCIPAL = str_replace("{L5H}", $datos_imparticion[0]->martes_d_am, $PRINCIPAL);
    $PRINCIPAL = str_replace("{L6H}", $datos_imparticion[0]->martes_h_am, $PRINCIPAL);
    $PRINCIPAL = str_replace("{L7H}", $datos_imparticion[0]->martes_d_pm, $PRINCIPAL);
    $PRINCIPAL = str_replace("{L8H}", $datos_imparticion[0]->martes_h_pm, $PRINCIPAL);
    $PRINCIPAL = str_replace("{L9H}", $datos_imparticion[0]->miercoles_d_am, $PRINCIPAL);
    $PRINCIPAL = str_replace("{L10H}", $datos_imparticion[0]->miercoles_h_am, $PRINCIPAL);
    $PRINCIPAL = str_replace("{L11H}", $datos_imparticion[0]->miercoles_d_pm, $PRINCIPAL);
    $PRINCIPAL = str_replace("{L12H}", $datos_imparticion[0]->miercoles_h_pm, $PRINCIPAL);
    $PRINCIPAL = str_replace("{L13H}", $datos_imparticion[0]->jueves_d_am, $PRINCIPAL);
    $PRINCIPAL = str_replace("{L14H}", $datos_imparticion[0]->jueves_h_am, $PRINCIPAL);
    $PRINCIPAL = str_replace("{L15H}", $datos_imparticion[0]->jueves_d_pm, $PRINCIPAL);
    $PRINCIPAL = str_replace("{L16H}", $datos_imparticion[0]->jueves_h_pm, $PRINCIPAL);
    $PRINCIPAL = str_replace("{L17H}", $datos_imparticion[0]->viernes_d_am, $PRINCIPAL);
    $PRINCIPAL = str_replace("{L18H}", $datos_imparticion[0]->viernes_h_am, $PRINCIPAL);
    $PRINCIPAL = str_replace("{L19H}", $datos_imparticion[0]->viernes_d_pm, $PRINCIPAL);
    $PRINCIPAL = str_replace("{L20H}", $datos_imparticion[0]->viernes_h_pm, $PRINCIPAL);
    return ($PRINCIPAL);
}


function TiempoTranscurrido_2021($t1_hour, $t2_hour)
{
    $datetime1 = new DateTime('2014-02-11 ' . $t1_hour);
    $datetime2 = new DateTime('2014-02-11 ' . $t2_hour);
    $interval = $datetime1->diff($datetime2);
    $tiempo = $interval->format('%h') . "h:" . $interval->format('%i') . "m";
    return $tiempo;
}


function TiempoTranscurrido_Full_2021($t1_hour, $t2_hour)
{
    $datetime1 = new DateTime('2014-02-11 ' . $t1_hour);
    $datetime2 = new DateTime('2014-02-11 ' . $t2_hour);
    $interval = $datetime1->diff($datetime2);
    $tiempo = $interval->format('%h') . ":" . $interval->format('%i') . "";
//echo "<br>$t1_hour, $t2_hour -> tiempo $tiempo";
    $hora = $interval->format('%h');
    $minuto = $interval->format('%i');
    $hora_enMinutos = round($hora * 60);
    $minutos_enminutos = round($minuto * 1);
//e/cho "<br>hora_enMinutos $hora_enMinutos";
//echo "<br>minutos_enminutos $minutos_enminutos";
    $total_minutos = round($hora_enMinutos) + round($minutos_enminutos);

//echo "<br>total_minutos $total_minutos<br>";

    return $total_minutos;
}

function DatosImparticiones_SumaHoras($id_curso, $id_inscripcion, $tipo_horario, $fecha_inicio, $fecha_termino, $hora_inicio, $hora_termino, $modalidad, $numero_horas)
{
    $suma_tiempo = 0;
    //echo "<h3>DatosImparticiones_SumaHoras($id_curso, $id_inscripcion, $tipo_horario, $fecha_inicio, $fecha_termino, $hora_inicio, $hora_termino, modalidad $modalidad, numero horas $numero_horas)</h3>";
    if ($tipo_horario == "fecha_sesiones") {

        $InscripcionCursoSesiones = DatosImparticiones_Sesiones_data_2021($id_inscripcion);
        foreach ($InscripcionCursoSesiones as $ses) {
            $tiempo = TiempoTranscurrido_Full_2021($ses->hora_desde, $ses->hora_hasta);
            //echo "<br>-Minutos ".($tiempo);
            if ($tiempo > 0) {
                $suma_tiempo = $suma_tiempo + $tiempo;
            }
        }
        $numero_horas_imparticiones = $suma_tiempo;
        $numero_horas_minutos = round(60 * $numero_horas);
    } else {
        //echo "<h2>b $fecha_inicio==$fecha_termino modalidad $modalidad</h2>";
        if ($fecha_inicio == $fecha_termino) {
            $tiempo = TiempoTranscurrido_Full_2021($hora_inicio, $hora_termino);
            if ($tiempo > 0) {
                $suma_tiempo = $suma_tiempo + $tiempo;
            }
            //echo "<br>-Minutos ".($suma_tiempo);
            $numero_horas_imparticiones = $suma_tiempo;
            $numero_horas_minutos = round(60 * $numero_horas);
        } else {
            $numero_horas_imparticiones = 0;
        }
    }

    if ($numero_horas > 0) {
        if ($modalidad == "2") {
            if ($numero_horas_minutos > $numero_horas_imparticiones and $numero_horas_imparticiones > 0) {
                $diferencia_minutos = $numero_horas_minutos - $numero_horas_imparticiones;
                $alerta_curso .= "<center><div class='alert alert-danger'>Horas de Curso: $numero_horas hora(s). Faltan $diferencia_minutos minutos en las sesiones creadas.</div></center><br>";
            } elseif ($numero_horas_minutos < $numero_horas_imparticiones and $numero_horas_imparticiones > 0) {
                $diferencia_minutos = $numero_horas_imparticiones - $numero_horas_minutos;
                $alerta_curso .= "<center><div class='alert alert-danger'>Horas de Curso: $numero_horas hora(s). Sobran $diferencia_minutos minutos en las sesiones creadas.</div></center><br>";

            } else {
                $alerta_curso .= "<center><div class='alert alert-info'>Horas de Curso: $numero_horas hora(s)</div></center><br>";
            }
        } else {
            $alerta_curso .= "<center><div class='alert alert-danger'>Horas de Curso: $numero_horas hora(s)</div></center><br>";
        }


    } else {
        // no muestra horas del curso
        $alerta_curso .= "<center><div class='alert alert-danger'>El curso no tiene definida horas</div></center><br>";
    }

    return $alerta_curso;
}


function DatosImparticiones_SinASistenciaSinHoras($id_curso, $id_inscripcion, $tipo_horario, $fecha_inicio, $fecha_termino, $hora_inicio, $hora_termino, $modalidad, $numero_horas)
{
    $Imp = BuscaIdImparticionFull_2021($id_inscripcion);
    //print_r($Imp);

    if ($Imp[0]->id > 0) {
        if (($Imp[0]->minimo_asistencia == "" or $Imp[0]->minimo_asistencia == "0") and ($Imp[0]->minimo_nota_aprobacion == "" or $Imp[0]->minimo_nota_aprobacion == "0")) {
            $alerta = "<div class='alert alert-warning'><strong>Importante</strong>:
				Esta impartici&oacute;n no tiene ni asistencia m&iacute;nima ni nota m&iacute;nima definida.</div>";
        }

    } else {
        $alerta = "";
    }

    return $alerta;
}

function DatosImparticiones_Sesiones_2021($PRINCIPAL, $id_inscripcion, $id_curso)
{
    //echo "<h3>DatosImparticiones_Sesiones_2021(, $id_inscripcion</h3>";
    $InscripcionCursoSesiones = DatosImparticiones_Sesiones_data_2021($id_inscripcion);
    //print_r($InscripcionCursoSesiones);
    $i = $_GET["i"];
    $idpbbdd = $_GET["idpbbdd"];
    //echo "<br>-->i $i, idpbbdd $idpbbdd";

    $options_relatores .= "";
    $Rel = TraeRelatores2021();
    foreach ($Rel as $uniRel) {
        $options_relatores .= "<option value='" . Encodear3($uniRel->rut) . "'>" . utf8_encode($uniRel->nombre) . " (" . $uniRel->tipo . ")</option>";
    }


    //echo "<h4>Cuenta Sesiones </h4>".count($InscripcionCursoSesiones)."<br>";

    if (count($InscripcionCursoSesiones) > 0) {
        //echo "<h1>a</h1>";
        foreach ($InscripcionCursoSesiones as $ses) {
            //print_r($ses);
            $cuenta_sesiones++;
            if ($cuenta_sesiones == "1") {
                $row1 .= file_get_contents("views/capacitacion/imparticion/row_imparticion_por_sesion.html");
                $row1 = str_replace("{ID_LINEA_ENC}", Encodear3($ses->id), $row1);
                $row1 = str_replace("{VALUE_COD_IMPARTICION_FECHA}", $ses->fecha, $row1);
                $row1 = str_replace("{VALUE_COD_IMPARTICION_HORA_DESDE}", $ses->hora_desde, $row1);
                $row1 = str_replace("{VALUE_COD_IMPARTICION_HORA_HASTA}", $ses->hora_hasta, $row1);
                $row1 = str_replace("{VALUE_COD_IMPARTICION_OBSERVACION}", utf8_encode($ses->observacione), $row1);
                $row1 = str_replace("{ID_IMPARTICION_ENC}", Encodear3($ses->id_inscripcion), $row1);
                $row1 = str_replace("{ID_PROGRAMA_ENC}", "", $row1);
                $row1 = str_replace("{ID_SESION}", "1", $row1);
                $row1 = str_replace("{ID_SESION_NEW}", "2", $row1);
                $row1 = str_replace("{ID_CURSO_ENC}", Encodear3($id_curso), $row1);
                $row1 = str_replace("{ID_IMPARTICION_ENC}", Encodear3($id_inscripcion), $row1);
                $row1 = str_replace("{OPTION_RELATOR_NOMBRE_TIPO}", $options_relatores, $row1);
                $Rel = TraeRelatores2021porId($ses->relator);
                if ($Rel[0]->nombre <> "") {
                    $relator_nombre = "" . utf8_encode($Rel[0]->nombre) . " (" . $Rel[0]->tipo . ")";
                    $rut_relator = $ses->relator;
                } else {
                    $rut_relator = "";
                    $relator_nombre = "";
                }
                $row1 = str_replace("{RELATOR_SES}", $rut_relator, $row1);
                $row1 = str_replace("{RELATOR_nombre_SES}", $relator_nombre, $row1);
                $tiempo_transcurrido = TiempoTranscurrido_2021($ses->hora_desde, $ses->hora_hasta);
                $row1 = str_replace("{NUMERO_HORAS_SESION}", $tiempo_transcurrido, $row1);

            }
            if ($cuenta_sesiones == "2") {
                $row2 .= file_get_contents("views/capacitacion/imparticion/row_imparticion_por_sesion.html");
                $row2 = str_replace("{ID_LINEA_ENC}", Encodear3($ses->id), $row2);
                $row2 = str_replace("{VALUE_COD_IMPARTICION_FECHA}", $ses->fecha, $row2);
                $row2 = str_replace("{VALUE_COD_IMPARTICION_HORA_DESDE}", $ses->hora_desde, $row2);
                $row2 = str_replace("{VALUE_COD_IMPARTICION_HORA_HASTA}", $ses->hora_hasta, $row2);
                $row2 = str_replace("{VALUE_COD_IMPARTICION_OBSERVACION}", utf8_encode($ses->observacione), $row2);
                $row2 = str_replace("{ID_IMPARTICION_ENC}", Encodear3($ses->id_inscripcion), $row2);
                $row2 = str_replace("{ID_PROGRAMA_ENC}", "", $row2);
                $row2 = str_replace("{ID_SESION}", "2", $row2);
                $row2 = str_replace("{ID_SESION_NEW}", "3", $row2);
                $row2 = str_replace("{ID_CURSO_ENC}", Encodear3($id_curso), $row2);
                $row2 = str_replace("{ID_IMPARTICION_ENC}", Encodear3($id_inscripcion), $row2);
                $row2 = str_replace("{DISPLAY_AGREGAR_MAS}", "display:none;", $row2);
                $row2 = str_replace("{OPTION_RELATOR_NOMBRE_TIPO}", $options_relatores, $row2);
                $Rel = TraeRelatores2021porId($ses->relator);
                if ($Rel[0]->nombre <> "") {
                    $relator_nombre = "" . utf8_encode($Rel[0]->nombre) . " (" . $Rel[0]->tipo . ")";
                    $rut_relator = $ses->relator;
                } else {
                    $rut_relator = "";
                    $relator_nombre = "";
                }
                $row2 = str_replace("{RELATOR_SES}", $rut_relator, $row2);
                $row2 = str_replace("{RELATOR_nombre_SES}", $relator_nombre, $row2);
                $tiempo_transcurrido = TiempoTranscurrido_2021($ses->hora_desde, $ses->hora_hasta);
                $row2 = str_replace("{NUMERO_HORAS_SESION}", $tiempo_transcurrido, $row2);
            }
            if ($cuenta_sesiones == "3") {
                $row3 .= file_get_contents("views/capacitacion/imparticion/row_imparticion_por_sesion.html");
                $row3 = str_replace("{ID_LINEA_ENC}", Encodear3($ses->id), $row3);
                $row3 = str_replace("{VALUE_COD_IMPARTICION_FECHA}", $ses->fecha, $row3);
                $row3 = str_replace("{VALUE_COD_IMPARTICION_HORA_DESDE}", $ses->hora_desde, $row3);
                $row3 = str_replace("{VALUE_COD_IMPARTICION_HORA_HASTA}", $ses->hora_hasta, $row3);
                $row3 = str_replace("{VALUE_COD_IMPARTICION_OBSERVACION}", utf8_encode($ses->observacione), $row3);
                $row3 = str_replace("{ID_IMPARTICION_ENC}", Encodear3($ses->id_inscripcion), $row3);
                $row3 = str_replace("{ID_PROGRAMA_ENC}", "", $row3);
                $row3 = str_replace("{ID_SESION}", "3", $row3);
                $row3 = str_replace("{ID_SESION_NEW}", "4", $row3);
                $row3 = str_replace("{ID_CURSO_ENC}", Encodear3($id_curso), $row3);
                $row3 = str_replace("{ID_IMPARTICION_ENC}", Encodear3($id_inscripcion), $row3);
                $row3 = str_replace("{DISPLAY_AGREGAR_MAS}", "display:none;", $row3);
                $row3 = str_replace("{OPTION_RELATOR_NOMBRE_TIPO}", $options_relatores, $row3);
                $Rel = TraeRelatores2021porId($ses->relator);
                if ($Rel[0]->nombre <> "") {
                    $relator_nombre = "" . utf8_encode($Rel[0]->nombre) . " (" . $Rel[0]->tipo . ")";
                    $rut_relator = $ses->relator;
                } else {
                    $rut_relator = "";
                    $relator_nombre = "";
                }
                $row3 = str_replace("{RELATOR_SES}", $rut_relator, $row3);
                $row3 = str_replace("{RELATOR_nombre_SES}", $relator_nombre, $row3);
                $tiempo_transcurrido = TiempoTranscurrido_2021($ses->hora_desde, $ses->hora_hasta);
                $row3 = str_replace("{NUMERO_HORAS_SESION}", $tiempo_transcurrido, $row3);

            }
            if ($cuenta_sesiones == "4") {
                $row4 .= file_get_contents("views/capacitacion/imparticion/row_imparticion_por_sesion.html");
                $row4 = str_replace("{ID_LINEA_ENC}", Encodear3($ses->id), $row4);
                $row4 = str_replace("{VALUE_COD_IMPARTICION_FECHA}", $ses->fecha, $row4);
                $row4 = str_replace("{VALUE_COD_IMPARTICION_HORA_DESDE}", $ses->hora_desde, $row4);
                $row4 = str_replace("{VALUE_COD_IMPARTICION_HORA_HASTA}", $ses->hora_hasta, $row4);
                $row4 = str_replace("{VALUE_COD_IMPARTICION_OBSERVACION}", utf8_encode($ses->observacione), $row4);
                $row4 = str_replace("{ID_IMPARTICION_ENC}", Encodear3($ses->id_inscripcion), $row4);
                $row4 = str_replace("{ID_PROGRAMA_ENC}", "", $row4);
                $row4 = str_replace("{ID_SESION}", "4", $row4);
                $row4 = str_replace("{ID_SESION_NEW}", "5", $row4);
                $row4 = str_replace("{ID_CURSO_ENC}", Encodear3($id_curso), $row4);
                $row4 = str_replace("{ID_IMPARTICION_ENC}", Encodear3($id_inscripcion), $row4);
                $row4 = str_replace("{DISPLAY_AGREGAR_MAS}", "display:none;", $row4);
                $row4 = str_replace("{OPTION_RELATOR_NOMBRE_TIPO}", $options_relatores, $row4);
                $Rel = TraeRelatores2021porId($ses->relator);
                if ($Rel[0]->nombre <> "") {
                    $relator_nombre = "" . utf8_encode($Rel[0]->nombre) . " (" . $Rel[0]->tipo . ")";
                    $rut_relator = $ses->relator;
                } else {
                    $rut_relator = "";
                    $relator_nombre = "";
                }
                $row4 = str_replace("{RELATOR_SES}", $rut_relator, $row4);
                $row4 = str_replace("{RELATOR_nombre_SES}", $relator_nombre, $row4);
                $tiempo_transcurrido = TiempoTranscurrido_2021($ses->hora_desde, $ses->hora_hasta);
                $row4 = str_replace("{NUMERO_HORAS_SESION}", $tiempo_transcurrido, $row4);
            }
            if ($cuenta_sesiones == "5") {
                $row5 .= file_get_contents("views/capacitacion/imparticion/row_imparticion_por_sesion.html");
                $row5 = str_replace("{ID_LINEA_ENC}", Encodear3($ses->id), $row5);
                $row5 = str_replace("{VALUE_COD_IMPARTICION_FECHA}", $ses->fecha, $row5);
                $row5 = str_replace("{VALUE_COD_IMPARTICION_HORA_DESDE}", $ses->hora_desde, $row5);
                $row5 = str_replace("{VALUE_COD_IMPARTICION_HORA_HASTA}", $ses->hora_hasta, $row5);
                $row5 = str_replace("{VALUE_COD_IMPARTICION_OBSERVACION}", utf8_encode($ses->observacione), $row5);
                $row5 = str_replace("{ID_IMPARTICION_ENC}", Encodear3($ses->id_inscripcion), $row5);
                $row5 = str_replace("{ID_PROGRAMA_ENC}", "", $row5);
                $row5 = str_replace("{ID_SESION}", "5", $row5);
                $row5 = str_replace("{ID_SESION_NEW}", "6", $row5);
                $row5 = str_replace("{ID_CURSO_ENC}", Encodear3($id_curso), $row5);
                $row5 = str_replace("{ID_IMPARTICION_ENC}", Encodear3($id_inscripcion), $row5);
                $row5 = str_replace("{DISPLAY_AGREGAR_MAS}", "display:none;", $row5);
                $row5 = str_replace("{OPTION_RELATOR_NOMBRE_TIPO}", $options_relatores, $row5);
                $Rel = TraeRelatores2021porId($ses->relator);
                if ($Rel[0]->nombre <> "") {
                    $relator_nombre = "" . utf8_encode($Rel[0]->nombre) . " (" . $Rel[0]->tipo . ")";
                    $rut_relator = $ses->relator;
                } else {
                    $rut_relator = "";
                    $relator_nombre = "";
                }
                $row5 = str_replace("{RELATOR_SES}", $rut_relator, $row5);
                $row5 = str_replace("{RELATOR_nombre_SES}", $relator_nombre, $row5);
                $tiempo_transcurrido = TiempoTranscurrido_2021($ses->hora_desde, $ses->hora_hasta);
                $row5 = str_replace("{NUMERO_HORAS_SESION}", $tiempo_transcurrido, $row5);
            }
            if ($cuenta_sesiones == "6") {
                $row6 .= file_get_contents("views/capacitacion/imparticion/row_imparticion_por_sesion.html");
                $row6 = str_replace("{ID_LINEA_ENC}", Encodear3($ses->id), $row6);
                $row6 = str_replace("{VALUE_COD_IMPARTICION_FECHA}", $ses->fecha, $row6);
                $row6 = str_replace("{VALUE_COD_IMPARTICION_HORA_DESDE}", $ses->hora_desde, $row6);
                $row6 = str_replace("{VALUE_COD_IMPARTICION_HORA_HASTA}", $ses->hora_hasta, $row6);
                $row6 = str_replace("{VALUE_COD_IMPARTICION_OBSERVACION}", utf8_encode($ses->observacione), $row6);
                $row6 = str_replace("{ID_IMPARTICION_ENC}", Encodear3($ses->id_inscripcion), $row6);
                $row6 = str_replace("{ID_PROGRAMA_ENC}", "", $row6);
                $row6 = str_replace("{ID_SESION}", "6", $row6);
                $row6 = str_replace("{ID_SESION_NEW}", "7", $row6);
                $row6 = str_replace("{ID_CURSO_ENC}", Encodear3($id_curso), $row6);
                $row6 = str_replace("{ID_IMPARTICION_ENC}", Encodear3($id_inscripcion), $row6);
                $row6 = str_replace("{DISPLAY_AGREGAR_MAS}", "display:none;", $row6);
                $row6 = str_replace("{OPTION_RELATOR_NOMBRE_TIPO}", $options_relatores, $row6);
                $Rel = TraeRelatores2021porId($ses->relator);
                if ($Rel[0]->nombre <> "") {
                    $relator_nombre = "" . utf8_encode($Rel[0]->nombre) . " (" . $Rel[0]->tipo . ")";
                    $rut_relator = $ses->relator;
                } else {
                    $rut_relator = "";
                    $relator_nombre = "";
                }
                $row6 = str_replace("{RELATOR_SES}", $rut_relator, $row6);
                $row6 = str_replace("{RELATOR_nombre_SES}", $relator_nombre, $row6);
                $tiempo_transcurrido = TiempoTranscurrido_2021($ses->hora_desde, $ses->hora_hasta);
                $row6 = str_replace("{NUMERO_HORAS_SESION}", $tiempo_transcurrido, $row6);
            }
            if ($cuenta_sesiones == "7") {
                $row7 .= file_get_contents("views/capacitacion/imparticion/row_imparticion_por_sesion.html");
                $row7 = str_replace("{ID_LINEA_ENC}", Encodear3($ses->id), $row7);
                $row7 = str_replace("{VALUE_COD_IMPARTICION_FECHA}", $ses->fecha, $row7);
                $row7 = str_replace("{VALUE_COD_IMPARTICION_HORA_DESDE}", $ses->hora_desde, $row7);
                $row7 = str_replace("{VALUE_COD_IMPARTICION_HORA_HASTA}", $ses->hora_hasta, $row7);
                $row7 = str_replace("{VALUE_COD_IMPARTICION_OBSERVACION}", utf8_encode($ses->observacione), $row7);
                $row7 = str_replace("{ID_IMPARTICION_ENC}", Encodear3($ses->id_inscripcion), $row7);
                $row7 = str_replace("{ID_PROGRAMA_ENC}", "", $row7);
                $row7 = str_replace("{ID_SESION}", "7", $row7);
                $row7 = str_replace("{ID_SESION_NEW}", "8", $row7);
                $row7 = str_replace("{ID_CURSO_ENC}", Encodear3($id_curso), $row7);
                $row7 = str_replace("{ID_IMPARTICION_ENC}", Encodear3($id_inscripcion), $row7);
                $row7 = str_replace("{DISPLAY_AGREGAR_MAS}", "display:none;", $row7);
                $row7 = str_replace("{OPTION_RELATOR_NOMBRE_TIPO}", $options_relatores, $row7);
                $Rel = TraeRelatores2021porId($ses->relator);
                if ($Rel[0]->nombre <> "") {
                    $relator_nombre = "" . utf8_encode($Rel[0]->nombre) . " (" . $Rel[0]->tipo . ")";
                    $rut_relator = $ses->relator;
                } else {
                    $rut_relator = "";
                    $relator_nombre = "";
                }
                $row7 = str_replace("{RELATOR_SES}", $rut_relator, $row7);
                $row7 = str_replace("{RELATOR_nombre_SES}", $relator_nombre, $row7);
                $tiempo_transcurrido = TiempoTranscurrido_2021($ses->hora_desde, $ses->hora_hasta);
                $row7 = str_replace("{NUMERO_HORAS_SESION}", $tiempo_transcurrido, $row7);
            }
            if ($cuenta_sesiones == "8") {
                $row8 .= file_get_contents("views/capacitacion/imparticion/row_imparticion_por_sesion.html");
                $row8 = str_replace("{ID_LINEA_ENC}", Encodear3($ses->id), $row8);
                $row8 = str_replace("{VALUE_COD_IMPARTICION_FECHA}", $ses->fecha, $row8);
                $row8 = str_replace("{VALUE_COD_IMPARTICION_HORA_DESDE}", $ses->hora_desde, $row8);
                $row8 = str_replace("{VALUE_COD_IMPARTICION_HORA_HASTA}", $ses->hora_hasta, $row8);
                $row8 = str_replace("{VALUE_COD_IMPARTICION_OBSERVACION}", utf8_encode($ses->observacione), $row8);
                $row8 = str_replace("{ID_IMPARTICION_ENC}", Encodear3($ses->id_inscripcion), $row8);
                $row8 = str_replace("{ID_PROGRAMA_ENC}", "", $row8);
                $row8 = str_replace("{ID_SESION}", "8", $row8);
                $row8 = str_replace("{ID_SESION_NEW}", "9", $row8);
                $row8 = str_replace("{ID_CURSO_ENC}", Encodear3($id_curso), $row8);
                $row8 = str_replace("{ID_IMPARTICION_ENC}", Encodear3($id_inscripcion), $row8);
                $row8 = str_replace("{DISPLAY_AGREGAR_MAS}", "display:none;", $row8);
                $row8 = str_replace("{OPTION_RELATOR_NOMBRE_TIPO}", $options_relatores, $row8);
                $Rel = TraeRelatores2021porId($ses->relator);
                if ($Rel[0]->nombre <> "") {
                    $relator_nombre = "" . utf8_encode($Rel[0]->nombre) . " (" . $Rel[0]->tipo . ")";
                    $rut_relator = $ses->relator;
                } else {
                    $rut_relator = "";
                    $relator_nombre = "";
                }
                $row8 = str_replace("{RELATOR_SES}", $rut_relator, $row8);
                $row8 = str_replace("{RELATOR_nombre_SES}", $relator_nombre, $row8);
                $tiempo_transcurrido = TiempoTranscurrido_2021($ses->hora_desde, $ses->hora_hasta);
                $row8 = str_replace("{NUMERO_HORAS_SESION}", $tiempo_transcurrido, $row8);
            }
            if ($cuenta_sesiones == "9") {
                $row9 .= file_get_contents("views/capacitacion/imparticion/row_imparticion_por_sesion.html");
                $row9 = str_replace("{ID_LINEA_ENC}", Encodear3($ses->id), $row9);
                $row9 = str_replace("{VALUE_COD_IMPARTICION_FECHA}", $ses->fecha, $row9);
                $row9 = str_replace("{VALUE_COD_IMPARTICION_HORA_DESDE}", $ses->hora_desde, $row9);
                $row9 = str_replace("{VALUE_COD_IMPARTICION_HORA_HASTA}", $ses->hora_hasta, $row9);
                $row9 = str_replace("{VALUE_COD_IMPARTICION_OBSERVACION}", utf8_encode($ses->observacione), $row9);
                $row9 = str_replace("{ID_IMPARTICION_ENC}", Encodear3($ses->id_inscripcion), $row9);
                $row9 = str_replace("{ID_PROGRAMA_ENC}", "", $row9);
                $row9 = str_replace("{ID_SESION}", "9", $row9);
                $row9 = str_replace("{ID_SESION_NEW}", "10", $row9);
                $row9 = str_replace("{ID_CURSO_ENC}", Encodear3($id_curso), $row9);
                $row9 = str_replace("{DISPLAY_AGREGAR_MAS}", "display:none;", $row9);
                $row9 = str_replace("{ID_IMPARTICION_ENC}", Encodear3($id_inscripcion), $row9);
                $row9 = str_replace("{OPTION_RELATOR_NOMBRE_TIPO}", $options_relatores, $row9);
                $Rel = TraeRelatores2021porId($ses->relator);
                if ($Rel[0]->nombre <> "") {
                    $relator_nombre = "" . utf8_encode($Rel[0]->nombre) . " (" . $Rel[0]->tipo . ")";
                    $rut_relator = $ses->relator;
                } else {
                    $rut_relator = "";
                    $relator_nombre = "";
                }
                $row9 = str_replace("{RELATOR_SES}", $rut_relator, $row9);
                $row9 = str_replace("{RELATOR_nombre_SES}", $relator_nombre, $row9);
                $tiempo_transcurrido = TiempoTranscurrido_2021($ses->hora_desde, $ses->hora_hasta);
                $row9 = str_replace("{NUMERO_HORAS_SESION}", $tiempo_transcurrido, $row9);
            }
            if ($cuenta_sesiones == "10") {
                $row10 .= file_get_contents("views/capacitacion/imparticion/row_imparticion_por_sesion.html");
                $row10 = str_replace("{ID_LINEA_ENC}", Encodear3($ses->id), $row10);
                $row10 = str_replace("{VALUE_COD_IMPARTICION_FECHA}", $ses->fecha, $row10);
                $row10 = str_replace("{VALUE_COD_IMPARTICION_HORA_DESDE}", $ses->hora_desde, $row10);
                $row10 = str_replace("{VALUE_COD_IMPARTICION_HORA_HASTA}", $ses->hora_hasta, $row10);
                $row10 = str_replace("{VALUE_COD_IMPARTICION_OBSERVACION}", utf8_encode($ses->observacione), $row10);
                $row10 = str_replace("{ID_IMPARTICION_ENC}", Encodear3($ses->id_inscripcion), $row10);
                $row10 = str_replace("{ID_PROGRAMA_ENC}", "", $row10);
                $row10 = str_replace("{ID_SESION}", "10", $row10);
                $row10 = str_replace("{ID_SESION_NEW}", "11", $row10);
                $row10 = str_replace("{ID_CURSO_ENC}", Encodear3($id_curso), $row10);
                $row10 = str_replace("{ID_IMPARTICION_ENC}", Encodear3($id_inscripcion), $row10);
                $row10 = str_replace("{DISPLAY_AGREGAR_MAS}", "display:none;", $row10);
                $row10 = str_replace("{OPTION_RELATOR_NOMBRE_TIPO}", $options_relatores, $row10);
                $Rel = TraeRelatores2021porId($ses->relator);
                if ($Rel[0]->nombre <> "") {
                    $relator_nombre = "" . utf8_encode($Rel[0]->nombre) . " (" . $Rel[0]->tipo . ")";
                    $rut_relator = $ses->relator;
                } else {
                    $rut_relator = "";
                    $relator_nombre = "";
                }
                $row10 = str_replace("{RELATOR_SES}", $rut_relator, $row10);
                $row10 = str_replace("{RELATOR_nombre_SES}", $relator_nombre, $row10);
                $tiempo_transcurrido = TiempoTranscurrido_2021($ses->hora_desde, $ses->hora_hasta);
                $row10 = str_replace("{NUMERO_HORAS_SESION}", $tiempo_transcurrido, $row10);
            }
            if ($cuenta_sesiones == "11") {
                $row11 .= file_get_contents("views/capacitacion/imparticion/row_imparticion_por_sesion.html");
                $row11 = str_replace("{ID_LINEA_ENC}", Encodear3($ses->id), $row11);
                $row11 = str_replace("{VALUE_COD_IMPARTICION_FECHA}", $ses->fecha, $row11);
                $row11 = str_replace("{VALUE_COD_IMPARTICION_HORA_DESDE}", $ses->hora_desde, $row11);
                $row11 = str_replace("{VALUE_COD_IMPARTICION_HORA_HASTA}", $ses->hora_hasta, $row11);
                $row11 = str_replace("{VALUE_COD_IMPARTICION_OBSERVACION}", utf8_encode($ses->observacione), $row11);
                $row11 = str_replace("{ID_IMPARTICION_ENC}", Encodear3($ses->id_inscripcion), $row11);
                $row11 = str_replace("{ID_PROGRAMA_ENC}", "", $row11);
                $row11 = str_replace("{ID_SESION}", "11", $row11);
                $row11 = str_replace("{ID_SESION_NEW}", "12", $row11);
                $row11 = str_replace("{ID_CURSO_ENC}", Encodear3($id_curso), $row11);
                $row11 = str_replace("{ID_IMPARTICION_ENC}", Encodear3($id_inscripcion), $row11);
                $row11 = str_replace("{DISPLAY_AGREGAR_MAS}", "display:none;", $row11);
                $row11 = str_replace("{OPTION_RELATOR_NOMBRE_TIPO}", $options_relatores, $row11);
                $Rel = TraeRelatores2021porId($ses->relator);
                if ($Rel[0]->nombre <> "") {
                    $relator_nombre = "" . utf8_encode($Rel[0]->nombre) . " (" . $Rel[0]->tipo . ")";
                    $rut_relator = $ses->relator;
                } else {
                    $rut_relator = "";
                    $relator_nombre = "";
                }
                $row11 = str_replace("{RELATOR_SES}", $rut_relator, $row11);
                $row11 = str_replace("{RELATOR_nombre_SES}", $relator_nombre, $row11);
                $tiempo_transcurrido = TiempoTranscurrido_2021($ses->hora_desde, $ses->hora_hasta);
                $row11 = str_replace("{NUMERO_HORAS_SESION}", $tiempo_transcurrido, $row11);
            }
            if ($cuenta_sesiones == "12") {
                $row12 .= file_get_contents("views/capacitacion/imparticion/row_imparticion_por_sesion.html");
                $row12 = str_replace("{ID_LINEA_ENC}", Encodear3($ses->id), $row12);
                $row12 = str_replace("{VALUE_COD_IMPARTICION_FECHA}", $ses->fecha, $row12);
                $row12 = str_replace("{VALUE_COD_IMPARTICION_HORA_DESDE}", $ses->hora_desde, $row12);
                $row12 = str_replace("{VALUE_COD_IMPARTICION_HORA_HASTA}", $ses->hora_hasta, $row12);
                $row12 = str_replace("{VALUE_COD_IMPARTICION_OBSERVACION}", utf8_encode($ses->observacione), $row12);
                $row12 = str_replace("{ID_IMPARTICION_ENC}", Encodear3($ses->id_inscripcion), $row12);
                $row12 = str_replace("{ID_PROGRAMA_ENC}", "", $row12);
                $row12 = str_replace("{ID_SESION}", "12", $row12);
                $row12 = str_replace("{ID_SESION_NEW}", "", $row12);
                $row12 = str_replace("{ID_CURSO_ENC}", Encodear3($id_curso), $row12);
                $row12 = str_replace("{ID_IMPARTICION_ENC}", Encodear3($id_inscripcion), $row12);
                $row12 = str_replace("{DISPLAY_AGREGAR_MAS}", "display:none;", $row12);
                $row12 = str_replace("{OPTION_RELATOR_NOMBRE_TIPO}", $options_relatores, $row12);
                $Rel = TraeRelatores2021porId($ses->relator);
                if ($Rel[0]->nombre <> "") {
                    $relator_nombre = "" . utf8_encode($Rel[0]->nombre) . " (" . $Rel[0]->tipo . ")";
                    $rut_relator = $ses->relator;
                } else {
                    $rut_relator = "";
                    $relator_nombre = "";
                }
                $row12 = str_replace("{RELATOR_SES}", $rut_relator, $row12);
                $row12 = str_replace("{RELATOR_nombre_SES}", $relator_nombre, $row12);
                $tiempo_transcurrido = TiempoTranscurrido_2021($ses->hora_desde, $ses->hora_hasta);
                $row12 = str_replace("{NUMERO_HORAS_SESION}", $tiempo_transcurrido, $row12);
            }


        }
    } else {
        //echo "<h1>b</h1>";
        $row1 .= file_get_contents("views/capacitacion/imparticion/row_imparticion_por_sesion.html");
        $row1 = str_replace("{ID_LINEA_ENC}", "", $row1);
        $row1 = str_replace("{VALUE_COD_IMPARTICION_FECHA}", "", $row1);
        $row1 = str_replace("{VALUE_COD_IMPARTICION_HORA_DESDE}", "", $row1);
        $row1 = str_replace("{VALUE_COD_IMPARTICION_HORA_HASTA}", "", $row1);
        $row1 = str_replace("{VALUE_COD_IMPARTICION_OBSERVACION}", "", $row1);
        $row1 = str_replace("{ID_IMPARTICION_ENC}", $i, $row1);
        $row1 = str_replace("{ID_PROGRAMA_ENC}", $idpbbdd, $row1);
        $row1 = str_replace("{ID_SESION}", "1", $row1);
        $row1 = str_replace("{ID_CURSO_ENC}", Encodear3($id_curso), $row1);
        $row1 = str_replace("{ID_IMPARTICION_ENC}", Encodear3($id_inscripcion), $row1);
        $row1 = str_replace("{OPTION_RELATOR_NOMBRE_TIPO}", $options_relatores, $row1);
        $row1 = str_replace("{RELATOR_SES}", $rut_relator, $row1);
        $row1 = str_replace("{RELATOR_nombre_SES}", "", $row1);
        //$tiempo_transcurrido=TiempoTranscurrido_2021($ses->hora_desde, $ses->hora_hasta);
        $row1 = str_replace("{NUMERO_HORAS_SESION}", "", $row1);


    }

    //echo "<h3>cuenta_sesiones $cuenta_sesiones</h3>";
    $nueva_sesion = $cuenta_sesiones + 1;
    $rowNew .= file_get_contents("views/capacitacion/imparticion/row_imparticion_por_sesion_new.html");
    $rowNew = str_replace("{ID_LINEA_ENC}", Encodear3($ses->id), $rowNew);
    $rowNew = str_replace("{VALUE_COD_IMPARTICION_FECHA}", $ses->fecha, $rowNew);
    $rowNew = str_replace("{VALUE_COD_IMPARTICION_HORA_DESDE}", $ses->hora_desde, $rowNew);
    $rowNew = str_replace("{VALUE_COD_IMPARTICION_HORA_HASTA}", $ses->hora_hasta, $rowNew);
    $rowNew = str_replace("{VALUE_COD_IMPARTICION_OBSERVACION}", $ses->observaciones, $rowNew);
    $rowNew = str_replace("{ID_IMPARTICION_ENC}", Encodear3($ses->id_inscripcion), $rowNew);
    $rowNew = str_replace("{ID_PROGRAMA_ENC}", "", $rowNew);
    $rowNew = str_replace("{ID_SESION}", $nueva_sesion, $rowNew);
    $rowNew = str_replace("{ID_SESION_NEW}", $nueva_sesion, $rowNew);
    $rowNew = str_replace("{ID_CURSO_ENC}", Encodear3($id_curso), $rowNew);
    $rowNew = str_replace("{ID_IMPARTICION_ENC}", Encodear3($id_inscripcion), $rowNew);
    $rowNew = str_replace("{DISPLAY_AGREGAR_MAS}", "", $rowNew);
    //echo "<br>-->options_relatores $options_relatores<br>";
    $rowNew = str_replace("{OPTION_RELATOR_NOMBRE_TIPO}", $options_relatores, $rowNew);
    $rowNew = str_replace("{RELATOR_SES}", "", $rowNew);
    $rowNew = str_replace("{RELATOR_nombre_SES}", "", $rowNew);
    //$tiempo_transcurrido=TiempoTranscurrido_2021($ses->hora_desde, $ses->hora_hasta);
    $rowNew = str_replace("{NUMERO_HORAS_SESION}", "", $rowNew);


    $PRINCIPAL = str_replace("{ID_IMPARTICION_ENC}", $i, $PRINCIPAL);
    $PRINCIPAL = str_replace("{ID_PROGRAMA_ENC}", $idpbbdd, $PRINCIPAL);

    $PRINCIPAL = str_replace("{FORMULARIO_HORARIOS_LINEA_1}", $row1, $PRINCIPAL);
    $PRINCIPAL = str_replace("{FORMULARIO_HORARIOS_LINEA_2}", $row2, $PRINCIPAL);
    $PRINCIPAL = str_replace("{FORMULARIO_HORARIOS_LINEA_3}", $row3, $PRINCIPAL);
    $PRINCIPAL = str_replace("{FORMULARIO_HORARIOS_LINEA_4}", $row4, $PRINCIPAL);
    $PRINCIPAL = str_replace("{FORMULARIO_HORARIOS_LINEA_5}", $row5, $PRINCIPAL);
    $PRINCIPAL = str_replace("{FORMULARIO_HORARIOS_LINEA_6}", $row6, $PRINCIPAL);
    $PRINCIPAL = str_replace("{FORMULARIO_HORARIOS_LINEA_7}", $row7, $PRINCIPAL);
    $PRINCIPAL = str_replace("{FORMULARIO_HORARIOS_LINEA_8}", $row8, $PRINCIPAL);
    $PRINCIPAL = str_replace("{FORMULARIO_HORARIOS_LINEA_9}", $row9, $PRINCIPAL);
    $PRINCIPAL = str_replace("{FORMULARIO_HORARIOS_LINEA_10}", $row10, $PRINCIPAL);
    $PRINCIPAL = str_replace("{FORMULARIO_HORARIOS_LINEA_11}", $row11, $PRINCIPAL);
    $PRINCIPAL = str_replace("{FORMULARIO_HORARIOS_LINEA_12}", $row12, $PRINCIPAL);

    $PRINCIPAL = str_replace("{FORMULARIO_HORARIOS_LINEA_AGREGAR_MAS}", $rowNew, $PRINCIPAL);


    $rowFiFTew .= file_get_contents("views/capacitacion/imparticion/row_imparticion_por_fecha_inicio_termino_new.html");
    $rowFiFTew = str_replace("{ID_LINEA_ENC}", Encodear3($ses->id), $rowFiFTew);
    $rowFiFTew = str_replace("{VALUE_COD_IMPARTICION_FECHA}", $ses->fecha, $rowFiFTew);
    $rowFiFTew = str_replace("{VALUE_COD_IMPARTICION_HORA_DESDE}", $ses->hora_desde, $rowFiFTew);
    $rowFiFTew = str_replace("{VALUE_COD_IMPARTICION_HORA_HASTA}", $ses->hora_hasta, $rowFiFTew);
    $rowFiFTew = str_replace("{VALUE_COD_IMPARTICION_OBSERVACION}", $ses->observaciones, $rowFiFTew);
    $rowFiFTew = str_replace("{ID_IMPARTICION_ENC}", Encodear3($ses->id_inscripcion), $rowFiFTew);
    $rowFiFTew = str_replace("{ID_PROGRAMA_ENC}", "", $rowFiFTew);
    $rowFiFTew = str_replace("{ID_SESION}", $nueva_sesion, $rowFiFTew);
    $rowFiFTew = str_replace("{ID_SESION_NEW}", $nueva_sesion, $rowFiFTew);
    $rowFiFTew = str_replace("{ID_CURSO_ENC}", Encodear3($id_curso), $rowFiFTew);
    $rowFiFTew = str_replace("{ID_IMPARTICION_ENC}", Encodear3($id_inscripcion), $rowFiFTew);
    $rowFiFTew = str_replace("{DISPLAY_AGREGAR_MAS}", "", $rowFiFTew);
    $rowFiFTew = str_replace("{OPTION_RELATOR_NOMBRE_TIPO}", $options_relatores, $rowFiFTew);

    $PRINCIPAL = str_replace("{FORMULARIO_HORARIOS_LINEA_FECHA_INICIO_TERMINO}", $rowFiFTew, $PRINCIPAL);

    $rowFiFTewELEARNING .= file_get_contents("views/capacitacion/imparticion/row_imparticion_por_fecha_inicio_termino_new_elearning.html");
    $rowFiFTewELEARNING = str_replace("{ID_LINEA_ENC}", Encodear3($ses->id), $rowFiFTewELEARNING);
    $rowFiFTewELEARNING = str_replace("{VALUE_COD_IMPARTICION_FECHA}", $ses->fecha, $rowFiFTewELEARNING);
    $rowFiFTewELEARNING = str_replace("{VALUE_COD_IMPARTICION_HORA_DESDE}", $ses->hora_desde, $rowFiFTewELEARNING);
    $rowFiFTewELEARNING = str_replace("{VALUE_COD_IMPARTICION_HORA_HASTA}", $ses->hora_hasta, $rowFiFTewELEARNING);
    $rowFiFTewELEARNING = str_replace("{VALUE_COD_IMPARTICION_OBSERVACION}", $ses->observaciones, $rowFiFTewELEARNING);
    $rowFiFTewELEARNING = str_replace("{ID_IMPARTICION_ENC}", Encodear3($ses->id_inscripcion), $rowFiFTewELEARNING);
    $rowFiFTewELEARNING = str_replace("{ID_PROGRAMA_ENC}", "", $rowFiFTewELEARNING);
    $rowFiFTewELEARNING = str_replace("{ID_SESION}", $nueva_sesion, $rowFiFTewELEARNING);
    $rowFiFTewELEARNING = str_replace("{ID_SESION_NEW}", $nueva_sesion, $rowFiFTewELEARNING);
    $rowFiFTewELEARNING = str_replace("{ID_CURSO_ENC}", Encodear3($id_curso), $rowFiFTewELEARNING);
    $rowFiFTewELEARNING = str_replace("{ID_IMPARTICION_ENC}", Encodear3($id_inscripcion), $rowFiFTewELEARNING);
    $rowFiFTewELEARNING = str_replace("{DISPLAY_AGREGAR_MAS}", "", $rowFiFTewELEARNING);


    $Elearning_opcional = BuscaOpcional_rel_lms_id_curso_id_inscripcion($id_inscripcion);
    //echo "<br>Elearning_opcional $Elearning_opcional";

    if ($Elearning_opcional == "1") {

        $rowFiFTewELEARNING = str_replace("{CHECKED_OPCIONAL}", " checked ", $rowFiFTewELEARNING);
        $rowFiFTewELEARNING = str_replace("{CHECKED_OBLIGATORIA}", "   ", $rowFiFTewELEARNING);

        $PRINCIPAL = str_replace("{SELECT_OPCIONAL}", " selected ", $PRINCIPAL);
        $PRINCIPAL = str_replace("{SELECT_OBLIGATORIA}", "  ", $PRINCIPAL);

    } else {

        $rowFiFTewELEARNING = str_replace("{CHECKED_OPCIONAL}", "  ", $rowFiFTewELEARNING);
        $rowFiFTewELEARNING = str_replace("{CHECKED_OBLIGATORIA}", " checked  ", $rowFiFTewELEARNING);
        $PRINCIPAL = str_replace("{SELECT_OPCIONAL}", " ", $PRINCIPAL);
        $PRINCIPAL = str_replace("{SELECT_OBLIGATORIA}", " selected ", $PRINCIPAL);


    }


    /*$ejecutivos=TraeEjecutivos2021($_SESSION["id_empresa"]);
    //print_r($ejecutivos);
    $options_ejecutivos="";
    foreach($ejecutivos as $ejec){
            $options_ejecutivos.='<option value="'.$ejec->rut.'" >'.$ejec->nombre.'</option>';
    }
    $rowFiFTewELEARNING = str_replace("{OPTIONS_EJECUTIVOS}",utf8_encode($options_ejecutivos),$rowFiFTewELEARNING);
		*/

    $PRINCIPAL = str_replace("{FORMULARIO_HORARIOS_LINEA_FECHA_INICIO_TERMINO_ELEARNING}", $rowFiFTewELEARNING, $PRINCIPAL);


    return ($PRINCIPAL);
}

function Dashboard_Training_IdImparticion_idCurso_MiRut($id_imparticion, $id_curso, $rut)
{


    $Num_Cursos_Pendientes = 0;
    $Num_Cursos_Aprobados = 0;
    $Num_Cursos_Reprobados = 0;
    $Num_Cursos_NoIniciado = 0;
    $Num_Cursos_Proceso = 0;
    $Num_Programas_Finalizados = 0;
    $Inscritos = Dashboard_Training_IdImparticion_idCurso_MiRut_data($id_imparticion, $id_curso, $rut);
    //print_r($Inscritos);

    //echo count($Inscritos);
    foreach ($Inscritos as $unico) {
        $cuenta_inscritos++;
        $Reporte = Dashboard_check_Lms_InscripcionCierre_data($id_imparticion, $id_curso, $unico->rut);
        //echo "<br>".$cuenta_inscritos." ".$unico->rut." - ".$Reporte[0]->estado_descripcion;

        //echo "<br>Estado ".$Reporte[0]->estado;
        if ($Reporte[0]->estado_descripcion == "NO_INICIADO" or $Reporte[0]->estado_descripcion == "") {
            $Num_Cursos_NoIniciado++;
        }
        if ($Reporte[0]->estado_descripcion == "EN_PROCESO") {
            $Num_Cursos_Proceso++;
        }
        if ($Reporte[0]->estado_descripcion == "APROBADO") {
            $Num_Cursos_Aprobados++;
        }

        //echo  $Num_Cursos_Aprobados;

        if ($Reporte[0]->estado_descripcion == "REPROBADO" or $Reporte[0]->estado_descripcion == "REPROBADO_INASISTENCIA" or $Reporte[0]->estado_descripcion == "REPROBADO_POR_INASISTENCIA") {
            $Num_Cursos_Reprobados++;
        }
    }


    $suma_cursos = $Num_Cursos_NoIniciado + $Num_Cursos_Proceso + $Num_Cursos_Aprobados + $Num_Cursos_Reprobados;
    $Num_Cursos_Pendientes = $Num_Cursos_NoIniciado + $Num_Cursos_Proceso;
    $Num_Curso_Finalizados = $Num_Cursos_Aprobados + $Num_Cursos_Reprobados;

    /* echo "<br><br>--> Num_Cursos_Pendientes $Num_Cursos_Pendientes, Num_Cursos_Aprobados $Num_Cursos_Aprobados, Num_Cursos_Reprobados $Num_Cursos_Reprobados<br>
	    					suma cursos $suma_cursos<br>";*/


    //echo "<h3>Estado Programa ".$Estado_Programa."</h3><h4>suma_cursos $suma_cursos </h4>";


    //echo "<br>- Num Total ".count($Prog)." aprobados $Num_Programas_Aprobados, reprobados $Num_Programas_Reprobados, pendientes $Num_Programas_Pendientes";
    $row_dash_equipo_directo .= file_get_contents("views/dashboard_equipo_training/row_dashboard_equipo_directo.html");

    $avance_finalizados = round(100 * $Num_Curso_Finalizados / ($suma_cursos));
    $avance_aprobados = round(100 * $Num_Cursos_Aprobados / ($suma_cursos));
    $avance_reprobados = round(100 * $Num_Cursos_Reprobados / ($suma_cursos));
    $avance_enproceso = round(100 * $Num_Cursos_Proceso / ($suma_cursos));
    $avance_noiniciados = round(100 * $Num_Cursos_NoIniciado / ($suma_cursos));
    $avance_pendientes = round(100 * $Num_Cursos_Pendientes / ($suma_cursos));

    /* echo "<br>avance_finalizados $avance_finalizados,
				avance_aprobados $avance_aprobados,
				avance_reprobados $avance_reprobados,
				avance_enproceso $avance_enproceso,
				avance_noiniciados $avance_noiniciados,
				avance_pendientes $avance_pendientes";

				echo "<br><br>finalizados $Num_Programas_Finalizados,
				aprobados $Num_Programas_Aprobados,
				reprobados $Num_Programas_Reprobados,
				enproceso $Num_Programas_Proceso,
				noiniciados $Num_Programas_NoIniciado,
				Pendientes $avance_pendientes";	*/

    $arreglo[0] = round($avance_finalizados);
    $arreglo[1] = round($avance_aprobados);
    $arreglo[2] = round($avance_reprobados);
    $arreglo[3] = round($avance_enproceso);
    $arreglo[4] = round($avance_noiniciados);
    $arreglo[5] = round($avance_pendientes);

    $arreglo[10] = round($Num_Curso_Finalizados);
    $arreglo[11] = round($Num_Cursos_Aprobados);
    $arreglo[12] = round($Num_Cursos_Reprobados);
    $arreglo[13] = round($Num_Cursos_Proceso);
    $arreglo[14] = round($Num_Cursos_NoIniciado);
    $arreglo[15] = round($Num_Cursos_Pendientes);
    $arreglo[16] = count($Inscritos);

    return $arreglo;

}

function VeReportesXImp2021_fn($PRINCIPAL, $id_imparticion, $id_curso, $rut)
{
    //echo "<br>VeReportes $id_imparticion, $id_curso, $rut<br>";exit();
    $row .= file_get_contents("views/capacitacion/reportes/dashboard.html");
    $row = str_replace("{FECHA_SESION}", ($ses->fecha), $row);
    $row = str_replace("{ID_IMPARTICION_ENC}", ($_GET["i"]), $row);

    $Resultados_Tu_Avance = Dashboard_Training_IdImparticion_idCurso_MiRut($id_imparticion, $id_curso, $rut);
    //print_r($Resultados_Tu_Avance);
    $row = str_replace("{NUM_FINALIZADOS}", $Resultados_Tu_Avance[0], $row);
    $row = str_replace("{NUM_EN_PROCESO}", $Resultados_Tu_Avance[3], $row);
    $row = str_replace("{NUM_NO_INICIADOS}", $Resultados_Tu_Avance[4], $row);
    $row = str_replace("{NUM_APROBADOS}", $Resultados_Tu_Avance[1], $row);
    $row = str_replace("{NUM_REPROBADOS}", $Resultados_Tu_Avance[2], $row);
    $row = str_replace("{NUM_FINALIZADOS_TXT}", $Resultados_Tu_Avance[10], $row);
    $row = str_replace("{NUM_EN_PROCESO_TXT}", $Resultados_Tu_Avance[13], $row);
    $row = str_replace("{NUM_NO_INICIADOS_TXT}", $Resultados_Tu_Avance[14], $row);
    $row = str_replace("{NUM_APROBADOS_TXT}", $Resultados_Tu_Avance[11], $row);
    $row = str_replace("{NUM_REPROBADOS_TXT}", $Resultados_Tu_Avance[12], $row);
    $row = str_replace("{NUM_INSCRITOS_TXT}", $Resultados_Tu_Avance[16], $row);

    $datos_imparticion_V2 = DatosInscripcionImparticionesV2($id_imparticion, $_SESSION["id_empresa"]);
    //echo "id_imparticion $id_imparticion";print_r($datos_imparticion_V2);

    $row_excel_enc_sat .= "id_curso;curso;id_imparticion;fecha_inicio;fecha_termino\r\n";
    $row_excel_enc_sat .= ""
        . $datos_imparticion_V2[0]->id_curso . ";"
        . $datos_imparticion_V2[0]->nombre_curso . ";"
        . $datos_imparticion_V2[0]->codigo_inscripcion . ";"
        . $datos_imparticion_V2[0]->fecha_inicio . ";"
        . $datos_imparticion_V2[0]->fecha_termino . "\r\n";

    $EncSat = EncuestaSatisfaccion_IdImparticionIdCurso_data($id_imparticion, $id_curso);
    $cuenta = count($EncSat);

    $row_excel_enc_sat .= "\r\n";
    $row_excel_enc_sat .= "encuestas respondidas;$cuenta\r\n";
    $row_excel_enc_sat .= "\r\n";

    //echo "<br>encuestas_contestadas ".$cuenta;
    $Preg = EncuestaSatisfaccion_BuscaPreguntas($EncSat[0]->id_encuesta);
    $row_encuesta_satisfaccion_pregunta .= "
							<div class='row'>
									<div class='col-lg-6'>
										<div class='card text-white bg-primary  text-dark mb-3' style='max-width: 100%'>
										  <div class='card-header  text-center font_18px mg_20topbottom' style='text-align: left !important;'>
										  	Pregunta
										  </div>
										</div>
									</div>
									<div class='col-lg-6'>
											<div class='row'>
												<div class='col-lg-2' style='color: #0d6efd;'><br>Calificaci&oacute;n</div>
												<div class='col-lg-2' style='color: #0d6efd;'><br>Cantidad</div>
												<div class='col-lg-2' style='color: #0d6efd;'><br>Porcentaje</div>
											</div>
									</div>
									<div class='col-lg-12'><hr></div>
						</div>";

    $row_excel_enc_sat .= "pregunta;cantidad1;porcentaje1;cantidad2;porcentaje2;cantidad3;porcentaje3;cantidad4;porcentaje5;cantidad5;porcentaje5\r\n";
    foreach ($Preg as $unico) {
        //Respuestas por Pregunta
        $Resp = EncuestaSatisfaccion_BuscaRespuestas($EncSat[0]->id_encuesta, $unico->id_pregunta, $id_imparticion, $id_curso);
        $cuenta1 = 0;
        $cuenta2 = 0;
        $cuenta3 = 0;
        $cuenta4 = 0;
        $cuenta5 = 0;
        $cuenta_todas = 0;
        foreach ($Resp as $unicoR) {
            if ($unicoR->respuesta == "1") {
                $cuenta1++;
            }
            if ($unicoR->respuesta == "2") {
                $cuenta2++;
            }
            if ($unicoR->respuesta == "3") {
                $cuenta3++;
            }
            if ($unicoR->respuesta == "4") {
                $cuenta4++;
            }
            if ($unicoR->respuesta == "5") {
                $cuenta5++;
            }
            $cuenta_todas++;
            $porc_1 = round(100 * $cuenta1 / $cuenta_todas);
            $porc_2 = round(100 * $cuenta2 / $cuenta_todas);
            $porc_3 = round(100 * $cuenta3 / $cuenta_todas);
            $porc_4 = round(100 * $cuenta4 / $cuenta_todas);
            $porc_5 = round(100 * $cuenta5 / $cuenta_todas);
        }


        $respuestas = "
							<div class='row'>
								<div class='col-lg-2'>1</div>
								<div class='col-lg-2'>" . $cuenta1 . "</div>
								<div class='col-lg-2'>" . $porc_1 . "%</div>
								<div class='col-lg-6'> <div class='progress' style='height: 13px;'><div class='progress-bar' role='progressbar' style='width: " . $porc_1 . "%' aria-valuenow='" . $porc_1 . "' aria-valuemin='0' aria-valuemax='100'></div></div></div>
							</div>
							<div class='row'>
								<div class='col-lg-2'>2</div>
								<div class='col-lg-2'>" . $cuenta2 . "</div>
								<div class='col-lg-2'>" . $porc_2 . "%</div>
								<div class='col-lg-6'> <div class='progress' style='height: 13px;'><div class='progress-bar' role='progressbar' style='width: " . $porc_2 . "%' aria-valuenow='" . $porc_2 . "' aria-valuemin='0' aria-valuemax='100'></div></div></div>
							</div>
							<div class='row'>
								<div class='col-lg-2'>3</div>
								<div class='col-lg-2'>" . $cuenta3 . "</div>
								<div class='col-lg-2'>" . $porc_3 . "%</div>
								<div class='col-lg-6'> <div class='progress' style='height: 13px;'><div class='progress-bar' role='progressbar' style='width: " . $porc_3 . "%' aria-valuenow='" . $porc_3 . "' aria-valuemin='0' aria-valuemax='100'></div></div></div>
							</div>
							<div class='row'>
								<div class='col-lg-2'>4</div>
								<div class='col-lg-2'>" . $cuenta4 . "</div>
								<div class='col-lg-2'>" . $porc_4 . "%</div>
								<div class='col-lg-6'> <div class='progress' style='height: 13px;'><div class='progress-bar' role='progressbar' style='width: " . $porc_4 . "%' aria-valuenow='" . $porc_4 . "' aria-valuemin='0' aria-valuemax='100'></div></div></div>
							</div>
							<div class='row'>
								<div class='col-lg-2'>5</div>
								<div class='col-lg-2'>" . $cuenta5 . "</div>
								<div class='col-lg-2'>" . $porc_5 . "%</div>
								<div class='col-lg-6'> <div class='progress' style='height: 13px;'><div class='progress-bar' role='progressbar' style='width: " . $porc_5 . "%' aria-valuenow='" . $porc_5 . "' aria-valuemin='0' aria-valuemax='100'></div></div></div>
							</div>";
        $row_encuesta_satisfaccion_pregunta .= "
							<div class='row'>
									<div class='col-lg-6'>
										<div class='card text-white bg-primary  text-dark mb-3' style='max-width: 100%'>
										  <div class='card-header  text-center font_18px mg_20topbottom' style='text-align: left !important;height: 110px;'>
										  	" . utf8_encode($unico->pregunta) . "
										  </div>
										</div>
									</div>
									<div class='col-lg-6'>
										" . $respuestas . "
									</div>
									<div class='col-lg-12'><hr></div>
						</div>";

        $row_excel_enc_sat .= "" . $unico->pregunta . ";" . $cuenta1 . ";" . $porc_1 . "%;" . $cuenta2 . ";" . $porc_2 . "%;" . $cuenta3 . ";" . $porc_3 . "%;" . $cuenta4 . ";" . $porc_4 . "%;" . $cuenta5 . ";" . $porc_5 . "%\r\n";

    }
    $Com = EncuestaSatisfaccion_BuscaComentarios($EncSat[0]->id_encuesta, $id_imparticion, $id_curso);
    $row_encuesta_satisfaccion_pregunta .= "
							<div class='row'>
									<div class='col-lg-12'>
										<div class='card text-white bg-primary  text-dark mb-3' style='max-width: 100%'>
										  <div class='card-header  text-center font_18px mg_20topbottom' style='text-align: left !important;'>
										  	Comentarios
										  </div>
										</div>
									</div>
						</div>";
    $row_excel_enc_sat .= "\r\n";
    $row_excel_enc_sat .= "Comentarios\r\n";
    foreach ($Com as $unicoC) {
        $row_encuesta_satisfaccion_pregunta .= "
								<div class='row'>
										<div class='col-lg-12'>
											<div class='' style='max-width: 100%;     padding: 15px;'>
											  <div class='' style='text-align: left !important;'>
											  	" . utf8_encode($unicoC->comentario) . "
											  </div>
											</div>
										</div>
							</div>";

        $row_excel_enc_sat .= "" . $unicoC->comentario . "\r\n";

    }
    $row = str_replace("{NUM_ENCUESTAS_RESPONDIDAS}", $cuenta, $row);
    $row = str_replace("{LISTA_PREGUNTAS_ENC_SATISFACCION}", $row_encuesta_satisfaccion_pregunta, $row);
    $PRINCIPAL = str_replace("{DASHBOARD_REPORTES_2021}", $row, $PRINCIPAL);

    if ($_GET["excel"] == "2") {
        // EXCEL ENCUESTA SATISFACCION
        header('Content-Description: File Transfer');
        header('Content-Type: application/csv');
        header("Content-Disposition: attachment; filename=Encuesta_Satisfaccion_Curso_" . $datos_imparticion_V2[0]->nombre_curso . "_ID_Imparticion_" . $codigo_inscripcion . ".csv");
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');

        echo $row_excel_enc_sat;
        exit();
    }


    return ($PRINCIPAL);
}

// CREACION DE CURSOS PRESENCIALES

function FormularioCurso1($PRINCIPAL, $id_curso, $id_empresa)
{

    //echo "FormularioCurso2 id_curso $id_curso";
    $datos_curso = DatosCurso_2($id_curso);
    //print_r($datos_curso);
    if ($datos_curso) {
        $id_curso = $datos_curso[0]->id;
    } else {
        $idNuevo = ListasPresenciales_CodigoIdCurso($id_empresa);
        $id_curso = $idNuevo;
    }


    $PRINCIPAL = str_replace("{NOM_CURSO}", utf8_encode($datos_curso[0]->nombre), $PRINCIPAL);
    $PRINCIPAL = str_replace("{NOMBRE_CURSO_SENCE}", utf8_encode($datos_curso[0]->nombre_curso_sence), $PRINCIPAL);
    $PRINCIPAL = str_replace("{COD_CURSO}", $id_curso, $PRINCIPAL);
    $PRINCIPAL = str_replace("{DES_CURSO}", utf8_encode($datos_curso[0]->descripcion), $PRINCIPAL);
    $PRINCIPAL = str_replace("{OBJETIVO_CURSO}", utf8_encode($datos_curso[0]->objetivo_curso), $PRINCIPAL);
    $PRINCIPAL = str_replace("{NUMERO_HORAS}", utf8_encode($datos_curso[0]->numero_horas), $PRINCIPAL);
    $PRINCIPAL = str_replace("{CANTIDAD_MAXIMA_PARTICIPANTES}", utf8_encode($datos_curso[0]->cantidad_maxima_participantes), $PRINCIPAL);
    $PRINCIPAL = str_replace("{TIPO_CURSO}", utf8_encode($datos_curso[0]->tipo), $PRINCIPAL);
    $PRINCIPAL = str_replace("{CHECKED" . $datos_curso[0]->sence . "}", "checked", $PRINCIPAL);
    $PRINCIPAL = str_replace("{CHECKED" . $datos_curso[0]->cbc . "CBC}", "checked", $PRINCIPAL);
    $PRINCIPAL = str_replace("{PREREQUISITO_CURSO}", utf8_encode($datos_curso[0]->prerequisito), $PRINCIPAL);
    $PRINCIPAL = str_replace("{COD_SENCE}", utf8_encode($datos_curso[0]->cod_sence), $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALOR_HORA}", utf8_encode($datos_curso[0]->valor_hora), $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALOR_HORA_SENCE}", utf8_encode($datos_curso[0]->valor_hora_sence), $PRINCIPAL);
    $PRINCIPAL = str_replace("{COD_IDENTIFICADOR}", utf8_encode($datos_curso[0]->numero_identificador), $PRINCIPAL);
    $PRINCIPAL = str_replace("{NUMERO_IDENTIFICADOR}", utf8_encode($datos_curso[0]->numero_identificador), $PRINCIPAL);
    $PRINCIPAL = str_replace("{CONTENIDOS_CURSO}", utf8_encode($datos_curso[0]->contenidos_cursos), $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALUE_COD_SENCE}", utf8_encode($datos_curso[0]->codigosence), $PRINCIPAL);

    if (utf8_encode($datos_curso[0]->imagen)) {
        $PRINCIPAL = str_replace("{BLOQUE_IMAGEN}", file_get_contents("views/capacitacion/curso/bloque_imagen_curso.html"), $PRINCIPAL);
        $PRINCIPAL = str_replace("{URL_IMAGEN}", "" . utf8_encode($datos_curso[0]->imagen), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BLOQUE_IMAGEN}", "", $PRINCIPAL);
    }

    $PRINCIPAL = str_replace("{SELECTED_" . $datos_curso[0]->sence . "}", "selected='selected'", $PRINCIPAL);
    if ($datos_curso) {
        $PRINCIPAL = str_replace("{VALOR_BOTON}", "Editar Curso", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ACTION}", "?sw=edcurso1", $PRINCIPAL);
        $PRINCIPAL = str_replace("{TITULO}", "Formulario Edici&oacute;n de Cursos", $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{VALOR_BOTON}", "Ingresar Curso", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ACTION}", "?sw=adcurso1", $PRINCIPAL);
        $PRINCIPAL = str_replace("{TITULO}", "Formulario Ingreso de Cursos", $PRINCIPAL);
    }
    $PRINCIPAL = str_replace("{NOMBRE_FORMULARIO}", "FormCurso", $PRINCIPAL);
    $PRINCIPAL = str_replace("{OPTIONS_MODALIDAD}", OptionsModalidad($datos_curso[0]->modalidad), $PRINCIPAL);
    $clasificacion = TotalClasificacion($id_empresa);
    foreach ($clasificacion as $cla) {
        if ($cla->id_clasificacion == $datos_curso[0]->clasificacion) {
            $select = "selected='selected'";
        } else {
            $select = "";
        }
        $opcionClasificacion .= '<option value=' . $cla->id_clasificacion . ' ' . $select . ' >' . utf8_encode($cla->clasificacion) . '</option>';
    }
    $otecs = TraeOtec($id_empresa);
    foreach ($otecs as $otec) {
        if ($cla->rut == $datos_curso[0]->rut_otec) {
            $select2 = "selected";
        } else {
            $select2 = "";
        }
        $opcionOtect .= '<option value=' . $otec->rut . ' ' . $select2 . ' >' . utf8_encode($otec->nombre) . ' (' . utf8_encode($otec->rut) . ')</option>';
    }
    $PRINCIPAL = str_replace("{OPTIONS_CLASIFICACION}", $opcionClasificacion, $PRINCIPAL);
    $focos = ListasPresenciales_Obtienefocos($id_empresa);
    $options_focos = "";
    foreach ($focos as $foc) {
        if ($foc->codigo_foco == $datos_curso[0]->id_foco) {
            $options_focos .= "<option value='" . $foc->codigo_foco . "' selected='selected'>" . $foc->descripcion . "</option>";
        } else {
            $options_focos .= "<option value='" . $foc->codigo_foco . "'>" . $foc->descripcion . "</option>";
        }
    }
    $PRINCIPAL = str_replace("{OPTIONS_FOCOS}", utf8_encode($options_focos), $PRINCIPAL);
    //$programas_bbdd=IMPARTCION_ObtieneProgramasBBDD($id_empresa);
    $programas_bbdd = ListaProgramasDadoFocoDeTabla($id_empresa, $datos_curso[0]->id_foco);

    $options_programas_bbdd = "";
    foreach ($programas_bbdd as $prog_bbdd) {
        if ($prog_bbdd->id_programa == $datos_curso[0]->id_empresa_programa) {
            $options_programas_bbdd .= "<option value='" . $prog_bbdd->id_programa . "' selected='selected'>" . $prog_bbdd->nombre_programa . "</option>";
        } else {
            $options_programas_bbdd .= "<option value='" . $prog_bbdd->id_programa . "'>" . $prog_bbdd->nombre_programa . "</option>";
        }
    }
    $PRINCIPAL = str_replace("{OPTIONS_PROGRAMAS_BBDD}", utf8_encode($options_programas_bbdd), $PRINCIPAL);
    $PRINCIPAL = str_replace("{OPTIONS_RUT_OTEC}", $opcionOtect, $PRINCIPAL);
    $PRINCIPAL = str_replace("{ID_CURSO_ENCODEADO}", Encodear(Encodear($datos_curso[0]->id)), $PRINCIPAL);
    $PRINCIPAL = str_replace("{OPTIONS_TIPO_CURSO}", Lista_OptionsGenericoNombreDadoValores("tbl_curso_tipo", $datos_curso[0]->tipo, "nombre", "id"), $PRINCIPAL);
    $PRINCIPAL = str_replace("{SELSENCE" . trim($datos_curso[0]->sence) . "}", "selected='selected'", $PRINCIPAL);
    $PRINCIPAL = str_replace("{SELCBC" . trim($datos_curso[0]->cbc) . "}", "selected='selected'", $PRINCIPAL);
    if ($datos_curso[0]->sence == "si") {
        $PRINCIPAL = str_replace("{STYLE_DISPLAY_COD_SENCE}", '', $PRINCIPAL);
        $PRINCIPAL = str_replace("{STYLE_DISPLAY_NUM_IDEN}", 'style="display:none;"', $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{STYLE_DISPLAY_COD_SENCE}", 'style="display:none;"', $PRINCIPAL);
        $PRINCIPAL = str_replace("{STYLE_DISPLAY_NUM_IDEN}", '', $PRINCIPAL);
    }
    return ($PRINCIPAL);
}

function ListadoMallasAdmin1($PRINCIPAL, $id_empresa, $excel, $id_curso, $llamada)
{
    //echo "$id_empresa, excel $excel, $id_curso, $llamada";
    $mallas = Listado_TotalMallas1($id_empresa, $id_curso, $llamada);
    $total_html = "";
    //echo "<br><pre>";    print_r($mallas);    echo "</pre>";

    $i = 1;
    foreach ($mallas as $unico) {

        if ($excel == 1) {
            $row = file_get_contents("views/capacitacion/curso/row_listado_excel.html");
        } else if ($llamada == "imparticion_solo_preenciales") {
            $row = file_get_contents("views/capacitacion/curso/row_listado_imparticion.html");
        } else {
            $row = file_get_contents("views/capacitacion/curso/row_listado1_mallas.html");
        }

        $row = str_replace("{NUMERO}", $i, $row);
        $i++;
        $row = str_replace("{CODIGO}", "<span class='label bg-blue'>" . $unico->numero_identificador . "</span>", $row);
        $row = str_replace("{CODIGO_CURSO}", "<span class='label bg-blue'>" . $unico->id . "</span>", $row);



        $row = str_replace("{ID_MALLA}", $unico->id_malla, $row);
        $row = str_replace("{NOMBRE_MALLA}", $unico->nombre_malla, $row);
        $row = str_replace("{ID_PROGRAMA_ENC}", Encodear3($unico->id_programa), $row);


        $row = str_replace("{ID_MALLA_ENCODEADO}", Encodear3($unico->id_malla), $row);
        $row = str_replace("{NOMBRE}", $unico->nombre, $row);
        $row = str_replace("{NOMBRE_XLS}", ($unico->nombre), $row);
        $row = str_replace("{FOCO}", $unico->nombre_foco, $row);
        $row = str_replace("{FOCO_XLS}", ($unico->nombre_foco), $row);
        $busca_imparticiones_array = BuscaIdImparticiondadoMalla($unico->id_malla, $id_empresa);
        if (count($busca_imparticiones_array) > 0) {
            $row = str_replace("{EJECUTIVO}", $unico->ejecutivo, $row);
        } else {
            $row = str_replace("{EJECUTIVO}", "<small></small>", $row);
        }
        $row = str_replace("{EJECUTIVO_XLS}", ($unico->ejecutivo), $row);
        $row = str_replace("{PROGRAMA}", $unico->nombre_programa, $row);
        $row = str_replace("{PROGRAMA_XLS}", ($unico->nombre_programa), $row);
        $row = str_replace("{DESCRIPCION}", $unico->descripcion, $row);
        $row = str_replace("{OBJETIVO_CURSO}", $unico->objetivo_curso, $row);
        $row = str_replace("{CLASIFICACION}", $unico->nombre_clasificacion, $row);
        //$row = str_replace("{NUM_IMPARTICIONES}",$unico->total_inscripciones_curso,$row);
        //print_r($busca_imparticion_array);
        $lista_imparticion = "";
        $lista_imparticion_xls = "";
        $suma_asistentes = 0;
        $cuentaimp = 0;
        foreach ($busca_imparticiones_array as $buscimpart) {
            $cuentaimp++;
            $lista_imparticion .= $buscimpart->codigo_inscripcion . "<br>";
            $lista_imparticion_xls .= $buscimpart->codigo_inscripcion . ",";
            $cuenta_Asistententes = BuscaAsistentesImparticion($buscimpart->codigo_inscripcion, $id_empresa);
            $suma_asistentes = $suma_asistentes + $cuenta_Asistententes[0]->asistentes;
            //print_r($cuenta_Asistententes);
        }
        if ($cuentaimp == 0) {
            $lista_imparticion = "<small>[SIN_IMPARTICIONES]</small><br>";
        }
        //cuentaparticipantes
        //$cuenta_Asistententes=BuscaAsistentesCursoImparticion($unico->id, $id_empresa);
        $Asistententes = $cuenta_Asistententes[0]->asistentes;
        $row = str_replace("{NUM_IMPARTICIONES}", $lista_imparticion, $row);
        $row = str_replace("{NUM_IMPARTICIONES_XLS}", $lista_imparticion_xls, $row);
        if ($cuentaimp > 0) {
            $boton_ver = "<a href='?sw=listaInscripcionesMallas1&i=" . Encodear3($unico->id_malla) . "'  data-placement='left' title='Ver_Imparticiones'>Ver_Imparticiones (".$cuentaimp.")</a><br>";
        } else {
            $boton_ver = "";
        }
        $row = str_replace("{VER_IMPARTICIONES}", $boton_ver, $row);
        $row = str_replace("{SENCE}", $unico->sence, $row);
        $row = str_replace("{PARTICIPANTES_MAX}", $unico->cantidad_maxima_participantes, $row);
        $row = str_replace("{OTEC}", $unico->nombre_otec, $row);
        $row = str_replace("{CBC}", $unico->cbc, $row);
        $row = str_replace("{MODALIDAD}", "<span class='label bg-blue'>" . $unico->nombre_modalidad . "</span>", $row);
        //$row = str_replace("{TIPO}",$unico->tipo,$row);
        $row = str_replace("{TIPO}", $unico->nombre_tipo_curso, $row);
        $row = str_replace("{PREREQUISITOS}", $unico->prerequisito, $row);

        $preinscritos = "";
        $postulantes = "";
        $asistentes = "";

        $inscritos=BuscaIdImparticiondadoMallaCuentaInscritos($unico->id_malla, $id_empresa);

        $row = str_replace("{INSCRITOS}", $inscritos, $row);
        $row = str_replace("{PREINSCRITOS}", $preinscritos, $row);
        $row = str_replace("{POSTULANTES}", $postulantes, $row);
        $row = str_replace("{ASISTENTES}", $asistentes, $row);
        $row = str_replace("{NUM_INSCRITOS}", $unico->inscritos, $row);
        $row = str_replace("{NUM_PREINSCRITOS}", $unico->preinscritos, $row);
        $row = str_replace("{NUM_POSTULANTES}", $unico->postulantes, $row);
        $row = str_replace("{NUM_ASISTENTES}", $Asistententes, $row);

        //Por cada curso, traigl el total de programas asociados desde rel lms malla curso
        $programas = TraeProgramasUnicosDadoCursoDeRelMallaCurso($id_empresa, $unico->id);
        $acumulador_programas = "";
        foreach ($programas as $prog) {
            $acumulador_programas .= $prog->nombre_programa . "<br>";
        }
        $row = str_replace("{PROGRAMAS_ASOCIADOS}", $acumulador_programas, $row);
        $row = str_replace("{PROGRAMA_BBDD_ENCODEADO}", Encodear3($programas[0]->id_programa), $row);
        $row = str_replace("{VALOR_HORA}", colocarPesos($unico->valor_hora), $row);
        if ($unico->imagen && file_exists("../front/img/logos_cursos/" . $unico->imagen)) {
            $row = str_replace("{IMAGEN}", "<img src='../front/img/logos_cursos/" . $unico->imagen . "' width='50' >", $row);
        } else {
            $row = str_replace("{IMAGEN}", "", $row);
        }
        $row = str_replace("{VALOR_HORA_SENCE}", colocarPesos($unico->valor_hora_sence), $row);
        $row = str_replace("{NUM_HORAS}", $unico->numero_horas, $row);
        $row = str_replace("{VALOR_CURSO}", colocarPesos($unico->numero_horas * $unico->valor_hora), $row);
        $row = str_replace("{EJECUTIVO}", ($unico->ejecutivocapacitacion), $row);
        $row = str_replace("{PARTICIPANTE}", ($unico->participantes), $row);
        $row = str_replace("{VALOR_CURSO}", colocarPesos($unico->numero_horas * $unico->valor_hora), $row);
        $row = str_replace("{FECHAI}", ($unico->fecha_inicio), $row);
        $row = str_replace("{FECHAT}", ($unico->fecha_finalizacion), $row);
        $total_html .= $row;
    }
    $PRINCIPAL = str_replace("{ROW_LISTADO}", utf8_encode($total_html), $PRINCIPAL);
    $PRINCIPAL = str_replace("{ROW_LISTADO_xls}", ($total_html), $PRINCIPAL);
    return ($PRINCIPAL);
}

function ListadoCursosAdmin1($PRINCIPAL, $id_empresa, $excel, $id_curso, $llamada)
{
    //echo "$id_empresa, excel $excel, $id_curso, $llamada";
    $cursos = Listado_TotalCursos1($id_empresa, $id_curso, $llamada);
    $total_html = "";
    //print_r($cursos);

    $i = 1;
    foreach ($cursos as $unico) {

        if ($excel == 1) {
            $row = file_get_contents("views/capacitacion/curso/row_listado_excel.html");
        } else if ($llamada == "imparticion_solo_preenciales") {
            $row = file_get_contents("views/capacitacion/curso/row_listado_imparticion.html");
        } else {
            $row = file_get_contents("views/capacitacion/curso/row_listado1.html");
        }

        $row = str_replace("{NUMERO}", $i, $row);
        $i++;
        $row = str_replace("{CODIGO}", "<span class='label bg-blue'>" . $unico->numero_identificador . "</span>", $row);
        $row = str_replace("{CODIGO_CURSO}", "<span class='label bg-blue'>" . $unico->id . "</span>", $row);
        $row = str_replace("{CODIGO_ENCODEADO}", Encodear3($unico->id), $row);
        $row = str_replace("{NOMBRE}", $unico->nombre, $row);
        $row = str_replace("{NOMBRE_XLS}", ($unico->nombre), $row);
        $row = str_replace("{FOCO}", $unico->nombre_foco, $row);
        $row = str_replace("{FOCO_XLS}", ($unico->nombre_foco), $row);
        $busca_imparticiones_array = BuscaIdImparticiondadoCurso($unico->id, $id_empresa);
        if (count($busca_imparticiones_array) > 0) {
            $row = str_replace("{EJECUTIVO}", $unico->ejecutivo, $row);
        } else {
            $row = str_replace("{EJECUTIVO}", "<small></small>", $row);
        }
        $row = str_replace("{EJECUTIVO_XLS}", ($unico->ejecutivo), $row);
        $row = str_replace("{PROGRAMA}", $unico->nombre_programa, $row);
        $row = str_replace("{PROGRAMA_XLS}", ($unico->nombre_programa), $row);
        $row = str_replace("{DESCRIPCION}", $unico->descripcion, $row);
        $row = str_replace("{OBJETIVO_CURSO}", $unico->objetivo_curso, $row);
        $row = str_replace("{CLASIFICACION}", $unico->nombre_clasificacion, $row);
        //$row = str_replace("{NUM_IMPARTICIONES}",$unico->total_inscripciones_curso,$row);
        //print_r($busca_imparticion_array);
        $lista_imparticion = "";
        $lista_imparticion_xls = "";
        $suma_asistentes = 0;
        $cuentaimp = 0;
        foreach ($busca_imparticiones_array as $buscimpart) {
            $cuentaimp++;
            $lista_imparticion .= $buscimpart->codigo_inscripcion . "<br>";
            $lista_imparticion_xls .= $buscimpart->codigo_inscripcion . ",";
            $cuenta_Asistententes = BuscaAsistentesImparticion($buscimpart->codigo_inscripcion, $id_empresa);
            $suma_asistentes = $suma_asistentes + $cuenta_Asistententes[0]->asistentes;
            //print_r($cuenta_Asistententes);
        }
        if ($cuentaimp == 0) {
            $lista_imparticion = "<small>[SIN_IMPARTICIONES]</small><br>";
        }
        //cuentaparticipantes
        //$cuenta_Asistententes=BuscaAsistentesCursoImparticion($unico->id, $id_empresa);
        $Asistententes = $cuenta_Asistententes[0]->asistentes;
        $row = str_replace("{NUM_IMPARTICIONES}", $lista_imparticion, $row);
        $row = str_replace("{NUM_IMPARTICIONES_XLS}", $lista_imparticion_xls, $row);
        if ($cuentaimp > 0) {
            $boton_ver = "<a href='?sw=listaInscripciones1&i=" . Encodear3($unico->id) . "'  data-placement='left' title='Ver_Imparticiones'>Ver_Imparticiones</a><br>";
        } else {
            $boton_ver = "";
        }
        $row = str_replace("{VER_IMPARTICIONES}", $boton_ver, $row);
        $row = str_replace("{SENCE}", $unico->sence, $row);
        $row = str_replace("{PARTICIPANTES_MAX}", $unico->cantidad_maxima_participantes, $row);
        $row = str_replace("{OTEC}", $unico->nombre_otec, $row);
        $row = str_replace("{CBC}", $unico->cbc, $row);
        $row = str_replace("{MODALIDAD}", "<span class='label bg-blue'>" . $unico->nombre_modalidad . "</span>", $row);
        //$row = str_replace("{TIPO}",$unico->tipo,$row);
        $row = str_replace("{TIPO}", $unico->nombre_tipo_curso, $row);
        $row = str_replace("{PREREQUISITOS}", $unico->prerequisito, $row);

        $preinscritos = "";
        $postulantes = "";
        $asistentes = "";
        if ($unico->total_inscripciones_curso == 0) {
            $inscritos = "<strong>0</strong> Inscritos";
            if ($unico->nombre_modalidad == "Presencial") {
                $preinscritos = "<br><strong>0</strong> Preinscritos";
                $postulantes = "<br><strong>0</strong> Postulantes";
            }
        } else {
            $inscritos = "<strong>" . $unico->inscritos . "</strong> Inscritos";
            if ($unico->nombre_modalidad == "Presencial") {
                if ($unico->preinscritos > 0) {
                    $preinscritos = "<br><strong>" . $unico->preinscritos . "</strong> Preinscritos";
                } else {
                    $preinscritos = "<br><strong>0</strong> Preinscritos";
                }
                if ($unico->postulantes > 0) {
                    $postulantes = "<br><strong>" . $unico->postulantes . "</strong> Postulantes";
                } else {
                    $postulantes = "";
                }
                if ($Asistententes > 0) {
                    $asistentes = "<br><strong>" . $Asistententes . "</strong> Asistentes";
                } else {
                    $asistentes = "<br><strong>0</strong> Asistentes";
                }
            }
        }
        $row = str_replace("{INSCRITOS}", $inscritos, $row);
        $row = str_replace("{PREINSCRITOS}", $preinscritos, $row);
        $row = str_replace("{POSTULANTES}", $postulantes, $row);
        $row = str_replace("{ASISTENTES}", $asistentes, $row);
        $row = str_replace("{NUM_INSCRITOS}", $unico->inscritos, $row);
        $row = str_replace("{NUM_PREINSCRITOS}", $unico->preinscritos, $row);
        $row = str_replace("{NUM_POSTULANTES}", $unico->postulantes, $row);
        $row = str_replace("{NUM_ASISTENTES}", $Asistententes, $row);

        //Por cada curso, traigl el total de programas asociados desde rel lms malla curso
        $programas = TraeProgramasUnicosDadoCursoDeRelMallaCurso($id_empresa, $unico->id);
        $acumulador_programas = "";
        foreach ($programas as $prog) {
            $acumulador_programas .= $prog->nombre_programa . "<br>";
        }
        $row = str_replace("{PROGRAMAS_ASOCIADOS}", $acumulador_programas, $row);
        $row = str_replace("{PROGRAMA_BBDD_ENCODEADO}", Encodear3($programas[0]->id_programa), $row);
        $row = str_replace("{VALOR_HORA}", colocarPesos($unico->valor_hora), $row);
        if ($unico->imagen && file_exists("../front/img/logos_cursos/" . $unico->imagen)) {
            $row = str_replace("{IMAGEN}", "<img src='../front/img/logos_cursos/" . $unico->imagen . "' width='50' >", $row);
        } else {
            $row = str_replace("{IMAGEN}", "", $row);
        }
        $row = str_replace("{VALOR_HORA_SENCE}", colocarPesos($unico->valor_hora_sence), $row);
        $row = str_replace("{NUM_HORAS}", $unico->numero_horas, $row);
        $row = str_replace("{VALOR_CURSO}", colocarPesos($unico->numero_horas * $unico->valor_hora), $row);
        $row = str_replace("{EJECUTIVO}", ($unico->ejecutivocapacitacion), $row);
        $row = str_replace("{PARTICIPANTE}", ($unico->participantes), $row);
        $row = str_replace("{VALOR_CURSO}", colocarPesos($unico->numero_horas * $unico->valor_hora), $row);
        $row = str_replace("{FECHAI}", ($unico->fecha_inicio), $row);
        $row = str_replace("{FECHAT}", ($unico->fecha_finalizacion), $row);
        $total_html .= $row;
    }
    $PRINCIPAL = str_replace("{ROW_LISTADO}", utf8_encode($total_html), $PRINCIPAL);
    $PRINCIPAL = str_replace("{ROW_LISTADO_xls}", ($total_html), $PRINCIPAL);
    return ($PRINCIPAL);
}

function FormularioCurso2($PRINCIPAL, $id_curso, $id_empresa)
{
    //echo "FormularioCurso2 id_curso $id_curso";
    $datos_curso = DatosCurso_2($id_curso);
    //print_r($datos_curso);
    if ($datos_curso) {
        $id_curso = $datos_curso[0]->id;
    } else {
        $idNuevo = ListasPresenciales_CodigoIdCurso($id_empresa);
        $id_curso = $idNuevo;
    }

    $PRINCIPAL = str_replace("{NOM_CURSO}", utf8_encode($datos_curso[0]->nombre), $PRINCIPAL);
    $PRINCIPAL = str_replace("{NOMBRE_CURSO_SENCE}", utf8_encode($datos_curso[0]->nombre_curso_sence), $PRINCIPAL);
    $PRINCIPAL = str_replace("{COD_CURSO}", $id_curso, $PRINCIPAL);
    $PRINCIPAL = str_replace("{DES_CURSO}", utf8_encode($datos_curso[0]->descripcion), $PRINCIPAL);
    $PRINCIPAL = str_replace("{OBJETIVO_CURSO}", utf8_encode($datos_curso[0]->objetivo_curso), $PRINCIPAL);
    $PRINCIPAL = str_replace("{NUMERO_HORAS}", utf8_encode($datos_curso[0]->numero_horas), $PRINCIPAL);
    $PRINCIPAL = str_replace("{CANTIDAD_MAXIMA_PARTICIPANTES}", utf8_encode($datos_curso[0]->cantidad_maxima_participantes), $PRINCIPAL);
    $PRINCIPAL = str_replace("{TIPO_CURSO}", utf8_encode($datos_curso[0]->tipo), $PRINCIPAL);
    $PRINCIPAL = str_replace("{CHECKED" . $datos_curso[0]->sence . "}", "checked", $PRINCIPAL);
    $PRINCIPAL = str_replace("{CHECKED" . $datos_curso[0]->cbc . "CBC}", "checked", $PRINCIPAL);
    $PRINCIPAL = str_replace("{PREREQUISITO_CURSO}", utf8_encode($datos_curso[0]->prerequisito), $PRINCIPAL);
    $PRINCIPAL = str_replace("{COD_SENCE}", utf8_encode($datos_curso[0]->cod_sence), $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALOR_HORA}", utf8_encode($datos_curso[0]->valor_hora), $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALOR_HORA_SENCE}", utf8_encode($datos_curso[0]->valor_hora_sence), $PRINCIPAL);
    $PRINCIPAL = str_replace("{COD_IDENTIFICADOR}", utf8_encode($datos_curso[0]->numero_identificador), $PRINCIPAL);
    $PRINCIPAL = str_replace("{NUMERO_IDENTIFICADOR}", utf8_encode($datos_curso[0]->numero_identificador), $PRINCIPAL);
    $PRINCIPAL = str_replace("{CONTENIDOS_CURSO}", utf8_encode($datos_curso[0]->contenidos_cursos), $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALUE_COD_SENCE}", utf8_encode($datos_curso[0]->codigosence), $PRINCIPAL);

    if (utf8_encode($datos_curso[0]->imagen)) {
        $PRINCIPAL = str_replace("{BLOQUE_IMAGEN}", file_get_contents("views/capacitacion/curso/bloque_imagen_curso.html"), $PRINCIPAL);
        $PRINCIPAL = str_replace("{URL_IMAGEN}", "" . utf8_encode($datos_curso[0]->imagen), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BLOQUE_IMAGEN}", "", $PRINCIPAL);
    }

    $PRINCIPAL = str_replace("{SELECTED_" . $datos_curso[0]->sence . "}", "selected='selected'", $PRINCIPAL);
    if ($datos_curso) {
        $PRINCIPAL = str_replace("{VALOR_BOTON}", "Editar Curso", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ACTION}", "?sw=edcurso2", $PRINCIPAL);
        $PRINCIPAL = str_replace("{TITULO}", "Formulario Edici&oacute;n de Cursos", $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{VALOR_BOTON}", "Ingresar Curso", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ACTION}", "?sw=adcurso2", $PRINCIPAL);
        $PRINCIPAL = str_replace("{TITULO}", "Formulario Ingreso de Cursos", $PRINCIPAL);
    }
    $PRINCIPAL = str_replace("{NOMBRE_FORMULARIO}", "FormCurso", $PRINCIPAL);
    $PRINCIPAL = str_replace("{OPTIONS_MODALIDAD}", OptionsModalidad($datos_curso[0]->modalidad), $PRINCIPAL);
    $clasificacion = TotalClasificacion($id_empresa);
    foreach ($clasificacion as $cla) {
        if ($cla->id_clasificacion == $datos_curso[0]->clasificacion) {
            $select = "selected='selected'";
        } else {
            $select = "";
        }
        $opcionClasificacion .= '<option value=' . $cla->id_clasificacion . ' ' . $select . ' >' . utf8_encode($cla->clasificacion) . '</option>';
    }
    $otecs = TraeOtec($id_empresa);
    foreach ($otecs as $otec) {
        if ($cla->rut == $datos_curso[0]->rut_otec) {
            $select2 = "selected";
        } else {
            $select2 = "";
        }
        $opcionOtect .= '<option value=' . $otec->rut . ' ' . $select2 . ' >' . utf8_encode($otec->nombre) . ' (' . utf8_encode($otec->rut) . ')</option>';
    }
    $PRINCIPAL = str_replace("{OPTIONS_CLASIFICACION}", $opcionClasificacion, $PRINCIPAL);
    $focos = ListasPresenciales_Obtienefocos($id_empresa);
    $options_focos = "";
    foreach ($focos as $foc) {
        if ($foc->codigo_foco == $datos_curso[0]->id_foco) {
            $options_focos .= "<option value='" . $foc->codigo_foco . "' selected='selected'>" . $foc->descripcion . "</option>";
        } else {
            $options_focos .= "<option value='" . $foc->codigo_foco . "'>" . $foc->descripcion . "</option>";
        }
    }
    $PRINCIPAL = str_replace("{OPTIONS_FOCOS}", utf8_encode($options_focos), $PRINCIPAL);
    //$programas_bbdd=IMPARTCION_ObtieneProgramasBBDD($id_empresa);
    $programas_bbdd = ListaProgramasDadoFocoDeTabla_2022_data_sinanidacion($id_empresa);

    $options_programas_bbdd = "";
    foreach ($programas_bbdd as $prog_bbdd) {
        if ($prog_bbdd->id_programa == $datos_curso[0]->id_empresa_programa) {
            $options_programas_bbdd .= "<option value='" . $prog_bbdd->id_programa . "' selected='selected'>" . $prog_bbdd->nombre_programa . "</option>";
        } else {
            $options_programas_bbdd .= "<option value='" . $prog_bbdd->id_programa . "'>" . $prog_bbdd->nombre_programa . "</option>";
        }
    }
    $PRINCIPAL = str_replace("{OPTIONS_PROGRAMAS_BBDD_2022_sinanidacion}", utf8_encode($options_programas_bbdd), $PRINCIPAL);
    $PRINCIPAL = str_replace("{OPTIONS_RUT_OTEC}", $opcionOtect, $PRINCIPAL);
    $PRINCIPAL = str_replace("{ID_CURSO_ENCODEADO}", (Encodear3($datos_curso[0]->id)), $PRINCIPAL);
    $PRINCIPAL = str_replace("{OPTIONS_TIPO_CURSO}", Lista_OptionsGenericoNombreDadoValores("tbl_curso_tipo", $datos_curso[0]->tipo, "nombre", "id"), $PRINCIPAL);
    $PRINCIPAL = str_replace("{SELSENCE" . trim($datos_curso[0]->sence) . "}", "selected='selected'", $PRINCIPAL);
    $PRINCIPAL = str_replace("{SELCBC" . trim($datos_curso[0]->cbc) . "}", "selected='selected'", $PRINCIPAL);
    if ($datos_curso[0]->sence == "si") {
        $PRINCIPAL = str_replace("{STYLE_DISPLAY_COD_SENCE}", '', $PRINCIPAL);
        $PRINCIPAL = str_replace("{STYLE_DISPLAY_NUM_IDEN}", 'style="display:none;"', $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{STYLE_DISPLAY_COD_SENCE}", 'style="display:none;"', $PRINCIPAL);
        $PRINCIPAL = str_replace("{STYLE_DISPLAY_NUM_IDEN}", '', $PRINCIPAL);
    }
    return ($PRINCIPAL);
}

function ListadoCursosAdmin2($PRINCIPAL, $id_empresa, $excel, $id_curso, $llamada)
{
    //echo "$id_empresa, excel $excel, $id_curso, $llamada";
    $cursos = Listado_TotalCursos2($id_empresa, $id_curso, $llamada);
    $total_html = "";
    $i = 1;
    foreach ($cursos as $unico) {

        if ($excel == 1) {
            $row = file_get_contents("views/capacitacion/curso/row_listado_excel.html");
        } else if ($llamada == "imparticion_solo_preenciales") {
            $row = file_get_contents("views/capacitacion/curso/row_listado_imparticion.html");
        } else {
            $row = file_get_contents("views/capacitacion/curso/row_listado2.html");
        }

        $row = str_replace("{NUMERO}", $i, $row);
        $i++;
        $row = str_replace("{CODIGO}", "<span class='label bg-blue'>" . $unico->numero_identificador . "</span>", $row);
        $row = str_replace("{CODIGO_CURSO}", "<span class='label bg-blue'>" . $unico->id . "</span>", $row);
        $row = str_replace("{CODIGO_ENCODEADO}", Encodear3($unico->id), $row);
        $row = str_replace("{NOMBRE}", $unico->nombre, $row);
        if ($unico->clasificacion <> "") {
            $clasificacion = " (" . $unico->clasificacion . ") ";
        } else {
            $clasificacion = "";
        }
        $row = str_replace("{CLASIFICACION}", $clasificacion, $row);

        $row = str_replace("{NOMBRE_XLS}", ($unico->nombre), $row);
        $row = str_replace("{FOCO}", $unico->nombre_foco, $row);
        $row = str_replace("{FOCO_XLS}", ($unico->nombre_foco), $row);
        $busca_imparticiones_array = BuscaIdImparticiondadoCurso($unico->id, $id_empresa);
        if (count($busca_imparticiones_array) > 0) {
            $row = str_replace("{EJECUTIVO}", $unico->ejecutivo, $row);
        } else {
            $row = str_replace("{EJECUTIVO}", "<small></small>", $row);
        }
        $row = str_replace("{EJECUTIVO_XLS}", ($unico->ejecutivo), $row);
        $row = str_replace("{PROGRAMA}", $unico->nombre_programa, $row);
        $row = str_replace("{PROGRAMA_XLS}", ($unico->nombre_programa), $row);
        $row = str_replace("{DESCRIPCION}", $unico->descripcion, $row);
        $row = str_replace("{OBJETIVO_CURSO}", $unico->objetivo_curso, $row);
        $row = str_replace("{CLASIFICACION}", $unico->nombre_clasificacion, $row);
        //$row = str_replace("{NUM_IMPARTICIONES}",$unico->total_inscripciones_curso,$row);
        //print_r($busca_imparticion_array);
        $lista_imparticion = "";
        $lista_imparticion_xls = "";
        $suma_asistentes = 0;
        $cuentaimp = 0;
        foreach ($busca_imparticiones_array as $buscimpart) {
            $cuentaimp++;
            $lista_imparticion .= $buscimpart->codigo_inscripcion . "<br>";
            $lista_imparticion_xls .= $buscimpart->codigo_inscripcion . ",";
            $cuenta_Asistententes = BuscaAsistentesImparticion($buscimpart->codigo_inscripcion, $id_empresa);
            $suma_asistentes = $suma_asistentes + $cuenta_Asistententes[0]->asistentes;
            //print_r($cuenta_Asistententes);
        }
        if ($cuentaimp == 0) {
            $lista_imparticion = "<small>[SIN_IMPARTICIONES]</small><br>";
        }
        //cuentaparticipantes
        //$cuenta_Asistententes=BuscaAsistentesCursoImparticion($unico->id, $id_empresa);
        $Asistententes = $cuenta_Asistententes[0]->asistentes;
        $row = str_replace("{NUM_IMPARTICIONES}", $lista_imparticion, $row);
        $row = str_replace("{NUM_IMPARTICIONES_XLS}", $lista_imparticion_xls, $row);
        if ($cuentaimp > 0) {
            $boton_ver = "<a href='?sw=listaInscripciones2&i=" . Encodear3($unico->id) . "'  data-placement='left' title='Ver_Imparticiones'>Ver_Imparticiones</a><br>";
        } else {
            $boton_ver = "";
        }
        $row = str_replace("{VER_IMPARTICIONES}", $boton_ver, $row);
        $row = str_replace("{SENCE}", $unico->sence, $row);
        $row = str_replace("{PARTICIPANTES_MAX}", $unico->cantidad_maxima_participantes, $row);
        $row = str_replace("{OTEC}", $unico->nombre_otec, $row);
        $row = str_replace("{CBC}", $unico->cbc, $row);
        $row = str_replace("{MODALIDAD}", "<span class='label bg-blue'>" . $unico->nombre_modalidad . "</span>", $row);
        //$row = str_replace("{TIPO}",$unico->tipo,$row);
        $row = str_replace("{TIPO}", $unico->nombre_tipo_curso, $row);
        $row = str_replace("{PREREQUISITOS}", $unico->prerequisito, $row);

        $preinscritos = "";
        $postulantes = "";
        $asistentes = "";
        if ($unico->total_inscripciones_curso == 0) {
            $inscritos = "<strong>0</strong> Inscritos";
            if ($unico->nombre_modalidad == "Presencial") {
                $preinscritos = "<br><strong>0</strong> Preinscritos";
                $postulantes = "<br><strong>0</strong> Postulantes";
            }
        } else {
            $inscritos = "<strong>" . $unico->inscritos . "</strong> Inscritos";
            if ($unico->nombre_modalidad == "Presencial") {
                if ($unico->preinscritos > 0) {
                    $preinscritos = "<br><strong>" . $unico->preinscritos . "</strong> Preinscritos";
                } else {
                    $preinscritos = "<br><strong>0</strong> Preinscritos";
                }
                if ($unico->postulantes > 0) {
                    $postulantes = "<br><strong>" . $unico->postulantes . "</strong> Postulantes";
                } else {
                    $postulantes = "";
                }
                if ($Asistententes > 0) {
                    $asistentes = "<br><strong>" . $Asistententes . "</strong> Asistentes";
                } else {
                    $asistentes = "<br><strong>0</strong> Asistentes";
                }
            }
        }
        $row = str_replace("{INSCRITOS}", $inscritos, $row);
        $row = str_replace("{PREINSCRITOS}", $preinscritos, $row);
        $row = str_replace("{POSTULANTES}", $postulantes, $row);
        $row = str_replace("{ASISTENTES}", $asistentes, $row);
        $row = str_replace("{NUM_INSCRITOS}", $unico->inscritos, $row);
        $row = str_replace("{NUM_PREINSCRITOS}", $unico->preinscritos, $row);
        $row = str_replace("{NUM_POSTULANTES}", $unico->postulantes, $row);
        $row = str_replace("{NUM_ASISTENTES}", $Asistententes, $row);

        //Por cada curso, traigl el total de programas asociados desde rel lms malla curso
        $programas = TraeProgramasUnicosDadoCursoDeRelMallaCurso($id_empresa, $unico->id);
        $acumulador_programas = "";
        foreach ($programas as $prog) {
            $acumulador_programas .= $prog->nombre_programa . "<br>";
        }
        $row = str_replace("{PROGRAMAS_ASOCIADOS}", $acumulador_programas, $row);
        $row = str_replace("{PROGRAMA_BBDD_ENCODEADO}", Encodear3($programas[0]->id_programa), $row);
        $row = str_replace("{VALOR_HORA}", colocarPesos($unico->valor_hora), $row);
        if ($unico->imagen && file_exists("../front/img/logos_cursos/" . $unico->imagen)) {
            $row = str_replace("{IMAGEN}", "<img src='../front/img/logos_cursos/" . $unico->imagen . "' width='50' >", $row);
        } else {
            $row = str_replace("{IMAGEN}", "", $row);
        }
        $row = str_replace("{VALOR_HORA_SENCE}", colocarPesos($unico->valor_hora_sence), $row);
        $row = str_replace("{NUM_HORAS}", $unico->numero_horas, $row);
        $row = str_replace("{VALOR_CURSO}", colocarPesos($unico->numero_horas * $unico->valor_hora), $row);
        $row = str_replace("{EJECUTIVO}", ($unico->ejecutivocapacitacion), $row);
        $row = str_replace("{PARTICIPANTE}", ($unico->participantes), $row);
        $row = str_replace("{VALOR_CURSO}", colocarPesos($unico->numero_horas * $unico->valor_hora), $row);
        $row = str_replace("{FECHAI}", ($unico->fecha_inicio), $row);
        $row = str_replace("{FECHAT}", ($unico->fecha_finalizacion), $row);
        $total_html .= $row;
    }
    $PRINCIPAL = str_replace("{ROW_LISTADO}", utf8_encode($total_html), $PRINCIPAL);
    $PRINCIPAL = str_replace("{ROW_LISTADO_xls}", ($total_html), $PRINCIPAL);
    return ($PRINCIPAL);
}

function FormularioCurso3($PRINCIPAL, $id_curso, $id_empresa)
{

    //echo "FormularioCurso2 id_curso $id_curso";
    $datos_curso = DatosCurso_2($id_curso);
    //print_r($datos_curso);
    if ($datos_curso) {
        $id_curso = $datos_curso[0]->id;
    } else {
        $idNuevo = ListasPresenciales_CodigoIdCurso($id_empresa);
        $id_curso = $idNuevo;
    }


    $PRINCIPAL = str_replace("{NOM_CURSO}", utf8_encode($datos_curso[0]->nombre), $PRINCIPAL);
    $PRINCIPAL = str_replace("{NOMBRE_CURSO_SENCE}", utf8_encode($datos_curso[0]->nombre_curso_sence), $PRINCIPAL);
    $PRINCIPAL = str_replace("{COD_CURSO}", $id_curso, $PRINCIPAL);
    $PRINCIPAL = str_replace("{DES_CURSO}", utf8_encode($datos_curso[0]->descripcion), $PRINCIPAL);
    $PRINCIPAL = str_replace("{OBJETIVO_CURSO}", utf8_encode($datos_curso[0]->objetivo_curso), $PRINCIPAL);
    $PRINCIPAL = str_replace("{NUMERO_HORAS}", utf8_encode($datos_curso[0]->numero_horas), $PRINCIPAL);
    $PRINCIPAL = str_replace("{CANTIDAD_MAXIMA_PARTICIPANTES}", utf8_encode($datos_curso[0]->cantidad_maxima_participantes), $PRINCIPAL);
    $PRINCIPAL = str_replace("{TIPO_CURSO}", utf8_encode($datos_curso[0]->tipo), $PRINCIPAL);
    $PRINCIPAL = str_replace("{CHECKED" . $datos_curso[0]->sence . "}", "checked", $PRINCIPAL);
    $PRINCIPAL = str_replace("{CHECKED" . $datos_curso[0]->cbc . "CBC}", "checked", $PRINCIPAL);
    $PRINCIPAL = str_replace("{PREREQUISITO_CURSO}", utf8_encode($datos_curso[0]->prerequisito), $PRINCIPAL);
    $PRINCIPAL = str_replace("{COD_SENCE}", utf8_encode($datos_curso[0]->cod_sence), $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALOR_HORA}", utf8_encode($datos_curso[0]->valor_hora), $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALOR_HORA_SENCE}", utf8_encode($datos_curso[0]->valor_hora_sence), $PRINCIPAL);
    $PRINCIPAL = str_replace("{COD_IDENTIFICADOR}", utf8_encode($datos_curso[0]->numero_identificador), $PRINCIPAL);
    $PRINCIPAL = str_replace("{NUMERO_IDENTIFICADOR}", utf8_encode($datos_curso[0]->numero_identificador), $PRINCIPAL);
    $PRINCIPAL = str_replace("{CONTENIDOS_CURSO}", utf8_encode($datos_curso[0]->contenidos_cursos), $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALUE_COD_SENCE}", utf8_encode($datos_curso[0]->codigosence), $PRINCIPAL);

    if (utf8_encode($datos_curso[0]->imagen)) {
        $PRINCIPAL = str_replace("{BLOQUE_IMAGEN}", file_get_contents("views/capacitacion/curso/bloque_imagen_curso.html"), $PRINCIPAL);
        $PRINCIPAL = str_replace("{URL_IMAGEN}", "" . utf8_encode($datos_curso[0]->imagen), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BLOQUE_IMAGEN}", "", $PRINCIPAL);
    }

    $PRINCIPAL = str_replace("{SELECTED_" . $datos_curso[0]->sence . "}", "selected='selected'", $PRINCIPAL);
    if ($datos_curso) {
        $PRINCIPAL = str_replace("{VALOR_BOTON}", "Editar Curso", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ACTION}", "?sw=edcurso3", $PRINCIPAL);
        $PRINCIPAL = str_replace("{TITULO}", "Formulario Edici&oacute;n de Cursos", $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{VALOR_BOTON}", "Ingresar Curso", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ACTION}", "?sw=adcurso3", $PRINCIPAL);
        $PRINCIPAL = str_replace("{TITULO}", "Formulario Ingreso de Cursos", $PRINCIPAL);
    }
    $PRINCIPAL = str_replace("{NOMBRE_FORMULARIO}", "FormCurso", $PRINCIPAL);
    $PRINCIPAL = str_replace("{OPTIONS_MODALIDAD}", OptionsModalidad($datos_curso[0]->modalidad), $PRINCIPAL);
    $clasificacion = TotalClasificacion($id_empresa);
    foreach ($clasificacion as $cla) {
        if ($cla->id_clasificacion == $datos_curso[0]->clasificacion) {
            $select = "selected='selected'";
        } else {
            $select = "";
        }
        $opcionClasificacion .= '<option value=' . $cla->id_clasificacion . ' ' . $select . ' >' . utf8_encode($cla->clasificacion) . '</option>';
    }
    $otecs = TraeOtec($id_empresa);
    foreach ($otecs as $otec) {
        if ($cla->rut == $datos_curso[0]->rut_otec) {
            $select2 = "selected";
        } else {
            $select2 = "";
        }
        $opcionOtect .= '<option value=' . $otec->rut . ' ' . $select2 . ' >' . utf8_encode($otec->nombre) . ' (' . utf8_encode($otec->rut) . ')</option>';
    }
    $PRINCIPAL = str_replace("{OPTIONS_CLASIFICACION}", $opcionClasificacion, $PRINCIPAL);
    $focos = ListasPresenciales_Obtienefocos($id_empresa);
    $options_focos = "";
    foreach ($focos as $foc) {
        if ($foc->codigo_foco == $datos_curso[0]->id_foco) {
            $options_focos .= "<option value='" . $foc->codigo_foco . "' selected='selected'>" . $foc->descripcion . "</option>";
        } else {
            $options_focos .= "<option value='" . $foc->codigo_foco . "'>" . $foc->descripcion . "</option>";
        }
    }
    $PRINCIPAL = str_replace("{OPTIONS_FOCOS}", utf8_encode($options_focos), $PRINCIPAL);
    //$programas_bbdd=IMPARTCION_ObtieneProgramasBBDD($id_empresa);
    $programas_bbdd = ListaProgramasDadoFocoDeTabla($id_empresa, $datos_curso[0]->id_foco);

    $options_programas_bbdd = "";
    foreach ($programas_bbdd as $prog_bbdd) {
        if ($prog_bbdd->id_programa == $datos_curso[0]->id_empresa_programa) {
            $options_programas_bbdd .= "<option value='" . $prog_bbdd->id_programa . "' selected='selected'>" . $prog_bbdd->nombre_programa . "</option>";
        } else {
            $options_programas_bbdd .= "<option value='" . $prog_bbdd->id_programa . "'>" . $prog_bbdd->nombre_programa . "</option>";
        }
    }
    $PRINCIPAL = str_replace("{OPTIONS_PROGRAMAS_BBDD}", utf8_encode($options_programas_bbdd), $PRINCIPAL);
    $PRINCIPAL = str_replace("{OPTIONS_RUT_OTEC}", $opcionOtect, $PRINCIPAL);
    $PRINCIPAL = str_replace("{ID_CURSO_ENCODEADO}", Encodear(Encodear($datos_curso[0]->id)), $PRINCIPAL);
    $PRINCIPAL = str_replace("{OPTIONS_TIPO_CURSO}", Lista_OptionsGenericoNombreDadoValores("tbl_curso_tipo", $datos_curso[0]->tipo, "nombre", "id"), $PRINCIPAL);
    $PRINCIPAL = str_replace("{SELSENCE" . trim($datos_curso[0]->sence) . "}", "selected='selected'", $PRINCIPAL);
    $PRINCIPAL = str_replace("{SELCBC" . trim($datos_curso[0]->cbc) . "}", "selected='selected'", $PRINCIPAL);
    if ($datos_curso[0]->sence == "si") {
        $PRINCIPAL = str_replace("{STYLE_DISPLAY_COD_SENCE}", '', $PRINCIPAL);
        $PRINCIPAL = str_replace("{STYLE_DISPLAY_NUM_IDEN}", 'style="display:none;"', $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{STYLE_DISPLAY_COD_SENCE}", 'style="display:none;"', $PRINCIPAL);
        $PRINCIPAL = str_replace("{STYLE_DISPLAY_NUM_IDEN}", '', $PRINCIPAL);
    }
    return ($PRINCIPAL);
}

function ListadoCursosAdmin3($PRINCIPAL, $id_empresa, $excel, $id_curso, $llamada)
{
    //echo "$id_empresa, excel $excel, $id_curso, $llamada";
    $cursos = Listado_TotalCursos3($id_empresa, $id_curso, $llamada);
    $total_html = "";
    $i = 1;
    foreach ($cursos as $unico) {

        if ($excel == 1) {
            $row = file_get_contents("views/capacitacion/curso/row_listado_excel.html");
        } else if ($llamada == "imparticion_solo_preenciales") {
            $row = file_get_contents("views/capacitacion/curso/row_listado_imparticion.html");
        } else {
            $row = file_get_contents("views/capacitacion/curso/row_listado3.html");
        }

        $row = str_replace("{NUMERO}", $i, $row);
        $i++;
        $row = str_replace("{CODIGO}", "<span class='label bg-blue'>" . $unico->numero_identificador . "</span>", $row);
        $row = str_replace("{CODIGO_CURSO}", "<span class='label bg-blue'>" . $unico->id . "</span>", $row);
        $row = str_replace("{CODIGO_ENCODEADO}", Encodear3($unico->id), $row);
        $row = str_replace("{NOMBRE}", $unico->nombre, $row);
        $row = str_replace("{NOMBRE_XLS}", ($unico->nombre), $row);
        $row = str_replace("{FOCO}", $unico->nombre_foco, $row);
        $row = str_replace("{FOCO_XLS}", ($unico->nombre_foco), $row);
        $busca_imparticiones_array = BuscaIdImparticiondadoCurso($unico->id, $id_empresa);
        if (count($busca_imparticiones_array) > 0) {
            $row = str_replace("{EJECUTIVO}", $unico->ejecutivo, $row);
        } else {
            $row = str_replace("{EJECUTIVO}", "<small></small>", $row);
        }
        $row = str_replace("{EJECUTIVO_XLS}", ($unico->ejecutivo), $row);
        $row = str_replace("{PROGRAMA}", $unico->nombre_programa, $row);
        $row = str_replace("{PROGRAMA_XLS}", ($unico->nombre_programa), $row);
        $row = str_replace("{DESCRIPCION}", $unico->descripcion, $row);
        $row = str_replace("{OBJETIVO_CURSO}", $unico->objetivo_curso, $row);
        $row = str_replace("{CLASIFICACION}", $unico->nombre_clasificacion, $row);
        //$row = str_replace("{NUM_IMPARTICIONES}",$unico->total_inscripciones_curso,$row);
        //print_r($busca_imparticion_array);
        $lista_imparticion = "";
        $lista_imparticion_xls = "";
        $suma_asistentes = 0;
        $cuentaimp = 0;
        foreach ($busca_imparticiones_array as $buscimpart) {
            $cuentaimp++;
            $lista_imparticion .= $buscimpart->codigo_inscripcion . "<br>";
            $lista_imparticion_xls .= $buscimpart->codigo_inscripcion . ",";
            $cuenta_Asistententes = BuscaAsistentesImparticion($buscimpart->codigo_inscripcion, $id_empresa);
            $suma_asistentes = $suma_asistentes + $cuenta_Asistententes[0]->asistentes;
            //print_r($cuenta_Asistententes);
        }
        if ($cuentaimp == 0) {
            $lista_imparticion = "<small>[SIN_IMPARTICIONES]</small><br>";
        }
        //cuentaparticipantes
        //$cuenta_Asistententes=BuscaAsistentesCursoImparticion($unico->id, $id_empresa);
        $Asistententes = $cuenta_Asistententes[0]->asistentes;
        $row = str_replace("{NUM_IMPARTICIONES}", $lista_imparticion, $row);
        $row = str_replace("{NUM_IMPARTICIONES_XLS}", $lista_imparticion_xls, $row);
        if ($cuentaimp > 0) {
            $boton_ver = "<a href='?sw=listaInscripciones3&i=" . Encodear3($unico->id) . "'  data-placement='left' title='Ver_Imparticiones'>Ver_Imparticiones</a><br>";
        } else {
            $boton_ver = "";
        }
        $row = str_replace("{VER_IMPARTICIONES}", $boton_ver, $row);
        $row = str_replace("{SENCE}", $unico->sence, $row);
        $row = str_replace("{PARTICIPANTES_MAX}", $unico->cantidad_maxima_participantes, $row);
        $row = str_replace("{OTEC}", $unico->nombre_otec, $row);
        $row = str_replace("{CBC}", $unico->cbc, $row);
        $row = str_replace("{MODALIDAD}", "<span class='label bg-blue'>" . $unico->nombre_modalidad . "</span>", $row);
        //$row = str_replace("{TIPO}",$unico->tipo,$row);
        $row = str_replace("{TIPO}", $unico->nombre_tipo_curso, $row);
        $row = str_replace("{PREREQUISITOS}", $unico->prerequisito, $row);

        $preinscritos = "";
        $postulantes = "";
        $asistentes = "";
        if ($unico->total_inscripciones_curso == 0) {
            $inscritos = "<strong>0</strong> Inscritos";
            if ($unico->nombre_modalidad == "Presencial") {
                $preinscritos = "<br><strong>0</strong> Preinscritos";
                $postulantes = "<br><strong>0</strong> Postulantes";
            }
        } else {
            $inscritos = "<strong>" . $unico->inscritos . "</strong> Inscritos";
            if ($unico->nombre_modalidad == "Presencial") {
                if ($unico->preinscritos > 0) {
                    $preinscritos = "<br><strong>" . $unico->preinscritos . "</strong> Preinscritos";
                } else {
                    $preinscritos = "<br><strong>0</strong> Preinscritos";
                }
                if ($unico->postulantes > 0) {
                    $postulantes = "<br><strong>" . $unico->postulantes . "</strong> Postulantes";
                } else {
                    $postulantes = "";
                }
                if ($Asistententes > 0) {
                    $asistentes = "<br><strong>" . $Asistententes . "</strong> Asistentes";
                } else {
                    $asistentes = "<br><strong>0</strong> Asistentes";
                }
            }
        }
        $row = str_replace("{INSCRITOS}", $inscritos, $row);
        $row = str_replace("{PREINSCRITOS}", $preinscritos, $row);
        $row = str_replace("{POSTULANTES}", $postulantes, $row);
        $row = str_replace("{ASISTENTES}", $asistentes, $row);
        $row = str_replace("{NUM_INSCRITOS}", $unico->inscritos, $row);
        $row = str_replace("{NUM_PREINSCRITOS}", $unico->preinscritos, $row);
        $row = str_replace("{NUM_POSTULANTES}", $unico->postulantes, $row);
        $row = str_replace("{NUM_ASISTENTES}", $Asistententes, $row);

        //Por cada curso, traigl el total de programas asociados desde rel lms malla curso
        $programas = TraeProgramasUnicosDadoCursoDeRelMallaCurso($id_empresa, $unico->id);
        $acumulador_programas = "";
        foreach ($programas as $prog) {
            $acumulador_programas .= $prog->nombre_programa . "<br>";
        }
        $row = str_replace("{PROGRAMAS_ASOCIADOS}", $acumulador_programas, $row);
        $row = str_replace("{PROGRAMA_BBDD_ENCODEADO}", Encodear3($programas[0]->id_programa), $row);
        $row = str_replace("{VALOR_HORA}", colocarPesos($unico->valor_hora), $row);
        if ($unico->imagen && file_exists("../front/img/logos_cursos/" . $unico->imagen)) {
            $row = str_replace("{IMAGEN}", "<img src='../front/img/logos_cursos/" . $unico->imagen . "' width='50' >", $row);
        } else {
            $row = str_replace("{IMAGEN}", "", $row);
        }
        $row = str_replace("{VALOR_HORA_SENCE}", colocarPesos($unico->valor_hora_sence), $row);
        $row = str_replace("{NUM_HORAS}", $unico->numero_horas, $row);
        $row = str_replace("{VALOR_CURSO}", colocarPesos($unico->numero_horas * $unico->valor_hora), $row);
        $row = str_replace("{EJECUTIVO}", ($unico->ejecutivocapacitacion), $row);
        $row = str_replace("{PARTICIPANTE}", ($unico->participantes), $row);
        $row = str_replace("{VALOR_CURSO}", colocarPesos($unico->numero_horas * $unico->valor_hora), $row);
        $row = str_replace("{FECHAI}", ($unico->fecha_inicio), $row);
        $row = str_replace("{FECHAT}", ($unico->fecha_finalizacion), $row);
        $total_html .= $row;
    }
    $PRINCIPAL = str_replace("{ROW_LISTADO}", utf8_encode($total_html), $PRINCIPAL);
    $PRINCIPAL = str_replace("{ROW_LISTADO_xls}", ($total_html), $PRINCIPAL);
    return ($PRINCIPAL);
}

function Lista_OptionsGenericoNombreDadoValores($seleccionado)
{
    $valores = ListaCursos_ListaModalidadCursos();
    foreach ($valores as $val) {
        if ($val->id == $seleccionado) {
            $opciones .= "<option selected value='" . $val->id . "'>" . $val->modalidad . "</option>";
        } else {
            $opciones .= "<option value='" . $val->id . "'>" . $val->modalidad . "</option>";
        }
    }
    return (utf8_encode($opciones));
}

function colocarPesos()
{

}

function ListaColaboradoresPorImparticiones_2021($PRINCIPAL, $id_imparticion, $id_empresa, $excel)
{
    $datos_imparticion = DatosInscripcionImparticionesV2($id_imparticion, $id_empresa);
    //print_r($datos_imparticion); exit();
    $Num_sesiones = ImparticionesNumSesiones_2021($id_imparticion);
    if ($datos_imparticion[0]->id_modalidad == "1") {
        $display_asistencia_none = "display:none!important";
        $total_usuarios_por_inscripcion = IMPARTICION_UsuariosPorInscripcionConDatos($id_imparticion, $id_empresa);
    } else {
        $total_usuarios_por_inscripcion = IMPARTICION_UsuariosPorInscripcionConDatos($id_imparticion, $id_empresa);
    }
    $estado_ejecucion = EstadoImparticion2022($datos_imparticion[0]->fecha_inicio, $datos_imparticion[0]->fecha_termino);
    //print_r($estado);
    $PRINCIPAL = str_replace("{ESTADO_EJECUCION}", $estado_ejecucion[0], $PRINCIPAL);
    $cuenta_inscritos = count($total_usuarios_por_inscripcion);
    //if($cuenta_inscritos>0 and ($estado_ejecucion[1]=="Ejecutando" or $estado_ejecucion[1]=="Finalizada")){

    if ($cuenta_inscritos > 0) {

    } else {

        $display_asistencia_none = "display:none!important";
    }

    $PRINCIPAL = str_replace("{display_asistencia_none}", utf8_encode($display_asistencia_none), $PRINCIPAL);

    if ($Num_sesiones > 0) {
        $num_sesiones = $Num_sesiones;
        //echo "sesiones $num_sesiones";
    } else {
        $num_sesiones = 0;
        //echo "sesiones $num_sesiones";
    }

    if ($datos_imparticion[0]->id_modalidad == "1") {
        $total_usuarios_por_inscripcion = "";
    }

    $inscritos_numero = "";
    // preinscritos modalidad 1 es rel_lms_rut_id_curso_id_inscripcion
    if ($datos_imparticion[0]->id_modalidad == "1") {
        //$cuenta_preinscritos_2021=Cuenta_PreInscritos_2021($id_imparticion, $datos_imparticion[0]->id_modalidad, $id_empresa);
        //$inscritos_numero.="<span class='label label-sm label-info' style='margin-bottom: 1px;'> PreInscritos </span> ".$cuenta_preinscritos_2021." Preinscritos<BR>";
    }
    // preinscritos autoinscripcion 1 es tbl_inscripcion_postulantes
    if ($datos_imparticion[0]->id_modalidad == "3") {
        $cuenta_preinscritos_2021 = Cuenta_PreInscritos_2021($id_imparticion, $datos_imparticion[0]->id_modalidad, $id_empresa);
        $inscritos_numero .= "<span class='label label-sm label-info' style='margin-bottom: 1px;'> PreInscritos </span> " . $cuenta_preinscritos_2021 . " Preinscritos<BR>";
    }
    if ($datos_imparticion[0]->cupos > 0) {
        $inscritos_numero .= "<span class='label label-sm label-info' style='margin-bottom: 1px;'> Inscritos </span> " . $cuenta_inscritos . "  inscritos de " . $datos_imparticion[0]->cupos . " cupos disponibles";
    } else {
        $inscritos_numero .= "<span class='label label-sm label-info' style='margin-bottom: 1px;'> Inscritos </span> " . $cuenta_inscritos . " inscritos.";
    }


    $PRINCIPAL = str_replace("{CUPOS_INSCRITOS}", ($inscritos_numero), $PRINCIPAL);
    //print_r($total_usuarios_por_inscripcion);


    foreach ($total_usuarios_por_inscripcion as $usu) {
        if ($excel == 1) {
            $row_listado_colaboradores .= file_get_contents("views/capacitacion/imparticion/row_colaboradores_sesiones_excel.html");
        } else {
            $row_listado_colaboradores .= file_get_contents("views/capacitacion/imparticion/row_colaboradores_sesiones.html");
        }
        $existe_en_cierre = VerificaEnTablaCierreCursoEmpresRutInscripcion2021($usu->rut, $id_empresa, $id_imparticion);
        //ECHO "<BR>";PRINT_R($existe_en_cierre);
        //echo "<br><h4>1 existe_en_cierre[0]->estado_descripcion ".$existe_en_cierre[0]->estado_descripcion." select_aprobado $select_aprobado</h4>";

        $row_listado_colaboradores = str_replace("{RUT_COL_ENC}", Encodear3($usu->rut), $row_listado_colaboradores);
        $row_listado_colaboradores = str_replace("{TEXT_AREA_OBS_2023}", ($existe_en_cierre[0]->observaciones), $row_listado_colaboradores);
        if($existe_en_cierre[0]->observaciones<>""){
            //echo "<br>A";
            $icon_obs_svg="<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-info-square-fill' viewBox='0 0 16 16'>
                                    <path d='M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2zm8.93 4.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2z'/>
                                </svg>";
        } else {
            //echo "<br>B";

                    $icon_obs_svg="<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-info-square' viewBox='0 0 16 16'>
                                      <path d='M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z'/>
                                      <path d='m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z'/>
                                    </svg>";

        }
                $row_listado_colaboradores = str_replace("{ICON_OBS_SVG_2023}", ($icon_obs_svg), $row_listado_colaboradores);

        if ($num_sesiones > 0) {
            $sesion_1 = "";
            $sesion_2 = "";
            $sesion_3 = "";
            $sesion_4 = "";
            $sesion_5 = "";
            $sesion_6 = "";
            $sesion_7 = "";
            $sesion_8 = "";
            $sesion_9 = "";
            $sesion_10 = "";
            $sesion_11 = "";
            $sesion_12 = "";
            if ($num_sesiones > 0) {
                $checked_ses1 = Asistencia2021_Avance_Sesiones($usu->rut, $id_imparticion, "1");
                $fecha_sesion1 = Fecha2021_fecha_sesion($id_imparticion, "1");
                $sesion_1 = "<th class='bg_gray' width='100px' style='font-size: 11px;'>S1<br>" . $fecha_sesion1[0]->fecha . "<br>" . $fecha_sesion1[0]->hora_desde . " / " . $fecha_sesion1[0]->hora_hasta . "</th>";
                $sesion_1_td = "<td><input type='checkbox' id='ses_1' name='ses_1_" . $usu->rut . "' " . $checked_ses1 . " disabled></td>";
            }
            if ($num_sesiones > 1) {
                $checked_ses2 = Asistencia2021_Avance_Sesiones($usu->rut, $id_imparticion, "2");
                $fecha_sesion2 = Fecha2021_fecha_sesion($id_imparticion, "2");
                $sesion_2 = "<th class='bg_gray' width='100px' style='font-size: 11px;'>S2<br>" . $fecha_sesion2[0]->fecha . "<br>" . $fecha_sesion2[0]->hora_desde . " / " . $fecha_sesion2[0]->hora_hasta . "</th>";
                $sesion_2_td = "<td><input type='checkbox' id='ses_2' name='ses_2_" . $usu->rut . "' " . $checked_ses2 . " disabled></td>";
            }
            if ($num_sesiones > 2) {
                $checked_ses3 = Asistencia2021_Avance_Sesiones($usu->rut, $id_imparticion, "3");
                $fecha_sesion3 = Fecha2021_fecha_sesion($id_imparticion, "3");
                $sesion_3 = "<th class='bg_gray' width='100px' style='font-size: 11px;'>S3<br>" . $fecha_sesion3[0]->fecha . "<br>" . $fecha_sesion3[0]->hora_desde . " / " . $fecha_sesion3[0]->hora_hasta . "</th>";
                $sesion_3_td = "<td><input type='checkbox' id='ses_3' name='ses_3_" . $usu->rut . "' " . $checked_ses3 . " disabled></td>";
            }
            if ($num_sesiones > 3) {
                $checked_ses4 = Asistencia2021_Avance_Sesiones($usu->rut, $id_imparticion, "4");
                $fecha_sesion4 = Fecha2021_fecha_sesion($id_imparticion, "4");
                $sesion_4 = "<th class='bg_gray' width='100px' style='font-size: 11px;'>S4<br>" . $fecha_sesion4[0]->fecha . "<br>" . $fecha_sesion4[0]->hora_desde . " / " . $fecha_sesion4[0]->hora_hasta . "</th>";
                $sesion_4_td = "<td><input type='checkbox' id='ses_4' name='ses_4_" . $usu->rut . "' " . $checked_ses4 . " disabled></td>";
            }
            if ($num_sesiones > 4) {
                $checked_ses5 = Asistencia2021_Avance_Sesiones($usu->rut, $id_imparticion, "5");
                $fecha_sesion5 = Fecha2021_fecha_sesion($id_imparticion, "5");
                $sesion_5 = "<th class='bg_gray' width='25%' style='font-size: 11px;'>S5<br>" . $fecha_sesion5[0]->fecha . "<br>" . $fecha_sesion5[0]->hora_desde . " / " . $fecha_sesion5[0]->hora_hasta . "</th>";
                $sesion_5_td = "<td><input type='checkbox' id='ses_5' name='ses_5_" . $usu->rut . "' " . $checked_ses5 . " disabled></td>";
            }
            if ($num_sesiones > 5) {
                $checked_ses6 = Asistencia2021_Avance_Sesiones($usu->rut, $id_imparticion, "6");
                $fecha_sesion6 = Fecha2021_fecha_sesion($id_imparticion, "6");
                $sesion_6 = "<th class='bg_gray' width='25%' style='font-size: 11px;'>S6<br>" . $fecha_sesion6[0]->fecha . "<br>" . $fecha_sesion6[0]->hora_desde . " / " . $fecha_sesion6[0]->hora_hasta . "</th>";
                $sesion_6_td = "<td><input type='checkbox' id='ses_6' name='ses_6_" . $usu->rut . "' " . $checked_ses6 . " disabled></td>";
            }
            if ($num_sesiones > 6) {
                $checked_ses7 = Asistencia2021_Avance_Sesiones($usu->rut, $id_imparticion, "7");
                $fecha_sesion7 = Fecha2021_fecha_sesion($id_imparticion, "7");
                $sesion_7 = "<th class='bg_gray' width='25%' style='font-size: 11px;'>S7<br>" . $fecha_sesion7[0]->fecha . "<br>" . $fecha_sesion7[0]->hora_desde . " / " . $fecha_sesion7[0]->hora_hasta . "</th>";
                $sesion_7_td = "<td><input type='checkbox' id='ses_7' name='ses_7_" . $usu->rut . "' " . $checked_ses7 . " disabled></td>";
            }
            if ($num_sesiones > 7) {
                $checked_ses8 = Asistencia2021_Avance_Sesiones($usu->rut, $id_imparticion, "8");
                $fecha_sesion8 = Fecha2021_fecha_sesion($id_imparticion, "8");
                $sesion_8 = "<th class='bg_gray' width='25%' style='font-size: 11px;'>S8<br>" . $fecha_sesion8[0]->fecha . "<br>" . $fecha_sesion8[0]->hora_desde . " / " . $fecha_sesion8[0]->hora_hasta . "</th>";
                $sesion_8_td = "<td><input type='checkbox' id='ses_8' name='ses_8_" . $usu->rut . "' " . $checked_ses8 . " disabled></td>";
            }
            if ($num_sesiones > 8) {
                $checked_ses9 = Asistencia2021_Avance_Sesiones($usu->rut, $id_imparticion, "9");
                $fecha_sesion9 = Fecha2021_fecha_sesion($id_imparticion, "9");
                $sesion_9 = "<th class='bg_gray' width='25%' style='font-size: 11px;'>S9<br>" . $fecha_sesion9[0]->fecha . "<br>" . $fecha_sesion9[0]->hora_desde . " / " . $fecha_sesion9[0]->hora_hasta . "</th>";
                $sesion_9_td = "<td><input type='checkbox' id='ses_9' name='ses_9_" . $usu->rut . "' " . $checked_ses9 . " disabled></td>";
            }
            if ($num_sesiones > 9) {
                $checked_ses10 = Asistencia2021_Avance_Sesiones($usu->rut, $id_imparticion, "10");
                $fecha_sesion10 = Fecha2021_fecha_sesion($id_imparticion, "10");
                $sesion_10 = "<th class='bg_gray' width='25%' style='font-size: 11px;'>S10<br>" . $fecha_sesion10[0]->fecha . "<br>" . $fecha_sesion10[0]->hora_desde . " / " . $fecha_sesion10[0]->hora_hasta . "</th>";
                $sesion_10_td = "<td><input type='checkbox' id='ses_10' name='ses_10_" . $usu->rut . "' " . $checked_ses10 . " disabled></td>";
            }
            if ($num_sesiones > 10) {
                $checked_ses11 = Asistencia2021_Avance_Sesiones($usu->rut, $id_imparticion, "11");
                $fecha_sesion11 = Fecha2021_fecha_sesion($id_imparticion, "11");
                $sesion_11 = "<th class='bg_gray' width='25%' style='font-size: 11px;'>S11<br>" . $fecha_sesion11[0]->fecha . "<br>" . $fecha_sesion11[0]->hora_desde . " / " . $fecha_sesion11[0]->hora_hasta . "</th>";
                $sesion_11_td = "<td><input type='checkbox' id='ses_11' name='ses_11_" . $usu->rut . "' " . $checked_ses11 . " disabled></td>";
            }
            if ($num_sesiones > 11) {
                $checked_ses12 = Asistencia2021_Avance_Sesiones($usu->rut, $id_imparticion, "12");
                $fecha_sesion12 = Fecha2021_fecha_sesion($id_imparticion, "12");
                $sesion_12 = "<th class='bg_gray' width='25%' style='font-size: 11px;'>S12<br>" . $fecha_sesion12[0]->fecha . "<br>" . $fecha_sesion12[0]->hora_desde . " / " . $fecha_sesion12[0]->hora_hasta . "</th>";
                $sesion_12_td = "<td><input type='checkbox' id='ses_12' name='ses_12_" . $usu->rut . "' " . $checked_ses12 . " disabled></td>";
            }
            $readonly_asistencia = " readonly ";
            $suma_sesiones = "";
            //calcula asistencia
            if ($checked_ses1 == "checked") {
                $suma_sesiones++;
            }
            if ($checked_ses2 == "checked") {
                $suma_sesiones++;
            }
            if ($checked_ses3 == "checked") {
                $suma_sesiones++;
            }
            if ($checked_ses4 == "checked") {
                $suma_sesiones++;
            }
            if ($checked_ses5 == "checked") {
                $suma_sesiones++;
            }
            if ($checked_ses6 == "checked") {
                $suma_sesiones++;
            }
            if ($checked_ses7 == "checked") {
                $suma_sesiones++;
            }
            if ($checked_ses8 == "checked") {
                $suma_sesiones++;
            }
            if ($checked_ses9 == "checked") {
                $suma_sesiones++;
            }
            if ($checked_ses10 == "checked") {
                $suma_sesiones++;
            }
            if ($checked_ses11 == "checked") {
                $suma_sesiones++;
            }
            if ($checked_ses12 == "checked") {
                $suma_sesiones++;
            }
            //$porcentaje_asistencia_sesiones	= round(100*$suma_sesiones/$num_sesiones);
            //echo "<br>porcentaje_asistencia_sesiones $porcentaje_asistencia_sesiones, "


        } else {
            $readonly_asistencia = "";
        }
        //echo "<br><h4>2 existe_en_cierre[0]->estado_descripcion ".$existe_en_cierre[0]->estado_descripcion." select_aprobado $select_aprobado</h4>";


        $row_listado_colaboradores = str_replace("{SESIONES_1_td}", $sesion_1_td, $row_listado_colaboradores);
        $row_listado_colaboradores = str_replace("{SESIONES_2_td}", $sesion_2_td, $row_listado_colaboradores);
        $row_listado_colaboradores = str_replace("{SESIONES_3_td}", $sesion_3_td, $row_listado_colaboradores);
        $row_listado_colaboradores = str_replace("{SESIONES_4_td}", $sesion_4_td, $row_listado_colaboradores);
        $row_listado_colaboradores = str_replace("{SESIONES_5_td}", $sesion_5_td, $row_listado_colaboradores);
        $row_listado_colaboradores = str_replace("{SESIONES_6_td}", $sesion_6_td, $row_listado_colaboradores);
        $row_listado_colaboradores = str_replace("{SESIONES_7_td}", $sesion_7_td, $row_listado_colaboradores);
        $row_listado_colaboradores = str_replace("{SESIONES_8_td}", $sesion_8_td, $row_listado_colaboradores);
        $row_listado_colaboradores = str_replace("{SESIONES_9_td}", $sesion_9_td, $row_listado_colaboradores);
        $row_listado_colaboradores = str_replace("{SESIONES_10_td}", $sesion_10_td, $row_listado_colaboradores);
        $row_listado_colaboradores = str_replace("{SESIONES_11_td}", $sesion_11_td, $row_listado_colaboradores);
        $row_listado_colaboradores = str_replace("{SESIONES_12_td}", $sesion_12_td, $row_listado_colaboradores);
        $row_listado_colaboradores = str_replace("{readonly_asistencia}", $readonly_asistencia, $row_listado_colaboradores);
        $row_listado_colaboradores = str_replace("{NOMBRE}", ($usu->rut), $row_listado_colaboradores);
        $UsuC = TraeUsuarioRut($usu->rut);
        $row_listado_colaboradores = str_replace("{NOMBRE_COMPLETO}", $UsuC[0]->nombre_completo, $row_listado_colaboradores);
        $row_listado_colaboradores = str_replace("{CAMPO1}", $usu->campo1, $row_listado_colaboradores);
        $row_listado_colaboradores = str_replace("{CAMPO2}", $usu->campo2, $row_listado_colaboradores);
        $row_listado_colaboradores = str_replace("{CAMPO3}", $usu->campo3, $row_listado_colaboradores);
        $TipoVigencia=TipoRut_2022($usu->rut, $UsuC[0]->id, $UsuC[0]->vigencia_descripcion);
             $row_listado_colaboradores = str_replace("{TIPO_VIGENCIA}", "<span class='badge badge-info'>$TipoVigencia</span>", $row_listado_colaboradores);

        $row_listado_colaboradores = str_replace("{RUT_COMPLETO}", $usu->rut, $row_listado_colaboradores);
        $row_listado_colaboradores = str_replace("{RUT_COLABORADOR}", $usu->rut, $row_listado_colaboradores);
        $row_listado_colaboradores = str_replace("{CARGO_COLABORADOR}", $usu->cargo_colaborador, $row_listado_colaboradores);
        $row_listado_colaboradores = str_replace("{ID_IMPARTICION}", $id_imparticion, $row_listado_colaboradores);
        $row_listado_colaboradores = str_replace("{ID_IMPARTICION_ENC}", Encodear3($id_imparticion), $row_listado_colaboradores);
        //$avance_actual=CalculaAsistenciaEnBaseASesiones($usu->rut, $id_imparticion, $id_empresa);
        //echo "<br>holla ".$usu->rut." <br> "; print_r($existe_en_cierre);
        //if($existe_en_cierre[0]->porcentaje_asistencia<>''){$icono_asistencia="<i class='fas fa-check-square fa-2x' style='color: #3eae29;'></i>";} else {$icono_asistencia="";}
        //if($existe_en_cierre[0]->nota<>''){$icono_nota="<i class='fas fa-check-square fa-2x'  style='color: #3eae29;'></i>";} else {$icono_nota="";}
        //$row_listado_colaboradores = str_replace("{AVANCE_ACTUAL}",$avance_actual,$row_listado_colaboradores);
        $row_listado_colaboradores = str_replace("{AVANCE_ACTUAL}", $existe_en_cierre[0]->porcentaje_asistencia, $row_listado_colaboradores);

        /*if($num_sesiones>0){
					if($existe_en_cierre[0]->estado_descripcion=="DESISTE"	or $existe_en_cierre[0]->estado_descripcion=="JUSTIFICADO"){

					} else {
					$existe_en_cierre[0]->estado_descripcion="";
					}


				}*/
        //echo "<br><h4>3 existe_en_cierre[0]->estado_descripcion ".$existe_en_cierre[0]->estado_descripcion." select_aprobado $select_aprobado</h4>";

        //print_r($existe_en_cierre);

        $display_notas = "";
        // ESTADO AUTOMATICO
        if ($datos_imparticion[0]->minimo_asistencia > 0) {
            //echo "<br>-> aaaa";
            if ($datos_imparticion[0]->minimo_nota_aprobacion > 0) {
            } else {
                $display_notas = " display:none !important";
            }
        } else {
            if ($datos_imparticion[0]->minimo_nota_aprobacion > 0) {
            } else {
                $display_notas = " display:none !important";
            }
        }

        //print_r($existe_en_cierre);
        if ($existe_en_cierre[0]->estado_descripcion == "") {
            $select_aprobado = "";
            $select_reprobado = "";
            $select_desiste = "";
            $select_justificado = "";
        } elseif ($existe_en_cierre[0]->estado_descripcion == "APROBADO") {
            //echo "<br>a</br>";
            $select_aprobado = " selected ";
            $select_reprobado = "";
            $select_desiste = "";
            $select_justificado = "";
        } elseif ($existe_en_cierre[0]->estado_descripcion == "REPROBADO") {
            $select_aprobado = "";
            $select_reprobado = " selected ";
            $select_desiste = "";
            $select_justificado = "";
        } elseif ($existe_en_cierre[0]->estado_descripcion == "DESISTE") {
            $select_aprobado = "";
            $select_reprobado = "";
            $select_desiste = " selected ";
            $select_justificado = "";
        } elseif ($existe_en_cierre[0]->estado_descripcion == "JUSTIFICADO") {
            $select_aprobado = "";
            $select_reprobado = "";
            $select_desiste = "";
            $select_justificado = " selected ";
        }
        //echo "<br><h4>existe_en_cierre[0]->estado_descripcion ".$existe_en_cierre[0]->estado_descripcion." select_aprobado $select_aprobado</h4>";

        $row_listado_colaboradores = str_replace("{display_notas}", $display_notas, $row_listado_colaboradores);
        $PRINCIPAL = str_replace("{display_notas}", $display_notas, $PRINCIPAL);

        //print_r($existe_en_cierre);

        $row_listado_colaboradores = str_replace("{NOTA_ACTUAL}", $existe_en_cierre[0]->nota, $row_listado_colaboradores);
        $row_listado_colaboradores = str_replace("{NOTA_DIAGNOSTICO_ACTUAL}", $existe_en_cierre[0]->caso_especial, $row_listado_colaboradores);
        $row_listado_colaboradores = str_replace("{ESTADO_ACTUAL}", $existe_en_cierre[0]->estado_descripcion, $row_listado_colaboradores);
        $row_listado_colaboradores = str_replace("{ICONO_ASISTENCIA}", $icono_asistencia, $row_listado_colaboradores);
        $row_listado_colaboradores = str_replace("{ICONO_NOTA}", $icono_nota, $row_listado_colaboradores);
        $row_listado_colaboradores = str_replace("{select_aprobado}", $select_aprobado, $row_listado_colaboradores);
        $row_listado_colaboradores = str_replace("{select_aprobado}", $select_aprobado, $row_listado_colaboradores);
        $row_listado_colaboradores = str_replace("{select_reprobado}", $select_reprobado, $row_listado_colaboradores);
        $row_listado_colaboradores = str_replace("{select_desiste}", $select_desiste, $row_listado_colaboradores);
        $row_listado_colaboradores = str_replace("{select_justificado}", $select_justificado, $row_listado_colaboradores);

        actualizaTablaCierreRut_2021($usu->rut, $datos_imparticion[0]->id_curso, $id_imparticion, $existe_en_cierre[0]->porcentaje_asistencia, $id_empresa, $existe_en_cierre[0]->nota, $existe_en_cierre[0]->caso_especial, $estado, $existe_en_cierre[0]->estado_descripcion);

        $row_listado_colaboradores = str_replace("{ROW_SESIONES_POR_COLABORADOR}", ($listado_sesiones_por_colaborador), $row_listado_colaboradores);

        global $permite_subir_certificados;

        if ($existe_en_cierre[0]->observaciones <> "") {
            $archivo_certificado = "../front/docs/" . $existe_en_cierre[0]->observaciones;
            $ver_certificado = "<a href='" . $archivo_certificado . "' target='_blank' class='btn btn-link'>Ver Diploma</a> 
					<a href='?sw=VeColaboradoresXImp2021&i=" . Encodear3($id_imparticion) . "&dl=" . $existe_en_cierre[0]->id . "'><svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-trash' viewBox='0 0 16 16'><path d='M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z'/><path fill-rule='evenodd' d='M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z'/></svg></a>
					<br>";
        } else {
            $archivo_certificado = "";
            $ver_certificado = "";
        }

        if ($permite_subir_certificados == "1" and $existe_en_cierre[0]->estado_descripcion == "APROBADO") {
            $upload_certificado_2021 = "
					$ver_certificado
					<div style='text-align:right;font-size:10px'>
									  <input type='file' value='Subir Excel' name='file_" . Encodear3($usu->rut) . "' style='display: inline;width: 98px;font-size: 9px;'>
        	</div>
					";
        } else {
            $upload_certificado_2021 = "";
        }
        $row_listado_colaboradores = str_replace("{ROW_CERTIFICADO_2021_INDIVIDUAL}", ($upload_certificado_2021), $row_listado_colaboradores);
        $row_listado_colaboradores = str_replace("{ROW_SESIONES_POR_COLABORADOR}", ($listado_sesiones_por_colaborador), $row_listado_colaboradores);

    }


    //echo "<br>num_sesiones $num_sesiones";
    if ($num_sesiones > 0) {
        $sesion_1 = "";
        $sesion_2 = "";
        $sesion_3 = "";
        $sesion_4 = "";
        $sesion_5 = "";
        $sesion_6 = "";
        $sesion_7 = "";
        $sesion_8 = "";
        $sesion_9 = "";
        $sesion_10 = "";
        $sesion_11 = "";
        $sesion_12 = "";
        if ($num_sesiones > 0) {
            $fecha_sesion1 = Fecha2021_fecha_sesion($id_imparticion, "1");
            $sesion_1 = "<th class='bg_gray' width='100px' style='font-size: 11px;'>S1<br>" . $fecha_sesion1[0]->fecha . "<br>" . $fecha_sesion1[0]->hora_desde . " / " . $fecha_sesion1[0]->hora_hasta . "</th>";
        }
        if ($num_sesiones > 1) {
            $fecha_sesion2 = Fecha2021_fecha_sesion($id_imparticion, "2");
            $sesion_2 = "<th class='bg_gray' width='100px' style='font-size: 11px;'>S2<br>" . $fecha_sesion2[0]->fecha . "<br>" . $fecha_sesion2[0]->hora_desde . " / " . $fecha_sesion2[0]->hora_hasta . "</th>";
        }
        if ($num_sesiones > 2) {
            $fecha_sesion3 = Fecha2021_fecha_sesion($id_imparticion, "3");
            $sesion_3 = "<th class='bg_gray' width='100px' style='font-size: 11px;'>S3<br>" . $fecha_sesion3[0]->fecha . "<br>" . $fecha_sesion3[0]->hora_desde . " / " . $fecha_sesion3[0]->hora_hasta . "</th>";
        }
        if ($num_sesiones > 3) {
            $checked_ses4 = Asistencia2021_Avance_Sesiones($usu->rut, $id_imparticion, "4");
            $sesion_4 = "<th class='bg_gray' width='100px' style='font-size: 11px;'>S4<br>" . $fecha_sesion4[0]->fecha . "<br>" . $fecha_sesion4[0]->hora_desde . " / " . $fecha_sesion4[0]->hora_hasta . "</th>";
        }
        if ($num_sesiones > 4) {
            $checked_ses5 = Asistencia2021_Avance_Sesiones($usu->rut, $id_imparticion, "5");
            $fecha_sesion5 = Fecha2021_fecha_sesion($id_imparticion, "5");
            $sesion_5 = "<th class='bg_gray' width='25%' style='font-size: 11px;'>S5<br>" . $fecha_sesion5[0]->fecha . "<br>" . $fecha_sesion5[0]->hora_desde . " / " . $fecha_sesion5[0]->hora_hasta . "</th>";
            $sesion_5_td = "<td><input type='checkbox' id='ses_5' name='ses_5_" . $usu->rut . "' " . $checked_ses5 . "></td>";
        }
        if ($num_sesiones > 5) {
            $checked_ses6 = Asistencia2021_Avance_Sesiones($usu->rut, $id_imparticion, "6");
            $fecha_sesion6 = Fecha2021_fecha_sesion($id_imparticion, "6");
            $sesion_6 = "<th class='bg_gray' width='25%' style='font-size: 11px;'>S6<br>" . $fecha_sesion6[0]->fecha . "<br>" . $fecha_sesion6[0]->hora_desde . " / " . $fecha_sesion6[0]->hora_hasta . "</th>";
            $sesion_6_td = "<td><input type='checkbox' id='ses_6' name='ses_6_" . $usu->rut . "' " . $checked_ses6 . "></td>";
        }
        if ($num_sesiones > 6) {
            $checked_ses7 = Asistencia2021_Avance_Sesiones($usu->rut, $id_imparticion, "7");
            $fecha_sesion7 = Fecha2021_fecha_sesion($id_imparticion, "7");
            $sesion_7 = "<th class='bg_gray' width='25%' style='font-size: 11px;'>S7<br>" . $fecha_sesion7[0]->fecha . "<br>" . $fecha_sesion7[0]->hora_desde . " / " . $fecha_sesion7[0]->hora_hasta . "</th>";
            $sesion_7_td = "<td><input type='checkbox' id='ses_7' name='ses_7_" . $usu->rut . "' " . $checked_ses7 . "></td>";
        }
        if ($num_sesiones > 7) {
            $checked_ses8 = Asistencia2021_Avance_Sesiones($usu->rut, $id_imparticion, "8");
            $fecha_sesion8 = Fecha2021_fecha_sesion($id_imparticion, "8");
            $sesion_8 = "<th class='bg_gray' width='25%' style='font-size: 11px;'>S8<br>" . $fecha_sesion8[0]->fecha . "<br>" . $fecha_sesion8[0]->hora_desde . " / " . $fecha_sesion8[0]->hora_hasta . "</th>";
            $sesion_8_td = "<td><input type='checkbox' id='ses_8' name='ses_8_" . $usu->rut . "' " . $checked_ses8 . "></td>";
        }
        if ($num_sesiones > 8) {
            $checked_ses9 = Asistencia2021_Avance_Sesiones($usu->rut, $id_imparticion, "9");
            $fecha_sesion9 = Fecha2021_fecha_sesion($id_imparticion, "9");
            $sesion_9 = "<th class='bg_gray' width='25%' style='font-size: 11px;'>S9<br>" . $fecha_sesion9[0]->fecha . "<br>" . $fecha_sesion9[0]->hora_desde . " / " . $fecha_sesion9[0]->hora_hasta . "</th>";
            $sesion_9_td = "<td><input type='checkbox' id='ses_9' name='ses_9_" . $usu->rut . "' " . $checked_ses9 . "></td>";
        }
        if ($num_sesiones > 9) {
            $checked_ses10 = Asistencia2021_Avance_Sesiones($usu->rut, $id_imparticion, "10");
            $fecha_sesion10 = Fecha2021_fecha_sesion($id_imparticion, "10");
            $sesion_10 = "<th class='bg_gray' width='25%' style='font-size: 11px;'>S10<br>" . $fecha_sesion10[0]->fecha . "<br>" . $fecha_sesion10[0]->hora_desde . " / " . $fecha_sesion10[0]->hora_hasta . "</th>";
            $sesion_10_td = "<td><input type='checkbox' id='ses_10' name='ses_10_" . $usu->rut . "' " . $checked_ses10 . "></td>";
        }
        if ($num_sesiones > 10) {
            $checked_ses11 = Asistencia2021_Avance_Sesiones($usu->rut, $id_imparticion, "11");
            $fecha_sesion11 = Fecha2021_fecha_sesion($id_imparticion, "11");
            $sesion_11 = "<th class='bg_gray' width='25%' style='font-size: 11px;'>S11<br>" . $fecha_sesion11[0]->fecha . "<br>" . $fecha_sesion11[0]->hora_desde . " / " . $fecha_sesion11[0]->hora_hasta . "</th>";
            $sesion_11_td = "<td><input type='checkbox' id='ses_11' name='ses_11_" . $usu->rut . "' " . $checked_ses11 . "></td>";
        }
        if ($num_sesiones > 11) {
            $checked_ses12 = Asistencia2021_Avance_Sesiones($usu->rut, $id_imparticion, "12");
            $fecha_sesion12 = Fecha2021_fecha_sesion($id_imparticion, "12");
            $sesion_12 = "<th class='bg_gray' width='25%' style='font-size: 11px;'>S12<br>" . $fecha_sesion12[0]->fecha . "<br>" . $fecha_sesion12[0]->hora_desde . " / " . $fecha_sesion12[0]->hora_hasta . "</th>";
            $sesion_12_td = "<td><input type='checkbox' id='ses_12' name='ses_12_" . $usu->rut . "' " . $checked_ses12 . "></td>";
        }
    }

    $PRINCIPAL = str_replace("{SESIONES_1_TH}", $sesion_1, $PRINCIPAL);
    $PRINCIPAL = str_replace("{SESIONES_2_TH}", $sesion_2, $PRINCIPAL);
    $PRINCIPAL = str_replace("{SESIONES_3_TH}", $sesion_3, $PRINCIPAL);
    $PRINCIPAL = str_replace("{SESIONES_4_TH}", $sesion_4, $PRINCIPAL);
    $PRINCIPAL = str_replace("{SESIONES_5_TH}", $sesion_5, $PRINCIPAL);
    $PRINCIPAL = str_replace("{SESIONES_6_TH}", $sesion_6, $PRINCIPAL);
    $PRINCIPAL = str_replace("{SESIONES_7_TH}", $sesion_7, $PRINCIPAL);
    $PRINCIPAL = str_replace("{SESIONES_8_TH}", $sesion_8, $PRINCIPAL);
    $PRINCIPAL = str_replace("{SESIONES_9_TH}", $sesion_9, $PRINCIPAL);
    $PRINCIPAL = str_replace("{SESIONES_10_TH}", $sesion_10, $PRINCIPAL);
    $PRINCIPAL = str_replace("{SESIONES_11_TH}", $sesion_11, $PRINCIPAL);
    $PRINCIPAL = str_replace("{SESIONES_12_TH}", $sesion_12, $PRINCIPAL);
    $PRINCIPAL = str_replace("{ID_MODALIDAD_BACK}", ($datos_imparticion[0]->id_modalidad), $PRINCIPAL);
    $PRINCIPAL = str_replace("{ROW_SESIONES}", ($row), $PRINCIPAL);
    $PRINCIPAL = str_replace("{ROW_LISTADO_COLABORADORES}", utf8_encode($row_listado_colaboradores), $PRINCIPAL);
    return ($PRINCIPAL);
}

function lista_proveedores_ejecutivos_fn($html, $id_empresa, $tipo)
{
    $Lista = lista_proveedores_ejecutivos_data($id_empresa, $tipo);
    //print_r($Lista);
    foreach ($Lista as $unico) {
        if ($tipo == "ejecutivos") {
            $row = file_get_contents("views/proveedores_otec/row_ejecutivos.html");
            $row = str_replace("{ID_ENC}", Encodear3($unico->id), $row);
            $row = str_replace("{ID}", ($unico->id), $row);
            $row = str_replace("{RUT}", utf8_encode($unico->rut), $row);
            $row = str_replace("{NOMBRE}", utf8_encode($unico->nombre), $row);
            $row = str_replace("{DESCRIPCION}", utf8_encode($unico->descripcion), $row);
            $row = str_replace("{ID_TIPO}", utf8_encode($tipo), $row);
            $row = str_replace("{TIPO_EJECUTIVO}", utf8_encode($unico->tipo_ejecutivo), $row);
        } elseif ($tipo == "otec") {
            $row = file_get_contents("views/proveedores_otec/row_proveedores.html");
            $row = str_replace("{ID_ENC}", Encodear3($unico->id), $row);
            $row = str_replace("{ID}", ($unico->id), $row);
            $row = str_replace("{RUT}", utf8_encode($unico->rut), $row);
            $row = str_replace("{NOMBRE}", utf8_encode($unico->nombre), $row);
            $row = str_replace("{DESCRIPCION}", utf8_encode($unico->descripcion), $row);
            $row = str_replace("{DIRECCION}", utf8_encode($unico->direccion), $row);
            $row = str_replace("{TELEFONO}", utf8_encode($unico->telefono), $row);
            $row = str_replace("{EMAIL}", utf8_encode($unico->email), $row);
            $row = str_replace("{CONTACTO}", utf8_encode($unico->contacto), $row);
            $row = str_replace("{ID_TIPO}", utf8_encode($tipo), $row);
        } elseif ($tipo == "relatores") {
            $row = file_get_contents("views/proveedores_otec/row_relatores.html");
            $row = str_replace("{ID_ENC}", Encodear3($unico->id), $row);
            $row = str_replace("{ID}", ($unico->id), $row);
            $row = str_replace("{RUT}", utf8_encode($unico->rut), $row);
            $row = str_replace("{NOMBRE}", utf8_encode($unico->nombre), $row);
            $row = str_replace("{CARGO}", utf8_encode($unico->cargo), $row);
            $row = str_replace("{EMAIL}", utf8_encode($unico->email), $row);
            $row = str_replace("{TIPO_RELATOR}", utf8_encode($unico->tipo), $row);


            if ($unico->tipo == "Interno") {
                $Nombre_empresaa = "Banco de Chile";
            } else {
                $Nombre_empresaa = NombreEmpresaOtec($unico->empresa);
            }
            $row = str_replace("{EMPRESA}", utf8_encode($Nombre_empresaa), $row);
            $row = str_replace("{ID_TIPO}", utf8_encode($tipo), $row);
        } elseif ($tipo == "administradores") {
            $row = file_get_contents("views/proveedores_otec/row_administradores.html");
            $row = str_replace("{ID_ENC}", Encodear3($unico->id), $row);
            $row = str_replace("{ID}", ($unico->id), $row);
            $row = str_replace("{RUT}", utf8_encode($unico->user), $row);
            $row = str_replace("{NOMBRE}", utf8_encode($unico->nombre_completo), $row);
            $row = str_replace("{CARGO}", utf8_encode($unico->cargo), $row);
            $row = str_replace("{EMAIL}", utf8_encode($unico->email), $row);
            $row = str_replace("{TIPO_RELATOR}", utf8_encode($unico->tipo), $row);
            $row = str_replace("{ACCESO}", utf8_encode($unico->acceso), $row);
            $row = str_replace("{PERFIL}", utf8_encode($unico->perfil), $row);
            $row = str_replace("{EMPRESA}", utf8_encode($unico->empresa), $row);
            $row = str_replace("{ID_TIPO}", utf8_encode($tipo), $row);
        } elseif ($tipo == "usuarios_manuales") {
            $row = file_get_contents("views/proveedores_otec/row_usuarios_manuales.html");
            $row = str_replace("{ID_ENC}", Encodear3($unico->id), $row);
            $row = str_replace("{ID}", ($unico->id), $row);
            $row = str_replace("{RUT}", utf8_encode($unico->rut), $row);
            $row = str_replace("{NOMBRE}", utf8_encode($unico->nombre), $row);
            $row = str_replace("{APELLIDO}", utf8_encode($unico->apaterno), $row);
            $row = str_replace("{EMAIL}", utf8_encode($unico->email), $row);
            $row = str_replace("{TIPO_RELATOR}", utf8_encode($unico->tipo), $row);
            $row = str_replace("{EMPRESA}", utf8_encode($unico->nombre_empresa_holding), $row);
            $row = str_replace("{ID_TIPO}", utf8_encode($tipo), $row);
        } elseif ($tipo == "usuarios_externos") {
            $row = file_get_contents("views/proveedores_otec/row_usuarios_externos.html");
            $row = str_replace("{ID_ENC}", Encodear3($unico->id), $row);
            $row = str_replace("{ID}", ($unico->id), $row);
            $row = str_replace("{RUT}", utf8_encode($unico->rut), $row);
            $row = str_replace("{NOMBRE}", utf8_encode($unico->nombre), $row);
            $row = str_replace("{APELLIDO}", utf8_encode($unico->apaterno), $row);
            $row = str_replace("{APELLIDO_MATERNO}", utf8_encode($unico->amaterno), $row);
            $row = str_replace("{EMAIL}", utf8_encode($unico->email), $row);
            $row = str_replace("{TIPO_RELATOR}", utf8_encode($unico->tipo), $row);
            $row = str_replace("{EMPRESA}", utf8_encode($unico->nombre_empresa_holding), $row);
            $row = str_replace("{ID_TIPO}", utf8_encode($tipo), $row);
        } elseif ($tipo == "direcciones") {
            $row = file_get_contents("views/proveedores_otec/row_direcciones.html");
            $row = str_replace("{ID_ENC}", Encodear3($unico->id), $row);
            $row = str_replace("{ID}", ($unico->id), $row);

            if ($unico->tipo == "Fisica") {
                $unico->ciudad = Regiones_id_2022($unico->ciudad);
                $unico->comuna = Comunas_id_2022($unico->comuna);
            }

            $row = str_replace("{NOMBRE}", utf8_encode($unico->nombre), $row);
            $row = str_replace("{DIRECCION}", utf8_encode($unico->direccion), $row);
            $row = str_replace("{TELEFONO}", utf8_encode($unico->ciudad), $row);
            $row = str_replace("{EMAIL}", utf8_encode($unico->comuna), $row);
            $row = str_replace("{CONTACTO}", utf8_encode($unico->tipo), $row);
            $row = str_replace("{ID_TIPO}", utf8_encode($tipo), $row);
        } elseif ($tipo == "foco") {
            $row = file_get_contents("views/proveedores_otec/row_focos.html");
            $row = str_replace("{ID_ENC}", Encodear3($unico->id), $row);
            $row = str_replace("{ID}", ($unico->id), $row);
            $row = str_replace("{NOMBRE}", utf8_encode($unico->descripcion), $row);
            $row = str_replace("{DIRECCION}", utf8_encode($unico->codigo_foco), $row);
            $row = str_replace("{TELEFONO}", utf8_encode($unico->ciudad), $row);
            $row = str_replace("{EMAIL}", utf8_encode($unico->comuna), $row);
            $row = str_replace("{CONTACTO}", utf8_encode($unico->tipo), $row);
            $row = str_replace("{ID_TIPO}", utf8_encode($tipo), $row);
        } elseif ($tipo == "programas") {
            $row = file_get_contents("views/proveedores_otec/row_programas.html");
            $row = str_replace("{ID_ENC}", Encodear3($unico->id), $row);
            $row = str_replace("{ID}", ($unico->id), $row);
            $row = str_replace("{NOMBRE}", utf8_encode($unico->nombre_programa), $row);
            $row = str_replace("{DIRECCION}", utf8_encode($unico->id_programa), $row);
            $row = str_replace("{TELEFONO}", utf8_encode($unico->ciudad), $row);
            $row = str_replace("{EMAIL}", utf8_encode($unico->comuna), $row);
            $row = str_replace("{CONTACTO}", utf8_encode($unico->tipo), $row);
            $row = str_replace("{ID_TIPO}", utf8_encode($tipo), $row);
            $lista_cuentas = lista_cuentas_data($id_empresa);
            $options_cuenta="<option>Selecciona una opción</option>";
            foreach ($lista_cuentas as $unicoc) {
                $selected ="";
                if($unicoc->cuenta_id==$unico->cuenta_id){
                    $selected ="selected";
                }
                $options_cuenta .= "<option value='" . $unicoc->cuenta_id . "' $selected>" . $unicoc->cuenta_num." | ".utf8_encode($unicoc->cuenta_dsc) ."</option>";
            }
            $row = str_replace("{OPTIONS_CUENTAS}", $options_cuenta, $row);
        }elseif ($tipo == "cuentas") {
            $row = file_get_contents("views/proveedores_otec/row_cuentas.html");
            $row = str_replace("{ID_ENC}", Encodear3($unico->cuenta_id), $row);
            $row = str_replace("{ID}", ($unico->cuenta_id), $row);
            $row = str_replace("{NOMBRE}", utf8_encode($unico->cuenta_dsc), $row);
            $row = str_replace("{RUT}", utf8_encode($unico->cuenta_num), $row);
            $row = str_replace("{ID_TIPO}", utf8_encode($tipo), $row);
        }

        $total_html .= $row;
    }
    $total_html = str_replace("{NIVEL}", "2", $total_html);
    $total_html = str_replace("{SUB_CAT}", "", $total_html);
    $total_html = str_replace("{NSUB}", "", $total_html);
    $html = str_replace("{OPTIONS_CATEGORIAS_MEJORES_PRACTICAS_NUEVO}", utf8_encode($categorias_options), $html);

    $lista_otec = lista_otec_vista_data($id_empresa);
    //print_r($lista_otec);
    foreach ($lista_otec as $unico) {
        $options_otec .= "<option value='" . $unico->rut . "'>" . $unico->nombre . " (" . $unico->rut . ")</option>";
    }
    $html = str_replace("{options_proveedores_nombre_rut}", $options_otec, $html);

    $Region = Regiones_2022();
    foreach ($Region as $unico) {
        $options_regiones .= "<option value='" . $unico->id_regiones . "'>" . utf8_encode($unico->nombre) . "</option>";
    }
    $html = str_replace("{options_regiones}", $options_regiones, $html);
    if ($tipo == "programas") {
        $lista_cuentas = lista_cuentas_data($id_empresa);
        $options_cuenta="<option>Selecciona una opción</option>";
        foreach ($lista_cuentas as $unico) {
            $options_cuenta .= "<option value='" . $unico->cuenta_id . "'>" . $unico->cuenta_num." | ".utf8_encode($unico->cuenta_dsc) ."</option>";
        }
    }
    $html = str_replace("{LISTA}", $total_html, $html);
    $html = str_replace("{TITULO}", "Preguntas y Respuestas", $html);
    $html = str_replace("{BTN}", "Nueva Pregunta", $html);
    $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
    $html = str_replace("{BTN_VOLVER}", '', $html);
    $html = str_replace("{COLUMNA}", 'Pregunta', $html);
    $html = str_replace("{COLUMNA}", 'Pregunta', $html);

    global $Texto_Pilar, $Texto_Programa;
    $html = str_replace("{Texto_Pilar}", $Texto_Pilar, $html);
    $html = str_replace("{OPTIONS_CUENTAS}", $options_cuenta, $html);

    return ($html);
}

// CREACION DE CURSOS PRESENCIALES


//**Rel idInscripcion rut Curso
function fn_rel_id_inscripcion_rut_curso_lista($PRINCIPAL, $id_empresa, $filtro, $post, $get, $request, $excel)
{


    $excel = $get["excel"];

    /*echo "<br>fn_rel_id_inscripcion_rut_curso_lista<br>";
   echo "<br>post<br>";
   		print_r($post);
   echo "<br>get<br>";
   		print_r($get);
   echo "<br><br>
   excel $excel<br><br>";*/

    $array_cursos = data_rel_id_inscripcion_curso_groupby_data($id_empresa);
    foreach ($array_cursos as $unico) {
        $row_listado_id_inscripcion_cursos .= "<tr>";
        $row_listado_id_inscripcion_cursos .= "<td><a href='?sw=rel_id_inscripcion_rut_curso&id_curso=" . $unico->id_curso . "' class='btn btn-link'>" . utf8_encode($unico->id_curso) . "</a></td>";
        $row_listado_id_inscripcion_cursos .= "<td><a href='?sw=rel_id_inscripcion_rut_curso&id_curso=" . $unico->id_curso . "' class='btn btn-link'>" . utf8_encode($unico->curso) . "</a></td>";

        $row_listado_id_inscripcion_cursos .= "<td><a href='?sw=rel_id_inscripcion_rut_curso&id_curso=" . $unico->id_curso . "' class='btn btn-link'>" . utf8_encode($unico->programa) . "</a>
						<br><a href='?sw=rel_id_inscripcion_rut_curso&id_curso=" . $unico->id_curso . "' class='btn btn-link'>" . utf8_encode($unico->malla) . "</a></td>";


        $row_listado_id_inscripcion_cursos .= "<td>";
        $array_ins = data_rel_id_inscripcion_curso_groupby_id_curso_data($unico->id_curso, $id_empresa);
        //print_r($array_ins);exit();
        foreach ($array_ins as $unico2) {
            $row_listado_id_inscripcion_cursos .= "<a href='?sw=rel_id_inscripcion_rut_curso&id_inscripcion=" . $unico2->id_inscripcion . "' class='btn btn-link'>" . $unico2->id_inscripcion . "</a> " . $unico2->fecha_inicio_inscripcion . " - " . $unico2->fecha_termino_inscripcion . "<br>";
        }


        $option_progra_malla = data_rel_progra_malla_por_curso_lista($unico->id_curso, $id_empresa);
        $options_select = "";
        foreach ($option_progra_malla as $unico) {
            $options_select .= "<option value='" . $unico->IdGroupBy . "'>" . $unico->GroupBy . "</option>";
        }

        $row_listado_id_inscripcion_cursos .= "
													
													<div class='accordion' id='accordion_" . $unico->id_curso . "'>
													  <div class='accordion-item' style='border: none;'>
													    <h2 class='accordion-header' id='heading_" . $unico->id_curso . "'>
													      <button class='btn btn-link pull-right' type='button' data-bs-toggle='collapse' data-bs-target='#collapse_" . $unico->id_curso . "' aria-expanded='true' aria-controls='collapse_" . $unico->id_curso . "'>
													        Agregar Nueva Id Inscripci&oacute;n
													      </button>
													    </h2>
													    <div id='collapse_" . $unico->id_curso . "' class='accordion-collapse collapse' aria-labelledby='heading_" . $unico->id_curso . "' data-bs-parent='#accordion_" . $unico->id_curso . "'>
													      <div class='accordion-body'>
													        <form name='" . $unico->id_curso . "' id='" . $unico->id_curso . "' action='?sw=usuarios_insert_tbl_rel_id_inscripcion_rut_curso' method='post' style='display: inline-block;' enctype='multipart/form-data'>
													        	Id Inscripci&oacute;n:<br>
													        	<input type='text' 	name='id_inscripcion' id='id_inscripcion'  	class='form form-control' required >
													        	
													        	Nombre:<br>
													        	<input type='text' 	name='nombre_inscripcion' id='nombre_inscripcion'  	class='form form-control' required >
													        	
													        	Fecha Inicio:<br>
													        	<input type='date' name='fecha_inicio' id='fecha_inicio' 			class='form form-control' required >
													        	
													        	Fecha T&eacute;rmino:<br>
													        	<input type='date' name='fecha_termino' id='fecha_termino' 		class='form form-control' required>

													        	Ejecutivo (Rut):<br>
													        	<input type='number' name='rut_ejecutivo' id='rut_ejecutivo' 		class='form form-control' required>

													        	<input type='hidden' name='nueva_id_inscripcion' id='nueva_id_inscripcion' value='1' >
													        	<input type='hidden' name='id_curso' id='id_curso' value='" . $unico->id_curso . "' >
																		
													        	Programa / Malla:<br>
													        	
																			<select name='programa_malla' id='programa_malla' class='form form-control' required>
																				<option value=''></option>
																				" . utf8_encode($options_select) . "
																			</select>
																			<br>
																			Opcional <input type='checkbox' name='opcional' id='opcional'>

																		<br>
																		Colaboradores (opcional):<br>	
																		<a href='rut.csv' class='btn btn-link'>Descarga Plantilla</a>;
										                <input type='file' name='file' /> 
										                <input type='hidden' value='upload' name='action' /> 
													        	<center><input type='submit' class='btn btn-info' value='Crear'></center>
													        </form>
													      </div>
													    </div>
													  </div>
													</div>													
													";

    }


    $PRINCIPAL = str_replace("{ROW_LISTADO_CURSO_IDINSCRIPCION}", $row_listado_id_inscripcion_cursos, $PRINCIPAL);


    $array = data_rel_id_inscripcion_rut_curso_lista_por_idcurso_idinscripcion_data($get["id_curso"], $get["id_inscripcion"], $request["rut_colaborador"], $id_empresa);
    if (count($array) == "0") {
        $display_id_inscripcion_rut_cursos = " display:none; ";
        $display_id_inscripcion_rut_cursos_v2 = "  ";
    } else {
        $display_id_inscripcion_rut_cursos = " ";
        $display_id_inscripcion_rut_cursos_v2 = " display:none; ";

    }

    $PRINCIPAL = str_replace("{display_id_inscripcion_rut_cursos}", $display_id_inscripcion_rut_cursos, $PRINCIPAL);
    $PRINCIPAL = str_replace("{display_id_inscripcion_rut_cursos_v2}", $display_id_inscripcion_rut_cursos_v2, $PRINCIPAL);

    if ($excel == "1") {

        header('Content-Description: File Transfer');
        header('Content-Type: application/csv');
        header("Content-Disposition: attachment; filename=Base_IdInscripcion.csv");
        header('Cache-Control: must-revalidate, post-check=0, pre-check=0');

        $handle = fopen('php://output', 'w');
        ob_clean();
        echo "rut;id_inscripcion;id_curso;fecha_inicio;fecha_termino;activo;ejecutivo\r\n";
    }


    foreach ($array as $unico) {
        //$ProgramaArray=reportes_online_busca_programas_dado_idCurso($unico->id);			//$Programa="";
        //foreach ($ProgramaArray as $unico2){//$Programa.="".$unico2->programa."<br>";//}

        if ($unico->activa == 1) {
            $activo = "ACTIVA";
        } else {
            $activo = "INACTIVA";
        }

        if ($excel == "1") {

            echo "" . $unico->rut . ";" . $unico->id_inscripcion . ";" . $unico->id_curso . ";" . $unico->fecha_inicio_inscripcion . ";" . $unico->fecha_termino_inscripcion . ";" . $activo . ";" . $unico->rut_ejecutivo . "\r\n";

        } else {

            $row_listado_id_inscripcion_rut_cursos .= "<tr>";
            $row_listado_id_inscripcion_rut_cursos .= "<td>" . utf8_encode($unico->rut) . "</td>";
            $row_listado_id_inscripcion_rut_cursos .= "<td>" . utf8_encode($unico->id_inscripcion) . "</td>";
            $row_listado_id_inscripcion_rut_cursos .= "<td>" . utf8_encode($unico->id_curso) . "</td>";

            $row_listado_id_inscripcion_rut_cursos .= "<td>" . utf8_encode($unico->fecha_inicio_inscripcion) . "</td>";
            $row_listado_id_inscripcion_rut_cursos .= "<td>" . utf8_encode($unico->fecha_termino_inscripcion) . "</td>";
            $row_listado_id_inscripcion_rut_cursos .= "<td>" . utf8_encode($activo) . "</td>";
            $row_listado_id_inscripcion_rut_cursos .= "<td>" . utf8_encode($unico->rut_ejecutivo) . "</td>";
            $row_listado_id_inscripcion_rut_cursos .= "</tr>";

        }


    }


    if ($excel == "1") {
        ob_flush();
        fclose($handle);
        die();
        exit();
    }

    $PRINCIPAL = str_replace("{ROW_LISTADO_ID_INSCRIPCION_RUT_CURSOS}", $row_listado_id_inscripcion_rut_cursos, $PRINCIPAL);
    $PRINCIPAL = str_replace("{ROW_LISTADO_PROGRAMAS_DETALLE}", $row_listado_programas_detalle, $PRINCIPAL);

    $display_rut_colaborador = "display:none; ";
    //print_r($_SESSION);
    if ($_SESSION["cuenta_filter"] == "1") {
        $filter_text .= "<strong>Filtros </strong>: ";
        if ($_SESSION["c1text"] <> "") {
            $filter_text .= "&nbsp;<span class='badge badge-secondary'>" . $_SESSION["c1text"] . "</span>&nbsp;";
        }
        if ($_SESSION["c2text"] <> "") {
            $filter_text .= "&nbsp;<span class='badge badge-secondary'>" . $_SESSION["c2text"] . "</span>&nbsp;";
        }
        if ($_SESSION["c3text"] <> "") {
            $filter_text .= "&nbsp;<span class='badge badge-secondary'>" . $_SESSION["c3text"] . "</span>&nbsp;";
        }
        if ($_SESSION["c4text"] <> "") {
            $filter_text .= "&nbsp;<span class='badge badge-secondary'>" . $_SESSION["c4text"] . "</span>&nbsp;";
        }
        if ($_SESSION["rut_colaborador_text"] <> "") {
            $filter_text .= "&nbsp;<span class='badge badge-secondary'>" . $_SESSION["rut_colaborador_text"] . "</span>&nbsp;";
            $display_rut_colaborador = "";
        } else {
        }


    } else {
        $filter_text = "";
    }
    $PRINCIPAL = str_replace("{DISPLAY_RUT_COLABORADOR}", $display_rut_colaborador, $PRINCIPAL);
    $PRINCIPAL = str_replace("{FILTROS_REALIZADOS_FILTRO_SUPERIOR}", $filter_text, $PRINCIPAL);

    $PRINCIPAL = str_replace("{ID_INSCRIPCION_GET}", $get["id_inscripcion"], $PRINCIPAL);
    $PRINCIPAL = str_replace("{ID_CURSO_GET}", $get["id_curso"], $PRINCIPAL);
    $PRINCIPAL = str_replace("{RUT_COL_GET}", $request["rut_colaborador"], $PRINCIPAL);

    echo $PRINCIPAL;
}

//**Rel idInscripcion rut Curso

//**reportes_online**

function reportes_online_lista_cursos_full_checkbox($id_empresa)
{

    $tipo = "CursoFull";
    $array = reportes_online_lista_cursos_programa_data($id_empresa, $tipo);
    //print_r($array);
    foreach ($array as $unico) {
        $checkbox .= "
					<tr>
						<td><input type='checkbox' name='" . $unico->id . "' value='1'> " . $unico->id . "</td>
						<td>" . strip_tags(utf8_encode($unico->nombre)) . "</td>
						<td>" . strip_tags(utf8_encode($unico->programa)) . "</td>
					</tr>
					";
    }
    return $checkbox;
}

function reportes_online_lista_cursos_checkbox($id_empresa)
{

    $tipo = "Curso";
    $array = reportes_online_lista_cursos_programa_data($id_empresa, $tipo);
    //print_r($array);
    foreach ($array as $unico) {
        $checkbox .= "<input type='checkbox' name='" . $unico->id . "' value='1'> " . $unico->id . " " . strip_tags(utf8_encode($unico->nombre)) . "<br>";
    }
    return $checkbox;
}

function reportes_online_lista_cursos_programa($PRINCIPAL, $id_empresa, $filtro, $excel)
{

    $Array_C1C2C3C4 = reportes_online_trae_c1c2c3c4($id_empresa);
    //print_r($Array_C1C2C3C4);


    $PRINCIPAL = str_replace("{C1}", $Array_C1C2C3C4[0]->c1_texto, $PRINCIPAL);
    $PRINCIPAL = str_replace("{C2}", $Array_C1C2C3C4[0]->c2_texto, $PRINCIPAL);
    $PRINCIPAL = str_replace("{C3}", $Array_C1C2C3C4[0]->c3_texto, $PRINCIPAL);
    $PRINCIPAL = str_replace("{C4}", $Array_C1C2C3C4[0]->c4_texto, $PRINCIPAL);

    $Options_c1 = reportes_online_groupby_c1c2c3c4("c1");
    $op_c1 .= "<option value=''></option>";
    foreach ($Options_c1 as $unico) {
        if (($unico->dato) == $_POST["c1"]) {
            $selected = " selected ";
        } else {
            $selected = "";
        }
        if (($unico->dato) == $_POST["c1"]) {
            $selected1 = " checked ";
        } else {
            $selected1 = "";
        }
        if (($unico->dato) == $_POST["c1"] or utf8_encode($unico->dato) == ($_SESSION["dato_final_filtro"])) {
            $selected1 = " checked ";
        } else {
            $selected1 = "";
        }

        //echo "<br>--> -> unico->dato ".$unico->dato." -> POST[c1] ".$_POST["c1"]." -> SESSION[dato_final_filtro] ".$_SESSION["dato_final_filtro"]." ------> selected1 ".$selected1;

        $op_c1 .= "<option value='" . utf8_encode($unico->dato) . "' " . $selected . ">" . utf8_encode($unico->dato) . "</option>";
        $op_c1_checkbox .= "
  							<div class='col-lg-4'>
  								<input type='checkbox' id='" . utf8_encode($unico->dato) . "' name='" . $Array_C1C2C3C4[0]->c1_texto . "_" . utf8_encode($unico->dato) . "' value='" . utf8_encode($unico->dato) . "' " . $selected1 . "> " . utf8_encode($unico->dato) . "
  							</div>";
    }

    $Options_c2 = reportes_online_groupby_c1c2c3c4("c2");
    $op_c2 .= "<option value=''></option>";
    foreach ($Options_c2 as $unico) {
        if ($unico->dato == $_POST["c2"]) {
            $selected = " selected ";
        } else {
            $selected = "";
        }
        $op_c2 .= "<option value='" . utf8_encode($unico->dato) . "' " . $selected . ">" . utf8_encode($unico->dato) . "</option>";
    }

    $Options_c3 = reportes_online_groupby_c1c2c3c4("c3");
    $op_c3 .= "<option value=''></option>";
    foreach ($Options_c3 as $unico) {
        if ($unico->dato == $_POST["c3"]) {
            $selected = " selected ";
        } else {
            $selected = "";
        }
        $op_c3 .= "<option value='" . utf8_encode($unico->dato) . "' " . $selected . ">" . utf8_encode($unico->dato) . "</option>";
    }

    $Options_c4 = reportes_online_groupby_c1c2c3c4("c4");
    $op_c4 .= "<option value=''></option>";
    foreach ($Options_c4 as $unico) {
        if ($unico->dato == $_POST["c4"]) {
            $selected = " selected ";
        } else {
            $selected = "";
        }
        $op_c4 .= "<option value='" . utf8_encode($unico->dato) . "' " . $selected . ">" . utf8_encode($unico->dato) . "</option>";
    }

    $PRINCIPAL = str_replace("{OPTIONS_C1}", $op_c1, $PRINCIPAL);
    $PRINCIPAL = str_replace("{OPTIONS_C1_CHECKBOXS}", $op_c1_checkbox, $PRINCIPAL);

    $PRINCIPAL = str_replace("{OPTIONS_C2}", $op_c2, $PRINCIPAL);
    $PRINCIPAL = str_replace("{OPTIONS_C3}", $op_c3, $PRINCIPAL);
    $PRINCIPAL = str_replace("{OPTIONS_C4}", $op_c4, $PRINCIPAL);

    $PRINCIPAL = str_replace("{rut_colaborador}", $_POST["rut_colaborador"], $PRINCIPAL);

    $tipo = "Curso";
    $array = reportes_online_lista_cursos_programa_data($id_empresa, $tipo);

    foreach ($array as $unico) {

        $ProgramaArray = reportes_online_busca_programas_dado_idCurso($unico->id);
        $Programa = "";
        foreach ($ProgramaArray as $unico2) {
            $Programa .= "" . $unico2->programa . "<br>";
        }

        $row_listado_cursos .= "<tr>";
        $row_listado_cursos .= "<td>" . utf8_encode($unico->id) . "</td>";
        $row_listado_cursos .= "<td>" . utf8_encode($unico->nombre) . "</td>";
        $row_listado_cursos .= "<td>" . utf8_encode($Programa) . "</td>";
        $row_listado_cursos .= "<td><a href='?sw=reportes_online_descarga&id=" . $unico->id . "&tipo=" . $tipo . "'>Descargar Reporte</a></td>";
        $row_listado_cursos .= "<td><a href='?sw=reportes_online_descarga&id=" . $unico->id . "&tipo=" . $tipo . "&vista=graph'>Ver Resumen</a></td>";
        $row_listado_cursos .= "</tr>";
    }

    $PRINCIPAL = str_replace("{ROW_LISTADO_CURSOS}", $row_listado_cursos, $PRINCIPAL);

    $tipo = "Programa";
    $array = reportes_online_lista_cursos_programa_data($id_empresa, $tipo);

    foreach ($array as $unico) {
        $row_listado_programas .= "<tr>";
        $row_listado_programas .= "<td>" . utf8_encode($unico->id) . "</td>";
        $row_listado_programas .= "<td>" . utf8_encode($unico->nombre) . "</td>";
        $row_listado_programas .= "<td><a href='?sw=reportes_online_descarga&id=" . $unico->id . "&tipo=" . $tipo . "Consolidado'>Descargar Reporte</a></td>";
        $row_listado_programas .= "<td><a href='?sw=reportes_online_descarga&id=" . $unico->id . "&tipo=" . $tipo . "Consolidado&vista=graph'>Ver Resumen</a></td>";
        $row_listado_programas .= "</tr>";
    }

    $PRINCIPAL = str_replace("{ROW_LISTADO_PROGRAMAS}", $row_listado_programas, $PRINCIPAL);

    $tipo = "ProgramaDetalle";
    $array = reportes_online_lista_cursos_programa_data($id_empresa, $tipo);

    foreach ($array as $unico) {
        $row_listado_programas_detalle .= "<tr>";
        $row_listado_programas_detalle .= "<td>" . utf8_encode($unico->id) . "</td>";
        $row_listado_programas_detalle .= "<td>" . utf8_encode($unico->nombre) . "</td>";
        $row_listado_programas_detalle .= "<td>
				<a href='?sw=reportes_online_descarga&id=" . $unico->id . "&tipo=" . $tipo . "'>Descargar Reporte</a>
				<br>
				<a href='?sw=reportes_online_descarga&id=" . $unico->id . "&tipo=" . $tipo . "_historico'>Descargar Reporte Historico</a>
				</td>";
        $row_listado_programas_detalle .= "</tr>";
    }

    $PRINCIPAL = str_replace("{ROW_LISTADO_PROGRAMAS_DETALLE}", $row_listado_programas_detalle, $PRINCIPAL);

    $display_rut_colaborador = "display:none; ";
    //print_r($_SESSION);
    if ($_SESSION["cuenta_filter"] == "1") {
        $filter_text .= "<strong>Filtros </strong>: ";
        if ($_SESSION["c1text"] <> "") {
            $filter_text .= "&nbsp;<span class='badge badge-secondary'>" . $_SESSION["c1text"] . "</span>&nbsp;";
        }
        if ($_SESSION["c2text"] <> "") {
            $filter_text .= "&nbsp;<span class='badge badge-secondary'>" . $_SESSION["c2text"] . "</span>&nbsp;";
        }
        if ($_SESSION["c3text"] <> "") {
            $filter_text .= "&nbsp;<span class='badge badge-secondary'>" . $_SESSION["c3text"] . "</span>&nbsp;";
        }
        if ($_SESSION["c4text"] <> "") {
            $filter_text .= "&nbsp;<span class='badge badge-secondary'>" . $_SESSION["c4text"] . "</span>&nbsp;";
        }
        if ($_SESSION["rut_colaborador_text"] <> "") {
            $filter_text .= "&nbsp;<span class='badge badge-secondary'>" . $_SESSION["rut_colaborador_text"] . "</span>&nbsp;";
            $display_rut_colaborador = "";
        } else {
        }


    } else {
        $filter_text = "";
    }

    $CheckBox_Cursos = reportes_online_lista_cursos_checkbox($id_empresa);
    $PRINCIPAL = str_replace("{cursos_agrupacion_checkbox}", $CheckBox_Cursos, $PRINCIPAL);


    $tipo = "Agrupaciones";
    $array = reportes_online_lista_cursos_programa_data($id_empresa, $tipo);
    //print_r($array);
    $id_agrupacion = "";
    foreach ($array as $unico) {
        $ListaCursos = reportes_online_ListaCursoDadoIdAgrupacion($unico->id_agrupacion);
        $lista_nombre_cursos = "";
        //print_r($ListaCursos);
        foreach ($ListaCursos as $unico2) {
            $lista_nombre_cursos .= $unico2->id_curso . " " . $unico2->nombre_curso . "<br>";
        }
        $row_listado_agrupaciones .= "<tr>";
        $row_listado_agrupaciones .= "<td>" . utf8_encode($unico->id_agrupacion) . "</td>";
        $row_listado_agrupaciones .= "<td>" . utf8_encode($unico->nombre) . "</td>";
        $row_listado_agrupaciones .= "<td>" . utf8_encode($lista_nombre_cursos) . "</td>";
        $row_listado_agrupaciones .= "<td>
					<a href='?sw=reportes_online_descarga&id=" . $unico->id_agrupacion . "&tipo=" . $tipo . "'>Descargar Reporte</a>
					<br>
					<a href='?sw=reportes_online_descarga&id=" . $unico->id_agrupacion . "&tipo=AgrupacionesHistorico'>Descargar Reporte Historico</a>
					<br>
					<a href='?sw=reportes_online_descarga&id=" . $unico->id_agrupacion . "&tipo=AgrupacionesConsolidadoC1'>Descargar Reporte Consolidado</a>
					<br>
					
					
					</td>";
        $row_listado_agrupaciones .= "</tr>";
    }

    $PRINCIPAL = str_replace("{ROW_LISTADO_AGRUPACION}", $row_listado_agrupaciones, $PRINCIPAL);
    $PRINCIPAL = str_replace("{DISPLAY_RUT_COLABORADOR}", $display_rut_colaborador, $PRINCIPAL);
    $PRINCIPAL = str_replace("{FILTROS_REALIZADOS_FILTRO_SUPERIOR}", $filter_text, $PRINCIPAL);

    // options reportes completos
    $options_anos_array = ReportesCompletos_options_years_data();
    $op_rc_anos .= "<option value=''></option>";
    foreach ($options_anos_array as $unico) {
        if ($unico->dato == $_SESSION["op_rc_anos"]) {
            $selected = " selected ";
        } else {
            $selected = "";
        }
        $op_rc_anos .= "<option value='" . utf8_encode($unico->dato) . "' " . $selected . ">" . utf8_encode($unico->dato) . "</option>";
    }
    $PRINCIPAL = str_replace("{OPTIONS_RC_ANOS}", $op_rc_anos, $PRINCIPAL);

    $options_gerencia_array = ReportesCompletos_options_gerencia_data();
    $op_rc_gerencia .= "<option value=''></option>";
    foreach ($options_gerencia_array as $unico) {
        if ($unico->dato == $_SESSION["op_rc_gerencia"]) {
            $selected = " selected ";
        } else {
            $selected = "";
        }
        $op_rc_gerencia .= "<option value='" . utf8_encode($unico->dato) . "' " . $selected . ">" . utf8_encode($unico->dato) . "</option>";
    }
    $PRINCIPAL = str_replace("{OPTIONS_RC_GERENCIA}", $op_rc_gerencia, $PRINCIPAL);

    $options_programa_array = ReportesCompletos_options_programa_data();
    $op_rc_programa .= "<option value=''></option>";
    foreach ($options_programa_array as $unico) {
        if ($unico->dato == $_SESSION["op_rc_programa"]) {
            $selected = " selected ";
        } else {
            $selected = "";
        }
        $op_rc_programa .= "<option value='" . utf8_encode($unico->dato) . "' " . $selected . ">" . utf8_encode($unico->nombre) . "</option>";
    }
    $PRINCIPAL = str_replace("{OPTIONS_RC_PROGRAMA}", $op_rc_programa, $PRINCIPAL);

    $op_rc_tipos_reportes .= "
 														<option value=''></option>
 														<option value='Completo'>Descargar Reporte Historico</option>
 														<option value='Historico'>Descargar Reporte Normativos y Transversales</option>
 														
 														";
    $PRINCIPAL = str_replace("{OPTIONS_RC_TIPOS_REPORTES}", $op_rc_tipos_reportes, $PRINCIPAL);

    $options_colaboradores_array = ReportesCompletos_options_colaboradores_data();
    $op_rc_colaboradores .= "<option value=''></option>";
    foreach ($options_colaboradores_array as $unico) {
        if ($unico->dato == $_SESSION["op_rc_colaboradores"]) {
            $selected = " selected ";
        } else {
            $selected = "";
        }
        $op_rc_colaboradores .= "<option value='" . utf8_encode($unico->dato) . "' " . $selected . ">" . utf8_encode($unico->nombre) . "</option>";
    }
    $PRINCIPAL = str_replace("{OPTIONS_RC_COLABORADORES}", $op_rc_colaboradores, $PRINCIPAL);

    echo $PRINCIPAL;
}

function reportes_online_lista_agrupaciones($PRINCIPAL, $id_empresa, $filtro, $excel, $IdAgrup)
{

    $Array_C1C2C3C4 = reportes_online_trae_c1c2c3c4($id_empresa);
    $CheckBox_Cursos = reportes_online_lista_cursos_full_checkbox($id_empresa);
    $PRINCIPAL = str_replace("{cursos_agrupacion_checkbox}", $CheckBox_Cursos, $PRINCIPAL);

    $PRINCIPAL = str_replace("{rut_colaborador}", $_POST["rut_colaborador"], $PRINCIPAL);
    $PRINCIPAL = str_replace("{ROW_LISTADO_CURSOS}", $row_listado_cursos, $PRINCIPAL);

    $tipo = "Agrupaciones";
    $array = reportes_online_lista_cursos_programa_data($id_empresa, $tipo);
    //print_r($array);
    $id_agrupacion = "";
    foreach ($array as $unico) {
        $ListaCursos = reportes_online_ListaCursoDadoIdAgrupacion($unico->id_agrupacion);
        $lista_nombre_cursos = "";
        //print_r($ListaCursos);
        foreach ($ListaCursos as $unico2) {
            $lista_nombre_cursos .= $unico2->id_curso . " " . $unico2->nombre_curso . "<br>";
        }
        $row_listado_agrupaciones .= "<tr>";
        $row_listado_agrupaciones .= "<td>" . utf8_encode($unico->id_agrupacion) . "</td>";
        $row_listado_agrupaciones .= "<td>" . utf8_encode($unico->nombre) . "</td>";
        $row_listado_agrupaciones .= "<td>" . utf8_encode($lista_nombre_cursos) . "</td>";
        $row_listado_agrupaciones .= "
							<td>
								<a href='?sw=listAgrupaciones&idAgrup=" . Encodear3($unico->id_agrupacion) . "&Imp=1&Groupby=Month'> Ver Imparticiones </a>
							</td>";
        $row_listado_agrupaciones .= "<td>
					<a href='?sw=reportes_online_descarga&id=" . $unico->id_agrupacion . "&tipo=" . $tipo . "'>Descargar Reporte</a>
					<br>
					<a href='?sw=reportes_online_descarga&id=" . $unico->id_agrupacion . "&tipo=AgrupacionesHistorico'>Descargar Reporte Historico</a>
					<br>
					<a href='?sw=reportes_online_descarga&id=" . $unico->id_agrupacion . "&tipo=AgrupacionesConsolidadoC1'>Descargar Reporte Consolidado</a>
					<br>
					
					
					</td>";
        $row_listado_agrupaciones .= "</tr>";
    }

    $PRINCIPAL = str_replace("{ROW_LISTADO_AGRUPACION}", $row_listado_agrupaciones, $PRINCIPAL);
    $PRINCIPAL = str_replace("{DISPLAY_RUT_COLABORADOR}", $display_rut_colaborador, $PRINCIPAL);
    $PRINCIPAL = str_replace("{FILTROS_REALIZADOS_FILTRO_SUPERIOR}", $filter_text, $PRINCIPAL);

    //echo "<br><h4>IdAgrup $IdAgrup</h4><br>";

    if ($IdAgrup > 0) {
        //echo "<br>-> IdAgrup $IdAgrup";

        $ListaCursosAgrup = reportes_online_ListaCursoDadoIdAgrupacion($IdAgrup);
        $lista_id_cursos = "";
        foreach ($ListaCursosAgrup as $unicoIdCurso) {
            $lista_id_cursos .= $unicoIdCurso->id_curso . ";";
        }
        //echo "<br>-> lista_id_cursos $lista_id_cursos";


        $Imparticiones_GroupbyMonth = BuscaImparticiones_AgrupadasporMes($lista_id_cursos);
        //echo "<pre>";
        //p/rint_r($Imparticiones_GroupbyMonth);
        //echo "</pre>";


        //separar por mes
        $row_listado_imparticiones .= "<tr>";
        foreach ($Imparticiones_GroupbyMonth as $unicoImp) {
            $row_listado_imparticiones1 .= "" . utf8_encode($unicoImp->codigo_inscripcion) . "<br>";
            $row_listado_imparticiones2 .= "" . utf8_encode($unicoImp->nombre_curso) . "<br>";
            $row_listado_imparticiones3 .= "" . utf8_encode($unicoImp->fecha_inicio) . "<br>";
            $row_listado_imparticiones4 .= "" . utf8_encode($unicoImp->fecha_termino) . "<br>";
            $row_listado_imparticiones5 .= "" . utf8_encode($inscritos_imparticiones) . "<br>";
        }

        $row_listado_imparticiones .= "<td>" . ($row_listado_imparticiones1) . "</td>";
        $row_listado_imparticiones .= "<td>" . ($row_listado_imparticiones2) . "</td>";
        $row_listado_imparticiones .= "<td>" . ($row_listado_imparticiones3) . "</td>";
        $row_listado_imparticiones .= "<td>" . ($row_listado_imparticiones4) . "</td>";
        $row_listado_imparticiones .= "<td>" . ($row_listado_imparticiones5) . "</td>";
        $row_listado_imparticiones .= "<td><a href='?sw=InscribirUsuarios&idAgrup=" . Encodear3($unico->id_agrupacion) . "&Imp=1&IdImpEnc=" . Encodear3($unicoImp->codigo_inscripcion) . "'> Inscripci&oacute;n Usuarios </a></td>";

        $row_listado_imparticiones .= "</tr>";
    }

    $PRINCIPAL = str_replace("{ROW_LISTADO_IMPARTICIONES_POR_AGRUPACION}", $row_listado_imparticiones, $PRINCIPAL);


    if ($IdAgrup > 0) {
        $PRINCIPAL = str_replace("{DISPLAYNONE_LISTADO_IMPARTICIONES_POR_AGRUPACION}", "", $PRINCIPAL);

    } else {
        $PRINCIPAL = str_replace("{DISPLAYNONE_LISTADO_IMPARTICIONES_POR_AGRUPACION}", "display:none;", $PRINCIPAL);
    }

    echo $PRINCIPAL;
}

//**reportes_online**


function lista_solicitudes_chileactivo_inscripcion_validacion($html, $id_empresa, $idcategoria)
{
    $lista_becav = lista_chileactivo_inscripcion_validacion_data($idcategoria, $id_empresa);
    //print_r($lista_becav);


//echo "idcategoria $idcategoria";

    foreach ($lista_becav as $unico) {
        //echo "<br>ho<br>";
        //print_r($unico);

        //RFBeneficiosBecasVisto($unico->id);

        $row = file_get_contents("views/chileactivo/row_lista_inscripciones.html");
        $row = str_replace("{ID_BENEFICIO}", $idcategoria, $row);
        $row = str_replace("{ID}", utf8_encode($unico->id), $row);
        $row = str_replace("{RUT}", utf8_encode($unico->rut), $row);


        $Usu = TraeDatosUsuario($unico->rut);
        $row = str_replace("{NOMBRE}", utf8_encode($Usu[0]->nombre_completo), $row);
        $row = str_replace("{CARGO}", utf8_encode($Usu[0]->cargo), $row);
        $row = str_replace("{EMAIL}", utf8_encode($Usu[0]->email), $row);
        $row = str_replace("{DIVISION}", utf8_encode($Usu[0]->division), $row);

        $row = str_replace("{ACCION}", utf8_encode($unico->tipo), $row);
        $boton_doc = "<a href='https://www.masconectadosbch.cl/chileactivo/front/docs/" . $unico->documento . "' target='_blank' class='' >Ver Documento</a>";
        $row = str_replace("{DOCUMENTO}", utf8_encode($boton_doc), $row);
        $row = str_replace("{MOTIVO}", utf8_encode($unico->motivo), $row);


        $row = str_replace("{FECHA}", (fechaCastellano($unico->fecha)), $row);
        $documentacion = "";
        if ($unico->ficha_postulacion <> '') {
            $documentacion .= '<a href="../front/' . utf8_decode($unico->ficha_postulacion) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->certificado_notas <> '') {
            $documentacion .= '<a href="../front/' . utf8_decode($unico->certificado_notas) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->pago_arancel <> '') {
            $documentacion .= '<a href="../front/' . utf8_decode($unico->pago_arancel) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->certificado_carga <> '') {
            $documentacion .= '<a href="../front/' . utf8_decode($unico->certificado_carga) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->concentracion_notas <> '') {
            $documentacion .= '<a href="../front/' . utf8_decode($unico->concentracion_notas) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->licencia_edmedia <> '') {
            $documentacion .= '<a href="../front/' . utf8_decode($unico->licencia_edmedia) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->boletinpsu <> '') {
            $documentacion .= '<a href="../front/' . utf8_decode($unico->boletinpsu) . '" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->certificado_egreso <> '') {
            $documentacion .= '<a href="../front/' . utf8_decode($unico->certificado_egreso) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->certificado_acredita <> '') {
            $documentacion .= '<a href="../front/' . utf8_decode($unico->certificado_acredita) . '" target="_blank" class="btn btn-info" target="_blank">Documento</a><br><br>';
        }

        if ($unico->vivienda_foto_escritura <> '') {
            $documentacion .= '<a href="../front/' . utf8_decode($unico->vivienda_foto_escritura) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->vivienda_cedula <> '') {
            $documentacion .= '<a href="../front/' . utf8_decode($unico->vivienda_cedula) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->vivienda_residencia <> '') {
            $documentacion .= '<a href="../front/' . utf8_decode($unico->vivienda_residencia) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->vivienda_matrimonio <> '') {
            $documentacion .= '<a href="../front/' . utf8_decode($unico->vivienda_matrimonio) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }


//tipo worfklow
        $bloque_validacion_ = "";
        if ($unico->tipo_workflow == "1003") {
            // Check admin val1

            if ($unico->validacion1 == "Validado") {
                $bloque_validacion_1 = "<label style='padding-left: 15px;'></label><div class='alert alert-success'>Validado</div>";
            } elseif ($unico->validacion1 == "En_Espera") {
                $bloque_validacion_1 = "<label style='padding-left: 15px;'></label><div class='alert alert-warning'>En Espera</div>";
            } else {
                $bloque_validacion_1 = "
						<div class='alert alert-warning'>
							<form action='?sw=chileactivo_validacion' method='post' name=''>
							<label>Validacion 1 Administrador</label><br>
								<select name='validacion' class='form form-control'>
									<option value=''></option>
									<option value='Validado'>Validar</option>
									<option value='En_Espera'>En Espera</option>
								</select>	<br>
								<label>Comentarios</label><br>
								<input type='text' name='comentarios' class='form form-control'>
								<input type='hidden' name='id_bene' value='" . $unico->id . "' class='form form-control'>
								<input type='hidden' name='id' value='" . $idcategoria . "' class='form form-control'>
								<input type='hidden' name='val' value='validacion1' class='form form-control'>
								<input type='submit' class='btn btn-info' value='Guardar'>
							</form>	
						</div>";
            }

            $bloque_validacion_ = $bloque_validacion_1;

        }


        $row = str_replace("{WORKFLOW_FORMULARIO}", ($bloque_validacion_), $row);


        $id_enc = Encodear3($unico->id);
        $botones_documentacion = '';

        $botones_validacion = '';
//echo $botones_documentacion;

        $tipo = "";
        if ($unico->tipo_wf == "SI") {
            $tipo = "REQUIERE_VALIDACION_JEFATURA";
        }

        $row = str_replace("{BENEFICIO}", utf8_encode($unico->beneficio), $row);
        $row = str_replace("{TIPO_WORKFLOW}", "", $row);

        $fecha_inicio = $unico->fecha_inicio;
        $fecha_termino = $unico->fecha_termino;
        $dia1 = $unico->dia;
        $dia2 = $unico->dia2;
        $fecha_nacimiento = $unico->fecha_nac;
        $anexo = $unico->anexo;
        $celular = $unico->num_celular;
        $cargo = $unico->cargo;
        $mundo = $unico->mundo;
        $datos = "";


// POR CADA CAMPO CON RESPUESTA VOY CREANDO LISTA


        if ($unico->idc01 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc01", $unico->id_form1);
            $datos .= "<strong>" . $NombreCampo . "</strong>: " . utf8_encode($unico->idc01) . "<br>";
        }

        if ($unico->idc02 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc02", $unico->id_form1);
            $datos .= "<strong>" . $NombreCampo . "</strong>: " . utf8_encode($unico->idc02) . "<br>";
        }

        if ($unico->idc03 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc03", $unico->id_form1);
            $datos .= "<strong>" . $NombreCampo . "</strong>: " . utf8_encode($unico->idc03) . "<br>";
        }

        if ($unico->idc04 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc04", $unico->id_form1);
            $datos .= "<strong>" . $NombreCampo . "</strong>: " . utf8_encode($unico->idc04) . "<br>";
        }

        if ($unico->idc05 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc05", $unico->id_form1);
            $datos .= "<strong>" . $NombreCampo . "</strong>: " . utf8_encode($unico->idc05) . "<br>";
        }

        if ($unico->idc06 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc06", $unico->id_form1);
            $datos .= "<strong>" . $NombreCampo . "</strong>: " . utf8_encode($unico->idc06) . "<br>";
        }

        if ($unico->idc07 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc07", $unico->id_form1);
            $datos .= "<strong>" . $NombreCampo . "</strong>: " . utf8_encode($unico->idc07) . "<br>";
        }

        if ($unico->idc08 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc08", $unico->id_form1);
            $datos .= "<strong>" . $NombreCampo . "</strong>: " . utf8_encode($unico->idc08) . "<br>";
        }

        if ($unico->idc09 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc09", $unico->id_form1);
            $datos .= "<strong>" . $NombreCampo . "</strong>: " . utf8_encode($unico->idc09) . "<br>";
        }

        if ($unico->idc10 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc10", $unico->id_form1);
            $datos .= "<strong>" . $NombreCampo . "</strong>: " . utf8_encode($unico->idc10) . "<br>";
        }


        $row = str_replace("{DATOS}", utf8_encode($datos), $row);

        $botones_validacionok = '<span class="badge badge-warning">PENDIENTE</span> ';

        if ($unico->validacionok == '1') {
            $botones_validacionok = '<span class="badge badge-success">VALIDADO</span> ';
        }

        if ($unico->validacionok == '3') {
            $botones_validacionok = '<span class="badge badge-danger">RECHAZADO</span> ';
        }


        $botones_documentacionok = '<span class="badge badge-warning">PENDIENTE</span> ';

        if ($unico->documentacionok == '1') {
            $botones_documentacionok = '<span class="badge badge-success">VALIDADO</span> ';
        }

        if ($unico->documentacionok == '3') {
            $botones_documentacionok = '<span class="badge badge-danger">RECHAZADO</span> ';
        }


        //$botones_documentacion.='<span class="badge badge-danger">RECHAZADO</span><br><br>';
        $botones_documentacionBK .= '<br>
	<a href="?sw=beneficios_validacion&idenc=' . $id_enc . '&d=1&id=' . $idcategoria . '" 
	class="btn btn-success btn-sm" onclick="Valida' . $unico->id . '();">Validar</a>
	
	<br><br>
	
	<a href="?sw=beneficios_validacion&idenc=' . $id_enc . '&d=2&id=' . $idcategoria . '" 
	class="btn btn-danger btn-sm" onclick="Rechaza' . $unico->id . '();">Rechazar</a> 
	';


        $botones_documentacion .= '<br>
	<a 
	class="btn btn-success btn-sm" onclick="Valida' . $unico->id . '();">Validar</a>
	
	<br><br>
	
	<a  
	class="btn btn-danger btn-sm" onclick="Rechaza' . $unico->id . '();">Rechazar</a> 
	';


        $estado_final_beneficio = Beneficios_Busca_Estado($unico->id, $unico->tipo_workflow);


        $row = str_replace("{DOCUMENTACION}", utf8_encode($documentacion), $row);
        $row = str_replace("{VALIDACION_JEFE}", utf8_encode($botones_validacionok), $row);
        $row = str_replace("{DOCUMENTACION_OK}", utf8_encode($estado_final_beneficio), $row);

        $row = str_replace("{VALIDACION_FINAL}", utf8_encode($botones_documentacion), $row);
        $total_html .= $row;
    }
    $html = str_replace("{LISTA}", $total_html, $html);
    $html = str_replace("{TITULO}", "Socios Chileactivo", $html);
    $html = str_replace("{BTN}", "Nueva Pregunta", $html);
    $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
    $html = str_replace("{BTN_VOLVER}", '<a href="?sw=chileactivo_solicitudes" class="btn btn-info">< Volver</a>', $html);
    $html = str_replace("{COLUMNA}", 'Pregunta', $html);
    $html = str_replace("{ID_BENEFICIO}", $idcategoria, $html);

    return ($html);
}

function lista_solicitudes_chileactivo_desinscripcion($html, $id_empresa, $idcategoria)
{

    $lista = lista_chileactivo_desinscripcion_data($idcategoria, $id_empresa);
    //print_r($lista);
    foreach ($lista as $unico) {

        $row = file_get_contents("views/chileactivo/row_lista_beneficios_desinscripciones.html");
        $row = str_replace("{ID_BENEFICIO}", $idcategoria, $row);
        $row = str_replace("{ID}", utf8_encode($unico->id), $row);
        $row = str_replace("{RUT}", utf8_encode($unico->rut), $row);

        $row = str_replace("{NOMBRE}", utf8_encode($unico->nombre), $row);
        $row = str_replace("{CARGO}", utf8_encode($unico->cargo), $row);
        $row = str_replace("{EMAIL}", utf8_encode($unico->email), $row);
        $row = str_replace("{DIVISION}", utf8_encode($unico->division), $row);

        $row = str_replace("{FECHA}", utf8_encode($unico->fecha), $row);
        $row = str_replace("{BENEFICIO}", utf8_encode($unico->beneficio), $row);

        $row = str_replace("{TIPO_WORKFLOW}", "", $row);
        $row = str_replace("{DATOS}", ($unico->idc01), $row);
        $row = str_replace("{DOCUMENTACION}", ($unico->idc02), $row);


    }

    $html = str_replace("{LISTA}", $row, $html);
    $html = str_replace("{TITULO}", "Solicitudes Chileactivo", $html);
    $html = str_replace("{BTN}", "Nueva Pregunta", $html);
    $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
    $html = str_replace("{BTN_VOLVER}", '<a href="?sw=chileactivo_solicitudes_v3" class="btn btn-info">< Volver</a>', $html);
    $html = str_replace("{COLUMNA}", 'Pregunta', $html);
    $html = str_replace("{ID_BENEFICIO}", $idcategoria, $html);

    return ($html);
}


function lista_solicitudes_chileactivo_validacion($html, $id_empresa, $idcategoria)
{
    $lista_becav = lista_chileactivo_validacion_data($idcategoria, $id_empresa);
    //print_r($lista_becav);
    //echo "idcategoria $idcategoria";

    foreach ($lista_becav as $unico) {
        //echo "<br>ho<br>";
        //print_r($unico);

        RFBeneficiosBecasVisto($unico->id);

        $row = file_get_contents("views/chileactivo/row_lista_beneficios.html");
        $row = str_replace("{ID_BENEFICIO}", $idcategoria, $row);
        $row = str_replace("{ID}", utf8_encode($unico->id), $row);
        $row = str_replace("{RUT}", utf8_encode($unico->rut), $row);

        $CelEmailPart = BuscaDatosUsuarioCelEmailAdmin($unico->rut);

        $row = str_replace("{NOMBRE}", utf8_encode($unico->nombre), $row);
        $row = str_replace("{CARGO}", utf8_encode($unico->cargo), $row);
        $row = str_replace("{EMAIL}", utf8_encode($unico->email)
            . "<br>" . $CelEmailPart[0]->celular
            . "<br>" . $CelEmailPart[0]->email_particular
            , $row);
        $row = str_replace("{DIVISION}", utf8_encode($unico->division), $row);
        $row = str_replace("{FECHA}", (fechaCastellano($unico->fecha)), $row);
        $documentacion = "";
        if ($unico->ficha_postulacion <> '') {
            $documentacion .= '<a href="../front/' . utf8_decode($unico->ficha_postulacion) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->certificado_notas <> '') {
            $documentacion .= '<a href="../front/' . utf8_decode($unico->certificado_notas) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->pago_arancel <> '') {
            $documentacion .= '<a href="../front/' . utf8_decode($unico->pago_arancel) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->certificado_carga <> '') {
            $documentacion .= '<a href="../front/' . utf8_decode($unico->certificado_carga) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->concentracion_notas <> '') {
            $documentacion .= '<a href="../front/' . utf8_decode($unico->concentracion_notas) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->licencia_edmedia <> '') {
            $documentacion .= '<a href="../front/' . utf8_decode($unico->licencia_edmedia) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->boletinpsu <> '') {
            $documentacion .= '<a href="../front/' . utf8_decode($unico->boletinpsu) . '" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->certificado_egreso <> '') {
            $documentacion .= '<a href="../front/' . utf8_decode($unico->certificado_egreso) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->certificado_acredita <> '') {
            $documentacion .= '<a href="../front/' . utf8_decode($unico->certificado_acredita) . '" target="_blank" class="btn btn-info" target="_blank">Documento</a><br><br>';
        }

        if ($unico->vivienda_foto_escritura <> '') {
            $documentacion .= '<a href="../front/' . utf8_decode($unico->vivienda_foto_escritura) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->vivienda_cedula <> '') {
            $documentacion .= '<a href="../front/' . utf8_decode($unico->vivienda_cedula) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->vivienda_residencia <> '') {
            $documentacion .= '<a href="../front/' . utf8_decode($unico->vivienda_residencia) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->vivienda_matrimonio <> '') {
            $documentacion .= '<a href="../front/' . utf8_decode($unico->vivienda_matrimonio) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }


//tipo worfklow
        $bloque_validacion_ = "";
        if ($unico->tipo_workflow == "1003") {
            // Check admin val1

            if ($unico->validacion1 == "Validado") {
                $bloque_validacion_1 = "<label style='padding-left: 15px;'></label><div class='alert alert-success'>Validado</div>";
            } elseif ($unico->validacion1 == "En_Espera") {
                $bloque_validacion_1 = "<label style='padding-left: 15px;'></label><div class='alert alert-warning'>En Espera</div>
							
							
<div class='alert alert-warning'>
							<form action='?sw=chileactivo_validacion' method='post' name=''>
							<label>Validacion 1 Administrador</label><br>
								<select name='validacion' class='form form-control'>
									<option value=''></option>
									<option value='Validado'>Validar</option>
									<option value='En_Espera'>En Espera</option>
								</select>	<br>
								<label>Comentarios</label><br>
								<input type='text' name='comentarios' class='form form-control'>
								<input type='hidden' name='id_bene' value='" . $unico->id . "' class='form form-control'>
								<input type='hidden' name='id' value='" . $idcategoria . "' class='form form-control'>
								<input type='hidden' name='val' value='validacion1' class='form form-control'>
								<input type='submit' class='btn btn-info' value='Guardar'>
							</form>	
						</div>							
							
							";
            } else {
                $bloque_validacion_1 = "
						<div class='alert alert-warning'>
							<form action='?sw=chileactivo_validacion' method='post' name=''>
							<label>Validacion 1 Administrador</label><br>
								<select name='validacion' class='form form-control'>
									<option value=''></option>
									<option value='Validado'>Validar</option>
									<option value='En_Espera'>En Espera</option>
								</select>	<br>
								<label>Comentarios</label><br>
								<input type='text' name='comentarios' class='form form-control'>
								<input type='hidden' name='id_bene' value='" . $unico->id . "' class='form form-control'>
								<input type='hidden' name='id' value='" . $idcategoria . "' class='form form-control'>
								<input type='hidden' name='val' value='validacion1' class='form form-control'>
								<input type='submit' class='btn btn-info' value='Guardar'>
							</form>	
						</div>";
            }

            $bloque_validacion_ = $bloque_validacion_1;

        }


        $row = str_replace("{WORKFLOW_FORMULARIO}", ($bloque_validacion_), $row);


        $id_enc = Encodear3($unico->id);
        $botones_documentacion = '';

        $botones_validacion = '';
//echo $botones_documentacion;

        $tipo = "";
        if ($unico->tipo_wf == "SI") {
            $tipo = "REQUIERE_VALIDACION_JEFATURA";
        }

        $row = str_replace("{BENEFICIO}", utf8_encode($unico->beneficio), $row);
        $row = str_replace("{TIPO_WORKFLOW}", "", $row);

        $fecha_inicio = $unico->fecha_inicio;
        $fecha_termino = $unico->fecha_termino;
        $dia1 = $unico->dia;
        $dia2 = $unico->dia2;
        $fecha_nacimiento = $unico->fecha_nac;
        $anexo = $unico->anexo;
        $celular = $unico->num_celular;
        $cargo = $unico->cargo;
        $mundo = $unico->mundo;
        $datos = "";


// POR CADA CAMPO CON RESPUESTA VOY CREANDO LISTA


        if ($unico->idc01 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc01", $unico->id_form1);
            $datos .= "<strong>" . $NombreCampo . "</strong>: " . utf8_encode($unico->idc01) . "<br>";
        }

        if ($unico->idc02 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc02", $unico->id_form1);
            $datos .= "<strong>" . $NombreCampo . "</strong>: " . utf8_encode($unico->idc02) . "<br>";
        }

        if ($unico->idc03 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc03", $unico->id_form1);
            $datos .= "<strong>" . $NombreCampo . "</strong>: " . utf8_encode($unico->idc03) . "<br>";
        }

        if ($unico->idc04 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc04", $unico->id_form1);
            $datos .= "<strong>" . $NombreCampo . "</strong>: " . utf8_encode($unico->idc04) . "<br>";
        }

        if ($unico->idc05 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc05", $unico->id_form1);
            $datos .= "<strong>" . $NombreCampo . "</strong>: " . utf8_encode($unico->idc05) . "<br>";
        }

        if ($unico->idc06 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc06", $unico->id_form1);
            $datos .= "<strong>" . $NombreCampo . "</strong>: " . utf8_encode($unico->idc06) . "<br>";
        }

        if ($unico->idc07 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc07", $unico->id_form1);
            $datos .= "<strong>" . $NombreCampo . "</strong>: " . utf8_encode($unico->idc07) . "<br>";
        }

        if ($unico->idc08 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc08", $unico->id_form1);
            $datos .= "<strong>" . $NombreCampo . "</strong>: " . utf8_encode($unico->idc08) . "<br>";
        }

        if ($unico->idc09 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc09", $unico->id_form1);
            $datos .= "<strong>" . $NombreCampo . "</strong>: " . utf8_encode($unico->idc09) . "<br>";
        }

        if ($unico->idc10 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc10", $unico->id_form1);
            $datos .= "<strong>" . $NombreCampo . "</strong>: " . utf8_encode($unico->idc10) . "<br>";
        }


        $row = str_replace("{DATOS}", utf8_encode($datos), $row);

        $botones_validacionok = '<span class="badge badge-warning">PENDIENTE</span> ';

        if ($unico->validacionok == '1') {
            $botones_validacionok = '<span class="badge badge-success">VALIDADO</span> ';
        }

        if ($unico->validacionok == '3') {
            $botones_validacionok = '<span class="badge badge-danger">RECHAZADO</span> ';
        }


        $botones_documentacionok = '<span class="badge badge-warning">PENDIENTE</span> ';

        if ($unico->documentacionok == '1') {
            $botones_documentacionok = '<span class="badge badge-success">VALIDADO</span> ';
        }

        if ($unico->documentacionok == '3') {
            $botones_documentacionok = '<span class="badge badge-danger">RECHAZADO</span> ';
        }


        //$botones_documentacion.='<span class="badge badge-danger">RECHAZADO</span><br><br>';
        $botones_documentacionBK .= '<br>
	<a href="?sw=beneficios_validacion&idenc=' . $id_enc . '&d=1&id=' . $idcategoria . '" 
	class="btn btn-success btn-sm" onclick="Valida' . $unico->id . '();">Validar</a>
	
	<br><br>
	
	<a href="?sw=beneficios_validacion&idenc=' . $id_enc . '&d=2&id=' . $idcategoria . '" 
	class="btn btn-danger btn-sm" onclick="Rechaza' . $unico->id . '();">Rechazar</a> 
	';


        $botones_documentacion .= '<br>
	<a 
	class="btn btn-success btn-sm" onclick="Valida' . $unico->id . '();">Validar</a>
	
	<br><br>
	
	<a  
	class="btn btn-danger btn-sm" onclick="Rechaza' . $unico->id . '();">Rechazar</a> 
	';


        $estado_final_beneficio = Beneficios_Busca_Estado($unico->id, $unico->tipo_workflow);


        $row = str_replace("{DOCUMENTACION}", utf8_encode($documentacion), $row);
        $row = str_replace("{VALIDACION_JEFE}", utf8_encode($botones_validacionok), $row);
        $row = str_replace("{DOCUMENTACION_OK}", utf8_encode($estado_final_beneficio), $row);

        $row = str_replace("{VALIDACION_FINAL}", utf8_encode($botones_documentacion), $row);
        $total_html .= $row;
    }
    $html = str_replace("{LISTA}", $total_html, $html);
    $html = str_replace("{TITULO}", "Solicitudes Chileactivo", $html);
    $html = str_replace("{BTN}", "Nueva Pregunta", $html);
    $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
    $html = str_replace("{BTN_VOLVER}", '<a href="?sw=chileactivo_solicitudes" class="btn btn-info">< Volver</a>', $html);
    $html = str_replace("{COLUMNA}", 'Pregunta', $html);
    $html = str_replace("{ID_BENEFICIO}", $idcategoria, $html);

    return ($html);
}

function lista_solicitudes_uniformes_validacion($html, $id_empresa, $rut_col)
{
    $lista_becav = lista_uniformes_validacion_data($rut_col, $id_empresa);
    //print_r($lista_becav);

    $Usu = TraeDatosUsuario($rut_col);

//echo "idcategoria $idcategoria";

    foreach ($lista_becav as $unico) {
        //echo "<br>ho<br>";
        //print_r($unico);

        //RFBeneficiosBecasVisto($unico->id);

        $row = file_get_contents("views/uniformes/row_lista_beneficios.html");
        $row = str_replace("{ID_BENEFICIO}", $idcategoria, $row);
        $row = str_replace("{ID}", utf8_encode($unico->id), $row);
        $row = str_replace("{RUT}", utf8_encode($unico->rut), $row);

        if ($unico->maternal == "1") {
            $maternal = "<span class='badge badge-info' style='color:#fff'>Prenda maternal</span>";
        } else {
            $maternal = "";
        }

        $row = str_replace("{NOMBRE_PRENDA}", utf8_encode($unico->prenda), $row);
        $row = str_replace("{SEGMENTO}", utf8_encode($unico->segmento_prenda), $row);
        $row = str_replace("{TEMPORADA}", utf8_encode($unico->temporada_prenda), $row);
        $row = str_replace("{MATERNAL}", utf8_encode($maternal), $row);

        $row = str_replace("{TALLA}", utf8_encode($unico->talla), $row);


        $row = str_replace("{NOMBRE}", utf8_encode($unico->nombre), $row);
        $row = str_replace("{CARGO}", utf8_encode($unico->cargo), $row);
        $row = str_replace("{EMAIL}", utf8_encode($unico->email), $row);
        $row = str_replace("{DIVISION}", utf8_encode($unico->division), $row);
        if ($unico->estado <> "") {
            $estado = $unico->estado;
        } else {
            $estado = "Pendiente";
        }
        $row = str_replace("{ESTADO_PRENDA}", utf8_encode($estado), $row);


        $row = str_replace("{FECHA}", (fechaCastellano($unico->fecha)), $row);
        $documentacion = "";
        if ($unico->ficha_postulacion <> '') {
            $documentacion .= '<a href="../front/' . utf8_decode($unico->ficha_postulacion) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->certificado_notas <> '') {
            $documentacion .= '<a href="../front/' . utf8_decode($unico->certificado_notas) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->pago_arancel <> '') {
            $documentacion .= '<a href="../front/' . utf8_decode($unico->pago_arancel) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->certificado_carga <> '') {
            $documentacion .= '<a href="../front/' . utf8_decode($unico->certificado_carga) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->concentracion_notas <> '') {
            $documentacion .= '<a href="../front/' . utf8_decode($unico->concentracion_notas) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->licencia_edmedia <> '') {
            $documentacion .= '<a href="../front/' . utf8_decode($unico->licencia_edmedia) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->boletinpsu <> '') {
            $documentacion .= '<a href="../front/' . utf8_decode($unico->boletinpsu) . '" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->certificado_egreso <> '') {
            $documentacion .= '<a href="../front/' . utf8_decode($unico->certificado_egreso) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->certificado_acredita <> '') {
            $documentacion .= '<a href="../front/' . utf8_decode($unico->certificado_acredita) . '" target="_blank" class="btn btn-info" target="_blank">Documento</a><br><br>';
        }

        if ($unico->vivienda_foto_escritura <> '') {
            $documentacion .= '<a href="../front/' . utf8_decode($unico->vivienda_foto_escritura) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->vivienda_cedula <> '') {
            $documentacion .= '<a href="../front/' . utf8_decode($unico->vivienda_cedula) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->vivienda_residencia <> '') {
            $documentacion .= '<a href="../front/' . utf8_decode($unico->vivienda_residencia) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->vivienda_matrimonio <> '') {
            $documentacion .= '<a href="../front/' . utf8_decode($unico->vivienda_matrimonio) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }


//tipo worfklow
        $bloque_validacion_ = "";
        if ($unico->tipo_workflow == "1003") {
            // Check admin val1

            if ($unico->validacion1 == "Validado") {
                $bloque_validacion_1 = "<label style='padding-left: 15px;'></label><div class='alert alert-success'>Validado</div>";
            } elseif ($unico->validacion1 == "En_Espera") {
                $bloque_validacion_1 = "<label style='padding-left: 15px;'></label><div class='alert alert-warning'>En Espera</div>
							
							
<div class='alert alert-warning'>
							<form action='?sw=chileactivo_validacion' method='post' name=''>
							<label>Validacion 1 Administrador</label><br>
								<select name='validacion' class='form form-control'>
									<option value=''></option>
									<option value='Validado'>Validar</option>
									<option value='En_Espera'>En Espera</option>
								</select>	<br>
								<label>Comentarios</label><br>
								<input type='text' name='comentarios' class='form form-control'>
								<input type='hidden' name='id_bene' value='" . $unico->id . "' class='form form-control'>
								<input type='hidden' name='id' value='" . $idcategoria . "' class='form form-control'>
								<input type='hidden' name='val' value='validacion1' class='form form-control'>
								<input type='submit' class='btn btn-info' value='Guardar'>
							</form>	
						</div>							
							
							";
            } else {
                $bloque_validacion_1 = "
						<div class='alert alert-warning'>
							<form action='?sw=chileactivo_validacion' method='post' name=''>
							<label>Validacion 1 Administrador</label><br>
								<select name='validacion' class='form form-control'>
									<option value=''></option>
									<option value='Validado'>Validar</option>
									<option value='En_Espera'>En Espera</option>
								</select>	<br>
								<label>Comentarios</label><br>
								<input type='text' name='comentarios' class='form form-control'>
								<input type='hidden' name='id_bene' value='" . $unico->id . "' class='form form-control'>
								<input type='hidden' name='id' value='" . $idcategoria . "' class='form form-control'>
								<input type='hidden' name='val' value='validacion1' class='form form-control'>
								<input type='submit' class='btn btn-info' value='Guardar'>
							</form>	
						</div>";
            }

            $bloque_validacion_ = $bloque_validacion_1;

        }


        $row = str_replace("{WORKFLOW_FORMULARIO}", ($bloque_validacion_), $row);


        $id_enc = Encodear3($unico->id);
        $botones_documentacion = '';

        $botones_validacion = '';
//echo $botones_documentacion;

        $tipo = "";
        if ($unico->tipo_wf == "SI") {
            $tipo = "REQUIERE_VALIDACION_JEFATURA";
        }

        $row = str_replace("{BENEFICIO}", utf8_encode($unico->beneficio), $row);
        $row = str_replace("{TIPO_WORKFLOW}", "", $row);

        $fecha_inicio = $unico->fecha_inicio;
        $fecha_termino = $unico->fecha_termino;
        $dia1 = $unico->dia;
        $dia2 = $unico->dia2;
        $fecha_nacimiento = $unico->fecha_nac;
        $anexo = $unico->anexo;
        $celular = $unico->num_celular;
        $cargo = $unico->cargo;
        $mundo = $unico->mundo;
        $datos = "";


// POR CADA CAMPO CON RESPUESTA VOY CREANDO LISTA


        if ($unico->idc01 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc01", $unico->id_form1);
            $datos .= "<strong>" . $NombreCampo . "</strong>: " . utf8_encode($unico->idc01) . "<br>";
        }

        if ($unico->idc02 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc02", $unico->id_form1);
            $datos .= "<strong>" . $NombreCampo . "</strong>: " . utf8_encode($unico->idc02) . "<br>";
        }

        if ($unico->idc03 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc03", $unico->id_form1);
            $datos .= "<strong>" . $NombreCampo . "</strong>: " . utf8_encode($unico->idc03) . "<br>";
        }

        if ($unico->idc04 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc04", $unico->id_form1);
            $datos .= "<strong>" . $NombreCampo . "</strong>: " . utf8_encode($unico->idc04) . "<br>";
        }

        if ($unico->idc05 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc05", $unico->id_form1);
            $datos .= "<strong>" . $NombreCampo . "</strong>: " . utf8_encode($unico->idc05) . "<br>";
        }

        if ($unico->idc06 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc06", $unico->id_form1);
            $datos .= "<strong>" . $NombreCampo . "</strong>: " . utf8_encode($unico->idc06) . "<br>";
        }

        if ($unico->idc07 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc07", $unico->id_form1);
            $datos .= "<strong>" . $NombreCampo . "</strong>: " . utf8_encode($unico->idc07) . "<br>";
        }

        if ($unico->idc08 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc08", $unico->id_form1);
            $datos .= "<strong>" . $NombreCampo . "</strong>: " . utf8_encode($unico->idc08) . "<br>";
        }

        if ($unico->idc09 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc09", $unico->id_form1);
            $datos .= "<strong>" . $NombreCampo . "</strong>: " . utf8_encode($unico->idc09) . "<br>";
        }

        if ($unico->idc10 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc10", $unico->id_form1);
            $datos .= "<strong>" . $NombreCampo . "</strong>: " . utf8_encode($unico->idc10) . "<br>";
        }


        $row = str_replace("{DATOS}", utf8_encode($datos), $row);

        $botones_validacionok = '<span class="badge badge-warning">PENDIENTE</span> ';

        if ($unico->validacionok == '1') {
            $botones_validacionok = '<span class="badge badge-success">VALIDADO</span> ';
        }

        if ($unico->validacionok == '3') {
            $botones_validacionok = '<span class="badge badge-danger">RECHAZADO</span> ';
        }


        $botones_documentacionok = '<span class="badge badge-warning">PENDIENTE</span> ';

        if ($unico->documentacionok == '1') {
            $botones_documentacionok = '<span class="badge badge-success">VALIDADO</span> ';
        }

        if ($unico->documentacionok == '3') {
            $botones_documentacionok = '<span class="badge badge-danger">RECHAZADO</span> ';
        }


        //$botones_documentacion.='<span class="badge badge-danger">RECHAZADO</span><br><br>';
        $botones_documentacionBK .= '<br>
	<a href="?sw=beneficios_validacion&idenc=' . $id_enc . '&d=1&id=' . $idcategoria . '" 
	class="btn btn-success btn-sm" onclick="Valida' . $unico->id . '();">Validar</a>
	
	<br><br>
	
	<a href="?sw=beneficios_validacion&idenc=' . $id_enc . '&d=2&id=' . $idcategoria . '" 
	class="btn btn-danger btn-sm" onclick="Rechaza' . $unico->id . '();">Rechazar</a> 
	';


        $botones_documentacion .= '<br>
	<a 
	class="btn btn-success btn-sm" onclick="Valida' . $unico->id . '();">Validar</a>
	
	<br><br>
	
	<a  
	class="btn btn-danger btn-sm" onclick="Rechaza' . $unico->id . '();">Rechazar</a> 
	';


        $estado_final_beneficio = Beneficios_Busca_Estado($unico->id, $unico->tipo_workflow);


        $row = str_replace("{DOCUMENTACION}", utf8_encode($documentacion), $row);
        $row = str_replace("{VALIDACION_JEFE}", utf8_encode($botones_validacionok), $row);
        $row = str_replace("{DOCUMENTACION_OK}", utf8_encode($estado_final_beneficio), $row);

        $row = str_replace("{VALIDACION_FINAL}", utf8_encode($botones_documentacion), $row);
        $total_html .= $row;
    }

    $html = str_replace("{rut_col}", $rut_col, $html);

    $html = str_replace("{LISTA}", $total_html, $html);
    $html = str_replace("{TITULO}", "Solicitudes Vestuario Corporativo " . $_SESSION["seg"], $html);
    $html = str_replace("{BTN}", "Nueva Pregunta", $html);
    $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
    $html = str_replace("{BTN_VOLVER}", '<a href="?sw=uniformes_solicitudes" class="btn btn-info">< Volver</a>', $html);
    $html = str_replace("{COLUMNA}", 'Pregunta', $html);
    $html = str_replace("{ID_BENEFICIO}", $idcategoria, $html);

    return ($html);
}

function lista_beneficios_validacion($html, $id_empresa, $idcategoria, $id_form)
{
    $lista_becav = lista_beneficios_validacion_data($idcategoria, $id_empresa, $id_form);
    //print_r($lista_becav);
    //echo "idcategoria $idcategoria";

    foreach ($lista_becav as $unico) {
        //echo "<br>ho<br>";
        //print_r($unico);

        RFBeneficiosBecasVisto($unico->id);

        $row = file_get_contents("views/beneficios/row_lista_beneficios.html");
        $row = str_replace("{ID_BENEFICIO}", $idcategoria, $row);

        $row = str_replace("{ID}", utf8_encode($unico->id), $row);
        $row = str_replace("{RUT}", utf8_encode($unico->rut), $row);

        $row = str_replace("{NOMBRE}", utf8_encode($unico->nombre), $row);
        $row = str_replace("{CARGO}", utf8_encode($unico->cargo), $row);
        $row = str_replace("{EMAIL}", utf8_encode($unico->email), $row);
        $row = str_replace("{DIVISION}", utf8_encode($unico->division), $row);
        $row = str_replace("{NOMBRE_FORMULARIO}", utf8_encode($unico->nombre_formulario), $row);
        $row = str_replace("{FECHA}", (fechaCastellano($unico->fecha)), $row);


        $documentacion = "";

        if ($unico->ficha_postulacion <> '') {
            $documentacion .= '<a href="../beneficios/front/' . utf8_decode($unico->ficha_postulacion) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->certificado_notas <> '') {
            $documentacion .= '<a href="../beneficios/front/' . utf8_decode($unico->certificado_notas) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->pago_arancel <> '') {
            $documentacion .= '<a href="../beneficios/front/' . utf8_decode($unico->pago_arancel) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->certificado_carga <> '') {
            $documentacion .= '<a href="../beneficios/front/' . utf8_decode($unico->certificado_carga) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->concentracion_notas <> '') {
            $documentacion .= '<a href="../beneficios/front/' . utf8_decode($unico->concentracion_notas) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->licencia_edmedia <> '') {
            $documentacion .= '<a href="../beneficios/front/' . utf8_decode($unico->licencia_edmedia) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->boletinpsu <> '') {
            $documentacion .= '<a href="../beneficios/front/' . utf8_decode($unico->boletinpsu) . '" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->certificado_egreso <> '') {
            $documentacion .= '<a href="../beneficios/front/' . utf8_decode($unico->certificado_egreso) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->certificado_acredita <> '') {
            $documentacion .= '<a href="../beneficios/front/' . utf8_decode($unico->certificado_acredita) . '" target="_blank" class="btn btn-info" target="_blank">Documento</a><br><br>';
        }
        if ($unico->vivienda_foto_escritura <> '') {
            $documentacion .= '<a href="../beneficios/front/' . utf8_decode($unico->vivienda_foto_escritura) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->vivienda_cedula <> '') {
            $documentacion .= '<a href="../beneficios/front/' . utf8_decode($unico->vivienda_cedula) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->vivienda_residencia <> '') {
            $documentacion .= '<a href="../beneficios/front/' . utf8_decode($unico->vivienda_residencia) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->vivienda_matrimonio <> '') {
            $documentacion .= '<a href="../beneficios/front/' . utf8_decode($unico->vivienda_matrimonio) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }


        $verifica_archivo1 = explode(".", $unico->archivo1);
        $verifica_archivo2 = explode(".", $unico->archivo2);
        $verifica_archivo3 = explode(".", $unico->archivo3);
        $verifica_archivo4 = explode(".", $unico->archivo4);
        $verifica_archivo5 = explode(".", $unico->archivo5);


        if ($verifica_archivo1[1] <> '') {
            $documentacion .= '<a href="../beneficios/front/docs/' . utf8_decode($unico->archivo1) . '" target="_blank" class="btn btn-info" target="_blank">Documento 1</a><br><br>';
        }
        if ($verifica_archivo2[1] <> '') {
            $documentacion .= '<a href="../beneficios/front/docs/' . utf8_decode($unico->archivo2) . '" target="_blank" class="btn btn-info" target="_blank">Documento 2</a><br><br>';
        }
        if ($verifica_archivo3[1] <> '') {
            $documentacion .= '<a href="../beneficios/front/docs/' . utf8_decode($unico->archivo3) . '" target="_blank" class="btn btn-info" target="_blank">Documento 3</a><br><br>';
        }
        if ($verifica_archivo4[1] <> '') {
            $documentacion .= '<a href="../beneficios/front/docs/' . utf8_decode($unico->archivo4) . '" target="_blank" class="btn btn-info" target="_blank">Documento 4</a><br><br>';
        }
        if ($verifica_archivo5[1] <> '') {
            $documentacion .= '<a href="../beneficios/front/docs/' . utf8_decode($unico->archivo5) . '" target="_blank" class="btn btn-info" target="_blank">Documento 5</a><br><br>';
        }

        //tipo worfklow
        $bloque_validacion_ = "";

        if ($unico->tipo_workflow == "1003") {
            // Check admin val1

            if ($unico->validacion1 == "Validado") {
                $bloque_validacion_1 = "<label style='padding-left: 15px;'></label><div class='alert alert-success'>Validado</div>							<em>" . utf8_encode($unico->comentarios_validacion) . "</em>";
            } elseif ($unico->validacion1 == "Rechazado_edicion") {
                $bloque_validacion_1 = "<label style='padding-left: 15px;'></label><div class='alert alert-warning'>Rechazo para Editar</div>	<em>" . utf8_encode($unico->comentarios_validacion) . "</em>";
            } elseif ($unico->validacion1 == "Rechazado") {
                $bloque_validacion_1 = "<label style='padding-left: 15px;'></label><div class='alert alert-danger'>Rechazado</div>							<em>" . utf8_encode($unico->comentarios_validacion) . "</em>";
            } else {
                $bloque_validacion_1 = "
																										<div class='alert alert-warning'>
																											<form action='?sw=beneficios_validacion' method='post' name=''>
																											
																												<select name='validacion' class='form form-control'>
																													<option value=''></option>
																													<option value='Validado'>Validar</option>
																													<option value='Rechazado_edicion'>Rechazado para Editar</option>
																													<option value='Rechazado'>Rechazar Definitivamente</option>
																												</select>	<br>
																												<label>Comentarios</label><br>
																												<input type='text' name='comentarios' class='form form-control'>
																												<input type='hidden' name='id_bene' value='" . $unico->id . "' class='form form-control'>
																												<input type='hidden' name='id' value='" . $idcategoria . "' class='form form-control'>
																												<input type='hidden' name='id_form' value='" . $id_form . "' class='form form-control'>
																												<input type='hidden' name='val' value='validacion1' class='form form-control'>
																												<input type='submit' class='btn btn-info' value='Guardar Validacion'>
																											</form>	
																										</div>";
            }


            $bloque_validacion_ = $bloque_validacion_1;

        }


        if ($unico->tipo_workflow == "1008") {

            //echo "<h1>a</h1>unico->validacion1  ".$unico->validacion1." unico->validacion2 ".$unico->validacion2;
            // Check admin val1

            if ($unico->validacion1 == "Validado" and $unico->validacion2 == "") {
                $bloque_validacion_1 = "<label style='padding-left: 15px;'></label><div class='alert alert-success'>Validado</div>							<em>" . utf8_encode($unico->comentarios_validacion) . "</em>
																											


<div class='alert alert-warning'>
																											<form action='?sw=beneficios_validacion' method='post' name='form2'>
																											
																												<select name='validacion' class='form form-control'>
																													<option value=''></option>
																													<option value='Ganador'>Ganador</option>
																													<option value='NoGanador'>No Ganador</option>
																												</select>	<br>
																												<label>Comentarios</label><br>
																												<input type='text' name='comentarios' class='form form-control'>
																												<input type='hidden' name='id_bene' value='" . $unico->id . "' class='form form-control'>
																												<input type='hidden' name='id' value='" . $idcategoria . "' class='form form-control'>
																												<input type='hidden' name='id_form' value='" . $id_form . "' class='form form-control'>
																												<input type='hidden' name='val' value='validacion1' class='form form-control'>
																												<input type='submit' class='btn btn-info' value='Guardar Validacion'>
																											</form>	
																										</div>
																											
																											
																											
																											";
            } elseif ($unico->validacion1 == "Rechazado_edicion" and $unico->validacion2 == "") {
                $bloque_validacion_1 = "<label style='padding-left: 15px;'></label><div class='alert alert-warning'>Rechazo para Editar</div>	<em>" . utf8_encode($unico->comentarios_validacion) . "</em>";
            } elseif ($unico->validacion1 == "Rechazado" and $unico->validacion2 == "") {
                $bloque_validacion_1 = "<label style='padding-left: 15px;'></label><div class='alert alert-danger'>Rechazado</div>							<em>" . utf8_encode($unico->comentarios_validacion) . "</em>";
            } // Check admin val2


            elseif ($unico->validacion1 == "Ganador") {
                $bloque_validacion_1 = "<label style='padding-left: 15px;'></label><div class='alert alert-success'>Ganador</div>							<em>" . utf8_encode($unico->comentarios_validacion) . "</em>";
            } elseif ($unico->validacion1 == "NoGanador") {
                $bloque_validacion_1 = "<label style='padding-left: 15px;'></label><div class='alert alert-warning'>No Ganador</div>	<em>" . utf8_encode($unico->comentarios_validacion) . "</em>";
            } else {
                $bloque_validacion_1 = "
																										<div class='alert alert-warning'>
																											<form action='?sw=beneficios_validacion' method='post' name='form1'>
																												<select name='validacion' class='form form-control'>
																													<option value=''></option>
																													<option value='Validado'>Validar</option>
																													<option value='Rechazado_edicion'>Rechazado para Editar</option>
																													<option value='Rechazado'>Rechazar Definitivamente</option>
																												</select>	<br>
																												<label>Comentarios</label><br>
																												<input type='text' name='comentarios' class='form form-control'>
																												<input type='hidden' name='id_bene' value='" . $unico->id . "' class='form form-control'>
																												<input type='hidden' name='id' value='" . $idcategoria . "' class='form form-control'>
																												<input type='hidden' name='id_form' value='" . $id_form . "' class='form form-control'>
																												<input type='hidden' name='val' value='validacion1' class='form form-control'>
																												<input type='submit' class='btn btn-info' value='Guardar Validacion'>
																											</form>	
																										</div>
																										

																									
																										
																										
																										";
            }


            $bloque_validacion_ = $bloque_validacion_1;

        }

        $row = str_replace("{WORKFLOW_FORMULARIO}", ($bloque_validacion_), $row);

        $id_enc = Encodear3($unico->id);
        $botones_documentacion = '';

        $botones_validacion = '';
        //echo $botones_documentacion;

        $tipo = "";
        if ($unico->tipo_wf == "SI") {
            $tipo = "REQUIERE_VALIDACION_JEFATURA";
        }

        $row = str_replace("{BENEFICIO}", utf8_encode($unico->beneficio), $row);
        $row = str_replace("{TIPO_WORKFLOW}", "", $row);

        $fecha_inicio = $unico->fecha_inicio;
        $fecha_termino = $unico->fecha_termino;
        $dia1 = $unico->dia;
        $dia2 = $unico->dia2;
        $fecha_nacimiento = $unico->fecha_nac;
        $anexo = $unico->anexo;
        $celular = $unico->num_celular;
        $cargo = $unico->cargo;
        $mundo = $unico->mundo;

        $datos = "";

        $datos .= "<form action='?sw=beneficios_validacion' method='post' name='" . $unico->id . "' id='" . $unico->id . "'>";

        if ($unico->idc01 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc01", $unico->id_form);

            $datos .= "<strong> " . $NombreCampo . "</strong><br>
											<input type='text' name='idc01' value='" . $unico->idc01 . "' class='form form-control'>";
        }

        if ($unico->idc02 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc02", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc02' value='" . $unico->idc02 . "' class='form form-control'>";
        }

        if ($unico->idc03 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc03", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc03' value='" . $unico->idc03 . "' class='form form-control'>";
        }

        if ($unico->idc04 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc04", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc04' value='" . $unico->idc04 . "' class='form form-control'>";
        }

        if ($unico->idc05 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc05", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc05' value='" . $unico->idc05 . "' class='form form-control'>";
        }

        if ($unico->idc06 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc06", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc06' value='" . $unico->idc06 . "' class='form form-control'>";
        }

        if ($unico->idc07 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc07", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc07' value='" . $unico->idc07 . "' class='form form-control'>";
        }

        if ($unico->idc08 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc08", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc08' value='" . $unico->idc08 . "' class='form form-control'>";
        }

        if ($unico->idc09 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc09", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc09' value='" . $unico->idc09 . "' class='form form-control'>";
        }

        if ($unico->idc10 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc10", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc10' value='" . $unico->idc10 . "' class='form form-control'>";
        }

        if ($unico->idc11 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc11", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc11' value='" . $unico->idc11 . "' class='form form-control'>";
        }

        if ($unico->idc12 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc12", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc12' value='" . $unico->idc12 . "' class='form form-control'>";
        }

        if ($unico->idc13 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc13", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc13' value='" . $unico->idc13 . "' class='form form-control'>";
        }

        if ($unico->idc14 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc14", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc14' value='" . $unico->idc14 . "' class='form form-control'>";
        }

        if ($unico->idc15 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc15", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc15' value='" . $unico->idc15 . "' class='form form-control'>";
        }

        if ($unico->idc16 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc16", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc16' value='" . $unico->idc16 . "' class='form form-control'>";
        }

        if ($unico->idc17 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc17", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc17' value='" . $unico->idc17 . "' class='form form-control'>";
        }

        if ($unico->idc18 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc18", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc18' value='" . $unico->idc18 . "' class='form form-control'>";
        }

        if ($unico->idc19 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc19", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc19' value='" . $unico->idc19 . "' class='form form-control'>";
        }

        if ($unico->idc20 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc20", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc20' value='" . $unico->idc20 . "' class='form form-control'>";
        }

        if ($unico->idc21 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc21", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc21' value='" . $unico->idc21 . "' class='form form-control'>";
        }


        $datos .= "

										<input type='hidden' name='id' value=" . $idcategoria . ">
										<input type='hidden' name='id_form' value=" . $id_form . ">
										<input type='hidden' name='id_update' value=" . $unico->id . ">
										<input type='submit' value='editar' class='btn btn-link pull-right'>
										<input type='hidden' name='admin_edit' value='1'>

										</form>
										<br><br>
										<a href='?sw=beneficios_validacion&novigente=" . $unico->id . "'  onclick='return confirm(\"Esta seguro de eliminar este item?\")' class='btn btn-link pull-right'>eliminar</a>
										";

        $row = str_replace("{DATOS}", utf8_encode($datos), $row);

        $botones_validacionok = '<span class="badge badge-warning">PENDIENTE</span> ';

        if ($unico->validacionok == '1') {
            $botones_validacionok = '<span class="badge badge-success">VALIDADO</span> ';
        }

        if ($unico->validacionok == '3') {
            $botones_validacionok = '<span class="badge badge-danger">RECHAZADO</span> ';
        }


        $botones_documentacionok = '<span class="badge badge-warning">PENDIENTE</span> ';

        if ($unico->documentacionok == '1') {
            $botones_documentacionok = '<span class="badge badge-success">VALIDADO</span> ';
        }

        if ($unico->documentacionok == '3') {
            $botones_documentacionok = '<span class="badge badge-danger">RECHAZADO</span> ';
        }


        //$botones_documentacion.='<span class="badge badge-danger">RECHAZADO</span><br><br>';
        $botones_documentacionBK .= '<br>
	<a href="?sw=beneficios_validacion&idenc=' . $id_enc . '&d=1&id=' . $idcategoria . '" 
	class="btn btn-success btn-sm" onclick="Valida' . $unico->id . '();">Validar</a>
	
	<br><br>
	
	<a href="?sw=beneficios_validacion&idenc=' . $id_enc . '&d=2&id=' . $idcategoria . '" 
	class="btn btn-danger btn-sm" onclick="Rechaza' . $unico->id . '();">Rechazar</a> 
	';


        $botones_documentacion .= '<br>
	<a 
	class="btn btn-success btn-sm" onclick="Valida' . $unico->id . '();">Validar</a>
	
	<br><br>
	
	<a  
	class="btn btn-danger btn-sm" onclick="Rechaza' . $unico->id . '();">Rechazar</a> 
	';


        $estado_final_beneficio = Beneficios_Busca_Estado($unico->id, $unico->tipo_workflow);


        $row = str_replace("{DOCUMENTACION}", utf8_encode($documentacion), $row);
        $row = str_replace("{VALIDACION_JEFE}", utf8_encode($botones_validacionok), $row);
        $row = str_replace("{ESTADO_FINAL}", utf8_encode($estado_final_beneficio), $row);

        $row = str_replace("{VALIDACION_FINAL}", utf8_encode($botones_documentacion), $row);
        $total_html .= $row;
    }


    $form = dataFullForm_nombre($id_form);

    $html = str_replace("{LISTA}", $total_html, $html);
    $html = str_replace("{TITULO}", "Beneficios", $html);

    $html = str_replace("{FORM}", utf8_encode($form), $html);

    $html = str_replace("{BTN}", "Nueva Pregunta", $html);
    $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
    $html = str_replace("{BTN_VOLVER}", '<a href="?sw=beneficios" class="btn btn-info">< Volver</a>', $html);
    $html = str_replace("{COLUMNA}", 'Pregunta', $html);
    $html = str_replace("{ID_BENEFICIO}", $idcategoria, $html);
    $html = str_replace("{ID_FORM_DOWNLOAD}", $id_form, $html);
    return ($html);
}


function lista_beneficios_validacion_historicos($html, $id_empresa, $idcategoria, $id_form)
{
    $lista_becav = lista_beneficios_validacion_historicos_data($idcategoria, $id_empresa, $id_form);
    //print_r($lista_becav);
    //echo "idcategoria $idcategoria";

    foreach ($lista_becav as $unico) {
        //echo "<br>ho<br>";
        //print_r($unico);

        //RFBeneficiosBecasVisto($unico->id);

        $row = file_get_contents("views/beneficios/row_lista_beneficios_historicos.html");
        $row = str_replace("{ID_BENEFICIO}", $idcategoria, $row);

        $row = str_replace("{ID}", utf8_encode($unico->id), $row);
        $row = str_replace("{RUT}", utf8_encode($unico->rut), $row);

        $row = str_replace("{NOMBRE}", utf8_encode($unico->nombre), $row);
        $row = str_replace("{CARGO}", utf8_encode($unico->cargo), $row);
        $row = str_replace("{EMAIL}", utf8_encode($unico->email), $row);
        $row = str_replace("{DIVISION}", utf8_encode($unico->division), $row);
        $row = str_replace("{NOMBRE_FORMULARIO}", utf8_encode($unico->nombre_formulario), $row);
        $row = str_replace("{FECHA}", (fechaCastellano($unico->fecha)), $row);


        $documentacion = "";

        if ($unico->ficha_postulacion <> '') {
            $documentacion .= '<a href="' . utf8_decode($unico->ficha_postulacion) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->certificado_notas <> '') {
            $documentacion .= '<a href="' . utf8_decode($unico->certificado_notas) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->pago_arancel <> '') {
            $documentacion .= '<a href="' . utf8_decode($unico->pago_arancel) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->certificado_carga <> '') {
            $documentacion .= '<a href="' . utf8_decode($unico->certificado_carga) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->concentracion_notas <> '') {
            $documentacion .= '<a href="' . utf8_decode($unico->concentracion_notas) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->licencia_edmedia <> '') {
            $documentacion .= '<a href="' . utf8_decode($unico->licencia_edmedia) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->boletinpsu <> '') {
            $documentacion .= '<a href="' . utf8_decode($unico->boletinpsu) . '" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->certificado_egreso <> '') {
            $documentacion .= '<a href="' . utf8_decode($unico->certificado_egreso) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->certificado_acredita <> '') {
            $documentacion .= '<a href="' . utf8_decode($unico->certificado_acredita) . '" target="_blank" class="btn btn-info" target="_blank">Documento</a><br><br>';
        }
        if ($unico->vivienda_foto_escritura <> '') {
            $documentacion .= '<a href="' . utf8_decode($unico->vivienda_foto_escritura) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->vivienda_cedula <> '') {
            $documentacion .= '<a href="' . utf8_decode($unico->vivienda_cedula) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->vivienda_residencia <> '') {
            $documentacion .= '<a href="' . utf8_decode($unico->vivienda_residencia) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->vivienda_matrimonio <> '') {
            $documentacion .= '<a href="' . utf8_decode($unico->vivienda_matrimonio) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }


        $verifica_archivo1 = explode(".", $unico->archivo1);
        $verifica_archivo2 = explode(".", $unico->archivo2);
        $verifica_archivo3 = explode(".", $unico->archivo3);
        $verifica_archivo4 = explode(".", $unico->archivo4);
        $verifica_archivo5 = explode(".", $unico->archivo5);


        if ($verifica_archivo1[1] <> '') {
            $documentacion .= '<a href="' . utf8_decode($unico->archivo1) . '" target="_blank" class="btn btn-info" target="_blank">Documento 1</a><br><br>';
        }
        if ($verifica_archivo2[1] <> '') {
            $documentacion .= '<a href="' . utf8_decode($unico->archivo2) . '" target="_blank" class="btn btn-info" target="_blank">Documento 2</a><br><br>';
        }
        if ($verifica_archivo3[1] <> '') {
            $documentacion .= '<a href="' . utf8_decode($unico->archivo3) . '" target="_blank" class="btn btn-info" target="_blank">Documento 3</a><br><br>';
        }
        if ($verifica_archivo4[1] <> '') {
            $documentacion .= '<a href="' . utf8_decode($unico->archivo4) . '" target="_blank" class="btn btn-info" target="_blank">Documento 4</a><br><br>';
        }
        if ($verifica_archivo5[1] <> '') {
            $documentacion .= '<a href="' . utf8_decode($unico->archivo5) . '" target="_blank" class="btn btn-info" target="_blank">Documento 5</a><br><br>';
        }

        //tipo worfklow
        $bloque_validacion_ = "";


        $row = str_replace("{WORKFLOW_FORMULARIO}", ($bloque_validacion_), $row);

        $id_enc = Encodear3($unico->id);
        $botones_documentacion = '';

        $botones_validacion = '';
        //echo $botones_documentacion;

        $tipo = "";
        if ($unico->tipo_wf == "SI") {
            $tipo = "REQUIERE_VALIDACION_JEFATURA";
        }

        $row = str_replace("{BENEFICIO}", utf8_encode($unico->beneficio), $row);
        $row = str_replace("{TIPO_WORKFLOW}", "", $row);

        $fecha_inicio = $unico->fecha_inicio;
        $fecha_termino = $unico->fecha_termino;
        $dia1 = $unico->dia;
        $dia2 = $unico->dia2;
        $fecha_nacimiento = $unico->fecha_nac;
        $anexo = $unico->anexo;
        $celular = $unico->num_celular;
        $cargo = $unico->cargo;
        $mundo = $unico->mundo;

        $datos = "";

        $datos .= "<form action='?sw=beneficios_validacion' method='post' name='" . $unico->id . "' id='" . $unico->id . "'>";

        if ($unico->idc01 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc01", $unico->id_form);

            $datos .= "<strong> " . $NombreCampo . "</strong><br>
											<input type='text' name='idc01' value='" . $unico->idc01 . "' class='form form-control'>";
        }

        if ($unico->idc02 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc02", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc02' value='" . $unico->idc02 . "' class='form form-control'>";
        }

        if ($unico->idc03 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc03", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc03' value='" . $unico->idc03 . "' class='form form-control'>";
        }

        if ($unico->idc04 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc04", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc04' value='" . $unico->idc04 . "' class='form form-control'>";
        }

        if ($unico->idc05 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc05", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc05' value='" . $unico->idc05 . "' class='form form-control'>";
        }

        if ($unico->idc06 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc06", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc06' value='" . $unico->idc06 . "' class='form form-control'>";
        }

        if ($unico->idc07 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc07", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc07' value='" . $unico->idc07 . "' class='form form-control'>";
        }

        if ($unico->idc08 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc08", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc08' value='" . $unico->idc08 . "' class='form form-control'>";
        }

        if ($unico->idc09 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc09", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc09' value='" . $unico->idc09 . "' class='form form-control'>";
        }

        if ($unico->idc10 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc10", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc10' value='" . $unico->idc10 . "' class='form form-control'>";
        }

        if ($unico->idc11 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc11", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc11' value='" . $unico->idc11 . "' class='form form-control'>";
        }

        if ($unico->idc12 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc12", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc12' value='" . $unico->idc12 . "' class='form form-control'>";
        }

        if ($unico->idc13 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc13", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc13' value='" . $unico->idc13 . "' class='form form-control'>";
        }

        if ($unico->idc14 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc14", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc14' value='" . $unico->idc14 . "' class='form form-control'>";
        }

        if ($unico->idc15 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc15", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc15' value='" . $unico->idc15 . "' class='form form-control'>";
        }

        if ($unico->idc16 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc16", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc16' value='" . $unico->idc16 . "' class='form form-control'>";
        }

        if ($unico->idc17 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc17", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc17' value='" . $unico->idc17 . "' class='form form-control'>";
        }

        if ($unico->idc18 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc18", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc18' value='" . $unico->idc18 . "' class='form form-control'>";
        }

        if ($unico->idc19 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc19", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc19' value='" . $unico->idc19 . "' class='form form-control'>";
        }

        if ($unico->idc20 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc20", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc20' value='" . $unico->idc20 . "' class='form form-control'>";
        }

        if ($unico->idc21 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc21", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc21' value='" . $unico->idc21 . "' class='form form-control'>";
        }


        $datos .= "



										
										<br><br>
										
										";

        $row = str_replace("{DATOS}", utf8_encode($datos), $row);

        $botones_validacionok = '<span class="badge badge-warning">PENDIENTE</span> ';

        if ($unico->validacionok == '1') {
            $botones_validacionok = '<span class="badge badge-success">VALIDADO</span> ';
        }

        if ($unico->validacionok == '3') {
            $botones_validacionok = '<span class="badge badge-danger">RECHAZADO</span> ';
        }


        $botones_documentacionok = '<span class="badge badge-warning">PENDIENTE</span> ';

        if ($unico->documentacionok == '1') {
            $botones_documentacionok = '<span class="badge badge-success">VALIDADO</span> ';
        }

        if ($unico->documentacionok == '3') {
            $botones_documentacionok = '<span class="badge badge-danger">RECHAZADO</span> ';
        }


        //$botones_documentacion.='<span class="badge badge-danger">RECHAZADO</span><br><br>';
        $botones_documentacionBK .= '<br>
	<a href="?sw=beneficios_validacion&idenc=' . $id_enc . '&d=1&id=' . $idcategoria . '" 
	class="btn btn-success btn-sm" onclick="Valida' . $unico->id . '();">Validar</a>
	
	<br><br>
	
	<a href="?sw=beneficios_validacion&idenc=' . $id_enc . '&d=2&id=' . $idcategoria . '" 
	class="btn btn-danger btn-sm" onclick="Rechaza' . $unico->id . '();">Rechazar</a> 
	';


        $botones_documentacion .= '<br>
	<a 
	class="btn btn-success btn-sm" onclick="Valida' . $unico->id . '();">Validar</a>
	
	<br><br>
	
	<a  
	class="btn btn-danger btn-sm" onclick="Rechaza' . $unico->id . '();">Rechazar</a> 
	';


        $estado_final_beneficio = Beneficios_Busca_Estado($unico->id, $unico->tipo_workflow);


        $row = str_replace("{DOCUMENTACION}", utf8_encode($documentacion), $row);
        $row = str_replace("{VALIDACION_JEFE}", utf8_encode($botones_validacionok), $row);
        $row = str_replace("{ESTADO_FINAL}", utf8_encode($estado_final_beneficio), $row);

        $row = str_replace("{VALIDACION_FINAL}", utf8_encode($botones_documentacion), $row);
        $total_html .= $row;
    }


    $form = dataFullForm_nombre($id_form);

    $html = str_replace("{LISTA}", $total_html, $html);
    $html = str_replace("{TITULO}", "Beneficios", $html);

    $html = str_replace("{FORM}", utf8_encode($form), $html);

    $html = str_replace("{BTN}", "Nueva Pregunta", $html);
    $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
    $html = str_replace("{BTN_VOLVER}", '<a href="?sw=beneficios" class="btn btn-info">< Volver</a>', $html);
    $html = str_replace("{COLUMNA}", 'Pregunta', $html);
    $html = str_replace("{ID_BENEFICIO}", $idcategoria, $html);
    $html = str_replace("{ID_FORM_DOWNLOAD}", $id_form, $html);
    return ($html);
}


function lista_beneficios_validacion_ficha_social($html, $id_empresa, $idcategoria, $id_form)
{
    $lista_becav = lista_beneficios_validacion_ficha_social_data($idcategoria, $id_empresa, $id_form);
    //print_r($lista_becav);
    //echo "idcategoria $idcategoria";

    foreach ($lista_becav as $unico) {
        //echo "<br>ho<br>";
        //print_r($unico);

        //RFBeneficiosBecasVisto($unico->id);

        $row = file_get_contents("views/beneficios/row_lista_beneficios_ficha_social.html");
        $row = str_replace("{ID_BENEFICIO}", $idcategoria, $row);

        $row = str_replace("{ID}", utf8_encode($unico->id), $row);
        $row = str_replace("{ID_FORM}", utf8_encode($unico->id), $row);
        $row = str_replace("{RUT}", utf8_encode($unico->rut), $row);

        $row = str_replace("{NOMBRE}", utf8_encode($unico->nombre), $row);
        $row = str_replace("{CARGO}", utf8_encode($unico->cargo), $row);
        $row = str_replace("{EMAIL}", utf8_encode($unico->email), $row);
        $row = str_replace("{DIVISION}", utf8_encode($unico->division), $row);
        $row = str_replace("{NOMBRE_FORMULARIO}", utf8_encode($unico->nombre_formulario), $row);
        $row = str_replace("{FECHA}", (fechaCastellano($unico->fecha)), $row);


        $documentacion = "";

        if ($unico->ficha_postulacion <> '') {
            $documentacion .= '<a href="../beneficios/front/' . utf8_decode($unico->ficha_postulacion) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->certificado_notas <> '') {
            $documentacion .= '<a href="../beneficios/front/' . utf8_decode($unico->certificado_notas) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->pago_arancel <> '') {
            $documentacion .= '<a href="../beneficios/front/' . utf8_decode($unico->pago_arancel) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->certificado_carga <> '') {
            $documentacion .= '<a href="../beneficios/front/' . utf8_decode($unico->certificado_carga) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->concentracion_notas <> '') {
            $documentacion .= '<a href="../beneficios/front/' . utf8_decode($unico->concentracion_notas) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->licencia_edmedia <> '') {
            $documentacion .= '<a href="../beneficios/front/' . utf8_decode($unico->licencia_edmedia) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->boletinpsu <> '') {
            $documentacion .= '<a href="../beneficios/front/' . utf8_decode($unico->boletinpsu) . '" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->certificado_egreso <> '') {
            $documentacion .= '<a href="../beneficios/front/' . utf8_decode($unico->certificado_egreso) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->certificado_acredita <> '') {
            $documentacion .= '<a href="../beneficios/front/' . utf8_decode($unico->certificado_acredita) . '" target="_blank" class="btn btn-info" target="_blank">Documento</a><br><br>';
        }
        if ($unico->vivienda_foto_escritura <> '') {
            $documentacion .= '<a href="../beneficios/front/' . utf8_decode($unico->vivienda_foto_escritura) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->vivienda_cedula <> '') {
            $documentacion .= '<a href="../beneficios/front/' . utf8_decode($unico->vivienda_cedula) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->vivienda_residencia <> '') {
            $documentacion .= '<a href="../beneficios/front/' . utf8_decode($unico->vivienda_residencia) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }
        if ($unico->vivienda_matrimonio <> '') {
            $documentacion .= '<a href="../beneficios/front/' . utf8_decode($unico->vivienda_matrimonio) . '" target="_blank" class="btn btn-info" target="_blank">Documento </a><br><br>';
        }


        $verifica_archivo1 = explode(".", $unico->archivo1);
        $verifica_archivo2 = explode(".", $unico->archivo2);
        $verifica_archivo3 = explode(".", $unico->archivo3);
        $verifica_archivo4 = explode(".", $unico->archivo4);
        $verifica_archivo5 = explode(".", $unico->archivo5);


        if ($verifica_archivo1[1] <> '') {
            $documentacion .= '<a href="../beneficios/front/docs/' . utf8_decode($unico->archivo1) . '" target="_blank" class="btn btn-info" target="_blank">Documento 1</a><br><br>';
        }
        if ($verifica_archivo2[1] <> '') {
            $documentacion .= '<a href="../beneficios/front/docs/' . utf8_decode($unico->archivo2) . '" target="_blank" class="btn btn-info" target="_blank">Documento 2</a><br><br>';
        }
        if ($verifica_archivo3[1] <> '') {
            $documentacion .= '<a href="../beneficios/front/docs/' . utf8_decode($unico->archivo3) . '" target="_blank" class="btn btn-info" target="_blank">Documento 3</a><br><br>';
        }
        if ($verifica_archivo4[1] <> '') {
            $documentacion .= '<a href="../beneficios/front/docs/' . utf8_decode($unico->archivo4) . '" target="_blank" class="btn btn-info" target="_blank">Documento 4</a><br><br>';
        }
        if ($verifica_archivo5[1] <> '') {
            $documentacion .= '<a href="../beneficios/front/docs/' . utf8_decode($unico->archivo5) . '" target="_blank" class="btn btn-info" target="_blank">Documento 5</a><br><br>';
        }


        $row = str_replace("{WORKFLOW_FORMULARIO}", ($bloque_validacion_), $row);

        $id_enc = Encodear3($unico->id);
        $botones_documentacion = '';

        $botones_validacion = '';
        //echo $botones_documentacion;

        $tipo = "";
        if ($unico->tipo_wf == "SI") {
            $tipo = "REQUIERE_VALIDACION_JEFATURA";
        }

        $row = str_replace("{BENEFICIO}", utf8_encode($unico->beneficio), $row);
        $row = str_replace("{TIPO_WORKFLOW}", "", $row);

        $fecha_inicio = $unico->fecha_inicio;
        $fecha_termino = $unico->fecha_termino;
        $dia1 = $unico->dia;
        $dia2 = $unico->dia2;
        $fecha_nacimiento = $unico->fecha_nac;
        $anexo = $unico->anexo;
        $celular = $unico->num_celular;
        $cargo = $unico->cargo;
        $mundo = $unico->mundo;

        $datos = "";

        $datos .= "<form action='?sw=beneficios_validacion' method='post' name='" . $unico->id . "' id='" . $unico->id . "'>";

        if ($unico->idc01 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc01", $unico->id_form);

            $datos .= "<strong> " . $NombreCampo . "</strong><br>
											<input type='text' name='idc01' value='" . $unico->idc01 . "' class='form form-control'>";
        }

        if ($unico->idc02 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc02", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc02' value='" . $unico->idc02 . "' class='form form-control'>";
        }

        if ($unico->idc03 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc03", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc03' value='" . $unico->idc03 . "' class='form form-control'>";
        }

        if ($unico->idc04 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc04", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc04' value='" . $unico->idc04 . "' class='form form-control'>";
        }

        if ($unico->idc05 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc05", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc05' value='" . $unico->idc05 . "' class='form form-control'>";
        }

        if ($unico->idc06 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc06", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc06' value='" . $unico->idc06 . "' class='form form-control'>";
        }

        if ($unico->idc07 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc07", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc07' value='" . $unico->idc07 . "' class='form form-control'>";
        }

        if ($unico->idc08 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc08", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc08' value='" . $unico->idc08 . "' class='form form-control'>";
        }

        if ($unico->idc09 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc09", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc09' value='" . $unico->idc09 . "' class='form form-control'>";
        }

        if ($unico->idc10 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc10", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc10' value='" . $unico->idc10 . "' class='form form-control'>";
        }

        if ($unico->idc11 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc11", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc11' value='" . $unico->idc11 . "' class='form form-control'>";
        }

        if ($unico->idc12 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc12", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc12' value='" . $unico->idc12 . "' class='form form-control'>";
        }

        if ($unico->idc13 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc13", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc13' value='" . $unico->idc13 . "' class='form form-control'>";
        }

        if ($unico->idc14 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc14", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc14' value='" . $unico->idc14 . "' class='form form-control'>";
        }

        if ($unico->idc15 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc15", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc15' value='" . $unico->idc15 . "' class='form form-control'>";
        }

        if ($unico->idc16 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc16", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc16' value='" . $unico->idc16 . "' class='form form-control'>";
        }

        if ($unico->idc17 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc17", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc17' value='" . $unico->idc17 . "' class='form form-control'>";
        }

        if ($unico->idc18 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc18", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc18' value='" . $unico->idc18 . "' class='form form-control'>";
        }

        if ($unico->idc19 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc19", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc19' value='" . $unico->idc19 . "' class='form form-control'>";
        }

        if ($unico->idc20 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc20", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc20' value='" . $unico->idc20 . "' class='form form-control'>";
        }

        if ($unico->idc21 <> "") {
            $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc21", $unico->id_form);
            $datos .= "<strong> " . $NombreCampo . "</strong><br><input type='text' name='idc21' value='" . $unico->idc21 . "' class='form form-control'>";
        }


        $datos .= "

										<input type='hidden' name='id' value=" . $idcategoria . ">
										<input type='hidden' name='id_form' value=" . $unico->id . ">
										<input type='hidden' name='id_update' value=" . $unico->id . ">
										<input type='submit' value='editar' class='btn btn-link pull-right'>
										<input type='hidden' name='admin_edit' value='1'>

										</form>
										<br><br>
										<a href='?sw=beneficios_validacion&novigente=" . $unico->id . "'  onclick='return confirm(\"Esta seguro de eliminar este item?\")' class='btn btn-link pull-right'>eliminar</a>
										";

        $row = str_replace("{DATOS}", utf8_encode($datos), $row);

        $botones_validacionok = '<span class="badge badge-warning">PENDIENTE</span> ';

        if ($unico->validacionok == '1') {
            $botones_validacionok = '<span class="badge badge-success">VALIDADO</span> ';
        }

        if ($unico->validacionok == '3') {
            $botones_validacionok = '<span class="badge badge-danger">RECHAZADO</span> ';
        }


        $botones_documentacionok = '<span class="badge badge-warning">PENDIENTE</span> ';

        if ($unico->documentacionok == '1') {
            $botones_documentacionok = '<span class="badge badge-success">VALIDADO</span> ';
        }

        if ($unico->documentacionok == '3') {
            $botones_documentacionok = '<span class="badge badge-danger">RECHAZADO</span> ';
        }


        //$botones_documentacion.='<span class="badge badge-danger">RECHAZADO</span><br><br>';
        $botones_documentacionBK .= '<br>
									<a href="?sw=beneficios_validacion&idenc=' . $id_enc . '&d=1&id=' . $idcategoria . '" 
									class="btn btn-success btn-sm" onclick="Valida' . $unico->id . '();">Validar</a>
									
									<br><br>
									
									<a href="?sw=beneficios_validacion&idenc=' . $id_enc . '&d=2&id=' . $idcategoria . '" 
									class="btn btn-danger btn-sm" onclick="Rechaza' . $unico->id . '();">Rechazar</a> 
									';


        $botones_documentacion .= '<br>
									<a 
									class="btn btn-success btn-sm" onclick="Valida' . $unico->id . '();">Validar</a>
									
									<br><br>
									
									<a  
									class="btn btn-danger btn-sm" onclick="Rechaza' . $unico->id . '();">Rechazar</a> 
									';


        $estado_final_beneficio = Beneficios_Busca_Estado($unico->id, $unico->tipo_workflow);


        $row = str_replace("{DOCUMENTACION}", utf8_encode($documentacion), $row);
        $row = str_replace("{VALIDACION_JEFE}", utf8_encode($botones_validacionok), $row);
        $row = str_replace("{ESTADO_FINAL}", utf8_encode($estado_final_beneficio), $row);

        $row = str_replace("{VALIDACION_FINAL}", utf8_encode($botones_documentacion), $row);
        $total_html .= $row;
    }


    $form = dataFullForm_nombre($id_form);

    $html = str_replace("{LISTA}", $total_html, $html);
    $html = str_replace("{TITULO}", "Ficha", $html);

    $html = str_replace("{FORM}", utf8_encode($form), $html);

    $html = str_replace("{BTN}", "Nueva Pregunta", $html);
    $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
    $html = str_replace("{BTN_VOLVER}", '<a href="?sw=beneficios" class="btn btn-info">< Volver</a>', $html);
    $html = str_replace("{COLUMNA}", 'Pregunta', $html);
    $html = str_replace("{ID_BENEFICIO}", $idcategoria, $html);
    $html = str_replace("{ID_FORM_DOWNLOAD}", $id_form, $html);
    return ($html);
}

function lista_solicitudes_uniformes($html, $id_empresa, $segmento)
{
    $lista = lista_solicitudes_uniformes_data($id_empresa, $_SESSION["seg"]);
    foreach ($lista as $unico) {

        $row = file_get_contents("views/uniformes/row_beneficios.html");
        $tipo = "";

        if ($unico->validacionjefe == "SI") {
            $tipo = "REQUIERE VALIDACION JEFE";
        }

        $Usu = TraeDatosUsuario($unico->rut);

        $no_vistos = $unico->solicitudes - $unico->visto;

        if ($no_vistos > 0) {
            if ($no_vistos == 1) {
                $nuevo = "<span class='badge badge-danger'>" . $no_vistos . " nuevo</span>";
            } else {
                $nuevo = "<span class='badge badge-danger'>" . $no_vistos . " nuevos</span>";
            }
        } else {
            $nuevo = "";
        }


        $num_cerrados = 0;
        $num_proceso = 0;
        $num_pendientes = 0;
        //por cada beneficio, hago una barrido por cada solicitudes-$unico-
        $array_solicitudes = Uniformes_BarridoSolicitudes($unico->rut, $id_empresa);

        $num_pendientes = 0;
        $num_enconfeccion = 0;
        $num_despachados = 0;
        $num_prendas = 0;

        foreach ($array_solicitudes as $unico_sol) {

            if ($unico_sol->estado == "Pendiente" or $unico_sol->estado == "") {
                $num_pendientes++;
            }
            if ($unico_sol->estado == "En Confeccion") {
                $num_enconfeccion++;
            }
            if ($unico_sol->estado == "Despachado") {
                $num_despachados++;
            }
            if ($unico_sol->estado == "Recibida Disconforme") {
                $num_recibida_disconforme++;
            }
            if ($unico_sol->estado == "Recibida Conforme") {
                $num_recibida_conforme++;
            }

            $num_prendas++;


        }

        $nombre_persona = $Usu[0]->rut . " " . $Usu[0]->nombre_completo . "
					 <br>Cui: " . $Usu[0]->local . ", Direcci?n: " . $Usu[0]->ubicacion . "
					 <br>Anexo: " . $Usu[0]->anexo . ", " . $Usu[0]->email;

        $row = str_replace("{ID}", utf8_encode($unico->rut), $row);
        $row = str_replace("{TIPO}", utf8_encode($unico->nombre_tipo_workflow), $row);
        $row = str_replace("{NOMBRE}", utf8_encode($nombre_persona), $row);
        $row = str_replace("{SOLICITUDES}", utf8_encode($unico->solicitudes), $row);
        $row = str_replace("{APROBADOS", utf8_encode($unico->validacion1), $row);


        $row = str_replace("{NUM_PRENDAS}", $num_prendas, $row);
        $row = str_replace("{PENDIENTES}", $num_pendientes, $row);
        $row = str_replace("{EN_CONFECCION}", $num_enconfeccion, $row);
        $row = str_replace("{DESPACHADAS}", $num_despachados, $row);

        $row = str_replace("{DISCONFORME}", $num_recibida_disconforme, $row);
        $row = str_replace("{CONFORME}", $num_recibida_conforme, $row);


        $row = str_replace("{PENDIENTE}", utf8_encode($unico->validacion2), $row);
        $row = str_replace("{RECHAZADOS_MODIFICACION}", utf8_encode($unico->validacion3), $row);
        $row = str_replace("{RECHAZADOS}", utf8_encode($unico->validacion4), $row);


        $row = str_replace("{NUEVO}", utf8_encode($nuevo), $row);


        $row = str_replace("{ACCIONJEFE}", utf8_encode($unico->validacionjefeaccion), $row);
        $row = str_replace("{PENDIENTESJEFE}", utf8_encode($pendientes_jefe), $row);
        $row = str_replace("{ACCIONADMIN}", utf8_encode($unico->validacionadmin), $row);
        $row = str_replace("{PENDIENTESADMIN}", utf8_encode($pendientes_admin), $row);

        $total_html .= $row;
    }
    $html = str_replace("{LISTA}", $total_html, $html);
    $html = str_replace("{TITULO}", "Solicitudes Vestuario Corporativo " . $_SESSION["seg"], $html);

    $html = str_replace("{BTN}", "Nueva Pregunta", $html);
    $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
    $html = str_replace("{BTN_VOLVER}", '', $html);
    $html = str_replace("{COLUMNA}", 'Pregunta', $html);
    return ($html);
}

function lista_solicitudes_chileactivo($html, $id_empresa, $idcategoria)
{
    $lista = lista_solicitudes_chileactivo_data($id_empresa);
    //print_r($emb_olas);
    foreach ($lista as $unico) {

        $row = file_get_contents("views/chileactivo/row_beneficios.html");
        $tipo = "";
        if ($unico->validacionjefe == "SI") {
            $tipo = "REQUIERE VALIDACION JEFE";
        }
        //echo "<br>tipo $tipo tipo valida ".$unico->validacionjefe;
        $no_vistos = $unico->solicitudes - $unico->visto;
        //echo "no visto $no_vistos.";

        if ($no_vistos > 0) {
            if ($no_vistos == 1) {
                $nuevo = "<span class='badge badge-danger'>" . $no_vistos . " nuevo</span>";
            } else {
                $nuevo = "<span class='badge badge-danger'>" . $no_vistos . " nuevos</span>";
            }
        } else {
            $nuevo = "";
        }


        $num_cerrados = 0;
        $num_proceso = 0;
        $num_pendientes = 0;
        //por cada beneficio, hago una barrido por cada solicitudes-$unico-
        $array_solicitudes = Beneficios_BarridoSolicitudes($unico->id_beneficios, $id_empresa);
        foreach ($array_solicitudes as $unico_sol) {
            $val = Beneficios_Busca_Estado_Solo_Data($unico_sol->id, $unico->tipo_workflow);
            if ($val == "Pendiente") {
                $num_pendientes++;
            }
            if ($val == "En Proceso") {
                $num_proceso++;
            }
            if ($val == "Cerrado") {
                $num_cerrados++;
            }


        }


        $row = str_replace("{ID}", utf8_encode($unico->id_beneficios), $row);
        $row = str_replace("{TIPO}", utf8_encode($unico->nombre_tipo_workflow), $row);
        $row = str_replace("{NOMBRE}", utf8_encode($unico->nombre), $row);
        $row = str_replace("{SOLICITUDES}", utf8_encode($unico->solicitudes), $row);
        $row = str_replace("{APROBADOS", utf8_encode($unico->validacion1), $row);

        $row = str_replace("{PENDIENTES}", $num_pendientes, $row);
        $row = str_replace("{EN_PROCESO}", $num_proceso, $row);
        $row = str_replace("{CERRADAS}", $num_cerrados, $row);

        $row = str_replace("{PENDIENTE}", utf8_encode($unico->validacion2), $row);
        $row = str_replace("{RECHAZADOS_MODIFICACION}", utf8_encode($unico->validacion3), $row);
        $row = str_replace("{RECHAZADOS}", utf8_encode($unico->validacion4), $row);


        $row = str_replace("{NUEVO}", utf8_encode($nuevo), $row);


        $row = str_replace("{ACCIONJEFE}", utf8_encode($unico->validacionjefeaccion), $row);
        $row = str_replace("{PENDIENTESJEFE}", utf8_encode($pendientes_jefe), $row);
        $row = str_replace("{ACCIONADMIN}", utf8_encode($unico->validacionadmin), $row);
        $row = str_replace("{PENDIENTESADMIN}", utf8_encode($pendientes_admin), $row);

        $total_html .= $row;
    }
    $html = str_replace("{LISTA}", $total_html, $html);
    $html = str_replace("{TITULO}", "Solicitudes ChileActivo", $html);
    $html = str_replace("{BTN}", "Nueva Pregunta", $html);
    $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
    $html = str_replace("{BTN_VOLVER}", '', $html);
    $html = str_replace("{COLUMNA}", 'Pregunta', $html);
    return ($html);
}

function lista_solicitudes_chileactivo_v2($html, $id_empresa, $idcategoria)
{
    $lista = lista_solicitudes_chileactivo_data_v2($id_empresa);
    //print_r($emb_olas);
    foreach ($lista as $unico) {

        $row = file_get_contents("views/chileactivo/row_beneficios.html");
        $tipo = "";
        if ($unico->validacionjefe == "SI") {
            $tipo = "REQUIERE VALIDACION JEFE";
        }
        //echo "<br>tipo $tipo tipo valida ".$unico->validacionjefe;
        $no_vistos = $unico->solicitudes - $unico->visto;
        //echo "no visto $no_vistos.";

        if ($no_vistos > 0) {
            if ($no_vistos == 1) {
                $nuevo = "<span class='badge badge-danger'>" . $no_vistos . " nuevo</span>";
            } else {
                $nuevo = "<span class='badge badge-danger'>" . $no_vistos . " nuevos</span>";
            }
        } else {
            $nuevo = "";
        }


        $num_cerrados = 0;
        $num_proceso = 0;
        $num_pendientes = 0;
        //por cada beneficio, hago una barrido por cada solicitudes-$unico-
        $array_solicitudes = Beneficios_BarridoSolicitudes($unico->id_beneficios, $id_empresa);
        foreach ($array_solicitudes as $unico_sol) {
            $val = Beneficios_Busca_Estado_Solo_Data($unico_sol->id, $unico->tipo_workflow);
            if ($val == "Pendiente") {
                $num_pendientes++;
            }
            if ($val == "En Proceso") {
                $num_proceso++;
            }
            if ($val == "Cerrado") {
                $num_cerrados++;
            }


        }


        $row = str_replace("{ID}", utf8_encode($unico->id_beneficios), $row);
        $row = str_replace("{TIPO}", utf8_encode($unico->nombre_tipo_workflow), $row);
        $row = str_replace("{NOMBRE}", utf8_encode($unico->nombre), $row);
        $row = str_replace("{SOLICITUDES}", utf8_encode($unico->solicitudes), $row);
        $row = str_replace("{APROBADOS", utf8_encode($unico->validacion1), $row);

        $row = str_replace("{PENDIENTES}", $num_pendientes, $row);
        $row = str_replace("{EN_PROCESO}", $num_proceso, $row);
        $row = str_replace("{CERRADAS}", $num_cerrados, $row);

        $row = str_replace("{PENDIENTE}", utf8_encode($unico->validacion2), $row);
        $row = str_replace("{RECHAZADOS_MODIFICACION}", utf8_encode($unico->validacion3), $row);
        $row = str_replace("{RECHAZADOS}", utf8_encode($unico->validacion4), $row);


        $row = str_replace("{NUEVO}", utf8_encode($nuevo), $row);


        $row = str_replace("{ACCIONJEFE}", utf8_encode($unico->validacionjefeaccion), $row);
        $row = str_replace("{PENDIENTESJEFE}", utf8_encode($pendientes_jefe), $row);
        $row = str_replace("{ACCIONADMIN}", utf8_encode($unico->validacionadmin), $row);
        $row = str_replace("{PENDIENTESADMIN}", utf8_encode($pendientes_admin), $row);

        $total_html .= $row;
    }
    $html = str_replace("{LISTA}", $total_html, $html);
    $html = str_replace("{TITULO}", "Solicitudes Talleres Online", $html);
    $html = str_replace("{BTN}", "Nueva Pregunta", $html);
    $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
    $html = str_replace("{BTN_VOLVER}", '', $html);
    $html = str_replace("{COLUMNA}", 'Pregunta', $html);
    return ($html);
}

function lista_solicitudes_chileactivo_v3($html, $id_empresa, $idcategoria)
{
    $lista = lista_solicitudes_chileactivo_data_v3($id_empresa);
    //print_r($emb_olas);
    foreach ($lista as $unico) {

        $row = file_get_contents("views/chileactivo/row_beneficios_desinscripcion.html");
        $tipo = "";
        if ($unico->validacionjefe == "SI") {
            $tipo = "REQUIERE VALIDACION JEFE";
        }
        //echo "<br>tipo $tipo tipo valida ".$unico->validacionjefe;
        $no_vistos = $unico->solicitudes - $unico->visto;
        //echo "no visto $no_vistos.";

        if ($no_vistos > 0) {
            if ($no_vistos == 1) {
                $nuevo = "<span class='badge badge-danger'>" . $no_vistos . " nuevo</span>";
            } else {
                $nuevo = "<span class='badge badge-danger'>" . $no_vistos . " nuevos</span>";
            }
        } else {
            $nuevo = "";
        }


        $num_cerrados = 0;
        $num_proceso = 0;
        $num_pendientes = 0;
        //por cada beneficio, hago una barrido por cada solicitudes-$unico-
        $array_solicitudes = Beneficios_BarridoSolicitudes($unico->id_beneficios, $id_empresa);
        foreach ($array_solicitudes as $unico_sol) {
            $val = Beneficios_Busca_Estado_Solo_Data($unico_sol->id, $unico->tipo_workflow);
            if ($val == "Pendiente") {
                $num_pendientes++;
            }
            if ($val == "En Proceso") {
                $num_proceso++;
            }
            if ($val == "Cerrado") {
                $num_cerrados++;
            }


        }


        $row = str_replace("{ID}", utf8_encode($unico->id_beneficios), $row);
        $row = str_replace("{TIPO}", utf8_encode($unico->nombre_tipo_workflow), $row);
        $row = str_replace("{NOMBRE}", utf8_encode($unico->nombre), $row);
        $row = str_replace("{DESINSCRIPCIONES}", utf8_encode($unico->desinscripciones), $row);
        $row = str_replace("{CATEGORIA}", utf8_encode($unico->categoria), $row);

        $row = str_replace("{PENDIENTES}", $num_pendientes, $row);
        $row = str_replace("{EN_PROCESO}", $num_proceso, $row);
        $row = str_replace("{CERRADAS}", $num_cerrados, $row);

        $row = str_replace("{PENDIENTE}", utf8_encode($unico->validacion2), $row);
        $row = str_replace("{RECHAZADOS_MODIFICACION}", utf8_encode($unico->validacion3), $row);
        $row = str_replace("{RECHAZADOS}", utf8_encode($unico->validacion4), $row);


        $row = str_replace("{NUEVO}", utf8_encode($nuevo), $row);


        $row = str_replace("{ACCIONJEFE}", utf8_encode($unico->validacionjefeaccion), $row);
        $row = str_replace("{PENDIENTESJEFE}", utf8_encode($pendientes_jefe), $row);
        $row = str_replace("{ACCIONADMIN}", utf8_encode($unico->validacionadmin), $row);
        $row = str_replace("{PENDIENTESADMIN}", utf8_encode($pendientes_admin), $row);

        $total_html .= $row;
    }
    $html = str_replace("{LISTA}", $total_html, $html);
    $html = str_replace("{TITULO}", "Solicitudes Talleres Online", $html);
    $html = str_replace("{BTN}", "Nueva Pregunta", $html);
    $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
    $html = str_replace("{BTN_VOLVER}", '', $html);
    $html = str_replace("{COLUMNA}", 'Pregunta', $html);
    return ($html);
}

function LimpiaCaracteresSimbolos($texto)
{

    $texto = str_replace("<br>", "", $texto);
    $texto = str_replace("/\r|\n/", "", $texto);
    $texto = str_replace(array("\r", "\n"), '', $texto);
    $texto = str_replace(array("\r\n", "\r", "\n"), "", $texto);
    $texto = strip_tags(trim($texto));

    return $texto;

}

function Metas_lista_audiencia($html, $id_empresa, $filtro_edit,
                               $filtro1, $filtro2, $filtro3, $filtro4, $filtro5, $filtro6, $excluir, $incluir,
                               $nombre_audiencia, $descripcion_audiencia, $campos_filtros, $id_audiencia, $reset, $filtro_creador, $filtro_mes_ano)
{

    /*echo "<BR> $id_empresa, $filtro_edit,
	$filtro1, $filtro2, $filtro3, $filtro4, $filtro5, $filtro6, $excluir, $incluir,
	$nombre_audiencia, $descripcion_audiencia, $campos_filtros, $id_audiencia, $reset, $filtro_creador, $filtro_mes_ano";
	*///echo "id_audiencia $id_audiencia";

    $array_Audiencia = MetasBuscaDatosAudiencia($id_audiencia);
    //print_r($array_Audiencia);

    $arreglo = MetasMatrizIncentivos_Lista_campo_data("division", "area", "zona", "sucursal", "unidad_negocio", "cargo", $filtro1, $filtro2, $filtro3, $filtro4, $filtro5, $filtro6, $excluir, $incluir, $id_empresa);
    //echo "<pre>";print_r($arreglo);exit();

    foreach ($arreglo[1] as $unico) {
        $row1 .= file_get_contents("views/metas/row_lista_checkbox.html");
        $row1 = str_replace("{CAMPO}", ($unico->dato), $row1);
        $row1 = str_replace("{ID}", "campo1_" . ($unico->dato), $row1);
        if ($id_audiencia > 0) {
            if (in_array($unico->dato, $filtro_edit[1])) {
                $checked1 = "checked";
            } else {
                $checked1 = "";
            }
        } else {
            if ($filtro1 <> "") {
                $checked1 = "checked";
            } else {
                $checked1 = "";
            }
        }
        $row1 = str_replace("{CHECKED}", $checked1, $row1);
    }

    foreach ($arreglo[2] as $unico) {
        $row2 .= file_get_contents("views/metas/row_lista_checkbox.html");
        $row2 = str_replace("{CAMPO}", ($unico->dato), $row2);
        $row2 = str_replace("{ID}", "campo2_" . ($unico->dato), $row2);
        if ($id_audiencia > 0) {
            if (in_array($unico->dato, $filtro_edit[2])) {
                $checked2 = "checked";
            } else {
                $checked2 = "";
            }
        } else {
            if ($filtro2 <> "") {
                $checked2 = "checked";
            } else {
                $checked2 = "";
            }
        }
        $row2 = str_replace("{CHECKED}", $checked2, $row2);
    }

    foreach ($arreglo[3] as $unico) {
        $row3 .= file_get_contents("views/metas/row_lista_checkbox.html");
        $row3 = str_replace("{CAMPO}", ($unico->dato), $row3);
        $row3 = str_replace("{ID}", "campo3_" . ($unico->dato), $row3);
        if ($id_audiencia > 0) {
            if (in_array($unico->dato, $filtro_edit[3])) {
                $checked3 = "checked";
            } else {
                $checked3 = "";
            }
        } else {
            if ($filtro3 <> "") {
                $checked3 = "checked";
            } else {
                $checked3 = "";
            }
        }
        $row3 = str_replace("{CHECKED}", $checked3, $row3);
    }

    foreach ($arreglo[4] as $unico) {
        $row4 .= file_get_contents("views/metas/row_lista_checkbox.html");
        $row4 = str_replace("{CAMPO}", ($unico->dato), $row4);
        $row4 = str_replace("{ID}", "campo4_" . ($unico->dato), $row4);
        if ($id_audiencia > 0) {
            if (in_array($unico->dato, $filtro_edit[4])) {
                $checked4 = "checked";
            } else {
                $checked4 = "";
            }
        } else {
            if ($filtro4 <> "") {
                $checked4 = "checked";
            } else {
                $checked4 = "";
            }
        }
        $row4 = str_replace("{CHECKED}", $checked4, $row4);
    }

    foreach ($arreglo[5] as $unico) {
        $row5 .= file_get_contents("views/metas/row_lista_checkbox.html");
        $row5 = str_replace("{CAMPO}", ($unico->dato), $row5);
        $row5 = str_replace("{ID}", "campo5_" . ($unico->dato), $row5);
        if ($id_audiencia > 0) {
            if (in_array($unico->dato, $filtro_edit[5])) {
                $checked5 = "checked";
            } else {
                $checked5 = "";
            }
        } else {
            if ($filtro5 <> "") {
                $checked5 = "checked";
            } else {
                $checked5 = "";
            }
        }
        $row5 = str_replace("{CHECKED}", $checked5, $row5);
    }

    foreach ($arreglo[6] as $unico) {
        $row6 .= file_get_contents("views/metas/row_lista_checkbox.html");
        $row6 = str_replace("{CAMPO}", ($unico->dato), $row6);
        $row6 = str_replace("{ID}", "campo6_" . ($unico->dato), $row6);


        //echo "filtro 6, id audiencia $id_audiencia, print filtro edit 6  ". print_r($filtro_edit[6]);

        if ($id_audiencia > 0) {
            if (in_array($unico->dato, $filtro_edit[6])) {
                $checked6 = "checked";
            } else {
                $checked6 = "";
            }
        } else {
            if ($filtro6 <> "") {
                $checked6 = "checked";
            } else {
                $checked6 = "";
            }
        }
        $row6 = str_replace("{CHECKED}", $checked6, $row6);
    }
    //echo "<br>Numero ".$arreglo[5];//echo "<br>Usuario ".$arreglo[6];//echo "<br>Sql ".$arreglo[7];

    if ($nombre_audiencia <> "" and $arreglo[9] <> "" and $descripcion_audiencia <> "") {
        //echo "<sql> ".$arreglo[7];	//echo "<br>Encodear3 ".Encodear3($arreglo[7]);	//echo "zbr>Descodear3 ".Decodear3(Encodear3($arreglo[7]));
        MetasAudiencia_Save_NuevaAudiencia($nombre_audiencia, $descripcion_audiencia, $id_empresa, Encodear3($arreglo[9]), $excluir, $incluir, $campos_filtros, $id_audiencia);

        if ($id_audiencia > 0) {
            echo "<script>alert('Audiencia Actualizada');</script>";
            echo "<script>location.href='?sw=Metas_audiencias&reset=1';    </script>";

        } else {
            echo "<script>alert('Audiencia Registrada');</script>";
            echo "<script>location.href='?sw=Metas_audiencias&reset=1';    </script>";
        }
    }

    if ($nombre_audiencia == "") {
        $nombre_audiencia = $array_Audiencia[0]->nombre;
    }
    if ($descripcion_audiencia == "") {
        $descripcion_audiencia = $array_Audiencia[0]->descripcion;
    }

//echo "<br>excluir $excluir. POST ".$array_Audiencia[0]->excluir;
//echo "<br>incluir $incluir. POST ".$array_Audiencia[0]->incluir;

    if ($excluir == "") {
        $excluir = $array_Audiencia[0]->excluir;
    }
    if ($incluir == "") {
        $incluir = $array_Audiencia[0]->incluir;
    }

//echo "<br>excluir $excluir. POST ".$array_Audiencia[0]->excluir;
//echo "<br>incluir $incluir. POST ".$array_Audiencia[0]->incluir;

    $html = str_replace("{NUMERO_PERSONAS}", $arreglo[7], $html);
    $html = str_replace("{EXCLUIR}", $excluir, $html);
    $html = str_replace("{INCLUIR}", $incluir, $html);
    $html = str_replace("{NOMBRE_AUDIENCIA}", $nombre_audiencia, $html);
    $html = str_replace("{DESCRIPCION_AUDIENCIA}", $descripcion_audiencia, $html);

    $lista_fc = Metas_lista_audiencia_data($id_empresa, $filtro_creador, $filtro_mes_ano);
    foreach ($lista_fc as $unico) {

        //echo "<br>";
        //print_r($unico);
        //echo "<br>";

        $campos_filtros_data = "";

        $campos_filtros_data = $unico->campos_filtros;


        $num_colaboradores = Metas_Cuenta_Audiencia_Sql(Decodear3($unico->sqlquery), $unico->id, $id_empresa);


        $row = file_get_contents("views/metas/row_audienciat.html");


        $row = str_replace("{ID_AUDIENCIA}", utf8_encode($unico->id), $row);
        $row = str_replace("{NOMBRE_AUDIENCIA}", utf8_encode($unico->nombre), $row);
        $row = str_replace("{DESCRIPCION_AUDIENCIA}", utf8_encode($unico->descripcion), $row);
        $row = str_replace("{FILTRO}", ($campos_filtros_data), $row);

        $row = str_replace("{SQLQUERY}", ($unico->sqlquery), $row);
        $row = str_replace("{SQLQUERY_DEC}", (Decodear3($unico->sqlquery)), $row);
        $row = str_replace("{EXCLUSION}", ($unico->excluir), $row);
        $row = str_replace("{INCLUSION}", ($unico->incluir), $row);

        $row = str_replace("{CREADOR}", ($unico->autor), $row);
        $row = str_replace("{FECHA_CREACION}", ($unico->fecha_creacion), $row);


        $row = str_replace("{FORMULARIO_EDITAR}", "
					
					<form name='form_" . $unico->id . "' id='form_" . $unico->id . "' action='?sw=Metas_audiencias&id_audiencia=" . Encodear3($unico->id) . "&filt_enc=" . ($unico->campos_filtros_enc) . "' method='post'>
						<input type='submit' class='btn btn-link flat' value='Editar Audiencia' style='margin-top: 0px;margin-right: 10px;  font-size: 10px; display: inline-flex;'>
					</form>
					
					", $row);
        $row = str_replace("{ELIMINA}", "
					<a href='?sw=Metas_audiencias&delaudiencia=1&ida=" . Encodear3($unico->id) . "' 
					class='btn btn-link' style='font-size: 12px;' onclick='return confirm(\"Estas seguro de eliminar la Audiencia\")'>
					<small>Eliminar</small></a>", $row);


        $row = str_replace("{DESCARGAR_USUARIOS}", "
					
					<form name='form_" . $unico->id . "2' id='form_" . $unico->id . "2' action='?sw=Metas_FC_Descarga_Audiencia' method='post'>
					
					<input type='hidden' id='sqlquery' name='sqlquery' value='" . $unico->sqlquery . "'>
					<input type='submit' class='btn btn-link flat' value='Descargar Usuarios Audiencia' style='margin-top: 0px;margin-right: 10px;  font-size: 10px; display: inline-flex;'>
					</form>
					
					", $row);


        $row = str_replace("{NUM_COLABORADORES}", $num_colaboradores, $row);
        $row = str_replace("{DESCARGA_EXCEL}", $unico->sqlquery, $row);
        $total_html .= $row;


    }

    ///print_r($row5);

    $html = str_replace("{VISTA_AGRUPACION_CAMPO1}", $row1, $html);
    $html = str_replace("{VISTA_AGRUPACION_CAMPO2}", $row2, $html);
    $html = str_replace("{VISTA_AGRUPACION_CAMPO3}", $row3, $html);
    $html = str_replace("{VISTA_AGRUPACION_CAMPO4}", $row4, $html);
    $html = str_replace("{VISTA_AGRUPACION_CAMPO5}", $row5, $html);
    $html = str_replace("{VISTA_AGRUPACION_CAMPO6}", $row6, $html);

    //echo "reset $reset funciones";
    if ($reset == 1) {

        $campos_filtros = "";

    }
    //echo "campos_filtros $campos_filtros";

    $html = str_replace("{CADENA_FILTRO}", $campos_filtros, $html);
    $html = str_replace("{ID_AUDIENCIA_EDIT}", $id_audiencia, $html);

    $html = str_replace("{LISTA}", $total_html, $html);
    $html = str_replace("{TITULO}", "Lista de Audiencias", $html);
    $html = str_replace("{BTN}", "Nueva Pregunta", $html);
    $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
    $html = str_replace("{BTN_VOLVER}", '', $html);
    $html = str_replace("{COLUMNA}", 'Pregunta', $html);

    return ($html);
}

function ColocaFiltrosParaAdminSillasDesdeTablaSillasDesdeTblUsuario($user)
{

    $filtros = SillasVerificoFiltros($user);
    $contador = 1;
    foreach ($filtros as $fil) {


        if ($contador == 1) {
            $filtros_gestor .= " and (" . $fil->campo_tabla_usuario . "='" . utf8_encode($fil->criterio) . "'";
        }


        if ($contador > 1) {
            $filtros_gestor .= " " . $fil->campo_tabla_usuario . "='" . utf8_encode($fil->criterio) . "' ";
        }

        if ($contador < count($filtros)) {
            $filtros_gestor .= " or ";
        }


        $contador++;
    }
    if (count($filtros) > 1) {
        $filtros_gestor .= ")";
    }

    return ($filtros_gestor);
}


function randomPassword()
{
    $alphabet1 = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890#!';
    $pass1 = array(); //remember to declare $pass as an array
    $alphaLength1 = strlen($alphabet1) - 1; //put the length -1 in cache
    for ($i = 0; $i < 8; $i++) {
        $n = rand(0, $alphaLength1);
        $pass1[] = $alphabet1[$n];
    }
    $pass_1 = implode($pass1);

    $alphabet2 = '&#!_';
    $pass2 = array(); //remember to declare $pass as an array
    $alphaLength2 = strlen($alphabet2) - 1; //put the length -1 in cache
    for ($i = 0; $i < 2; $i++) {
        $n = rand(0, $alphaLength2);
        $pass2[] = $alphabet2[$n];
    }
    $pass_2 = implode($pass2);

    $alphabet3 = '1234567890';
    $pass3 = array(); //remember to declare $pass as an array
    $alphaLength3 = strlen($alphabet3) - 1; //put the length -1 in cache
    for ($i = 0; $i < 4; $i++) {
        $n = rand(0, $alphaLength3);
        $pass3[] = $alphabet3[$n];
    }
    $pass_3 = implode($pass3);

    $p1 = $pass_1;
    $p2 = $pass_2;
    $p3 = $pass_3;


    $arreglo[0] = $pass_1;
    $arreglo[1] = $pass_2;
    $arreglo[2] = $pass_3;


    return $arreglo; //turn the array into a string
}


function ColocaFiltrosParaAdminSillasDesdeTablaSillas($user)
{

    $filtros = SillasVerificoFiltros($user);
    $contador = 1;
    foreach ($filtros as $fil) {


        if ($contador == 1) {
            $filtros_gestor .= " and (" . $fil->campo_tabla_silla . "='" . utf8_encode($fil->criterio) . "'";
        }


        if ($contador > 1) {
            $filtros_gestor .= " " . $fil->campo_tabla_silla . "='" . utf8_encode($fil->criterio) . "' ";
        }

        if ($contador < count($filtros)) {
            $filtros_gestor .= " or ";
        }


        $contador++;
    }
    if (count($filtros) > 1) {
        $filtros_gestor .= ")";
    }

    return ($filtros_gestor);
}


function Metas_Lista_Gestion_Bloque_Metas($html, $id_empresa, $id_matriz, $periodo)
{

    //echo "$id_empresa, id matriz $id_matriz, periodo $periodo";	//nombre matriz
    $nombre_Matriz = Metas_Lista_NivelCargo_Nombre_data($id_matriz, $id_empresa);

    $tipo_creadores = Metas_Lista_tipo_creadores_data($periodo, $id_empresa);
    foreach ($tipo_creadores as $unico) {
        $options_creadores .= " <option value='" . $unico->id_creador . "'>" . utf8_encode($unico->nombre) . "</th>";
    }

    //Lista Evaluadores
    $tipo_evaluadores = Metas_Lista_tipo_evaluadores_data($periodo, $id_empresa);
    foreach ($tipo_evaluadores as $unico) {
        $options_evaluadores .= " <option value='" . $unico->id_evaluador . "'>" . utf8_encode($unico->nombre) . "</th>";
    }

    //Lista Tipos de Metas
    $tipo_metas = Metas_Lista_Tipo_Metas_Periodo_NivelCargo_data($periodo, $id_matriz, $id_empresa);
    $suma_ponderacion_por_tipo_meta = 0;

    foreach ($tipo_metas as $unico) {
        $row_tipo_meta = "";
        $row_tipo_meta = file_get_contents("views/metas/row_gestion_tipo_meta.html");
        $row_tipo_meta = str_replace("{ID_TIPO_META}", utf8_encode($unico->id), $row_tipo_meta);
        $row_tipo_meta = str_replace("{ID_TIPO_META_ENC}", Encodear3($unico->tipo_meta), $row_tipo_meta);

        $row_tipo_meta = str_replace("{NOMBRE_TIPO_META}", utf8_encode($unico->nombre_tipo_meta), $row_tipo_meta);
        $row_tipo_meta = str_replace("{PONDERACION_TIPO_META}", utf8_encode($unico->ponderacion) . "%", $row_tipo_meta);
        $row_tipo_meta = str_replace("{ID_TIPO_MATRIZ_ENC}", Encodear3($id_matriz), $row_tipo_meta);
        $row_tipo_meta = str_replace("{ID_PERIODO_ENC}", Encodear3($periodo), $row_tipo_meta);

        $row_tipo_meta = str_replace("{METAS_2020_OPTIONS_CREADOR_META}", ($options_creadores), $row_tipo_meta);
        $row_tipo_meta = str_replace("{METAS_2020_OPTIONS_EVALUADOR_META}", ($options_evaluadores), $row_tipo_meta);

        //lista Bloques
        $bloques_metas = Metas_Lista_Tipo_Metas_Periodo_NivelCargo_Bloques_data($periodo, $unico->nivel, $unico->tipo_meta, $id_empresa);
        $row_bloque_meta = "";


        $suma_ponderacion_por_bloque = 0;
        $suma_ponderacion_por_tipo_meta = 0;
        foreach ($bloques_metas as $unico2) {

            $row_bloque_meta .= file_get_contents("views/metas/row_gestion_bloque_meta.html");
            $row_bloque_meta = str_replace("{ID_BLOQUE}", utf8_encode($unico2->id), $row_bloque_meta);

            $row_bloque_meta = str_replace("{NOMBRE_BLOQUE}", utf8_encode($unico2->nombre), $row_bloque_meta);
            $row_bloque_meta = str_replace("{NOMBRE_MATRIZ}", utf8_encode($unico2->nombre_cargo), $row_bloque_meta);

            $row_bloque_meta = str_replace("{CREADOR_METAS_BLOQUE}", utf8_encode($unico2->creador), $row_bloque_meta);
            $row_bloque_meta = str_replace("{EVALUADOR_METAS_BLOQUE}", utf8_encode($unico2->evaluador), $row_bloque_meta);

            $row_bloque_meta = str_replace("{PONDERACION_BLOQUE}", utf8_encode($unico2->ponderacion . "%"), $row_bloque_meta);
            $row_bloque_meta = str_replace("{PONDERACION_BLOQUE_NUM}", utf8_encode($unico2->ponderacion), $row_bloque_meta);
            $row_bloque_meta = str_replace("{METAS_2020_OPTIONS_CREADOR_META}", ($options_creadores), $row_bloque_meta);
            $row_bloque_meta = str_replace("{METAS_2020_OPTIONS_EVALUADOR_META}", ($options_evaluadores), $row_bloque_meta);

            $row_bloque_meta = str_replace("{ID_TIPO_MATRIZ_ENC}", Encodear3($id_matriz), $row_bloque_meta);
            $row_bloque_meta = str_replace("{ID_PERIODO_ENC}", Encodear3($periodo), $row_bloque_meta);


            //echo "<br>Unico 2 ". $unico2->id_creador;

            //lista Bloques
            $metas_definicion = Metas_Lista_Tipo_Metas_Definicion_Periodo_NivelCargo_Bloques_data($periodo, $unico->nivel, $unico->tipo_meta, $unico2->id, $id_empresa);
            $row_meta_definicion = "";
            //print_r($metas_definicion);
            $suma_ponderacion_por_bloque_meta = 0;
            foreach ($metas_definicion as $unico3) {

                $row_meta_definicion .= file_get_contents("views/metas/row_gestion_meta_definicion.html");


                $row_meta_definicion = str_replace("{ID_META}", utf8_encode($unico3->id), $row_meta_definicion);
                $row_meta_definicion = str_replace("{NOMBRE_META}", utf8_encode($unico3->meta), $row_meta_definicion);
                $row_meta_definicion = str_replace("{NOMBRE_MATRIZ}", utf8_encode($unico3->nombre_cargo), $row_meta_definicion);

                if ($unico3->estado_creacion == "Cerrada") {
                    $estado_creacion = "<i class='fas fa-check-square'></i> Cerrada";
                }

                if ($unico3->estado_creacion == "En Definicion") {
                    $estado_creacion = "<i class='fas fa-exclamation-circle'></i> En Definicion";
                }


                $row_meta_definicion = str_replace("{ESTADO_CREACION}", utf8_encode($estado_creacion), $row_meta_definicion);
                $row_meta_definicion = str_replace("{CRITERIO_MEDICION}", utf8_encode($unico3->criterio_medicion), $row_meta_definicion);
                $row_meta_definicion = str_replace("{CUMPLIMIENTO_90}", utf8_encode($unico3->cumplimiento_90), $row_meta_definicion);
                $row_meta_definicion = str_replace("{CUMPLIMIENTO_100}", utf8_encode($unico3->cumplimiento_100), $row_meta_definicion);
                $row_meta_definicion = str_replace("{CUMPLIMIENTO_130}", utf8_encode($unico3->cumplimiento_130), $row_meta_definicion);

                $row_meta_definicion = str_replace("{PONDERACION}", utf8_encode($unico3->ponderacion . "%"), $row_meta_definicion);


                $row_meta_definicion = str_replace("{ID_TIPO_MATRIZ_ENC}", Encodear3($id_matriz), $row_meta_definicion);
                $row_meta_definicion = str_replace("{ID_PERIODO_ENC}", Encodear3($periodo), $row_meta_definicion);


                $suma_ponderacion_por_bloque_meta = $suma_ponderacion_por_bloque_meta + $unico3->ponderacion;
                //echo "<br> ".$unico2->nombre." suma_ponderacion_por_bloque $suma_ponderacion_por_bloque_meta";
            }


            $row_bloque_meta = str_replace("{META_2020_POR_BLOQUE_TIPO_META}", $row_meta_definicion, $row_bloque_meta);


            if ($unico2->id_creador == "bch_admin") {
                //echo "<h1>A Creador Admin </h1>";
                $boton_creacion_edicion_meta_2020 = "
														
														
					<div class='pull-right'><a href='#' data-toggle='modal' data-target='#meta_nuevo" . $unico2->id . "' class='btn btn-info'>Agregar Meta <i class='far fa-plus-square'></i></a></div>	
											<div class='modal fade' id='meta_nuevo" . $unico2->id . "' tabindex='-1' role='dialog' aria-labelledby='meta_nuevo" . $unico2->id . "' aria-hidden='true'>
											  <div class='modal-dialog' role='document'>
											    <div class='modal-content'>
											      <div class='modal-header'>
											        <h5 class='modal-title' id='exampleModalLabel'>Nueva Meta " . ($unico2->nombre) . " | " . ($unico->nombre_tipo_meta) . " </h5>
											        <button type='button' class='close' data-dismiss='modal' aria-label='Close'>
											          <span aria-hidden='true'>&times;</span>
											        </button>
											      </div>
											      <div class='modal-body'>
											      		<form name='meta_nuevo" . $unico2->id . "' id='meta_nuevo" . $unico2->id . "' action='?sw=Metas_Gestionar_Matriz&id_m=" . Encodear3($id_matriz) . "&id_p=" . Encodear3($periodo) . "' method='post'>
											      			<label class='label_txt_meta'>Definici?n Meta</label><br>
											      			<input type='text' name='meta' id='meta' class='form form-control'>
											      			
											      			<label class='label_txt_meta'>Criterio de Medici?n</label><br>
											      			<input type='text' name='criterio_medicion' id='criterio_medicion' class='form form-control'>

											      			<label class='label_txt_meta'>Cumplimiento 90%</label><br>
											      			<input type='text' name='cumplimiento_90' id='cumplimiento_90' class='form form-control'>

											      			<label class='label_txt_meta'>Cumplimiento 100%</label><br>
											      			<input type='text' name='cumplimiento_100' id='cumplimiento_100' class='form form-control'>

											      			<label class='label_txt_meta'>Cumplimiento 130%</label><br>
											      			<input type='text' name='cumplimiento_130' id='cumplimiento_130' class='form form-control'>
											      			
											      			<label class='label_txt_meta'>Estado Creaci?n</label><br>
											      			<select name='estado_creacion' class='form form-control'>
											      				<option value=''></option>
																		<option value='En Definicion'>En Definicion</option>						      					
																		<option value='Cerrada'>Cerrada</option>						      																		
											      			</select>
											      			
											      			
											      			<label class='label_txt_meta'>Ponderacion Meta (M&aacute;ximo: {METAS_2020_BLOQUE_PONDERACION_MAXIMO}%)</label><br>
											      			<input type='number' min='{METAS_2020_BLOQUE_PONDERACION_MINIMO}' max='{METAS_2020_BLOQUE_PONDERACION_MAXIMO}' name='meta_ponderacion' id='meta_ponderacion' class='form form-control' style='    width: 100px;'>
											      			
											      			<input type='hidden' name='id_creador' value='" . Encodear3($unico2->id_creador) . "'>
											      			<input type='hidden' name='nivel' value='" . Encodear3($id_matriz) . "'>
											      			<input type='hidden' name='tipo_meta' value='" . Encodear3($unico2->tipo_meta) . "'>
											      			<input type='hidden' name='bloque' value='" . Encodear3($unico2->id) . "'>
											      			<input type='hidden' name='periodo' value='" . Encodear3($periodo) . "'>
											      			<input type='hidden' name='meta_save' value='1'>
											      			<br>
											      				<center><input type='submit' class='btn btn-info' value='Crear Meta'></center>
											      			<br>
											      		</form>
											      </div>
											      <div class='modal-footer'>
											      </div>
											    </div>
											  </div>
											</div>									
														
														";
            } else {
                $boton_creacion_edicion_meta_2020 = "";
            }

            $maximo_ponderacion_bloque = 100;
            $minimo = 1;
            $complemento_Bloque_Meta = $maximo_ponderacion_bloque - $suma_ponderacion_por_bloque_meta;

            if ($complemento_Bloque_Meta > 0) {
                $estado_tipo_bloque_meta = " <div class='Txt_2020_color_pendiente'><i class='fas fa-exclamation-circle'></i> " . $complemento_Bloque_Meta . "% por asignar</div> ";
                $boton_agregar_bloque = " <div class='pull-right'><a href='#' data-toggle='modal' data-target='#bloque_nuevo" . $unico->id . "' class='btn btn-info'>Agregar Bloque <i class='far fa-plus-square'></i></a></div>	";
            } else {
                $estado_tipo_bloque_meta = " <div class='Txt_2020_color_terminado'><i class='fas fa-exclamation-circle'></i> Configuraci?n Cerrada</div> ";
                $boton_agregar_bloque = " 	";
                $boton_creacion_edicion_meta_2020 = "";
            }


            $row_bloque_meta = str_replace("{BOTON_AGREGAR_META_2020_POR_BLOQUE}", utf8_encode($boton_creacion_edicion_meta_2020), $row_bloque_meta);

            $row_bloque_meta = str_replace("{METAS_2020_BLOQUE_PONDERACION_MAXIMO}", utf8_encode($complemento_Bloque_Meta), $row_bloque_meta);
            $row_bloque_meta = str_replace("{METAS_2020_BLOQUE_PONDERACION_MINIMO}", $minimo, $row_bloque_meta);
            $row_bloque_meta = str_replace("{ESTADO_TIPO_META}", utf8_encode($estado_tipo_bloque_meta), $row_bloque_meta);

            //echo "<br> suma_ponderacion_por_bloque $suma_ponderacion_por_bloque";

            $suma_ponderacion_por_tipo_meta = $suma_ponderacion_por_tipo_meta + $unico2->ponderacion;
            //echo "<br> ".$unico->nombre_tipo_meta." suma_ponderacion_por_tipo_meta $suma_ponderacion_por_tipo_meta";


        }


        $maximo_ponderacion_bloque = 100;
        $minimo = 1;
        $complemento_bloque = $maximo_ponderacion_bloque - $suma_ponderacion_por_tipo_meta;
        //echo "<br> complemento_bloque $complemento_bloque";

        if ($complemento_bloque > 0) {
            $estado_tipo_meta = " <div class='Txt_2020_color_pendiente'><i class='fas fa-exclamation-circle'></i> " . $complemento_bloque . "% por asignar</div> ";
            $boton_agregar_bloque = " <div class='pull-right'><a href='#' data-toggle='modal' data-target='#bloque_nuevo" . $unico->id . "' class='btn btn-info'>Agregar Bloque <i class='far fa-plus-square'></i></a></div>	";
        } else {
            $estado_tipo_meta = " <div class='Txt_2020_color_terminado'><i class='fas fa-exclamation-circle'></i> Configuraci?n Cerrada</div> ";
            $boton_agregar_bloque = " 	";
        }

        $row_tipo_meta = str_replace("{ESTADO_TIPO_META}", utf8_encode($estado_tipo_meta), $row_tipo_meta);
        $row_tipo_meta = str_replace("{BLOQUE_2020_AGREGAR_BOTON}", utf8_encode($boton_agregar_bloque), $row_tipo_meta);

        $row_tipo_meta = str_replace("{METAS_2020_BLOQUE_PONDERACION_MAXIMO}", utf8_encode($complemento_bloque), $row_tipo_meta);
        $row_tipo_meta = str_replace("{METAS_2020_BLOQUE_PONDERACION_MINIMO}", utf8_encode($minimo), $row_tipo_meta);


        $row_tipo_meta = str_replace("{BLOQUE_2020_POR_TIPO_META}", $row_bloque_meta, $row_tipo_meta);
        $total_html .= $row_tipo_meta;

    }


    $html = str_replace("{METAS_2020_TIPO_METAS_BLOQUES_METAS}", $total_html, $html);
    $html = str_replace("{NOMBRE_MATRIZ}", utf8_encode($nombre_Matriz[0]->nombre), $html);

    $html = str_replace("{TITULO}", "Administradores", $html);
    $html = str_replace("{BTN}", "Nueva Pregunta", $html);
    $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
    $html = str_replace("{BTN_VOLVER}", '', $html);
    $html = str_replace("{COLUMNA}", 'Pregunta', $html);
    return ($html);
}


function Metas_Lista_Ver_Matriz_Tipo_Meta_Niveles_Cargo($html, $id_empresa, $idcategoria)
{

    $tipo_metas = Metas_Lista_tipo_metas_data($id_empresa);
    //print_r($tipo_metas);

    foreach ($tipo_metas as $unico) {
        $TH_options_row_tipo_metas_2020 .= " <th style='    min-width: 85px;'>" . utf8_encode($unico->tipo_meta) . "</th>";
    }
    // (".utf8_encode($unico->categoria_meta).")
    //echo "<br>".$options_row_tipo_metas_2020."<br>";

    $rel_nivel_cargo_tipo_metas = Metas_Lista_Audiencias_Tipo_Metas_data($id_empresa);
    //print_r($rel_nivel_cargo_tipo_metas);

    $row = file_get_contents("views/metas/entorno_ver_matriz_niveles_cargo.html");
    foreach ($rel_nivel_cargo_tipo_metas as $unico) {
        /*echo "<br>";		 	print_r($unico);		 	echo "<br>";*/
        $row = file_get_contents("views/metas/row_ver_matriz_niveles_cargo.html");
        $row = str_replace("{NIVEL_CARGO}", utf8_encode($unico->nivel_cargo), $row);
        $row = str_replace("{NOMBRE_MATRIZ}", utf8_encode($unico->nombre), $row);
        $row = str_replace("{PONDERACION}", utf8_encode($unico->ponderacion), $row);
        $row = str_replace("{PERIODO}", utf8_encode($unico->periodo), $row);
        $row = str_replace("{ID_REL_NIVEL_CARGO_TIPO_METAS}", utf8_encode($unico->id), $row);
        $row = str_replace("{ID_NIVEL_CARGO_ENC}", Encodear3($unico->id), $row);
        $row = str_replace("{PERIODO_ENC}", Encodear3($unico->periodo), $row);

        $tipo_metas = Metas_Lista_tipo_metas_data($id_empresa);
        /*print_r($tipo_metas);*/


        $suma_ponderacion = 0;
        $ROW_TD_METAS_PONDERACION_NIVEL_CARGO = "";
        $ROW_TD_METAS_PONDERACION_NIVEL_CARGO = "<form name='editNivel_" . $unico->id . "' action='?sw=Metas_VistaMatriz_Niveles_Cargo' method='post'>";
        foreach ($tipo_metas as $unico2) {
            $row_ponderacion = Metas_Ponderacion_NivelCargo_Tipo_Empresa($unico->id, $unico2->id, $id_empresa);
            if ($row_ponderacion == "") {
                $row_ponderacion = "-";
            }
            $ROW_TD_METAS_PONDERACION_NIVEL_CARGO .= " <td><input type='number' min='0' max='100' class='form form-control' name='" . $unico2->id . "' value='" . utf8_encode($row_ponderacion) . "' required style='width: 75px;'></td>";
            //busca bloques ponderacion
            //busca metas ponderacion
            $suma_ponderacion = $suma_ponderacion + $row_ponderacion;

        }
        $ROW_TD_METAS_PONDERACION_NIVEL_CARGO .= "<td>
								<input type='hidden' name='nivel'  		value='" . $unico->id . "'>
								<input type='hidden' name='periodo'  	value='" . $unico->periodo . "'>
								<input type='hidden' name='edit_nivel_tipo_metas'  value='1'>
								<input type='submit' class='btn btn-link' value='Guardar'></td></form>";
        $row = str_replace("{ROW_TD_METAS_PONDERACION_NIVEL_CARGO}", $ROW_TD_METAS_PONDERACION_NIVEL_CARGO, $row);

        if ($suma_ponderacion == "100") {
            $icon_ponderacion = "<i class='fas fa-check-circle  fa-2x' style='color: #4688bb;'></i>";
        } elseif ($suma_ponderacion > 0 and $suma_ponderacion < 100) {
            $icon_ponderacion = "<i class='fas fa-dot-circle fa-2x' style='color: #FDB511;'></i>";
        } else {
            $icon_ponderacion = "<i class='fas fa-dot-circle  fa-2x' style='color: #c2d0da;'></i>";
        }

        $icon_creacion = "<i class='fas fa-dot-circle  fa-2x'  style='color: #c2d0da;'></i>";
        $icon_evaluacion = "<i class='fas fa-dot-circle  fa-2x'  style='color: #c2d0da;'></i>";

        $row = str_replace("{SEMAFORO_PONDERACION}", $icon_ponderacion, $row);
        $row = str_replace("{SEMAFORO_CREACION}", $icon_creacion, $row);
        $row = str_replace("{SEMAFORO_EVALUACION}", $icon_evaluacion, $row);


        $row = str_replace("{ROW_SEMAFOROS}", $Semaforo_Matriz, $row);
        $total_html .= $row;
    }


    $html = str_replace("{TH_META_2020_TIPO_METAS}", $TH_options_row_tipo_metas_2020, $html);

    $html = str_replace("{OPTIONS_META_2020_PERIODOS}", $options_row_periodos_2020, $html);
    $html = str_replace("{OPTIONS_META_2020_NIVELES_CARGO}", $options_row_nivel_cargo_2020, $html);
    $html = str_replace("{OPTIONS_META_2020_TIPO_METAS}", $options_row_tipo_metas_2020, $html);

    $html = str_replace("{LISTA}", $total_html, $html);
    $html = str_replace("{TITULO}", "Administradores", $html);
    $html = str_replace("{BTN}", "Nueva Pregunta", $html);
    $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
    $html = str_replace("{BTN_VOLVER}", "<a href='?sw=Metas_VistaMatriz_Niveles_Cargo' class='btn btn-info'>Volver</a>", $html);
    $html = str_replace("{COLUMNA}", 'Pregunta', $html);
    return ($html);
}


function Metas_Lista_Rel_Tipo_Meta_Niveles_Cargo($html, $id_empresa, $idcategoria)
{


    $periodos = Metas_Lista_Periodos_data($id_empresa);
    foreach ($periodos as $unico) {
        $options_row_periodos_2020 .= "<option value='" . utf8_encode($unico->periodo) . "'>" . utf8_encode($unico->periodo) . " " . utf8_encode($unico->nombre_periodo) . "</option>";
    }

    $nivel_cargo = Metas_Lista_NivelCargo_data($id_empresa);
    foreach ($nivel_cargo as $unico) {
        $options_row_nivel_cargo_2020 .= "<option value='" . utf8_encode($unico->id) . "'>" . utf8_encode($unico->nivel) . " " . utf8_encode($unico->cargo) . "</option>";
    }

    $tipo_metas = Metas_Lista_tipo_metas_data($id_empresa);
    //print_r($tipo_metas);

    foreach ($tipo_metas as $unico) {
        $options_row_tipo_metas_2020 .= "<option value='" . utf8_encode($unico->id) . "'>" . utf8_encode($unico->tipo_meta) . " (" . utf8_encode($unico->categoria_meta) . ")</option>";
    }

    //echo "<br>".$options_row_tipo_metas_2020."<br>";

    $rel_nivel_cargo_tipo_metas = Metas_Lista_Rel_Niveles_Cargo_Tipo_Metas_data($id_empresa);
    $row = file_get_contents("views/metas/entorno_rel_tipo_meta_nivel_cargo.html");
    foreach ($rel_nivel_cargo_tipo_metas as $unico) {
        $row = file_get_contents("views/metas/row_rel_tipo_meta_nivel_cargo.html");
        $row = str_replace("{NIVEL_CARGO}", utf8_encode($unico->nivel_cargo) . " " . utf8_encode($unico->nombre_cargo), $row);
        $row = str_replace("{TIPO_METAS}", utf8_encode($unico->nombre_tipo_meta) . " (" . utf8_encode($unico->nombre_categoria_meta) . ")", $row);
        $row = str_replace("{PONDERACION}", utf8_encode($unico->ponderacion), $row);
        $row = str_replace("{PERIODO}", utf8_encode($unico->periodo), $row);
        $row = str_replace("{ID_REL_NIVEL_CARGO_TIPO_METAS}", utf8_encode($unico->id), $row);

        $row = str_replace("{OPTIONS_META_2020_NIVELES_CARGO}", $options_row_nivel_cargo_2020, $row);
        $row = str_replace("{OPTIONS_META_2020_TIPO_METAS}", $options_row_tipo_metas_2020, $row);
        $row = str_replace("{OPTIONS_META_2020_ROW_PERIODOS}", $options_row_periodos_2020, $row);


        $total_html .= $row;
    }


    $html = str_replace("{OPTIONS_META_2020_PERIODOS}", $options_row_periodos_2020, $html);
    $html = str_replace("{OPTIONS_META_2020_NIVELES_CARGO}", $options_row_nivel_cargo_2020, $html);
    $html = str_replace("{OPTIONS_META_2020_TIPO_METAS}", $options_row_tipo_metas_2020, $html);

    $html = str_replace("{LISTA}", $total_html, $html);
    $html = str_replace("{TITULO}", "Administradores", $html);
    $html = str_replace("{BTN}", "Nueva Pregunta", $html);
    $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
    $html = str_replace("{BTN_VOLVER}", '', $html);
    $html = str_replace("{COLUMNA}", 'Pregunta', $html);
    return ($html);
}

function Metas_Lista_Niveles_Cargo($html, $id_empresa, $idcategoria)
{


    $periodos = Metas_Lista_Periodos_data($id_empresa);
    foreach ($periodos as $unico) {
        $options_row_periodos_2020 .= "<option value='" . utf8_encode($unico->periodo) . "'>" . utf8_encode($unico->periodo) . " " . utf8_encode($unico->nombre_periodo) . "</option>";
    }

    $niveles_cargo = Metas_Lista_Niveles_Cargo_data($id_empresa);
    $row = file_get_contents("views/metas/entorno_niveles_cargo.html");
    foreach ($niveles_cargo as $unico) {
        $row = file_get_contents("views/metas/row_niveles_cargo.html");
        $row = str_replace("{NIVEL}", utf8_encode($unico->nivel), $row);
        $row = str_replace("{CARGO}", utf8_encode($unico->cargo), $row);
        $row = str_replace("{DESCRIPCION}", utf8_encode($unico->descripcion), $row);
        $row = str_replace("{PERIODO}", utf8_encode($unico->periodo), $row);
        $row = str_replace("{ID_NIVEL_CARGO}", utf8_encode($unico->id), $row);

        $row = str_replace("{OPTIONS_META_2020_ROW_PERIODOS}", $options_row_periodos_2020, $row);


        $total_html .= $row;
    }


    $html = str_replace("{OPTIONS_META_2020_PERIODOS}", $options_row_periodos_2020, $html);


    $html = str_replace("{LISTA}", $total_html, $html);
    $html = str_replace("{TITULO}", "Administradores", $html);
    $html = str_replace("{BTN}", "Nueva Pregunta", $html);
    $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
    $html = str_replace("{BTN_VOLVER}", '', $html);
    $html = str_replace("{COLUMNA}", 'Pregunta', $html);
    return ($html);
}

function Metas_Lista_Tipo_Metas($html, $id_empresa, $idcategoria)
{


    $periodos = Metas_Lista_Periodos_data($id_empresa);
    foreach ($periodos as $unico) {
        $options_row_periodos_2020 .= "<option value='" . utf8_encode($unico->periodo) . "'>" . utf8_encode($unico->periodo) . " " . utf8_encode($unico->nombre_periodo) . "</option>";
    }

    $tipo_metas = Metas_Lista_Tipo_Metas_data($id_empresa);
    $row = file_get_contents("views/metas/entorno_tipo_metas.html");
    foreach ($tipo_metas as $unico) {
        $row = file_get_contents("views/metas/row_tipo_metas.html");
        $row = str_replace("{PERIODO}", utf8_encode($unico->periodo), $row);


        $row = str_replace("{CATEGORIA_META}", utf8_encode($unico->categoria_meta), $row);
        $row = str_replace("{TIPO_META}", utf8_encode($unico->tipo_meta), $row);
        $row = str_replace("{DESCRIPCION_META}", utf8_encode($unico->descripcion), $row);
        $row = str_replace("{ID_TIPO_META}", utf8_encode($unico->id), $row);

        $row = str_replace("{OPTIONS_META_2020_ROW_PERIODOS}", $options_row_periodos_2020, $row);


        $total_html .= $row;
    }


    $html = str_replace("{OPTIONS_META_2020_PERIODOS}", $options_row_periodos_2020, $html);


    $html = str_replace("{LISTA}", $total_html, $html);
    $html = str_replace("{TITULO}", "Administradores", $html);
    $html = str_replace("{BTN}", "Nueva Pregunta", $html);
    $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
    $html = str_replace("{BTN_VOLVER}", '', $html);
    $html = str_replace("{COLUMNA}", 'Pregunta', $html);
    return ($html);
}

function Metas_Lista_Periodos($html, $id_empresa, $idcategoria)
{
    $periodos = Metas_Lista_Periodos_data($id_empresa);
    $row = file_get_contents("views/metas/entorno_periodos.html");
    foreach ($periodos as $unico) {
        $row = file_get_contents("views/metas/row_periodos.html");
        $row = str_replace("{PERIODO}", utf8_encode($unico->periodo), $row);
        $row = str_replace("{PERIODO_NOMBRE}", utf8_encode($unico->nombre_periodo), $row);
        $row = str_replace("{PERIODO_DESCRIPCION}", utf8_encode($unico->descripcion), $row);
        $row = str_replace("{ID_PERIODO}", utf8_encode($unico->id), $row);
        $total_html .= $row;
    }


    $html = str_replace("{LISTA}", $total_html, $html);
    $html = str_replace("{TITULO}", "Administradores", $html);
    $html = str_replace("{BTN}", "Nueva Pregunta", $html);
    $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
    $html = str_replace("{BTN_VOLVER}", '', $html);
    $html = str_replace("{COLUMNA}", 'Pregunta', $html);
    return ($html);
}

function ColocaFiltrosParaAdminSillasParaFiltrosDeBusqueda($user)
{

    $filtros = SillasVerificoFiltros($user);
    $contador = 1;
    foreach ($filtros as $fil) {


        if ($contador == 1) {
            $filtros_gestor .= " and (" . $fil->campo_filtro_busqueda . "='" . utf8_encode($fil->criterio) . "'";
        }


        if ($contador > 1) {
            $filtros_gestor .= " " . $fil->campo_filtro_busqueda . "='" . utf8_encode($fil->criterio) . "' ";
        }

        if ($contador < count($filtros)) {
            $filtros_gestor .= " or ";
        }


        $contador++;
    }
    if (count($filtros) > 1) {
        $filtros_gestor .= ")";
    }
    return ($filtros_gestor);
}


function ColocaFiltrosParaAdminSillas($user)
{

    $filtros = SillasVerificoFiltros($user);
    $contador = 1;
    foreach ($filtros as $fil) {


        if ($contador == 1) {
            $filtros_gestor .= " and (" . $fil->campo . "='" . utf8_encode($fil->criterio) . "'";
        }


        if ($contador > 1) {
            $filtros_gestor .= " " . $fil->campo . "='" . utf8_encode($fil->criterio) . "' ";
        }

        if ($contador < count($filtros)) {
            $filtros_gestor .= " or ";
        }


        $contador++;
    }
    if (count($filtros) > 1) {
        $filtros_gestor .= ")";
    }

    return ($filtros_gestor);
}

function VerificaFotoPersonalAdminV2($rut)
{
    //Debo traer los datos del usuario, para ver si la foto esta con guion
    if ($_SESSION["id_empresa"] == 28) {
        $datos_usuario = UsuarioEnBasePersonas($rut);
        $numero_sap = $datos_usuario[0]->codigo_sap;
        $rut = $numero_sap;
        $rut_completo = $numero_sap;
        $ruta = "../front/img/personas/28/" . $rut;
        $ruta_rut_completo = "../front/img/personas/28/" . $rut_completo;
    } else if ($_SESSION["id_empresa"] == 43) {
        $dv = getRutDV($rut);
        $rut_completo = $rut . "-" . $dv;
        $ruta = "../front/img/personas/" . $rut;
        $ruta_rut_completo = "../front/img/personas/" . $rut_completo;
    } else if ($_SESSION["id_empresa"] == 41) {
        $datos_usuario = UsuarioEnBasePersonas($rut);
        $rut_completo = $datos_usuario[0]->rut_completo;
        $ruta = "../front/../Carpeta_Fotos/" . $rut;
        $ruta_rut_completo = "../front/../Carpeta_Fotos/" . $rut_completo;
    } else {
        $datos_usuario = UsuarioEnBasePersonas($rut);
        $rut_completo = $datos_usuario[0]->rut_completo;
        $ruta = "../front/img/personas/" . $rut;
        $ruta_rut_completo = "../front/img/personas/" . $rut_completo;
    }
    if ($datos_usuario[0]->avatar) {
        if ($_SESSION["id_empresa"] == 59) {
            $imagen = $datos_usuario[0]->avatar;
        } else if (substr($datos_usuario[0]->avatar, 0, 4) == "http") {
            $imagen = $datos_usuario[0]->avatar;
            //echo "<br> imagen $imagen";
            if (checkRemoteFile($imagen) == 1) {
                $imagen = $imagen;
                //echo "<br> file exist $imagen";
            } else {
                $imagen = "../front/img/sinfoto.png";
            }
            //echo "<br> imagen $imagen";
        } else {
            $imagen = "../front/img/avatars/" . $_SESSION["id_empresa"] . "/" . $datos_usuario[0]->avatar;
        }
    }
    if ($datos_usuario[0]->avatar) {
        if ($_SESSION["id_empresa"] == 59) {
            $imagen = $datos_usuario[0]->avatar;
        } else if (substr($datos_usuario[0]->avatar, 0, 4) == "http") {
            $imagen = $datos_usuario[0]->avatar;
            //echo "<br> imagen $imagen";
            if (checkRemoteFile($imagen) == 1) {
                $imagen = $imagen;
                //echo "<br> file exist $imagen";
            } else {
                $imagen = "../front/img/sinfoto.png";
            }
        } else {
            $imagen = "../front/img/avatars/" . $_SESSION["id_empresa"] . "/" . $datos_usuario[0]->avatar;
        }
        //echo "<br> imagen $imagen";
    } else {
        if (file_exists($ruta . ".jpg")) {
            $imagen = $ruta . ".jpg";
        } else if (file_exists($ruta . ".JPG")) {
            $imagen = $ruta . ".JPG";
        } else if (file_exists($ruta . ".gif")) {
            $imagen = $ruta . ".gif";
        } else if (file_exists($ruta_rut_completo . ".jpg")) {
            $imagen = $ruta_rut_completo . ".jpg";
        } else if (file_exists($ruta_rut_completo . ".JPG")) {
            $imagen = $ruta_rut_completo . ".JPG";
        } else if (file_exists($ruta_rut_completo . ".gif")) {
            $imagen = $ruta_rut_completo . ".gif";
        } else {
            $imagen = "../front/img/sinfoto.png";
        }
    }
    // avatar biografia
    //echo "<br><br>imagen $imagen rut $rut<br><br>";
    if ($imagen == "../front/img/sinfoto.png" or $imagen == "img/personas/.jpg") {
        //echo "..avatar biografia rut $rut";
        $biografia = TraeDatosBiografiayUsuario($rut, $_SESSION["id_empresa"]);
        //print_r($biografia);


        if ($biografia[0]->miavatar <> '') {

            $imagen_def1 = "../front/multimedia/" . ($biografia[0]->miavatar);
            if (file_exists($imagen_def1)) {

                $imagen = $imagen_def1;
                //echo "<br>$rut El fichero $imagen_def1 existe. Avatar";
            }

            if ($imagen == '') {

                $imagen_def2 = "../front/multimedia/" . Encodear3($datos_usuario[0]->rut_completo) . ".jpg";
                if (file_exists($imagen_def2)) {
                    $imagen = $imagen_def2;

                    //echo "<br>$rut El fichero $imagen_def2 existe. Default";
                }
            }


        } else {
            //echo "hola";


            $imagen_def2 = "../front/multimedia/" . Encodear3($datos_usuario[0]->rut_completo) . ".jpg";
            //echo "imagen_def2 $imagen_def2";
            if (file_exists($imagen_def2)) {
                $imagen = $imagen_def2;

                //echo "<br>$rut No Hay Avatar El fichero $imagen_def2 existe. Default";
            }

        }
        //echo "<br><br>imagen $imagen<br><br>";
    }
    //ultimo revision
    //echo $datos_usuario[0]->avatar;44
    //echo $datos_usuario[0]->avatar;
    //echo "<br>imagen $imagen";exit();
    return ($imagen);
}

function ColocaListadoUsuariosSillasSoloSillas($PRINCIPAL, $arreglo_post, $id_empresa, $datos_desde_importacion_datos)
{

    //echo $datos_desde_importacion_datos;
    // print_r($arreglo_post);
    $listado_usuarios = TraeListadoUsuariosParaSillasSoloSillas($arreglo_post, $id_empresa);
    $i = 1;

    $count_total_loop = count($listado_usuarios);
    ini_set('output_buffering', 0);
    ini_set('zlib.output_compression', 0);
    if (!ob_get_level()) {
        ob_start();
    } else {
        ob_end_clean();
        ob_start();
    }


    foreach ($listado_usuarios as $list) {


        $cuenta_loop++;
        echo "<center><span style='position: absolute;z-index:$current;background:#36C6D3; padding:10px; color:#FFF'>Procesando $cuenta_loop de $count_total_loop Registros</span></center>";
        flush();
        ob_flush();

        $row_listado_usuarios .= file_get_contents("views/sillas/row_listado_gestion_sobrecupos.html");
        if ($_POST["silla_" . $list->numero]) {
            $row_listado_usuarios = str_replace("{CHECKED_CHECKBOX}", "checked", $row_listado_usuarios);
        } else {
            $row_listado_usuarios = str_replace("{CHECKED_CHECKBOX}", "", $row_listado_usuarios);
        }
        $row_listado_usuarios = str_replace("{NUMERO}", $i, $row_listado_usuarios);
        $row_listado_usuarios = str_replace("{CUI_DESDE_SILLA}", $list->cui, $row_listado_usuarios);
        $row_listado_usuarios = str_replace("{DESCRIPCION_CUI}", $list->descripcion_cui, $row_listado_usuarios);
        $row_listado_usuarios = str_replace("{COD_CARGO_DESDE_SILLA}", $list->cargo, $row_listado_usuarios);
        $row_listado_usuarios = str_replace("{SILLA_DESDE_SILLA}", $list->numero, $row_listado_usuarios);
        $row_listado_usuarios = str_replace("{COD_CARGO}", $list->id_cargo, $row_listado_usuarios);
        $row_listado_usuarios = str_replace("{COD_CARGO_OPTIONS}", "<option value='" . $list->id_cargo . "'>" . $list->cargo . " " . $list->id_cargo . "</option>", $row_listado_usuarios);
        $row_listado_usuarios = str_replace("{RUT}", $list->rut_completo, $row_listado_usuarios);
        if ($list->rut_completo) {
            $row_listado_usuarios = str_replace("{NOMBRE_COMPLETO}", $list->nombre_completo, $row_listado_usuarios);
            $row_listado_usuarios = str_replace("{BG_COLOR_TD}", '', $row_listado_usuarios);
        } else {
            $row_listado_usuarios = str_replace("{NOMBRE_COMPLETO}", "Silla Disponible Numero " . $list->numero, $row_listado_usuarios);
            $row_listado_usuarios = str_replace("{BG_COLOR_TD}", 'bgcolor="#dff0d8"', $row_listado_usuarios);
        }

        $row_listado_usuarios = str_replace("{CARGO}", $list->cargo, $row_listado_usuarios);
        $row_listado_usuarios = str_replace("{DESCRIPCION_CARGO}", $list->descripcion_cargo, $row_listado_usuarios);
        $row_listado_usuarios = str_replace("{SILLA}", $list->numero, $row_listado_usuarios);
        $row_listado_usuarios = str_replace("{CODIGO_COMPUESTO}", $list->cui . $list->cargo . $list->numero, $row_listado_usuarios);
        $i++;


    }


    $PRINCIPAL = str_replace("{ROW_LISTADO}", utf8_encode($row_listado_usuarios), $PRINCIPAL);


    $array_para_enviar_via_url = serialize($arreglo_division);
    $array_para_enviar_via_url = urlencode($array_para_enviar_via_url);


    $_SESSION["arreglo_dividir"] = $array_para_enviar_via_url;
    $_SESSION["total_registros_dividir"] = $i - 1;

    return ($PRINCIPAL);
}


function ColocaFiltrosSillas($PRINCIPAL, $arreglo_post)
{
    //traigo las Divisiones de los Planes
    $divisiones = TraigoDatoDesdePlanSilla("descripcion_division", "");
    foreach ($divisiones as $valor) {
        if ($valor->valor == "") continue;
        if ($arreglo_post["division"] == $valor->valor) {
            $options_division .= "<option value='" . $valor->valor . "' selected>" . $valor->valor . "</option>";
        } else {
            $options_division .= "<option value='" . $valor->valor . "'>" . $valor->valor . "</option>";
        }

    }
    $PRINCIPAL = str_replace("{OPTIONS_DIVISION_2}", utf8_encode($options_division), $PRINCIPAL);

    $areas = TraigoDatoDesdePlanSilla("descripcion_area", $arreglo_post);


    $options_areas .= "<option value='' >Seleccione</option>";
    foreach ($areas as $valor) {
        if ($valor->valor == "") continue;
        if ($arreglo_post["area"] == $valor->valor) {
            $options_areas .= "<option value='" . $valor->valor . "' selected>" . $valor->valor . " </option>";
        } else {
            $options_areas .= "<option value='" . $valor->valor . "'>" . $valor->valor . "  </option>";
        }

    }
    $PRINCIPAL = str_replace("{OPTIONS_AREA_2}", utf8_encode($options_areas), $PRINCIPAL);


    $departamento = TraigoDatoDesdePlanSilla("descripcion_departamento", $arreglo_post);

    $options_departamentos .= "<option value='' >Seleccione</option>";
    foreach ($departamento as $valor) {
        if ($valor->valor == "") continue;
        if ($arreglo_post["departamento"] == $valor->valor) {
            $options_departamentos .= "<option value='" . $valor->valor . "' selected>" . $valor->valor . "</option>";
        } else {
            $options_departamentos .= "<option value='" . $valor->valor . "'>" . $valor->valor . "</option>";
        }

    }
    $PRINCIPAL = str_replace("{OPTIONS_DEPARTAMENTO_2}", utf8_encode($options_departamentos), $PRINCIPAL);


    $zona = TraigoDatoDesdePlanSilla("descripcion_zona", $arreglo_post);
    $options_zonas .= "<option value='' >Seleccione</option>";
    foreach ($zona as $valor) {
        if ($valor->valor == "") continue;
        $options_zonas .= "<option value='" . $valor->valor . "'>" . $valor->valor . "</option>";
    }
    $PRINCIPAL = str_replace("{OPTIONS_ZONA_2}", utf8_encode($options_zonas), $PRINCIPAL);


    $seccion = TraigoDatoDesdePlanSilla("descripcion_seccion", $arreglo_post);
    $options_secciones .= "<option value=''>Seleccione</option>";
    foreach ($seccion as $valor) {
        if ($valor->valor == "") continue;
        $options_secciones .= "<option value='" . $valor->valor . "'>" . $valor->valor . "</option>";
    }
    $PRINCIPAL = str_replace("{OPTIONS_SECCION_2}", utf8_encode($options_secciones), $PRINCIPAL);


    $oficina = TraigoDatoDesdePlanSilla("descripcion_oficina", $arreglo_post);
    $options_oficinas .= "<option value=''>Seleccione</option>";
    foreach ($oficina as $valor) {
        if ($valor->valor == "") continue;
        $options_oficinas .= "<option value='" . $valor->valor . "'>" . $valor->valor . "</option>";
    }
    $PRINCIPAL = str_replace("{OPTIONS_OFICINA_2}", utf8_encode($options_oficinas), $PRINCIPAL);


    $cui = TraigoDatoDesdePlanSilla("descripcion_cui", $arreglo_post);
    $options_cui .= "<option value=''>Seleccione</option>";
    foreach ($cui as $valor) {
        if ($valor->valor == "") continue;
        $options_cui .= "<option value='" . $valor->valor . "'>" . $valor->valor . "</option>";
    }
    $PRINCIPAL = str_replace("{OPTIONS_UNIDAD_NEGOCIO_2}", utf8_encode($options_cui), $PRINCIPAL);


    return ($PRINCIPAL);
}

function concurso_lista_Vista_concurso_fn($html, $id_empresa, $id)
{
    $concursos = concurso_lista_Vista_concurso_fn_data($id_empresa, $id);
    $row = file_get_contents("views/concurso/entorno_concurso.html");

    foreach ($concursos as $unico) {

        echo "<br><img src='https://gcloud.cl/concurso/front/multimedia/" . $unico->imagen . "'>";
        $activa = 0;
        if ($unico->imagenlogo == "") {
            $activa = 1;
        }
        if ($activa == 1) {
            $bot = "<span class='badge badge-success'>Concurso Activo</span><br><a href='?sw=lista_encuestas_lb&ie=" . $unico->id . "&desactiva=1' class='btn btn-link btn-sm'>Desactivar</a>";
        }
        if ($activa == 0) {
            $bot = "<span class='badge badge-light'>Concurso Desactivo</span><br><a href='?sw=lista_encuestas_lb&ie=" . $unico->id . "&activa=1' class='btn btn-link btn-sm'>Activar</a>";
        }

        $row = file_get_contents("views/concurso/row_vista_respuestas_concurso.html");
        $row = str_replace("{ID}", utf8_encode($unico->id), $row);
        $row = str_replace("{NOMBRE}", utf8_encode($unico->nombre), $row);
        $row = str_replace("{GRUPO}", utf8_encode($unico->grupo), $row);
        $row = str_replace("{ID_GRUPO}", utf8_encode($unico->id_grupo), $row);
        $row = str_replace("{PONDERACION}", utf8_encode($unico->ponderacion), $row);
        $row = str_replace("{PUNTOS}", utf8_encode($unico->puntos), $row);
        $row = str_replace("{FECHA_INICIO}", utf8_encode($unico->fecha_inicio), $row);
        $row = str_replace("{FECHA_TERMINO}", utf8_encode($unico->fecha_termino), $row);
        $row = str_replace("{BOTON_ACTIVAR_DESACTIVAR}", $bot, $row);
        $row = str_replace("{IMAGEN}", utf8_encode($unico->imagen), $row);

        $usuarios = "<a href='?sw=concurso_update_users_encuestasb&id=" . $unico->id . "&perfil=Usuarios&perfil_txt=Merchandisers' 						style='btn btn-link'>Merchandisers Inscritos (" . $unico->usuarios . ")</a>";
        $visualizacion_resultados = "<br><a href='?sw=concurso_update_users_encuestasb&id=" . $unico->id . "&perfil=Visualizador&perfil_txt=Visualizador' 	style='btn btn-link'>Visualizacion Resultados (" . $unico->visualizadores . ")</a>";
        $invitaciones = "<br><a href='?sw=notificaciones_email&id_instancia=" . $unico->id . "&tipo_instancia=Concurso' 	style='btn btn-link'>Notificaciones Email</a>";

        $row = str_replace("{USUARIOS_INSCRITOS}", $usuarios, $row);
        $row = str_replace("{EDITORES}", $editores, $row);
        $row = str_replace("{REPORTES}", $visualizacion_resultados, $row);
        $row = str_replace("{INVITACIONES}", $invitaciones, $row);

        $row = str_replace("{FECHA2}", utf8_encode($unico->fecha2), $row);
        $row = str_replace("{FECHA3}", utf8_encode($unico->fecha3), $row);

        $row = str_replace("{IMAGE_BANNER}", utf8_encode($unico->imagensuperior), $row);
        $row = str_replace("{IMAGE_BACKGROUND}", utf8_encode($unico->imageninferior), $row);

        $row = str_replace("{NUM_PREGUNTA}", utf8_encode($unico->cuentapreguntas), $row);
        $row = str_replace("{NUM_USUARIOS}", utf8_encode($unico->cuentausuarios), $row);
        $row = str_replace("{NUM_RESPUESTAS}", utf8_encode($unico->respuestas), $row);
        $row = str_replace("{OPTIONS_LISTA_BANCO_PREGUNTAS_MEDICIONES}", utf8_encode($listabancopregunta), $row);
        $total_html .= $row;
    }
    $listabancopregunta = EncuestasLBListaBancoPreguntas_data($id_empresa);
    foreach ($listabancopregunta as $unicobanco) {
        $option_encuestas .= "<option value='" . utf8_encode($unicobanco->id) . "'>" . utf8_encode($unicobanco->nombre) . "</option>";
    }

    $html = str_replace("{LISTA}", $total_html, $html);
    $html = str_replace("{TITULO}", "Concursos", $html);
    $html = str_replace("{OPTIONS_LISTA_BANCO_PREGUNTAS_MEDICIONES_FULL_DETALLE}", $option_encuestas, $html);
    return ($html);
}

function concurso_lista_concurso_fn($html, $id_empresa, $id_grupo)
{
    $concursos = concurso_trae_concursos_por_grupo_data($id_empresa, $id_grupo);
    $row = file_get_contents("views/concurso/entorno_concurso.html");
    //print_r($concursos);
    foreach ($concursos as $unico) {
        $activa = 0;
        if ($unico->imagenlogo == "") {
            $activa = 1;
        }
        if ($activa == 1) {
            $bot = "<span class='badge badge-success'>Concurso Activo</span><br><a href='?sw=lista_encuestas_lb&ie=" . $unico->id . "&desactiva=1' class='btn btn-link btn-sm'>Desactivar</a>";
        }
        if ($activa == 0) {
            $bot = "<span class='badge badge-light'>Concurso Desactivo</span><br><a href='?sw=lista_encuestas_lb&ie=" . $unico->id . "&activa=1' class='btn btn-link btn-sm'>Activar</a>";
        }

        $row = file_get_contents("views/concurso/row_concurso.html");
        $row = str_replace("{ID}", utf8_encode($unico->id), $row);
        $row = str_replace("{NOMBRE}", utf8_encode($unico->nombre), $row);
        $row = str_replace("{GRUPO}", utf8_encode($unico->grupo), $row);
        $row = str_replace("{ID_GRUPO}", utf8_encode($unico->id_grupo), $row);
        $row = str_replace("{PONDERACION}", utf8_encode($unico->ponderacion), $row);
        $row = str_replace("{PUNTOS}", utf8_encode($unico->puntos), $row);
        $row = str_replace("{FECHA_INICIO}", utf8_encode($unico->fecha_inicio), $row);
        $row = str_replace("{FECHA_TERMINO}", utf8_encode($unico->fecha_termino), $row);
        $row = str_replace("{BOTON_ACTIVAR_DESACTIVAR}", $bot, $row);

        $usuarios = "<a href='?sw=concurso_update_users_encuestasb&id=" . $unico->id . "&perfil=Usuarios&perfil_txt=Merchandisers' 						style='btn btn-link'>Merchandisers Inscritos (" . $unico->usuarios . ")</a>";
        $visualizacion_resultados = "<br><a href='?sw=concurso_update_users_encuestasb&id=" . $unico->id . "&perfil=Visualizador&perfil_txt=Visualizador' 	style='btn btn-link'>Visualizacion Resultados (" . $unico->visualizadores . ")</a>";
        $invitaciones = "<br><a href='?sw=notificaciones_email&id_instancia=" . $unico->id . "&tipo_instancia=Concurso' 	style='btn btn-link'>Notificaciones Email</a>";

        $row = str_replace("{USUARIOS_INSCRITOS}", $usuarios, $row);
        $row = str_replace("{EDITORES}", $editores, $row);
        $row = str_replace("{REPORTES}", $visualizacion_resultados, $row);
        $row = str_replace("{INVITACIONES}", $invitaciones, $row);

        $row = str_replace("{FECHA2}", utf8_encode($unico->fecha2), $row);
        $row = str_replace("{FECHA3}", utf8_encode($unico->fecha3), $row);

        $row = str_replace("{IMAGE_BANNER}", utf8_encode($unico->imagensuperior), $row);
        $row = str_replace("{IMAGE_BACKGROUND}", utf8_encode($unico->imageninferior), $row);

        $row = str_replace("{NUM_PREGUNTA}", utf8_encode($unico->cuentapreguntas), $row);
        $row = str_replace("{NUM_USUARIOS}", utf8_encode($unico->cuentausuarios), $row);
        $row = str_replace("{NUM_RESPUESTAS}", utf8_encode($unico->respuestas), $row);
        $row = str_replace("{OPTIONS_LISTA_BANCO_PREGUNTAS_MEDICIONES}", utf8_encode($listabancopregunta), $row);
        $total_html .= $row;
    }
    $listabancopregunta = EncuestasLBListaBancoPreguntas_data($id_empresa);
    foreach ($listabancopregunta as $unicobanco) {
        $option_encuestas .= "<option value='" . utf8_encode($unicobanco->id) . "'>" . utf8_encode($unicobanco->nombre) . "</option>";
    }

    $html = str_replace("{LISTA}", $total_html, $html);
    $html = str_replace("{TITULO}", "Concursos", $html);
    $html = str_replace("{OPTIONS_LISTA_BANCO_PREGUNTAS_MEDICIONES_FULL_DETALLE}", $option_encuestas, $html);
    return ($html);
}

function VerificaExtensionFilesAdmin($file)
{
    //echo "<br>file $file";
    $arreglo_archivo = explode(".", $file);
    $extension_archivo = $arreglo_archivo[1];
    //echo "<br>cuenta ".count($arreglo_archivo);		print_r($arreglo_archivo);		echo "<br>ex $extension_archivo";

    if (count($arreglo_archivo) <> 2) {
        //echo "<br>archivo invalido con mas de una extension";	 echo "    <script>alert('Formato de Archivo Incompatible'); 			location.href='?sw=home_landing';    </script>";exit();
    }

    if ($extension_archivo == "pdf" or $extension_archivo == "PDF" or $extension_archivo == "ppt" or $extension_archivo == "PPT"
        or $extension_archivo == "pptx" or $extension_archivo == "PPTX" or $extension_archivo == "doc" or $extension_archivo == "DOC"
        or $extension_archivo == "docx" or $extension_archivo == "DOCX" or $extension_archivo == "xls" or $extension_archivo == "XLS"
        or $extension_archivo == "xlsx" or $extension_archivo == "XLSX" or $extension_archivo == "jpg" or $extension_archivo == "JPG"
        or $extension_archivo == "jpeg" or $extension_archivo == "JPEG" or $extension_archivo == "zip" or $extension_archivo == "ZIP"
        or $extension_archivo == "png" or $extension_archivo == "PNG" or $extension_archivo == "CSV" or $extension_archivo == "csv") {
        //echo "<br>archivo valido";
    } else {
        echo "<br>archivo invalido";
        echo "    <script>alert('Formato de Archivo Incompatible'); 			location.href='?sw=home_landing_admin';    </script>";
        exit();

    }


}


function notificaciones_email_lista_notificaciones($html, $id_empresa, $idcategoria, $id_instancia, $tipo_instancia)
{
    $notificaciones = notificaciones_email_lista_notificaciones_data($id_empresa, $id_instancia, $tipo_instancia);
    foreach ($notificaciones as $unico) {
        $row = file_get_contents("views/notificaciones_email/row_notificaciones.html");
        $row = str_replace("{ID_ENCODE}", Encodear3($unico->id), $row);
        //echo "<br>$id_instancia, $tipo_instancia<br>";

        $row = str_replace("{NOMBRE}", utf8_encode($unico->nombre), $row);
        $row = str_replace("{SUBJECT}", utf8_encode($unico->subject), $row);
        $row = str_replace("{TITULO}", utf8_encode($unico->titulo), $row);
        $row = str_replace("{TEXTO}", utf8_encode($unico->texto), $row);

        $Notificacion = notificaciones_email_notificaciones_usuarios_envios($unico->id, $id_empresa);
        $num_usuarios = $Notificacion[0]->usuarios;
        $num_envios = $Notificacion[0]->emails_enviados;
        //print_r($Notificacion);

        $agrega_usuario = "<a href='?sw=notificaciones_email_update_users&id=" . Encodear3($unico->id) . "' class='btn btn-link' >Usuarios Inscritos (" . $num_usuarios . ")</a>";
        $envia_usuario_nuevos = "<a href='?sw=notificaciones_email_send_emails&id=" . Encodear3($unico->id) . "&tipo=envio_nuevos' class='btn btn-link' >Enviar No Enviados</a>";
        $envia_usuario_todos = "<a href='?sw=notificaciones_email_send_emails&id=" . Encodear3($unico->id) . "&tipo=envio_todos' class='btn btn-link' >Enviar Todos</a>";
        $row = str_replace("{AGREGAR_USUARIOS}", $agrega_usuario, $row);
        $row = str_replace("{ENVIADOS}", $num_envios, $row);
        $row = str_replace("{ENVIAR_A_NUEVOS}", $envia_usuario_nuevos, $row);
        $row = str_replace("{ENVIAR_A_TODOS}", $envia_usuario_todos, $row);
        $total_html .= $row;
    }
    $html = str_replace("{LISTA_NOTIFICACIONES}", $total_html, $html);

    if ($id_instancia <> "") {
        $html = str_replace("{TITULO}", "Notificaciones Email", $html);
        $html = str_replace("{VOLVER_BACK}", "<a href='?sw=concurso_lista_concurso' class='btn btn-link'>Volver</a>", $html);
    } else {
        $html = str_replace("{TITULO}", "Notificaciones Email", $html);
        $html = str_replace("{VOLVER_BACK}", "", $html);

    }

    return ($html);
}

function notificaciones_log_email_automaticas_lista_notificaciones($html, $id_empresa, $idcategoria, $id_instancia, $tipo_instancia)
{
    $notificaciones = notificaciones_log_email_automaticas_lista_notificaciones_data($id_empresa, $id_instancia, $tipo_instancia);
    foreach ($notificaciones as $unico) {
        $row = file_get_contents("views/notificaciones_email/row_notificaciones_log_emails.html");
        $row = str_replace("{ID_ENCODE}", Encodear3($unico->id), $row);
        //echo "<br>$id_instancia, $tipo_instancia<br>";


        $row = str_replace("{Tipo}", utf8_encode($unico->tipo), $row);
        $row = str_replace("{IdCurso}", utf8_encode($unico->id_curso), $row);
        $row = str_replace("{Curso}", utf8_encode($unico->nombre_curso), $row);
        $row = str_replace("{Imparticion}", utf8_encode($unico->id_inscripcion), $row);
        $row = str_replace("{Colaborador}", utf8_encode($unico->nombre_completo), $row);
        $row = str_replace("{Fecha}", utf8_encode($unico->fecha), $row);


        $Notificacion = notificaciones_email_notificaciones_usuarios_envios($unico->id, $id_empresa);
        $num_usuarios = $Notificacion[0]->usuarios;
        $num_envios = $Notificacion[0]->emails_enviados;
        //print_r($Notificacion);

        $agrega_usuario = "<a href='?sw=notificaciones_email_update_users&id=" . Encodear3($unico->id) . "' class='btn btn-link' >Usuarios Inscritos (" . $num_usuarios . ")</a>";
        $envia_usuario_nuevos = "<a href='?sw=notificaciones_email_send_emails&id=" . Encodear3($unico->id) . "&tipo=envio_nuevos' class='btn btn-link' >Enviar No Enviados</a>";
        $envia_usuario_todos = "<a href='?sw=notificaciones_email_send_emails&id=" . Encodear3($unico->id) . "&tipo=envio_todos' class='btn btn-link' >Enviar Todos</a>";
        $row = str_replace("{AGREGAR_USUARIOS}", $agrega_usuario, $row);
        $row = str_replace("{ENVIADOS}", $num_envios, $row);
        $row = str_replace("{ENVIAR_A_NUEVOS}", $envia_usuario_nuevos, $row);
        $row = str_replace("{ENVIAR_A_TODOS}", $envia_usuario_todos, $row);
        $total_html .= $row;
    }
    $html = str_replace("{LISTA_NOTIFICACIONES}", $total_html, $html);


    $html = str_replace("{TITULO}", "Log Emails Automaticos", $html);

    $html = str_replace("{VOLVER_BACK}", "", $html);


    return ($html);
}


function FechaEspanol($fecha)
{

    //echo "<br>FechaEspanol<br>";
    //echo "<br>$fecha";

    $fecha_espanol = strftime("%d-%m-%Y", strtotime($fecha));;
//echo "<br>fecha_espanol $fecha_espanol";
//exit();
    return $fecha_espanol;
}


function ReportesAutomaticosFN($id_empresa)
{

    //echo "<br>Funcion<br>ReportesAutomaticosFN<br>$id_empresa";
    $array_ultimas_fechas = ReportesAutomaticosBuscaUltimasFechas($id_empresa);
    //print_r($array_ultimas_fechas);
    foreach ($array_ultimas_fechas as $un1) {
        $row_reportes_automaticos .= "<div class='col-lg-4' style='border: 1px solid #ddd;border-radius: 3px;''><strong>" . $un1->fecha . "</strong><br>
			";
        $array_linea = ReportesAutomaticosBuscaLineas($un1->fecha, $id_empresa);
        foreach ($array_linea as $un2) {
            $row_reportes_automaticos .= "<div style='text-align: left;'><a href='https://masconectadosbch.cl/admin/reportes/Reporte_" . $un2->filtro . "_" . utf8_encode($un2->id_reporte) . "_" . $un2->fecha . ".csv' class='btn btn-link'><span class='negro'><i class='fas fa-angle-right'></i> Reporte  <strong>" . utf8_encode($un2->nombre) . "</strong></a></div>";
        }
        $row_reportes_automaticos .= "</div>";
    }
    //echo "<br>row_reportes_automaticos ".$row_reportes_automaticos;
    //exit();
    return $row_reportes_automaticos;
}

function strip_tags_content($text)
{
    $text = preg_replace("/\r|\n/", "", $text);
    return preg_replace('@<(\w+)\b.*?>.*?</\1>@si', '', $text);

}


function lista_respuestas_encuestas_grafico($html, $id_empresa, $id_encuesta)
{
    $Preguntas = Trae_Preguntas_Grafico($id_encuesta, $id_empresa);
    //print_r($Preguntas);
    foreach ($Preguntas as $unico) {

        $cuenta_respuestas_no_vacias = Encuestas_BuscaRespuestasPorCadaPregunta_NoVacias($unico->id_pregunta, $id_encuesta, $id_empresa);
        //echo "<br>Cuenta Respuestas ".($cuenta_respuestas_no_vacias);
        $row_G = "";
        if ($cuenta_respuestas_no_vacias > 0) {
            $row .= file_get_contents("views/graficos/row_pregunta.html");
            //echo "encuestas ".$unico->id_encuesta." id_pregunta ".$unico->id_pregunta;
            $row = str_replace("{PREGUNTA}", utf8_encode($unico->pregunta), $row);


            $array_respuestas = Encuestas_BuscaRespuestasPorCadaPregunta($unico->id_pregunta, $id_encuesta, $id_empresa);

            //echo "<pre>";
            //print_r($array_respuestas);
            //echo "</pre>";


            $array_DATA_X_Y = "";
            if ($array_respuestas[0]->tipo == "NIV1_5") {

                foreach ($array_respuestas as $unico_2) {
                    $arreglo[$unico_2->respuesta] = $unico_2->cuenta_respuesta;
                }

                for ($i = 1; $i <= 5; $i++) {

                    $cuenta_respuestas = $arreglo[$i];
                    if ($cuenta_respuestas == "") {
                        $cuenta_respuestas = 0;
                    }

                    $array_DATA_X_Y .= "	{ name: '" . $i . "',y:" . $cuenta_respuestas . ",  sliced: true, selected: true},";

                }


            }


            $row_G .= file_get_contents("views/graficos/row_grafico.html");
            $row_G = str_replace("{ID_GRAFICO}", ($id_encuesta . $unico->id_pregunta), $row_G);
            $row_G = str_replace("{ROW_GRAFICOS_DATA_X_Y}", ($array_DATA_X_Y), $row_G);


            $row = str_replace("{GRAFICO}", $row_G, $row);


            //echo "... muestra graficos...";
        } else {

            $row .= file_get_contents("views/graficos/row_pregunta_sin_respuesta.html");
            //echo "encuestas ".$unico->id_encuesta." id_pregunta ".$unico->id_pregunta;
            $row = str_replace("{PREGUNTA}", utf8_encode($unico->pregunta), $row);

            $row = str_replace("{GRAFICO}", "", $row);

        }


    }


    $html = str_replace("{PREGUNTA}", $row, $html);


    $html = str_replace("{TITULO}", "Preguntas y Respuestas", $html);
    $html = str_replace("{BTN}", "Nueva Pregunta", $html);
    $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
    $html = str_replace("{BTN_VOLVER}", '', $html);
    $html = str_replace("{COLUMNA}", 'Pregunta', $html);
    $html = str_replace("{OPTIONS_LISTA_BANCO_PREGUNTAS_MEDICIONES_FULL_DETALLE}", $option_encuestas, $html);
    return ($html);
}

function lista_encuestas_fn_lb($html, $id_empresa, $idcategoria)
{
    $Encuestas = TraeEncuestasLBEmpresa($id_empresa);
    $row = file_get_contents("views/encuesta_lb/entorno_mediciones_row.html");
    $listabancopregunta = EncuestasLBListaBancoPreguntas_data($id_empresa);
    //print_r($listabancopregunta);

    foreach ($Encuestas as $unico) {
        $activa = 0;
        if ($unico->imagenlogo == "") {
            $activa = 1;
        }
        if ($activa == 1) {
            $bot = "<span class='badge badge-success'>Encuesta Activa</span><br><a href='?sw=lista_encuestas_lb&ie=" . $unico->id . "&desactiva=1' class='btn btn-link btn-sm'>Desactivar</a>";
        }
        if ($activa == 0) {
            $bot = "<span class='badge badge-light'>Encuesta Desactiva</span><br><a href='?sw=lista_encuestas_lb&ie=" . $unico->id . "&activa=1' class='btn btn-link btn-sm'>Activar</a>";
        }
        $row = file_get_contents("views/encuesta_lb/row_mediciones.html");
        $row = str_replace("{ID_MEDICION}", utf8_encode($unico->id), $row);
        $row = str_replace("{NOMBRE_MEDICION}", utf8_encode($unico->nombre), $row);
        $row = str_replace("{BANCO_PREGUNTA}", utf8_encode($unico->bancopreguntas), $row);
        $row = str_replace("{ID_BANCO_PREGUNTA}", utf8_encode($unico->id_encuesta), $row);
        $row = str_replace("{TIPO_MEDICION}", utf8_encode($unico->tipo_medicion), $row);
        $row = str_replace("{FECHA1}", utf8_encode($unico->fecha1), $row);
        $row = str_replace("{BOTON_ACTIVAR_DESACTIVAR}", $bot, $row);

        $usuarios = "<a href='?sw=update_users_encuestas_lb&id_encuesta=" . $unico->id . "&perfil=Usuario' 						style='btn btn-link'>Usuarios Inscritos (" . $unico->usuarios . ")</a>";
        $editores = "<br><a href='?sw=update_users_encuestas_lb&id_encuesta=" . $unico->id . "&perfil=Editor' 				style='btn btn-link'>Editores (" . $unico->editores . ")</a>";
        $visualizacion_resultados = "<br><a href='?sw=update_users_encuestas_lb&id_encuesta=" . $unico->id . "&perfil=Visualizador' 	style='btn btn-link'>Visualizacion Resultados (" . $unico->visualizadores . ")</a>";
        $editores = "";
        $visualizacion_resultados = "";

        $row = str_replace("{USUARIOS_INSCRITOS}", $usuarios, $row);
        $row = str_replace("{EDITORES}", $editores, $row);
        $row = str_replace("{REPORTES}", $visualizacion_resultados, $row);

        $row = str_replace("{FECHA2}", utf8_encode($unico->fecha2), $row);
        $row = str_replace("{FECHA3}", utf8_encode($unico->fecha3), $row);

        $row = str_replace("{IMAGE_BANNER}", utf8_encode($unico->imagensuperior), $row);
        $row = str_replace("{IMAGE_BACKGROUND}", utf8_encode($unico->imageninferior), $row);

        $row = str_replace("{NUM_PREGUNTA}", utf8_encode($unico->cuentapreguntas), $row);
        $row = str_replace("{NUM_USUARIOS}", utf8_encode($unico->cuentausuarios), $row);
        $row = str_replace("{NUM_RESPUESTAS}", utf8_encode($unico->respuestas), $row);
        $row = str_replace("{OPTIONS_LISTA_BANCO_PREGUNTAS_MEDICIONES}", utf8_encode($listabancopregunta), $row);


        $total_html .= $row;
    }
    $listabancopregunta = EncuestasLBListaBancoPreguntas_data($id_empresa);
    foreach ($listabancopregunta as $unicobanco) {
        $option_encuestas .= "<option value='" . utf8_encode($unicobanco->id) . "'>" . utf8_encode($unicobanco->nombre) . "</option>";
    }

    $html = str_replace("{LISTA}", $total_html, $html);
    $html = str_replace("{TITULO}", "Preguntas y Respuestas", $html);
    $html = str_replace("{BTN}", "Nueva Pregunta", $html);
    $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
    $html = str_replace("{BTN_VOLVER}", '', $html);
    $html = str_replace("{COLUMNA}", 'Pregunta', $html);
    $html = str_replace("{OPTIONS_LISTA_BANCO_PREGUNTAS_MEDICIONES_FULL_DETALLE}", $option_encuestas, $html);
    return ($html);
}


function lista_encuestas_visualizacion_cluster_fn_lb($html, $id_empresa, $idcategoria)
{
    $EncuestasCluster = TraeClusterEncuestasLBEmpresa($id_empresa);
    $row = file_get_contents("views/encuesta_lb/entorno_mediciones_cluster_row.html");

    foreach ($EncuestasCluster as $unico) {
        $activa = 0;
        if ($unico->imagenlogo == "") {
            $activa = 1;
        }
        if ($activa == 1) {
            $bot = "<span class='badge badge-success'>Encuesta Activa</span><br><a href='?sw=lista_encuestas_lb&ie=" . $unico->id . "&desactiva=1' class='btn btn-link btn-sm'>Desactivar</a>";
        }
        if ($activa == 0) {
            $bot = "<span class='badge badge-light'>Encuesta Desactiva</span><br><a href='?sw=lista_encuestas_lb&ie=" . $unico->id . "&activa=1' class='btn btn-link btn-sm'>Activar</a>";
        }
        $row = file_get_contents("views/encuesta_lb/row_cluster.html");
        $row = str_replace("{ID_MEDICION}", utf8_encode($unico->id), $row);
        $row = str_replace("{NOMBRE_MEDICION}", utf8_encode($unico->nombre), $row);
        $row = str_replace("{NUM_ENCUESTAS}", utf8_encode($unico->cuenta_encuestas), $row);
        $row = str_replace("{TIPO_MEDICION}", utf8_encode($unico->tipo_medicion), $row);
        $row = str_replace("{FECHA1}", utf8_encode($unico->fecha1), $row);
        $row = str_replace("{BOTON_ACTIVAR_DESACTIVAR}", $bot, $row);

        $usuarios = "<a href='?sw=update_users_encuestas_cluster_lb&id_cluster=" . $unico->id . "&perfil=Usuario' 						style='btn btn-link'>Usuarios Visualizadores (" . $unico->cuenta_visualizadores . ")</a>";

        $row = str_replace("{USUARIOS_INSCRITOS}", $usuarios, $row);
        $row = str_replace("{EDITORES}", $editores, $row);
        $row = str_replace("{REPORTES}", $visualizacion_resultados, $row);

        $row = str_replace("{FECHA2}", utf8_encode($unico->fecha2), $row);
        $row = str_replace("{FECHA3}", utf8_encode($unico->fecha3), $row);

        $row = str_replace("{IMAGE_BANNER}", utf8_encode($unico->imagensuperior), $row);
        $row = str_replace("{IMAGE_BACKGROUND}", utf8_encode($unico->imageninferior), $row);

        $row = str_replace("{NUM_PREGUNTA}", utf8_encode($unico->cuentapreguntas), $row);
        $row = str_replace("{NUM_USUARIOS}", utf8_encode($unico->cuentausuarios), $row);
        $row = str_replace("{NUM_RESPUESTAS}", utf8_encode($unico->respuestas), $row);
        $row = str_replace("{OPTIONS_LISTA_BANCO_PREGUNTAS_MEDICIONES}", utf8_encode($listabancopregunta), $row);
        $total_html .= $row;
    }


    $html = str_replace("{LISTA}", $total_html, $html);
    $html = str_replace("{TITULO}", "Preguntas y Respuestas", $html);
    $html = str_replace("{BTN}", "Nueva Pregunta", $html);
    $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
    $html = str_replace("{BTN_VOLVER}", '', $html);
    $html = str_replace("{COLUMNA}", 'Pregunta', $html);
    $html = str_replace("{OPTIONS_LISTA_BANCO_PREGUNTAS_MEDICIONES_FULL_DETALLE}", $option_encuestas, $html);
    return ($html);
}

function lista_encuestas_visualizacion_cluster_prosci_fn_lb($html, $id_empresa, $idcategoria)
{
    $EncuestasCluster = TraeClusterEncuestasLBProsciEmpresa($id_empresa);
    $row = file_get_contents("views/encuesta_lb/entorno_mediciones_cluster_row.html");

    foreach ($EncuestasCluster as $unico) {
        $activa = 0;
        if ($unico->imagenlogo == "") {
            $activa = 1;
        }
        if ($activa == 1) {
            $bot = "<span class='badge badge-success'>Encuesta Activa</span><br><a href='?sw=lista_encuestas_lb&ie=" . $unico->id . "&desactiva=1' class='btn btn-link btn-sm'>Desactivar</a>";
        }
        if ($activa == 0) {
            $bot = "<span class='badge badge-light'>Encuesta Desactiva</span><br><a href='?sw=lista_encuestas_lb&ie=" . $unico->id . "&activa=1' class='btn btn-link btn-sm'>Activar</a>";
        }
        $row = file_get_contents("views/encuesta_lb/row_cluster.html");
        $row = str_replace("{ID_MEDICION}", utf8_encode($unico->id), $row);
        $row = str_replace("{NOMBRE_MEDICION}", utf8_encode($unico->nombre), $row);
        $row = str_replace("{NUM_ENCUESTAS}", utf8_encode($unico->cuenta_encuestas), $row);
        $row = str_replace("{TIPO_MEDICION}", utf8_encode($unico->tipo_medicion), $row);
        $row = str_replace("{FECHA1}", utf8_encode($unico->fecha1), $row);
        $row = str_replace("{BOTON_ACTIVAR_DESACTIVAR}", $bot, $row);

        $usuarios = "<a href='?sw=update_users_encuestas_cluster_lb&id_cluster=" . $unico->id . "&perfil=Usuario' 						style='btn btn-link'>Usuarios Visualizadores (" . $unico->cuenta_visualizadores . ")</a>";

        $row = str_replace("{USUARIOS_INSCRITOS}", $usuarios, $row);
        $row = str_replace("{EDITORES}", $editores, $row);
        $row = str_replace("{REPORTES}", $visualizacion_resultados, $row);

        $row = str_replace("{FECHA2}", utf8_encode($unico->fecha2), $row);
        $row = str_replace("{FECHA3}", utf8_encode($unico->fecha3), $row);

        $row = str_replace("{IMAGE_BANNER}", utf8_encode($unico->imagensuperior), $row);
        $row = str_replace("{IMAGE_BACKGROUND}", utf8_encode($unico->imageninferior), $row);

        $row = str_replace("{NUM_PREGUNTA}", utf8_encode($unico->cuentapreguntas), $row);
        $row = str_replace("{NUM_USUARIOS}", utf8_encode($unico->cuentausuarios), $row);
        $row = str_replace("{NUM_RESPUESTAS}", utf8_encode($unico->respuestas), $row);
        $row = str_replace("{OPTIONS_LISTA_BANCO_PREGUNTAS_MEDICIONES}", utf8_encode($listabancopregunta), $row);
        $total_html .= $row;
    }


    $html = str_replace("{LISTA}", $total_html, $html);
    $html = str_replace("{TITULO}", "Preguntas y Respuestas", $html);
    $html = str_replace("{BTN}", "Nueva Pregunta", $html);
    $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
    $html = str_replace("{BTN_VOLVER}", '', $html);
    $html = str_replace("{COLUMNA}", 'Pregunta', $html);
    $html = str_replace("{OPTIONS_LISTA_BANCO_PREGUNTAS_MEDICIONES_FULL_DETALLE}", $option_encuestas, $html);
    return ($html);
}


function lista_admin_encuestas_fn_lb($html, $id_empresa, $idcategoria)
{
    $admins = TraeAdminEncuestasLBEmpresa($id_empresa);
    $row = file_get_contents("views/encuesta_lb/entorno_mediciones_admin_row.html");
    //$listabancopregunta=EncuestasLBListaBancoPreguntas_data($id_empresa);
    //print_r($admins);

    foreach ($admins as $admin) {
        $row = file_get_contents("views/encuesta_lb/lista_practicas_edit_admin_mediciones.html");
        $row = str_replace("{USUARIO}", utf8_encode($admin->user), $row);
        $row = str_replace("{CLAVE}", utf8_encode($admin->pass), $row);
        $row = str_replace("{NOMBRE_USUARIO}", utf8_encode($admin->nombre), $row);
        $row = str_replace("{ID_PERFIL}", utf8_encode($admin->acceso), $row);
        $row = str_replace("{ID_ADMIN}", utf8_encode($admin->id), $row);

        if ($admin->acceso == "210") {
            $texto_perfil = "SUPERADMIN";
        }
        if ($admin->acceso == "211") {
            $texto_perfil = "VISTA DE TODAS LAS ENCUESTAS";
        }
        if ($admin->acceso == "212") {
            $texto_perfil = "VISTA DE SUS ENCUESTAS";
        }
        $row = str_replace("{PERFIL_TEXTO}", utf8_encode($texto_perfil), $row);

        $total_html .= $row;
    }


    $html = str_replace("{LISTA}", $total_html, $html);
    $html = str_replace("{TITULO}", "Administradores", $html);
    $html = str_replace("{BTN}", "Nueva Pregunta", $html);
    $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
    $html = str_replace("{BTN_VOLVER}", '', $html);
    $html = str_replace("{COLUMNA}", 'Pregunta', $html);
    $html = str_replace("{OPTIONS_LISTA_BANCO_PREGUNTAS_MEDICIONES_FULL_DETALLE}", $option_encuestas, $html);
    return ($html);
}

function Com_ProcesoDashBoard($id_empresa)
{
    global $c_host, $c_user, $c_pass, $c_db;
    $database = new database($c_host, $c_user, $c_pass);
    $database->setDb($c_db);

    $ray_fec = Com_Busca_Calendario($id_empresa);
    $id_dimension = "COM_MP";
    //print_r($ray_fec);

    foreach ($ray_fec as $unico) {
//Usuarios Unicos TOTALES
        $tipo = "UU";
        $nombre = "Usuarios Unicos";

        $sql = " SELECT  count(DISTINCT rut) as cuenta       FROM
                    tbl_log_sistema WHERE       id_empresa = '" . $id_empresa . "'  AND ambiente = 'com_mp_personal'
                    AND fecha >= '" . $unico->fechaI . "'   AND fecha <= '" . $unico->fechaT . "' ";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();

        Com_Insert_Dash_estadistica($id_empresa, $id_dimension, $tipo, $cod[0]->cuenta, $unico->fechaI, $nombre, "");

        /*
                        $array_olas=Com_Busca_olas($id_empresa);
                        foreach ($array_olas as $ola){
                            if($ola->sesion<>''){
                                $qola= " and variables_get LIKE '%".$ola->sesion."%'  ";
                                $sql= " SELECT  count(DISTINCT rut) as cuenta       FROM
                                tbl_log_sistema WHERE       id_empresa = '".$id_empresa."'
                                AND fecha >= '".$unico->fechaI."'   AND fecha <= '".$unico->fechaT."' $qola";

                                //echo "<br>$sql";
                                $database->setquery($sql);    $database->query();    $cod = $database->listObjects();

                    Com_Insert_Dash_estadistica($id_empresa, $id_dimension, $tipo, $cod[0]->cuenta, $unico->fechaI, $nombre,$ola->sesion);

                                }
                            }         */

//Usuarios Líderes TOTALES
        $tipo = "LU";
        $nombre = "Lideres Unicos";

        $sql = " SELECT  count(DISTINCT h.rut) as cuenta       FROM
                    tbl_log_sistema h WHERE       h.id_empresa = '" . $id_empresa . "'  AND h.ambiente = 'com_mp_personal'
                    AND h.fecha >= '" . $unico->fechaI . "'   AND h.fecha <= '" . $unico->fechaT . "'
                    and (select count(id) from tbl_usuario where jefe=h.rut)>0

                    ";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();

        Com_Insert_Dash_estadistica($id_empresa, $id_dimension, $tipo, $cod[0]->cuenta, $unico->fechaI, $nombre, "");
        /*
                        $array_olas=Com_Busca_olas($id_empresa);
                        foreach ($array_olas as $ola){
                            if($ola->sesion<>''){
                                $qola= " and h.variables_get LIKE '%".$ola->sesion."%'  ";
                                $sql= " SELECT  count(DISTINCT h.rut) as cuenta       FROM
                                tbl_log_sistema h WHERE       .id_empresa = '".$id_empresa."'
                                AND h.fecha >= '".$unico->fechaI."'   AND h.fecha <= '".$unico->fechaT."'

                                and (select count(id) from tbl_usuario where jefe=h.rut)>0
                                $qola";
                                $database->setquery($sql);    $database->query();    $cod = $database->listObjects();

                    Com_Insert_Dash_estadistica($id_empresa, $id_dimension, $tipo, $cod[0]->cuenta, $unico->fechaI, $nombre,$ola->sesion);

                                }
                            }     */

//Usuarios Unicos Fecha
        $tipo = "UV";
        $nombre = "Usuarios_Dia";

        $sql = " SELECT  count(DISTINCT rut, fecha) as cuenta       FROM
                    tbl_log_sistema WHERE       id_empresa = '" . $id_empresa . "'  AND ambiente = 'com_mp_personal'
                    AND fecha >= '" . $unico->fechaI . "'   AND fecha <= '" . $unico->fechaT . "' ";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();

        Com_Insert_Dash_estadistica($id_empresa, $id_dimension, $tipo, $cod[0]->cuenta, $unico->fechaI, $nombre, "");

        /*     $array_olas=Com_Busca_olas($id_empresa);
                        foreach ($array_olas as $ola){
                            if($ola->sesion<>''){
                                $qola= " and variables_get LIKE '%".$ola->sesion."%'  ";
                                $sql= " SELECT  count(DISTINCT rut, fecha) as cuenta       FROM
                                tbl_log_sistema WHERE       id_empresa = '".$id_empresa."'
                                AND fecha >= '".$unico->fechaI."'   AND fecha <= '".$unico->fechaT."' $qola";
                                $database->setquery($sql);    $database->query();    $cod = $database->listObjects();

                    Com_Insert_Dash_estadistica($id_empresa, $id_dimension, $tipo, $cod[0]->cuenta, $unico->fechaI, $nombre,$ola->sesion);

                                }
                            }             */


//Usuarios Acumulados
        $tipo = "UA";
        $nombre = "Usuarios_Acumulados";

        $sql = " SELECT  count(DISTINCT rut) as cuenta       FROM
                    tbl_log_sistema WHERE       id_empresa = '" . $id_empresa . "'  AND ambiente = 'com_mp_personal'
                      AND fecha <= '" . $unico->fechaT . "' ";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();

        Com_Insert_Dash_estadistica($id_empresa, $id_dimension, $tipo, $cod[0]->cuenta, $unico->fechaI, $nombre, "");

        /* $array_olas=Com_Busca_olas($id_empresa);
                        foreach ($array_olas as $ola){
                            if($ola->sesion<>''){
                                $qola= " and variables_get LIKE '%".$ola->sesion."%'  ";
                                $sql= " SELECT  count(DISTINCT rut) as cuenta       FROM
                                tbl_log_sistema WHERE       id_empresa = '".$id_empresa."'
                                  AND fecha <= '".$unico->fechaT."' $qola";
                                $database->setquery($sql);    $database->query();    $cod = $database->listObjects();

                    Com_Insert_Dash_estadistica($id_empresa, $id_dimension, $tipo, $cod[0]->cuenta, $unico->fechaI, $nombre,$ola->sesion);

                                }
                            }         */

//Usuarios Nuevos
        $tipo = "UN";
        $nombre = "Usuarios Nuevos";

        $sql = " SELECT  count(DISTINCT rut) as cuenta       FROM
                    tbl_log_sistema WHERE       id_empresa = '" . $id_empresa . "'  AND ambiente = 'com_mp_personal'
                      AND fecha <= '" . $unico->fechaT . "' ";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();


        $sql = " SELECT  count(DISTINCT rut) as cuenta       FROM
                    tbl_log_sistema WHERE       id_empresa = '" . $id_empresa . "'  AND ambiente = 'com_mp_personal'
                      AND fecha <= '" . $unico->fechaT_m1 . "' ";
        $database->setquery($sql);
        $database->query();
        $cod2 = $database->listObjects();

        $un = $cod[0]->cuenta - $cod2[0]->cuenta;
        Com_Insert_Dash_estadistica($id_empresa, $id_dimension, $tipo, $un, $unico->fechaI, $nombre, "");

        /* $array_olas=Com_Busca_olas($id_empresa);
                        foreach ($array_olas as $ola){
                            if($ola->sesion<>''){
                                $qola= " and variables_get LIKE '%".$ola->sesion."%'  ";
                                $sql= " SELECT  count(DISTINCT rut) as cuenta       FROM
                                tbl_log_sistema WHERE       id_empresa = '".$id_empresa."'
                                  AND fecha <= '".$unico->fechaT."' $qola";
                                $database->setquery($sql);    $database->query();    $cod = $database->listObjects();

                                $sql= " SELECT  count(DISTINCT rut) as cuenta       FROM
                                tbl_log_sistema WHERE       id_empresa = '".$id_empresa."'
                                  AND fecha <= '".$unico->fechaT_m1."' $qola";
                                $database->setquery($sql);    $database->query();    $cod = $database->listObjects();
                                $un=$cod[0]->cuenta - $cod2[0]->cuenta;

                    Com_Insert_Dash_estadistica($id_empresa, $id_dimension, $tipo,$un, $unico->fechaI, $nombre,$ola->sesion);

                                }
                            }         */


//Publicaciones
        $tipo = "PO";
        $nombre = "Publicaciones";

        $sql = "SELECT count(DISTINCT id_mp)  as cuenta
                FROM tbl_mp WHERE    id_empresa = '" . $id_empresa . "'
                AND id_estado>=5
                AND fecha >= '" . $unico->fechaI . "'   AND fecha <= '" . $unico->fechaT . "' ";

        //echo $sql;

        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();

        Com_Insert_Dash_estadistica($id_empresa, $id_dimension, $tipo, $cod[0]->cuenta, $unico->fechaI, $nombre, "");

        /* $array_olas=Com_Busca_olas($id_empresa);
                        foreach ($array_olas as $ola){
                            if($ola->codigo<>''){
                                $qola= "    and (select id_subcategoria from tbl_mp where id_mp=h.id_mp
                                and id_subcategoria='".$ola->codigo."' limit 1)='".$ola->codigo."'";


                                $sql= " SELECT count(DISTINCT id_mp)  as cuenta
                            FROM tbl_mp WHERE    id_empresa = '".$id_empresa."'
                            AND id_estado>=5
                            AND fecha >= '".$unico->fechaI."'   AND fecha <= '".$unico->fechaT."' $qola";
                                $database->setquery($sql);    $database->query();    $cod = $database->listObjects();

                    Com_Insert_Dash_estadistica($id_empresa, $id_dimension, $tipo, $cod[0]->cuenta, $unico->fechaI, $nombre,$ola->sesion);

                                }
                            }
                            */
//Comentarios
        $tipo = "CO";
        $nombre = "Comentarios";


        $sql = "

                SELECT count(DISTINCT id)   as cuenta
                FROM tbl_mp_interacciones WHERE id_empresa = '" . $id_empresa . "'
                AND (tipo='COMENTARIO' or tipo='COMENTARIO_REPLY')
                AND fecha >= '" . $unico->fechaI . "'   AND fecha <= '" . $unico->fechaT . "'
                and id_mp<>''";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();

        Com_Insert_Dash_estadistica($id_empresa, $id_dimension, $tipo, $cod[0]->cuenta, $unico->fechaI, $nombre, "");

        /* $array_olas=Com_Busca_olas($id_empresa);
                        foreach ($array_olas as $ola){
                            if($ola->codigo<>''){
                                $qola= "    and (select id_subcategoria from tbl_mp where id_mp=h.id_mp
                                and id_subcategoria='".$ola->codigo."' limit 1)='".$ola->codigo."'";


                                $sql= " SELECT count(DISTINCT id)   as cuenta
                FROM tbl_mp_interacciones WHERE id_empresa = '".$id_empresa."'
                AND (tipo='COMENTARIO' or tipo='COMENTARIO_REPLY')
                AND fecha >= '".$unico->fechaI."'   AND fecha <= '".$unico->fechaT."'
                and id_mp<>'' $qola";
                                $database->setquery($sql);    $database->query();    $cod = $database->listObjects();

                    Com_Insert_Dash_estadistica($id_empresa, $id_dimension, $tipo, $cod[0]->cuenta, $unico->fechaI, $nombre,$ola->sesion);

                                }
                            }     */

//Tagueos
        $tipo = "TA";
        $nombre = "Tagueos";


        $sql = "

                SELECT count(DISTINCT id)   as cuenta
                FROM tbl_mp_interacciones WHERE id_empresa = '" . $id_empresa . "'
                AND (tipo='TAGUEADO')
                AND fecha >= '" . $unico->fechaI . "'   AND fecha <= '" . $unico->fechaT . "'
                and id_mp<>''";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();

        Com_Insert_Dash_estadistica($id_empresa, $id_dimension, $tipo, $cod[0]->cuenta, $unico->fechaI, $nombre, "");

        /* $array_olas=Com_Busca_olas($id_empresa);
                        foreach ($array_olas as $ola){
                            if($ola->codigo<>''){
                                $qola= "    and (select id_subcategoria from tbl_mp where id_mp=h.id_mp
                                and id_subcategoria='".$ola->codigo."' limit 1)='".$ola->codigo."'";


                                $sql= " SELECT count(DISTINCT id)   as cuenta
                FROM tbl_mp_interacciones WHERE id_empresa = '".$id_empresa."'
                AND (tipo='TAGUEADO')
                AND fecha >= '".$unico->fechaI."'   AND fecha <= '".$unico->fechaT."'
                and id_mp<>'' $qola";
                                $database->setquery($sql);    $database->query();    $cod = $database->listObjects();

                    Com_Insert_Dash_estadistica($id_empresa, $id_dimension, $tipo, $cod[0]->cuenta, $unico->fechaI, $nombre,$ola->sesion);

                                }
                            }
 */
//Me Gusta
        $tipo = "MG";
        $nombre = "Me Gusta";


        $sql = "

                SELECT count(DISTINCT id)   as cuenta
                FROM tbl_mp_interacciones WHERE id_empresa = '" . $id_empresa . "'
                AND (tipo='MEGUSTA_POST' or tipo='MEGUSTA_POST_REPLY' or tipo='MEGUSTA')
                AND fecha >= '" . $unico->fechaI . "'   AND fecha <= '" . $unico->fechaT . "'
                and id_mp<>''";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();

        Com_Insert_Dash_estadistica($id_empresa, $id_dimension, $tipo, $cod[0]->cuenta, $unico->fechaI, $nombre, "");

        /* $array_olas=Com_Busca_olas($id_empresa);
                        foreach ($array_olas as $ola){
                            if($ola->codigo<>''){
                                $qola= "    and (select id_subcategoria from tbl_mp where id_mp=h.id_mp
                                and id_subcategoria='".$ola->codigo."' limit 1)='".$ola->codigo."'";


                                $sql= " SELECT count(DISTINCT id)   as cuenta
                FROM tbl_mp_interacctipo='MEGUSTA_POST' or tipo='MEGUSTA_POST_REPLY' or tipo='MEGUSTA')
                AND fecha >= '".$unico->fechaI."'   AND fecha <= '".$unico->fechaT."'
                and id_mp<>'' $qola";
                                $database->setquery($sql);    $database->query();    $cod = $database->listObjects();

                    Com_Insert_Dash_estadistica($id_empresa, $id_dimension, $tipo, $cod[0]->cuenta, $unico->fechaI, $nombre,$ola->sesion);

                                }
                            }
 */
//Total Interacciones
        $tipo = "TI";
        $nombre = "Interacciones";


        $sql = "

                SELECT count(DISTINCT id)   as cuenta
                FROM tbl_mp_interacciones WHERE id_empresa = '" . $id_empresa . "'
                AND (tipo='MEGUSTA_POST' or tipo='MEGUSTA_POST_REPLY' or tipo='MEGUSTA'  or tipo='TAGUEADO' or tipo='COMENTARIO' or tipo='COMENTARIO_REPLY')
                AND fecha >= '" . $unico->fechaI . "'   AND fecha <= '" . $unico->fechaT . "'
                and id_mp<>''";
        $database->setquery($sql);
        $database->query();
        $cod = $database->listObjects();

        Com_Insert_Dash_estadistica($id_empresa, $id_dimension, $tipo, $cod[0]->cuenta, $unico->fechaI, $nombre, "");

        /* $array_olas=Com_Busca_olas($id_empresa);
                        foreach ($array_olas as $ola){
                            if($ola->codigo<>''){
                                $qola= "    and (select id_subcategoria from tbl_mp where id_mp=h.id_mp
                                and id_subcategoria='".$ola->codigo."' limit 1)='".$ola->codigo."'";


                                $sql= " SELECT count(DISTINCT id)   as cuenta
                FROM tbl_mp_interacctipo='MEGUSTA_POST' or tipo='MEGUSTA_POST_REPLY' or tipo='MEGUSTA' or tipo='TAGUEADO' or tipo='COMENTARIO' or tipo='COMENTARIO_REPLY')
                AND fecha >= '".$unico->fechaI."'   AND fecha <= '".$unico->fechaT."'
                and id_mp<>'' $qola";
                                $database->setquery($sql);    $database->query();    $cod = $database->listObjects();

                    Com_Insert_Dash_estadistica($id_empresa, $id_dimension, $tipo, $cod[0]->cuenta, $unico->fechaI, $nombre,$ola->sesion);

                                }
                            }     */


    }

}


function checkIsAValidDate($myDateString)
{
    return (bool)strtotime($myDateString);
}

function NotificacionesBuscaPendientesAutomatico($id_empresa, $url_front, $url_front_admin, $logo, $from, $nombrefrom, $id_programa)
{
    //echo "NotificacionesBuscaPendientesAutomatico $id_empresa,$url_front,$url_front_admin,$logo,$from,$nombrefrom, $id_programa";

    DeleteFullTbltbl_notificaciones_pendientes();
    //1. Envio a Administrador de Mediciones con Fecha
    $hoy = date("Y-m-d");
    //$hoy="2018-03-02";
    $diamanana = date("Y-m-d", strtotime("+1 day"));
    $diadosveces = date("Y-m-d", strtotime("+2 day"));
    //busca mediciones que parte en dos dias más
    //Notificacion a responsable Medicion

    //$Not_array_MR=Not_buscaMedicionResponsable($diadosveces,$id_empresa);
    //echo "<br>Not_array_MR";
    //print_r($Not_array_MR);
    foreach ($Not_array_MR as $unico) {
        $array_u = TraeDatosUsuario($unico->rut);
        $tipoenvio = "Medicion";
        $tipoenvio = "Medicion_responsable";
        $rut = $array_u[0]->rut;
        $fecha_envio = $diamañana;
        $to = $array_u[0]->email;
        $nombreto = $array_u[0]->nombre_completo;
        $tipo = "text/html";
        $subject = "Esta pronto a activarse una Medicion";
        $titulo1 = "Está pronto a activarse una Medición";
        $subtitulo1 = "Mañana se activará la Medición ID: " . $unico->id . " " . $unico->nombre;
        $texto1 = "Recuerda revisar la lista de usuarios a los que se les enviará la notificación";
        $url = $url_front_admin;
        $texto_url = "Ingresa aqui";
        $texto2 = " ";
        $texto3 = " ";
        $texto4 = " ";
        $tipomensaje = "Medicion_responsable_alerta";
        $key = $rut;
        $template = "";
        $not_cuenta1++;
        InsertNotificacionesPendientes($tipoenvio, $nombre, $rut, $fecha_envio, $id_empresa,
            $to, $nombreto, $from, $nombrefrom, $tipo, ($subject), ($titulo1), ($subtitulo1),
            ($texto1),
            $url, ($texto_url),
            ($texto2), ($texto3), ($texto4), $logo, $tipomensaje, $key, $template);
    }

    //        echo "<br>1 $not_cuenta1";
    //2. busca mediciones pendientes de mañana pero jefe a usuario (TODOS)
    //$Not_array_MP=Not_buscamediciones_Pendientes_usuarios_Jefe_usuario($diamañana, $id_empresa);
    //echo "<br>Not_array_MP";
    //print_r($Not_array_MP);
    foreach ($Not_array_MP as $unico) {
        $array_u = TraeDatosUsuario($unico->jefe);
        $array_c = TraeDatosUsuario($unico->rut);
        $tipoenvio = "Medicion";
        $tipoenvio = "Medicion_Invitacion";
        $rut = $array_u[0]->rut;
        $fecha_envio = $diamañana;
        $to = $array_u[0]->email;
        $nombreto = $array_u[0]->nombre_completo;
        $tipo = "text/html";
        $subject = "Te invitamos a contestar una Evaluacion de Impacto";
        $titulo1 = "Te invitamos a contestar una Evaluación de Impacto";
        $subtitulo1 = "Debes realizar la evaluación de impacto " . nombremedicion . "
                para el colaborador: " . $array_c[0]->nombre_completo . "";
        $texto1 = "No te tomará más de 5 minutos";
        $url = $url_front;
        $texto_url = "Ingresa aqui";
        $texto2 = " ";
        $texto3 = " ";
        $texto4 = " ";
        $tipomensaje = "Medicion_pendiente_usuario";
        $key = $rut;
        $template = "";
        $not_cuenta2++;
        InsertNotificacionesPendientes($tipoenvio, $nombre, $rut, $fecha_envio, $id_empresa,
            $to, $nombreto, $from, $nombrefrom, $tipo, ($subject), ($titulo1), ($subtitulo1),
            ($texto1),
            $url, ($texto_url),
            ($texto2), ($texto3), ($texto4), $logo, $tipomensaje, $key, $template);
    }

    //  echo "<br>2 $not_cuenta2";
    // 3. busca mediciones pendientes de mañana INDIVIDUAL (SOLO PENDIENTES)
    //$Not_array_Evaluaciones_Individuales=Not_buscamediciones_Pendientes_Evaluaciones_individuales($diamañana, $id_empresa);
    //print_r($Not_array_Evaluaciones_Individuales);
    foreach ($Not_array_Evaluaciones_Individuales as $unico) {
        $array_u = TraeDatosUsuario($unico->rut);
        $array_c = TraeDatosUsuario($unico->rut);
        $tipoenvio = "Evaluacion";
        $tipoenvio = "evaluacion_pendiente";
        $rut = $array_u[0]->rut;
        $fecha_envio = $hoy;
        $to = $array_u[0]->email;
        $nombreto = $array_u[0]->nombre_completo;
        $tipo = "text/html";
        $subject = "¡Tienes una evaluación pendiente!";
        $titulo1 = "¡Tienes una evaluación pendiente!";
        $subtitulo1 = "Te invitamos a contestar la Evaluación: <strong>" . utf8_encode($unico->nombremedicion) . "</strong>.
                <br><br>Recuerda que responder estas evaluaciones son una actividad obligatoria, con fecha de término 16 de Marzo 2018.";
        $texto1 = "No te tomará más de 3 minutos, ¡Aprovecha ahora!<br><br>
                Al ingresar a la plataforma, ingresa con tu RUT y clave los primeros cuatro digitos de tu RUT.<br>
                Luego de llenar tu perfil, aparecerá una alerta que dice que tienes una Evaluación Pendiente.
                ";
        $url = $url_front;
        $texto_url = "Ingresa aqui";
        $texto2 = " ";
        $texto3 = " ";
        $texto4 = " ";
        $tipomensaje = "evaluacion_pendiente_usuario";
        $key = $rut;
        $template = "";
        $not_cuenta3++;
        InsertNotificacionesPendientes($tipoenvio, $nombre, $rut, $fecha_envio, $id_empresa,
            $to, $nombreto, $from, $nombrefrom, $tipo, ($subject), ($titulo1), ($subtitulo1),
            ($texto1),
            $url, ($texto_url),
            ($texto2), ($texto3), ($texto4), $logo, $tipomensaje, $key, $template);
    }


    // 4. Cursos Elearning Pendientes   Usuarios


    // 5. Cursos Elearning Pendientes con mas de un mes
    $fecha_inicio = date("Y-m-d");

    ini_set('output_buffering', 0);
    ini_set('zlib.output_compression', 0);
    if (!ob_get_level()) {
        ob_start();
    } else {
        ob_end_clean();
        ob_start();
    }


    $Not_array_ElearningPendientes = Not_cursosElearningObligatoriosPendientes($id_programa, $id_empresa);
    $fila = count($Not_array_ElearningPendientes);
    //echo "fila 1 $fila";
    foreach ($Not_array_ElearningPendientes as $unico) {
        $l++;
        echo "<center><span style='position: absolute;z-index:$current;background:#36C6D3; padding:10px; color:#FFF'>Registro Colaborador $l de $fila</span></center>";
        flush();
        ob_flush();


        $Ausente = Ausentismo_rut($unico->rut);
        if ($Ausente > 0) {
            continue;
            echo "<script>alert('Ausente " . $unico->rut . "');</script>";
        }

        $array_u = TraeDatosUsuario($unico->rut);
        $array_c = TraeDatosUsuario($unico->rut);
        $tipoenvio = "Cursos_Elearning_Pendientes";
        $tipoenvio = "Cursos_Elearning_Pendientes";
        $rut = $array_u[0]->rut;
        $fecha_envio = $hoy;
        $to = $array_u[0]->email;
        $nombreto = $array_u[0]->nombre_completo;
        $tipo = "text/html";
        $subject = "Cursos Digitales Pendientes";
        $Not_Array_curso = Not_listacursosElearningObligatoriosPendientes($unico->rut, $id_programa, $id_empresa);

        $lista_curso = "";
        $cuenta_cursos = 0;
        foreach ($Not_Array_curso as $curso) {
            $cuenta_cursos++;
            $lista_curso .= "<br>Curso: " . $curso->nombre_curso . "";
        }

        if ($cuenta_cursos > 1) {
            $titulo1 = "Estimado(a) colaborador(a),";
            $subtitulo1 = "Te invitamos a terminar tus cursos digitales pendientes";

        } else {
            $titulo1 = "Estimado(a) colaborador(a),";
            $subtitulo1 = "Te invitamos a terminar tu curso digital pendiente";

        }

        $texto1 = '<p class="text-left">' . utf8_encode($lista_curso) . '</p>';
        $texto2 = "Te recomendamos planificar anticipadamente espacios en tu agenda para que puedas cumplir con la aprobaci?n de este curso en el plazo definido.";
        $texto3 = "Si necesitas ayuda, nos puedes contactar en nuestra Central de Soporte: 2 258 30 236.<br> ?Mucho ?xito!";
        $url = $url_front;
        $texto_url = "";
        $texto4 = "";
        $tipomensaje = "Curso_Pendiente_usuario";
        $key = $rut;
        $template = "";
        $not_cuenta4++;


        InsertNotificacionesPendientes($tipoenvio, $nombre, $rut, $fecha_envio, $id_empresa,
            $to, $nombreto, $from, $nombrefrom, $tipo, ($subject), ($titulo1), ($subtitulo1),
            ($texto1),
            $url, ($texto_url),
            ($texto2), ($texto3), ($texto4), $logo, $tipomensaje, $key, $template);
    }

    DeleteNotificacionesPendientesCargosNoPermitidos($rut);
    echo "<br>Fin BuscaPendientes<br>";


    // Por Jefatura


    ini_set('output_buffering', 0);
    ini_set('zlib.output_compression', 0);
    if (!ob_get_level()) {
        ob_start();
    } else {
        ob_end_clean();
        ob_start();
    }

    //PENDIENTES JEFATURA DESACTIVOS
    $Not_array_ElearningPendientesFecha = Not_cursosElearningObligatoriosPendientesFechaJefe($id_empresa, $id_programa, $fecha_inicio, "Division Personas y Organizacion");

    $fila = count($Not_array_ElearningPendientesFecha);
    //echo "fila 2 $fila";
    foreach ($Not_array_ElearningPendientesFecha as $unico) {

        $l2++;
        echo "<center><span style='position: absolute;z-index:$current;background:#36C6D3; padding:10px; color:#FFF'>Registro Jefatura $l2 de $fila</span></center>";
        flush();
        ob_flush();

        $array_u = TraeDatosUsuario($unico->Jefe);
        $array_c = TraeDatosUsuario($unico->Jefe);
        $tipoenvio = "Cursos_Elearning_PendientesJefe";
        $tipoenvio = "Cursos_Elearning_PendientesJefe";
        $rut = $array_u[0]->rut;
        $fecha_envio = $hoy;
        $to = $array_u[0]->email;
        $nombreto = $array_u[0]->nombre_completo;
        $tipo = "text/html";
        $subject = "Cursos Digitales pendientes";
        $Not_Array_curso = Not_listacursosElearningObligatoriosPendientesFechaJefe($unico->Jefe, $fecha_inicio, $id_programa, $id_empresa);

        $lista_curso = "";
        $cuenta_cursos = 0;
        foreach ($Not_Array_curso as $curso) {
            //echo "<h2>Jefe ".$unico->Jefe." --> ".$curso->rut."</h2>";
            $Ausente = Ausentismo_rut($curso->rut);
            if ($Ausente > 0) {
                //continue;
                //echo "<script>alert('Ausente ".$curso->rut."');</script>";
            } else {
                //echo "<br>--->".$curso->rut;
                $cuenta_cursos++;
                $lista_curso .= "<br>" . $curso->nombre . ", Curso: " . $curso->nombre_curso . "";
            }
            //echo "<br>----> cuenta curso ".$cuenta_cursos;

        }


        if ($cuenta_cursos > 1) {
            $titulo1 = "Estimado(a) Jefe,";
            $subtitulo1 = "Te informamos que colaboradores de tu equipo tienen Cursos digitales pendientes:";
            $texto1 = '<p class="text-left">' . utf8_encode($lista_curso) . '</p>';
            $texto2 = "Te invitamos a incentivar a tus colaboradores a terminar los cursos de capacitaci?n, los cuales son de car?cter obligatorio.
							                <br>Recomendamos que les sugieras que programen tiempo en sus agendas para estudiar de una forma m?s ?ptima,
							                ya que estos cursos son importantes para el desempe?o del cargo y su desarrollo profesional.";
        } elseif ($cuenta_cursos == "1") {


            $titulo1 = "Estimado(a) Jefe,";
            $subtitulo1 = "Te informamos que un colaborador de tu equipo tiene un Curso Digital pendiente:";
            $texto1 = '<p class="text-left">' . utf8_encode($lista_curso) . '</p>';
            $texto2 = "Te invitamos a incentivar a tu colaborador(a) a terminar el  curso de capacitaci?n, el cual es de car?cter obligatorio.
							                <br>Recomendamos que les sugieras que programen tiempo en sus agendas para estudiar de una forma m?s ?ptima,
							                ya que estos cursos son importantes para el desempe?o del cargo y su desarrollo profesional.";
        } else {
            $cuenta_cursos == "0";
        }
        $texto3 = "?Desde ya agradecemos tu colaboraci?n!";
        $texto4 = "";

        $url = $url_front;
        $texto_url = "";

        $tipomensaje = "Curso_Pendiente_usuarioJefe";
        $key = $rut;
        $template = "";
        $not_cuenta4++;

        if ($cuenta_cursos > 0) {
            InsertNotificacionesPendientes($tipoenvio, $nombre, $rut, $fecha_envio, $id_empresa,
                $to, $nombreto, $from, $nombrefrom, $tipo, ($subject), ($titulo1), ($subtitulo1),
                ($texto1), $url, ($texto_url),
                ($texto2), ($texto3), ($texto4), $logo, $tipomensaje, $key, $template);
        }

    }


    //echo "<br>4 $not_cuenta4";
    // 7. Cursos Elearning Inscritos Hoy
    //$Not_array_InscripcionesHoy=Not_cursosElearningInscripcion($hoy,$id_empresa);
    //print_r($Not_array_Evaluaciones_Individuales);
    foreach ($Not_array_InscripcionesHoy as $unico) {
        $array_u = TraeDatosUsuario($unico->rut);
        $array_c = TraeDatosUsuario($unico->rut);
        $tipoenvio = "Cursos_Elearning_InscritosHoy";
        $rut = $array_u[0]->rut;
        $fecha_envio = $diamañana;
        $to = $array_u[0]->email;
        $nombreto = $array_u[0]->nombre_completo;
        $tipo = "text/html";
        $subject = "¡Estás inscrito en un nuevo Curso!";
        $Not_Array_curso = Not_lista_cursosElearningInscripcion($hoy, $unico->rut, $id_empresa);
        $lista_curso = "";
        foreach ($Not_Array_curso as $curso) {
            $lista_curso .= "<br>" . $curso->nombre_programa . ", Curso: " . $curso->nombre_curso . "";
        }
        $titulo1 = "Te invitamos a que realices un nuevo Curso Elearning";
        $subtitulo1 = "La siguiente es la lista de cursos que están disponibles desde hoy para ti";
        $texto1 = '<p class="text-left">' . utf8_encode($lista_curso) . '</p>';
        $texto2 = "Recuerda que terminar los cursos es una parte fundamental de tu desarrollo laboral";
        $texto3 = "No te tomará más de 10 minutos por curso, ¡Aprovecha ahora!";
        $url = $url_front;
        $texto_url = "Ingresa aqui";
        $texto2 = " ";
        $texto3 = " ";
        $texto4 = " ";
        $tipomensaje = "Cursos_Elearning_InscritosHoy";
        $key = $rut;
        $template = "https://" . $_SERVER['SERVER_NAME'] . "/front/views/emails_notificaciones/" . $id_empresa . "_template_notificacion.html";
        $not_cuenta5++;
        InsertNotificacionesPendientes($tipoenvio, $nombre, $rut, $fecha_envio, $id_empresa,
            $to, $nombreto, $from, $nombrefrom, $tipo, ($subject), ($titulo1), ($subtitulo1),
            ($texto1),
            $url, ($texto_url),
            ($texto2), ($texto3), ($texto4), $logo, $tipomensaje, $key, $template);
    }
    //echo "<br>5 $not_cuenta5";


    DeleteNotificacionesPendientesCargosNoPermitidos($rut);
    echo "<br>Fin BuscaPendientes<br>";

}


function NotificacionesAutomaticas_envio($id_empresa)
{
    $hoy = date("Y-m-d");
    //$hoy="2018-02-20";
    $Not_array_MRH = Not_buscaNotificacionesEnvioHoyEstadoNull($hoy, $id_empresa);
    //print_r($Not_array_MRH);sleep(3);

    $count_total_loop = count($Arreglo);
    ini_set('output_buffering', 0);
    ini_set('zlib.output_compression', 0);
    if (!ob_get_level()) {
        ob_start();
    } else {
        ob_end_clean();
        ob_start();
    }

    foreach ($Not_array_MRH as $unico) {

        $cuenta_loop++;
        echo "<center><span style='position: absolute;z-index:$current;background:#36C6D3; padding:10px; color:#FFF'>Enviando $cuenta_loop de $count_total_loop Registros</span></center>";
        flush();
        ob_flush();

        $id_empresa = $unico->id_empresa;
        $to = $unico->hacia;
        $nombreto = $unico->nombreto;
        $from = utf8_encode($unico->desde);
        $nombrefrom = utf8_encode($unico->nombrefrom);
        $tipo = $unico->tipo;
        $subject = utf8_encode($unico->asunto);
        $titulo1 = utf8_encode($unico->titulo1);
        $subtitulo1 = utf8_encode($unico->subtitulo1);
        $texto1 = utf8_encode($unico->texto1);
        $url = $unico->url;
        $texto_url = utf8_encode($unico->texto_url);
        $logo = $unico->logo;
        $texto2 = utf8_encode($unico->texto2);
        $texto3 = utf8_encode($unico->texto3);
        $texto4 = utf8_encode($unico->texto4);
        $tipomensaje = $unico->tipomensaje;
        $rut = $unico->clave;
        $key = $unico->clave;
        $template = $unico->template;
        /*
						echo "<br>to $to, nombre $nombreto, fro $from, nombrefrom $nombrefrom, tipo $tipo, subject $subject,  titulo1 $titulo1, subtitulo1 $subtitulo1,  texto1 $texto1, url $url,  texto_url $texto_url,
						texto2 $texto2, texto3 $texto3,  texto4 $texto4, logo $logo, id_empresa $id_empresa, url $url, tipomensaje $tipomensaje, rut $rut,key $key, template $template";
						sleep(5); */
        SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url,
            $texto2, $texto3, $texto4, $logo, $id_empresa, $url, $tipomensaje, $rut, $key, $template);
        echo "<br>to $to, nombre $nombreto,$subject";
        Not_Actualiza_estado($unico->id, "ENVIADA");
    }
}

function RESULTADOS_PromedioPorDimensionesPonderadasMetas($evaluado, $evaluador, $id_proceso, $id_empresa, $id_dimension)
{
    $respuestas_dimension = RESULTADOS_RespuestasPorDimensionRespuestasObjetivos($evaluado, $evaluador, $id_proceso, $id_empresa, $id_dimension);
    foreach ($respuestas_dimension as $res) {
        $acumulador = $acumulador + ($res->puntaje * $res->ponderacion) / 100;
    }
    return ($acumulador);
}

function SGD_Resultados_EvaluacionNew($PRINCIPAL, $id_empresa, $id_proceso, $excel)
{
    //total Usuarios Empresa
    //echo "<pre>";
    //print_r($SGD_Todas_Resultados_evaluados);
    //exit();
    //traigo los programas por empresa
    $total_dimensiones = TraeDimensionesParaProcesoPorPErfilesDeEvaluacion($id_proceso, $id_empresa);
    $sumaDimPunt = 0;
    $Cuentadimpunt = 0;
    if ($id_empresa == 79) {
        $cuentaDime = 1;
    } else {
        $cuentaDime = 2;
    }
    $cuentaDime = count($total_dimensiones);
    //Traigo las dimensiones por emoresa
    $contadodor_dimensiones = 1;
    foreach ($total_dimensiones as $dimensi) {
        $encabezado_dimensiones .= '<th class="bg_gray">' . utf8_encode($dimensi->nombre) . '</th>';
        $resultados_dimensiones .= '<td class="miniSt">{DIM' . $contadodor_dimensiones . '}</td>';
        //Traigo las competencias por cada dimension
        $competencias = CompetenciasPorDimension($dimensi->id_dimension);
        foreach ($competencias as $comp) {
            $encabezado_dimensiones .= '<th class="bg_gray">' . utf8_encode($comp->nombre) . '</th>';
            $resultados_dimensiones .= '<td class="miniSt">{RES_' . $comp->id . '}</td>';
            //SQL para traer los promedios por cada competencia
            $sql_promedios_competencias .= "(select avg(puntaje) from tbl_sgd_respuestas where tbl_sgd_respuestas.id_proceso='" . $id_proceso . "' and  tbl_sgd_respuestas.evaluado=h.evaluado and tbl_sgd_respuestas.evaluador=h.evaluador and tbl_sgd_respuestas.id_proceso=h.id_proceso and tbl_sgd_respuestas.id_competencia='" . $comp->id . "') as res_comp_" . $comp->id . ", ";
        }
        $contadodor_dimensiones++;
    }
    $PRINCIPAL = str_replace("{ROW_ENCABEZADO_DIMENSIONES}", $encabezado_dimensiones, $PRINCIPAL);
    //Traigo las dimensiones de los objetivos
    $dimensiones_objetivos = DimensionesPorEmpresaResultados($id_empresa);
    $contador_dimensiones_objetivos = 0;
    foreach ($dimensiones_objetivos as $dimen_obj) {
        $encabezado_dimensiones_objetivos .= '<th class="bg_gray">Puntaje Alcanzado ' . utf8_encode($dimen_obj->nombre) . '</th>';
        $encabezado_dimensiones_objetivos .= '<th class="bg_gray">Resultado ' . utf8_encode($dimen_obj->nombre) . '</th>';
    }
    $PRINCIPAL = str_replace("{ROW_ENCABEZADO_DIMENSIONES_OBJETIVOS}", $encabezado_dimensiones_objetivos, $PRINCIPAL);
    $SGD_Todas_Resultados_evaluados = SGD_DatosTablaResultadosPorEvaluado($id_empresa, $id_proceso, $sql_promedios_competencias);
    foreach ($SGD_Todas_Resultados_evaluados as $SGD_Todas_Resultado_evaluado) {
        $cuentalinea++;
        $evaluado = "<strong>" . $SGD_Todas_Resultado_evaluado->NombreEvaluado . "</strong>
        <br>" . $SGD_Todas_Resultado_evaluado->CargoEvaluado . "<br>
        <small>" . $SGD_Todas_Resultado_evaluado->GerenciaEvaluado . "</small>";
        $evaluador = "<strong>" . $SGD_Todas_Resultado_evaluado->NombreEvaluador . "</strong>
        <br>" . $SGD_Todas_Resultado_evaluado->CargoEvaluador . "<br>
        <small>" . $SGD_Todas_Resultado_evaluado->GerenciaEvaluador . "</small>";
        $SGD_Todas_Resultado_evaluado->NombreDim;
        $SGD_Todas_Resultado_evaluado->Puntaje;
        if ($SGD_Todas_Resultado_evaluado->DimOpcional == 0) {
            $sumaDimPunt = $sumaDimPunt + $SGD_Todas_Resultado_evaluado->Puntaje;
            $sumaDimPunt_ae = $sumaDimPunt_ae + $SGD_Todas_Resultado_evaluado->nota_comp_ae;
            $Cuentadimpunt++;
        }
        //$SGD_dim1=0;$SGD_dim2=0;$SGD_dim3=0;
        if ($cuentalinea == 1) {
            $SGD_dim1 = $SGD_Todas_Resultado_evaluado->Puntaje;
        }
        if ($cuentalinea == 2) {
            $SGD_dim2 = $SGD_Todas_Resultado_evaluado->Puntaje;
        }
        if ($cuentalinea == 3) {
            $SGD_dim3 = $SGD_Todas_Resultado_evaluado->Puntaje;
        }
        //echo "<br>cuentalinea $cuentalinea $SGD_dim1 $SGD_dim2 $SGD_dim3";
        //echo "<br>".$promedio_Resultado;
        if ($cuentalinea % $cuentaDime == 0) {
            $cuentalinea = 0;
            if ($id_empresa == 79) {
                $promedio_Resultado = round($sumaDimPunt / $Cuentadimpunt, 1);
                $promedio_Resultado_ae = round($sumaDimPunt_ae / $Cuentadimpunt, 1);
            } else {
                $promedio_Resultado = round($sumaDimPunt / $Cuentadimpunt, 2);
                $promedio_Resultado_ae = round($sumaDimPunt_ae / $Cuentadimpunt, 2);
            }
            $sumaDimPunt = 0;
            $sumaDimPunt_ae = 0;
            $Cuentadimpunt = 0;
            if ($excel == 1) {
                $rows = file_get_contents("views/sgd/resultados/" . $id_empresa . "_row_listado_excel.html");
            } else {
                $rows .= file_get_contents("views/sgd/resultados/" . $id_empresa . "_row_listado.html");
            }
            $rows = str_replace("{ROW_RESULTADOS_DIMENSIONES}", $resultados_dimensiones, $rows);
            $rows = str_replace("{EVALUADO}", $evaluado, $rows);
            $rows = str_replace("{EVALUADOR}", $evaluador, $rows);
            $rows = str_replace("{RESULTADO_FINAL}", $promedio_Resultado, $rows);
            $rows = str_replace("{RESULTADO_FINAL_AE}", $SGD_Todas_Resultado_evaluado->nota_comp_ae, $rows);
            $rows = str_replace("{DIM1}", $SGD_dim1, $rows);
            $rows = str_replace("{DIM2}", $SGD_dim2, $rows);
            $rows = str_replace("{DIM3}", $SGD_dim3, $rows);
            $rows = str_replace("{RES_16}", $SGD_Todas_Resultado_evaluado->res_comp_16, $rows);
            $rows = str_replace("{RES_17}", $SGD_Todas_Resultado_evaluado->res_comp_17, $rows);
            $rows = str_replace("{RES_18}", $SGD_Todas_Resultado_evaluado->res_comp_18, $rows);
            $rows = str_replace("{RES_19}", $SGD_Todas_Resultado_evaluado->res_comp_19, $rows);
            $rows = str_replace("{RES_20}", $SGD_Todas_Resultado_evaluado->res_comp_20, $rows);
            $rows = str_replace("{RES_21}", $SGD_Todas_Resultado_evaluado->res_comp_21, $rows);
            $rows = str_replace("{RES_22}", $SGD_Todas_Resultado_evaluado->res_comp_22, $rows);
            $rows = str_replace("{RES_23}", $SGD_Todas_Resultado_evaluado->res_comp_23, $rows);
            $rows = str_replace("{RES_24}", $SGD_Todas_Resultado_evaluado->res_comp_24, $rows);
            $rows = str_replace("{RES_25}", $SGD_Todas_Resultado_evaluado->res_comp_25, $rows);
            $rows = str_replace("{RES_26}", $SGD_Todas_Resultado_evaluado->res_comp_26, $rows);
            $rows = str_replace("{RES_27}", $SGD_Todas_Resultado_evaluado->res_comp_27, $rows);
            $rows = str_replace("{RES_28}", $SGD_Todas_Resultado_evaluado->res_comp_28, $rows);
            $rows = str_replace("{RES_29}", $SGD_Todas_Resultado_evaluado->res_comp_29, $rows);
            $rows = str_replace("{RES_30}", $SGD_Todas_Resultado_evaluado->res_comp_30, $rows);
            $rows = str_replace("{RES_8670}", $SGD_Todas_Resultado_evaluado->res_comp_8670, $rows);
            $rows = str_replace("{RES_8671}", $SGD_Todas_Resultado_evaluado->res_comp_8671, $rows);
            $rows = str_replace("{RES_8672}", $SGD_Todas_Resultado_evaluado->res_comp_8672, $rows);
            $rows = str_replace("{RES_8673}", $SGD_Todas_Resultado_evaluado->res_comp_8673, $rows);
            $rows = str_replace("{RES_8674}", $SGD_Todas_Resultado_evaluado->res_comp_8674, $rows);
            $rows = str_replace("{RES_8675}", $SGD_Todas_Resultado_evaluado->res_comp_8675, $rows);
            $rows = str_replace("{RES_8676}", $SGD_Todas_Resultado_evaluado->res_comp_8676, $rows);
            $rows = str_replace("{RES_8677}", $SGD_Todas_Resultado_evaluado->res_comp_8677, $rows);
            $rows = str_replace("{RES_8678}", $SGD_Todas_Resultado_evaluado->res_comp_8678, $rows);
            $rows = str_replace("{RES_8679}", $SGD_Todas_Resultado_evaluado->res_comp_8679, $rows);
            $rows = str_replace("{RES_8680}", $SGD_Todas_Resultado_evaluado->res_comp_8680, $rows);
            $rows = str_replace("{RES_8681}", $SGD_Todas_Resultado_evaluado->res_comp_8681, $rows);
            $rows = str_replace("{RES_8682}", $SGD_Todas_Resultado_evaluado->res_comp_8682, $rows);
            $rows = str_replace("{RES_8683}", $SGD_Todas_Resultado_evaluado->res_comp_8683, $rows);
            $rows = str_replace("{RES_8684}", $SGD_Todas_Resultado_evaluado->res_comp_8684, $rows);
            $rows = str_replace("{RES_8685}", $SGD_Todas_Resultado_evaluado->res_comp_8685, $rows);
            $rows = str_replace("{RES_8686}", $SGD_Todas_Resultado_evaluado->res_comp_8686, $rows);
            $rows = str_replace("{RES_8687}", $SGD_Todas_Resultado_evaluado->res_comp_8687, $rows);
            $rows = str_replace("{RES_8688}", $SGD_Todas_Resultado_evaluado->res_comp_8688, $rows);
            $html_resultados_objetivos = "";
            $acumulador_notas_ponderadas_dimesion = "";
            foreach ($dimensiones_objetivos as $dimen_ob) {
                $resultado_dim_obj = RESULTADOS_PromedioPorDimensionesPonderadasMetas($SGD_Todas_Resultado_evaluado->evaluado, $SGD_Todas_Resultado_evaluado->evaluador, $id_proceso, $id_empresa, $dimen_ob->id);
                //echo $resultado_dim_obj." evaluado ".$SGD_Todas_Resultado_evaluado->evaluado." dim ".$dimen_ob->id ;echo "<br>";
                //resultado ponderado
                $ponderacion_dimension = RESULTADOS_PonderacionesPorDimensionID($dimen_ob->id);
                $html_resultados_objetivos .= '<td>' . round((($resultado_dim_obj * $ponderacion_dimension[0]->ponderacion) / 100), 1) . '</td>';
                $acumulador_notas_ponderadas_dimesion = $acumulador_notas_ponderadas_dimesion + (($resultado_dim_obj * $ponderacion_dimension[0]->ponderacion) / 100);
                $html_resultados_objetivos .= '<td>' . round($resultado_dim_obj, 1) . '</td>';
            }
            //EXCEL
            $rows = str_replace("{ROW_RESULTADOS_DIMENSIONES_OBJETIVOS}", $html_resultados_objetivos, $rows);
            $nota_objetivos = ObtieneNotaObjetivos($SGD_Todas_Resultado_evaluado->evaluado, $SGD_Todas_Resultado_evaluado->evaluador, $id_proceso, "");
            $nota_objetivos_ae = ObtieneNotaObjetivos($SGD_Todas_Resultado_evaluado->evaluado, $SGD_Todas_Resultado_evaluado->evaluado, $id_proceso, "");
            $rows = str_replace("{RESULTADO_PONDERADO_COMPETENCIAS}", round((($SGD_dim1 * 20) / 100), 1), $rows);
            $rows = str_replace("{RESULTADO_FINAL_PONDERADO_VV}", round(((round((($SGD_dim1 * 20) / 100), 1)) + $acumulador_notas_ponderadas_dimesion), 1), $rows);
            $rows = str_replace("{RutEvaluado}", $SGD_Todas_Resultado_evaluado->RutEvaluado, $rows);
            $rows = str_replace("{NombreEvaluado}", $SGD_Todas_Resultado_evaluado->NombreEvaluado, $rows);
            $rows = str_replace("{CargoEvaluado}", $SGD_Todas_Resultado_evaluado->CargoEvaluado, $rows);
            $rows = str_replace("{GerenciaEvaluado}", $SGD_Todas_Resultado_evaluado->GerenciaEvaluado, $rows);
            $rows = str_replace("{RESULTADO_FINAL_METAS}", round($nota_objetivos, 2), $rows);
            $rows = str_replace("{RESULTADO_FINAL_METAS_AE}", round($nota_objetivos_ae, 2), $rows);
            $rows = str_replace("{RESULTADO_FINAL_PONDERADO}", round(($nota_objetivos * 0.6) + ($promedio_Resultado * 0.4), 2), $rows);
            $rows = str_replace("{RESULTADO_FINAL_PONDERADO_AE}", round(($nota_objetivos_ae * 0.6) + ($SGD_Todas_Resultado_evaluado->nota_comp_ae * 0.4), 2), $rows);
            $rows = str_replace("{RutEvaluador}", $SGD_Todas_Resultado_evaluado->RutEvaluador, $rows);
            $rows = str_replace("{NombreEvaluador}", $SGD_Todas_Resultado_evaluado->NombreEvaluador, $rows);
            $rows = str_replace("{CargoEvaluador}", $SGD_Todas_Resultado_evaluado->CargoEvaluador, $rows);
            $rows = str_replace("{GerenciaEvaluador}", $SGD_Todas_Resultado_evaluado->GerenciaEvaluador, $rows);
            $rows = str_replace("{TipoEvaluacion}", $SGD_Todas_Resultado_evaluado->NombreSubPerfil, $rows);
            $rows = str_replace("{Perfil}", $SGD_Todas_Resultado_evaluado->Perfil, $rows);
            $rows = str_replace("{Proceso}", $SGD_Todas_Resultado_evaluado->Proceso, $rows);
            if ($excel == 1) {
                echo $rows;
            }
        }
    }
    $PRINCIPAL = str_replace("{ROW_LISTADO}", utf8_encode($rows), $PRINCIPAL);
    return ($PRINCIPAL);
}

function ActualizarnotasIdObjeto($id_objeto, $id_curso, $id_eval, $id_empresa)
{
    //echo  "<br>ActualizarnotasIdObjeto $id_objeto, $id_curso, id_eval $id_eval, $id_empresa";
    $totas_usuarios = ListaUsuariosIdObjetoEvaluacion($id_objeto, $id_empresa);
    foreach ($totas_usuarios as $unico) {
        //  echo $unico->rut."<br><br>";
        // id_pregunta
        $arr_asoc_preg_usr = busca_asociacion_preguntas_usuario($id_objeto, $id_eval, $unico->rut);
        // print_r($arr_asoc_preg_usr);
        if ($arr_asoc_preg_usr[0]->Prom <> '') {
            Actualiza_ObjFinalizado_cierre($unico->rut, $arr_asoc_preg_usr[0]->Prom, $id_objeto, $id_curso, $id_eval, $id_empresa);
        }
    }
    echo "<script type='text/javascript'>window.history.go(-1);</script>";
}

function EVALUACIONES_SubeImagenContenido($FILES, $extension_doc, $prefijo, $ruta)
{
    $ruta_con_archivo = $ruta . "/" . $prefijo . "." . $extension_doc;
    copy($FILES['imagen_contenido']['tmp_name'], $ruta_con_archivo);
    $nombre_imagen_video = $prefijo . "." . $extension_doc;
    $arreglo[0] = $ruta_con_archivo;//Ruta Completa
    $arreglo[1] = $prefijo . "." . $extension_doc;//Nombre del Archivo
    $arreglo[2] = $ruta . "/" . $prefijo;//Ruta del Objeto sin el index
    return ($arreglo);
}

function CreaPReguntasEvaluaciones($html, $id_evaluacion)
{

    $html = str_replace("{ID_EVAL}", $id_evaluacion, $html);
    $html = str_replace("{TOT_ALTER}", 0, $html);
    return ($html);
}

function CreaEditaPreguntasEvaluaciones($html, $idEval, $idPreg, $idSecc, $idGrupoAlter)
{
    $html = str_replace("{ID_EVAL}", $idEval, $html);
    $html = str_replace("{ID_PREGUNTA}", $idPreg, $html);
    $array_preg = BuscaPreguntaEnc_LB($idEval, $idPreg);
    //print_r($array_preg);
    $html = str_replace("{ID_PREGUNTA}", $idPreg, $html);
    $pregunta = $array_preg[0]->pregunta;
    $tipo = $array_preg[0]->tipo;
    $html = str_replace("{PREGUNTA}", utf8_encode($pregunta), $html);

    if ($tipo == "TEXT") {
        $sectionFirst = " checked='checked' ";
    }
    if ($tipo == "TEXTAREA") {
        $sectionTwo = " checked='checked' ";
    }
    if ($tipo == "NUMBER") {
        $sectionThree = " checked='checked' ";
    }
    if ($tipo == "SELMUL") {
        $sectionFour = " checked='checked' ";
    }
    if ($tipo == "SELMUL+OTRA") {
        $sectionFive = " checked='checked' ";
    }
    if ($tipo == "NIVEL") {
        $sectionSix = " checked='checked' ";
    }
    if ($tipo == "OPCMUL") {
        $sectionSeven = " checked='checked' ";
    }
    if ($tipo == "VF") {
        $sectionEight = " checked='checked' ";
    }
    if ($tipo == "SI_NO") {
        $sectionNine = " checked='checked' ";
    }
    if ($tipo == "SI_NO_BOTON") {
        $sectionTen = " checked='checked' ";
    }
    $list_secc = BuscaSeccionEncEval($idEval, $id_empresa);
    //print_r($list_secc);

    $option_secc = "";
    foreach ($list_secc as $unico) {
        $option_secc .= "<option value='" . $unico->id_seccion . "'>" . ($unico->nombre) . "</option>";
    }
    $html = str_replace("{OPCIONES_SECCIONES}", utf8_encode($option_secc), $html);

    $html = str_replace("{sectionFirst}", $sectionFirst, $html);
    $html = str_replace("{sectionTwo}", $sectionTwo, $html);
    $html = str_replace("{sectionThree}", $sectionThree, $html);
    $html = str_replace("{sectionFour}", $sectionFour, $html);
    $html = str_replace("{sectionFive}", $sectionFive, $html);

    $html = str_replace("{sectionSix}", $sectionSix, $html);
    $html = str_replace("{sectionSeven}", $sectionSeven, $html);
    $html = str_replace("{sectionEight}", $sectionEight, $html);
    $html = str_replace("{sectionNine}", $sectionNine, $html);
    $html = str_replace("{sectionTen}", $sectionTen, $html);

    $html = str_replace("{ALT1}", utf8_encode($array_preg[0]->alt1), $html);
    $html = str_replace("{ALT2}", utf8_encode($array_preg[0]->alt2), $html);
    $html = str_replace("{ALT3}", utf8_encode($array_preg[0]->alt3), $html);
    $html = str_replace("{ALT4}", utf8_encode($array_preg[0]->alt4), $html);
    $html = str_replace("{ALT5}", utf8_encode($array_preg[0]->alt5), $html);

    $html = str_replace("{ALT6}", utf8_encode($array_preg[0]->alt6), $html);
    $html = str_replace("{ALT7}", utf8_encode($array_preg[0]->alt7), $html);
    $html = str_replace("{ALT8}", utf8_encode($array_preg[0]->alt8), $html);
    $html = str_replace("{ALT9}", utf8_encode($array_preg[0]->alt9), $html);
    $html = str_replace("{ALT10}", utf8_encode($array_preg[0]->alt10), $html);

    $html = str_replace("{ALT11}", utf8_encode($array_preg[0]->alt11), $html);
    $html = str_replace("{ALT12}", utf8_encode($array_preg[0]->alt12), $html);
    $html = str_replace("{ALT13}", utf8_encode($array_preg[0]->alt13), $html);
    $html = str_replace("{ALT14}", utf8_encode($array_preg[0]->alt14), $html);
    $html = str_replace("{ALT15}", utf8_encode($array_preg[0]->alt15), $html);

    $html = str_replace("{ALT16}", utf8_encode($array_preg[0]->alt16), $html);
    $html = str_replace("{ALT17}", utf8_encode($array_preg[0]->alt17), $html);
    $html = str_replace("{ALT18}", utf8_encode($array_preg[0]->alt18), $html);
    $html = str_replace("{ALT19}", utf8_encode($array_preg[0]->alt19), $html);
    $html = str_replace("{ALT20}", utf8_encode($array_preg[0]->alt20), $html);
    $html = str_replace("{ID_SECCION}", $idSecc, $html);
    //echo "<br>obligatoria <br>".$array_preg[0]->obligatoria."<br>";
    if ($idPreg == '') {
        $html = str_replace("{obligatoria}", "checked='checked'", $html);
    } else {
        if ($array_preg[0]->obligatoria == "OBLIGATORIA") {
            $checkOb = "checked='checked'";
            $checkOp = "";
        } else {
            $checkOb = "";
            $checkOp = "checked='checked'";
        }
        $html = str_replace("{obligatoria}", $checkOb, $html);
        $html = str_replace("{opcional}", $checkOp, $html);
    }
    if ($tipo == "SELMUL" or $tipo == "SELMUL+OTRA") {
        $abrir_div = '
            $(document).ready(function() {
              $(".sectionFour").show();
            });
            ';
    }
    if ($tipo == "NIVEL") {
        $abrir_div = '
            $(document).ready(function() {
              $(".sectionSix").show();
            });
            ';
    }
    $html = str_replace("{JAVASCRIPT_DIV}", $abrir_div, $html);

    //print_r($array_preg);
    return ($html);
}

function CreaEditaSeccionesEvaluaciones($html, $idEval, $idSecc, $idGrupoAlter)
{
    $html = str_replace("{ID_EVAL}", $idEval, $html);
    $html = str_replace("{ID_SECCION}", $idSecc, $html);
    $array_secc = BuscaSeccionEnc_LB($idEval, $idSecc);

    $html = str_replace("{ID_SECCION}", $idSecc, $html);
    $nombre = $array_secc[0]->nombre;
    $descripcion = $array_secc[0]->descripcion;
    $html = str_replace("{SECCION}", utf8_encode($nombre), $html);
    $html = str_replace("{DESCRIPCION}", utf8_encode($descripcion), $html);


    return ($html);
}

function SuboArchivoObjetos($FILES, $extension_archivo, $prefijo, $ruta)
{
    if ($extension_archivo == "zip") {
        //Primero copio el archivo a la ruta que debe ser
        //$destino =  "../schoolv02/objetos/".$prefijo.".jpg";
        $ruta_con_archivo = $ruta . "/" . $prefijo . "." . $extension_archivo;
        copy($FILES['archivo']['tmp_name'], $ruta_con_archivo);
        //Ahora que el archivo ZIP ya estÃ¡ guardado, se debe descomprimir
        $zip = new ZipArchive;
        if ($zip->open($ruta_con_archivo) === TRUE) {
            $zip->extractTo($ruta . "/" . $prefijo);
            $zip->close();
            echo 'ok';
        } else {
            echo 'failed';
        }
    } else {
        $ruta_con_archivo = $ruta . "/" . $prefijo . "." . $extension_archivo;
        //echo $ruta_con_archivo;exit;
        copy($FILES['archivo']['tmp_name'], $ruta_con_archivo);
        $nombre_imagen_thum = $_SESSION["id_empresa"] . "_thum_" . $prefijo . "." . $extension_archivo;
        RedimensionarImagen($ruta_con_archivo, $nombre_imagen_thum, $extension_archivo);
        RedimensionarImagenPortada($ruta_con_archivo, $prefijo . "." . $extension_archivo, $extension_archivo);
    }
    //Devuelvol un arreglo, con datos del archivo subido
    $arreglo[0] = $ruta_con_archivo;//Ruta Completa
    $arreglo[1] = $prefijo . "." . $extension_archivo;//Nombre del Archivo
    $arreglo[2] = $ruta . "/" . $prefijo;//Ruta del Objeto sin el index
    $arreglo[3] = $nombre_imagen_thum;
    return ($arreglo);
    exit;
}

function ListaColaboradoresPorImparticionesSesionesResumen($PRINCIPAL, $id_imparticion, $id_empresa, $excel)
{
    $total_sesiones = InsSesionesImparticion($id_empresa, $id_imparticion);
    $datos_imparticion = DatosInscripcionImparticionesV2($id_imparticion, $id_empresa);
    foreach ($total_sesiones as $ses) {
        $row .= file_get_contents("views/capacitacion/imparticion/row_encabezado_sesiones.html");
        $row = str_replace("{FECHA_SESION}", ($ses->fecha), $row);
    }
    //traigo ellistado de usuarios desde la tabla tbl_inscripcion_usuarios
    $total_usuarios_por_inscripcion = IMPARTICION_UsuariosPorInscripcionConDatos($id_imparticion, $id_empresa);
    foreach ($total_usuarios_por_inscripcion as $usu) {
        if ($excel == 1) {
            $row_listado_colaboradores .= file_get_contents("views/capacitacion/imparticion/row_colaboradores_sesiones_excel.html");
        } else {
            $row_listado_colaboradores .= file_get_contents("views/capacitacion/imparticion/row_colaboradores_sesiones_resumen.html");
        }
        $row_listado_colaboradores = str_replace("{NOMBRE}", ($usu->rut), $row_listado_colaboradores);
        $row_listado_colaboradores = str_replace("{NOMBRE_COMPLETO}", $usu->nombre_completo, $row_listado_colaboradores);
        $row_listado_colaboradores = str_replace("{CAMPO1}", $usu->campo1, $row_listado_colaboradores);
        $row_listado_colaboradores = str_replace("{CAMPO2}", $usu->campo2, $row_listado_colaboradores);
        $row_listado_colaboradores = str_replace("{CAMPO3}", $usu->campo3, $row_listado_colaboradores);
        $row_listado_colaboradores = str_replace("{RUT_COMPLETO}", $usu->rut_completo, $row_listado_colaboradores);
        $row_listado_colaboradores = str_replace("{RUT_COLABORADOR}", $usu->rut, $row_listado_colaboradores);
        $row_listado_colaboradores = str_replace("{CARGO_COLABORADOR}", $usu->cargo_colaborador, $row_listado_colaboradores);
        $row_listado_colaboradores = str_replace("{ID_IMPARTICION}", $id_imparticion, $row_listado_colaboradores);
        //$avance_actual=CalculaAsistenciaEnBaseASesiones($usu->rut, $id_imparticion, $id_empresa);
        $existe_en_cierre = VerificaEnTablaCierreCursoEmpresRutInscripcion($datos_imparticion[0]->id_curso, $usu->rut, $id_empresa, $id_imparticion);
        //$row_listado_colaboradores = str_replace("{AVANCE_ACTUAL}",$avance_actual,$row_listado_colaboradores);
        $row_listado_colaboradores = str_replace("{AVANCE_ACTUAL}", $existe_en_cierre[0]->porcentaje_asistencia, $row_listado_colaboradores);
        $row_listado_colaboradores = str_replace("{NOTA_ACTUAL}", $existe_en_cierre[0]->nota, $row_listado_colaboradores);
        $listado_sesiones_por_colaborador = "";
        foreach ($total_sesiones as $ses) {
            if ($excel == 1) {
                $listado_sesiones_por_colaborador .= file_get_contents("views/capacitacion/imparticion/row_colaboradores_sesiones_check_box_excel.html");
            } else {
                $listado_sesiones_por_colaborador .= file_get_contents("views/capacitacion/imparticion/row_colaboradores_sesiones_check_box.html");
            }
            $listado_sesiones_por_colaborador = str_replace("{RUT_COLABORADOR}", $usu->rut, $listado_sesiones_por_colaborador);
            $listado_sesiones_por_colaborador = str_replace("{ID_SESION}", $ses->id, $listado_sesiones_por_colaborador);
            $listado_sesiones_por_colaborador = str_replace("{ID_IMPARTICION}", $id_imparticion, $listado_sesiones_por_colaborador);
            //Veo si para esta sesion, el usuario esta chequeado
            $usuario_chequeado = TraigoRegistrosPorSesionDeCheckinPorUsuario($id_imparticion, $ses->id, $id_empresa, $usu->rut);
            if ($usuario_chequeado) {
                $listado_sesiones_por_colaborador = str_replace("{CHECKED}", "checked", $listado_sesiones_por_colaborador);
                $listado_sesiones_por_colaborador = str_replace("{SI_O_NO}", "X", $listado_sesiones_por_colaborador);
            } else {
                $listado_sesiones_por_colaborador = str_replace("{CHECKED}", "", $listado_sesiones_por_colaborador);
                $listado_sesiones_por_colaborador = str_replace("{SI_O_NO}", "", $listado_sesiones_por_colaborador);
            }
        }
        $row_listado_colaboradores = str_replace("{ROW_SESIONES_POR_COLABORADOR}", ($listado_sesiones_por_colaborador), $row_listado_colaboradores);
    }
    $PRINCIPAL = str_replace("{ROW_SESIONES}", ($row), $PRINCIPAL);
    $PRINCIPAL = str_replace("{ROW_LISTADO_COLABORADORES}", utf8_encode($row_listado_colaboradores), $PRINCIPAL);
    return ($PRINCIPAL);
}

function colocaPorcentajeAsistenciaPorImparticion($html, $rut, $id_empresa, $id_curso, $id_imparticion)
{
    $existe_en_cierre = VerificaEnTablaCierreCursoEmpresRutInscripcion($id_curso, $rut, $id_empresa, $id_imparticion);
    $html = str_replace("{FECHA_SESION}", ($ses->fecha), $html);
    return ($html);
}

function TransformaHoraASegundos($tiempo)
{
    $arreglo_hora = explode(".", $tiempo);
    if (count($arreglo_hora) == 2) {
        $segundos_hora = $arreglo_hora[0] * 3600;
        $segundos_minutos = $arreglo_hora[1] * 600;
        return ($segundos_hora + $segundos_minutos);
    } else {
        $arreglo_hora = explode(",", $arreglo_hora);
        if (count($arreglo_hora) == 2) {
            $segundos_hora = $arreglo_hora[0] * 3600;
            $segundos_minutos = $arreglo_hora[1] * 600;
            return ($segundos_hora + $segundos_minutos);
        } else {
            $segundos_hora = $tiempo * 3600;
            return ($segundos_hora);
        }
    }
}

function CalculaAsistenciaEnBaseASesiones($rut, $id_imparticion, $id_empresa)
{
    $total_sesiones = InsSesionesImparticion($id_empresa, $id_imparticion);
    $asistencia = 0;
    foreach ($total_sesiones as $ses) {
        $usuario_chequeado = TraigoRegistrosPorSesionDeCheckinPorUsuario($id_imparticion, $ses->id, $id_empresa, $rut);
        if ($usuario_chequeado) {
            $asistencia++;
        }
    }
    $porcentaje_avance = ($asistencia * 100) / count($total_sesiones);
    return ($porcentaje_avance);
}

function ExportaAvanceEmbajadores($id_empresa)
{
    $datos = DatosAvanceEmbajadores();
    $entorno .= file_get_contents("views/reportes/embajadores/entorno_excel.html");
    foreach ($datos as $dat) {
        $row .= file_get_contents("views/reportes/embajadores/row_excel.html");
        $row = str_replace("{rut}", $dat->rut, $row);
        $row = str_replace("{nombre_embajador}", $dat->nombre_embajador, $row);
        $row = str_replace("{cargo_embajador}", $dat->cargo_embajador, $row);
        $row = str_replace("{gerencia_embajador}", $dat->gerencia_embajador, $row);
        $row = str_replace("{r2}", $dat->r2, $row);
        $row = str_replace("{nombre_r2}", $dat->nombre_r2, $row);
        $row = str_replace("{tutor}", $dat->tutor, $row);
        $row = str_replace("{nombre_tutor}", $dat->nombre_tutor, $row);
        $row = str_replace("{fecha}", $dat->fecha, $row);
        $row = str_replace("{nombrePlanSeleccionado}", $dat->nombrePlanSeleccionado, $row);
        $row = str_replace("{id_plan}", $dat->id_plan, $row);
        $row = str_replace("{factor_exito}", $dat->factor_exito, $row);
        $row = str_replace("{ambito}", $dat->ambito, $row);
        $row = str_replace("{periodicidad}", $dat->periodicidad, $row);
        $row = str_replace("{nombre_kpi}", $dat->nombre_kpi, $row);
        $row = str_replace("{kpi_inicial}", $dat->kpi_inicial, $row);
        $row = str_replace("{kpi_esperado}", $dat->kpi_esperado, $row);
        $row = str_replace("{NumTareas}", $dat->NumTareas, $row);
//
        $avance_embajadores = ObtenerPorcentajeAvanceSemana3($dat->rut, $id_empresa, $dat->tutor, $dat->r2);
        $avance_validaciones_tutor_etapas = EstadoAvanceValidacionesEmbajadores($dat->tutor, $dat->r2, $dat->rut, $id_empresa);
        $avance_embajadores_tareas = EstadoIngresoTareas($dat->rut, $dat->r2, $dat->tutor, $id_empresa);
        $avance_validacion_tutor_tareas = EstadoIngresoTareasValidacion($dat->rut, $dat->r2, $dat->tutor, $id_empresa);
        $row = str_replace("{AvanceEmbajadorEtapas}", $avance_embajadores, $row);
        $row = str_replace("{AvanceValidacionTutorEtapas}", $avance_validaciones_tutor_etapas, $row);
        $row = str_replace("{AvanceEmbajadorTareas}", $avance_embajadores_tareas, $row);
        $row = str_replace("{AvanceValidacionTutorTareas}", $avance_validacion_tutor_tareas, $row);
        $row = str_replace("{AvanceTotal}", round(($avance_embajadores * 40 / 100) + ($avance_embajadores_tareas * 60 / 100)), $row);
    }
    $entorno = str_replace("{ROW_LISTADO}", (($row)), $entorno);
    echo $entorno;
}

function ColocaDatosPorUsuarioDatos($PRINCIPAL, $usuario, $id_empresa)
{
    $data = ConsultaDataPorUsuario($usuario, $id_empresa);
    foreach ($data as $dat) {
        $html .= file_get_contents("views/reportes/capacitacion/row_entorno_capacitacion_usuarios_con_datos.html");
        $html = str_replace("{NOMBRE_USUARIO}", $dat->nombre, $html);
        $html = str_replace("{PROGRAMA}", $dat->programa, $html);
        $html = str_replace("{CURSO}", $dat->curso, $html);
        $html = str_replace("{ASISTENCIA}", $dat->asistencia, $html);
        $html = str_replace("{AGNO}", $dat->anno_termino, $html);
        $html = str_replace("{MES}", $dat->mes_termino, $html);
        $html = str_replace("{TITPO}", $dat->status, $html);
        $html = str_replace("{HORAS}", $dat->horas, $html);
    }
    $PRINCIPAL = str_replace("{ROW_LISTADO}", (utf8_encode($html)), $PRINCIPAL);
    return ($PRINCIPAL);
}

function ColocaDatosPorEjecutivo($PRINCIPAL, $ejecutivo, $fecha_inicio, $fecha_termino, $id_empresa)
{
    $data = ConsultaDataPorEjecutivo($ejecutivo, $fecha_inicio, $fecha_termino, $id_empresa);
    //echo "$ejecutivo, $id_empresa";
    //print_r($data);
    foreach ($data as $dat) {
        $html .= file_get_contents("views/reportes/capacitacion/row_entorno_capacitacion_ejecutivos_con_datos.html");
        $html = str_replace("{ID_INSCRIPCION}", $dat->id_inscripcion, $html);
        $html = str_replace("{ID_PROGRAMA}", $dat->id_programa, $html);
        $html = str_replace("{PROGRAMA}", $dat->programa, $html);
        $html = str_replace("{METODOLOGIA}", $dat->status, $html);
        if ($dat->status == "Elearning") {
            $fecha_inicio = $dat->fecha_inicio_elearning;
            $fecha_termino = $dat->fecha_termino_elearning;
        } else {
            $fecha_inicio = $dat->fecha_inicio;
            $fecha_termino = $dat->fecha_termino;
        }
        $html = str_replace("{ID_CURSO}", $dat->id_curso, $html);
        $html = str_replace("{CURSO}", $dat->curso, $html);
        $html = str_replace("{INSCRITOS}", $dat->inscritos, $html);
        $html = str_replace("{ASISTENTES}", $dat->asistentes, $html);
        $html = str_replace("{INCOMPLETOS}", $dat->incompletos, $html);
        $html = str_replace("{INASISTENTES}", $dat->inasistentes, $html);
        $html = str_replace("{FECHA_INICIO}", $fecha_inicio, $html);
        $html = str_replace("{FECHA_TERMINO}", $fecha_termino, $html);
        $html = str_replace("{NOTA_ENC}", "", $html);
    }
    $PRINCIPAL = str_replace("{ROW_LISTADO}", (utf8_encode($html)), $PRINCIPAL);
    return ($PRINCIPAL);
}

function ColocaDatosPorPersona($PRINCIPAL, $rut, $fecha_inicio, $fecha_termino, $id_empresa)
{
    $data = ConsultaDataPorPersona($rut, $fecha_inicio, $fecha_termino, $id_empresa);
    //echo "$ejecutivo, $id_empresa";
    foreach ($data as $dat) {
        $html .= file_get_contents("views/reportes/capacitacion/row_entorno_capacitacion_personas_con_datos.html");
        $html = str_replace("{RUT}", $dat->nombre_ejecutivo, $html);
        $html = str_replace("{ID_PROGRAMA}", $dat->id_programa, $html);
        $html = str_replace("{PROGRAMA}", $dat->programa, $html);
        $html = str_replace("{METODOLOGIA}", $dat->status, $html);
        if ($dat->status == "Elearning") {
            $fecha_inicio = $dat->fecha_inicio_elearning;
            $fecha_termino = $dat->fecha_termino_elearning;
        } else {
            $fecha_inicio = $dat->fecha_inicio;
            $fecha_termino = $dat->fecha_termino;
        }
        $html = str_replace("{ID_CURSO}", $dat->id_curso, $html);
        $html = str_replace("{CURSO}", $dat->curso, $html);
        $html = str_replace("{ASISTENCIA}", $dat->asistencia, $html);
        $html = str_replace("{FECHA_INICIO}", $fecha_inicio, $html);
        $html = str_replace("{FECHA_TERMINO}", $fecha_termino, $html);
    }
    $PRINCIPAL = str_replace("{ROW_LISTADO}", (utf8_encode($html)), $PRINCIPAL);
    return ($PRINCIPAL);
}

function ColocaDatosPorPersonaweb($PRINCIPAL, $rut, $fecha_inicio, $fecha_termino, $id_empresa)
{
    $data = ConsultaDataPorPersona($rut, $fecha_inicio, $fecha_termino, $id_empresa);
    //print_r($data);
    //echo "$ejecutivo, $id_empresa";
    foreach ($data as $dat) {
        $html .= file_get_contents("views/basepersonas/row_entorno_capacitacion_personas_con_datos.html");
        $html = str_replace("{RUT}", $dat->nombre_ejecutivo, $html);
        $html = str_replace("{ID_PROGRAMA}", $dat->id_programa, $html);
        $html = str_replace("{PROGRAMA}", $dat->programa, $html);
        $html = str_replace("{METODOLOGIA}", $dat->status, $html);
        if ($dat->status == "Elearning") {
            $fecha_inicio = $dat->fecha_inicio_elearning;
            $fecha_termino = $dat->fecha_termino_elearning;
        } else {
            $fecha_inicio = $dat->fecha_inicio;
            $fecha_termino = $dat->fecha_termino;
        }
        $html = str_replace("{ID_CURSO}", $dat->id_curso, $html);
        $html = str_replace("{CURSO}", $dat->curso, $html);
        $html = str_replace("{ASISTENCIA}", $dat->asistencia, $html);
        $html = str_replace("{FECHA_INICIO}", $fecha_inicio, $html);
        $html = str_replace("{FECHA_TERMINO}", $fecha_termino, $html);
    }
    $PRINCIPAL = str_replace("{ROW_LISTADO}", (utf8_encode($html)), $PRINCIPAL);
    return ($PRINCIPAL);
}

function ColocaFiltrosSGDC1C2C3($PRINCIPAL, $id_empresa, $arreglo_post)
{
    $datos_empresa = DatosEmpresa($id_empresa);
    $campo1 = $datos_empresa[0]->campo1;
    $campo2 = $datos_empresa[0]->campo2;
    $campo3 = $datos_empresa[0]->campo3;
    $dato_campo1 = $datos_empresa[0]->campo1;
    $dato_campo2 = $datos_empresa[0]->campo2;
    $dato_campo3 = $datos_empresa[0]->campo3;
    //campo1
    $valor1 = TRaeDistincTablaUsuario($id_empresa, $campo1);
    $option_valor1 = "";
    foreach ($valor1 as $valor) {
        if (utf8_decode($arreglo_post["filtro_campo1"]) == $valor->valor) {
            $option_valor1 .= "<option value='" . $valor->valor . "' selected>" . $valor->valor . "</option>";
        } else {
            $option_valor1 .= "<option value='" . $valor->valor . "'>" . $valor->valor . "</option>";
        }
    }
    $PRINCIPAL = str_replace("{OPTIONS_CAMPO1}", utf8_encode($option_valor1), $PRINCIPAL);
    $valor2 = TRaeDistincTablaUsuario($id_empresa, $campo2);
    $option_valor2 = "";
    foreach ($valor2 as $valor) {
        if (utf8_decode($arreglo_post["filtro_campo2"]) == $valor->valor) {
            $option_valor2 .= "<option value='" . $valor->valor . "' selected>" . $valor->valor . "</option>";
        } else {
            $option_valor2 .= "<option value='" . $valor->valor . "'>" . $valor->valor . "</option>";
        }
    }
    $PRINCIPAL = str_replace("{OPTIONS_CAMPO2}", utf8_encode($option_valor2), $PRINCIPAL);
    $valor3 = TRaeDistincTablaUsuario($id_empresa, $campo3);
    $option_valor3 = "";
    foreach ($valor3 as $valor) {
        if (utf8_decode($arreglo_post["filtro_campo3"]) == $valor->valor) {
            $option_valor3 .= "<option value='" . $valor->valor . "' selected>" . $valor->valor . "</option>";
        } else {
            $option_valor3 .= "<option value='" . $valor->valor . "'>" . $valor->valor . "</option>";
        }
    }
    $PRINCIPAL = str_replace("{OPTIONS_CAMPO3}", utf8_encode($option_valor3), $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALUE_CAMPO1}", utf8_encode($dato_campo1), $PRINCIPAL);
    $PRINCIPAL = str_replace("{FILTRO_CAMPO1}", utf8_encode($campo1), $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALUE_CAMPO2}", utf8_encode($dato_campo2), $PRINCIPAL);
    $PRINCIPAL = str_replace("{FILTRO_CAMPO2}", utf8_encode($campo2), $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALUE_CAMPO3}", utf8_encode($dato_campo3), $PRINCIPAL);
    $PRINCIPAL = str_replace("{FILTRO_CAMPO3}", utf8_encode($campo3), $PRINCIPAL);
    return ($PRINCIPAL);
}

function Lms_reporte_MuestraInformeEncPreguntaPorRelator($PRINCIPAL, $id_empresa, $arreglo_objetos, $criterio, $valor, $excel, $relator, $id_encuesta_relator, $nombre_relator)
{
    $enc_template = busca_enc_satis_template_admin($id_empresa);
    $primer_arreglo_objeto = $arreglo_objetos[0]->id;
    $id_encuesta = Lms_busca_encuesta_dada_objeto($primer_arreglo_objeto, $id_empresa);
    $dimensiones_por_encuesta = ENC_TraigoDimensionesPorEncuesta($id_empresa, $id_encuesta[0]->id_encuesta);
    $id_curso = $arreglo_objetos[0]->id_curso;
    $id_encuesta[0]->id_encuesta = $id_encuesta_relator;
    if ($id_encuesta_relator == "13") {
        //$preguntas=EncTraigoPreguntasParaRelatores();
        $dimensiones_por_encuesta = ENC_TraigoDimensionesPorEncuestaEnc13Relatores();
    } else if ($id_encuesta_relator == "6") {
        //$preguntas=EncTraigoPreguntasParaRelatoresEnc6();
        $dimensiones_por_encuesta = ENC_TraigoDimensionesPorEncuestaEnc6Relatores();
    }
    //print_r($id_encuesta);
    //print_r($dimensiones_por_encuesta);
    $cuenta_encuestas = ENC_CuentaParticipantesPorEncuesta($id_empresa, $arreglo_objetos[0]->id, $id_encuesta[0]->id_encuesta);
    $cuenta_respuestas = count($cuenta_encuestas);
    //echo "cuenta_respuestas $cuenta_respuestas";
    //print_r($cuenta_encuestas);
    if ($excel == 1) {
        $html .= file_get_contents("views/reportes/enc_satisfaccion/informe_entorno_enc_informe_preg_excel.html");
    } else {
        $html .= file_get_contents("views/reportes/enc_satisfaccion/informe_entorno_enc_informe_preg_relator.html");
    }
    $html = str_replace("{NOMBRE_RELATOR}", $nombre_relator, $html);
    $arreglo_post_objeto = $arreglo_objetos;
    $array_para_enviar_via_url_objetos = serialize($arreglo_post_objeto);
    $array_para_enviar_via_url_objetos = urlencode($array_para_enviar_via_url_objetos);
    $html = str_replace("{ARREGLO_OBJETO}", $array_para_enviar_via_url_objetos, $html);
    $html = str_replace("{VALOR}", $valor, $html);
    //print_r($dimensiones_por_encuesta);
    foreach ($dimensiones_por_encuesta as $dimen) {
        $cuentaOpciones = CuentaOpcionesEncSat($id_empresa, $dimen->iddimension);
        $preguntas_por_dimension = ENC_TraigoPreguntaDadaDimenion($dimen->iddimension);
        if ($excel == 1) {
            //$htmlTi=file_get_contents("views/reportes/enc_satisfaccion/informe_titulo_".$cuentaOpciones[0]->cuenta."dim_excel.html");
        } else {
            //$htmlTi=file_get_contents("views/reportes/enc_satisfaccion/informe_titulo_".$cuentaOpciones[0]->cuenta."dim.html");
        }
        $acumulador_cuenta1 = 0;
        $acumulador_cuenta2 = 0;
        $acumulador_cuenta3 = 0;
        $acumulador_cuenta4 = 0;
        $acumulador_cuenta5 = 0;
        $acumulador_cuenta6 = 0;
        $acumulador_cuenta7 = 0;
        $acumulador_cuenta = 0;
        //busca rangos
        //print_r($preguntas_por_dimension);
        foreach ($preguntas_por_dimension as $preg) {
            //$promedio_por_preg=ENC_CuentaDeRespuestasPorPregunta_7opciones_CriterioCH($id_empresa, $id_encuesta[0]->id_encuesta, $preg->idpregunta, $arreglo_objetos, $criterio);
            $promedio_por_preg = RELATOR_ENC_CuentaDeRespuestasPorPregunta_7opciones_CriterioCH($id_empresa, $id_encuesta[0]->id_encuesta, $preg->idpregunta, $arreglo_objetos, $criterio, $relator);
            //print_r($promedio_por_preg);
            //exit();
            $acumulador_notas = $acumulador_notas + $promedio_por_preg[0]->promedio_pregunta;
            ++$numpreg;
            $acumulador_cuenta1 = $promedio_por_preg[0]->cuenta1;
            $acumulador_cuenta2 = $promedio_por_preg[0]->cuenta2;
            $acumulador_cuenta3 = $promedio_por_preg[0]->cuenta3;
            $acumulador_cuenta4 = $promedio_por_preg[0]->cuenta4;
            $acumulador_cuenta5 = $promedio_por_preg[0]->cuenta5;
            $acumulador_cuenta6 = $promedio_por_preg[0]->cuenta6;
            $acumulador_cuenta7 = $promedio_por_preg[0]->cuenta7;
            $acumulador_cuenta = $promedio_por_preg[0]->cuentaPreg;
            //    echo "<br>$acumulador_cuenta7 $acumulador_cuenta";
            //PORCENTAJE
            $promedio_enc_sat[0] = round(100 * $acumulador_cuenta1 / $acumulador_cuenta, 1);
            $promedio_enc_sat[1] = round(100 * $acumulador_cuenta2 / $acumulador_cuenta, 1);
            $promedio_enc_sat[2] = round(100 * $acumulador_cuenta3 / $acumulador_cuenta, 1);
            $promedio_enc_sat[3] = round(100 * $acumulador_cuenta4 / $acumulador_cuenta, 1);
            $promedio_enc_sat[4] = round(100 * $acumulador_cuenta5 / $acumulador_cuenta, 1);
            $promedio_enc_sat[5] = round(100 * $acumulador_cuenta6 / $acumulador_cuenta, 1);
            $promedio_enc_sat[6] = round(100 * $acumulador_cuenta7 / $acumulador_cuenta, 1);
            $cuentaOpciones = CuentaOpcionesEncSat($id_empresa, $dimen->iddimension);
            if ($excel == 1) {
                $template_row = file_get_contents("views/reportes/enc_satisfaccion/informe_row_pregunta_" . $cuentaOpciones[0]->cuenta . "dim_excel.html");
            } else {
                $template_row = file_get_contents("views/reportes/enc_satisfaccion/informe_row_pregunta_" . $cuentaOpciones[0]->cuenta . "dim.html");
            }
            $row .= $template_row;
            if ($excel == 1) {
            } else {
                $row = str_replace("{GRAFICO}", file_get_contents("views/reportes/enc_satisfaccion/informe_enc_grafico_" . $enc_template[0]->template_admin . ".html"), $row);
            }
            $row = str_replace("{CODIGO_GRAFICO}", ($preg->iddimension), $row);
            $row = str_replace("{NOMBRE_PREGUNTA}", ($preg->pregunta), $row);
            //Por cada dimension traigo las preguntas
            $row = str_replace("{CUENTA1}", ($promedio_enc_sat[0]), $row);
            $row = str_replace("{CUENTA2}", ($promedio_enc_sat[1]), $row);
            $row = str_replace("{CUENTA3}", ($promedio_enc_sat[2]), $row);
            $row = str_replace("{CUENTA4}", ($promedio_enc_sat[3]), $row);
            $row = str_replace("{CUENTA5}", ($promedio_enc_sat[4]), $row);
            $row = str_replace("{CUENTA6}", ($promedio_enc_sat[5]), $row);
            $row = str_replace("{CUENTA7}", ($promedio_enc_sat[6]), $row);
            $row = str_replace("{PROMEDIO}", ($nota), $row);
        }
        $promedio = $promedio_enc_sat[0] * 1 + $promedio_enc_sat[1] * 2 + $promedio_enc_sat[2] * 3 + $promedio_enc_sat[3] * 4 + $promedio_enc_sat[4] * 5 + $promedio_enc_sat[5] * 6 + $promedio_enc_sat[6] * 7;
        $row = str_replace("{PROMEDIO}", ($promedio / 100), $row);
        $row = str_replace("{CUENTAR}", round($promedio_enc_sat[0] + $promedio_enc_sat[1] + $promedio_enc_sat[2] + $promedio_enc_sat[3] + $promedio_enc_sat[4], 2), $row);
        $row = str_replace("{CUENTAV}", round($promedio_enc_sat[5] + $promedio_enc_sat[6] + $promedio_enc_sat[7], 2), $row);
    }
    $html = str_replace("{TITULO_PREGUNTAS}", ($htmlTi), $html);
    $html = str_replace("{LISTADO_PREGUNTAS}", ($row), $html);
    $html = str_replace("{SOBRETITULO}", $cuenta_respuestas, $html);
    $datos_decurso = Datos_curso($id_curso);
    $html = str_replace("{NOMBRECURSO}", $datos_decurso[0]->nombre, $html);
    $html = str_replace("{CODIGOIMPARTICION}", $datos_decurso[0]->id, $html);
    $html = str_replace("{FECHAIMPARTICION}", $datos_decurso[0]->fecha_inicio, $html);
    if ($excel == 1) {
        $PRINCIPAL = utf8_encode($html);
    } else {
        //$PRINCIPAL = str_replace("{BLOQUE_ENCUESTA_SATISFACCION_PREGUNTA}",utf8_encode($html),$PRINCIPAL);
    }
    return (utf8_encode($html));
}

function Lms_reporte_MuestraInformePorRelatores($PRINCIPAL, $id_empresa, $arreglo_objetos, $arreglo_post, $valor, $excel)
{
    $enc_template = busca_enc_satis_template_admin($id_empresa);
    $primer_arreglo_objeto = $arreglo_objetos[0]->id;
    $id_encuesta = Lms_busca_encuesta_dada_objeto($primer_arreglo_objeto, $id_empresa);
    $dimensiones_por_encuesta = ENC_TraigoDimensionesPorEncuesta($id_empresa, $id_encuesta[0]->id_encuesta);
    $id_encuesta = $id_encuesta[0]->id_encuesta;
    //echo "id encuesta $id_encuesta;";
    if ($id_encuesta == "13") {
        $preguntas = EncTraigoPreguntasParaRelatores();
    } else if ($id_encuesta == "6") {
        $preguntas = EncTraigoPreguntasParaRelatoresEnc6();
    }
    //Primero traigo los relatores por cada Imparticion, desde la tabla de rel sesiones
    $relatores = DistinctRelatoresPorImparticion($id_empresa, $arreglo_post["imparticion"]);
    foreach ($relatores as $rel) {
        $acumulador_de_bloques_por_pregunta_por_relator .= Lms_reporte_MuestraInformeEncPreguntaPorRelator($PRINCIPAL, $id_empresa, $arreglo_objetos, "", "", $excel, $rel->relator, $id_encuesta, $rel->nombre_completo);
        $acumulador_de_bloques_por_pregunta_por_relator .= "<br><br>";
    }
    $PRINCIPAL = str_replace("{BLOQUE_ENCUESTA_SATISFACCION_POR_RELATOR}", $acumulador_de_bloques_por_pregunta_por_relator, $PRINCIPAL);
    return ($PRINCIPAL);
}

function ListaSesionesPorImparticiones($PRINCIPAL, $id_imparticion, $Empresa)
{
    //$Incripciones=TraeImparticionEmpresa($id_curso,$Empresa);
    $Incripciones = FechaInicioTerminoImparticionPorEmpresa($id_imparticion, $Empresa);
    $rows_ = "";
    $rows1_ = "";
    foreach ($Incripciones as $unico) {
        $rows_ = file_get_contents("views/capacitacion/imparticion/row_listado_sesiones.html");
        $rows_ = str_replace("{CODIGOINCRIPCION}", $unico->codigo_inscripcion, $rows_);
        $rows_ = str_replace("{ID_INSCRIPCION_ENCODEADO}", Encodear3($unico->codigo_inscripcion), $rows_);
        if ($unico->id_curso) {
            //    $rows_ = str_replace("{TIPO}","CURSO PRESENCIAL",$rows_);
            //    $rows_ = str_replace("{PARTICIPANTES}","<a href='?sw=DescargaPresencialImparticion&ci=".encodear3($unico->codigo_inscripcion)."' title='Descargar Participantes a Excel'><i class='fa fa-cloud-download'></i</a>",$rows_);
        } else {
            //    $rows_ = str_replace("{TIPO}","MALLA",$rows_);
            //    $rows_ = str_replace("{PARTICIPANTES}","<a href='?sw=DescargaMallaImparticion&ci=".encodear3($unico->codigo_inscripcion)."' title='Descargar Participantes a Excel'><i class='fa fa-cloud-download'></i</a>",$rows_);
        }
        $inscritos = "<strong>" . $unico->inscritos . "</strong> Inscritos";
        if ($unico->preinscritos > 0) {
            $preinscritos = "<br><strong>" . $unico->preinscritos . "</strong> Preinscritos";
        } else {
            $preinscritos = "<br><strong>0</strong> Preinscritos";
        }
        if ($unico->postulantes > 0) {
            $postulantes = "<br><strong>" . $unico->postulantes . "</strong> Postulantes";
        } else {
            $postulantes = "<br><strong>0</strong> Postulantes";
        }
        $rows_ = str_replace("{NUM_PARTICIPANTES}", $unico->num_participantes, $rows_);
        $rows_ = str_replace("{INSCRITOS}", $inscritos, $rows_);
        $rows_ = str_replace("{PREINSCRITOS}", $preinscritos, $rows_);
        $rows_ = str_replace("{POSTULANTES}", $postulantes, $rows_);
        if ($unico->modalidad == 1) {
            $tipo = "Elearning";
        }
        if ($unico->modalidad == 2) {
            $tipo = "Presencial";
        }
        $rows_ = str_replace("{TIPO}", $tipo, $rows_);
        $rows_ = str_replace("{DESCARGA_PARTICIPANTES}", "<a href='?sw=DescargaPresencialImparticion&ci=" . encodear3($unico->codigo_inscripcion) . "' title='Descargar Participantes a Excel'><i class='fas fa-cloud-download-alt'></i></a>", $rows_);
        $rows_ = str_replace("{CLASIFICACION}", $unico->clasificacion, $rows_);
        $rows_ = str_replace("{FECHA}", $unico->fecha, $rows_);
        $rows_ = str_replace("{HORA_AM}", $unico->desde_am . " " . $unico->hasta_am, $rows_);
        $rows_ = str_replace("{HORA_PM}", $unico->desde_pm . " " . $unico->hasta_pm, $rows_);
        $rows_ = str_replace("{RELATOR}", $unico->nombre_relator, $rows_);
        $rows_ = str_replace("{ID_SESION}", $unico->id, $rows_);
        $rows_ = str_replace("{ID_SESION_ENCODEADO}", Encodear3($unico->id), $rows_);
        $rows_ = str_replace("{CODIGO_INSCRIPCION_ENCODEADO}", Encodear3($id_imparticion), $rows_);
        $rows_ = str_replace("{CURSO}", $unico->nombre_curso, $rows_);
        $rows_ = str_replace("{CANTIDAD_INSCRITOS}", $unico->total_inscritos, $rows_);
        $rows_ = str_replace("{ID_CURSO}", $unico->id_curso, $rows_);
        if (formatearFechaSmall($unico->fecha_inicio) == "30-11--0001") {
            $rows_ = str_replace("{FECHA_INICIO}", "", $rows_);
        } else {
            $rows_ = str_replace("{FECHA_INICIO}", formatearFechaSmall($unico->fecha_inicio), $rows_);
        }
        if (formatearFechaSmall($unico->fecha_termino) == "30-11--0001") {
            $rows_ = str_replace("{FECHA_TERMINO}", "", $rows_);
        } else {
            $rows_ = str_replace("{FECHA_TERMINO}", formatearFechaSmall($unico->fecha_termino), $rows_);
        }
        $rows_ = str_replace("{DIRECCION}", ($unico->direccion), $rows_);
        $rows_ = str_replace("{DIRECCION}", ($unico->direccion), $rows_);
        $rows_ = str_replace("{CIUDAD}", ($unico->ciudad), $rows_);
        $rows_ = str_replace("{CUPOS}", ($unico->cupos), $rows_);
        $rows_ = str_replace("{NUMSESIONES}", ($unico->sesiones), $rows_);
        $lista_sesiones_reales = "";
        $InsSesiones = InsSesionesImparticion($Empresa, $unico->codigo_inscripcion);
        foreach ($InsSesiones as $InsSesion) {
            $lista_sesiones_reales .= "    " . $InsSesion->fecha . "<br>";
        }
        $rows_ = str_replace("{DETALLE_SESIONES}", ($lista_sesiones_reales), $rows_);
        $Incripcion2 = Total_Inscripciones($Empresa, $unico->codigo_inscripcion);
        $total_html2 = "";
        $rows1_ = "";
        $cuenta = "";
        $total_costo = "";
        $franquicia = "";
        $costoempresa = "";
        $viatico = "";
        $movilizacion = "";
        $REAL = '<span class="label label-success" style="padding-left: 5px;"> Valor Real</span>';
        if ($Incripcion2[0]->id == "") {
            $Incripcion2 = Total_Inscripciones_Estimado($Empresa, $unico->codigo_inscripcion);
            $REAL = '<span class="label label-warning" style="padding-left: 5px;"> Valor Estimado</span>';
        }
        $rows_ = str_replace("{REAL}", $REAL, $rows_);
        if ($cuenta > 1) {
            $tr = ' <tr>
                            <td class="miniSt"><strong>Total</strong</td>
                            <td class="miniSt"><strong>' . colocarPesos($total_costo) . '</strong></td>
                            <td class="miniSt"><strong>' . colocarPesos($franquicia) . '</strong></td>
                            <td class="miniSt"><strong>' . colocarPesos($costoempresa) . '</strong></td>
                            <td class="miniSt"><strong>' . colocarPesos($viatico) . '</strong></td>
                            <td class="miniSt"><strong>' . colocarPesos($movilizacion) . '</strong></td>
                        </tr>';
            $total_html2 .= $tr;
        }
        $total_costo_empresa = $total_costo_empresa + $costoempresa;
        $rows_ = str_replace("{TABLA}", $cab . $total_html2 . "</tbody></table>", $rows_);
        $fecha_actual = date("Y-m-d");
        //$arreglo_Fecha=explode("-", $fecha_actual);
        //$fecha_actual=$arreglo_Fecha[2]."-".$arreglo_Fecha[1]."-".$arreglo_Fecha[0];
        //echo $fecha_actual." ... ";
        //echo $unico->fecha_inicio."<br>";
        if ($unico->fecha_inicio > $fecha_actual) {
            //no iniciado gris
            $estado = '<i class="fa fa-circle text-default"></i>';
            $estadonom = "No Iniciado";
        }
        //if ($unico->fecha_inicio<$fecha_actual && $fecha_actual<$unico->fecha_termino){
        if ($unico->fecha_inicio < $fecha_actual && $fecha_actual < $unico->fecha_termino) {
            //en proceso amarilla
            $estadonom = "En proceso";
            $estado = '<i class="fa fa-circle text-warning"></i>';
        }
        if ($fecha_actual > $unico->fecha_termino && $cuenta == "") {
            //terminada roja
            $estadonom = "Terminada";
            $estado = '<i class="fa fa-circle text-danger"></i>';
        }
        if ($fecha_actual > $unico->fecha_termino && $cuenta != "") {
            //finalizada verde
            $estadonom = "Finalizada";
            $estado = '<i class="fa fa-circle text-success"></i>';
        }
        if ($unico->fecha_inicio == "") {
            //simple celeste
            $estadonom = "Libre";
            $estado = '<i class="fa fa-circle text-info"></i>';
        }
        $rows_ = str_replace("{ESTADO}", $estado, $rows_);
        $rows_ = str_replace("{ESTADONOMBRE}", $estadonom, $rows_);
        $total_html .= $rows_;
    }
    $PRINCIPAL = str_replace("{REGISTROS" . $registros_pagina . "}", "selected", $PRINCIPAL);
    $PRINCIPAL = str_replace("{PAGINACION}", $paginacion, $PRINCIPAL);
    $PRINCIPAL = str_replace("{RANGO_FECHAS}", "", $PRINCIPAL);
    $PRINCIPAL = str_replace("{BCODIGO}", $codigo, $PRINCIPAL);
    $PRINCIPAL = str_replace("{BFECHA1}", $fecha1, $PRINCIPAL);
    $PRINCIPAL = str_replace("{BFECHA2}", $fecha2, $PRINCIPAL);
    $PRINCIPAL = str_replace("{RESUMEN}", "Hay un total de " . $registros_total . " Inscripciones", $PRINCIPAL);
    $PRINCIPAL = str_replace("{ID_EMPRESA}", $Empresa, $PRINCIPAL);
    $PRINCIPAL = str_replace("{ROW_LISTADO}", utf8_encode($total_html), $PRINCIPAL);
    $PRINCIPAL = str_replace("{PRESUPUESO_RESTANTE}", colocarPesos(5000000 - $total_costo_empresa), $PRINCIPAL);
    $PRINCIPAL = str_replace("{TOTAL_COSTO_EMPRESA}", colocarPesos($total_costo_empresa), $PRINCIPAL);
    return ($PRINCIPAL);
}

function sumar2Horas($h1, $h2)
{
    $h2h = date('H', strtotime($h2));
    $h2m = date('i', strtotime($h2));
    $h2s = date('s', strtotime($h2));
    $hora2 = $h2h . " hour " . $h2m . " min " . $h2s . " second";
    $horas_sumadas = $h1 . " + " . $hora2;
    $text = date('H:i:s', strtotime($horas_sumadas));
    return ($text);
}

function calcular_tiempo_trasnc($hora1, $hora2)
{
    $separar[1] = explode(':', $hora1);
    $separar[2] = explode(':', $hora2);
    $total_minutos_trasncurridos[1] = ($separar[1][0] * 60) + $separar[1][1];
    $total_minutos_trasncurridos[2] = ($separar[2][0] * 60) + $separar[2][1];
    $total_minutos_trasncurridos = $total_minutos_trasncurridos[1] - $total_minutos_trasncurridos[2];
    if ($total_minutos_trasncurridos <= 59) return ($total_minutos_trasncurridos . ' Minutos');
    elseif ($total_minutos_trasncurridos > 59) {
        $HORA_TRANSCURRIDA = round($total_minutos_trasncurridos / 60);
        if ($HORA_TRANSCURRIDA <= 9) $HORA_TRANSCURRIDA = '0' . $HORA_TRANSCURRIDA;
        $MINUITOS_TRANSCURRIDOS = $total_minutos_trasncurridos % 60;
        if ($MINUITOS_TRANSCURRIDOS <= 9) $MINUITOS_TRANSCURRIDOS = '0' . $MINUITOS_TRANSCURRIDOS;
        return ($HORA_TRANSCURRIDA . ':' . $MINUITOS_TRANSCURRIDOS . '');
    }
}

function ColocaSesionesPorImparticion($id_empresa, $id_imparticion)
{
    $sesiones_por_imparticion = FechaInicioTerminoImparticionPorEmpresa($id_imparticion, $id_empresa);
    //$usuarios_relatores=DatosTablaUsuarioTodosPorEmpresa($id_empresa);
    $usuarios_relatores = TraeRelatoresPorEmpresa2($id_empresa);
    foreach ($sesiones_por_imparticion as $sesion) {
        $rows .= file_get_contents("views/capacitacion/imparticion/row_sesiones_por_imparticion.html");
        $rows = str_replace("{ID_SESION}", $sesion->id, $rows);
        $rows = str_replace("{ID_SESION_ENCODEAR}", Encodear3($sesion->id), $rows);
        $rows = str_replace("{ID_IMPARTICION_ENCODEAR}", Encodear3($id_imparticion), $rows);
        $rows = str_replace("{VALUE_FECHA}", $sesion->fecha, $rows);
        $rows = str_replace("{DESDE_AM}", $sesion->desde_am, $rows);
        $rows = str_replace("{HASTA_AM}", $sesion->hasta_am, $rows);
        $rows = str_replace("{DESDE_PM}", $sesion->desde_pm, $rows);
        $rows = str_replace("{HASTA_PM}", $sesion->hasta_pm, $rows);
        $options_relatores = "<option value=''></option>";
        foreach ($usuarios_relatores as $rel) {
            if ($rel->rut == $sesion->relator) {
                $options_relatores .= "<option value='" . $rel->rut . "' selected='selected'>" . $rel->nombre . "</option>";
            } else {
                $options_relatores .= "<option value='" . $rel->rut . "'>" . $rel->nombre . "</option>";
            }
        }
        $rows = str_replace("{OPTIONS_RELATORES}", utf8_encode($options_relatores), $rows);
        //$rango_am=calcular_tiempo_trasnc($sesion->hasta_am, $sesion->desde_am);
        //$rango_pm=calcular_tiempo_trasnc($sesion->hasta_pm, $sesion->desde_pm);
        //$suma_horas=sumar2Horas($rango_am.":00", $rango_pm.":00");
        //$rows= str_replace("{TIEMPO_TOTAL}",$suma_horas,$rows);
        $rows = str_replace("{TIEMPO_TOTAL}", $sesion->numero_horas, $rows);
    }
    return ($rows);
}

function ReporteFijacionObj($PRINCIPAL, $id_proceso, $id_empresa, $excel, $arreglo_post)
{
    $listado_usuarios = REPORTE_FIJACION_Evaluadores($id_empresa, $id_proceso, $arreglo_post);
    $total_no_iniciados = 0;
    $total_finalizados = 0;
    $total_en_proceso = 0;
    foreach ($listado_usuarios as $usu) {
        if ($excel == 1) {
            $rows = file_get_contents("views/reportes/objetivos/" . $id_empresa . "_row_avance_fijacion_evaluador_excel.html");
        } else {
            $rows = file_get_contents("views/reportes/objetivos/" . $id_empresa . "_row_avance_fijacion_evaluador.html");
        }
        $rows = str_replace("{RUT_EVALUADOR}", $usu->rut_evaluador, $rows);
        $rows = str_replace("{NOMBRE_EVALUADOR}", $usu->nombre_evaluador, $rows);
        $rows = str_replace("{CARGO_EVALUADOR}", $usu->cargo_evaluador, $rows);
        $rows = str_replace("{CAMPO1}", $usu->c1_evaluador, $rows);
        $rows = str_replace("{CAMPO2}", $usu->c2_evaluador, $rows);
        $rows = str_replace("{CAMPO3}", $usu->c3_evaluador, $rows);
        $rows = str_replace("{RUT_EVALUADO}", $usu->rut_evaluado, $rows);
        $rows = str_replace("{NOMBRE_EVALUADO}", $usu->nombre_evaluado, $rows);
        $rows = str_replace("{CARGO_EVALUADO}", $usu->cargo_evaluado, $rows);
        $rows = str_replace("{CAMPO1_EVALUADO}", $usu->c1_evaluado, $rows);
        $rows = str_replace("{CAMPO2_EVALUADO}", $usu->c2_evaluado, $rows);
        $rows = str_replace("{CAMPO3_EVALUADO}", $usu->c3_evaluado, $rows);
        $rows = str_replace("{CANTIDAD_FIJADOS}", $usu->total_objetivos_ingresados, $rows);
        $porcentaje_avance = round((($usu->total_dimensiones_finalizadas * 100) / $usu->total_dimensiones), 0);
        $rows = str_replace("{POR_AVANCE}", $porcentaje_avance, $rows);
        if ($usu->total_objetivos_ingresados == 0) {
            $total_no_iniciados++;
        } else if ($usu->total_objetivos_ingresados > 0 and $porcentaje_avance < 100) {
            $total_en_proceso++;
            //$total_finalizados++;
        } else if ($porcentaje_avance == 100) {
            $total_finalizados++;
        }
        if ($excel == 1) {
            echo $rows;
        } else {
            $total_rows .= $rows;
        }
    }
    $PRINCIPAL = str_replace("{LISTADO_AVANCE_FIJACION}", utf8_encode($total_rows), $PRINCIPAL);
    $PRINCIPAL = str_replace("{TOTAL_NO_INICIADOS}", utf8_encode($total_no_iniciados), $PRINCIPAL);
    $PRINCIPAL = str_replace("{TOTAL_EN_PROCESO}", utf8_encode($total_en_proceso), $PRINCIPAL);
    $PRINCIPAL = str_replace("{TOTAL_FINALIZADOS}", utf8_encode($total_finalizados), $PRINCIPAL);
    return ($PRINCIPAL);
}

function FiltroPerfiladoAudiencias($user_admin, $id_empresa)
{
    $datos_rel = TRaeDatosRelADminPerfil($id_empresa, $user_admin, "audiencia");
    if ($datos_rel) {
        $sql = " and (";
        $contador = 0;
        foreach ($datos_rel as $rel) {
            $sql .= $rel->tabla . "." . $rel->campo . "='" . $rel->valor . "' ";
            $contador++;
            if (count($datos_rel) <> $contador) {
                $sql .= " or ";
            }
        }
        $sql .= " )";
    } else {
        $sql = "";
    }
    return ($sql);
}

function FiltroPerfilado($user_admin, $id_empresa, $tipo)
{
    //echo "$user_admin, $id_empresa";
    //Veo si tiene datos en la tabla de rel_admin_rut_perfil
    $datos_rel = TRaeDatosRelADminPerfil($id_empresa, $user_admin, "capacitacion");
    if ($tipo == "rel_lms_malla_curso") {
        if ($datos_rel) {
            $sql = " and (";
            $contador = 0;
            foreach ($datos_rel as $rel) {
                $sql .= "rel_lms_malla_curso." . $rel->campo . "='" . $rel->valor . "' ";
                $contador++;
                if (count($datos_rel) <> $contador) {
                    $sql .= " or ";
                }
            }
            $sql .= " )";
        } else {
            $sql = "";
        }
    } else {
        if ($datos_rel) {
            $sql = " and (";
            $contador = 0;
            foreach ($datos_rel as $rel) {
                $sql .= $rel->tabla . "." . $rel->campo . "='" . $rel->valor . "' ";
                $contador++;
                if (count($datos_rel) <> $contador) {
                    $sql .= " or ";
                }
            }
            $sql .= " )";
        } else {
            $sql = "";
        }
    }
    return ($sql);
}

function SGD_Matriz_Evaluacion($PRINCIPAL, $id_empresa, $id_proceso, $excel, $rut_evaluado_filtrado, $rut_filtro_evaluador)
{
    //total Usuarios Empresa
    if ($excel == 2) {
        $SGD_Todas_Matriz_evaluados = SGD_DatosTablaRelacionesNoEvaluables($id_empresa);
    } else {
        $SGD_Todas_Matriz_evaluados = SGD_DatosTablaRelaciones($id_empresa, $id_proceso, $rut_evaluado_filtrado, $rut_filtro_evaluador);
    }
    //Traigo los perfiles de esta empresa
    $perfiles_eval = PerfilesEvalPorEmpresa($id_empresa);
    $datos_del_proceso = TraeProcesosDeEvaluacionPorIDProceso($id_proceso);
    if ($datos_del_proceso[0]->tipo_proceso == 1) {
        $template_row = file_get_contents("views/sgd/matriz/row_listado_eval.html");
    } else if ($datos_del_proceso[0]->tipo_proceso == 2) {
        $template_row = file_get_contents("views/sgd/matriz/row_listado.html");
    } else {
        echo "no existe template row para este proceso";
        exit;
    }
    //traigo los programas por empresa
    foreach ($SGD_Todas_Matriz_evaluados as $SGD_Matriz_evaluado) {
        $evaluado = "<strong>" . $SGD_Matriz_evaluado->NombreEvaluado . "</strong>
        <br>" . $SGD_Matriz_evaluado->CargoEvaluado . "<br>
        <small>" . $SGD_Matriz_evaluado->GerenciaEvaluado . "</small>";
        $datos_evaluacion = "<strong>" . $SGD_Matriz_evaluado->NombreSubPerfil . "</strong>
        <br>" . $SGD_Matriz_evaluado->Perfil . "<br>
        <small>" . $SGD_Matriz_evaluado->Proceso . "</small>";
        $evaluador = "<strong>" . $SGD_Matriz_evaluado->NombreEvaluador . "</strong>
        <br>" . $SGD_Matriz_evaluado->CargoEvaluador . "<br>
        <small>" . $SGD_Matriz_evaluado->GerenciaEvaluador . "</small>";
        $validador = "<strong>" . $SGD_Matriz_evaluado->NombreValidador . "</strong>
        ";
        $calibrador = "<strong>" . $SGD_Matriz_evaluado->NombreCalibrador . "</strong>";
        if ($excel == 1 or $excel == 2) {
            $rows = file_get_contents("views/sgd/matriz/row_listado_excel.html");
        } else {
            //$rows.=file_get_contents("views/sgd/matriz/row_listado.html");
            $rows .= $template_row;
        }
        $rows = str_replace("{EVALUADO}", $evaluado, $rows);
        $rows = str_replace("{DATOS_EVALUACION}", $datos_evaluacion, $rows);
        $rows = str_replace("{EVALUADOR}", $evaluador, $rows);
        $rows = str_replace("{VALIDADOR}", $validador, $rows);
        $rows = str_replace("{CALIBRADOR}", $calibrador, $rows);
        $rows = str_replace("{ID_EMPRESA_ENCODEADO}", Encodear3($id_empresa), $rows);
        $rows = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($SGD_Matriz_evaluado->evaluado), $rows);
        $rows = str_replace("{EVALUADO_ACTUAL}", $SGD_Matriz_evaluado->evaluado, $rows);
        $rows = str_replace("{EVALUADOR_ACTUAL}", $SGD_Matriz_evaluado->evaluador, $rows);
        $rows = str_replace("{RUT_EVALUADOR_ENCODEADO}", Encodear3($SGD_Matriz_evaluado->evaluador), $rows);
        $rows = str_replace("{VALIDADOR_ACTUAL}", $SGD_Matriz_evaluado->validador, $rows);
        $rows = str_replace("{CALIBRADOR_ACTUAL}", $SGD_Matriz_evaluado->calibrador, $rows);
        $rows = str_replace("{PERFIL_ORIGINAL}", $SGD_Matriz_evaluado->perfil_evaluacion_competencias, $rows);
        $rows = str_replace("{SUBPERFIL_ORIGINAL}", $SGD_Matriz_evaluado->subperfil, $rows);
        $rows = str_replace("{ID_PROCESO}", $SGD_Matriz_evaluado->id_proceso, $rows);
        $rows = str_replace("{ID_PROCESO_ENCODEADO}", Encodear3($SGD_Matriz_evaluado->id_proceso), $rows);
        $rows = str_replace("{ID_SGD_RELACIONES}", $SGD_Matriz_evaluado->id, $rows);
        $options_perfiles = "";
        foreach ($perfiles_eval as $perf) {
            if ($SGD_Matriz_evaluado->perfil_evaluacion_competencias == $perf->perfil) {
                $options_perfiles .= "<option value='" . $perf->perfil . "' selected>" . $perf->descripcion . "</option>";
            } else {
                $options_perfiles .= "<option value='" . $perf->perfil . "' >" . $perf->descripcion . "</option>";
            }
        }
        $rows = str_replace("{OPTIONS_PERFILES}", $options_perfiles, $rows);
        //EXCEL
        $rows = str_replace("{RutEvaluado}", $SGD_Matriz_evaluado->RutEvaluado, $rows);
        $rows = str_replace("{NombreEvaluado}", $SGD_Matriz_evaluado->NombreEvaluado, $rows);
        $rows = str_replace("{CargoEvaluado}", $SGD_Matriz_evaluado->CargoEvaluado, $rows);
        $rows = str_replace("{GerenciaEvaluado}", $SGD_Matriz_evaluado->GerenciaEvaluado, $rows);
        $rows = str_replace("{RutEvaluador}", $SGD_Matriz_evaluado->RutEvaluador, $rows);
        $rows = str_replace("{NombreEvaluador}", $SGD_Matriz_evaluado->NombreEvaluador, $rows);
        $rows = str_replace("{CargoEvaluador}", $SGD_Matriz_evaluado->CargoEvaluador, $rows);
        $rows = str_replace("{GerenciaEvaluador}", $SGD_Matriz_evaluado->GerenciaEvaluador, $rows);
        if ($excel == 2) {
            $rows = str_replace("{TipoEvaluacion}", $SGD_Matriz_evaluado->observacion, $rows);
        } else {
            $rows = str_replace("{TipoEvaluacion}", $SGD_Matriz_evaluado->NombreSubPerfil, $rows);
        }
        $rows = str_replace("{Perfil}", $SGD_Matriz_evaluado->Perfil, $rows);
        $rows = str_replace("{Proceso}", $SGD_Matriz_evaluado->Proceso, $rows);
        $rows = str_replace("{RutJefeEvaluador}", $SGD_Matriz_evaluado->RutValidador, $rows);
        $rows = str_replace("{NombreJefeEvaluador}", $SGD_Matriz_evaluado->NombreValidador, $rows);
        $rows = str_replace("{CargoJefeEvaluador}", $SGD_Matriz_evaluado->CargoValidador, $rows);
        $rows = str_replace("{GerenciaJefeEvaluador}", $SGD_Matriz_evaluado->GerenciaValidador, $rows);
        $rows = str_replace("{RutCalibrador}", $SGD_Matriz_evaluado->RutCalibrador, $rows);
        $rows = str_replace("{NombreCalibrador}", $SGD_Matriz_evaluado->NombreCalibrador, $rows);
        $rows = str_replace("{CargoCalibrador}", $SGD_Matriz_evaluado->CargoCalibrador, $rows);
        $rows = str_replace("{GerenciaCalibrador}", $SGD_Matriz_evaluado->GerenciaCalibrador, $rows);
        if ($excel == 1 or $excel == 2) {
            echo $rows;
        }
    }
    $PRINCIPAL = str_replace("{ROW_LISTADO}", utf8_encode($rows), $PRINCIPAL);
    return ($PRINCIPAL);
}

function SGD_Seguimiento_Evaluacion($PRINCIPAL, $id_empresa, $id_proceso, $excel, $arreglo_post, $filtro2)
{

    //total Usuarios Empresa
    $SGD_Todas_Seguimiento_evaluadores = SGD_DatosTablaRelacionesPorEvaluador($id_empresa, $id_proceso, $arreglo_post, $filtro2);
    //traigo los programas por empresa
    foreach ($SGD_Todas_Seguimiento_evaluadores as $SGD_Todas_Seguimiento_evaluador) {
        $Usu = TraeDatosUsuario($SGD_Todas_Seguimiento_evaluador->evaluador);
        $evaluador = "
        <strong>" . $Usu[0]->nombre_completo . "</strong>
        <br><strong>" . $Usu[0]->rut_completo . "</strong>
        <br>" . $Usu[0]->cargo . "<br>
        <small>" . $Usu[0]->gerencia . "</small>";


        //echo "<br>$SGD_Todas_Seguimiento_evaluador->CuentaFinalizados";
        //echo "<br>"; print_r($array_cantidad_evaluados_agrupacion);

        $array_cantidad_evaluados_agrupacion["'" . $Usu[0]->gerencia . "'"] = $SGD_Todas_Seguimiento_evaluador->CuentaEvaluados +
            $array_cantidad_evaluados_agrupacion["'" . $Usu[0]->gerencia . "'"];

        $array_cantidad_evaluados_agrupacion_f["'" . $Usu[0]->gerencia . "'"] = $SGD_Todas_Seguimiento_evaluador->CuentaFinalizados +
            $array_cantidad_evaluados_agrupacion_f["'" . $Usu[0]->gerencia . "'"];
        // BUSCA gERENCIAS O DIVIDIONES Y VA CONTANDO

        if ($SGD_Todas_Seguimiento_evaluador->CuentaFinalizados >= $SGD_Todas_Seguimiento_evaluador->CuentaEvaluados) {
            $SGD_EstadoSeguimiento = "<div class='alert alert-success' role='alert'>
          <strong>Finalizado</strong></div>";
            $SGD_EstadoSeguimientoExcel = "Finalizado";
            $cuenta_finalizados++;
        } else {
            $SGD_EstadoSeguimiento = "<div class='alert alert-warning' role='alert'>
          <strong>No Finalizado</strong></div>";
            $SGD_EstadoSeguimientoExcel = "No Finalizado";
        }
        $cuenta_todos++;
        if ($excel == 1) {
            $rows = file_get_contents("views/sgd/seguimiento/row_listado_excel.html");
        } else {
            $rows .= file_get_contents("views/sgd/seguimiento/row_listado.html");
        }
        $rows = str_replace("{EVALUADOR}", $evaluador, $rows);
        $rows = str_replace("{NUMERO_EVALUADOS}", $SGD_Todas_Seguimiento_evaluador->CuentaEvaluados, $rows);
        $rows = str_replace("{NUMERO_YAEVALUADOS}", $SGD_Todas_Seguimiento_evaluador->CuentaFinalizados, $rows);
        $rows = str_replace("{ESTADO_EVALUADOR}", $SGD_EstadoSeguimiento, $rows);
        //excel
        $rows = str_replace("{RutEvaluador}", $Usu[0]->rut_completo, $rows);
        $rows = str_replace("{NombreEvaluador}", $Usu[0]->nombre_completo, $rows);
        $rows = str_replace("{CargoEvaluador}", $Usu[0]->cargo, $rows);
        $rows = str_replace("{GerenciaEvaluador}", $Usu[0]->gerencia, $rows);
        $rows = str_replace("{ESTADO_EVALUADOR_Evaluacion}", $SGD_EstadoSeguimiento, $rows);
        if ($excel == 1) {
            echo $rows;
        }
    }

    // echo "<br><br>";
    // print_r($array_cantidad_evaluados_agrupacion);
    // echo "<br><br>";
    // print_r($array_cantidad_evaluados_agrupacion_f);
    // echo "<br><br>";

    foreach ($array_cantidad_evaluados_agrupacion as $key => $value) {
        //echo "<br> key $key, value $value";
        //echo $array_cantidad_evaluados_agrupacion_f[$key];
        $progress = round(100 * ($array_cantidad_evaluados_agrupacion_f[$key]) / $value);
        //echo "<br><hr>";
        $rows_DIV .= file_get_contents("views/sgd/seguimiento/row_division_seguimiento.html");
        $rows_DIV = str_replace("{AGRUPACION}", utf8_decode($key), $rows_DIV);
        $rows_DIV = str_replace("{AGRUPACION_EVALUABLES}", $value, $rows_DIV);
        $rows_DIV = str_replace("{AGRUPACION_EVALUADOS}", $array_cantidad_evaluados_agrupacion_f[$key], $rows_DIV);
        $rows_DIV = str_replace("{PROGRESS}", $progress, $rows_DIV);

    }

    $PRINCIPAL = str_replace("{ROW_LISTADO_AGRUPACION_RANKING}", ($rows_DIV), $PRINCIPAL);


    $AvancePorcentaje = round(100 * $cuenta_finalizados / $cuenta_todos);
    $AvancePorcentajeComplemento = 100 - $AvancePorcentaje;
    $PRINCIPAL = str_replace("{AVANCE_SEGUIMIENTO}", utf8_encode($AvancePorcentaje), $PRINCIPAL);
    $PRINCIPAL = str_replace("{AVANCE_SEGUIMIENTO_COMPLEMENTO}", utf8_encode($AvancePorcentajeComplemento), $PRINCIPAL);
    $PRINCIPAL = str_replace("{ROW_LISTADO}", utf8_encode($rows), $PRINCIPAL);
    return ($PRINCIPAL);
}

function SGD_Seguimiento_EvaluacionEvaluadoEvaluador($PRINCIPAL, $id_empresa, $subperfil, $excel, $arreglo_post)
{
    //total Usuarios Empresa

    $SGD_Graficos = SGD_DatosTablaRelacionesPorEvaluadoEvaluadorFull($id_empresa, $subperfil, $division, $gerencia, $area);
    // print_r($SGD_Graficos);


    $graf1 = round(100 * $SGD_Graficos[1] / $SGD_Graficos[0]);
    $graf1_c = round(100 - $graf1);
    $graf1_txt = "" . $SGD_Graficos[1] . " de " . $SGD_Graficos[0];

    $graf2 = round(100 * $SGD_Graficos[2] / $SGD_Graficos[0]);
    $graf2_c = round(100 - $graf2);
    $graf2_txt = "" . $SGD_Graficos[2] . " de " . $SGD_Graficos[0];

    $graf3 = round(100 * $SGD_Graficos[3] / $SGD_Graficos[8]);
    $graf3_c = round(100 - $graf3);
    $graf3_txt = "" . $SGD_Graficos[3] . " de " . $SGD_Graficos[8];

    $graf4 = round(100 * $SGD_Graficos[4] / $SGD_Graficos[0]);
    $graf4_c = round(100 - $graf4);
    $graf4_txt = "" . $SGD_Graficos[4] . " de " . $SGD_Graficos[0];

    $graf5 = round(100 * $SGD_Graficos[5] / $SGD_Graficos[0]);
    $graf5_c = round(100 - $graf5);
    $graf5_txt = "" . $SGD_Graficos[5] . " de " . $SGD_Graficos[0];

    $graf6 = round(100 * $SGD_Graficos[6] / $SGD_Graficos[0]);
    $graf6_c = round(100 - $graf6);
    $graf6_txt = "" . $SGD_Graficos[6] . " de " . $SGD_Graficos[0];

    $graf7 = round(100 * $SGD_Graficos[7] / $SGD_Graficos[0]);
    $graf7_c = round(100 - $graf7);
    $graf7_txt = "" . $SGD_Graficos[7] . " de " . $SGD_Graficos[0];


    $graf_ae = round(100 * $SGD_Graficos[9] / $SGD_Graficos[0]);
    $graf_ae_c = round(100 - $graf_ae);
    $graf_ae_txt = "" . $SGD_Graficos[9] . " de " . $SGD_Graficos[0];


    /*
echo "<br>VAL $graf1_txt ,  $graf1 $graf1_c";
echo "<br>ASC $graf3_txt ,  $graf3 $graf3_c";
echo "<br>DESC $graf2_txt,  $graf2 $graf2_c";
echo "<br>$graf4_txt";
echo "<br>$graf5_txt";
echo "<br>$graf6_txt";
echo "<br>$graf7_txt";
  */
    $PRINCIPAL = str_replace("{GRAF1}", ($graf1), $PRINCIPAL);
    $PRINCIPAL = str_replace("{GRAF1_C}", ($graf1_c), $PRINCIPAL);
    $PRINCIPAL = str_replace("{GRAFT1}", ("VALIDACION EQUIPO"), $PRINCIPAL);
    $PRINCIPAL = str_replace("{GRAFTEXT1}", $graf1_txt, $PRINCIPAL);

    $PRINCIPAL = str_replace("{GRAF2}", ($graf2), $PRINCIPAL);
    $PRINCIPAL = str_replace("{GRAF2_C}", ($graf2_c), $PRINCIPAL);
    $PRINCIPAL = str_replace("{GRAFT2}", ("EVALUACION_DESCENDENTE"), $PRINCIPAL);
    $PRINCIPAL = str_replace("{GRAFTEXT2}", $graf2_txt, $PRINCIPAL);

    $PRINCIPAL = str_replace("{GRAF3}", ($graf3), $PRINCIPAL);
    $PRINCIPAL = str_replace("{GRAF3_C}", ($graf3_c), $PRINCIPAL);
    $PRINCIPAL = str_replace("{GRAFT3}", ("EVALUACION_ASCENDENTE"), $PRINCIPAL);
    $PRINCIPAL = str_replace("{GRAFTEXT3}", $graf3_txt, $PRINCIPAL);

    $PRINCIPAL = str_replace("{GRAF4}", ($graf4), $PRINCIPAL);
    $PRINCIPAL = str_replace("{GRAF4_C}", ($graf4_c), $PRINCIPAL);
    $PRINCIPAL = str_replace("{GRAFT4}", ("CALIBRACION"), $PRINCIPAL);
    $PRINCIPAL = str_replace("{GRAFTEXT4}", ($graf4_txt), $PRINCIPAL);

    $PRINCIPAL = str_replace("{GRAF5}", ($graf5), $PRINCIPAL);
    $PRINCIPAL = str_replace("{GRAF5_C}", ($graf5_c), $PRINCIPAL);
    $PRINCIPAL = str_replace("{GRAFT5}", ("PLANES"), $PRINCIPAL);
    $PRINCIPAL = str_replace("{GRAFTEXT5}", ($graf5_txt), $PRINCIPAL);

    $PRINCIPAL = str_replace("{GRAF6}", ($graf6), $PRINCIPAL);
    $PRINCIPAL = str_replace("{GRAF6_C}", ($graf6_c), $PRINCIPAL);
    $PRINCIPAL = str_replace("{GRAFT6}", ("RETROALIMENTACION INFORME"), $PRINCIPAL);
    $PRINCIPAL = str_replace("{GRAFTEXT6}", ($graf6_txt), $PRINCIPAL);

    $PRINCIPAL = str_replace("{GRAF7}", ($graf7), $PRINCIPAL);
    $PRINCIPAL = str_replace("{GRAF7_C}", ($graf7_c), $PRINCIPAL);
    $PRINCIPAL = str_replace("{GRAFT7}", ("LIBERACION INFORME"), $PRINCIPAL);
    $PRINCIPAL = str_replace("{GRAFTEXT7}", ($graf7_txt), $PRINCIPAL);


    $PRINCIPAL = str_replace("{GRAF7_AE}", ($graf_ae), $PRINCIPAL);
    $PRINCIPAL = str_replace("{GRAF7_C_AE}", ($graf_ae_c), $PRINCIPAL);
    $PRINCIPAL = str_replace("{GRAFT7_AE}", ("Autoevaluacion"), $PRINCIPAL);
    $PRINCIPAL = str_replace("{GRAFTEXT7_AE}", ($graf_ae_txt), $PRINCIPAL);


    $SGD_divisiones = SGD_AgrupacionDivision($id_empresa, $id_proceso, $arreglo_post);
    //print_r($SGD_divisiones);
    foreach ($SGD_divisiones as $unico) {
        $SGD_Graficos_division = SGD_DatosTablaRelacionesPorEvaluadoEvaluadorFull($id_empresa, $subperfil, $unico->evaluado_division, $gerencia, $area);
        $rows_DIV1 .= file_get_contents("views/sgd/seguimiento_eval_evaluador/row_division_seguimiento.html");
        $rows_DIV1 = str_replace("{AGRUPACION}", $unico->evaluado_division, $rows_DIV1);
        $rows_DIV1 = str_replace("{AGRUPACION_TOTAL}", $SGD_Graficos_division[0], $rows_DIV1);

        $progress1 = round(100 * $SGD_Graficos_division[1] / $SGD_Graficos_division[0]);
        $rows_DIV1 = str_replace("{AGRUPACION_PROGRESS1}", $progress1, $rows_DIV1);
        $rows_DIV1 = str_replace("{REALIZADO_EVALUABLES}", $SGD_Graficos_division[1], $rows_DIV1);
        $rows_DIV1 = str_replace("{TOTAL_EVALUABLES}", $SGD_Graficos_division[0], $rows_DIV1);


    }

    foreach ($SGD_divisiones as $unico) {
        $SGD_Graficos_division = SGD_DatosTablaRelacionesPorEvaluadoEvaluadorFull($id_empresa, $subperfil, $unico->evaluado_division, $gerencia, $area);
        $rows_DIV2 .= file_get_contents("views/sgd/seguimiento_eval_evaluador/row_division_seguimiento.html");
        $rows_DIV2 = str_replace("{AGRUPACION}", $unico->evaluado_division, $rows_DIV2);
        $rows_DIV2 = str_replace("{AGRUPACION_TOTAL}", $SGD_Graficos_division[0], $rows_DIV2);

        $progress2 = round(100 * $SGD_Graficos_division[2] / $SGD_Graficos_division[0]);
        $rows_DIV2 = str_replace("{AGRUPACION_PROGRESS1}", $progress2, $rows_DIV2);
        $rows_DIV2 = str_replace("{REALIZADO_EVALUABLES}", $SGD_Graficos_division[2], $rows_DIV2);
        $rows_DIV2 = str_replace("{TOTAL_EVALUABLES}", $SGD_Graficos_division[0], $rows_DIV2);
    }
    foreach ($SGD_divisiones as $unico) {
        $SGD_Graficos_division = SGD_DatosTablaRelacionesPorEvaluadoEvaluadorFull($id_empresa, $subperfil, $unico->evaluado_division, $gerencia, $area);
        $rows_DIV3 .= file_get_contents("views/sgd/seguimiento_eval_evaluador/row_division_seguimiento.html");
        $rows_DIV3 = str_replace("{AGRUPACION}", $unico->evaluado_division, $rows_DIV3);
        $rows_DIV3 = str_replace("{AGRUPACION_TOTAL}", $SGD_Graficos_division[0], $rows_DIV3);

        $progress3 = round(100 * $SGD_Graficos_division[3] / $SGD_Graficos_division[0]);
        $rows_DIV3 = str_replace("{AGRUPACION_PROGRESS1}", $progress3, $rows_DIV3);
        $rows_DIV3 = str_replace("{REALIZADO_EVALUABLES}", $SGD_Graficos_division[3], $rows_DIV3);
        $rows_DIV3 = str_replace("{TOTAL_EVALUABLES}", $SGD_Graficos_division[0], $rows_DIV3);
    }
    foreach ($SGD_divisiones as $unico) {
        $SGD_Graficos_division = SGD_DatosTablaRelacionesPorEvaluadoEvaluadorFull($id_empresa, $subperfil, $unico->evaluado_division, $gerencia, $area);
        $rows_DIV4 .= file_get_contents("views/sgd/seguimiento_eval_evaluador/row_division_seguimiento.html");
        $rows_DIV4 = str_replace("{AGRUPACION}", $unico->evaluado_division, $rows_DIV4);
        $rows_DIV4 = str_replace("{AGRUPACION_TOTAL}", $SGD_Graficos_division[0], $rows_DIV4);

        $progress4 = round(100 * $SGD_Graficos_division[4] / $SGD_Graficos_division[0]);
        $rows_DIV4 = str_replace("{AGRUPACION_PROGRESS1}", $progress4, $rows_DIV4);
        $rows_DIV4 = str_replace("{REALIZADO_EVALUABLES}", $SGD_Graficos_division[4], $rows_DIV4);
        $rows_DIV4 = str_replace("{TOTAL_EVALUABLES}", $SGD_Graficos_division[0], $rows_DIV4);
    }
    foreach ($SGD_divisiones as $unico) {
        $SGD_Graficos_division = SGD_DatosTablaRelacionesPorEvaluadoEvaluadorFull($id_empresa, $subperfil, $unico->evaluado_division, $gerencia, $area);
        $rows_DIV5 .= file_get_contents("views/sgd/seguimiento_eval_evaluador/row_division_seguimiento.html");
        $rows_DIV5 = str_replace("{AGRUPACION}", $unico->evaluado_division, $rows_DIV5);
        $rows_DIV5 = str_replace("{AGRUPACION_TOTAL}", $SGD_Graficos_division[0], $rows_DIV5);

        $progress5 = round(100 * $SGD_Graficos_division[5] / $SGD_Graficos_division[0]);
        $rows_DIV5 = str_replace("{AGRUPACION_PROGRESS1}", $progress5, $rows_DIV5);
        $rows_DIV5 = str_replace("{REALIZADO_EVALUABLES}", $SGD_Graficos_division[5], $rows_DIV5);
        $rows_DIV5 = str_replace("{TOTAL_EVALUABLES}", $SGD_Graficos_division[0], $rows_DIV5);
    }
    foreach ($SGD_divisiones as $unico) {
        $SGD_Graficos_division = SGD_DatosTablaRelacionesPorEvaluadoEvaluadorFull($id_empresa, $subperfil, $unico->evaluado_division, $gerencia, $area);
        $rows_DIV6 .= file_get_contents("views/sgd/seguimiento_eval_evaluador/row_division_seguimiento.html");
        $rows_DIV6 = str_replace("{AGRUPACION}", $unico->evaluado_division, $rows_DIV6);
        $rows_DIV6 = str_replace("{AGRUPACION_TOTAL}", $SGD_Graficos_division[0], $rows_DIV6);

        $progress6 = round(100 * $SGD_Graficos_division[6] / $SGD_Graficos_division[0]);
        $rows_DIV6 = str_replace("{AGRUPACION_PROGRESS1}", $progress6, $rows_DIV6);
        $rows_DIV6 = str_replace("{REALIZADO_EVALUABLES}", $SGD_Graficos_division[6], $rows_DIV6);
        $rows_DIV6 = str_replace("{TOTAL_EVALUABLES}", $SGD_Graficos_division[0], $rows_DIV6);
    }
    foreach ($SGD_divisiones as $unico) {
        $SGD_Graficos_division = SGD_DatosTablaRelacionesPorEvaluadoEvaluadorFull($id_empresa, $subperfil, $unico->evaluado_division, $gerencia, $area);
        $rows_DIV7 .= file_get_contents("views/sgd/seguimiento_eval_evaluador/row_division_seguimiento.html");
        $rows_DIV7 = str_replace("{AGRUPACION}", $unico->evaluado_division, $rows_DIV7);
        $rows_DIV7 = str_replace("{AGRUPACION_TOTAL}", $SGD_Graficos_division[0], $rows_DIV7);

        $progress7 = round(100 * $SGD_Graficos_division[7] / $SGD_Graficos_division[0]);
        $rows_DIV7 = str_replace("{AGRUPACION_PROGRESS1}", $progress7, $rows_DIV7);
        $rows_DIV7 = str_replace("{REALIZADO_EVALUABLES}", $SGD_Graficos_division[7], $rows_DIV7);
        $rows_DIV7 = str_replace("{TOTAL_EVALUABLES}", $SGD_Graficos_division[0], $rows_DIV7);
    }


//AGRUPACION 2
    $SGD_gerencia_divisiones = SGD_AgrupacionGerenciaDivision($id_empresa, $id_proceso, $arreglo_post);
    foreach ($SGD_gerencia_divisiones as $unico) {
        $SGD_Graficos_division = SGD_DatosTablaRelacionesPorEvaluadoEvaluadorFull($id_empresa, $subperfil, $unico->evaluado_division, $unico->evaluado_gerencia, $area);
        $rows_AG2_DIV3 .= file_get_contents("views/sgd/seguimiento_eval_evaluador/row_division_seguimiento.html");
        $rows_AG2_DIV3 = str_replace("{AGRUPACION}", $unico->evaluado_division . " _ " . $unico->evaluado_gerencia, $rows_AG2_DIV3);
        $rows_AG2_DIV3 = str_replace("{AGRUPACION_TOTAL}", $SGD_Graficos_division[0], $rows_AG2_DIV3);

        $progress3 = round(100 * $SGD_Graficos_division[3] / $SGD_Graficos_division[0]);
        $rows_AG2_DIV3 = str_replace("{AGRUPACION_PROGRESS1}", $progress3, $rows_AG2_DIV3);
        $rows_AG2_DIV3 = str_replace("{REALIZADO_EVALUABLES}", $SGD_Graficos_division[3], $rows_AG2_DIV3);
        $rows_AG2_DIV3 = str_replace("{TOTAL_EVALUABLES}", $SGD_Graficos_division[0], $rows_AG2_DIV3);
    }


    $PRINCIPAL = str_replace("{ROW_LISTADO_AGRUPACION_RANKING1}", ($rows_DIV1), $PRINCIPAL);
    $PRINCIPAL = str_replace("{ROW_LISTADO_AGRUPACION_RANKING2}", ($rows_DIV2), $PRINCIPAL);

    $PRINCIPAL = str_replace("{ROW_LISTADO_AGRUPACION_RANKING3}", ($rows_DIV3), $PRINCIPAL);
    $PRINCIPAL = str_replace("{ROW_LISTADO_AGRUPACION2_RANKING3}", ($rows_AG2_DIV3), $PRINCIPAL);

    $PRINCIPAL = str_replace("{ROW_LISTADO_AGRUPACION_RANKING4}", ($rows_DIV4), $PRINCIPAL);
    $PRINCIPAL = str_replace("{ROW_LISTADO_AGRUPACION_RANKING5}", ($rows_DIV5), $PRINCIPAL);
    $PRINCIPAL = str_replace("{ROW_LISTADO_AGRUPACION_RANKING6}", ($rows_DIV6), $PRINCIPAL);
    $PRINCIPAL = str_replace("{ROW_LISTADO_AGRUPACION_RANKING7}", ($rows_DIV7), $PRINCIPAL);


    $AvancePorcentaje = round(100 * $cuenta_finalizados / $cuenta_todos);
    $AvancePorcentajeComplemento = 100 - $AvancePorcentaje;
    $PRINCIPAL = str_replace("{AVANCE_SEGUIMIENTO}", utf8_encode($AvancePorcentaje), $PRINCIPAL);
    $PRINCIPAL = str_replace("{AVANCE_SEGUIMIENTO_COMPLEMENTO}", utf8_encode($AvancePorcentajeComplemento), $PRINCIPAL);
    return ($PRINCIPAL);
}


function SGD_Resultados_Evaluacion($PRINCIPAL, $id_empresa, $id_proceso, $excel)
{
    //total Usuarios Empresa
    $SGD_Todas_Resultados_evaluados = SGD_DatosTablaResultadosPorEvaluado($id_empresa, $id_proceso);
    //echo "<pre>";
    //print_r($SGD_Todas_Resultados_evaluados);
    //exit();
    //traigo los programas por empresa
    $sumaDimPunt = 0;
    $Cuentadimpunt = 0;
    if ($id_empresa == 79) {
        $cuentaDime = 1;
    } else {
        $cuentaDime = 2;
    }
    foreach ($SGD_Todas_Resultados_evaluados as $SGD_Todas_Resultado_evaluado) {
        $cuentalinea++;
        $evaluado = "<strong>" . $SGD_Todas_Resultado_evaluado->NombreEvaluado . "</strong>
        <br>" . $SGD_Todas_Resultado_evaluado->CargoEvaluado . "<br>
        <small>" . $SGD_Todas_Resultado_evaluado->GerenciaEvaluado . "</small>";
        $evaluador = "<strong>" . $SGD_Todas_Resultado_evaluado->NombreEvaluador . "</strong>
        <br>" . $SGD_Todas_Resultado_evaluado->CargoEvaluador . "<br>
        <small>" . $SGD_Todas_Resultado_evaluado->GerenciaEvaluador . "</small>";
        $SGD_Todas_Resultado_evaluado->NombreDim;
        $SGD_Todas_Resultado_evaluado->Puntaje;
        if ($SGD_Todas_Resultado_evaluado->DimOpcional == 0) {
            $sumaDimPunt = $sumaDimPunt + $SGD_Todas_Resultado_evaluado->Puntaje;
            $Cuentadimpunt++;
        }
        //$SGD_dim1=0;$SGD_dim2=0;$SGD_dim3=0;
        if ($cuentalinea == 1) {
            $SGD_dim1 = $SGD_Todas_Resultado_evaluado->Puntaje;
        }
        if ($cuentalinea == 2) {
            $SGD_dim2 = $SGD_Todas_Resultado_evaluado->Puntaje;
        }
        if ($cuentalinea == 3) {
            $SGD_dim3 = $SGD_Todas_Resultado_evaluado->Puntaje;
        }
        //echo "<br>cuentalinea $cuentalinea $SGD_dim1 $SGD_dim2 $SGD_dim3";
        //echo "<br>".$promedio_Resultado;
        if ($cuentalinea % $cuentaDime == 0) {
            $cuentalinea = 0;
            if ($id_empresa == 79) {
                $promedio_Resultado = round($sumaDimPunt / $Cuentadimpunt, 1);
            } else {
                $promedio_Resultado = round($sumaDimPunt / $Cuentadimpunt, 2);
            }
            $sumaDimPunt = 0;
            $Cuentadimpunt = 0;
            if ($excel == 1) {
                $rows = file_get_contents("views/sgd/resultados/" . $id_empresa . "_row_listado_excel.html");
            } else {
                $rows .= file_get_contents("views/sgd/resultados/" . $id_empresa . "_row_listado.html");
            }
            $rows = str_replace("{EVALUADO}", $evaluado, $rows);
            $rows = str_replace("{EVALUADOR}", $evaluador, $rows);
            $rows = str_replace("{RESULTADO_FINAL}", $promedio_Resultado, $rows);
            $rows = str_replace("{DIM1}", $SGD_dim1, $rows);
            $rows = str_replace("{DIM2}", $SGD_dim2, $rows);
            $rows = str_replace("{DIM3}", $SGD_dim3, $rows);
            //EXCEL
            $rows = str_replace("{RutEvaluado}", $SGD_Todas_Resultado_evaluado->RutEvaluado, $rows);
            $rows = str_replace("{NombreEvaluado}", $SGD_Todas_Resultado_evaluado->NombreEvaluado, $rows);
            $rows = str_replace("{CargoEvaluado}", $SGD_Todas_Resultado_evaluado->CargoEvaluado, $rows);
            $rows = str_replace("{GerenciaEvaluado}", $SGD_Todas_Resultado_evaluado->GerenciaEvaluado, $rows);
            $rows = str_replace("{RutEvaluador}", $SGD_Todas_Resultado_evaluado->RutEvaluador, $rows);
            $rows = str_replace("{NombreEvaluador}", $SGD_Todas_Resultado_evaluado->NombreEvaluador, $rows);
            $rows = str_replace("{CargoEvaluador}", $SGD_Todas_Resultado_evaluado->CargoEvaluador, $rows);
            $rows = str_replace("{GerenciaEvaluador}", $SGD_Todas_Resultado_evaluado->GerenciaEvaluador, $rows);
            $rows = str_replace("{TipoEvaluacion}", $SGD_Todas_Resultado_evaluado->NombreSubPerfil, $rows);
            $rows = str_replace("{Perfil}", $SGD_Todas_Resultado_evaluado->Perfil, $rows);
            $rows = str_replace("{Proceso}", $SGD_Todas_Resultado_evaluado->Proceso, $rows);
            if ($excel == 1) {
                echo $rows;
            }
        }
    }
    $PRINCIPAL = str_replace("{ROW_LISTADO}", utf8_encode($rows), $PRINCIPAL);
    return ($PRINCIPAL);
}

function SGD_Resultados_Calibracion($PRINCIPAL, $id_empresa, $id_proceso, $excel, $arreglo_post)
{
    $SGD_Todas_Calibracion_evaluados = SGD_DatosTablaCalibracionPorEvaluado($id_empresa, $id_proceso);
    //echo "aca1<br>";
//print_r($SGD_Todas_Calibracion_evaluados);
//echo "<br>aca2";
//exit;
    //    print_r($SGD_Todas_Calibracion_evaluados);exit;
    //echo "<pre>";
    //print_r($arreglo_post);
    //exit();
    //traigo los programas por empresa
    $sumaDimPunt = 0;
    $Cuentadimpunt = 0;
    $cuentaDime = 2;
    $primer_evaluador = "";
    $ArregloCriterios[5] = 0;
    $ArregloCriterios[1] = 0;
    $ArregloCriterios[2] = 0;
    $ArregloCriterios[3] = 0;
    $ArregloCriterios[4] = 0;
    $SGD_dim1 = 0;
    $SGD_dim2 = 0;
    $SGD_dim3 = 0;
    foreach ($SGD_Todas_Calibracion_evaluados as $SGD_Todas_Calibracion_evaluado) {
        if ($arreglo_post["filtrado"]) {
            if ($arreglo_post["check_evaluador_" . $SGD_Todas_Calibracion_evaluado->RutEvaluador]) {
                $cuentalinea++;
            } else {
                continue;
            }
        } else {
            $cuentalinea++;
        }
        $SGD_Todas_Calibracion_evaluado->NombreDim;
        $SGD_Todas_Calibracion_evaluado->Puntaje;
        if ($SGD_Todas_Calibracion_evaluado->DimOpcional == 0) {
            $sumaDimPunt = $sumaDimPunt + $SGD_Todas_Calibracion_evaluado->Puntaje;
            $Cuentadimpunt++;
        }
        if ($cuentalinea == 1) {
            $SGD_dim1 = $SGD_Todas_Calibracion_evaluado->Puntaje;
        }
        if ($cuentalinea == 2) {
            $SGD_dim2 = $SGD_Todas_Calibracion_evaluado->Puntaje;
        }
        if ($cuentalinea == 3) {
            $SGD_dim3 = $SGD_Todas_Calibracion_evaluado->Puntaje;
        }
//echo "<br>..".$SGD_Todas_Calibracion_evaluado->RutEvaluador."-evaluado-".$SGD_Todas_Calibracion_evaluado->RutEvaluado."<br>cuentalinea $cuentalinea $SGD_dim1 $SGD_dim2 $SGD_dim3";
//echo     "<br>$cuentalinea % $cuentaDime";
        if ($cuentalinea % $cuentaDime == 0) {
            $cuentalinea = 0;
            $promedio_Resultado = round($sumaDimPunt / $Cuentadimpunt, 2);
            //    echo "<br>$sumaDimPunt/$Cuentadimpunt";
            //    echo "<br>promedio_Resultado ".$promedio_Resultado;
            $sumaDimPunt = 0;
            $Cuentadimpunt = 0;
            if ($excel == 1) {
                if ($primer_evaluador <> $SGD_Todas_Calibracion_evaluado->RutEvaluador) {
                    $rows .= file_get_contents("views/sgd/calibracion/row_listado_excel.html");
                    $primer_evaluador = $SGD_Todas_Calibracion_evaluado->RutEvaluador;
                } else {
                    $primer_evaluador = $SGD_Todas_Calibracion_evaluado->RutEvaluador;
                }
            } else {
                if ($primer_evaluador <> $SGD_Todas_Calibracion_evaluado->RutEvaluador) {
                    $rows .= file_get_contents("views/sgd/calibracion/row_listado.html");
                    $primer_evaluador = $SGD_Todas_Calibracion_evaluado->RutEvaluador;
                } else {
                    $primer_evaluador = $SGD_Todas_Calibracion_evaluado->RutEvaluador;
                }
            }
            $rows = str_replace("{EVALUADOR_CALIBRACION}", $SGD_Todas_Calibracion_evaluado->NombreEvaluador, $rows);
            $rows = str_replace("{EVALUADOR_JEFE}", $SGD_Todas_Calibracion_evaluado->NombreValidador, $rows);
            $rows = str_replace("{EVALUADOR_GERENCIA}", $SGD_Todas_Calibracion_evaluado->GerenciaEvaluador, $rows);
            //EXCEL
            $rows = str_replace("{RutEvaluado}", $SGD_Todas_Calibracion_evaluado->RutEvaluado, $rows);
            $rows = str_replace("{NombreEvaluado}", $SGD_Todas_Calibracion_evaluado->NombreEvaluado, $rows);
            $rows = str_replace("{CargoEvaluado}", $SGD_Todas_Calibracion_evaluado->CargoEvaluado, $rows);
            $rows = str_replace("{GerenciaEvaluado}", $SGD_Todas_Calibracion_evaluado->GerenciaEvaluado, $rows);
            $rows = str_replace("{RutEvaluador}", $SGD_Todas_Calibracion_evaluado->RutEvaluador, $rows);
            $rows = str_replace("{NombreEvaluador}", $SGD_Todas_Calibracion_evaluado->NombreEvaluador, $rows);
            $rows = str_replace("{CargoEvaluador}", $SGD_Todas_Calibracion_evaluado->CargoEvaluador, $rows);
            $rows = str_replace("{GerenciaEvaluador}", $SGD_Todas_Calibracion_evaluado->GerenciaEvaluador, $rows);
            $rows = str_replace("{TipoEvaluacion}", $SGD_Todas_Calibracion_evaluado->NombreSubPerfil, $rows);
            $rows = str_replace("{Perfil}", $SGD_Todas_Calibracion_evaluado->Perfil, $rows);
            $rows = str_replace("{Proceso}", $SGD_Todas_Calibracion_evaluado->Proceso, $rows);
            if ($excel == 1) {
                echo $rows;
            }
            //echo "<br> evaluador ".$SGD_Todas_Calibracion_evaluado->RutEvaluador.            "_ evaluado ".$SGD_Todas_Calibracion_evaluado->RutEvaluado.            "_Prom_".$promedio_Resultado;
            $rangosArray = SGD_Entrega_RangosFrecuenciaCalibracion($SGD_Todas_Calibracion_evaluado->IdPerfil);
            foreach ($rangosArray as $rangoPuntaje) {
                if ($promedio_Resultado >= $rangoPuntaje->rangomenor and $promedio_Resultado < $rangoPuntaje->rangomayor) {
                    $ArregloCriterios[$rangoPuntaje->dimension]++;
                }
                //    echo "<br>.....................hola ".$promedio_Resultado;
                //if($promedio_Resultado>=$rangoPuntaje->rangomenor and $promedio_Resultado<$rangoPuntaje->rangomayor){
                /*if($promedio_Resultado>=1 and $promedio_Resultado<1){
                    $ArregloCriterios[1]++;
                }else if($promedio_Resultado>=2 and $promedio_Resultado<2){
                    $ArregloCriterios[2]++;
                }else if($promedio_Resultado>=3 and $promedio_Resultado<3){
                    $ArregloCriterios[3]++;
                }else if($promedio_Resultado>=4 and $promedio_Resultado<4){
                    $ArregloCriterios[4]++;
                }else if($promedio_Resultado>=5 and $promedio_Resultado<5){
                    $ArregloCriterios[5]++;
                }*/
            }
        }
    }
    ksort($ArregloCriterios);
    //print_r($ArregloCriterios);
    foreach ($ArregloCriterios as $key => $value) {
        //echo "<br>..............................$key is at $value<br>";
        $IdCriterios = SGD_Entrega_IdCriterio($key, $SGD_Todas_Calibracion_evaluado->IdPerfil);
        $ArreglosGraficos[$IdCriterios[0]->criterio] = $value;
    }
//    print_r($ArreglosGraficos);
    foreach ($ArreglosGraficos as $ArregloGrafico_key => $ArregloGrafico_value) {
        $kk++;
        $PRINCIPAL = str_replace("{NIVEL_GRAF_CAL_" . $kk . "}", $ArregloGrafico_value, $PRINCIPAL);
        $PRINCIPAL = str_replace("{NIVEL_TEXTO_GRAF_CAL_" . $kk . "}", $ArregloGrafico_key, $PRINCIPAL);
    }
    $PRINCIPAL = str_replace("{NIVEL_TEXTO_GRAF_CAL_1}", "No Cumple", $PRINCIPAL);
    $PRINCIPAL = str_replace("{NIVEL_TEXTO_GRAF_CAL_2}", "Proximo", $PRINCIPAL);
    $PRINCIPAL = str_replace("{NIVEL_TEXTO_GRAF_CAL_3}", "Esperado", $PRINCIPAL);
    $PRINCIPAL = str_replace("{NIVEL_TEXTO_GRAF_CAL_4}", "Superior", $PRINCIPAL);
    $PRINCIPAL = str_replace("{NIVEL_TEXTO_GRAF_CAL_5}", "Excepcional", $PRINCIPAL);
    $PRINCIPAL = str_replace("{NIVEL_GRAF_CAL_1}", "2", $PRINCIPAL);
    $PRINCIPAL = str_replace("{NIVEL_GRAF_CAL_2}", "3", $PRINCIPAL);
    $PRINCIPAL = str_replace("{NIVEL_GRAF_CAL_3}", "3", $PRINCIPAL);
    $PRINCIPAL = str_replace("{NIVEL_GRAF_CAL_4}", "4", $PRINCIPAL);
    $PRINCIPAL = str_replace("{NIVEL_GRAF_CAL_5}", "2", $PRINCIPAL);
    $PRINCIPAL = str_replace("{ROW_LISTADO}", utf8_encode($rows), $PRINCIPAL);
    return ($PRINCIPAL);
}

function SGD_Matriz_Evaluacion_Solicitudes($PRINCIPAL, $id_empresa)
{
    //total Usuarios Empresa
    $id_proceso = $id_proceso_sgd;;
    $SGD_Todas_Matriz_evaluados = SGD_DatosTablaRelacionesSolicitudes($id_empresa, $id_proceso);
    foreach ($SGD_Todas_Matriz_evaluados as $SGD_Matriz_evaluado) {
        $evaluado = "<strong>" . $SGD_Matriz_evaluado->NombreEvaluado . "</strong>
        <br>" . $SGD_Matriz_evaluado->CargoEvaluado . "<br>
        <small>" . $SGD_Matriz_evaluado->GerenciaEvaluado . "</small>";
        if ($SGD_Matriz_evaluado->estado == '1') {
            $datos_solicitud = "<div class='alert alert-success' role='alert'>
          <strong>Validado</strong>
        </div>";
        }
        if ($SGD_Matriz_evaluado->estado == '2') {
            $datos_solicitud = "<div class='alert alert-danger' role='alert'>
          <strong>Solicitud de dejar como NO EVALUABLE</strong><br>Razon: " . $SGD_Matriz_evaluado->comentario . ".
        </div>";
        }
        if ($SGD_Matriz_evaluado->estado == '3') {
            $datos_solicitud = "<div class='alert alert-warning' role='alert'>
          <strong>Solicitud de Agregar Colaborador</strong>.
        </div>";
        }
        if ($SGD_Matriz_evaluado->estado == '4') {
            $datos_solicitud = "<div class='alert alert-danger' role='alert'>
          <strong>Solicitud de Reasignacion de Evaluado</strong> <br> Validar Nuevo Evaluador " . $SGD_Matriz_evaluado->NombreNuevoJefeEvaluado . "</div>";
        }
        $evaluador = "<strong>" . $SGD_Matriz_evaluado->NombreEvaluador . "</strong>
        <br>" . $SGD_Matriz_evaluado->CargoEvaluador . "<br>
        <small>" . $SGD_Matriz_evaluado->GerenciaEvaluador . "</small>";
        $validador = "<strong>" . $SGD_Matriz_evaluado->NombreValidador . "</strong>
        <br>" . $SGD_Matriz_evaluado->CargoValidador . "<br>
        <small>" . $SGD_Matriz_evaluado->GerenciaValidador . "</small>";
        $calibrador = "<strong>" . $SGD_Matriz_evaluado->NombreCalibrador . "</strong>
        <br>" . $SGD_Matriz_evaluado->CargoCalibrador . "<br>
        <small>" . $SGD_Matriz_evaluado->GerenciaCalibrador . "</small>";
        $rows .= file_get_contents("views/sgd/matriz/row_listado_solicitudes.html");
        $rows = str_replace("{ID_SOLICITUD}", $SGD_Matriz_evaluado->id, $rows);
        $rows = str_replace("{EVALUADO}", $evaluado, $rows);
        $rows = str_replace("{DATOS_SOLICITUD}", $datos_solicitud, $rows);
        $rows = str_replace("{EVALUADOR}", $evaluador, $rows);
        $rows = str_replace("{VALIDADOR}", $validador, $rows);
        $rows = str_replace("{CALIBRADOR}", $calibrador, $rows);
        $rows = str_replace("{EVALUADO_ACTUAL}", $SGD_Matriz_evaluado->evaluado, $rows);
        $rows = str_replace("{EVALUADOR_ACTUAL}", $SGD_Matriz_evaluado->evaluador, $rows);
        $rows = str_replace("{VALIDADOR_ACTUAL}", $SGD_Matriz_evaluado->validador, $rows);
        $rows = str_replace("{CALIBRADOR_ACTUAL}", $SGD_Matriz_evaluado->calibrador, $rows);
        $rows = str_replace("{ID_PROCESO}", $id_proceso, $rows);
        $rows = str_replace("{ID_SGD_SOLICITUD}", $SGD_Matriz_evaluado->id, $rows);
        $rows = str_replace("{ID_SGD_RELACIONES}", $SGD_Matriz_evaluado->idsgdrelaciones, $rows);
    }
    $PRINCIPAL = str_replace("{ROW_LISTADO_SOLICITUDES}", utf8_encode($rows), $PRINCIPAL);
    return ($PRINCIPAL);
}

function SGD_Matriz_Evaluacion_Solicitudes_Pendientes($PRINCIPAL, $id_empresa)
{
    //total Usuarios Empresa
    $id_proceso = $id_proceso_sgd;;
    $SGD_Todas_Matriz_evaluados = SGD_DatosTablaRelacionesSolicitudesPendientes($id_empresa, $id_proceso);
    foreach ($SGD_Todas_Matriz_evaluados as $SGD_Matriz_evaluado) {
        $texto_status = "PENDIENTE DE VALIDAR";
        if ($SGD_Matriz_evaluado->EstadoEquipo == '1') {
            continue;
        }
        if ($SGD_Matriz_evaluado->EstadoEquipo == '2') {
            continue;
        }
        if ($SGD_Matriz_evaluado->EstadoEquipo == '3') {
            continue;
        }
        if ($SGD_Matriz_evaluado->EstadoEquipo == '4') {
            continue;
        }
        if ($SGD_Matriz_evaluado->EstadoEquipo == '11') {
            $texto_status = "USUARIO VALIDADO";
        }
        if ($SGD_Matriz_evaluado->EstadoEquipo == '22') {
            $texto_status = "USUARIO NO EVALUABLE VALIDADO";
        }
        if ($SGD_Matriz_evaluado->EstadoEquipo == '33') {
            $texto_status = "USUARIO REASIGNADO VALIDADO";
        }
        if ($SGD_Matriz_evaluado->EstadoEquipo == '44') {
            $texto_status = "USUARIO AGREGADO VALIDADO";
        }
        $evaluado = "<strong>" . $SGD_Matriz_evaluado->NombreEvaluado . "</strong>
        <br>" . $SGD_Matriz_evaluado->CargoEvaluado . "<br>
        <small>" . $SGD_Matriz_evaluado->GerenciaEvaluado . "</small>";
        $evaluador = "<strong>" . $SGD_Matriz_evaluado->NombreEvaluador . "</strong>
        <br>" . $SGD_Matriz_evaluado->CargoEvaluador . "<br>
        <small>" . $SGD_Matriz_evaluado->GerenciaEvaluador . "</small>";
        $validador = "<strong>" . $SGD_Matriz_evaluado->NombreValidador . "</strong>
        <br>" . $SGD_Matriz_evaluado->CargoValidador . "<br>
        <small>" . $SGD_Matriz_evaluado->GerenciaValidador . "</small>";
        $calibrador = "<strong>" . $SGD_Matriz_evaluado->NombreCalibrador . "</strong>
        <br>" . $SGD_Matriz_evaluado->CargoCalibrador . "<br>
        <small>" . $SGD_Matriz_evaluado->GerenciaCalibrador . "</small>";
        $rows .= file_get_contents("views/sgd/matriz/row_listado_solicitudes_pendientes.html");
        $rows = str_replace("{TIPO_STATUS}", $texto_status, $rows);
        $rows = str_replace("{EVALUADO}", $evaluado, $rows);
        $rows = str_replace("{DATOS_SOLICITUD}", $datos_solicitud, $rows);
        $rows = str_replace("{EVALUADOR}", $evaluador, $rows);
        $rows = str_replace("{VALIDADOR}", $validador, $rows);
        $rows = str_replace("{CALIBRADOR}", $calibrador, $rows);
        $rows = str_replace("{EVALUADO_ACTUAL}", $SGD_Matriz_evaluado->evaluado, $rows);
        $rows = str_replace("{EVALUADOR_ACTUAL}", $SGD_Matriz_evaluado->evaluador, $rows);
        $rows = str_replace("{VALIDADOR_ACTUAL}", $SGD_Matriz_evaluado->validador, $rows);
        $rows = str_replace("{CALIBRADOR_ACTUAL}", $SGD_Matriz_evaluado->calibrador, $rows);
        $rows = str_replace("{ID_PROCESO}", $id_proceso, $rows);
        $rows = str_replace("{ID_SGD_SOLICITUD}", $SGD_Matriz_evaluado->id, $rows);
        $rows = str_replace("{ID_SGD_RELACIONES}", $SGD_Matriz_evaluado->idsgdrelaciones, $rows);
    }
    $PRINCIPAL = str_replace("{ROW_LISTADO_SOLICITUDES_PENDIENTES}", utf8_encode($rows), $PRINCIPAL);
    return ($PRINCIPAL);
}

function ListadoProgramasBBDD($PRINCIPAL, $id_empresa, $id_programa, $id_curso)
{
    //total Usuarios Empresa
    $total_usuarios = DatosTablaUsuarioTodosPorEmpresa($id_empresa);
    //traigo los programas por empresa
    $programasBBDD = IMPARTCION_ObtieneProgramasBBDD($id_empresa, $id_programa, $id_curso);
    foreach ($programasBBDD as $prog) {

        $rows .= file_get_contents("views/capacitacion/programasbbdd/row_listado.html");
        $rows = str_replace("{CODIGO_PROGRAMA}", $prog->id_programa, $rows);
        $rows = str_replace("{NOMBRE_PROGRAMA}", $prog->nombre_programa, $rows);
        $rows = str_replace("{FOCO}", $prog->foco, $rows);
        $total_mallas_por_programa = TraeMallasDadoPrograma($id_empresa, $prog->id_programa);
        //print_r($total_mallas_por_programa);
        $rows = str_replace("{TOTAL_MALLAS_ELEARNING}", count($total_mallas_por_programa), $rows);
        $rows = str_replace("{TOTAL_USUARIOS}", count($total_usuarios), $rows);
        //Ahora veo cuantos usuarios hay con todas las mallas de este programa
        $cuenta_total_usuarios_por_programa = totalUsuariosPorProgramaConMallasLight($id_empresa, $total_mallas_por_programa);
        $rows = str_replace("{TOTAL_USUARIOS_INSCRITOS}", $cuenta_total_usuarios_por_programa, $rows);
        //por cada programa, traigo las mallas que le corresponden
        //$mallas_por_programa=IMPARTCION_TraigoMallasPorProgramaPorEmpresa($prog->id_programa, $id_empresa);
        $options_mallas = "";
        foreach ($mallas_por_programa as $malla) {
            $options_mallas .= "<option value='" . $malla->id_malla . "'>" . $malla->nombre_malla . "</option>";
        }
        $VAR_muestraidmalla = "";
        foreach ($total_mallas_por_programa as $total_malla_por_programa) {
            //    $num_inscritos_malla=totalUsuariosPorMallas($id_empresa,  $total_malla_por_programa->id_malla);
            $VAR_muestraidmalla .= $total_malla_por_programa->id_malla . " | ";
        }
        $rows = str_replace("{MUESTRA_ID_MALLAS}", $VAR_muestraidmalla, $rows);
        $rows = str_replace("{MALLAS_POR_PROGRAMA}", $options_mallas, $rows);
    }
    $PRINCIPAL = str_replace("{ROW_LISTADO}", utf8_encode($rows), $PRINCIPAL);
    return ($PRINCIPAL);
}

function ListadoProgramasBBDDI($PRINCIPAL, $id_empresa, $id_programa, $id_curso)
{
    //total Usuarios Empresa
    $total_usuarios = DatosTablaUsuarioTodosPorEmpresa($id_empresa);
    //traigo los programas por empresa
    $programasBBDD = IMPARTCION_ObtieneProgramasBBDDI($id_empresa, $id_programa, $id_curso);
    foreach ($programasBBDD as $prog) {

        $rows .= file_get_contents("views/capacitacion/programasbbddI/row_listado.html");
        $rows = str_replace("{CODIGO_PROGRAMA}", $prog->id_programa, $rows);
        $rows = str_replace("{NOMBRE_PROGRAMA}", $prog->nombre_programa, $rows);
        $rows = str_replace("{FOCO}", $prog->foco, $rows);
        $total_mallas_por_programa = TraeMallasDadoPrograma($id_empresa, $prog->id_programa);
        //print_r($total_mallas_por_programa);
        $rows = str_replace("{TOTAL_MALLAS_ELEARNING}", count($total_mallas_por_programa), $rows);
        $rows = str_replace("{TOTAL_USUARIOS}", count($total_usuarios), $rows);
        //Ahora veo cuantos usuarios hay con todas las mallas de este programa
        $cuenta_total_usuarios_por_programa = totalUsuariosPorProgramaConMallasLight($id_empresa, $total_mallas_por_programa);
        $rows = str_replace("{TOTAL_USUARIOS_INSCRITOS}", $cuenta_total_usuarios_por_programa, $rows);
        //por cada programa, traigo las mallas que le corresponden
        //$mallas_por_programa=IMPARTCION_TraigoMallasPorProgramaPorEmpresa($prog->id_programa, $id_empresa);
        $options_mallas = "";
        foreach ($mallas_por_programa as $malla) {
            $options_mallas .= "<option value='" . $malla->id_malla . "'>" . $malla->nombre_malla . "</option>";
        }
        $VAR_muestraidmalla = "";
        foreach ($total_mallas_por_programa as $total_malla_por_programa) {
            //    $num_inscritos_malla=totalUsuariosPorMallas($id_empresa,  $total_malla_por_programa->id_malla);
            $VAR_muestraidmalla .= $total_malla_por_programa->id_malla . " | ";
        }
        $rows = str_replace("{MUESTRA_ID_MALLAS}", $VAR_muestraidmalla, $rows);
        $rows = str_replace("{MALLAS_POR_PROGRAMA}", $options_mallas, $rows);
    }
    $PRINCIPAL = str_replace("{ROW_LISTADO}", utf8_encode($rows), $PRINCIPAL);
    return ($PRINCIPAL);
}


function ActualizaAsistenciaCursoExt($PRINCIPAL, $id_empresa, $id_curso)
{
    //total Usuarios Empresa
    //traigo los programas por empresa
    $lineasCursos = CursosExtUsuariosNotasAsistencia($id_empresa, $id_curso);
    //print_r($usuarios);

    foreach ($lineasCursos as $unico) {

        // print_r($unico);
        $rows .= file_get_contents("views/capacitacion/programasbbdd/row_listado_cursos_ext.html");

        $rows = str_replace("{RUT}", $unico->rut, $rows);
        $rows = str_replace("{NOMBRE}", $unico->nombreusuario, $rows);
        $rows = str_replace("{NOMBRE_CURSO}", $unico->nombrecurso, $rows);
        $rows = str_replace("{ESTADO}", $unico->estado_descripcion, $rows);
        $rows = str_replace("{AVANCE}", $unico->avance, $rows);
        $rows = str_replace("{NOTA}", $unico->nota, $rows);
        $rows = str_replace("{FECHA}", $unico->fecha, $rows);
    }
    $PRINCIPAL = str_replace("{LISTADO_LINEAS_DATA}", utf8_encode($rows), $PRINCIPAL);
    return ($PRINCIPAL);
}

function ColocaResultadosSGDPorProceso($id_proceso, $id_empresa)
{
$relaciones = TraeRelacionesProcesosConDetalle($id_empresa, $id_proceso);
//Traigo distinct de competencias
$competencias = DistinctDeCompetenciasPorEmpresaIdComponenteReporte($id_empresa);
?>
<table border="1">
    <tr>
        <td>Rut Evaluador</td>
        <td>Nombre Evaluador</td>
        <td>Cargo Evaluador</td>
        <td>Campo 1 Evaluador</td>
        <td>Campo 2 Evaluador</td>
        <td>Campo 3 Evaluador</td>
        <td>Rut Evaluado</td>
        <td>Nombre Evaluado</td>
        <td>Cargo Evaluado</td>
        <td>Campo 1 Evaluado</td>
        <td>Campo 2 Evaluado</td>
        <td>Campo 3 Evaluado</td>
        <td>Perfil de Evaluacion</td>
        <td>Nota Final</td>
        <td>Categoria Nota Final</td>
        <?php
        foreach ($competencias as $comp) {
            ?>
            <td><?php echo $comp->nombre_competencia; ?></td>
            <?php
            $preguntas = SGD_PreguntasPorIdComponenteReporteAgrupadosPorDeterminante($comp->id_componente_reporte, $id_empresa);
            foreach ($preguntas as $preg) {
                ?>
                <td><?php echo $preg->nombre_pregunta; ?></td>
                <?php
            }
        }
        ?>
        <td>Comentarios Finales</td>
    </tr>
    <?php
    foreach ($relaciones as $rel) {
        ?>
        <tr>
            <td><?php echo($rel->evaluado) ?></td>
            <td><?php echo($rel->nombre_evaluado) ?></td>
            <td><?php echo($rel->cargo_evaluado) ?></td>
            <td><?php echo($rel->c1_evaluado) ?></td>
            <td><?php echo($rel->c2_evaluado) ?></td>
            <td><?php echo($rel->c3_evaluado) ?></td>
            <td><?php echo($rel->evaluador) ?></td>
            <td><?php echo($rel->nombre_evaluador) ?></td>
            <td><?php echo($rel->cargo_evaluador) ?></td>
            <td><?php echo($rel->c1_evaluador) ?></td>
            <td><?php echo($rel->c2_evaluador) ?></td>
            <td><?php echo($rel->c3_evaluador) ?></td>
            <td><?php echo($rel->perfil_evaluacion_competencias) ?></td>
            <?php
            if ($rel->fecha_finalizacion) {
                $promedio_por_competencias = PromedioPorCompetencias($rel->evaluado, $rel->evaluador, $rel->id_proceso);
                $datos_criterio_nota_fina = ObtenerCriterioPuntajeMatrizNotaFinal($promedio_por_competencias[0]->nota_promedio, "", 0, "nota_final", $rel->evaluador, $rel->id_proceso);
                ?>
                <td><?php echo round($promedio_por_competencias[0]->nota_promedio, 2) ?></td>
                <td><?php echo $datos_criterio_nota_fina[0] ?></td>
                <?php
                foreach ($competencias as $comp) {
                    $datos_competencia_real = SGD_TraigoDatosCompetenciaDadoComponenteReporteYPerfil($rel->perfil_evaluacion_competencias, $comp->id_componente_reporte);
                    //$resultado_competencia=SGD_ResultadoPorCompetenciaIdComponenteReporte($rel->evaluado, $rel->evaluador, $rel->id_proceso, $comp->id_componente_reporte);
                    $resultado_competencia = SGD_ResultadoPorCompetenciaIdComponenteReporte($rel->evaluado, $rel->evaluador, $rel->id_proceso, $datos_competencia_real[0]->id_competencia);
                    ?>
                    <td><?php echo $resultado_competencia[0]->nota; ?></td>
                    <?php
                    $preguntas = SGD_PreguntasPorIdComponenteReporteAgrupadosPorDeterminante($comp->id_componente_reporte, $id_empresa);
                    foreach ($preguntas as $preg) {
                        //$respuesta=SGD_TraigoRespuestaPorDeterminante($rel->evaluado, $rel->evaluador, $rel->id_proceso, $preg->id_determinante, $comp->id);
                        $respuesta = SGD_TraigoRespuestaPorDeterminante($rel->evaluado, $rel->evaluador, $rel->id_proceso, $preg->id_determinante, $datos_competencia_real[0]->id_competencia);
                        ?>
                        <td><?php echo $respuesta[0]->respuesta; ?></td>
                        <?php
                    }
                }
            } else {
                ?>
                <?php
            }
            ?>
            <td><?php echo $rel->comentarios_finales; ?></td>
        </tr>
        <?php
    }
    }

    function MejoresPracticas_Comentarios_Concurso($id_mp, $id_empresa){
    $Comentarios = TraeComentariosPorEmpresaIdMP($id_mp, $id_empresa);
    ?>
    <table border="0">
        <tr>
            <td>IdMP</td>
            <td>Fecha</td>
            <td>Comentario</td>
            <td>Rut</td>
            <td>Nombre</td>
            <td>Cargo</td>
            <td>Gerencia</td>
        </tr>
        <?php
        foreach ($Comentarios as $Comentario) {
            ?>
            <tr>
                <td><?php echo $id_mp; ?></td>
                <td><?php echo($Comentario->fecha) ?></td>
                <td><?php echo($Comentario->comentario) ?></td>
                <td><?php echo($Comentario->rut_completo) ?></td>
                <td><?php echo($Comentario->nombre_completo) ?></td>
                <td><?php echo($Comentario->cargo) ?></td>
                <td><?php echo($Comentario->gerencia) ?></td>
            </tr>
            <?php
        }
        }
        function ColocaResultadosSGDPorProcesoAE($id_proceso, $id_empresa)
        {
        $relaciones=TraeRelacionesProcesosConDetalle($id_empresa,$id_proceso);
        //Traigo distinct de competencias
        $competencias=DistinctDeCompetenciasPorEmpresaIdComponenteReporte($id_empresa);
        ?>
        <table border="0">
            <tr>
                <td>Rut</td>
                <td>Nombre</td>
                <td>Cargo</td>
                <td>C1</td>
                <td>C2</td>
                <td>C3</td>
                <td>Perfil</td>
                <td>Nota Final</td>
                <td>Categoria Nota Final</td>
                <?php
                foreach($competencias as $comp){
                    ?>
                    <td><?php echo $comp->nombre_competencia; ?></td>
                    <?php
                    $preguntas=SGD_PreguntasPorIdComponenteReporteAgrupadosPorDeterminante($comp->id_componente_reporte, $id_empresa);
                    foreach($preguntas as $preg){
                        ?>
                        <td><?php echo $preg->nombre_pregunta; ?></td>
                        <?php
                    }
                }
                ?>
                <td>Comentarios Finales</td>
            </tr>
            <?php
            foreach($relaciones as $rel){
                ?>
                <tr>
                    <td><?php echo ($rel->evaluado) ?></td>
                    <td><?php echo ($rel->nombre_evaluado)?></td>
                    <td><?php echo ($rel->cargo_evaluado)?></td>
                    <td><?php echo ($rel->c1_evaluado)?></td>
                    <td><?php echo ($rel->c2_evaluado)?></td>
                    <td><?php echo ($rel->c3_evaluado)?></td>
                    <td><?php echo ($rel->perfil_evaluacion_competencias)?></td>
                    <?php
                    if($rel->fecha_finalizacion){
                        $promedio_por_competencias=PromedioPorCompetencias($rel->evaluado, $rel->evaluador, $rel->id_proceso);
                        $datos_criterio_nota_fina=ObtenerCriterioPuntajeMatrizNotaFinal($promedio_por_competencias[0]->nota_promedio, "", 0, "nota_final", $rel->evaluador, $rel->id_proceso);
                        ?>
                        <td><?php echo round($promedio_por_competencias[0]->nota_promedio, 2)?></td>
                        <td><?php echo $datos_criterio_nota_fina[0]?></td>
                        <?php
                        foreach($competencias as $comp){
                            $datos_competencia_real=SGD_TraigoDatosCompetenciaDadoComponenteReporteYPerfil($rel->perfil_evaluacion_competencias, $comp->id_componente_reporte);
                            //$resultado_competencia=SGD_ResultadoPorCompetenciaIdComponenteReporte($rel->evaluado, $rel->evaluador, $rel->id_proceso, $comp->id_componente_reporte);
                            $resultado_competencia=SGD_ResultadoPorCompetenciaIdComponenteReporte($rel->evaluado, $rel->evaluador, $rel->id_proceso, $datos_competencia_real[0]->id_competencia);
                            ?>
                            <td><?php echo $resultado_competencia[0]->nota; ?></td>
                            <?php
                            $preguntas=SGD_PreguntasPorIdComponenteReporteAgrupadosPorDeterminante($comp->id_componente_reporte, $id_empresa);
                            foreach($preguntas as $preg){
                                //$respuesta=SGD_TraigoRespuestaPorDeterminante($rel->evaluado, $rel->evaluador, $rel->id_proceso, $preg->id_determinante, $comp->id);
                                $respuesta=SGD_TraigoRespuestaPorDeterminante($rel->evaluado, $rel->evaluador, $rel->id_proceso, $preg->id_determinante, $datos_competencia_real[0]->id_competencia);
                                ?>
                                <td><?php echo $respuesta[0]->respuesta; ?></td>
                                <?php
                            }
                        }
                    }else{
                        ?>
                        <?php
                    }
                    ?>
                    <td><?php echo $rel->comentarios_finales;?></td>
                </tr>
                <?php
            }
            }

            function ConsultaWebServiceDatosUsuarioSoloEmailGoogleAdmin($correo_consulta, $nombre, $apellido, $imagenUrl, $id_empresa)
            {
                echo "<br>$correo_consulta,$nombre,$apellido,$imagenUrl,$id_empresa";
                $rut = $correo_consulta;
//ACTUALIZA BASE DE PERSONAS
                $WS_existeusuario = WS_existeusuariodataAdmin($rut, $id_empresa);
                if (count($WS_existeusuario) >= 1) {
                    WS_actualizadatosAdmin($rut, $nombre, $apellido, $imagenUrl, $cargo, $gerenciaR2, $gerenciaR3, $gerencia, $ola, $jefe, $email, $id_empresa, "actualiza");
                } else {
                    WS_actualizadatosAdmin($rut, $nombre, $apellido, $imagenUrl, $cargo, $gerenciaR2, $gerenciaR3, $gerencia, $ola, $jefe, $email, $id_empresa, "inserta");
                }
                $arreglo_rut = $arreglo_archivo = explode("-", $rut);
                $key = $arreglo_rut[0];
                return $key;
            }

            function ColocaAvanceEvalPorPRoceso($PRINCIPAL, $id_proceso, $id_empresa)
            {
                //traigo relaciones por proceso
                $relaciones = TraeRelacionesProcesosConDetalle($id_empresa, $id_proceso);
                $i = 1;
                foreach ($relaciones as $rel) {
                    $rows .= file_get_contents("views/reportes/sgd/row_avance_eval.html");
                    $rows = str_replace("{NUMERO}", $i, $rows);
                    $rows = str_replace("{RUT_EVALUADO}", $rel->evaluado, $rows);
                    $rows = str_replace("{NOMBRE_EVALUADO}", $rel->nombre_evaluado, $rows);
                    $rows = str_replace("{CARGO_EVALUADO}", $rel->cargo_evaluado, $rows);
                    $rows = str_replace("{C1_EVALUADO}", $rel->c1_evaluado, $rows);
                    $rows = str_replace("{C2_EVALUADO}", $rel->c2_evaluado, $rows);
                    $rows = str_replace("{C3_EVALUADO}", $rel->c3_evaluado, $rows);
                    $rows = str_replace("{RUT_EVALUADOR}", $rel->evaluador, $rows);
                    $rows = str_replace("{NOMBRE_EVALUADOR}", $rel->nombre_evaluador, $rows);
                    $rows = str_replace("{CARGO_EVALUADOR}", $rel->cargo_evaluador, $rows);
                    $rows = str_replace("{C1_EVALUADOR}", $rel->c1_evaluador, $rows);
                    $rows = str_replace("{C2_EVALUADOR}", $rel->c2_evaluador, $rows);
                    $rows = str_replace("{C3_EVALUADOR}", $rel->c3_evaluador, $rows);
                    if ($rel->fecha_finalizacion) {
                        $rows = str_replace("{ESTADO_EVAL}", '<div class="etiqueta  label-success">Finalizado</div>', $rows);
                    } else if ($rel->total_respuestas > 0) {
                        $rows = str_replace("{ESTADO_EVAL}", '<div class="etiqueta  label-proceso">En Evaluacion</div>', $rows);
                    } else {
                        $rows = str_replace("{ESTADO_EVAL}", '<div class="etiqueta  label-danger">No Iniciado</div>', $rows);
                    }
                    $i++;
                }
                $PRINCIPAL = str_replace("{LISTADO_USUARIOS_EVAL}", $rows, $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function ColocaEstadisticas($id_empresa)
            {
                //Trae los campos
                $case_Estadisticas = Estadisticas_distinct($id_empresa);
                $i = 1;
                foreach ($case_Estadisticas as $case) {
                    $rows .= file_get_contents("views/estadisticas/row_resultados.html");
                    $rows = str_replace("{AMBIENTE}", $case->nombre, $rows);
                    $rows = str_replace("{CASE}", $case->case, $rows);
                    $total = Estadisticas_QueryPorCase($id_empresa, $case->case);
                    $rows = str_replace("{CANTIDAD}", $total[0]->total, $rows);
                    $rows = str_replace("{NUMERO}", $i, $rows);
                    $i++;
                }
                return ($rows);
            }

            function ColocaNoticiasEnTemplateDecorreo($PRINCIPAL, $id_correo)
            {
                $detalle_correo = DatosDeCorreoDadoId($id_correo);
                for ($fila = 1; $fila <= $detalle_correo[0]->filas; $fila++) {
                    for ($columna = 1; $columna <= $detalle_correo[0]->columnas; $columna++) {
                        //Veo si en este cuadrante hay data en la tabla, si es asi, muestro la noticia
                        $tiene_dato_este_cuadrante = VerificoNoticiaFilaColumna($id_correo, $fila, $columna);
                        if ($tiene_dato_este_cuadrante) {
                            $PRINCIPAL = str_replace("{" . $fila . "_" . $columna . "}", "<img src='../front/img/noticias/" . $tiene_dato_este_cuadrante[0]->portada . "'><br>
                <h3>" . utf8_encode($tiene_dato_este_cuadrante[0]->titulo) . "</h3>
                ", $PRINCIPAL);
                        } else {
                            $PRINCIPAL = str_replace("{" . $fila . "_" . $columna . "}", "", $PRINCIPAL);
                        }
                    }
                }
                return ($PRINCIPAL);
            }

            function ReporteResultadosGeneralesConsolidadoTrivias($PRINCIPAL, $id_empresa, $arreglo_post, $criterio, $nombre_campo)
            {
                $usuarios = TraigoDatosTablareportesConsolidad($id_empresa, $arreglo_post);
                $acumula_finalizados = 0;
                $acumula_no_iniciados = 0;
                $acumula_en_proceso = 0;
                $acumula_en_proceso_menor_a_50 = 0;
                $acumula_en_proceso_mayor_igual_a_50 = 0;
                $acumula_avance = 0;
                foreach ($usuarios as $usu) {
                    if ($arreglo_post["objetos"]) {
                        if ($usu->fecha_objeto_finalizado) {
                            //$usu->avance=100;
                            $avance = 100;
                        } else {
                            //$usu->avance=0;
                            $avance = 0;
                        }
                    } else {
                        $avance = $usu->avance;
                    }
                    if ($avance <> 100) {
                        continue;
                    }
                    $avancenum = intval($usu->resultado);
                    $avance = intval($usu->resultado);
                    $num_usuario_res++;
                    //echo "<br>$num_usuario_res ".$usu->resultado;
                    //print_r($usu);exit;
                    if ($avancenum === 0) {
                        $acumulador_avance_0++;
                    }
                    if ($avance >= 0 && $avance < 10) {
                        $acumulador_avance_entre_0_10++;
                    }
                    if ($avance >= 10 && $avance < 20) {
                        $acumulador_avance_entre_10_20++;
                    }
                    if ($avance >= 20 && $avance < 30) {
                        $acumulador_avance_entre_20_30++;
                    }
                    if ($avance >= 30 && $avance < 40) {
                        $acumulador_avance_entre_30_40++;
                    }
                    if ($avance >= 40 && $avance < 50) {
                        $acumulador_avance_entre_40_50++;
                    }
                    if ($avance >= 50 && $avance < 60) {
                        $acumulador_avance_entre_50_60++;
                    }
                    if ($avance >= 60 && $avance < 70) {
                        $acumulador_avance_entre_60_70++;
                    }
                    if ($avance >= 70 && $avance < 80) {
                        $acumulador_avance_entre_70_80++;
                    }
                    if ($avance >= 80 && $avance < 90) {
                        $acumulador_avance_entre_80_90++;
                    }
                    if ($avance >= 90 && $avance < 100) {
                        $acumulador_avance_entre_90_100++;
                    }
                    if ($avancenum == 100) {
                        $acumulador_avance_100++;
                    }
                    //$acumula_avance=$acumula_avance +$usu->avance;
                    $acumula_avance = $acumula_avance + $avance;
                    $aa++;
                }
// CALCULOS
                $RANGO100 = $acumulador_avance_100;
                $ACUMULA100 = $acumulador_avance_100;
                $PORCENTAJE100 = ROUND(100 * $acumulador_avance_100 / $aa, 1);
                $PORCENTAJEA100 = ROUND(100 * $ACUMULA100 / $aa);
                $RANGO90 = $acumulador_avance_entre_90_100;
                $ACUMULA90 = $acumulador_avance_entre_90_100 + $ACUMULA100;
                $PORCENTAJE90 = ROUND(100 * $acumulador_avance_entre_90_100 / $aa, 1);
                $PORCENTAJEA90 = ROUND(100 * $ACUMULA90 / $aa, 1);
                $RANGO80 = $acumulador_avance_entre_80_90;
                $ACUMULA80 = $acumulador_avance_entre_80_90 + $ACUMULA90;
                $PORCENTAJE80 = ROUND(100 * $acumulador_avance_entre_80_90 / $aa, 1);
                $PORCENTAJEA80 = ROUND(100 * $ACUMULA80 / $aa, 1);
                $RANGO70 = $acumulador_avance_entre_70_80;
                $ACUMULA70 = $acumulador_avance_entre_70_80 + $ACUMULA80;
                $PORCENTAJE70 = ROUND(100 * $acumulador_avance_entre_70_80 / $aa, 1);
                $PORCENTAJEA70 = ROUND(100 * $ACUMULA70 / $aa, 1);
                $RANGO60 = $acumulador_avance_entre_60_70;
                $ACUMULA60 = $acumulador_avance_entre_60_70 + $ACUMULA70;
                $PORCENTAJE60 = ROUND(100 * $acumulador_avance_entre_60_70 / $aa, 1);
                $PORCENTAJEA60 = ROUND(100 * $ACUMULA60 / $aa, 1);
                $RANGO50 = $acumulador_avance_entre_50_60;
                $ACUMULA50 = $acumulador_avance_entre_50_60 + $ACUMULA60;
                $PORCENTAJE50 = ROUND(100 * $acumulador_avance_entre_50_60 / $aa, 1);
                $PORCENTAJEA50 = ROUND(100 * $ACUMULA50 / $aa, 1);
                $RANGO40 = $acumulador_avance_entre_40_50;
                $ACUMULA40 = $acumulador_avance_entre_40_50 + $ACUMULA50;
                $PORCENTAJE40 = ROUND(100 * $acumulador_avance_entre_40_50 / $aa, 1);
                $PORCENTAJEA40 = ROUND(100 * $ACUMULA40 / $aa, 1);
                $RANGO30 = $acumulador_avance_entre_30_40;
                $ACUMULA30 = $acumulador_avance_entre_30_40 + $ACUMULA40;
                $PORCENTAJE30 = ROUND(100 * $acumulador_avance_entre_30_40 / $aa, 1);
                $PORCENTAJEA30 = ROUND(100 * $ACUMULA30 / $aa, 1);
                $RANGO20 = $acumulador_avance_entre_20_30;
                $ACUMULA20 = $acumulador_avance_entre_20_30 + $ACUMULA30;
                $PORCENTAJE20 = ROUND(100 * $acumulador_avance_entre_20_30 / $aa, 1);
                $PORCENTAJEA20 = ROUND(100 * $ACUMULA20 / $aa, 1);
                $RANGO10 = $acumulador_avance_entre_10_20;
                $ACUMULA10 = $acumulador_avance_entre_10_20 + $ACUMULA20;
                $PORCENTAJE10 = ROUND(100 * $acumulador_avance_entre_10_20 / $aa, 1);
                $PORCENTAJEA10 = ROUND(100 * $ACUMULA10 / $aa, 1);
                $RANGO_0 = $acumulador_avance_entre_0_10;
                $ACUMULA_0 = $acumulador_avance_entre_0_10 + $ACUMULA10;
                $PORCENTAJE_0 = ROUND(100 * $acumulador_avance_entre_0_10 / $aa, 1);
                $PORCENTAJEA_0 = ROUND(100 * $ACUMULA_0 / $aa, 1);
                $RANGO0 = $acumulador_avance_0;
                $ACUMULA0 = $acumulador_avance_0;
                $PORCENTAJE0 = ROUND(100 * $acumulador_avance_0 / $aa, 1);
                $PORCENTAJEA0 = ROUND(100 * $ACUMULA0 / $aa, 1);
                $i = count($usuarios);
                $PRINCIPAL = str_replace("{RANGO100}", ($RANGO100), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ACUMULA100}", ($ACUMULA100), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE100}", ($PORCENTAJE100), $PRINCIPAL);
                $PRINCIPAL = str_replace("{RANGO90}", ($RANGO90), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ACUMULA90}", ($ACUMULA90), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE90}", ($PORCENTAJE90), $PRINCIPAL);
                $PRINCIPAL = str_replace("{RANGO80}", ($RANGO80), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ACUMULA80}", ($ACUMULA80), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE80}", ($PORCENTAJE80), $PRINCIPAL);
                $PRINCIPAL = str_replace("{RANGO70}", ($RANGO70), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ACUMULA70}", ($ACUMULA70), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE70}", ($PORCENTAJE70), $PRINCIPAL);
                $PRINCIPAL = str_replace("{RANGO60}", ($RANGO60), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ACUMULA60}", ($ACUMULA60), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE60}", ($PORCENTAJE60), $PRINCIPAL);
                $PRINCIPAL = str_replace("{RANGO50}", ($RANGO50), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ACUMULA50}", ($ACUMULA50), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE50}", ($PORCENTAJE50), $PRINCIPAL);
                $PRINCIPAL = str_replace("{RANGO40}", ($RANGO40), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ACUMULA40}", ($ACUMULA40), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE40}", ($PORCENTAJE40), $PRINCIPAL);
                $PRINCIPAL = str_replace("{RANGO30}", ($RANGO30), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ACUMULA30}", ($ACUMULA30), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE30}", ($PORCENTAJE30), $PRINCIPAL);
                $PRINCIPAL = str_replace("{RANGO20}", ($RANGO20), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ACUMULA20}", ($ACUMULA20), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE20}", ($PORCENTAJE20), $PRINCIPAL);
                $PRINCIPAL = str_replace("{RANGO10}", ($RANGO10), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ACUMULA10}", ($ACUMULA10), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE10}", ($PORCENTAJE10), $PRINCIPAL);
                $PRINCIPAL = str_replace("{RANGO_0}", ($RANGO_0), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ACUMULA_0}", ($ACUMULA_0), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_0}", ($PORCENTAJE_0), $PRINCIPAL);
                $PRINCIPAL = str_replace("{RANGO0}", ($RANGO0), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ACUMULA0}", ($ACUMULA0), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE0}", ($PORCENTAJE0), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJEA100}", ($PORCENTAJEA100), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJEA90}", ($PORCENTAJEA90), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJEA80}", ($PORCENTAJEA80), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJEA70}", ($PORCENTAJEA70), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJEA60}", ($PORCENTAJEA60), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJEA50}", ($PORCENTAJEA50), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJEA40}", ($PORCENTAJEA40), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJEA30}", ($PORCENTAJEA30), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJEA20}", ($PORCENTAJEA20), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJEA10}", ($PORCENTAJEA10), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJEA_0}", ($PORCENTAJEA_0), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJEA0}", ($PORCENTAJEA0), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CRITERIO}", ($criterio), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS}", $i, $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_TOTAL}", number_format($acumulador_porcentajes_avance_malla / $i, 0, ",", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_ACCESOS}", $acumulador_visitas, $PRINCIPAL);
                //Bloque Total de Porcentaje Total
                $PRINCIPAL = str_replace("{GRAFICO_PORCENTAJE_TOTAL}", file_get_contents("views/graficos/grafico_circulo.html"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE}", number_format($acumula_avance / $aa, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_FINALIZADOS}", number_format($acumula_finalizados, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_FINALIZADOS}", round(100 * $acumula_finalizados / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_FINALIZADOS_SR}", (100 * $acumula_finalizados / $i), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_PROCESO}", number_format($acumula_en_proceso, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_PROCESO}", round(100 * $acumula_en_proceso / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_PROCESO_SR}", (100 * $acumula_en_proceso / $i), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_PROCESO_MENOR_50}", number_format($acumula_en_proceso_menor_a_50, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_PROCESO_MENOR_50}", round(100 * $acumula_en_proceso_menor_a_50 / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_PROCESO_MAYOR_IGUAL_50}", number_format($acumula_en_proceso_mayor_igual_a_50, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_PROCESO_MAYOR_IGUAL_50}", round(100 * $acumula_en_proceso_mayor_igual_a_50 / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_NOINICIADO}", number_format($acumula_no_iniciados, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_NOINICIADO}", round(100 * $acumula_no_iniciados / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_NOINICIADO_SR}", (100 * $acumula_no_iniciados / $i), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_INGRESADOS}", number_format($acumula_finalizados + $acumula_en_proceso, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_INGRESADOS}", round(100 * ($acumula_finalizados + $acumula_en_proceso) / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{TEXTO}", "Avance", $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOMBRE_GRAFICO}", "Avance", $PRINCIPAL);
                //Bloque Total de ACESOS
                //$PRINCIPAL = str_replace("{GRAFICO_CANTIDAD_ACCESOS}",file_get_contents("views/graficos/grafico_circulo.html"),$PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE}", number_format($acumulador_visitas * 100 / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{TEXTO}", "Accesos", $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOMBRE_GRAFICO}", "Accesos", $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function nunComas1Dec($numero)
            {
                $nombre_format_francais = number_format($numero, 1, ',', ' ');
                return $nombre_format_francais;
            }

            function validadFormatoFecha($valor)
            {
                $date_regex = '/^(19|20)\d\d[\\/.](0[1-9]|1[012])[\\/.](0[1-9]|[12][0-9]|3[01])$/';
                if (!preg_match($date_regex, $valor)) {
                    $devuelve = 0;
                } else {
                    $devuelve = 1;
                }
                return $devuelve;
            }

            function transformfechaexcelaphp($dateValue)
            {
                $unixDate = ($dateValue - 25569) * 86400;
                return gmdate("Y-m-d", $unixDate);
            }

            function check_date($str)
            { /// dead useful when validating between mysql and php date formats
                $noesfecha = 0;
                trim($str);
                $trozos = explode("-", $str);
                $ano = $trozos[0];
                $m = $trozos[1];
                $d = $trozos[2];
                if (strlen($ano) == 4) {
                    $fecha_ano = $ano;
                } elseif (strlen($ano) == 2) {
                    $fecha_dia = $ano;
                } else {
                    $noesfecha = 1;
                }
                if (strlen($m) == 2) {
                    $fecha_mes = $m;
                } elseif (strlen($mes) == 1) {
                    $fecha_mes = "0" . $m;
                } else {
                    $noesfecha = 1;
                }
                if (strlen($d) == 4) {
                    $fecha_ano = $d;
                } elseif (strlen($d) == 2) {
                    $fecha_dia = $d;
                } else {
                    $noesfecha = 1;
                }
                $fecha_enviada = $fecha_ano . "-" . $fecha_mes . "-" . $fecha_dia;
                if ($noesfecha == 0) {
                    return $fecha_enviada;
                }
            }

            function Lms_reporte_MuestraListaImparticionesEnc($PRINCIPAL, $id_empresa, $arreglo_post, $excel)
            {
                $id_malla = $arreglo_post[malla];
                $id_curso = $arreglo_post[curso];
                $ejecutivo = $arreglo_post[ejecutivo];
                $jefe = $arreglo_post[jefe];
                $codigo_imparticion = $_POST["imparticion"];
                $fechas = $arreglo_post[fechas];
                $fechasString = explode(" - ", $fechas);
                $fechaInicio = $fechasString[0]; // porción1
                $fechaTermino = $fechasString[1]; // porción2
                //$ListaCursos=lms_lista_curso_filtros($id_malla, $id_curso, $ejecutivo, $jefe, $fechaInicio, $fechaTermino, $id_empresa);
                $ListaImparticiones = lms_lista_Imparticiones_filtros_($id_empresa, $arreglo_post);
                $enc_template = busca_enc_satis_template_admin($id_empresa);
//print_r($ListaImparticiones); exit();
                if ($excel == 1) {
                    $html .= file_get_contents("views/reportes/enc_satisfaccion/entorno_cursos_listado_excel.html");
                } else {
                    $html .= file_get_contents("views/reportes/enc_satisfaccion/" . $id_empresa . "_entorno_cursos_listado.html");
                }
                $array_para_enviar_via_url_post = serialize($arreglo_post);
                $array_para_enviar_via_url_post = urlencode($array_para_enviar_via_url_post);
                $html = str_replace("{ARREGLO_POST}", $array_para_enviar_via_url_post, $html);
                $html = str_replace("{VALOR}", $valor, $html);
                foreach ($ListaImparticiones as $ListaImparticion) {
                    //busca relatores por sesion
                    $array_relatores = lms_trae_relatores_por_sesion($ListaImparticion->codigo_inscripcion, $id_empresa);
                    foreach ($array_relatores as $array_relator) {
                        $relator .= $array_relator->nombre_relator . " (" . $array_relator->rut_completo . ")<br>";
                    }
                    $row .= file_get_contents("views/reportes/enc_satisfaccion/" . $id_empresa . "_row_cursos_listado.html");
                    $row = str_replace("{ID_CURSO}", ($ListaImparticion->codigo_inscripcion), $row);
                    $row = str_replace("{CODIGO_IMPARTICION_ENCODEADO}", Encodear3($ListaImparticion->codigo_inscripcion), $row);
                    $row = str_replace("{NOMBRE_CURSO}", ($ListaImparticion->nombre_curso), $row);
                    $row = str_replace("{EJECUTIVO}", ($ListaImparticion->nombre_ejecutivo), $row);
                    $row = str_replace("{FEC_INICIO}", ($ListaImparticion->fecha_inicio), $row);
                    $row = str_replace("{FEC_TERMINO}", ($ListaImparticion->fecha_termino), $row);
                    $row = str_replace("{PART}", ($ListaImparticion->participantes), $row);
                    $row = str_replace("{PART_PARTICIPANTES}", ($ListaImparticion->participantes_participantes), $row);
                    //$row = str_replace("{PART_PARTICIPANTES}",($ListaImparticion->participantes),$row);
                    $row = str_replace("{PART_RELATOR}", ($relator), $row);
                    //$preguntas_por_dimension=ENC_TraigoPreguntaDadaDimenion($dimen->iddimension);
                }
                $html = str_replace("{ROW_LISTADO}", ($row), $html);
                if ($excel == 1) {
                    $PRINCIPAL = utf8_encode($html);
                } else {
                    $PRINCIPAL = str_replace("{BLOQUE_FILTROS_CURSOS}", utf8_encode($html), $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function ColocaFiltrosElearning($PRINCIPAL, $id_empresa)
            {
                //Dado el id de empresa, traigo los programas
                $programas = IMPARTCION_ObtieneProgramasBBDD($id_empresa);
                $options_programas_bbdd = "";
                foreach ($programas as $prog) {
                    $options_programas_bbdd .= "<option value='" . $prog->id_programa . "'>" . $prog->nombre_programa . "</option>";
                }
                $PRINCIPAL = str_replace("{LISTADO_PROGRAMAS_BBDD}", utf8_encode($options_programas_bbdd), $PRINCIPAL);
                $focos = IMPARTCION_Obtienefocos($id_empresa);
                $options_focos = "";
                foreach ($focos as $foc) {
                    $options_focos .= "<option value='" . $foc->codigo_foco . "'>" . $foc->descripcion . "</option>";
                }
                $PRINCIPAL = str_replace("{OPTIONS_FOCOS}", utf8_encode($options_focos), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function TraeDatosBox($nota, $id_empresa)
            {
                $datos_box = ConsultadatosBoxMatris($id_empresa);
                foreach ($datos_box as $box) {
                    if ($nota >= $box->rangomenor and $nota < $box->rangomayor) {
                        $arreglo[0] = $box->letra_box;
                        $arreglo[1] = $box->cuadrante_box;
                    }
                }
                return ($arreglo);
            }

            function Lms_avanceEsperado($fecha1, $fecha2, $id_malla, $id_empresa)
            {
                //echo "<br>$fecha1, $fecha2, $cuenta_dias $id_malla, $id_empresa";
                $start = new DateTime($fecha1);
                $end = new DateTime($fecha2);
// otherwise the  end date is excluded (bug?)
                $end->modify('+2 day');
                $interval = $end->diff($start);
// total days
                $days = $interval->days;
// create an iterateable period of date (P1D equates to 1 day)
                $period = new DatePeriod($start, new DateInterval('P1D'), $end);
                foreach ($period as $dt) {
                    $curr = $dt->format('D');
                    // substract if Saturday or Sunday
                    if ($curr == 'Sat' || $curr == 'Sun') {
                        $days--;
                    } // (optional) for the updated question
                    elseif (in_array($dt->format('Y-m-d'), $holidays)) {
                        $days--;
                    }
                }
                //echo "<br>cuenta  $days $id_malla, $id_empresa";
                $avance_esperado_array = Lms_avanceEsperadoData($days, $id_malla, $id_empresa);
                $avance_esperado = $avance_esperado_array[0]->avance;
                if ($days >= 10) {
                    $avance_esperado = 100;
                }
                return $avance_esperado;
            }

            function ReporteCapacitacionPorcriterioSGDResultados($PRINCIPAL, $id_empresa, $arreglo_post, $criterio, $nombre_campo, $ejecuta_script_guarda_ranking)
            {
                $valores_por_criterio = TraigoValoresDadoCampoPorEmpreasSGDReporte($criterio, $id_empresa);
//print_r($valores_por_criterio);
//echo "<br>aca".$criterio;exit;
//echo "<br>";
                foreach ($valores_por_criterio as $valor) {
                    $datos_Avance = AvancePorCriterioSGD($id_empresa, $criterio, $valor->valor, $arreglo_post);
                    $resultados_por_valores = sgd_relaciones_procesoConResultados($id_empresa, 98, "", $criterio, $valor->valor);
                    $contador_evaluaciones = 0;
                    $acumulador_nota_fina_competencias = 0;
                    $acumulador_nota_fina_objetivos = 0;
                    $contador_competencias = 0;
                    $contador_objetivos = 0;
                    foreach ($resultados_por_valores as $res) {
                        //print_r($res);exit;
                        if ($res->nota_final_competencias > 0) {
                            $acumulador_nota_fina_competencias = $acumulador_nota_fina_competencias + $res->nota_final_competencias;
                            $contador_competencias++;
                        }
                        if ($res->nota_final_objetivos > 0) {
                            $acumulador_nota_fina_objetivos = $acumulador_nota_fina_objetivos + $res->nota_final_objetivos;
                            $contador_objetivos++;
                        }
                        $contador_evaluaciones++;
                    }
                    //$avance=round(100*$datos_Avance[0]->Finalizados/$datos_Avance[0]->Total);
                    $rows .= file_get_contents("views/sgd/row_resultado_sgd_por_criterio.html");
                    $rows = str_replace("{NOMBRE}", utf8_encode($valor->valor), $rows);
                    $rows = str_replace("{NUM_USUARIOS}", ($datos_Avance[0]->Total), $rows);
                    $rows = str_replace("{NUM_FINALIZADOS}", ($datos_Avance[0]->Finalizados), $rows);
                    //$rows= str_replace("{NOTA_COMPETENCIAS}",ColocarColoresConPorcentajeProgressBar(round($avance), 1),$rows);
                    $rows = str_replace("{NOTA_COMPETENCIAS}", round(($acumulador_nota_fina_competencias / $contador_competencias), 2), $rows);
                    $rows = str_replace("{NOTA_OBJ}", round(($acumulador_nota_fina_objetivos / $contador_objetivos), 2), $rows);
                    //$rows= str_replace("{NOTA_OBJ}",$acumulador_nota_fina_objetivos." ".$contador_objetivos,$rows);
                    $rows = str_replace("{NOTA_FINAL}", round((($acumulador_nota_fina_competencias / $contador_competencias) * 0.5) + (($acumulador_nota_fina_objetivos / $contador_objetivos) * 0.5), 2), $rows);
                }
                $PRINCIPAL = str_replace("{LISTADO_USUARIOS}", ($rows), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CRITERIO}", ($criterio), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function ReporteSGDResultadosEvaluadoEvaluador($PRINCIPAL, $id_empresa, $arreglo_post, $criterio, $excel, $tipo_reporte)
            {
                //echo "$id_empresa, $arreglo_post, $criterio, $excel";
                $PRINCIPAL = str_replace("{ID_EMPRSA}", $id_empresa, $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTION_SUCURSALES}", utf8_encode($option_sucursales), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTION_LOCAL}", utf8_encode($option_locales), $PRINCIPAL);
                //Traigo el listado de usuarios
                $i = 0;
                $acumulador_porcentajes_avance_malla = 0;
                $acumulador_visitas = 0;
                if ($excel or $arreglo_post or $tipo_reporte) {
                    //$usuarios=sgd_relaciones_proceso($id_empresa,$arreglo_post);
                    $usuarios = sgd_relaciones_procesoConResultados($id_empresa, 98, $arreglo_post);
                }
                $contador_ab = 0;
                $contador_am = 0;
                $contador_aa = 0;
                $contador_mb = 0;
                $contador_mm = 0;
                $contador_ma = 0;
                $contador_bb = 0;
                $contador_bm = 0;
                $contador_ba = 0;
                foreach ($usuarios as $usu) {
                    //echo $usu->rut;
                    $estado = "";
                    if ($usu->EstadoCuenta > 0) {
                        $estado = "Finalizado";
                    }
                    $i++;
                    if ($arreglo_post["tipo_reporte"] == "detalle") {
                        $rows .= file_get_contents("views/sgd/row_resultados_sgd_detalle_excel.html");
                    } else if ($excel == 1) {
                        //$rows.=file_get_contents("views/reportes/capacitacion/row_avance_capacitacion_excel.html");
                        //$rows=file_get_contents("views/sgd/row_avance_sgd_excel.html");
                        $rows .= file_get_contents("views/sgd/row_resultados_sgd_excel.html");
                    } else {
                        $rows .= file_get_contents("views/sgd/row_resultados_sgd.html");
                    }
                    $rows = str_replace("{RUT_EVALUADO}", $usu->RutEvaluado, $rows);
                    $rows = str_replace("{EVALUADO}", $usu->Evaluado, $rows);
                    $rows = str_replace("{CARGO_EVALUADO}", $usu->cargoEvaluado, $rows);
                    $rows = str_replace("{LOCAL_EVALUADO}", $usu->localEvaluado, $rows);
                    $rows = str_replace("{SUCURSAL_EVALUADO}", $usu->sucursalEvaluado, $rows);
                    $rows = str_replace("{RUT_EVALUADOR}", $usu->RutEvaluador, $rows);
                    $rows = str_replace("{EVALUADOR}", $usu->Evaluador, $rows);
                    $rows = str_replace("{CARGO_EVALUADOR}", $usu->cargoEvaluador, $rows);
                    $rows = str_replace("{LOCAL_EVALUADOR}", $usu->localEvaluador, $rows);
                    $rows = str_replace("{SUCURSAL_EVALUADOR}", $usu->sucursalEvaluador, $rows);
                    $rows = str_replace("{GERENCIA}", $usu->Gerencia, $rows);
                    if ($arreglo_post["subperfil"] == 2) {
                        $rows = str_replace("{CUADRANTE_COMPETENCIAS_FINAL}", "", $rows);
                        $rows = str_replace("{CUADRANTE_OBJETIVOS_FINAL}", "", $rows);
                        $rows = str_replace("{CUADRANTE_NOTA_FINAL}", "", $rows);
                    }
                    if ($usu->tipoEvaluado == "DO") {
                        $rows = str_replace("{TIPO_EVALUADO}", "DO", $rows);
                        $rows = str_replace("{COMPETENCIAS_FINAL}", "", $rows);
                        $rows = str_replace("{NOTA_FINAL}", "", $rows);
                        $rows = str_replace("{OBJETIVOS_FINAL}", "", $rows);
                        $rows = str_replace("{PREGUNTA1}", "", $rows);
                        $rows = str_replace("{PREGUNTA2}", "", $rows);
                        $rows = str_replace("{PREGUNTA3}", "", $rows);
                        $rows = str_replace("{PREGUNTA4}", "", $rows);
                        $rows = str_replace("{PREGUNTA5}", "", $rows);
                        $rows = str_replace("{CUADRANTE_COMPETENCIAS_FINAL}", "", $rows);
                        $rows = str_replace("{CUADRANTE_OBJETIVOS_FINAL}", "", $rows);
                        $rows = str_replace("{CUADRANTE_NOTA_FINAL}", "", $rows);
                    } else {
                        $rows = str_replace("{TIPO_EVALUADO}", "", $rows);
                    }
                    if ($usu->RutEvaluado == $usu->RutEvaluador) {
                        $rows = str_replace("{PERFIL_EVALUADO}", "Autoevaluacion", $rows);
                    } else {
                        $rows = str_replace("{PERFIL_EVALUADO}", "Evaluacion Jefatura", $rows);
                    }
                    $rows = str_replace("{TIPO}", $usu->Tipo, $rows);
                    $rows = str_replace("{ESTADOCUENTA}", $estado, $rows);
                    if ($usu->id_finalizado) {
                        $rows = str_replace("{ESTADO}", '<span class="etiqueta  label-success">Finalizada</span>', $rows);
                    } else {
                        $rows = str_replace("{ESTADO}", '<span class="etiqueta  label-danger">Pendiente</span>', $rows);
                    }
                    $rows = str_replace("{PREGUNTA1}", $usu->pregunta1, $rows);
                    $rows = str_replace("{PREGUNTA2}", $usu->pregunta2, $rows);
                    $rows = str_replace("{PREGUNTA3}", $usu->pregunta3, $rows);
                    $rows = str_replace("{PREGUNTA4}", $usu->pregunta4, $rows);
                    $rows = str_replace("{PREGUNTA5}", $usu->pregunta5, $rows);
                    if ($usu->pregunta1 && $usu->pregunta2 && $usu->pregunta3 && $usu->pregunta4 && $usu->pregunta5) {
                        $rows = str_replace("{COMPETENCIAS_FINAL}", $usu->nota_final_competencias, $rows);
                        //Obtengo letra y cuadrante de BOX de las competencias
                        $dato_box = TraeDatosBox($usu->nota_final_competencias, $id_empresa);
                        $rows = str_replace("{CUADRANTE_COMPETENCIAS_FINAL}", $dato_box[0], $rows);
                        //$rows = str_replace("{NOTA_FINAL}",($usu->nota_final_competencias*0.5)+($usu->nota_final_objetivos*0.5),$rows);
                        if ($usu->nota_final_objetivos == 0 && $usu->nota_final_competencias > 0) {
                            $rows = str_replace("{NOTA_FINAL}", ColocaDecimalesNotasFinales(2, (($usu->nota_final_competencias)), ""), $rows);
                            $rows = str_replace("{OBJETIVOS_FINAL}", "N/A", $rows);
                        } else {
                            $rows = str_replace("{NOTA_FINAL}", ColocaDecimalesNotasFinales(2, (($usu->nota_final_competencias * 0.5) + ($usu->nota_final_objetivos * 0.5)), ""), $rows);
                            $rows = str_replace("{OBJETIVOS_FINAL}", ColocaDecimalesNotasFinales(2, $usu->nota_final_objetivos, ""), $rows);
                            $dato_box_objetivos = TraeDatosBox($usu->nota_final_objetivos, $id_empresa);
                            $rows = str_replace("{CUADRANTE_OBJETIVOS_FINAL}", $dato_box_objetivos[0], $rows);
                            $rows = str_replace("{CUADRANTE_NOTA_FINAL}", $dato_box_objetivos[0] . $dato_box[0], $rows);
                            if ($usu->evaluado <> $usu->evaluador) {
                                $acumulador_total++;
                                if ($dato_box_objetivos[0] == "A" && $dato_box[0] == "B") {
                                    $contador_ab++;
                                    $acumulador_ab .= "<span class='label label-sm label-primary'><i class='fa fa-user'></i> " . $usu->Evaluado . "</span><br>";
                                }
                                if ($dato_box_objetivos[0] == "A" && $dato_box[0] == "M") {
                                    $contador_am++;
                                    $acumulador_am .= "<span class='label label-sm label-primary'><i class='fa fa-user'></i> " . $usu->Evaluado . "</span><br>";
                                }
                                if ($dato_box_objetivos[0] == "A" && $dato_box[0] == "A") {
                                    $contador_aa++;
                                    $acumulador_aa .= "<span class='label label-sm label-primary'><i class='fa fa-user'></i> " . $usu->Evaluado . "</span><br>";
                                }
                                if ($dato_box_objetivos[0] == "M" && $dato_box[0] == "B") {
                                    $contador_mb++;
                                    $acumulador_mb .= "<span class='label label-sm label-primary'><i class='fa fa-user'></i> " . $usu->Evaluado . "</span><br>";
                                }
                                if ($dato_box_objetivos[0] == "M" && $dato_box[0] == "M") {
                                    $contador_mm++;
                                    $acumulador_mm .= "<span class='label label-sm label-primary'><i class='fa fa-user'></i> " . $usu->Evaluado . "</span><br>";
                                }
                                if ($dato_box_objetivos[0] == "M" && $dato_box[0] == "A") {
                                    $contador_ma++;
                                    $acumulador_ma .= "<span class='label label-sm label-primary'><i class='fa fa-user'></i> " . $usu->Evaluado . "</span><br>";
                                }
                                if ($dato_box_objetivos[0] == "B" && $dato_box[0] == "B") {
                                    $contador_bb++;
                                    $acumulador_bb .= "<span class='label label-sm label-primary'><i class='fa fa-user'></i> " . $usu->Evaluado . "</span><br>";
                                }
                                if ($dato_box_objetivos[0] == "B" && $dato_box[0] == "M") {
                                    $contador_bm++;
                                    $acumulador_bm .= "<span class='label label-sm label-primary'><i class='fa fa-user'></i> " . $usu->Evaluado . "</span><br>";
                                }
                                if ($dato_box_objetivos[0] == "B" && $dato_box[0] == "A") {
                                    $contador_ba++;
                                    $acumulador_ba .= "<span class='label label-sm label-primary'><i class='fa fa-user'></i> " . $usu->Evaluado . "</span><br>";
                                }
                            }
                        }
                    } else {
                        $rows = str_replace("{COMPETENCIAS_FINAL}", "", $rows);
                        $rows = str_replace("{NOTA_FINAL}", "", $rows);
                        $rows = str_replace("{OBJETIVOS_FINAL}", "", $rows);
                        $rows = str_replace("{CUADRANTE_COMPETENCIAS_FINAL}", "", $rows);
                        $rows = str_replace("{CUADRANTE_OBJETIVOS_FINAL}", "", $rows);
                        $rows = str_replace("{CUADRANTE_NOTA_FINAL}", "", $rows);
                    }
                    //Traigo los objetivos y sus respuestas + comentarios para agregarlos
                    $objetivos = ObjetivosConRespuestaParaCompass($usu->evaluado, $usu->evaluador);
                    $td_objetivos = "";
                    for ($k = 0; $k < 12; $k++) {
                        $td_objetivos .= "
                <td>" . $objetivos[$k]->descripcion_objetivo . "</td>
                <td>" . $objetivos[$k]->metrica . "</td>
                <td>" . $objetivos[$k]->puntaje . "</td>
                <td>" . $objetivos[$k]->comentario . "</td>
            ";
                    }
                    $rows = str_replace("{TD_OBJETIVOS}", $td_objetivos, $rows);
                    $comentarios_finales = ComentarioFinalCompass($usu->evaluado, $usu->evaluador);
                    $rows = str_replace("{SUCESOR}", $comentarios_finales[0]->sucesor, $rows);
                    $intereses_de_carrera = InteresesDeCarreraCompass($usu->evaluado, $usu->evaluador);
                    $td_intereses = "";
                    for ($in = 0; $in < 10; $in++) {
                        $td_intereses .= "<td>" . $intereses_de_carrera[$in]->interes . "</td>";
                    }
                    foreach ($intereses_de_carrera as $int) {
                        //$td_intereses.="<td>".$int->interes."</td>";
                    }
                    //objetivos fijados
                    $td_objetivos_fijados = "";
                    $obj_fijados = RESULTADOS_ObjetivosFijadosCompass($usu->evaluado);
                    for ($io = 0; $io < 6; $io++) {
                        $td_objetivos_fijados .= "
                <td>" . $obj_fijados[$io]->objetivo . "</td>
                <td>" . $obj_fijados[$io]->medicion_cumplimiento . "</td>
                ";
                    }
                    //planes fijados
                    $plan_fijados = RESULTADOS_PlanFijadosCompass($usu->evaluado);
                    $td_plan_fijados = "";
                    for ($ip = 0; $ip < 6; $ip++) {
                        $td_plan_fijados .= "
                <td>" . $plan_fijados[$ip]->areas_desarrollo . "</td>
                <td>" . $plan_fijados[$ip]->acciones_requeridas . "</td>
                ";
                    }
                    $rows = str_replace("{TD_INTERESES}", $td_intereses, $rows);
                    $rows = str_replace("{TD_FIJACION_OBJETIVOS}", $td_objetivos_fijados, $rows);
                    $rows = str_replace("{TD_FIJACION_PLANES}", $td_plan_fijados, $rows);
                    $acumulador_porcentajes_avance_malla = $acumulador_porcentajes_avance_malla + $datos_calculos_malla[1];
                    //echo "acumulador_porcentajes_avance_malla $acumulador_porcentajes_avance_malla=$acumulador_porcentajes_avance_malla+".$datos_calculos_malla[1]."";
                    $acumulador_visitas = $acumulador_visitas + $datos_calculos_malla[2][8];
                    if ($datos_calculos_malla[1] == 100) {
                        $acumula_finalizados++;
                    }
                    if ($datos_calculos_malla[1] == 0) {
                        $acumula_no_iniciados++;
                    }
                    if ($datos_calculos_malla[1] > 0 and $datos_calculos_malla[1] < 100) {
                        $acumula_en_proceso++;
                    }
                    if ($excel == 1) {
                        //echo utf8_decode($rows);
                    }
                }
                $PRINCIPAL = str_replace("{AB}", utf8_encode($acumulador_ab), $PRINCIPAL);
                $PRINCIPAL = str_replace("{NUM_AB}", $contador_ab, $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORC_AB}", round(($contador_ab * 100) / $acumulador_total) . "%", $PRINCIPAL);
                $PRINCIPAL = str_replace("{AM}", utf8_encode($acumulador_am), $PRINCIPAL);
                $PRINCIPAL = str_replace("{NUM_AM}", $contador_am, $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORC_AM}", round(($contador_am * 100) / $acumulador_total) . "%", $PRINCIPAL);
                $PRINCIPAL = str_replace("{AA}", utf8_encode($acumulador_aa), $PRINCIPAL);
                $PRINCIPAL = str_replace("{NUM_AA}", $contador_aa, $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORC_AA}", round(($contador_aa * 100) / $acumulador_total) . "%", $PRINCIPAL);
                $PRINCIPAL = str_replace("{MB}", utf8_encode($acumulador_mb), $PRINCIPAL);
                $PRINCIPAL = str_replace("{NUM_MB}", $contador_mb, $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORC_MB}", round(($contador_mb * 100) / $acumulador_total) . "%", $PRINCIPAL);
                $PRINCIPAL = str_replace("{MM}", utf8_encode($acumulador_mm), $PRINCIPAL);
                $PRINCIPAL = str_replace("{NUM_MM}", $contador_mm, $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORC_MM}", round(($contador_mm * 100) / $acumulador_total) . "%", $PRINCIPAL);
                $PRINCIPAL = str_replace("{MA}", utf8_encode($acumulador_ma), $PRINCIPAL);
                $PRINCIPAL = str_replace("{NUM_MA}", $contador_ma, $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORC_MA}", round(($contador_ma * 100) / $acumulador_total) . "%", $PRINCIPAL);
                $PRINCIPAL = str_replace("{BB}", utf8_encode($acumulador_bb), $PRINCIPAL);
                $PRINCIPAL = str_replace("{NUM_BB}", $contador_bb, $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORC_BB}", round(($contador_bb * 100) / $acumulador_total) . "%", $PRINCIPAL);
                $PRINCIPAL = str_replace("{BM}", utf8_encode($acumulador_bm), $PRINCIPAL);
                $PRINCIPAL = str_replace("{NUM_BM}", $contador_bm, $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORC_BM}", round(($contador_bm * 100) / $acumulador_total) . "%", $PRINCIPAL);
                $PRINCIPAL = str_replace("{BA}", utf8_encode($acumulador_ba), $PRINCIPAL);
                $PRINCIPAL = str_replace("{NUM_BA}", $contador_ba, $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORC_BA}", round(($contador_ba * 100) / $acumulador_total) . "%", $PRINCIPAL);
                //echo "$i $acumula_finalizados $acumula_en_proceso $acumula_no_iniciados $acumula_ingresos";
                $acumula_ingresos = $acumula_en_proceso + $acumula_finalizados;
                $PRINCIPAL = str_replace("{LISTADO_USUARIOS_RESULTADOS}", utf8_encode($rows), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS}", $i, $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_TOTAL}", number_format($acumulador_porcentajes_avance_malla / $i, 0, ",", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_ACCESOS}", $acumulador_visitas, $PRINCIPAL);
                //Bloque Total de Porcentaje Total
                //$PRINCIPAL = str_replace("{GRAFICO_PORCENTAJE_TOTAL}",file_get_contents("views/graficos/grafico_circulo.html"),$PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE}", number_format(100 * $acumula_finalizados / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_FINALIZADOS}", number_format($acumula_finalizados, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_FINALIZADOS}", number_format(100 * $acumula_finalizados / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_PROCESO}", number_format($acumula_en_proceso, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_PROCESO}", number_format(100 * $acumula_en_proceso / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_NOINICIADO}", number_format($acumula_no_iniciados, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_NOINICIADO}", number_format(100 * $acumula_no_iniciados / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_INGRESADOS}", number_format($acumula_ingresos, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_INGRESADOS}", number_format(100 * $acumula_ingresos / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{TEXTO}", "Avance", $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOMBRE_GRAFICO}", "Avance", $PRINCIPAL);
                //Bloque Total de ACESOS
                //$PRINCIPAL = str_replace("{GRAFICO_CANTIDAD_ACCESOS}",file_get_contents("views/graficos/grafico_circulo.html"),$PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE}", number_format(100 * $acumula_finalizados / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{TEXTO}", "Accesos", $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOMBRE_GRAFICO}", "Accesos", $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function ReporteSGDResultadosEvaluadoEvaluadorAEDSC($PRINCIPAL, $id_empresa, $arreglo_post, $criterio, $excel, $tipo_reporte)
            {
                //echo "$id_empresa, $arreglo_post, $criterio, $excel";
                $PRINCIPAL = str_replace("{ID_EMPRSA}", $id_empresa, $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTION_SUCURSALES}", utf8_encode($option_sucursales), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTION_LOCAL}", utf8_encode($option_locales), $PRINCIPAL);
                //Traigo el listado de usuarios
                $i = 0;
                $acumulador_porcentajes_avance_malla = 0;
                $acumulador_visitas = 0;
                if ($excel or $arreglo_post or $tipo_reporte) {
                    //$usuarios=sgd_relaciones_proceso($id_empresa,$arreglo_post);
                    $usuarios = sgd_relaciones_procesoConResultadosAEDESC($id_empresa, $id_proceso, $arreglo_post, $criterio, $valor);
                }


                //print_r($usuarios);


                foreach ($usuarios as $usu) {

                    if ($usu->CuadranteDS == "ALTO" and $usu->CuadranteAE == "ALTO") {
                        $LISTA_DS_ALTO_AE_ALTO .= "<i class='fas fa-caret-right'></i> <small>" . $usu->evaluado_nombre . "</small> <small> <small>" . $usu->evaluado_cargo . " AE:" . $usu->ResultadoAE . " DS:" . $usu->resultado . "</small></small><BR> ";
                    }
                    if ($usu->CuadranteDS == "ALTO" and $usu->CuadranteAE == "BAJO") {
                        $LISTA_DS_ALTO_AE_BAJO .= "<i class='fas fa-caret-right'></i> <small>" . $usu->evaluado_nombre . "</small> <small> <small>" . $usu->evaluado_cargo . " AE:" . $usu->ResultadoAE . " DS:" . $usu->resultado . "</small></small><BR> ";
                    }
                    if ($usu->CuadranteDS == "BAJO" and $usu->CuadranteAE == "ALTO") {
                        $LISTA_DS_BAJO_AE_ALTO .= "<i class='fas fa-caret-right'></i> <small>" . $usu->evaluado_nombre . "</small> <small> <small>" . $usu->evaluado_cargo . " AE:" . $usu->ResultadoAE . " DS:" . $usu->resultado . "</small></small><BR> ";
                    }
                    if ($usu->CuadranteDS == "BAJO" and $usu->CuadranteAE == "BAJO") {
                        $LISTA_DS_BAJO_AE_BAJO .= "<i class='fas fa-caret-right'></i> <small>" . $usu->evaluado_nombre . "</small> <small> <small>" . $usu->evaluado_cargo . " AE:" . $usu->ResultadoAE . " DS:" . $usu->resultado . "</small></small><BR> ";
                    }

                }
                $PRINCIPAL = str_replace("{LISTA_DS_BAJO_AE_ALTO}", utf8_encode($LISTA_DS_BAJO_AE_ALTO), $PRINCIPAL);

                $PRINCIPAL = str_replace("{LISTA_DS_ALTO_AE_ALTO}", utf8_encode($LISTA_DS_ALTO_AE_ALTO), $PRINCIPAL);

                $PRINCIPAL = str_replace("{LISTA_DS_BAJO_AE_BAJO}", utf8_encode($LISTA_DS_BAJO_AE_BAJO), $PRINCIPAL);

                $PRINCIPAL = str_replace("{LISTA_DS_ALTO_AE_BAJO}", utf8_encode($LISTA_DS_ALTO_AE_BAJO), $PRINCIPAL);


                return ($PRINCIPAL);
            }

            function FechaExcelPhp($number)
            {
                $UNIX_DATE = ($number - 25569) * 86400;
                $fecha = gmdate("Y-m-d", $UNIX_DATE);
                return $fecha;
            }

            function LimpiaRut($rut)
            {

                $id_empresa = $_SESSION["id_empresa"];

                if ($id_empresa <> '75') {
                    $rut = str_replace(".", "", $rut);
                    $arreglo_rut = explode("-", $rut);
                    return ($arreglo_rut[0]);
                } else {
                    return $rut;
                }

            }

            function ReporteCapacitacionObjetosSolofiltros($PRINCIPAL, $id_empresa, $arreglo_post, $excel)
            {
                $tipo_de_reporte = "detallado";
                $datos_empresa = DatosEmpresa($id_empresa);
                $campo1 = $datos_empresa[0]->campo1;
                $campo2 = $datos_empresa[0]->campo2;
                $campo3 = $datos_empresa[0]->campo3;
                $id_objeto = $arreglo_post["objetos"];
                $mallas = TraeMallasEmpresa($id_empresa);
                foreach ($mallas as $malla) {
                    if ($arreglo_post["malla"] == $malla->id) {
                        $option_mallas .= '<option selected value="' . $malla->id . '">' . $malla->nombre . '</option>';
                    } else {
                        $option_mallas .= '<option value="' . $malla->id . '">' . $malla->nombre . '</option>';
                    }
                }
                //$cursos=TraeCursos("0",$id_empresa);
                $cursos = TraeCursos("0", $id_empresa);
                //$cursos=TraeCursos($arreglo_post["malla"],$id_empresa);
                $option_cursos = "";
                foreach ($cursos as $curso) {
                    if ($arreglo_post["curso"] == $curso->id) {
                        $option_cursos .= '<option value="' . $curso->id . '" selected>' . $curso->nombre . '</option>';
                    } else {
                        $option_cursos .= '<option value="' . $curso->id . '">' . $curso->nombre . '</option>';
                    }
                }
                $objetos = TraeObjetos($arreglo_post["curso"], $id_empresa);
                foreach ($objetos as $objeto) {
                    if ($arreglo_post["objetos"] == $objeto->id) {
                        $option_objetos .= '<option selected="selected" value="' . $objeto->id . '">' . $objeto->titulo . '</option>';
                    } else {
                        $option_objetos .= '<option value="' . $objeto->id . '">' . $objeto->titulo . '</option>';
                    }
                }
                $PRINCIPAL = str_replace("{MALLAS}", utf8_encode($option_mallas), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CURSOS}", utf8_encode($option_cursos), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OBJETOS}", utf8_encode($option_objetos), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_EMPRSA}", $id_empresa, $PRINCIPAL);
                //Traigo a todos los usuarios de esta empresa
                return ($PRINCIPAL);
            }

            function ListadoUsuariosRutColaborador($PRINCIPAL, $id_empresa, $rut)
            {
                //Traigo el total de empresas que existen en el sistema
                $Campos = TraeCampos($id_empresa);
                $Campos1 = $Campos[0]->campo1;
                $Campos2 = $Campos[0]->campo2;
                $Campos3 = $Campos[0]->campo3;
                $total_html = "";
                $i = 1;
                $pi = 0;
                $Usuarios = TraeUsuariosEmpresaFiltrosUltimoRutColaborador($id_empresa, $rut, $Campos1, $Campos2, $Campos3);
                $ACampo1 = array();
                $ACampo2 = array();
                $ACampo3 = array();
                if ($excel == 1) {
                    $row_html = file_get_contents("views/basepersonas/" . $id_empresa . "_row_personas_excel.html");
                } else {
                    $row_html = file_get_contents("views/basepersonas/" . $id_empresa . "_row_personas.html");
                }
                foreach ($Usuarios as $unico) {
                    $row = $row_html;
                    //$row = str_replace("{FOTO}",VerificaFotoPersonalDesdeAdmin($unico->rut),$row);
                    //$row = str_replace("{FOTO}",ColocaImagenVerificaAvatar($unico->rut, "admin"),$row);
                    //$row = str_replace("{LIDER}",$datos_si_Es_jefe,$row);
                    $row = str_replace("{NOMBRE_USUARIO}", $unico->nombre . " " . $unico->apaterno . " " . $unico->amaterno, $row);
                    $row = str_replace("{APATERNO}", $unico->apaterno, $row);
                    $row = str_replace("{AMATERNO}", $unico->amaterno, $row);
                    $row = str_replace("{CLAVE}", $unico->clave, $row);
                    if ($unico->cambiado == "0") {
                        $cambio = "(Sin cambios)";
                    } else {
                        if ($unico->cambiado == "") {
                            $cambio = "(Sin datos)";
                        } else {
                            if ($unico->fecha_cambio_clave) {
                                $cambio = "(Actualizada - " . $unico->fecha_cambio_clave . ")";
                            } else {
                                $cambio = "(Actualizada)";
                            }
                        }
                    }
                    $row = str_replace("{CAMBIO}", $cambio, $row);
                    $row = str_replace("{RUT_ENCODEADO}", Encodear3($unico->rut), $row);
                    $row = str_replace("{CARGO}", $unico->cargo, $row);
                    $row = str_replace("{EMAIL}", $unico->email, $row);
                    if ($unico->id_malla) {
                        //$row = str_replace("{TIENE_MALLA}",'Malla: <span class="etiqueta  label-success">Si</span>',$row);
                        $row = str_replace("{TIENE_MALLA}", '<span class="etiqueta  label-success">{NOMBREMALLA}</span>', $row);
                    } else {
                        $row = str_replace("{TIENE_MALLA}", '<span class="etiqueta  label-danger">Sin Malla</span>', $row);
                    }
                    $row = str_replace("{MALLA}", $unico->id_malla, $row);
                    $row = str_replace("{NOMBREMALLA}", $unico->nombre_malla, $row);
                    //$row = str_replace("{JEFATURA}",$unico->jefe,$row);
                    $row = str_replace("{OPTIONS_MALLAS}", utf8_decode(OptionsGenericoNombreDadoValoresPorEmpresa("tbl_lms_malla", $unico->id_malla, "nombre", "id", "order by nombre", $_SESSION["id_empresa"])), $row);
                    $row = str_replace("{JEFATURA}", $unico->nombre_completo_jefe, $row);
                    $row = str_replace("{ACCESOS}", $unico->total_accesos, $row);
                    $row = str_replace("{ULTIMOACCESO}", $unico->ultimo_ingreso, $row);
                    $row = str_replace("{ACTUALIZACION}", $unico->fecha_actualizacion, $row);
                    $row = str_replace("{RUT}", $unico->rut, $row);
                    $row = str_replace("{RUTCOMPLETO}", $unico->rut_completo, $row);
                    $row = str_replace("{CAMPO1}", $unico->campo1, $row);
                    $row = str_replace("{CAMPO2}", $unico->campo2, $row);
                    $row = str_replace("{CAMPO3}", $unico->campo3, $row);
                    $row = str_replace("{ID_EMPRESA}", $id_empresa, $row);
                    $ACampo1[$pi] = $unico->campo1;
                    $ACampo2[$pi] = $unico->campo2;
                    $ACampo3[$pi] = $unico->campo3;
                    $row = str_replace("{NCAMPO1}", str_replace("_", " ", ucwords($Campos1)), $row);
                    $row = str_replace("{NCAMPO2}", str_replace("_", " ", ucwords($Campos2)), $row);
                    $row = str_replace("{NCAMPO3}", str_replace("_", " ", ucwords($Campos3)), $row);
                    $row = str_replace("{MALLA}", $unico->malla, $row);
                    //obtener numero de cursos
                    $row = str_replace("{OPCIONES}", "", $row);
                    //echo $row;
                    $total_html .= $row;
                    $pi++;
                }
                /*
    $total_paginas=redondea($registros_total/$registros_pagina);
    $total_paginas_=$registros_total/$registros_pagina;
    $pagina_anterior = $pagina - 1;
    $posterior = $pagina + 1;
        if($pagina>1){
        $paginacion.=file_get_contents("views/paginacion/1.html");
        $paginacion = str_replace("{ENV}","listusu&c1=".$scampo1."&c2=".$scampo2."&c3=".$scampo3."",$paginacion);
        $paginacion = str_replace("{PAGINA}",($pagina-1),$paginacion);
        $paginacion = str_replace("{PAGINAINICIAL}","1",$paginacion);
        $paginacion = str_replace("{REGISTROS}",round($registros_pagina),$paginacion);
        $paginacion = str_replace("{DESDEINICIO}",1,$paginacion);
        $paginacion = str_replace("{DESDE}",round($desde)-$registros_pagina,$paginacion);
        $paginacion = str_replace("{TOTALREGISTROS}",round($registros_total),$paginacion);
    }
    $Cnum=10;
       if($Cnum>$total_paginas){
       $Cnum=$total_paginas;
    }
    if(($pagina+$Cnum)>$total_paginas){
        $resta=$pagina+$Cnum;
        $valor=($pagina+$Cnum)-$total_paginas;
        $pagina1=$pagina-$valor;
    }else{
    $pagina1=$pagina;
    }
    for($i=$pagina1;$i<=round(($pagina1)+$Cnum);$i++){
        if ($i!=0){
        if($pagina==$i){
            $paginacion.=file_get_contents("views/paginacion/actual.html");
            $paginacion = str_replace("{PAGINA}",($i),$paginacion);
            $paginacion = str_replace("{ENV}","listusu",$paginacion);
        }else{
            $paginacion.=file_get_contents("views/paginacion/numero.html");
            $paginacion = str_replace("{PAGINA}",($i),$paginacion);
            $paginacion = str_replace("{REGISTROS}",round($registros_pagina),$paginacion);
            if ($desde1==""){
             $desde1=(($registros_pagina*$i)+1)-$registros_pagina;
             }
            $paginacion = str_replace("{DESDE}",$desde1,$paginacion);
            $paginacion = str_replace("{TOTALREGISTROS}",round($registros_total),$paginacion);
            $paginacion = str_replace("{ENV}","listusu&c1=".$scampo1."&c2=".$scampo2."&c3=".$scampo3."",$paginacion);
        }
        $desde1=($registros_pagina*$i)+1;
        }
    }
    if($pagina<$total_paginas){
        $paginacion.=file_get_contents("views/paginacion/4.html");
        $paginacion = str_replace("{ENV}","listusu&c1=".$scampo1."&c2=".$scampo2."&c3=".$scampo3."",$paginacion);
        $paginacion = str_replace("{PAGINA}",($pagina+1),$paginacion);
        $paginacion = str_replace("{PAGINAFINAL}",$total_paginas,$paginacion);
        $paginacion = str_replace("{REGISTROS}",round($registros_pagina),$paginacion);
        $paginacion = str_replace("{DESDE}",($pagina*$registros_pagina)+1,$paginacion);
        $paginacion = str_replace("{DESDEFINAL}",(((int)($total_paginas_))*$registros_pagina)+1,$paginacion);
        $paginacion = str_replace("{TOTALREGISTROS}",round($registros_total),$paginacion);
    }
        $PRINCIPAL = str_replace("{REGISTROS".$registros_pagina."}","selected",$PRINCIPAL);
        $PRINCIPAL = str_replace("{PAGINACION}",$paginacion,$PRINCIPAL);
        $PRINCIPAL = str_replace("{RESUMEN}","Hay un total de ".$registros_total." Usuarios",$PRINCIPAL);
          $AgrupaCampo1=AgrupaCampos($Campos1);
          foreach($AgrupaCampo1 as $C1){
            if($C1->campo==$scampo1_){$selec="selected";}else{$selec="";};
               $OPCION1.='<option '.$selec.' value="'.$C1->campo.'">'.$C1->campo.'</option>';
          }
          $AgrupaCampo2=AgrupaCampos($Campos2);
          foreach($AgrupaCampo2 as $C2){
            if($C2->campo==$scampo2_){
                $selec2="selected";
                }else{
                $selec2="";
                }
               $OPCION2.='<option '.$selec2.' value="'.$C2->campo.'">'.$C2->campo.'</option>';
          }
          $AgrupaCampo3=AgrupaCampos($Campos3);
          foreach($AgrupaCampo3 as $C3){
            if($C3->campo==$scampo3_){$selec3="selected";}else{$selec3="";};
               $OPCION3.='<option '.$selec3.' value="'.$C3->campo.'">'.$C3->campo.'</option>';
          }
            */
                //NOMBRE CAMPO TABLA
                $PRINCIPAL = str_replace("{CAMPO1}", $Campos1, $PRINCIPAL);
                $PRINCIPAL = str_replace("{CAMPO2}", $Campos2, $PRINCIPAL);
                $PRINCIPAL = str_replace("{CAMPO3}", $Campos3, $PRINCIPAL);
                //OPCIONS DE SELECT
                $PRINCIPAL = str_replace("{CAMPO1OP}", utf8_encode($OPCION1), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CAMPO2OP}", utf8_encode($OPCION2), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CAMPO3OP}", utf8_encode($OPCION3), $PRINCIPAL);
                //NOMBRE FORMATEADO
                $PRINCIPAL = str_replace("{NCAMPO1}", str_replace("_", " ", ucwords($Campos1)), $PRINCIPAL);
                $PRINCIPAL = str_replace("{NCAMPO2}", str_replace("_", " ", ucwords($Campos2)), $PRINCIPAL);
                $PRINCIPAL = str_replace("{NCAMPO3}", str_replace("_", " ", ucwords($Campos3)), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ROW_LISTADO_USUARIOS}", utf8_encode($total_html), $PRINCIPAL);
                return ($PRINCIPAL);
                exit;
                //Traigo el total de empresas que existen en el sistema
                //Con la variable tipo usuario, veo si es para el listado de usuarios, o para el listado de envio de correos.
                if ($arreglo_post["n_registros"]) {
                    $usuarios_por_pagina = $arreglo_post["n_registros"];
                } else {
                    $usuarios_por_pagina = 20;
                }
                if (!$pagina) {
                    $pagina = 1;
                }
                if ($tipo_listado == "correos") {
                    $entorno_para_paginacion = "listusuco";
                } else {
                    $entorno_para_paginacion = "listusu";
                }
                //$usuarios=TotalUsuarios($arreglo_post, $_SESSION["id_empresa"], $pagina, $usuarios_por_pagina);
                //$usuarios=SelectParaPaginacionUsuario("tbl_usuario", $_SESSION["id_empresa"], $usuarios_por_pagina);
                $PRINCIPAL = str_replace("{FILTROS_SUPERIORES}", file_get_contents("views/filtros/barra_superior_usuarios.html"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ENVIRONMENT}", $entorno_para_paginacion, $PRINCIPAL);
                $usuarios = DatosParaListadoPaginado("tbl_usuario", $_SESSION["id_empresa"], $usuarios_por_pagina, $pagina, $arreglo_post);
                $PRINCIPAL = str_replace("{PAGINACION}", ArmaPaginacionGenerico($pagina, $entorno_para_paginacion, "tbl_usuario", $usuarios_por_pagina, $arreglo_post, $_SESSION["id_empresa"]), $PRINCIPAL);
                $total_empresas = "";
                if ($tipo_listado == "correos") {
                    $html_row = file_get_contents("views/basepersonas/row_personas_envio_correos.html");
                } else if ($tipo_listado == "usuarios") {
                    if ($_SESSION["id_empresa"] == 28) {
                        $html_row = file_get_contents("views/basepersonas/row_personas_chilquinta.html");
                    } else {
                        $html_row = file_get_contents("views/basepersonas/row_personas.html");
                    }
                }
                $i = 1;
                foreach ($usuarios as $unico) {
                    $row = $html_row;
                    if ($pagina == 1) {
                        $row = str_replace("{N}", $i, $row);
                    } else {
                        $row = str_replace("{N}", $i + (($pagina - 1) * $usuarios_por_pagina), $row);
                    }
                    $i++;
                    /*$vecesenviadoemail=vecesenviado($unico->rut, $proceso, $empresa);
            foreach($vecesenviadoemail as $vecesenviadoemailunico){
                    $row = str_replace("{VECESENVIADO}",$vecesenviadoemailunico->cuenta,$row);
                }
        $datos_si_Es_jefe=count(ColaboradoresDadoJefe($unico->rut));
        */
                    $row = str_replace("{LIDER}", $datos_si_Es_jefe, $row);
                    $row = str_replace("{NOMBRE_USUARIO}", $unico->nombre . " " . $unico->apaterno . " " . $unico->amaterno, $row);
                    $row = str_replace("{APATERNO}", $unico->apaterno, $row);
                    $row = str_replace("{AMATERNO}", $unico->amaterno, $row);
                    $row = str_replace("{NOMBRE}", $unico->nombre, $row);
                    $row = str_replace("{NOMBRE_COMPLETO}", $unico->nombre_completo, $row);
                    $row = str_replace("{CLAVE}", $unico->clave, $row);
                    if ($unico->cambiado == "0") {
                        $cambio = "(Sin cambios)";
                    } else {
                        $cambio = "(Actualizada)";
                    }
                    $row = str_replace("{CAMBIO}", $cambio, $row);
                    $row = str_replace("{RUT}", $unico->rut_completo, $row);
                    $row = str_replace("{RUT_ENCODEADO}", Encodear3($unico->rut), $row);
                    $row = str_replace("{GERENCIA}", $unico->gerencia, $row);
                    $row = str_replace("{CENTROCOSTO}", $unico->centro_costo, $row);
                    $row = str_replace("{CARGO}", $unico->cargo, $row);
                    $row = str_replace("{EMPRESA_HOLDING}", $unico->nombre_empresa_holding_, $row);
                    $row = str_replace("{EMAIL}", $unico->email, $row);
                    $row = str_replace("{PERFIL}", $unico->perfil_evaluacion, $row);
                    $row = str_replace("{TRAMO}", $unico->tramo_sence . "%", $row);
                    //$row = str_replace("{PERFIL_EVALUACION}",OptionsGenericoNombreDadoValoresPorEmpresa("tbl_sgd_perfiles_ponderaciones", $unico->perfil_evaluacion,  "descripcion", "perfil", "order by descripcion asc", $_SESSION["id_empresa"]),$row);
                    $row = str_replace("{PERFIL_EVALUACION}", $unico->perfil_evaluacion_descripcion, $row);
                    $row = str_replace("{OPTIONS_TIPOS_CORREOS}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_correos", "", "asunto", "id", "order by asunto", $_SESSION["id_empresa"]), $row);
                    $PRINCIPAL = str_replace("{OPTIONS_GERENCIAS}", OptionsGenericoPorEmpresa("gerencia", "tbl_usuario", $arreglo_post["gerencia"], $_SESSION["id_empresa"]), $PRINCIPAL);
                    $total_empresas .= $row;
                }
                $PRINCIPAL = str_replace("{ROW_LISTADO_USUARIOS}", utf8_encode($total_empresas), $PRINCIPAL);
                //$PRINCIPAL = str_replace("{PAGINACION}",ArmaPaginacionUsuarios($pagina, "listusu", "tbl_usuario"),$PRINCIPAL);
                //PAGINACION
                return ($PRINCIPAL);
            }


            function ListaImparticionesT($PRINCIPAL, $id_curso, $Empresa, $excel)
            {
                $Incripciones = TraeImparticionEmpresaT($id_curso, $Empresa);
                $rows_ = "";
                $rows1_ = "";
                foreach ($Incripciones as $unico) {
                    if ($excel == "1") {
                        $rows_ = file_get_contents("views/capacitacion/imparticionT/row_listado_excel.html");
                    } else {
                        $rows_ = file_get_contents("views/capacitacion/imparticionT/" . $Empresa . "_row_listado.html");
                    }
                    $rows_ = str_replace("{CODIGOINCRIPCION}", $unico->codigo_inscripcion, $rows_);
                    $array_fechasT = BuscaFechasRelInscripcion($unico->codigo_inscripcion);
                    ImparticionMod4ActualizaIdMalla($unico->codigo_inscripcion, $Empresa);
                    $rows_ = str_replace("{FECHA_INICIO_T}", $array_fechasT[0]->fecha_inicio, $rows_);
                    $rows_ = str_replace("{FECHA_TERMINO_T}", $array_fechasT[0]->fecha_termino, $rows_);
                    $rows_ = str_replace("{HORA_INICIO_T}", $array_fechasT[0]->hora_inicio, $rows_);
                    $rows_ = str_replace("{HORA_TERMINO_T}", $array_fechasT[0]->hora_termino, $rows_);
                    $rows_ = str_replace("{ID_INSCRIPCION_ENCODEADO}", Encodear3($unico->codigo_inscripcion), $rows_);
                    //$arreglo_objetos[0]->codigo_inscripcion=$unico->codigo_inscripcion;
                    $arreglo_post["id_empresa"] = $Empresa;
                    $arreglo_post["codigo_imparticion_escrito"] = $unico->codigo_inscripcion;
                    $arreglo_post["imparticion"] = $unico->codigo_inscripcion;
                    //$arreglo_objetos=Lms_Busca_Objetos_Enc_sat_Imparticion($arreglo_post, $Empresa);
                    //$rows_=Lms_reporte_MuestraInformeDimEncNota($rows_, $Empresa, $arreglo_objetos, "", "", $excel, $arreglo_post);
                    $arreglo_post_objeto = $arreglo_objetos;
                    $array_para_enviar_via_url_objetos = serialize($arreglo_post_objeto);
                    $array_para_enviar_via_url_objetos = urlencode($array_para_enviar_via_url_objetos);
                    //$rows_ = str_replace("{ARREGLO_OBJETO}",$array_para_enviar_via_url_objetos ,$rows_);
                    $array_para_enviar_via_url_post = serialize($arreglo_post);
                    $array_para_enviar_via_url_post = urlencode($array_para_enviar_via_url_post);
                    $rows_ = str_replace("{ARREGLO_POST}", $array_para_enviar_via_url_post, $rows_);
                    $inscritos = "<br><strong>" . $unico->inscritos . "</strong> Inscritos";
                    $inscritos_numero = $unico->inscritos;
                    $cupos = "<br><strong>" . $unico->cupos . "</strong> Cupos";
                    $cupos_numero = $unico->cupos;
                    $chequeados = "<strong>" . $unico->chequeados . "</strong> Asistentes";
                    $chequeados_numero = $unico->chequeados;
                    if ($unico->preinscritos > 0) {
                        $preinscritos = "<br><strong>" . $unico->preinscritos . "</strong> Preinscritos";
                        $preinscritos_numero = $unico->preinscritos;
                    } else {
                        $preinscritos = "<br><strong>0</strong> Preinscritos";
                        $preinscritos_numero = 0;
                    }
                    if ($unico->postulantes > 0) {
                        $postulantes = "<br><strong>" . $unico->postulantes . "</strong> Postulantes";
                        $postulantes_numero = $unico->postulantes;
                    } else {
                        $postulantes = "<br><strong>0</strong> Postulantes";
                        $postulantes_numero = 0;
                    }
                    $rows_ = str_replace("{EJECUTIVO}", $unico->ejecutivo, $rows_);
                    if ($unico->modalidad == 1) {
                        $modalidad_curso = "ELEARNING";
                    } else {
                        $modalidad_curso = "PRESENCIAL";
                    }
                    $rows_ = str_replace("{MODALIDAD_CURSO}", $modalidad_curso, $rows_);
                    $rows_ = str_replace("{NUM_PARTICIPANTES}", $unico->num_participantes, $rows_);
                    $rows_ = str_replace("{INSCRITOS}", $inscritos, $rows_);
                    $rows_ = str_replace("{INSCRITOS_NUMERO}", $inscritos_numero, $rows_);
                    $rows_ = str_replace("{PREINSCRITOS}", $preinscritos, $rows_);
                    $rows_ = str_replace("{PREINSCRITOS_NUMERO}", $preinscritos_numero, $rows_);
                    $rows_ = str_replace("{POSTULANTES}", $postulantes, $rows_);
                    $rows_ = str_replace("{POSTULANTES_NUMERO}", $postulantes_numero, $rows_);
                    $rows_ = str_replace("{CUPOS}", $cupos, $rows_);
                    $rows_ = str_replace("{CUPOS_NUMERO}", $cupos_numero, $rows_);
                    $rows_ = str_replace("{CHEQUEADOS}", $chequeados, $rows_);
                    $rows_ = str_replace("{CHEQUEADOS_NUMERO}", $chequeados_numero, $rows_);
                    if ($unico->modalidad == 1) {
                        $tipo = "Elearning";
                    }
                    if ($unico->modalidad == 2) {
                        $tipo = "Presencial";
                    }
                    $rows_ = str_replace("{TIPO}", $tipo, $rows_);
                    $rows_ = str_replace("{DESCARGA_PARTICIPANTES}", "<a href='?sw=DescargaPresencialImparticion&ci=" . encodear3($unico->codigo_inscripcion) . "' title='Descargar Participantes a Excel'><i class='fas fa-download'></i></a>", $rows_);
                    $rows_ = str_replace("{CLASIFICACION}", $unico->clasificacion, $rows_);
                    $rows_ = str_replace("{CURSO}", $unico->nombre, $rows_);
                    $rows_ = str_replace("{ID_CURSO}", $unico->id_curso, $rows_);
                    if (formatearFechaSmall($unico->fecha_inicio) == "30-11--0001") {
                        $rows_ = str_replace("{FECHA_INICIO}", "", $rows_);
                    } else {
                        $rows_ = str_replace("{FECHA_INICIO}", formatearFechaSmall($unico->fecha_inicio), $rows_);
                    }
                    if (formatearFechaSmall($unico->fecha_termino) == "30-11--0001") {
                        $rows_ = str_replace("{FECHA_TERMINO}", "", $rows_);
                    } else {
                        $rows_ = str_replace("{FECHA_TERMINO}", formatearFechaSmall($unico->fecha_termino), $rows_);
                    }
                    $rows_ = str_replace("{DIRECCION}", ($unico->direccion), $rows_);
                    $rows_ = str_replace("{DIRECCION}", ($unico->direccion), $rows_);
                    $rows_ = str_replace("{CIUDAD}", ($unico->ciudad), $rows_);
                    $rows_ = str_replace("{CUPOS}", ($unico->cupos), $rows_);
                    //echo $unico->numero_horas;echo "<br>";
                    $segundos = TransformaHoraASegundos($unico->numero_horas);
                    //echo $segundos;echo " segundos del curso <br>";
                    //$rows_ = str_replace("{NUMSESIONES}",($unico->sesiones),$rows_);
                    $rows_ = str_replace("{NUMSESIONES}", ($unico->total_sesiones), $rows_);
                    $lista_sesiones_reales = "";
                    $lista_sesiones_reales_XLS = "";
                    $InsSesiones = InsSesionesImparticion($Empresa, $unico->codigo_inscripcion);
                    //print_r($InsSesiones);
                    foreach ($InsSesiones as $InsSesion) {
                        //print_r($InsSesion);
                        //echo "<br>";
                        $tiempo_am = tiempoTranscurridoFechasPreguntados(date("Y-m-d") . " " . $InsSesion->desde_am, date("Y-m-d") . " " . $InsSesion->hasta_am);
                        $tiempo_pm = tiempoTranscurridoFechasPreguntados(date("Y-m-d") . " " . $InsSesion->desde_pm, date("Y-m-d") . " " . $InsSesion->hasta_pm);
                        //print_r($tiempo_am);
                        //echo "<br>";
                        //print_r($tiempo_pm);
                        //echo "<br><br>";
                        $lista_sesiones_reales .= "" . $InsSesion->fecha . " ";
                        $lista_sesiones_reales .= "(" . $InsSesion->numero_horas . "H) ";
                        if ($Empresa == 61) {
                            $lista_sesiones_reales .= "" . $InsSesion->chequeados . " asistentes <br>";
                        } else {
                            $lista_sesiones_reales .= "" . $InsSesion->chequeados . " chequeados <br>";
                        }
                        $lista_sesiones_reales_XLS .= "" . $InsSesion->fecha . " ";
                        $lista_sesiones_reales_XLS .= "(" . $InsSesion->numero_horas . "H) ";
                        $lista_sesiones_reales_XLS .= "" . $InsSesion->chequeados . " asistentes, ";
                    }
                    $rows_ = str_replace("{DETALLE_SESIONES}", ($lista_sesiones_reales), $rows_);
                    $rows_ = str_replace("{DETALLE_SESIONES_XLS}", ($lista_sesiones_reales_XLS), $rows_);
                    $lista_objetos_reales = "";
                    $InsObjetos = InsObjetosImparticion($Empresa, $unico->codigo_inscripcion);
                    //    print_r($InsObjetos);
                    if (count($InsObjetos) == 0) {
                        //$lista_objetos_reales="no tiene";
                        ColocaObjetosPorCursoSiNotiene($Empresa, $id_curso, $unico->codigo_inscripcion);
                        $InsObjetos = InsObjetosImparticion($Empresa, $unico->codigo_inscripcion);
                    }
                    foreach ($InsObjetos as $InsObjeto) {
                        $lista_objetos_reales .= "" . $InsObjeto->titulo . "<br>";
                        //    echo $lista_objetos_reales;
                    }
                    $rows_ = str_replace("{DETALLE_OBJETOS}", ($lista_objetos_reales), $rows_);
                    $Incripcion2 = Total_Inscripciones($Empresa, $unico->codigo_inscripcion);
                    $total_html2 = "";
                    $rows1_ = "";
                    $cuenta = "";
                    $total_costo = "";
                    $franquicia = "";
                    $costoempresa = "";
                    $viatico = "";
                    $movilizacion = "";
                    $REAL = '<span class="label label-success" style="padding-left: 5px;"> Valor Real</span>';
                    if ($Incripcion2[0]->id == "") {
                        $Incripcion2 = Total_Inscripciones_Estimado($Empresa, $unico->codigo_inscripcion);
                        $REAL = '<span class="label label-warning" style="padding-left: 5px;"> Valor Estimado</span>';
                    }
                    $rows_ = str_replace("{REAL}", $REAL, $rows_);
                    if ($cuenta > 1) {
                        $tr = ' <tr>
                            <td class="miniSt"><strong>Total</strong</td>
                            <td class="miniSt"><strong>' . colocarPesos($total_costo) . '</strong></td>
                            <td class="miniSt"><strong>' . colocarPesos($franquicia) . '</strong></td>
                            <td class="miniSt"><strong>' . colocarPesos($costoempresa) . '</strong></td>
                            <td class="miniSt"><strong>' . colocarPesos($viatico) . '</strong></td>
                            <td class="miniSt"><strong>' . colocarPesos($movilizacion) . '</strong></td>
                        </tr>';
                        $total_html2 .= $tr;
                    }
                    $total_costo_empresa = $total_costo_empresa + $costoempresa;
                    $rows_ = str_replace("{TABLA}", $cab . $total_html2 . "</tbody></table>", $rows_);
                    $fecha_actual = date("Y-m-d");
                    //$arreglo_Fecha=explode("-", $fecha_actual);
                    //$fecha_actual=$arreglo_Fecha[2]."-".$arreglo_Fecha[1]."-".$arreglo_Fecha[0];
                    //echo $fecha_actual." ... ";
                    //echo $unico->fecha_inicio."<br>";
                    if ($unico->fecha_inicio > $fecha_actual) {
                        //no iniciado gris
                        $estado = '<i class="fa fa-circle text-default"></i>';
                        $estadonom = "No Iniciado";
                    }
                    //if ($unico->fecha_inicio<$fecha_actual && $fecha_actual<$unico->fecha_termino){
                    if ($unico->fecha_inicio < $fecha_actual && $fecha_actual < $unico->fecha_termino) {
                        //en proceso amarilla
                        $estadonom = "En proceso";
                        $estado = '<i class="fa fa-circle text-warning"></i>';
                    }
                    if ($fecha_actual > $unico->fecha_termino && $cuenta == "") {
                        //terminada roja
                        $estadonom = "Terminada";
                        $estado = '<i class="fa fa-circle text-danger"></i>';
                    }
                    if ($fecha_actual > $unico->fecha_termino && $cuenta != "") {
                        //finalizada verde
                        $estadonom = "Finalizada";
                        $estado = '<i class="fa fa-circle text-success"></i>';
                    }
                    if ($unico->fecha_inicio == "") {
                        //simple celeste
                        $estadonom = "Libre";
                        $estado = '<i class="fa fa-circle text-info"></i>';
                    }
                    $rows_ = str_replace("{ESTADO}", $estado, $rows_);
                    $rows_ = str_replace("{ESTADONOMBRE}", $estadonom, $rows_);
                    $total_html .= $rows_;
                    if ($excel == 1) {
                        echo $rows_;
                    }
                }
                if ($registros_total > 10) {
                    $total_paginas = redondea($registros_total / $registros_pagina);
                    $total_paginas_ = $registros_total / $registros_pagina;
                    //Pagina Anterior
                    $pagina_anterior = $pagina - 1;
                    //Pagina Siguiente
                    $posterior = $pagina + 1;
                    if ($pagina > 1) {
                        //$row.=file_get_contents("views/dnc/row_fichacurso.html");
                        //$row = str_replace("{CURSO}",$unico->curso,$row);
                        //$paginacion.="<a href='?sw=".$env."&p=".($pagina-1)."'><<&nbsp;&nbsp;</a>";
                        $paginacion .= file_get_contents("views/paginacion/1.html");
                        $paginacion = str_replace("{ENV}", "listaInscripciones", $paginacion);
                        $paginacion = str_replace("{PAGINA}", ($pagina - 1), $paginacion);
                        $paginacion = str_replace("{PAGINAINICIAL}", "1", $paginacion);
                        $paginacion = str_replace("{REGISTROS}", round($registros_pagina), $paginacion);
                        $paginacion = str_replace("{DESDEINICIO}", 1, $paginacion);
                        if ($fecha1 != "" && $fecha2 != "") {
                            $paginacion = str_replace("{DESDE}", round($desde) - $registros_pagina . "&fecha1=" . $fecha1 . "&fecha2=" . $fecha2, $paginacion);
                        } else {
                            $paginacion = str_replace("{DESDE}", round($desde) - $registros_pagina, $paginacion);
                        }
                        $paginacion = str_replace("{TOTALREGISTROS}", round($registros_total), $paginacion);
                    }
                    if (($pagina + 10) > $total_paginas) {
                        $resta = $pagina + 10;
                        $valor = ($pagina + 10) - $total_paginas;
                        $pagina1 = $pagina - $valor;
                    } else {
                        $pagina1 = $pagina;
                    }
                    for ($i = $pagina1; $i <= round(($pagina1) + 10); $i++) {
                        if ($pagina == $i) {
                            //$paginacion.="<b><strong><span style='color:#000'>".$i."</span></strong></b>";
                            $paginacion .= file_get_contents("views/paginacion/actual.html");
                            $paginacion = str_replace("{PAGINA}", ($i), $paginacion);
                            $paginacion = str_replace("{ENV}", "listaInscripciones", $paginacion);
                        } else {
                            //$paginacion.="<a href='?sw=".$env."&p=".$i."'>".$i."</a></b>";
                            if ($i > 0) {
                                if ($desde1 == "") {
                                    $desde1 = (($registros_pagina * $i) + 1) - $registros_pagina;
                                }
                                $paginacion .= file_get_contents("views/paginacion/numero.html");
                                $paginacion = str_replace("{PAGINA}", ($i), $paginacion);
                                $paginacion = str_replace("{REGISTROS}", round($registros_pagina), $paginacion);
                                if ($fecha1 != "" && $fecha2 != "") {
                                    $paginacion = str_replace("{DESDE}", $desde1 . "&fecha1=" . $fecha1 . "&fecha2=" . $fecha2, $paginacion);
                                } else {
                                    $paginacion = str_replace("{DESDE}", $desde1, $paginacion);
                                }
                                $paginacion = str_replace("{TOTALREGISTROS}", round($registros_total), $paginacion);
                                $paginacion = str_replace("{ENV}", "listaInscripciones", $paginacion);
                            }
                        }
                        $desde1 = ($registros_pagina * $i) + 1;
                    }
                    if ($pagina < $total_paginas && $total_paginas > 10) {
                        //$paginacion.="<a href='?sw=".$env."&p=".($pagina+1)."'>&nbsp;&nbsp;>></a>";
                        $paginacion .= file_get_contents("views/paginacion/4.html");
                        $paginacion = str_replace("{ENV}", "listaInscripciones", $paginacion);
                        $paginacion = str_replace("{PAGINA}", ($pagina + 1), $paginacion);
                        $paginacion = str_replace("{PAGINAFINAL}", $total_paginas, $paginacion);
                        $paginacion = str_replace("{REGISTROS}", round($registros_pagina), $paginacion);
                        if ($fecha1 != "" && $fecha2 != "") {
                            $paginacion = str_replace("{DESDE}", ($pagina * $registros_pagina) + (1) . "&fecha1=" . $fecha1 . "&fecha2=" . $fecha2, $paginacion);
                        } else {
                            $paginacion = str_replace("{DESDE}", ($pagina * $registros_pagina) + 1, $paginacion);
                        }
                        $paginacion = str_replace("{DESDEFINAL}", (((int)($total_paginas_)) * $registros_pagina) + 1, $paginacion);
                        $paginacion = str_replace("{TOTALREGISTROS}", round($registros_total), $paginacion);
                    }
                } else {
                    $PRINCIPAL = str_replace("{PAGINACION}", "", $PRINCIPAL);
                }
                $PRINCIPAL = str_replace("{REGISTROS" . $registros_pagina . "}", "selected", $PRINCIPAL);
                $PRINCIPAL = str_replace("{PAGINACION}", $paginacion, $PRINCIPAL);
                $PRINCIPAL = str_replace("{RANGO_FECHAS}", "", $PRINCIPAL);
                $PRINCIPAL = str_replace("{BCODIGO}", $codigo, $PRINCIPAL);
                $PRINCIPAL = str_replace("{BFECHA1}", $fecha1, $PRINCIPAL);
                $PRINCIPAL = str_replace("{BFECHA2}", $fecha2, $PRINCIPAL);
                $PRINCIPAL = str_replace("{RESUMEN}", "Hay un total de " . $registros_total . " Inscripciones", $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_EMPRESA}", $Empresa, $PRINCIPAL);
                $PRINCIPAL = str_replace("{ROW_LISTADO}", utf8_encode($total_html), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PRESUPUESO_RESTANTE}", colocarPesos(5000000 - $total_costo_empresa), $PRINCIPAL);
                $PRINCIPAL = str_replace("{TOTAL_COSTO_EMPRESA}", colocarPesos($total_costo_empresa), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function EnvioListaEncuestaSatisfaccion($PRINCIPAL, $id_curso, $id_inscripcion, $id_empresa, $rut_solo, $rut_individual, $url_front, $url_objetos, $url_objetos_corta, $from, $nombrefrom, $logo, $texto4)
            {
//echo "<br>EnvioListaEncuestaSatisfaccion idinscripcion $id_inscripcion, idempresa $id_empresa";
                $arrayEnvioEmails = ListaUsuariosEncuestaEmailInscripcion($id_inscripcion, $id_empresa, $rut_solo, $rut_individual);
                foreach ($arrayEnvioEmails as $arrayEnvioEmail) {
                    $nombre_curso = $arrayEnvioEmail->nombre_curso;
                    $fecha_inicio = $arrayEnvioEmail->fecha_inicio;
                }
                $fecha = fechaCastellano($fecha_inicio);
                $tipo = "text/html";
                $titulo1 = "¡Queremos seguir mejorando!";
                $texto1 = "Recuerda que debes contestar la encuesta de satisfacción del curso:<br><strong> " . utf8_encode($nombre_curso) . "</strong><br>El curso fue realizado el día " . $fecha . "";
                $url = $url_front . "/front/?sw=login_ext&ambiente=homeEncuesta&id_mp=" . $id_inscripcion;
                $texto_url = "Ir a contestar la encuesta";
                $texto2 = "";
                $texto3 = "No te tomará más de 5 minutos.";
                foreach ($arrayEnvioEmails as $arrayEnvioEmail) {
                    echo "<br>Invitacion_enviada" . utf8_encode($arrayEnvioEmail->nombre_completo) . " " . $arrayEnvioEmail->email;
                    $to = $arrayEnvioEmail->email;
                    $rut_sent = $arrayEnvioEmail->rut;
                    $nombreto = $arrayEnvioEmail->nombre_completo;
                    $subject = "Te invitamos a contestar Encuesta de Satisfacción del curso " . utf8_encode($nombre_curso);
                    $subtitulo1 = $nombreto . ": te invitamos a contestar la encuesta de satisfacción";
                    SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, "Encuesta Satisfaccion", $rut_sent, $id_inscripcion);
                }
                $to = $arrayEnvioEmail->email;
                $rut_sent = $arrayEnvioEmail->rut;
                $nombreto = $arrayEnvioEmail->nombre_completo;
                $subject = "Te invitamos a contestar Encuesta de Satisfacción del curso " . utf8_encode($nombre_curso);
                $subtitulo1 = $nombreto . ": te invitamos a contestar la encuesta de satisfacción";
                $to = "rod@gop.cl";
                SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url, "Encuesta Satisfaccion", $rut_sent, $id_inscripcion);
                sleep(3);
                echo "<script>alert('Emails Enviados');    window.close();    </script>";
                //exit;
            }

            function ListaEncuestaSatisfaccion($PRINCIPAL, $id_curso, $id_inscripcion, $Empresa, $excel)
            {
                $Incripciones = TraeImparticionEmpresaEncSat($id_curso, $id_inscripcion, $Empresa);
                $rows_ = "";
                $rows1_ = "";
                //echo "idcurso $id_curso, idinscripcion $id_inscripcion, $Empresa";
                //exit();
                foreach ($Incripciones as $unico) {
                    if ($excel == "1") {
                        $rows_ = file_get_contents("views/capacitacion/encuesta_satisfaccion/" . $Empresa . "_row_listado_excel.html");
                    } else {
                        $rows_ = file_get_contents("views/capacitacion/encuesta_satisfaccion/" . $Empresa . "_row_listado.html");
                    }
                    $rows_ = str_replace("{CODIGOINCRIPCION}", $unico->codigo_inscripcion, $rows_);
                    $rows_ = str_replace("{ID_INSCRIPCION_ENCODEADO}", Encodear3($unico->codigo_inscripcion), $rows_);
                    $arreglo_post["id_empresa"] = $Empresa;
                    $arreglo_post["codigo_imparticion_escrito"] = $unico->codigo_inscripcion;
                    $arreglo_post["imparticion"] = $unico->codigo_inscripcion;
                    $arreglo_post_objeto = $arreglo_objetos;
                    $array_para_enviar_via_url_objetos = serialize($arreglo_post_objeto);
                    $array_para_enviar_via_url_objetos = urlencode($array_para_enviar_via_url_objetos);
                    $array_para_enviar_via_url_post = serialize($arreglo_post);
                    $array_para_enviar_via_url_post = urlencode($array_para_enviar_via_url_post);
                    $rows_ = str_replace("{ARREGLO_POST}", $array_para_enviar_via_url_post, $rows_);
                    $inscritos = "<br><strong>" . $unico->inscritos . "</strong> Inscritos";
                    $inscritos_numero = $unico->inscritos;
                    $chequeados = "<strong>" . $unico->chequeados . "</strong> Asistentes";
                    $chequeados_numero = $unico->chequeados;
                    $numrespuestas = "<strong>" . $unico->numrespuestas . "</strong> Respondidas";
                    $numrespuestas_num = $unico->numrespuestas;
                    $tasa_respuesta = round(100 * $numrespuestas_num / $unico->inscritos);
                    if ($tasa_respuesta >= 100) {
                        $tasa_respuesta = 100;
                        $semaforo = '<span class="btn-success blanco" style="padding:3px;"><i class="fa fa-check-circle" aria-hidden="true"></i></span>';
                    } elseif ($tasa_respuesta > 0 and $tasa_respuesta < 100) {
                        $semaforo = '<span class="btn-warning blanco"  style="padding:3px;"><i class="fa fa-warning" aria-hidden="true"></i></span>';
                    } elseif ($tasa_respuesta == 0) {
                        $semaforo = '<span class="btn-danger blanco" style="padding:3px;"><i class="fa fa-times" aria-hidden="true" ></i></span>';
                    }
                    $tasa_respuesta_txt = "<strong>" . $tasa_respuesta . "%</strong>";
                    $rows_ = str_replace("{EJECUTIVO}", $unico->ejecutivo, $rows_);
                    if ($unico->modalidad == 1) {
                        $modalidad_curso = "ELEARNING";
                    } else {
                        $modalidad_curso = "PRESENCIAL";
                    }
                    $rows_ = str_replace("{MODALIDAD_CURSO}", $modalidad_curso, $rows_);
                    $rows_ = str_replace("{NUM_PARTICIPANTES}", $unico->num_participantes, $rows_);
                    $rows_ = str_replace("{INSCRITOS}", $inscritos, $rows_);
                    $rows_ = str_replace("{INSCRITOS_NUMERO}", $inscritos_numero, $rows_);
                    $rows_ = str_replace("{CHEQUEADOS}", $chequeados, $rows_);
                    $rows_ = str_replace("{CHEQUEADOS_NUMERO}", $chequeados_numero, $rows_);
                    $rows_ = str_replace("{RESPONDIDOS}", $numrespuestas, $rows_);
                    $rows_ = str_replace("{RESPONDIDOS_NUM}", $numrespuestas_num, $rows_);
                    $rows_ = str_replace("{SEMAFORO}", $semaforo, $rows_);
                    $rows_ = str_replace("{TASA_RESPUESTA}", $tasa_respuesta_txt, $rows_);
                    $rows_ = str_replace("{TASA_RESPUESTA_NUM}", $tasa_respuesta, $rows_);
                    if ($unico->modalidad == 1) {
                        $tipo = "Elearning";
                    }
                    if ($unico->modalidad == 2) {
                        $tipo = "Presencial";
                    }
                    $rows_ = str_replace("{TIPO}", $tipo, $rows_);
                    $rows_ = str_replace("{DESCARGA_PARTICIPANTES}", "<a href='?sw=DescargaPresencialImparticion&ci=" . encodear3($unico->codigo_inscripcion) . "' title='Descargar Participantes a Excel'><i class='fas fa-download'></i></a>", $rows_);
                    $rows_ = str_replace("{CLASIFICACION}", $unico->clasificacion, $rows_);
                    $rows_ = str_replace("{CURSO}", $unico->nombre, $rows_);
                    $rows_ = str_replace("{ID_CURSO}", $unico->id_curso, $rows_);
                    if (formatearFechaSmall($unico->fecha_inicio) == "30-11--0001") {
                        $rows_ = str_replace("{FECHA_INICIO}", "", $rows_);
                    } else {
                        $rows_ = str_replace("{FECHA_INICIO}", formatearFechaSmall($unico->fecha_inicio), $rows_);
                    }
                    if (formatearFechaSmall($unico->fecha_termino) == "30-11--0001") {
                        $rows_ = str_replace("{FECHA_TERMINO}", "", $rows_);
                    } else {
                        $rows_ = str_replace("{FECHA_TERMINO}", formatearFechaSmall($unico->fecha_termino), $rows_);
                    }
                    $rows_ = str_replace("{DIRECCION}", ($unico->direccion), $rows_);
                    $rows_ = str_replace("{DIRECCION}", ($unico->direccion), $rows_);
                    $rows_ = str_replace("{CIUDAD}", ($unico->ciudad), $rows_);
                    $rows_ = str_replace("{CUPOS}", ($unico->cupos), $rows_);
                    $rows_ = str_replace("{PROGRAMA}", ($unico->programa), $rows_);
                    $rows_ = str_replace("{ID_PROGRAMA}", ($unico->id_programa), $rows_);
                    //echo $unico->numero_horas;echo "<br>";
                    $segundos = TransformaHoraASegundos($unico->numero_horas);
                    //echo $segundos;echo " segundos del curso <br>";
                    //$rows_ = str_replace("{NUMSESIONES}",($unico->sesiones),$rows_);
                    $rows_ = str_replace("{NUMSESIONES}", ($unico->total_sesiones), $rows_);
                    $lista_sesiones_reales_relatores = "";
                    $lista_sesiones_reales_relatores_XLS = "";
                    $InsSesiones = InsSesionesRelatoresImparticion($Empresa, $unico->codigo_inscripcion);
                    //print_r($InsSesiones);
                    foreach ($InsSesiones as $InsSesion) {
                        if ($InsSesion->rut_relator <> '') {
                            //$lista_sesiones_reales_relatores.="".$InsSesion->nombre_relator. " (".$InsSesion->rut_relator. ")<br> ";
                            $lista_sesiones_reales_relatores .= "" . $InsSesion->nombre_relator . "<br> ";
                        }
                        if ($InsSesion->rut_relator <> '') {
                            $lista_sesiones_reales_relatores .= "" . $InsSesion->rut . "<br> ";
                        }
                    }
                    $rows_ = str_replace("{DETALLE_RELATORES}", ($lista_sesiones_reales_relatores), $rows_);
                    $rows_ = str_replace("{DETALLE_RELATORES_XLS}", ($lista_sesiones_reales_relatores_XLS), $rows_);
                    $rows_ = Lms_reporte_MuestraInformeDimEncNotaDadoInscripcion($unico->codigo_inscripcion, $Empresa, $rows_);
                    $total_html .= $rows_;
                    if ($excel == 1) {
                        echo $rows_;
                    }
                }
                $PRINCIPAL = str_replace("{REGISTROS" . $registros_pagina . "}", "selected", $PRINCIPAL);
                $PRINCIPAL = str_replace("{PAGINACION}", $paginacion, $PRINCIPAL);
                $PRINCIPAL = str_replace("{RANGO_FECHAS}", "", $PRINCIPAL);
                $PRINCIPAL = str_replace("{BCODIGO}", $codigo, $PRINCIPAL);
                $PRINCIPAL = str_replace("{BFECHA1}", $fecha1, $PRINCIPAL);
                $PRINCIPAL = str_replace("{BFECHA2}", $fecha2, $PRINCIPAL);
                $PRINCIPAL = str_replace("{RESUMEN}", "Hay un total de " . $registros_total . " Inscripciones", $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_EMPRESA}", $Empresa, $PRINCIPAL);
                $PRINCIPAL = str_replace("{ROW_LISTADO}", utf8_encode($total_html), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PRESUPUESO_RESTANTE}", colocarPesos(5000000 - $total_costo_empresa), $PRINCIPAL);
                $PRINCIPAL = str_replace("{TOTAL_COSTO_EMPRESA}", colocarPesos($total_costo_empresa), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function MuestraResumenCampos($id_empresa, $id_audiencia)
            {
                $campos = AUDIENCIA_CamposPorAudiencia($id_empresa, $id_audiencia);
                foreach ($campos as $camp) {
                    $listado_campos .= file_get_contents("views/capacitacion/audiencias/row_audiencias_muestra_detalle_campos_lectura.html");
                    $listado_campos = str_replace("{NOMBRE_CAMPO_A_MOSTRAR}", ($camp->nombrecampoamostrar), $listado_campos);
                    $detalle_campos = AUDIENCIA_SelectDistinc_Lectura($id_empresa, $camp->campo, $id_audiencia);
                    $row_detalle_por_campo = "";
                    foreach ($detalle_campos as $det) {
                        $row_detalle_por_campo .= file_get_contents("views/capacitacion/audiencias/row_audiencias_muestra_detalle_campos_groupby_lectura.html");
                        $row_detalle_por_campo = str_replace("{VALOR_POR_CAMPO}", ($det->valor), $row_detalle_por_campo);
                        $row_detalle_por_campo = str_replace("{CAMPO_POR_CAMPO}", ($det->valor), $row_detalle_por_campo);
                        $row_detalle_por_campo = str_replace("{TOTAL_POR_VALOR}", ($det->total_por_valor), $row_detalle_por_campo);
                    }
                    $listado_campos = str_replace("{ROW_CAMPOS_POR_CAMPOS}", utf8_encode($row_detalle_por_campo), $listado_campos);
                }
                return ($listado_campos);
            }

            function ListadoAudiencias($PRINCIPAL, $id_empresa, $id_audiencia)
            {
                $total_audiencias = AUDIENCIA_TotalAudienciasPorempresaParaListado($id_empresa, $id_audiencia);
                foreach ($total_audiencias as $aud) {
                    $row .= file_get_contents("views/capacitacion/audiencias/row_audiencias_lista.html");
                    $row = str_replace("{NOMBRE}", $aud->nombre, $row);
                    $row = str_replace("{DESCRIPCION}", $aud->descripcion, $row);
                    $row = str_replace("{ID_AUDIENCIA_ENCODEADA}", Encodear3($aud->id), $row);
                    $row = str_replace("{DATOS_PARAMETRO}", MuestraResumenCampos($id_empresa, $aud->id), $row);
                    $total = ArmaQueryaudiencias($aud->id, $id_empresa);
                    //$row= str_replace("{CANTIDAD}",$total[1],$row);
                    $row = str_replace("{CANTIDAD}", $total[4], $row);
                }
                $PRINCIPAL = str_replace("{ROW_LISTADO_AUDIENCIA}", utf8_encode($row), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function ArmaQueryaudiencias($id_audiencia, $id_empresa)
            {
                $datos = AUDIENCIA_ValoresDatoAudienciaEmpresa($id_empresa, $id_audiencia);
                $i = 1;
                $campo_valor = "";
                foreach ($datos as $dat) {
                    if ($i == 1) {
                        $or = "";
                    } else {
                        $or = " or ";
                    }
                    $sql .= " " . $or . "" . $dat->campo . "='" . $dat->valor . "'";
                    $i++;
                }
                $campos = AUDIENCIA_ValoresDatoAudienciaEmpresaSoloCampo($id_empresa, $id_audiencia);
                $total_campos = 1;
                foreach ($campos as $camp) {
                    if ($total_campos > 1) {
                        $sql2 .= " and ";
                    }
                    $sql2 .= "(";
                    //por cada campo, traigo los valores de esta audiencia
                    $valores_por_campo = AUDIENCIA_ValoresDatoAudienciaEmpresaSoloCampoSoloValor($id_empresa, $id_audiencia, $camp->campo);
                    $i = 1;
                    foreach ($valores_por_campo as $dat) {
                        if ($i == 1) {
                            $or = "";
                        } else {
                            $or = " or ";
                        }
                        $sql2 .= " " . $or . "" . $dat->campo . "='" . $dat->valor . "'";
                        $i++;
                    }
                    $sql2 .= ")";
                    $total_campos++;
                }
                //echo $sql2;exit;
                //$datos_finales=AUDIENCIA_QueryDinamica($id_empresa, $id_audiencia, $sql);
                $datos_finales = AUDIENCIA_QueryDinamica($id_empresa, $id_audiencia, $sql2);
                $total_usuarios = AUDIENCIA_QueryDinamicaTraeUsuarios($id_empresa, $id_audiencia, $sql2);
                $total_usuarios_por_excel = Audiencias_RutPorAudienciaEmpresa($id_audiencia, $id_empresa);
                $arreglo[0] = $datos_finales[0]->total_usuario;
                $arreglo[1] = $datos_finales[0]->total_audiencia;
                $porcentaje = ($datos_finales[0]->total_audiencia * 100) / $datos_finales[0]->total_usuario;
                $arreglo[2] = $porcentaje;
                //Total usuarios con query
                $arreglo[3] = $total_usuarios;
                //Total usuarios con query + Excel
                $arreglo[4] = $arreglo[1] + count($total_usuarios_por_excel);
                return ($arreglo);
            }

            function MuestraFormfinalAudiencia($PRINCIPAL, $id_empresa, $id_audiencia)
            {
                $total_audiencia = ArmaQueryaudiencias($id_audiencia, $id_empresa);
                $campos = AUDIENCIA_CamposPorAudiencia($id_empresa, $id_audiencia);
                foreach ($campos as $camp) {
                    $listado_campos .= file_get_contents("views/capacitacion/audiencias/row_audiencias_muestra_detalle_campos_lectura.html");
                    $listado_campos = str_replace("{NOMBRE_CAMPO_A_MOSTRAR}", utf8_encode(($camp->nombrecampoamostrar)), $listado_campos);
                    $detalle_campos = AUDIENCIA_SelectDistinc_Lectura($id_empresa, $camp->campo, $id_audiencia);
                    $row_detalle_por_campo = "";
                    foreach ($detalle_campos as $det) {
                        $row_detalle_por_campo .= file_get_contents("views/capacitacion/audiencias/row_audiencias_muestra_detalle_campos_groupby_lectura.html");
                        $row_detalle_por_campo = str_replace("{VALOR_POR_CAMPO}", ($det->valor), $row_detalle_por_campo);
                        $row_detalle_por_campo = str_replace("{CAMPO_POR_CAMPO}", ($det->valor), $row_detalle_por_campo);
                        $row_detalle_por_campo = str_replace("{TOTAL_POR_VALOR}", ($det->total_por_valor), $row_detalle_por_campo);
                    }
                    $listado_campos = str_replace("{ROW_CAMPOS_POR_CAMPOS}", utf8_encode($row_detalle_por_campo), $listado_campos);
                }
                $PRINCIPAL = str_replace("{CAMPOS_SELECCIONADOS}", $listado_campos, $PRINCIPAL);
                //$PRINCIPAL= str_replace("{TOTAL_USUARIOS_AUDIENCIA}",$total_audiencia[1],$PRINCIPAL);
                $PRINCIPAL = str_replace("{TOTAL_USUARIOS_AUDIENCIA}", $total_audiencia[4], $PRINCIPAL);
                $PRINCIPAL = str_replace("{TOTAL_USUARIOS}", $total_audiencia[0], $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_AUDIENCIA}", round($total_audiencia[2], 2), $PRINCIPAL);
                //total_valores
                $campos = AUDIENCIA_ValoresDatoAudienciaEmpresa($id_empresa, $id_audiencia);
                $total_usuarios_excel_por_audiencia = Audiencias_RutPorAudienciaEmpresa($id_audiencia, $id_empresa);
                $PRINCIPAL = str_replace("{TOTAL_RUT_POR_EXCEL}", count($total_usuarios_excel_por_audiencia), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function ListarCamposPorAudienciaOEmpresa($PRINCIPAL, $id_empresa, $id_audiencia)
            {
                //total de campos por audiencia o por empresa
                $campos = AUDIENCIA_CamposPorAudiencia($id_empresa, $id_audiencia);
                foreach ($campos as $camp) {
                    $listado_campos .= file_get_contents("views/capacitacion/audiencias/row_audiencias_muestra_detalle_campos.html");
                    $listado_campos = str_replace("{NOMBRE_CAMPO_A_MOSTRAR}", ($camp->nombrecampoamostrar), $listado_campos);
                    $listado_campos = str_replace("{CAMPO}", ($camp->campo), $listado_campos);
                    //$detalle_campos=AUDIENCIA_SelectDistinc($id_empresa, $camp->campo);
                    $detalle_campos = AUDIENCIA_SelectDistincSinTotalPorValor($id_empresa, $camp->campo);
                    $row_detalle_por_campo = "";
                    foreach ($detalle_campos as $det) {
                        $row_detalle_por_campo .= file_get_contents("views/capacitacion/audiencias/row_audiencias_muestra_detalle_campos_groupby.html");
                        $row_detalle_por_campo = str_replace("{VALOR_POR_CAMPO}", ($det->valor), $row_detalle_por_campo);
                        $row_detalle_por_campo = str_replace("{CAMPO_POR_CAMPO}", ($det->valor), $row_detalle_por_campo);
                        $row_detalle_por_campo = str_replace("{TOTAL_POR_VALOR}", ($det->total_por_valor), $row_detalle_por_campo);
                    }
                    $listado_campos = str_replace("{ROW_CAMPOS_POR_CAMPOS}", utf8_encode($row_detalle_por_campo), $listado_campos);
                }
                $PRINCIPAL = str_replace("{ROW_CAMPOS}", ($listado_campos), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function CreacionAudiencias($PRINCIPAL, $id_empresa)
            {
                //Traigo los campos para subir
                $campos = AUDIENCIAS_TraeCampos($id_empresa);
                $listado_campos = "";
                foreach ($campos as $camp) {
                    $listado_campos .= file_get_contents("views/capacitacion/audiencias/row_audiencias_creacion_campos.html");
                    $listado_campos = str_replace("{NOMBRE_A_MOSTRAR}", ($camp->nombrecampoamostrar), $listado_campos);
                    $listado_campos = str_replace("{NAME}", ($camp->campo), $listado_campos);
                }
                $PRINCIPAL = str_replace("{ROW_CAMPOS_CREACION}", utf8_encode($listado_campos), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function OptionsGenericoAdmin($tabla, $seleccionado, $campo_mostrar, $campo_valor, $order, $id_empresa, $where)
            {
                if ($id_empresa) {
                    //$valores=ValorSelectDinaico2PorEmpresa($tabla, $campo_mostrar, $campo_valor, $order, $id_empresa);
                    $valores = ValorSelectDinaicoAdmin($tabla, $campo_mostrar, $campo_valor, $order, $id_empresa, $where);
                } else {
                    //$valores=ValorSelectDinaico2($tabla, $campo_mostrar, $campo_valor, $order);
                    $valores = ValorSelectDinaico2Admin($tabla, $campo_mostrar, $campo_valor, $order);
                }
                foreach ($valores as $val) {
                    if ($val->id == $seleccionado) {
                        $opciones .= "<option selected value='" . $val->id . "'>" . $val->nombre . "</option>";
                    } else {
                        $opciones .= "<option value='" . $val->id . "'>" . $val->nombre . "</option>";
                    }
                }
                return (utf8_encode($opciones));
            }

            function FuncionListadoMantenedores($PRINCIPAL, $id_empresa, $arreglo_post)
            {
                //Traigo el total de tipos, para colocarlo en el ComboBox
                $tipos = MANTENEDOR_TrarTotalTipos($id_empresa);
                foreach ($tipos as $tip) {
                    if ($arreglo_post["tipo"] == $tip->tipo) {
                        $options_tipos .= "<option value='" . $tip->tipo . "' selected>" . $tip->descripcion . "</option>";
                    } else {
                        $options_tipos .= "<option value='" . $tip->tipo . "'>" . $tip->descripcion . "</option>";
                    }
                }
                $PRINCIPAL = str_replace("{TIPO}", ($options_tipos), $PRINCIPAL);
                //Traigo el total de campos por este tipo y esta empresa
                if ($arreglo_post["tipo"]) {
                    $datos_tipo = MANTENEDOR_TraeTipoEmpresa($arreglo_post["tipo"], $id_empresa);
                    $nombre_tabla = $datos_tipo[0]->tabla;
                    $PRINCIPAL = str_replace("{BLOQUE_PRINCIPAL}", file_get_contents("views/capacitacion/mantenedor/entorno_listado.html"), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VALUE_TIPO}", $arreglo_post["tipo"], $PRINCIPAL);
                    //$campos=MANTENEDOR_TraeCamporPorTipoEmpresa($id_empresa, $arreglo_post["tipo"]);
                    $campos = MANTENEDOR_TraeCamporPorTipoEmpresaParaListado($id_empresa, $arreglo_post["tipo"]);
                    $encabezado = "<tr>";
                    foreach ($campos as $camp) {
                        $encabezado .= file_get_contents("views/capacitacion/mantenedor/encabezado_listado.html");
                        $encabezado = str_replace("{CAMPO}", ($camp->nombre_mostrar), $encabezado);
                    }
                    $encabezado .= "</tr>";
                    $PRINCIPAL = str_replace("{ENCABEZADOS}", utf8_encode($encabezado), $PRINCIPAL);
                    //Traigo los datos para llenar el listado
                    $datos_listado = MANTENEDOR_TraigoDatosTabla($id_empresa, $nombre_tabla);
                    $row_datos_listado = "";
                    foreach ($datos_listado as $dat) {
                        $row_datos_listado .= "<tr>";
                        foreach ($campos as $camp) {
                            $row_datos_listado .= file_get_contents("views/capacitacion/mantenedor/row_listado.html");
                            $row_datos_listado = str_replace("{VALOR}", $dat->{$camp->campo}, $row_datos_listado);
                            //echo $dat->{$camp->campo};
                        }
                        $row_datos_listado .= "</tr>";
                    }
                    $PRINCIPAL = str_replace("{BLOQUE_LISTADO}", utf8_encode($row_datos_listado), $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{BLOQUE_PRINCIPAL}", "Seleccione Tipo", $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function FuncionMantenedores($PRINCIPAL, $id_empresa, $arreglo_post)
            {
                //Traigo el total de tipos, para colocarlo en el ComboBox
                $tipos = MANTENEDOR_TrarTotalTipos($id_empresa);
                foreach ($tipos as $tip) {
                    if ($arreglo_post["tipo"] == $tip->tipo) {
                        $options_tipos .= "<option value='" . $tip->tipo . "' selected>" . $tip->descripcion . "</option>";
                    } else {
                        $options_tipos .= "<option value='" . $tip->tipo . "'>" . $tip->descripcion . "</option>";
                    }
                }
                $PRINCIPAL = str_replace("{TIPO}", ($options_tipos), $PRINCIPAL);
                //Traigo el total de campos por este tipo y esta empresa
                if ($arreglo_post["tipo"]) {
                    $PRINCIPAL = str_replace("{BLOQUE_PRINCIPAL}", file_get_contents("views/capacitacion/mantenedor/entorno_formulario.html"), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VALUE_TIPO}", $arreglo_post["tipo"], $PRINCIPAL);
                    $campos = MANTENEDOR_TraeCamporPorTipoEmpresa($id_empresa, $arreglo_post["tipo"]);
                    foreach ($campos as $camp) {
                        $formulario .= file_get_contents("views/capacitacion/mantenedor/" . $camp->template);
                        if ($camp->obligatorio == 0) {
                            $formulario = str_replace("{REQUIRED}", "required='required'", $formulario);
                        } else {
                            $formulario = str_replace("{REQUIRED}", "", $formulario);
                        }
                        if ($camp->tabla_select) {
                            //$formulario = str_replace("{OPTIONS}",utf8_decode(OptionsGenericoNombreDadoValoresPorEmpresa($camp->tabla_select, "",  $camp->valor_select, $camp->id_select, "order by ".$camp->valor_select, $id_empresa)),$formulario);
                            $formulario = str_replace("{OPTIONS}", utf8_decode(OptionsGenericoAdmin($camp->tabla_select, "", $camp->valor_select, $camp->id_select, "order by " . $camp->valor_select, $id_empresa, $camp->where)), $formulario);
                        }
                        $formulario = str_replace("{NOMBRE_A_MOSTRAR}", $camp->nombre_mostrar, $formulario);
                        $formulario = str_replace("{NAME}", $camp->campo, $formulario);
                    }
                    if ($arreglo_post["tipo_objeto"] && $arreglo_post["tipo"] == "objeto") {
                        if ($arreglo_post["tipo_objeto"] == 7) {
                            $formulario .= file_get_contents("views/capacitacion/mantenedor/input_file.html");
                            $formulario = str_replace("{NOMBRE_A_MOSTRAR}", "Video MP4", $formulario);
                            $formulario = str_replace("{NAME}", "video", $formulario);
                            $formulario .= file_get_contents("views/capacitacion/mantenedor/input_text.html");
                            $formulario = str_replace("{NOMBRE_A_MOSTRAR}", "Duracion del Video (HH:MM:SS) EJ: 00:05:00", $formulario);
                            $formulario = str_replace("{NAME}", "duracion_video", $formulario);
                        } else if ($arreglo_post["tipo_objeto"] == "trivia") {
                            $formulario .= file_get_contents("views/capacitacion/mantenedor/input_select.html");
                            $formulario = str_replace("{OPTIONS}", utf8_decode(OptionsGenericoAdmin("tbl_evaluaciones", "", "nombre_evaluacion", "id", "order by nombre_evaluacion", $id_empresa, "")), $formulario);
                            $formulario = str_replace("{NOMBRE_A_MOSTRAR}", "Seleccione Trivia", $formulario);
                            $formulario = str_replace("{NAME}", "id_evaluacion", $formulario);
                        } else if ($arreglo_post["tipo_objeto"] == "descargaArchivo") {
                            $formulario .= file_get_contents("views/capacitacion/mantenedor/input_file.html");
                            $formulario = str_replace("{NOMBRE_A_MOSTRAR}", "Sube un archivo", $formulario);
                            $formulario = str_replace("{NAME}", "archivo_descarga", $formulario);
                        }
                    }
                    $PRINCIPAL = str_replace("{CAMPOS_DINAMICOS}", utf8_encode($formulario), $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{BLOQUE_PRINCIPAL}", "Seleccione Tipo", $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function calcular_tiempo_trasnc2($hora2, $hora1)
            {
                $separar[1] = explode(':', $hora1);
                $separar[2] = explode(':', $hora2);
                $total_minutos_trasncurridos[1] = ($separar[1][0] * 60) + $separar[1][1];
                $total_minutos_trasncurridos[2] = ($separar[2][0] * 60) + $separar[2][1];
                $total_minutos_trasncurridos = $total_minutos_trasncurridos[1] - $total_minutos_trasncurridos[2];
                //if($total_minutos_trasncurridos<=59)
                return ($total_minutos_trasncurridos . ' Minutos');
                /*elseif($total_minutos_trasncurridos>59){
        $HORA_TRANSCURRIDA = round($total_minutos_trasncurridos/60);
    if($HORA_TRANSCURRIDA<=9) $HORA_TRANSCURRIDA='0'.$HORA_TRANSCURRIDA;
        $MINUITOS_TRANSCURRIDOS = $total_minutos_trasncurridos%60;
    if($MINUITOS_TRANSCURRIDOS<=9) $MINUITOS_TRANSCURRIDOS='0'.$MINUITOS_TRANSCURRIDOS;
        return ($HORA_TRANSCURRIDA.':'.$MINUITOS_TRANSCURRIDOS.' Horas');
    } */
                return ($total_minutos_trasncurridos);
            }

            //llamamos la función e imprimimos
            //    echo calcular_tiempo_trasnc(date('H:i'),'16:12');
            function ReporteResultadosGeneralesConsolidadoSGD($PRINCIPAL, $id_empresa, $arreglo_post, $criterio, $nombre_campo)
            {
                $usuarios = TraigoDatosTablareportesConsolidad($id_empresa, $arreglo_post);
                $acumula_finalizados = 0;
                $acumula_no_iniciados = 0;
                $acumula_en_proceso = 0;
                $acumula_en_proceso_menor_a_50 = 0;
                $acumula_en_proceso_mayor_igual_a_50 = 0;
                $acumula_avance = 0;
                foreach ($usuarios as $usu) {
                    if ($usu->avance >= 100) {
                        $acumula_finalizados++;
                    } else if ($usu->avance == 0) {
                        $acumula_no_iniciados++;
                    } else {
                        $acumula_en_proceso++;
                        if ($usu->avance < 50) {
                            $acumula_en_proceso_menor_a_50++;
                        } else {
                            $acumula_en_proceso_mayor_igual_a_50++;
                        }
                    }
                    $acumula_avance = $acumula_avance + $usu->avance;
                    $aa++;
                }
                //echo $row;
                $i = count($usuarios);
                $PRINCIPAL = str_replace("{CRITERIO}", ($criterio), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS}", $i, $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_TOTAL}", number_format($acumulador_porcentajes_avance_malla / $i, 0, ",", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_ACCESOS}", $acumulador_visitas, $PRINCIPAL);
                //Bloque Total de Porcentaje Total
                $PRINCIPAL = str_replace("{GRAFICO_PORCENTAJE_TOTAL}", file_get_contents("views/graficos/grafico_circulo.html"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE}", number_format($acumula_avance / $aa, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_FINALIZADOS}", number_format($acumula_finalizados, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_FINALIZADOS}", number_format(100 * $acumula_finalizados / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_PROCESO}", number_format($acumula_en_proceso, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_PROCESO}", number_format(100 * $acumula_en_proceso / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_PROCESO_MENOR_50}", number_format($acumula_en_proceso_menor_a_50, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_PROCESO_MENOR_50}", number_format(100 * $acumula_en_proceso_menor_a_50 / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_PROCESO_MAYOR_IGUAL_50}", number_format($acumula_en_proceso_mayor_igual_a_50, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_PROCESO_MAYOR_IGUAL_50}", number_format(100 * $acumula_en_proceso_mayor_igual_a_50 / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_NOINICIADO}", number_format($acumula_no_iniciados, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_NOINICIADO}", number_format(100 * $acumula_no_iniciados / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_INGRESADOS}", number_format($acumula_finalizados + $acumula_en_proceso, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_INGRESADOS}", number_format(100 * ($acumula_finalizados + $acumula_en_proceso) / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{TEXTO}", "Avance", $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOMBRE_GRAFICO}", "Avance", $PRINCIPAL);
                //Bloque Total de ACESOS
                //$PRINCIPAL = str_replace("{GRAFICO_CANTIDAD_ACCESOS}",file_get_contents("views/graficos/grafico_circulo.html"),$PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE}", number_format($acumulador_visitas * 100 / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{TEXTO}", "Accesos", $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOMBRE_GRAFICO}", "Accesos", $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function ReporteCapacitacionPorcriterioSGD($PRINCIPAL, $id_empresa, $arreglo_post, $criterio, $nombre_campo, $ejecuta_script_guarda_ranking)
            {
                $valores_por_criterio = TraigoValoresDadoCampoPorEmpreasSGDReporte($criterio, $id_empresa);
//print_r($valores_por_criterio);
                foreach ($valores_por_criterio as $valor) {
                    $datos_Avance = AvancePorCriterioSGD($id_empresa, $criterio, $valor->valor, $arreglo_post);
                    //echo "<br>";
                    //print_r($datos_Avance);
                    if ($datos_Avance[0]->Total < 1) {
                        continue;
                    }
                    $avance = round(100 * $datos_Avance[0]->Finalizados / $datos_Avance[0]->Total);
                    $rows .= file_get_contents("views/sgd/row_avance_sgd_por_criterio.html");
                    $rows = str_replace("{NOMBRE}", utf8_encode($valor->valor), $rows);
                    $rows = str_replace("{NUM_USUARIOS}", ($datos_Avance[0]->Total), $rows);
                    $rows = str_replace("{NUM_FINALIZADOS}", ($datos_Avance[0]->Finalizados), $rows);
                    $rows = str_replace("{NUMERO_AVANCE}", ColocarColoresConPorcentajeProgressBar(round($avance), 1), $rows);
                }
                $PRINCIPAL = str_replace("{LISTADO_USUARIOS}", ($rows), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CRITERIO}", ($criterio), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function ReporteResultadosGeneralesConsolidado($PRINCIPAL, $id_empresa, $arreglo_post, $criterio, $nombre_campo, $tipo)
            {
                $usuarios = TraigoDatosTablareportesConsolidad($id_empresa, $arreglo_post);
                $cantidad_usuarios_aprobados = 0;
                $cantidad_usuarios_reprobados = 0;
                $acumula_finalizados = 0;
                $acumula_no_iniciados = 0;
                $acumula_en_proceso = 0;
                $acumula_en_proceso_menor_a_50 = 0;
                $acumula_en_proceso_mayor_igual_a_50 = 0;
                $acumula_avance = 0;
                foreach ($usuarios as $usu) {
                    if ($arreglo_post["objetos"]) {
                        if ($usu->fecha_objeto_finalizado) {
                            //$usu->avance=100;
                            $avance = 100;
                        } else {
                            //$usu->avance=0;
                            $avance = 0;
                        }
                    } else {
                        $avance = $usu->avance;
                    }
                    //if($usu->avance>=100){
                    if ($avance >= 100) {
                        $acumula_finalizados++;
                        //Acumula Aprobados y Reprobados
                        if ($id_empresa == 52) {
                            if ($usu->resultado >= 80) {
                                $cantidad_usuarios_aprobados++;
                            } else {
                                $cantidad_usuarios_reprobados++;
                            }
                        } else {
                            if ($usu->estado == "APROBADO") {
                                $cantidad_usuarios_aprobados = "-";
                            } else if ($usu->estado == "REPROBADO") {
                                $cantidad_usuarios_reprobados = "-";
                            }
                        }
                        //}else if($usu->avance==0){
                    } else if ($avance == 0) {
                        $acumula_no_iniciados++;
                    } else {
                        $acumula_en_proceso++;
                        //if($usu->avance<50){
                        if ($avance < 50) {
                            $acumula_en_proceso_menor_a_50++;
                        } else {
                            $acumula_en_proceso_mayor_igual_a_50++;
                        }
                    }
                    $avancenum = intval($avance);
                    if ($avancenum === 0) {
                        $acumulador_avance_0++;
                    }
                    if ($avance >= 0 && $avance < 10) {
                        $acumulador_avance_entre_0_10++;
                    }
                    if ($avance >= 10 && $avance < 20) {
                        $acumulador_avance_entre_10_20++;
                    }
                    if ($avance >= 20 && $avance < 30) {
                        $acumulador_avance_entre_20_30++;
                    }
                    if ($avance >= 30 && $avance < 40) {
                        $acumulador_avance_entre_30_40++;
                    }
                    if ($avance >= 40 && $avance < 50) {
                        $acumulador_avance_entre_40_50++;
                    }
                    if ($avance >= 50 && $avance < 60) {
                        $acumulador_avance_entre_50_60++;
                    }
                    if ($avance >= 60 && $avance < 70) {
                        $acumulador_avance_entre_60_70++;
                    }
                    if ($avance >= 70 && $avance < 80) {
                        $acumulador_avance_entre_70_80++;
                    }
                    if ($avance >= 80 && $avance < 90) {
                        $acumulador_avance_entre_80_90++;
                    }
                    if ($avance >= 90 && $avance < 100) {
                        $acumulador_avance_entre_90_100++;
                    }
                    if ($avancenum == 100) {
                        $acumulador_avance_100++;
                    }
                    //$acumula_avance=$acumula_avance +$usu->avance;
                    $acumula_avance = $acumula_avance + $avance;
                    $aa++;
                }
// CALCULOS
                $RANGO100 = $acumulador_avance_100;
                $ACUMULA100 = $acumulador_avance_100;
                $PORCENTAJE100 = ROUND(100 * $acumulador_avance_100 / $aa, 1);
                $PORCENTAJEA100 = ROUND(100 * $ACUMULA100 / $aa, 1);
                $RANGO90 = $acumulador_avance_entre_90_100;
                $ACUMULA90 = $acumulador_avance_entre_90_100 + $ACUMULA100;
                $PORCENTAJE90 = ROUND(100 * $acumulador_avance_entre_90_100 / $aa, 1);
                $PORCENTAJEA90 = ROUND(100 * $ACUMULA90 / $aa, 1);
                $RANGO80 = $acumulador_avance_entre_80_90;
                $ACUMULA80 = $acumulador_avance_entre_80_90 + $ACUMULA90;
                $PORCENTAJE80 = ROUND(100 * $acumulador_avance_entre_80_90 / $aa, 1);
                $PORCENTAJEA80 = ROUND(100 * $ACUMULA80 / $aa, 1);
                $RANGO70 = $acumulador_avance_entre_70_80;
                $ACUMULA70 = $acumulador_avance_entre_70_80 + $ACUMULA80;
                $PORCENTAJE70 = ROUND(100 * $acumulador_avance_entre_70_80 / $aa, 1);
                $PORCENTAJEA70 = ROUND(100 * $ACUMULA70 / $aa, 1);
                $RANGO60 = $acumulador_avance_entre_60_70;
                $ACUMULA60 = $acumulador_avance_entre_60_70 + $ACUMULA70;
                $PORCENTAJE60 = ROUND(100 * $acumulador_avance_entre_60_70 / $aa, 1);
                $PORCENTAJEA60 = ROUND(100 * $ACUMULA60 / $aa, 1);
                $RANGO50 = $acumulador_avance_entre_50_60;
                $ACUMULA50 = $acumulador_avance_entre_50_60 + $ACUMULA60;
                $PORCENTAJE50 = ROUND(100 * $acumulador_avance_entre_50_60 / $aa, 1);
                $PORCENTAJEA50 = ROUND(100 * $ACUMULA50 / $aa, 1);
                $RANGO40 = $acumulador_avance_entre_40_50;
                $ACUMULA40 = $acumulador_avance_entre_40_50 + $ACUMULA50;
                $PORCENTAJE40 = ROUND(100 * $acumulador_avance_entre_40_50 / $aa, 1);
                $PORCENTAJEA40 = ROUND(100 * $ACUMULA40 / $aa, 1);
                $RANGO30 = $acumulador_avance_entre_30_40;
                $ACUMULA30 = $acumulador_avance_entre_30_40 + $ACUMULA40;
                $PORCENTAJE30 = ROUND(100 * $acumulador_avance_entre_30_40 / $aa, 1);
                $PORCENTAJEA30 = ROUND(100 * $ACUMULA30 / $aa, 1);
                $RANGO20 = $acumulador_avance_entre_20_30;
                $ACUMULA20 = $acumulador_avance_entre_20_30 + $ACUMULA30;
                $PORCENTAJE20 = ROUND(100 * $acumulador_avance_entre_20_30 / $aa, 1);
                $PORCENTAJEA20 = ROUND(100 * $ACUMULA20 / $aa, 1);
                $RANGO10 = $acumulador_avance_entre_10_20;
                $ACUMULA10 = $acumulador_avance_entre_10_20 + $ACUMULA20;
                $PORCENTAJE10 = ROUND(100 * $acumulador_avance_entre_10_20 / $aa, 1);
                $PORCENTAJEA10 = ROUND(100 * $ACUMULA10 / $aa, 1);
                $RANGO_0 = $acumulador_avance_entre_0_10;
                $ACUMULA_0 = $acumulador_avance_entre_0_10 + $ACUMULA10;
                $PORCENTAJE_0 = ROUND(100 * $acumulador_avance_entre_0_10 / $aa, 1);
                $PORCENTAJEA_0 = ROUND(100 * $ACUMULA_0 / $aa, 1);
                $RANGO0 = $acumulador_avance_0;
                $ACUMULA0 = $acumulador_avance_0;
                $PORCENTAJE0 = ROUND(100 * $acumulador_avance_0 / $aa, 1);
                $PORCENTAJEA0 = ROUND(100 * $ACUMULA0 / $aa, 1);
                $i = count($usuarios);
                $PRINCIPAL = str_replace("{RANGO100}", ($RANGO100), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ACUMULA100}", ($ACUMULA100), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE100}", ($PORCENTAJE100), $PRINCIPAL);
                $PRINCIPAL = str_replace("{RANGO90}", ($RANGO90), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ACUMULA90}", ($ACUMULA90), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE90}", ($PORCENTAJE90), $PRINCIPAL);
                $PRINCIPAL = str_replace("{RANGO80}", ($RANGO80), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ACUMULA80}", ($ACUMULA80), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE80}", ($PORCENTAJE80), $PRINCIPAL);
                $PRINCIPAL = str_replace("{RANGO70}", ($RANGO70), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ACUMULA70}", ($ACUMULA70), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE70}", ($PORCENTAJE70), $PRINCIPAL);
                $PRINCIPAL = str_replace("{RANGO60}", ($RANGO60), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ACUMULA60}", ($ACUMULA60), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE60}", ($PORCENTAJE60), $PRINCIPAL);
                $PRINCIPAL = str_replace("{RANGO50}", ($RANGO50), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ACUMULA50}", ($ACUMULA50), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE50}", ($PORCENTAJE50), $PRINCIPAL);
                $PRINCIPAL = str_replace("{RANGO40}", ($RANGO40), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ACUMULA40}", ($ACUMULA40), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE40}", ($PORCENTAJE40), $PRINCIPAL);
                $PRINCIPAL = str_replace("{RANGO30}", ($RANGO30), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ACUMULA30}", ($ACUMULA30), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE30}", ($PORCENTAJE30), $PRINCIPAL);
                $PRINCIPAL = str_replace("{RANGO20}", ($RANGO20), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ACUMULA20}", ($ACUMULA20), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE20}", ($PORCENTAJE20), $PRINCIPAL);
                $PRINCIPAL = str_replace("{RANGO10}", ($RANGO10), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ACUMULA10}", ($ACUMULA10), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE10}", ($PORCENTAJE10), $PRINCIPAL);
                $PRINCIPAL = str_replace("{RANGO_0}", ($RANGO_0), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ACUMULA_0}", ($ACUMULA_0), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_0}", ($PORCENTAJE_0), $PRINCIPAL);
                $PRINCIPAL = str_replace("{RANGO0}", ($RANGO0), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ACUMULA0}", ($ACUMULA0), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE0}", ($PORCENTAJE0), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJEA100}", ($PORCENTAJEA100), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJEA90}", ($PORCENTAJEA90), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJEA80}", ($PORCENTAJEA80), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJEA70}", ($PORCENTAJEA70), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJEA60}", ($PORCENTAJEA60), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJEA50}", ($PORCENTAJEA50), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJEA40}", ($PORCENTAJEA40), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJEA30}", ($PORCENTAJEA30), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJEA20}", ($PORCENTAJEA20), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJEA10}", ($PORCENTAJEA10), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJEA_0}", ($PORCENTAJEA_0), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJEA0}", ($PORCENTAJEA0), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CRITERIO}", ($criterio), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS}", $i, $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_TOTAL}", number_format($acumulador_porcentajes_avance_malla / $i, 0, ",", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_ACCESOS}", $acumulador_visitas, $PRINCIPAL);
                //Bloque Total de Porcentaje Total
                $PRINCIPAL = str_replace("{GRAFICO_PORCENTAJE_TOTAL}", file_get_contents("views/graficos/grafico_circulo.html"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE}", number_format($acumula_avance / $aa, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_FINALIZADOS}", number_format($acumula_finalizados, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_FINALIZADOS}", number_format(100 * $acumula_finalizados / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_FINALIZADOS_SR}", (100 * $acumula_finalizados / $i), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_PROCESO}", number_format($acumula_en_proceso, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_PROCESO}", number_format(100 * $acumula_en_proceso / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_PROCESO_SR}", (100 * $acumula_en_proceso / $i), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_PROCESO_MENOR_50}", number_format($acumula_en_proceso_menor_a_50, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_PROCESO_MENOR_50}", number_format(100 * $acumula_en_proceso_menor_a_50 / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_PROCESO_MAYOR_IGUAL_50}", number_format($acumula_en_proceso_mayor_igual_a_50, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_PROCESO_MAYOR_IGUAL_50}", number_format(100 * $acumula_en_proceso_mayor_igual_a_50 / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_NOINICIADO}", number_format($acumula_no_iniciados, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_NOINICIADO}", number_format(100 * $acumula_no_iniciados / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_NOINICIADO_SR}", (100 * $acumula_no_iniciados / $i), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_APROBADOS}", number_format($cantidad_usuarios_aprobados, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_APROBADOS}", number_format(100 * $cantidad_usuarios_aprobados / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_APROBADOS}", (100 * $cantidad_usuarios_aprobados / $i), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_REPROBADOS}", number_format($cantidad_usuarios_reprobados, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_REPROBADOS}", number_format(100 * $cantidad_usuarios_reprobados / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_REPROBADOS}", (100 * $cantidad_usuarios_reprobados / $i), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_INGRESADOS}", number_format($acumula_finalizados + $acumula_en_proceso, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_INGRESADOS}", number_format(100 * ($acumula_finalizados + $acumula_en_proceso) / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{TEXTO}", "Avance", $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOMBRE_GRAFICO}", "Avance", $PRINCIPAL);
                //Bloque Total de ACESOS
                //$PRINCIPAL = str_replace("{GRAFICO_CANTIDAD_ACCESOS}",file_get_contents("views/graficos/grafico_circulo.html"),$PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE}", number_format($acumulador_visitas * 100 / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{TEXTO}", "Accesos", $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOMBRE_GRAFICO}", "Accesos", $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function ReporteCapacitacionPorcriterio($PRINCIPAL, $id_empresa, $arreglo_post, $criterio, $nombre_campo, $ejecuta_script_guarda_ranking)
            {
                $valores_por_criterio = TraigoValoresDadoCampoPorEmpreasLMSReporte($nombre_campo, $id_empresa);
//trunco de la tabla tbl_lms_ranking where campo=$nombre_campo
                if ($arreglo_post["malla"]) {
                } else {
                    TruncaLmsRanking($nombre_campo, $id_empresa, $arreglo_post);
                }
                foreach ($valores_por_criterio as $valor) {
                    $datos_Avance = AvancePorCriterio($id_empresa, $nombre_campo, $valor->valor, $arreglo_post);
                    if ($datos_Avance[0]->total_usuarios < 1) {
                        continue;
                    }
                    $rows .= file_get_contents("views/reportes/capacitacion/row_avance_capacitacion_por_criterio.html");
                    $rows = str_replace("{NOMBRE}", utf8_encode($valor->valor), $rows);
                    $rows = str_replace("{NUMERO_AVANCE}", ColocarColoresConPorcentajeProgressBar(round($datos_Avance[0]->avance), 1), $rows);
                    $rows = str_replace("{PUNTOS}", ($datos_Avance[0]->suma_puntos), $rows);
                    $rows = str_replace("{RESULTADO}", ColocarColoresConPorcentajeProgressBar(round($datos_Avance[0]->resultado)), $rows);
                    $rows = str_replace("{MEDALLAS}", ($datos_Avance[0]->suma_medallas), $rows);
                    $rows = str_replace("{NUM_USUARIOS}", ($datos_Avance[0]->total_usuarios), $rows);
                    //echo $valor->valor;
                    //echo "<br>";
                    if ($arreglo_post["malla"]) {
                    } else {
                        if ($ejecuta_script_guarda_ranking == "si") {
                            Inserta_tbl_lms_ranking_criterios($nombre_campo, $valor->valor, $datos_Avance[0]->total_usuarios, $datos_Avance[0]->avance, $datos_Avance[0]->suma_puntos, $datos_Avance[0]->resultado, $datos_Avance[0]->suma_medallas, $id_empresa);
                        }
                    }
                }
                //echo $row;
                $PRINCIPAL = str_replace("{LISTADO_USUARIOS}", ($rows), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CRITERIO}", ($criterio), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function ListadoEvaluadoEvaluadoresPorProcesoMediociclo($PRINCIPAL, $arreglo_post, $pagina, $tipo_listado, $id_proceso, $excel, $campo_criterio, $criterio, $valor_criterio, $id_empresa, $campo_criterio)
            {
                //IMPORTANTE////
                $datos_empresa = DatosEmpresa($id_empresa);
                //EL CAMPO CRITERIO, es para cuando se muestren los resumenes.
                //Traigo el total de empresas que existen en el sistema
                //Con la variable tipo usuario, veo si es para el listado de usuarios, o para el listado de envio de correos.
                $datos_proceso = TraeProcesosDeEvaluacionPorIDProceso($id_proceso);
                $campos_para_reporte = CamposParaReporte("veEvaluadorPorProceso", $_SESSION["id_empresa"]);
                //$usuarios=TraeEvaluadoresPorProceso3Campos($id_proceso, $usuarios_por_pagina, $pagina, $arreglo_post, $campo_criterio, $criterio, $valor_criterio, $campos_para_reporte, $datos_empresa);
                $usuarios = TraeEvaluadoEvaluadorPorProceso3CamposMedioCiclo($id_proceso, $usuarios_por_pagina, $pagina, $arreglo_post, $campo_criterio, $criterio, $valor_criterio, $campos_para_reporte, $datos_empresa);
                $PRINCIPAL = str_replace("{ENCABEZADO_DINAMICO}", MuestraEncabezadoPorProceso($id_proceso), $PRINCIPAL);
                //$PRINCIPAL = str_replace("{PAGINACION}",ArmaPaginacionGenerico($pagina, "veEvaluadorPorProceso&i=".Encodear3($id_proceso), "tbl_sgd_relaciones", $usuarios_por_pagina, $arreglo_post, $_SESSION["id_empresa"], $id_proceso, "reporteEvaluador"),$PRINCIPAL);
                $PRINCIPAL = str_replace("{PAGINACION}", "", $PRINCIPAL);
                $total_empresas = "";
                $html_row = file_get_contents("views/procesos/reportes/" . $id_empresa . "_row_listado_evaluador_por_proceso_medio_ciclo_excel.html");
                $i = 1;
                $valor_campo_criterio = "";
                $contador_campo_criterio = 0;
                $contador_criterios = 1;
                foreach ($usuarios as $unico) {
                    $row = $html_row;
                    $i++;
                    $row = str_replace("{N}", $i, $row);
                    $row = str_replace("{RUT_EVALUADOR}", $unico->rut_completo_evaluador, $row);
                    $row = str_replace("{FOTO_EVALUADOR}", VerificaFotoPersonalDesdeAdmin($unico->evaluador), $row);
                    $row = str_replace("{RUT_EVALUADOR_ENCODEADO}", Encodear3($unico->evaluador), $row);
                    $row = str_replace("{NOMBRE_EVALUADOR}", $unico->nombre_evaluador, $row);
                    $row = str_replace("{CARGO_EVALUADOR}", $unico->cargo_evaluador, $row);
                    $row = str_replace("{GERENCIA_EVALUADOR}", $unico->gerencia_evaluador, $row);
                    $row = str_replace("{GERENCIA_EVALUADOR}", $unico->gerencia_evaluador, $row);
                    $row = str_replace("{CAMPO1}", $unico->campo1, $row);
                    $row = str_replace("{CAMPO2}", $unico->campo2, $row);
                    $row = str_replace("{CAMPO3}", $unico->campo3, $row);
                    $row = str_replace("{RUT_EVALUADO}", $unico->rut_completo_evaluado, $row);
                    $row = str_replace("{FOTO_EVALUADO}", VerificaFotoPersonalDesdeAdmin($unico->evaluado), $row);
                    $row = str_replace("{RUT_EVALUADOR_ENCODEADO}", Encodear3($unico->evaluado), $row);
                    $row = str_replace("{NOMBRE_EVALUADO}", $unico->nombre_evaluado, $row);
                    $row = str_replace("{CARGO_EVALUADO}", $unico->cargo_evaluado, $row);
                    $row = str_replace("{GERENCIA_EVALUADO}", $unico->gerencia_evaluado, $row);
                    $row = str_replace("{GERENCIA_EVALUADO}", $unico->gerencia_evaluado, $row);
                    $row = str_replace("{CAMPO1_EVALUADO}", $unico->campo1_evaluado, $row);
                    $row = str_replace("{CAMPO2_EVALUADO}", $unico->campo2_evaluado, $row);
                    $row = str_replace("{CAMPO3_EVALUADO}", $unico->campo3_evaluado, $row);
                    $finalizado_ciclo_medio_1 = EstaFinalizadoEpata1($unico->evaluado, $id_proceso, $id_empresa);
                    if ($finalizado_ciclo_medio_1) {
                        $finalizado_ciclo_1++;
                        $row = str_replace("{POR_AVANCE_MEDIO_CICLO_1}", "Finalizado", $row);
                    } else {
                        $row = str_replace("{POR_AVANCE_MEDIO_CICLO_1}", "Pendiente", $row);
                    }
                    if ($finalizado_ciclo_medio_1[0]->comentario_evaluado && $finalizado_ciclo_medio_1[0]->comentario_evaluador) {
                        $finalizado_ciclo_2++;
                        $row = str_replace("{POR_AVANCE_MEDIO_CICLO_2}", "Finalizado", $row);
                    } else {
                        $row = str_replace("{POR_AVANCE_MEDIO_CICLO_2}", "Pendiente", $row);
                    }
                    $total_empresas .= $row;
                }
                $PRINCIPAL = str_replace("{ROW_LISTADO_USUARIOS}", utf8_encode($total_empresas), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function ReporteCapacitacionBK2($PRINCIPAL, $id_empresa, $arreglo_post, $criterio, $excel)
            {
                /*ROD reporte general*/
                $mallas = TraeMallasEmpresa($id_empresa);
                foreach ($mallas as $malla) {
                    if ($arreglo_post["malla"] == $malla->id) {
                        $option_mallas .= '<option selected value="' . $malla->id . '">' . $malla->nombre . '</option>';
                    } else {
                        $option_mallas .= '<option value="' . $malla->id . '">' . $malla->nombre . '</option>';
                    }
                }
                //$cursos=TraeCursos("0",$id_empresa);
                $cursos = TraeCursos($arreglo_post["malla"], $id_empresa);
                $option_cursos = "";
                foreach ($cursos as $curso) {
                    if ($arreglo_post["curso"] == $curso->id) {
                        $option_cursos .= '<option value="' . $curso->id . '" selected>' . $curso->nombre . '</option>';
                    } else {
                        $option_cursos .= '<option value="' . $curso->id . '">' . $curso->nombre . '</option>';
                    }
                }
                $PRINCIPAL = str_replace("{MALLAS}", utf8_encode($option_mallas), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CURSOS}", utf8_encode($option_cursos), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_EMPRSA}", $id_empresa, $PRINCIPAL);
                //Traigo el listado de usuarios
                $i = 0;
                $acumulador_porcentajes_avance_malla = 0;
                $acumulador_visitas = 0;
                //$usuarios=UsuariosPorEmpresaCapacitacion($id_empresa, $arreglo_post);
                //traigo los datos desde la tabla de reportes
                $usuarios = TraigoDatosTablareportesConsolidad($id_empresa);
                //Primero traigo los usuarios desde la tabla
                foreach ($usuarios as $usu) {
                    $i++;
                    if ($excel == 1) {
                        //$rows.=file_get_contents("views/reportes/capacitacion/row_avance_capacitacion_excel.html");
                        $rows = file_get_contents("views/reportes/capacitacion/row_avance_capacitacion_excel.html");
                    } else {
                        $rows .= file_get_contents("views/reportes/capacitacion/row_avance_capacitacion.html");
                    }
                    $rows = str_replace("{NUM}", $i, $rows);
                    $rows = str_replace("{FOTO}", ColocaImagenVerificaAvatar($usu->rut, "admin"), $rows);
                    $rows = str_replace("{RUT_COMPLETO_EVALUADO}", $usu->rut, $rows);
                    $rows = str_replace("{NOMBRE_COMPLETO}", $usu->nombre, $rows);
                    $rows = str_replace("{CARGO}", $usu->cargo, $rows);
                    $rows = str_replace("{CAMPO1}", $usu->c1, $rows);
                    $rows = str_replace("{CAMPO2}", $usu->c2, $rows);
                    $rows = str_replace("{CAMPO3}", $usu->c3, $rows);
                    $rows = str_replace("{NUM_CURSOS}", $usu->total_cursos, $rows);
                    $rows = str_replace("{NUMERO_AVANCE}", ColocarColoresConPorcentajeProgressBar($usu->avance), $rows);
                    $rows = str_replace("{PUNTOS}", $usu->nombre->suma_puntos, $rows);
                    $rows = str_replace("{ID_MALLA}", $usu->nombre->id_malla, $rows);
                    $rows = str_replace("{RESULTADO}", $usu->promedio_resultados, $rows);
                    $rows = str_replace("{MEDALLAS}", $usu->suma_medallas, $rows);
                    $acumulador_porcentajes_avance_malla = $acumulador_porcentajes_avance_malla + $datos_calculos_malla[1];
                    $acumulador_visitas = $acumulador_visitas + $datos_calculos_malla[2][8];
                    if ($datos_calculos_malla[1] == 100) {
                        $acumula_finalizados++;
                    }
                    if ($datos_calculos_malla[1] == 0) {
                        $acumula_no_iniciados++;
                    }
                    if ($datos_calculos_malla[1] > 0 and $datos_calculos_malla[1] < 100) {
                        $acumula_en_proceso++;
                    }
                    if ($excel == 1) {
                        echo utf8_decode($rows);
                    }
                }
                if ($excel == 1) {
                    exit;
                }
                //echo "$i $acumula_finalizados $acumula_en_proceso $acumula_no_iniciados $acumula_ingresos";
                $acumula_ingresos = $acumula_en_proceso + $acumula_finalizados;
                $PRINCIPAL = str_replace("{LISTADO_USUARIOS}", $rows, $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS}", $i, $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_TOTAL}", number_format($acumulador_porcentajes_avance_malla / $i, 0, ",", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_ACCESOS}", $acumulador_visitas, $PRINCIPAL);
                //Bloque Total de Porcentaje Total
                $PRINCIPAL = str_replace("{GRAFICO_PORCENTAJE_TOTAL}", file_get_contents("views/graficos/grafico_circulo.html"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE}", number_format($acumulador_porcentajes_avance_malla / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_FINALIZADOS}", number_format($acumula_finalizados, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_FINALIZADOS}", number_format(100 * $acumula_finalizados / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_PROCESO}", number_format($acumula_en_proceso, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_PROCESO}", number_format(100 * $acumula_en_proceso / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_NOINICIADO}", number_format($acumula_no_iniciados, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_NOINICIADO}", number_format(100 * $acumula_no_iniciados / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_INGRESADOS}", number_format($acumula_ingresos, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_INGRESADOS}", number_format(100 * $acumula_ingresos / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{TEXTO}", "Avance", $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOMBRE_GRAFICO}", "Avance", $PRINCIPAL);
                //Bloque Total de ACESOS
                $PRINCIPAL = str_replace("{GRAFICO_CANTIDAD_ACCESOS}", file_get_contents("views/graficos/grafico_circulo.html"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE}", number_format($acumulador_visitas * 100 / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{TEXTO}", "Accesos", $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOMBRE_GRAFICO}", "Accesos", $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function ReporteCapacitacionBK($PRINCIPAL, $id_empresa, $arreglo_post, $criterio, $excel)
            {
                /*ROD reporte general*/
                $mallas = TraeMallasEmpresa($id_empresa);
                foreach ($mallas as $malla) {
                    if ($arreglo_post["malla"] == $malla->id) {
                        $option_mallas .= '<option selected value="' . $malla->id . '">' . $malla->nombre . '</option>';
                    } else {
                        $option_mallas .= '<option value="' . $malla->id . '">' . $malla->nombre . '</option>';
                    }
                }
                //$cursos=TraeCursos("0",$id_empresa);
                $cursos = TraeCursos($arreglo_post["malla"], $id_empresa);
                $option_cursos = "";
                foreach ($cursos as $curso) {
                    if ($arreglo_post["curso"] == $curso->id) {
                        $option_cursos .= '<option value="' . $curso->id . '" selected>' . $curso->nombre . '</option>';
                    } else {
                        $option_cursos .= '<option value="' . $curso->id . '">' . $curso->nombre . '</option>';
                    }
                }
                $PRINCIPAL = str_replace("{MALLAS}", utf8_encode($option_mallas), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CURSOS}", utf8_encode($option_cursos), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_EMPRSA}", $id_empresa, $PRINCIPAL);
                //Traigo el listado de usuarios
                $i = 0;
                $acumulador_porcentajes_avance_malla = 0;
                $acumulador_visitas = 0;
                if (count($arreglo_post) > 0) {
                    if ($criterio) {
                        $PRINCIPAL = str_replace("{CRITERIO}", $criterio, $PRINCIPAL);
                        $valores_por_criterio = TraigoValoresDadoCampoPorEmpreas($criterio, $id_empresa);
                        foreach ($valores_por_criterio as $valores) {
                            $i++;
                            $usuarios = UsuariosPorEmpresaCapacitacion($id_empresa, $arreglo_post, $criterio, utf8_encode($valores->valor));
                            if (count($usuarios) == 0) {
                                continue;
                            }
                            $rows .= file_get_contents("views/reportes/capacitacion/row_avance_capacitacion_por_criterio.html");
                            $rows = str_replace("{NUM}", $i, $rows);
                            $rows = str_replace("{NOMBRE}", utf8_encode($valores->valor), $rows);
                            $rows = str_replace("{NUM_USUARIOS}", count($usuarios), $rows);
                            $acumulador_visitas = 0;
                            $acumulador_porcentajes_avance_malla = 0;
                            $acumulador_puntos = 0;
                            $acumulador_medallas = 0;
                            $acumulador_resultados = 0;
                            $contador_usuarios_con_resultados = 0;
                            foreach ($usuarios as $usu) {
                                $datos_calculos_malla = ColocaDatosMallaCapacitacion($rows, $usu->rut, $id_empresa, "", "admin", $arreglo_post);
                                // echo "ROD";
                                //echo "<pre>";print_r($datos_calculos_malla);           exit();
                                $acumulador_porcentajes_avance_malla = $acumulador_porcentajes_avance_malla + $datos_calculos_malla[1];
                                $acumulador_puntos = $acumulador_puntos + $datos_calculos_malla[2][6];
                                $acumulador_medallas = $acumulador_medallas + $datos_calculos_malla[2][7];
                                $acumulador_visitas = $acumulador_visitas + $datos_calculos_malla[2][8];
                                if ($arreglo_post["malla"] <> '0' && $arreglo_post["curso"] <> '0') {
                                    $valor_nota_acumulada = GAMIFICACIONResultadosPorCursoMalla($usu->rut, $arreglo_post["curso"], $arreglo_post["malla"], $id_empresa);
                                    if ($valor_nota_acumulada === 0 or $valor_nota_acumulada > 0) {
                                        $contador_usuarios_con_resultados++;
                                    }
                                    $acumulador_resultados = $acumulador_resultados + $valor_nota_acumulada;
                                } else if ($arreglo_post["malla"] <> '0' && $arreglo_post["curso"] == '0') {
                                    $valor_nota_acumulada = GAMIFICACIONResultadosPorCursoMalla($usu->rut, $arreglo_post["curso"], $arreglo_post["malla"], $id_empresa);
                                    if ($valor_nota_acumulada === 0 or $valor_nota_acumulada > 0) {
                                        $contador_usuarios_con_resultados++;
                                    }
                                    $acumulador_resultados = $acumulador_resultados + $valor_nota_acumulada;
                                }
                            }
                            //$rows = str_replace("{NUMERO_ACCESOS}",$acumulador_visitas,$rows);
                            $rows = str_replace("{NUMERO_ACCESOS}", ColocarColoresConPorcentajeProgressBar(number_format(($acumulador_visitas * 100) / count($usuarios), 0, ",", ".")), $rows);
                            $rows = str_replace("{NUMERO_AVANCE}", ColocarColoresConPorcentajeProgressBar(number_format($acumulador_porcentajes_avance_malla / count($usuarios), 0, ",", ".")), $rows);
                            $rows = str_replace("{PUNTOS}", round($acumulador_puntos / count($usuarios)), $rows);
                            $rows = str_replace("{MEDALLAS}", round($acumulador_medallas / count($usuarios)), $rows);
                            //per capita
                            if ($arreglo_post["malla"] <> '0' && $arreglo_post["curso"] <> '0') {
                                $rows = str_replace("{RESULTADO}", round(number_format($acumulador_resultados / $contador_usuarios_con_resultados, 2, ",", ".")), $rows);
                            } else if ($arreglo_post["malla"] <> '0' && $arreglo_post["curso"] == '0') {
                                $rows = str_replace("{RESULTADO}", round(number_format($acumulador_resultados / $contador_usuarios_con_resultados, 2, ",", ".")), $rows);
                            } else {
                                $rows = str_replace("{RESULTADO}", "-", $rows);
                            }
                        }
                    } else {
                        $usuarios = UsuariosPorEmpresaCapacitacion($id_empresa, $arreglo_post);
                        foreach ($usuarios as $usu) {
                            $i++;
                            if ($excel == 1) {
                                //$rows.=file_get_contents("views/reportes/capacitacion/row_avance_capacitacion_excel.html");
                                $rows = file_get_contents("views/reportes/capacitacion/row_avance_capacitacion_excel.html");
                            } else {
                                $rows .= file_get_contents("views/reportes/capacitacion/row_avance_capacitacion.html");
                            }
                            $rows = str_replace("{NUM}", $i, $rows);
                            $rows = str_replace("{FOTO}", ColocaImagenVerificaAvatar($usu->rut, "admin"), $rows);
                            $datos_calculos_malla = ColocaDatosMallaCapacitacion($rows, $usu->rut, $id_empresa, "", "admin", $arreglo_post);
                            //print_r($usuarios);
                            //print_r($datos_calculos_malla);
                            //exit();
                            /*
     * echo "ROD";
            if($usu->rut=="23964279") {
        echo "<pre>";print_r($datos_calculos_malla);           exit();
            }
            if($usu->rut=="16664719") {
                echo "<pre>";print_r($datos_calculos_malla);           exit();
            }
     * */
                            $rows = str_replace("{RUT_COMPLETO_EVALUADO}", $datos_calculos_malla[2][0], $rows);
                            $rows = str_replace("{NOMBRE_COMPLETO}", $datos_calculos_malla[2][1], $rows);
                            $rows = str_replace("{CARGO}", $datos_calculos_malla[2][2], $rows);
                            $rows = str_replace("{CAMPO1}", $datos_calculos_malla[2][3], $rows);
                            $rows = str_replace("{CAMPO2}", $datos_calculos_malla[2][4], $rows);
                            $rows = str_replace("{CAMPO3}", $datos_calculos_malla[2][5], $rows);
                            $rows = str_replace("{NUM_CURSOS}", $datos_calculos_malla[3], $rows);
                            $rows = str_replace("{NUMERO_AVANCE}", ColocarColoresConPorcentajeProgressBar($datos_calculos_malla[1]), $rows);
                            $rows = str_replace("{PUNTOS}", $datos_calculos_malla[2][6], $rows);
                            if ($arreglo_post["malla"] <> '0' && $arreglo_post["curso"] <> '0') {
                                $rows = str_replace("{RESULTADO}", GAMIFICACIONResultadosPorCursoMalla($usu->rut, $arreglo_post["curso"], $arreglo_post["malla"], $id_empresa), $rows);
                            } else if ($arreglo_post["malla"] <> '0' && $arreglo_post["curso"] == '0') {
                                $rows = str_replace("{RESULTADO}", GAMIFICACIONResultadosPorCursoMalla($usu->rut, "", $arreglo_post["malla"], $id_empresa), $rows);
                            } else if ($arreglo_post["malla"] == '0' && $arreglo_post["curso"] == '0') {
                                $rows = str_replace("{RESULTADO}", GAMIFICACIONResultadosPorCursoMalla($usu->rut, "", $arreglo_post["malla"], $id_empresa), $rows);
                            } else {
                                $rows = str_replace("{RESULTADO}", "-", $rows);
                            }
                            $rows = str_replace("{MEDALLAS}", $datos_calculos_malla[2][7], $rows);
                            //print_R($datos_calculos_malla);exit;
                            //$datos_calculos_malla=ColocaDatosMallaCapacitacion($rows, $usu->rut, $id_empresa, "", "admin");
                            //$rows=$datos_calculos_malla[0];
                            $acumulador_porcentajes_avance_malla = $acumulador_porcentajes_avance_malla + $datos_calculos_malla[1];
                            $acumulador_visitas = $acumulador_visitas + $datos_calculos_malla[2][8];
                            if ($datos_calculos_malla[1] == 100) {
                                $acumula_finalizados++;
                            }
                            if ($datos_calculos_malla[1] == 0) {
                                $acumula_no_iniciados++;
                            }
                            if ($datos_calculos_malla[1] > 0 and $datos_calculos_malla[1] < 100) {
                                $acumula_en_proceso++;
                            }
                            if ($excel == 1) {
                                echo utf8_decode($rows);
                            }
                        }
                        if ($excel == 1) {
                            exit;
                        }
                    }
                }
                //echo "$i $acumula_finalizados $acumula_en_proceso $acumula_no_iniciados $acumula_ingresos";
                $acumula_ingresos = $acumula_en_proceso + $acumula_finalizados;
                $PRINCIPAL = str_replace("{LISTADO_USUARIOS}", $rows, $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS}", $i, $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_TOTAL}", number_format($acumulador_porcentajes_avance_malla / $i, 0, ",", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_ACCESOS}", $acumulador_visitas, $PRINCIPAL);
                //Bloque Total de Porcentaje Total
                $PRINCIPAL = str_replace("{GRAFICO_PORCENTAJE_TOTAL}", file_get_contents("views/graficos/grafico_circulo.html"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE}", number_format($acumulador_porcentajes_avance_malla / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_FINALIZADOS}", number_format($acumula_finalizados, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_FINALIZADOS}", number_format(100 * $acumula_finalizados / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_PROCESO}", number_format($acumula_en_proceso, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_PROCESO}", number_format(100 * $acumula_en_proceso / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_NOINICIADO}", number_format($acumula_no_iniciados, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_NOINICIADO}", number_format(100 * $acumula_no_iniciados / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_INGRESADOS}", number_format($acumula_ingresos, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_INGRESADOS}", number_format(100 * $acumula_ingresos / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{TEXTO}", "Avance", $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOMBRE_GRAFICO}", "Avance", $PRINCIPAL);
                //Bloque Total de ACESOS
                $PRINCIPAL = str_replace("{GRAFICO_CANTIDAD_ACCESOS}", file_get_contents("views/graficos/grafico_circulo.html"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE}", number_format($acumulador_visitas * 100 / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{TEXTO}", "Accesos", $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOMBRE_GRAFICO}", "Accesos", $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function GAMIFICACIONResultadosPorSoloCursoSoloTrivia($rut, $id_curso, $id_empresa)
            {
                $nota_por_curso = GAMIFICACION_NotaPorSoloCursoUsuarioEmpresaSoloTrivia($rut, $id_curso, $id_empresa);
                $nota = $nota_por_curso[0]->nota_por_curso;
                return ($nota);
            }

            function ReporteCapacitacionDetalladoBK($PRINCIPAL, $id_empresa, $arreglo_post, $criterio, $excel)
            {
                $tipo_de_reporte = "detallado";
                $mallas = TraeMallasEmpresa($id_empresa);
                foreach ($mallas as $malla) {
                    if ($arreglo_post["malla"] == $malla->id) {
                        $option_mallas .= '<option selected value="' . $malla->id . '">' . $malla->nombre . '</option>';
                    } else {
                        $option_mallas .= '<option value="' . $malla->id . '">' . $malla->nombre . '</option>';
                    }
                }
                $cursos = TraeCursos("0", $id_empresa);
                $option_cursos = "";
                foreach ($cursos as $curso) {
                    if ($arreglo_post["curso"] == $curso->id) {
                        $option_cursos .= '<option value="' . $curso->id . '" selected>' . $curso->nombre . '</option>';
                    } else {
                        $option_cursos .= '<option value="' . $curso->id . '">' . $curso->nombre . '</option>';
                    }
                }
                $PRINCIPAL = str_replace("{MALLAS}", utf8_encode($option_mallas), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CURSOS}", utf8_encode($option_cursos), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_EMPRSA}", $id_empresa, $PRINCIPAL);
                $fechaactualizacion = LmsBuscaFechaReporte($id_empresa);
                $PRINCIPAL = str_replace("{FECHA_ACTUALIZACION_REPORTE}", $fechaactualizacion, $PRINCIPAL);
                $i = 0;
                $acumulador_porcentajes_avance_malla = 0;
                $acumulador_visitas = 0;
                if (count($arreglo_post) > 0) {
                    if ($criterio and $arreglo_post["malla"] <> '0') {
                        $PRINCIPAL = str_replace("{CRITERIO}", $criterio, $PRINCIPAL);
                        $valores_por_criterio = TraigoValoresDadoCampoPorEmpreas($criterio, $id_empresa);
                        $cursos = TraeCursosActivos($arreglo_post["malla"], $id_empresa, $arreglo_post["curso"]);
                        foreach ($cursos as $curso) {
                            foreach ($valores_por_criterio as $valores) {
                                $i++;
                                $usuarios = UsuariosPorEmpresaCapacitacion_sin($id_empresa, $arreglo_post, $criterio, utf8_encode($valores->valor));
                                if (count($usuarios) == 0) {
                                    continue;
                                }
                                $rows .= file_get_contents("views/reportes/capacitacion/row_avance_capacitacion_por_criterio_detallado.html");
                                $rows = str_replace("{NUM}", $i, $rows);
                                $rows = str_replace("{NOMBRE}", utf8_encode($valores->valor), $rows);
                                $rows = str_replace("{NUM_USUARIOS}", count($usuarios), $rows);
                                $rows = str_replace("{CURSO}", utf8_encode($curso->nombre), $rows);
                                $acumulador_visitas = 0;
                                $acumulador_porcentajes_avance_malla = 0;
                                $acumulador_puntos = 0;
                                $acumulador_medallas = 0;
                                $acumulador_resultados = 0;
                                $contador_usuarios_con_resultados = 0;
                                foreach ($usuarios as $usu) {
                                    $arreglo_post[curso] = $curso->id;
                                    $datos_calculos_malla = ColocaDatosMallaCapacitacion($rows, $usu->rut, $id_empresa, "", "admin", $arreglo_post);
                                    $acumulador_porcentajes_avance_malla = $acumulador_porcentajes_avance_malla + $datos_calculos_malla[1];
                                    $acumulador_puntos = $acumulador_puntos + $datos_calculos_malla[2][6];
                                    $acumulador_medallas = $acumulador_medallas + $datos_calculos_malla[2][7];
                                    $acumulador_visitas = $acumulador_visitas + $datos_calculos_malla[2][8];
                                    if ($arreglo_post["malla"] <> '0' && $arreglo_post["curso"] <> '0') {
                                        $valor_nota_acumulada = GAMIFICACIONResultadosPorSoloCurso($usu->rut, $arreglo_post["curso"], $id_empresa);
                                        if ($valor_nota_acumulada === 0 or $valor_nota_acumulada > 0) {
                                            $contador_usuarios_con_resultados++;
                                        }
                                        $acumulador_resultados = $acumulador_resultados + $valor_nota_acumulada;
                                    } else if ($arreglo_post["malla"] <> '0' && $arreglo_post["curso"] == '0') {
                                        $valor_nota_acumulada = GAMIFICACIONResultadosPorSoloCurso($usu->rut, $arreglo_post["curso"], $id_empresa);
                                        if ($valor_nota_acumulada === 0 or $valor_nota_acumulada > 0) {
                                            $contador_usuarios_con_resultados++;
                                        }
                                        $acumulador_resultados = $acumulador_resultados + $valor_nota_acumulada;
                                    }
                                }
                                $rows = str_replace("{NUMERO_ACCESOS}", ColocarColoresConPorcentajeProgressBar(number_format(($acumulador_visitas * 100) / count($usuarios), 0, ",", ".")), $rows);
                                $rows = str_replace("{NUMERO_AVANCE}", ColocarColoresConPorcentajeProgressBar(number_format($acumulador_porcentajes_avance_malla / count($usuarios), 0, ",", ".")), $rows);
                                $rows = str_replace("{PUNTOS}", round($acumulador_puntos / count($usuarios)), $rows);
                                $rows = str_replace("{MEDALLAS}", round($acumulador_medallas / count($usuarios)), $rows);
                                if ($arreglo_post["malla"] <> '0' && $arreglo_post["curso"] <> '0') {
                                    $rows = str_replace("{RESULTADO}", number_format($acumulador_resultados / $contador_usuarios_con_resultados, 2, ",", "."), $rows);
                                } else if ($arreglo_post["malla"] <> '0' && $arreglo_post["curso"] == '0') {
                                    $rows = str_replace("{RESULTADO}", number_format($acumulador_resultados / $contador_usuarios_con_resultados, 2, ",", "."), $rows);
                                } else if ($arreglo_post["malla"] == '0' && $arreglo_post["curso"] == '0') {
                                    $rows = str_replace("{RESULTADO}", GAMIFICACIONResultadosPorCursoMalla($usu->rut, "", $arreglo_post["malla"], $id_empresa), $rows);
                                } else {
                                    $rows = str_replace("{RESULTADO}", "-", $rows);
                                }
                            }
                        }
                    } else {
                        $usuarios = UsuariosPorEmpresaCapacitacion_sin($id_empresa, $arreglo_post);
                        $datamalla = ObtenerDatosRelMallaUsuarioDadoRut($usu->rut, $id_empresa);
                        $cursos = TraeCursosActivos($arreglo_post["malla"], $id_empresa, $arreglo_post["curso"]);
                        if ($excel == 2) {
                            //EliminoRegistrosTablaReportes($id_empresa);
                        }
                        foreach ($usuarios as $usu) {
                            foreach ($cursos as $curso) {
                                $i++;
                                if ($excel == 1 or $excel == 2) {
                                    $rows = file_get_contents("views/reportes/capacitacion/row_avance_capacitacion_excel_detallado.html");
                                } else if (!$excel) {
                                    $rows .= file_get_contents("views/reportes/capacitacion/row_avance_capacitacion_detallado.html");
                                }
                                $arreglo_post[curso] = $curso->id;
                                $datos_calculos_malla = ColocaDatosMallaCapacitacion($rows, $usu->rut, $id_empresa, "", "admin", $arreglo_post, "", $tipo_de_reporte);
                                $traeimagen = ColocaImagenVerificaAvatar($usu->rut, "admin");
                                if ($traeimagen <> 'img/sinfoto.png') {
                                    if ($id_empresa == "59") {
                                        $miimagenusuario = $traeimagen;
                                    } else {
                                        $miimagenusuario = "../front/" . $traeimagen;
                                    }
                                } else {
                                    $miimagenusuario = "../front/" . $traeimagen;
                                }
                                $rows = str_replace("{FOTO}", $miimagenusuario, $rows);
                                $rows = str_replace("{RUT_COMPLETO_EVALUADO}", $datos_calculos_malla[2][0], $rows);
                                $rows = str_replace("{NOMBRE_COMPLETO}", $datos_calculos_malla[2][1], $rows);
                                $rows = str_replace("{CARGO}", $datos_calculos_malla[2][2], $rows);
                                $rows = str_replace("{CAMPO1}", $datos_calculos_malla[2][3], $rows);
                                $rows = str_replace("{CAMPO2}", $datos_calculos_malla[2][4], $rows);
                                $rows = str_replace("{CAMPO3}", $datos_calculos_malla[2][5], $rows);
                                $rows = str_replace("{EMAIL}", $datos_calculos_malla[2][9], $rows);
                                $rows = str_replace("{MALLA}", $arreglo_post["malla"], $rows);
                                $rows = str_replace("{NUM}", $i, $rows);
                                $rows = str_replace("{CURSO}", utf8_encode($curso->nombre), $rows);
                                $rows = str_replace("{NUMERO_AVANCE}", ColocarColoresConPorcentajeProgressBar($datos_calculos_malla[1]), $rows);
                                $rows = str_replace("{PUNTOS}", $datos_calculos_malla[2][6], $rows);
                                $resultado = GAMIFICACIONResultadosPorSoloCurso($usu->rut, $curso->id, $id_empresa);
                                $rows = str_replace("{RESULTADO}", $resultado, $rows);
                                $rows = str_replace("{MEDALLAS}", $datos_calculos_malla[2][7], $rows);
                                if ($excel == 1) {
                                } else {
                                    $acumulador_porcentajes_avance_malla = $acumulador_porcentajes_avance_malla + $datos_calculos_malla[1];
                                    $acumulador_visitas = $acumulador_visitas + $datos_calculos_malla[2][8];
                                }
                                if ($excel == 1) {
                                    echo utf8_decode($rows);
                                } else if ($excel == 2) {
                                    //echo utf8_decode($rows);
                                    //Inserta_tbl_lms_reportes_acumulada($usu->rut, utf8_decode($datos_calculos_malla[2][1]), utf8_decode($datos_calculos_malla[2][2]), "email", utf8_decode($datos_calculos_malla[2][3]), utf8_decode($datos_calculos_malla[2][4]), utf8_decode($datos_calculos_malla[2][5]), utf8_encode($curso->id_malla), utf8_encode($curso->id_clasificacion), utf8_encode($curso->id), $datos_calculos_malla[1], $datos_calculos_malla[2][6], $resultado, $datos_calculos_malla[2][7], $id_empresa);
                                    //Inserta_tbl_lms_reportes($usu->rut, utf8_decode($datos_calculos_malla[2][1]), utf8_decode($datos_calculos_malla[2][2]), "email", utf8_decode($datos_calculos_malla[2][3]), utf8_decode($datos_calculos_malla[2][4]), utf8_decode($datos_calculos_malla[2][5]), utf8_encode($curso->id_malla), utf8_encode($curso->id_clasificacion), utf8_encode($curso->id), $datos_calculos_malla[1], $datos_calculos_malla[2][6], $resultado, $datos_calculos_malla[2][7], $id_empresa);
                                }
                            }
                        }
                    }
                }
                if ($excel == 1 or $excel == 2) {
                    exit;
                }
                $PRINCIPAL = str_replace("{LISTADO_USUARIOS}", $rows, $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS}", $i, $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_TOTAL}", number_format($acumulador_porcentajes_avance_malla / $i, 0, ",", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_ACCESOS}", $acumulador_visitas, $PRINCIPAL);
                //Bloque Total de Porcentaje Total
                $PRINCIPAL = str_replace("{GRAFICO_PORCENTAJE_TOTAL}", file_get_contents("views/graficos/grafico_circulo.html"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE}", number_format($acumulador_porcentajes_avance_malla / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{TEXTO}", "Avance", $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOMBRE_GRAFICO}", "Avance", $PRINCIPAL);
                //Bloque Total de ACESOS
                $PRINCIPAL = str_replace("{GRAFICO_CANTIDAD_ACCESOS}", file_get_contents("views/graficos/grafico_circulo.html"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE}", number_format($acumulador_visitas * 100 / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{TEXTO}", "Accesos", $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOMBRE_GRAFICO}", "Accesos", $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function outputProgress($current, $total)
            {
                echo "<center><span style='position: absolute;z-index:$current;background:#36C6D3; padding:10px; color:#FFF'>Avance de Proceso " . round($current / $total * 100) . "% </span></center>";
                //myFlush();
                flush();
                ob_end_flush();
                sleep(1);


            }

            function doFlush()
            {
                if (!headers_sent()) {
                    // Disable gzip in PHP.
                    ini_set('zlib.output_compression', 0);

                    // Force disable compression in a header.
                    // Required for flush in some cases (Apache + mod_proxy, nginx, php-fpm).
                    header('Content-Encoding: none');
                }

                // Fill-up 4 kB buffer (should be enough in most cases).
                echo str_pad('', 4 * 1024);

                // Flush all buffers.
                do {
                    $flushed = @ob_end_flush();
                } while ($flushed);

                @ob_flush();
                flush();
            }

            function myFlush()
            {
                flush();
                @ob_flush();
            }

            function GuardaDatosTablaReporte($PRINCIPAL, $id_empresa, $arreglo_post, $criterio, $excel)
            {
                $tipo_de_reporte = "detallado";
                $mallas = TraeMallasEmpresa($id_empresa);
                $cursos = TraeCursos("0", $id_empresa, "0");
                $acumulador_porcentajes_avance_malla = 0;
                $acumulador_visitas = 0;
                //echo "exce $excel";
                $usuarios = UsuariosPorEmpresaCapacitacion_sin($id_empresa, $arreglo_post, "", "");
                $cursos = TraeCursosActivos($arreglo_post["malla"], $id_empresa, $arreglo_post["curso"]);
                if ($excel == 2) {
                    EliminoRegistrosTablaReportes($id_empresa);
                }
                $total_usuarios = count($usuarios);
                $start = microtime(true);
                echo "<br>total $total_usuarios usuarios<br>";
                foreach ($usuarios as $usu) {
                    $datamalla = ObtenerDatosRelMallaUsuarioDadoRut($usu->rut, $id_empresa);
                    $id_malla_uso = $datamalla[0]->id_malla;
                    $usuario_actual++;
                    outputProgress($usuario_actual, $total_usuarios);
                    //Obtener mmalla
                    foreach ($cursos as $curso) {
                        $i++;
                        if ($excel == 1 or $excel == 2) {
                            $rows = file_get_contents("views/reportes/capacitacion/row_avance_capacitacion_excel_detallado.html");
                        } else if (!$excel) {
                            $rows .= file_get_contents("views/reportes/capacitacion/row_avance_capacitacion_detallado.html");
                        }
                        $arreglo_post[curso] = $curso->id;
                        $datos_calculos_malla = ColocaDatosMallaCapacitacion($rows, $usu->rut, $id_empresa, "", "admin", $arreglo_post, "", $tipo_de_reporte);
                        //print_r($datos_calculos_malla);
                        //exit();
                        $id_clasificacion = ObtenerClasificacionDadoCursoMallaEmpresa($curso->id, $id_malla_uso, $id_empresa);
                        $rows = str_replace("{RUT_COMPLETO_EVALUADO}", $datos_calculos_malla[2][0], $rows);
                        $rows = str_replace("{NOMBRE_COMPLETO}", $datos_calculos_malla[2][1], $rows);
                        $rows = str_replace("{CARGO}", $datos_calculos_malla[2][2], $rows);
                        $rows = str_replace("{CAMPO1}", $datos_calculos_malla[2][3], $rows);
                        $rows = str_replace("{CAMPO2}", $datos_calculos_malla[2][4], $rows);
                        $rows = str_replace("{CAMPO3}", $datos_calculos_malla[2][5], $rows);
                        $rows = str_replace("{EMAIL}", $datos_calculos_malla[2][9], $rows);
                        $rows = str_replace("{MALLA}", $arreglo_post["malla"], $rows);
                        $rows = str_replace("{NUM}", $i, $rows);
                        $rows = str_replace("{CURSO}", utf8_encode($curso->nombre), $rows);
                        $rows = str_replace("{NUMERO_AVANCE}", ColocarColoresConPorcentajeProgressBar($datos_calculos_malla[1]), $rows);
                        $resultado = GAMIFICACIONResultadosPorSoloCurso($usu->rut, $curso->id, $id_empresa);
                        $puntos = GAMIFICACIONResultadosPorSoloCursoPuntos($usu->rut, $curso->id, $id_empresa);
                        $rows = str_replace("{PUNTOS}", round($puntos), $rows);
                        $rows = str_replace("{RESULTADO}", round($resultado), $rows);
                        $rows = str_replace("{MEDALLAS}", $datos_calculos_malla[2][7], $rows);
                        if ($excel == 1) {
                        } else {
                            $acumulador_porcentajes_avance_malla = $acumulador_porcentajes_avance_malla + $datos_calculos_malla[1];
                            $acumulador_visitas = $acumulador_visitas + $datos_calculos_malla[2][8];
                        }
                        if ($excel == 1) {
                            echo utf8_decode($rows);
                        } else if ($excel == 2) {
                            //echo utf8_decode($rows);
                            //solo si esta en rut, malla, curso  o rut, curso
                            $inserta = inserta_lms_malla_o_cierre($usu->rut, utf8_encode($id_malla_uso), $curso->id, $id_empresa);
                            if ($inserta == 1) {
                                Inserta_tbl_lms_reportes_acumulada($usu->rut, utf8_decode($datos_calculos_malla[2][1]), utf8_decode($datos_calculos_malla[2][2]), "", utf8_decode($datos_calculos_malla[2][3]), utf8_decode($datos_calculos_malla[2][4]), utf8_decode($datos_calculos_malla[2][5]), utf8_encode($id_malla_uso), utf8_encode($id_clasificacion[0]->id_clasificacion), utf8_encode($curso->id), $datos_calculos_malla[1], $puntos, $resultado, $datos_calculos_malla[2][7], $id_empresa, $datos_calculos_malla[2][0]);
                                Inserta_tbl_lms_reportes($usu->rut, utf8_decode($datos_calculos_malla[2][1]), utf8_decode($datos_calculos_malla[2][2]), "", utf8_decode($datos_calculos_malla[2][3]), utf8_decode($datos_calculos_malla[2][4]), utf8_decode($datos_calculos_malla[2][5]), utf8_encode($id_malla_uso), utf8_encode($id_clasificacion[0]->id_clasificacion), utf8_encode($curso->id), $datos_calculos_malla[1], $puntos, $resultado, $datos_calculos_malla[2][7], $id_empresa, $datos_calculos_malla[2][0]);
                            }
                        }
                    }
                }
                //Aca traigo los datos de la empresa, para ver cuales son sus campos 1, 2, y 3
                $campos_empresa = TraeCampos($id_empresa);
                if ($campos_empresa[0]->campo1) {
                    DeleteLmsRankingPorCriterioEmpresa("c1", $id_empresa);
                    $PRINCIPAL = ReporteCapacitacionPorcriterio("", $id_empresa, $arreglo_post, $campos_empresa[0]->campo1, "c1", "si");
                }
                if ($campos_empresa[0]->campo2) {
                    DeleteLmsRankingPorCriterioEmpresa("c2", $id_empresa);
                    $PRINCIPAL = ReporteCapacitacionPorcriterio("", $id_empresa, $arreglo_post, $campos_empresa[0]->campo1, "c2", "si");
                }
                if ($campos_empresa[0]->campo3) {
                    DeleteLmsRankingPorCriterioEmpresa("c3", $id_empresa);
                    $PRINCIPAL = ReporteCapacitacionPorcriterio("", $id_empresa, $arreglo_post, $campos_empresa[0]->campo1, "c3", "si");
                }
                $time_elapsed_secs = microtime(true) - $start;
                $time_elapsed = gmdate("H:i:s", $time_elapsed_secs);
                echo "<br><strong>Actualizacion Finalizada</strong></br>Tiempo: $time_elapsed";
                return ($PRINCIPAL);
            }

            function GuardaDatosTablaReporteSinEmpresa()
            {
                BorraTblLmsReporte();
                $tipo_de_reporte = "detallado";
                $acumulador_porcentajes_avance_malla = 0;
                $acumulador_visitas = 0;
                $usuarios = UsuariosPorEmpresaCapacitacion_sinSinEmpresa($arreglo_post, "", "");
                $total_usuarios = count($usuarios);
                $start = microtime(true);
                echo "<br>total $total_usuarios usuarios<br>GuardaDatosTablaReporteSinEmpresa";
                foreach ($usuarios as $usu) {
                    $datamalla = ObtenerDatosRelMallaUsuarioDadoRutSinEmpresa($usu->rut);
                    //$id_malla_uso=$datamalla[0]->id_malla;
                    $id_empresaArray = ObtenerEmpresaDadoRutSinEmpresa($usu->rut);
                    $id_empresa = $id_empresaArray[0]->id_empresa;
                    //$cursos=TraeCursosSinEmpresa($id_malla_uso,"0");
                    $cursos = LMS_REPORTE_TraeCursosInscripcionUsuario($usu->rut, $usu->id_empresa);
                    //print_r($id_empresa);
                    //    echo "<br>".$usu->rut.",$id_malla_uso, $id_empresa<br>";
                    //print_r($cursos);
                    $usuario_actual++;
                    outputProgress($usuario_actual, $total_usuarios);
                    //Obtener mmalla
                    foreach ($cursos as $curso) {
                        //echo "<br>curso id ".$curso->id_curso." rut ".$usu->rut." malla ".$curso->id_malla;
                        $tienetrivia = LMS_TieneTriviaCurso($curso->id_curso, $id_empresa);
                        //echo "<br>LMS_TieneTriviaCurso $tienetrivia";
                        $i++;
                        //$arreglo_post[curso]=$curso->id;
                        $arreglo_post[curso] = $curso->id_curso;
                        //echo $curso->id_curso."<br>";
                        $datos_relacion_rel_malla_curso = LMS_REPORTE_TraeMallaCurso($curso->id_curso, $curso->id_malla, $id_empresa);
                        //print_r($datos_relacion_rel_malla_curso);
                        //echo "<br><br>";
                        //busca si existe bbddhos en
                        $id_programa_bbddhost = LMS_Buscabbddhost($datos_relacion_rel_malla_curso[0]->id_programa, $id_empresa);
                        //print_r($id_programa_bbddhost);
                        //echo "<br><br>";
                        //print_r($id_programa_bbddhost);
                        if ($id_programa_bbddhost[0]->bbdd_host) {
                            //echo $id_programa_bbddhost[0]->bbdd_host." PROGRAMA HOST <br>";
                            $hostname = $id_programa_bbddhost[0]->bbdd_host;
                            $database = $id_programa_bbddhost[0]->bbdd_database;
                            $username = $id_programa_bbddhost[0]->bbdd_username;
                            $password = $id_programa_bbddhost[0]->bbdd_password;
                            $conexion = new mysqli($hostname, $username, $password, $database);
                            //$sql="select * from tbl_usuario where rut='".$usu->rut."'";
                            //Traigo datos desde la tabla lms_reporte
                            $sql = "
                        select *
                            from tbl_lms_reportes
                            where rut='" . $usu->rut . "' and
                                id_malla='" . $datos_relacion_rel_malla_curso[0]->id_malla . "' and
                                id_clasificacion='" . $datos_relacion_rel_malla_curso[0]->id_clasificacion . "' and
                                id_curso='" . $curso->id_curso . "' and
                                id_empresa='" . $id_programa_bbddhost[0]->id_empresa_programa . "'
                                ";
                            //echo $sql;
                            //echo "<br>";
                            $query = $conexion->query($sql);
                            if ($query->num_rows > 0) {
                                while ($r = $query->fetch_array()) {
                                    //print_r($r);
                                    //echo "<br><br>";
                                    //echo $r["nombre"];
                                    //echo "<br>";
                                    $nombre = $r["nombre"];
                                    $cargo = $r["cargo"];
                                    $email = $r["email"];
                                    $fecha_inicio = $r["fecha_inicio"];
                                    $fecha_termino = $r["fecha_termino"];
                                    $datos_calculos_malla[2][3] = $r["c1"];
                                    $datos_calculos_malla[2][4] = $r["c2"];
                                    $datos_calculos_malla[2][5] = $r["c3"];
                                    $c3 = $r["id_malla"];
                                    $id_clasificacion = $r["id_clasificacion"];
                                    $datos_calculos_malla[1] = $r["avance"];
                                    $puntos = $r["puntos"];
                                    $resultado = $r["resultado"];
                                    $datos_calculos_malla[2][7] = $r["medallas"];
                                    $fecha = $r["fecha"];
                                    $hora = $r["hora"];
                                    $id_empresa_externo = $r["id_empresa"];
                                    $datos_calculos_malla[2][0] = $r["rut_completo"];
                                    $datos_calculos_malla2 = ColocaDatosMallaCapacitacion($rows, $usu->rut, $id_empresa, "", "admin", $arreglo_post, "", $tipo_de_reporte);
                                    $datos_calculos_malla[2][3] = $datos_calculos_malla2[2][3];
                                    $datos_calculos_malla[2][4] = $datos_calculos_malla2[2][4];
                                    $datos_calculos_malla[2][5] = $datos_calculos_malla2[2][5];
                                    $datos_calculos_malla[2][10] = $datos_calculos_malla2[2][10];
                                    $fec_inicio_curso = $fecha_inicio;
                                    $fec_termino_curso = $fecha_termino;
                                }
                            } else {
                                //    echo "No hay resultados";
                            }
                        } else {
                            $datos_calculos_malla = ColocaDatosMallaCapacitacion($rows, $usu->rut, $id_empresa, "", "admin", $arreglo_post, "", $tipo_de_reporte);
                            $fecha_curso = LMS_REPORTE_VerificaFechasObjetoFinalizadoDadoObjetoPrimero($curso->id_curso, $usu->rut);
                            $fec_inicio_curso = $fecha_curso[0]->fecha_inicio;
                            $fec_termino_curso = $fecha_curso[0]->fecha_termino;
                        }
                        //echo "<br><br>";
                        //echo "<br> RUT ".$usu->rut;
                        //echo "<br>2-10"; echo $datos_calculos_malla[2][10];
                        //$id_clasificacion=ObtenerClasificacionDadoCursoMallaEmpresa($curso->id, $id_malla_uso, $id_empresa);
                        //traigo datos de Rel Malla Curso, para traer todos los codigos asociados al curso
                        //Obtengo el primer objeto finalizado
                        //$fecha_final=LMS_REPORTE_VerificaObjetoFinalizadoDadoObjetoUltima($curso->id_curso, $usu->rut);
                        $rows = str_replace("{RUT_COMPLETO_EVALUADO}", $datos_calculos_malla[2][0], $rows);
                        $rows = str_replace("{NOMBRE_COMPLETO}", $datos_calculos_malla[2][1], $rows);
                        $rows = str_replace("{CARGO}", $datos_calculos_malla[2][2], $rows);
                        $rows = str_replace("{CAMPO1}", $datos_calculos_malla[2][3], $rows);
                        $rows = str_replace("{CAMPO2}", $datos_calculos_malla[2][4], $rows);
                        $rows = str_replace("{CAMPO3}", $datos_calculos_malla[2][5], $rows);
                        $rows = str_replace("{EMAIL}", $datos_calculos_malla[2][9], $rows);
                        $rows = str_replace("{MALLA}", $arreglo_post["malla"], $rows);
                        $rows = str_replace("{NUM}", $i, $rows);
                        $rows = str_replace("{CURSO}", utf8_encode($curso->nombre), $rows);
                        $rows = str_replace("{NUMERO_AVANCE}", ColocarColoresConPorcentajeProgressBar($datos_calculos_malla[1]), $rows);
                        //$resultado=GAMIFICACIONResultadosPorSoloCurso($usu->rut, $curso->id_curso, $id_empresa);
                        //$puntos=GAMIFICACIONResultadosPorSoloCursoPuntos($usu->rut, $curso->id, $id_empresa);
                        if ($id_programa_bbddhost[0]->bbdd_host) {
                        } else {
                            if ($tienetrivia > 0) {
                                $resultado = round(GAMIFICACIONResultadosPorSoloCursoSoloTrivia($usu->rut, $curso->id_curso, $id_empresa));
                            } else {
                                $resultado = "-";
                            }
                            $puntos = GAMIFICACIONResultadosPorSoloCursoPuntos($usu->rut, $curso->id_curso, $id_empresa);
                        }
                        $rows = str_replace("{PUNTOS}", round($puntos), $rows);
                        $rows = str_replace("{RESULTADO}", ($resultado), $rows);
                        $rows = str_replace("{MEDALLAS}", $datos_calculos_malla[2][7], $rows);
                        //echo "insert";
                        if ($datos_relacion_rel_malla_curso[0]->id_curso <> '') {
                            Inserta_tbl_lms_reportes_sinempresa(
                                $usu->rut,
                                $usu->nombre_completo,
                                $usu->cargo,
                                $usu->email,
                                utf8_decode($datos_calculos_malla[2][3]),
                                utf8_decode($datos_calculos_malla[2][4]),
                                utf8_decode($datos_calculos_malla[2][5]),
                                utf8_encode($datos_relacion_rel_malla_curso[0]->id_malla),
                                utf8_encode($datos_relacion_rel_malla_curso[0]->id_clasificacion),
                                utf8_encode($datos_relacion_rel_malla_curso[0]->id_curso),
                                $datos_calculos_malla[1],
                                $puntos,
                                $resultado,
                                $datos_calculos_malla[2][7],
                                $id_empresa,
                                $datos_calculos_malla[2][0],
                                utf8_encode($datos_relacion_rel_malla_curso[0]->id_foco),
                                utf8_encode($datos_relacion_rel_malla_curso[0]->id_programa),
                                $fec_inicio_curso,
                                $fec_termino_curso,
                                utf8_decode($datos_calculos_malla[2][10]),
                                ($datos_relacion_rel_malla_curso[0]->opcional)
                            );
                            //echo "insertoooo";
                        }
                        //echo "<br>hola";
                        //    Inserta_tbl_lms_reportes_acumulada_sinempresa($usu->rut, utf8_decode($datos_calculos_malla[2][1]), utf8_decode($datos_calculos_malla[2][2]), "", utf8_decode($datos_calculos_malla[2][3]), utf8_decode($datos_calculos_malla[2][4]), utf8_decode($datos_calculos_malla[2][5]), utf8_encode($id_malla_uso), utf8_encode($id_clasificacion[0]->id_clasificacion), utf8_encode($curso->id), $datos_calculos_malla[1], $puntos, $resultado, $datos_calculos_malla[2][7], $id_empresa, $datos_calculos_malla[2][0]);
                        //}
                    }
                }
                //Aca traigo los datos de la empresa, para ver cuales son sus campos 1, 2, y 3
                $campos_empresa = TraeCampos($id_empresa);
                if ($campos_empresa[0]->campo1) {
                    DeleteLmsRankingPorCriterioEmpresa("c1", $id_empresa);
                    $PRINCIPAL = ReporteCapacitacionPorcriterio("", $id_empresa, $arreglo_post, $campos_empresa[0]->campo1, "c1", "si");
                }
                if ($campos_empresa[0]->campo2) {
                    DeleteLmsRankingPorCriterioEmpresa("c2", $id_empresa);
                    $PRINCIPAL = ReporteCapacitacionPorcriterio("", $id_empresa, $arreglo_post, $campos_empresa[0]->campo1, "c2", "si");
                }
                if ($campos_empresa[0]->campo3) {
                    DeleteLmsRankingPorCriterioEmpresa("c3", $id_empresa);
                    $PRINCIPAL = ReporteCapacitacionPorcriterio("", $id_empresa, $arreglo_post, $campos_empresa[0]->campo1, "c3", "si");
                }
                $time_elapsed_secs = microtime(true) - $start;
                $time_elapsed = gmdate("H:i:s", $time_elapsed_secs);
                echo "<br><strong>Actualizacion Finalizada</strong></br>Tiempo: $time_elapsed";
                return ($PRINCIPAL);
            }

            function ListadoEvaluadoresPorProcesoMediociclo($PRINCIPAL, $arreglo_post, $pagina, $tipo_listado, $id_proceso, $excel, $campo_criterio, $criterio, $valor_criterio, $id_empresa, $campo_criterio)
            {
                //IMPORTANTE////
                $datos_empresa = DatosEmpresa($id_empresa);
                //EL CAMPO CRITERIO, es para cuando se muestren los resumenes.
                //Traigo el total de empresas que existen en el sistema
                //Con la variable tipo usuario, veo si es para el listado de usuarios, o para el listado de envio de correos.
                $datos_proceso = TraeProcesosDeEvaluacionPorIDProceso($id_proceso);
                $campos_para_reporte = CamposParaReporte("veEvaluadorPorProceso", $_SESSION["id_empresa"]);
                //$usuarios=TotalUsuarios($arreglo_post, $_SESSION["id_empresa"], $pagina, $usuarios_por_pagina);
                //$usuarios=SelectParaPaginacionUsuario("tbl_usuario", $_SESSION["id_empresa"], $usuarios_por_pagina);
                $PRINCIPAL = str_replace("{FILTROS_SUPERIORES}", file_get_contents("views/filtros/barra_superior_reportes_avances.html"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{BUSCADOR}", file_get_contents("views/buscador_personas/buscador.html"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ENVIRONMENT}", "veEvaluadorPorProceso&i=" . Encodear3($id_proceso), $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOMBRE_PROCESO}", utf8_encode($datos_proceso[0]->descripcion_proceso), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_PROCESO_ANUAL}", Encodear3($datos_proceso[0]->id_proceso_anual), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_PROCESO_EVAL}", Encodear3($id_proceso), $PRINCIPAL);
                //$usuarios=DatosParaListadoPaginado("tbl_sgd_proceso_anual", $_SESSION["id_empresa"], $usuarios_por_pagina, $pagina, $arreglo_post);
                //$usuarios=TraeRelacionesPorProceso($id_proceso, $usuarios_por_pagina, $pagina, $arreglo_post);
                //$usuarios=TraeEvaluadoresPorProceso($id_proceso, $usuarios_por_pagina, $pagina, $arreglo_post, $campo_criterio, $criterio, $valor_criterio, $campos_para_reporte);
                if ($campo_criterio) {
                    $registros_por_criterio = DistinctCampoUsuario($id_empresa, $campo_criterio);
                } else {
                    $usuarios = TraeEvaluadoresPorProceso3Campos($id_proceso, $usuarios_por_pagina, $pagina, $arreglo_post, $campo_criterio, $criterio, $valor_criterio, $campos_para_reporte, $datos_empresa);
                }
                $PRINCIPAL = str_replace("{ENCABEZADO_DINAMICO}", MuestraEncabezadoPorProceso($id_proceso), $PRINCIPAL);
                //$PRINCIPAL = str_replace("{PAGINACION}",ArmaPaginacionGenerico($pagina, "veEvaluadorPorProceso&i=".Encodear3($id_proceso), "tbl_sgd_relaciones", $usuarios_por_pagina, $arreglo_post, $_SESSION["id_empresa"], $id_proceso, "reporteEvaluador"),$PRINCIPAL);
                $PRINCIPAL = str_replace("{PAGINACION}", "", $PRINCIPAL);
                $total_empresas = "";
                if ($excel == 1) {
                    $html_row = file_get_contents("views/procesos/reportes/" . $id_empresa . "_row_listado_evaluador_por_proceso_medio_ciclo_excel.html");
                } else {
                    $html_row = file_get_contents("views/procesos/reportes/" . $id_empresa . "_row_listado_evaluador_por_proceso_medio_ciclo.html");
                }
                $i = 1;
                $valor_campo_criterio = "";
                $contador_campo_criterio = 0;
                $contador_criterios = 1;
                if ($campo_criterio) {
                    foreach ($registros_por_criterio as $unico) {
                        $row = file_get_contents("views/procesos/reportes/" . $id_empresa . "_row_listado_por_criterio_fijacion.html");
                        $row = str_replace("{N}", $i, $row);
                        $row = str_replace("{N}", $i, $row);
                        $row = str_replace("{VALOR_CRITERIO}", $unico->valor, $row);
                        //Ahora por cada criterio, traigo el listado de usuarios
                        $usuarios_por_criterio = TraeEvaluadoresPorProceso3Campos($id_proceso, "", "", "", "", $campo_criterio, $unico->valor, $campos_para_reporte, $datos_empresa);
                        $acumulador_avance_total = 0;
                        $acumulador_fijacion = 0;
                        $acumulador_validacion = 0;
                        $acumulador_reunion = 0;
                        foreach ($usuarios_por_criterio as $usuarios_unico_cri) {
                            $row_arreglo_datos = ColocaAvancesPorEvaluador($row, $usuarios_unico_cri->evaluador, $id_proceso, $id_empresa, "admin");
                            $acumulador_fijacion = $acumulador_fijacion + $row_arreglo_datos[0];
                            $acumulador_validacion = $acumulador_validacion + $row_arreglo_datos[1];
                            $acumulador_reunion = $acumulador_reunion + $row_arreglo_datos[2];
                            $acumulador_avance_total = $acumulador_avance_total + $row_arreglo_datos[4];
                        }
                        $row = str_replace("{CANTIDAD_EVALUADOS}", count($usuarios_por_criterio), $row);
                        $row = str_replace("{POR_1}", number_format($acumulador_fijacion / count($usuarios_por_criterio), 0), $row);
                        $row = str_replace("{POR_3}", number_format($acumulador_validacion / count($usuarios_por_criterio), 0), $row);
                        $row = str_replace("{AVANCE_DESCARGA_INFORMES}", number_format($acumulador_reunion / count($usuarios_por_criterio), 0), $row);
                        $row = str_replace("{AVANCE_TOTAL_FIJACION}", number_format($acumulador_avance_total / count($usuarios_por_criterio), 0), $row);
                        $i++;
                        $total_empresas .= $row;
                    }
                    $PRINCIPAL = str_replace("{LISTADO_AREAS_DATOS}", utf8_encode($total_empresas), $PRINCIPAL);
                } else {
                    foreach ($usuarios as $unico) {
                        $row = $html_row;
                        if ($pagina == 1) {
                            $row = str_replace("{N}", $i, $row);
                        } else {
                            $row = str_replace("{N}", $i + (($pagina - 1) * $usuarios_por_pagina), $row);
                        }
                        $i++;
                        $row = str_replace("{RUT_EVALUADOR}", $unico->rut_completo_evaluador, $row);
                        $row = str_replace("{FOTO_EVALUADOR}", VerificaFotoPersonalDesdeAdmin($unico->evaluador), $row);
                        $row = str_replace("{RUT_EVALUADOR_ENCODEADO}", Encodear3($unico->evaluador), $row);
                        $row = str_replace("{NOMBRE_EVALUADOR}", $unico->nombre_evaluador, $row);
                        $row = str_replace("{CARGO_EVALUADOR}", $unico->cargo_evaluador, $row);
                        $row = str_replace("{GERENCIA_EVALUADOR}", $unico->gerencia_evaluador, $row);
                        $row = str_replace("{GERENCIA_EVALUADOR}", $unico->gerencia_evaluador, $row);
                        $row = str_replace("{CAMPO1}", $unico->campo1, $row);
                        $row = str_replace("{CAMPO2}", $unico->campo2, $row);
                        $row = str_replace("{CAMPO3}", $unico->campo3, $row);
                        $row = str_replace("{CANTIDAD_EVALUADOS}", $unico->total_evaluados, $row);
                        $row = str_replace("{CAMBIO_CLAVE}", ColocaEtiquetaReportesSGD($unico->clave_creada, 1), $row);
                        $porcentaje_Avance_evaluador = AvanceDeEvaluados($unico->evaluador, $id_proceso, "", "");
                        $row = str_replace("{TOTAL_FINALIZADOS}", ColocarColoresConPorcentaje($porcentaje_Avance_evaluador[0]), $row);
                        $row = str_replace("{TOTAL_EN_PROCESO}", ColocaEtiquetaReportesSGD($unico->total_en_proceso + 0, $unico->total_evaluados), $row);
                        $row = str_replace("{ID_REGISTRO_FINALIZADO_EVALUADO_EVALUADOR}", Encodear3($unico->id_registro_finalizado), $row);
                        $row = str_replace("{ID_PROCESO_ENCODEADO}", Encodear3($id_proceso), $row);
                        $row = str_replace("{ID_PROCESO_ENCODEADO}", Encodear3($id_proceso), $row);
                        $row_arreglo_datos = ColocaAvancesPorEvaluador($row, $unico->evaluador, $id_proceso, $id_empresa, "admin");
                        $row = $row_arreglo_datos[3];
                        $total_empresas .= $row;
                    }
                }
                $PRINCIPAL = str_replace("{ROW_LISTADO_USUARIOS}", utf8_encode($total_empresas), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function ListadoCursosAdmin2ConParticipantes($PRINCIPAL, $id_empresa, $excel)
            {
                $cursos = TotalCursosParaPaginacion2PorParticipantes($id_empresa);
                $total_html = "";
                $i = 1;
                //print_r($cursos);
                foreach ($cursos as $unico) {
                    if ($excel == 1) {
                        $row = file_get_contents("views/capacitacion/cursospresenciales/row_listado_excel.html");
                    } else {
                        $row = file_get_contents("views/capacitacion/cursospresenciales/row_listado.html");
                    }
                    $row = str_replace("{NUMERO}", $i, $row);
                    $i++;
                    $row = str_replace("{CODIGO}", $unico->numero_identificador, $row);
                    $row = str_replace("{CODIGO_CURSO}", $unico->id, $row);
                    $row = str_replace("{CODIGO_ENCODEADO}", Encodear($unico->id), $row);
                    $row = str_replace("{RUT}", $unico->rut, $row);
                    $row = str_replace("{NOMBRE_COLABORADOR}", $unico->nombre_completo, $row);
                    $row = str_replace("{NOMBRE}", $unico->nombre, $row);
                    $row = str_replace("{DESCRIPCION}", $unico->descripcion, $row);
                    $row = str_replace("{OBJETIVO_CURSO}", $unico->objetivo_curso, $row);
                    $row = str_replace("{CLASIFICACION}", $unico->nombre_clasificacion, $row);
                    $row = str_replace("{SENCE}", $unico->sence, $row);
                    $row = str_replace("{PARTICIPANTES_MAX}", $unico->cantidad_maxima_participantes, $row);
                    $row = str_replace("{OTEC}", $unico->nombre_otec, $row);
                    $row = str_replace("{CBC}", $unico->cbc, $row);
                    $row = str_replace("{MODALIDAD}", $unico->nombre_modalidad, $row);
                    //$row = str_replace("{TIPO}",$unico->tipo,$row);
                    $row = str_replace("{TIPO}", $unico->nombre_tipo_curso, $row);
                    $row = str_replace("{PREREQUISITOS}", $unico->prerequisito, $row);
                    $row = str_replace("{VALOR_HORA}", colocarPesos($unico->valor_hora), $row);
                    $row = str_replace("{VALOR_HORA_SENCE}", colocarPesos($unico->valor_hora_sence), $row);
                    $row = str_replace("{NUM_HORAS}", $unico->numero_horas, $row);
                    $row = str_replace("{VALOR_CURSO}", colocarPesos($unico->numero_horas * $unico->valor_hora), $row);
                    $row = str_replace("{EJECUTIVO}", ($unico->ejecutivocapacitacion), $row);
                    $row = str_replace("{PARTICIPANTE}", ($unico->participantes), $row);
                    $row = str_replace("{VALOR_CURSO}", colocarPesos($unico->numero_horas * $unico->valor_hora), $row);
                    $row = str_replace("{FECHAI}", ($unico->fecha_inicio), $row);
                    $row = str_replace("{FECHAT}", ($unico->fecha_finalizacion), $row);
                    $total_html .= $row;
                }
                $PRINCIPAL = str_replace("{ROW_LISTADO}", ($total_html), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function ListadoCursosAdmin2ConParticipantesT($PRINCIPAL, $id_empresa, $excel)
            {
                $cursos = TotalCursosParaPaginacion2PorParticipantes($id_empresa);
                $total_html = "";
                $i = 1;
                //print_r($cursos);
                foreach ($cursos as $unico) {
                    if ($excel == 1) {
                        $row = file_get_contents("views/capacitacion/cursospresenciales/row_listado_excel.html");
                    } else {
                        $row = file_get_contents("views/capacitacion/cursospresenciales/row_listado.html");
                    }
                    $row = str_replace("{NUMERO}", $i, $row);
                    $i++;
                    $row = str_replace("{CODIGO}", $unico->numero_identificador, $row);
                    $row = str_replace("{CODIGO_CURSO}", $unico->id, $row);
                    $row = str_replace("{CODIGO_ENCODEADO}", Encodear($unico->id), $row);
                    $row = str_replace("{RUT}", $unico->rut, $row);
                    $row = str_replace("{NOMBRE_COLABORADOR}", $unico->nombre_completo, $row);
                    $row = str_replace("{NOMBRE}", $unico->nombre, $row);
                    $row = str_replace("{DESCRIPCION}", $unico->descripcion, $row);
                    $row = str_replace("{OBJETIVO_CURSO}", $unico->objetivo_curso, $row);
                    $row = str_replace("{CLASIFICACION}", $unico->nombre_clasificacion, $row);
                    $row = str_replace("{SENCE}", $unico->sence, $row);
                    $row = str_replace("{PARTICIPANTES_MAX}", $unico->cantidad_maxima_participantes, $row);
                    $row = str_replace("{OTEC}", $unico->nombre_otec, $row);
                    $row = str_replace("{CBC}", $unico->cbc, $row);
                    $row = str_replace("{MODALIDAD}", $unico->nombre_modalidad, $row);
                    //$row = str_replace("{TIPO}",$unico->tipo,$row);
                    $row = str_replace("{TIPO}", $unico->nombre_tipo_curso, $row);
                    $row = str_replace("{PREREQUISITOS}", $unico->prerequisito, $row);
                    $row = str_replace("{VALOR_HORA}", colocarPesos($unico->valor_hora), $row);
                    $row = str_replace("{VALOR_HORA_SENCE}", colocarPesos($unico->valor_hora_sence), $row);
                    $row = str_replace("{NUM_HORAS}", $unico->numero_horas, $row);
                    $row = str_replace("{VALOR_CURSO}", colocarPesos($unico->numero_horas * $unico->valor_hora), $row);
                    $row = str_replace("{EJECUTIVO}", ($unico->ejecutivocapacitacion), $row);
                    $row = str_replace("{PARTICIPANTE}", ($unico->participantes), $row);
                    $row = str_replace("{VALOR_CURSO}", colocarPesos($unico->numero_horas * $unico->valor_hora), $row);
                    $row = str_replace("{FECHAI}", ($unico->fecha_inicio), $row);
                    $row = str_replace("{FECHAT}", ($unico->fecha_finalizacion), $row);
                    $total_html .= $row;
                }
                $PRINCIPAL = str_replace("{ROW_LISTADO}", ($total_html), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function AceptaProcesamientoPrevioCursosMasivos($id_empresa)
            {
                //Trae todos los datos de la tabla temporal.
                $Utemp = TraeTotalcursosTemporal($id_empresa);
                $linea = 0;
                //DesvinculaUsuariosExcel($id_empresa);
                foreach ($Utemp as $key => $item) {
                    $coma = "";
                    $values = "";
                    $registros = "";
                    $accion = "";
                    $valuesUpdate = "";
                    $rut = "";
                    foreach ($item as $key2 => $valor) {
                        echo $key2;
                        if ($key2 == "id") {
                            $codigo_curso = $valor;
                        }
                        if ($key2 == "accion") {
                            $accion = $valor;
                        } else {
                            if ($key2 != "rid") {
                                if ($key2 == "rut") {
                                    $rut = $valor;
                                }
                                $values .= $coma . $key2;
                                $registros .= $coma . "'" . $valor . "'";
                                $valuesUpdate .= $coma . $key2 . "='" . $valor . "'";
                                $coma = ",";
                            }
                        }
                    }
                    if ($accion == "INSERTAR") {
                        InsertaCursosMasivo($values, $registros);
                    } else if ($accion == "ACTUALIZAR") {
                        //ActualizaUsuarioMasivo($rut,$valuesUpdate,$id_empresa);
                        ActualizaCursoMasivo($valuesUpdate, $id_empresa, $codigo_curso);
                    }
                    $linea++;
                }
                CancelaProcesamientoPrevioUsuarios($id_empresa);
            }

            function ListadoCursosMasivosPrevioVisualiza($id_empresa)
            {
                $total = TraeTotalcursosTemporal($id_empresa);
                $listado = file_get_contents("views/capacitacion/curso/entorno_listado_previa.html");
                foreach ($total as $unico) {
                    $row .= file_get_contents("views/capacitacion/curso/row_listado_previa.html");
                    $row = str_replace("{NOMBRE}", $unico->nombre, $row);

                    $row = str_replace("{ACCION}", $unico->accion, $row);
                    $row = str_replace("{CODIGO_CURSO}", $unico->id, $row);
                    $row = str_replace("{DESCRIPCION}", $unico->descripcion, $row);
                    $row = str_replace("{FECHA_INICIO}", $unico->fecha_inicio, $row);
                    $row = str_replace("{FECHA_TERMINO}", $unico->fecha_finalizacion, $row);
                    if ($unico->accion == "ACTUALIZAR") {
                        $row = str_replace("{ETIQUETA}", "warning", $row);
                    } else if ($unico->accion == "INSERTAR") {
                        $row = str_replace("{ETIQUETA}", "success", $row);
                    }
                    $row = str_replace("{CODIGO_SENCE}", $unico->cod_sence, $row);
                    $row = str_replace("{NUMERO_IDENTIFICADOR}", $unico->numero_identificador, $row);
                }
                $listado = str_replace("{ROW_LISTADO}", $row, $listado);
                return ($listado);
            }

            function jValidarObligatorioCampoCursos($idEmpresa, $campoVisual)
            {
                $obligatorio = 0;
                $result = buscarRegistroNombreCampoTablaCursoTemporal($idEmpresa, $campoVisual);
                foreach ($result as $row) {
                    $obligatorio = $row->obligatorio;
                }
                return $obligatorio;
            }

            function jCampoVisualCambioCampoTablaCursos($idEmpresa, $campoVisual)
            {
                $nombreCampoTabla = "";
                //$result = buscarRegistroNombreCampoTablaCursoTemporal($idEmpresa, $campoVisual);
                $result = buscarRegistroNombreCampoParaCursos($idEmpresa, $campoVisual);
                foreach ($result as $row) {
                    $nombreCampoTabla = $row->campo;
                }
                return $nombreCampoTabla;
            }

            function jListarCamposEmpresaSubidaCursos($response, $idEmpresa)
            {
                /*
        1 = Devuelve el nombre de los campos a mostrar ordenados y separados por Obligatorios y Opcionales.
        2 = Devuelve el nombre de los campos a mostrar en un arreglo.
        3 = Devuelve el nombre de los campos en la BD en un arreglo.
    */
                $result = listarEmpresaSubidaCursos($idEmpresa);
                $arr = array();
                $i = 0;
                if ($response == 3) {
                    foreach ($result as $row) {
                        $arr[$i] = $row->campo;
                        $i++;
                    }
                    return $arr;
                } else if ($response == 2) {
                    foreach ($result as $row) {
                        $arr[$i] = $row->nombrecampoamostrar;
                        $i++;
                    }
                    return $arr;
                } else {
                    $obligatorios = "";
                    $opcionales = "";
                    foreach ($result as $row) {
                        if ($row->obligatorio == 1) {
                            $obligatorios .= "," . $row->nombrecampoamostrar;
                        } else {
                            $opcionales .= "," . $row->nombrecampoamostrar;
                        }
                    }
                    $arr = $obligatorios . "|" . $opcionales;
                    return $arr;
                }
            }

            function jValidarEmpresaSubidaCursos($idEmpresa)
            {
                $result = consultaEmpresaSubidaCursos($idEmpresa);
                //print_r($result);exit;
                //if(count($result) > 0){
                if ($result[0]->total > 0) {
                    return true;
                } else {
                    return false;
                }
            }

            function colocaNumerodeRegion($region)
            {
            }

            function ListadoLMSMallas($PRINCIPAL, $id_empresa, $id_malla, $id_programa, $rut, $url_base, $id_curso_sent)
            {
                $url_objetos = $url_base;
                if ($id_curso_sent <> "") {
                    //echo "..............hol1";
                    $id_programa_array = BuscaIdProgramadadoIdCurso($id_curso_sent, $id_empresa);
                    //print_r($id_programa_array);
                    //$id_programa=$id_programa_array[0]->id_programa;
                    $mallas = TraeMallasPorProgramaT($id_empresa, $rut, $id_curso_sent);
                } else {
                    //echo "..............hol2";
                    $mallas = TraeMallasPorProgramaEmpresaRutSinVacios($id_empresa, $id_programa, $rut);
                }
                //echo "<br>$id_empresa, $id_malla, id programa $id_programa, $rut, $url_base, $id_curso_sent";
                //$mallas=TotalMallas2($id_empresa);
                $total_mallas = "";
                $i = 1;
                $nombre_completo_usuario = "";
                if ($rut <> '') {
                    $nombre_completo = TraeNombreUsuario($rut);
                    $nombre_completo_usuario = "" . $nombre_completo[0]->nombre_completo . "";
                }
                //print_r($mallas);//$n_mallas=Cuenta_Mallas($id_empresa);
                foreach ($mallas as $unico) {
                    $row = file_get_contents("views/capacitacion/lms_malla_clas_cursos/row_listado_lms_malla.html");
                    $row = str_replace("{NUMERO}", $unico->orden, $row);
                    $i++;
                    $row = str_replace("{TOTALCURSOS}", CuentaCursosMalla($unico->id_malla, $id_empresa), $row);
                    $row = str_replace("{CODIGO_PROGRAMA}", $id_programa, $row);
                    $row = str_replace("{CODIGO_MALLA}", $unico->id_malla, $row);
                    $row = str_replace("{CODIGO_MALLA_ENCODEADO}", Encodear($unico->id_malla), $row);
                    $row = str_replace("{NOMBRE_MALLA}", $unico->nombre_malla, $row);
                    $row = str_replace("{TIPO_MALLA}", $unico->tipo, $row);
                    $row = str_replace("{DATOS_PARAMETROS}", "$nombre_completo_usuario", $row);
                    $row = str_replace("{CORREO_RESPONSABLE}", $unico->correo, $row);
                    $row = str_replace("{BTN_ORDEN}", crear_boton_orden("?sw=listcmallas", $n_mallas, $unico->orden, "tbl_malla", "orden"), $row);
                    $clasificaciones = TotalClasifSinVacios($id_empresa, $unico->id_malla);
                    $total_clasif = "";
                    $cont_cla = 1;
                    foreach ($clasificaciones as $clasif) {
                        $row_clasificacion = file_get_contents("views/capacitacion/lms_malla_clas_cursos/row_listado_lms_clasificacion.html");
                        $row_clasificacion = str_replace("{CODIGO_PROGRAMA}", $id_programa, $row_clasificacion);
                        $row_clasificacion = str_replace("{NOMBRE_CLASIFICACION}", $clasif->nombre, $row_clasificacion);
                        $row_clasificacion = str_replace("{CODIGO_CLASIFICACION}", $clasif->id_clasificacion, $row_clasificacion);
                        $row_clasificacion = str_replace("{DATOS_PARAMETROS}", "", $row_clasificacion);
                        $row_clasificacion = str_replace("{TIPO_CLASIFICACION}", "", $row_clasificacion);
                        $row_clasificacion = str_replace("{CODIGO_MALLA}", $unico->id, $row_clasificacion);
                        if ($id_curso_sent <> '') {
                            $cursos = TotalCursoSinVaciosDadoCurso($id_empresa, $unico->id_malla, $id_curso_sent);
                        } else {
                            $cursos = TotalCursoSinVacios($id_empresa, $unico->id_malla, $clasif->id_clasificacion);
                        }
                        $total_html_cursos = "";
                        //print_r($cursos);
                        foreach ($cursos as $cur) {
                            $row_curso = file_get_contents("views/capacitacion/lms_malla_clas_cursos/row_listado_lms_curso.html");
                            $row_curso = str_replace("{NOMBRE_CURSO}", $cur->nombre, $row_curso);
                            $row_curso = str_replace("{CODIGO_PROGRAMA}", $id_programa, $row_curso);
                            //echo $cur->inactivo;
                            if ($cur->inactivo === "0") {
                                $row_curso = str_replace("{DISPLAY_ACTIVA}", "style='display:none;'", $row_curso);
                                $row_curso = str_replace("{DISPLAY_DESACTIVA}", "", $row_curso);
                                $row_curso = str_replace("{DOT}", "<span class='mt-action-dot bg-green'></span>", $row_curso);
                                //echo "<br> ".$cur->id_curso." ".$cur->inactivo;
                            } elseif ($cur->inactivo == "1") {
                                $row_curso = str_replace("{DISPLAY_ACTIVA}", "", $row_curso);
                                $row_curso = str_replace("{DISPLAY_DESACTIVA}", "style='display:none;'", $row_curso);
                                $row_curso = str_replace("{DOT}", "<span class='mt-action-dot bg-red'></span>", $row_curso);
                                //echo "<br> ".$cur->id_curso." ".$cur->inactivo;
                            }
                            //    exit();
                            if ($cur->imagen <> '') {
                                $img_curso = "../front/img/" . $cur->imagen;
                                $imagencurso = "<img src='" . $img_curso . "' width='50'>";
                            } else {
                                $imagencurso = "";
                            }
                            $row_curso = str_replace("{URL_IMAGES}", $imagencurso, $row_curso);
                            $row_curso = str_replace("{CODIGO_CURSO}", $cur->id_curso, $row_curso);
                            $row_curso = str_replace("{ID_EMPRESA}", $id_empresa, $row_curso);
                            $row_curso = str_replace("{ID_CLASIFICACION}", $clasif->id_clasificacion, $row_curso);
                            $row_curso = str_replace("{ID_MALLA}", $unico->id, $row_curso);
                            $row_curso = str_replace("{TIPO_CURSO}", $cur->nombre_modalidad, $row_curso);
                            $row_curso = str_replace("{DATOS_PARAMETROS}", $cur->descripcion, $row_curso);
                            $row_curso = str_replace("{OBJETO_NOMBRE}", "", $row_curso);
                            $row_curso = str_replace("{OBJETO_DESCRIPCION}", "", $row_curso);
                            $row_curso = str_replace("{OBJETO_TITULO_CIERRE}", "", $row_curso);
                            $row_curso = str_replace("{OBJETO_TEXTO_CIERRE}", "", $row_curso);
                            //$row_curso= str_replace("{OBJETO_URL}","",$row_curso);
                            //busca siguieten id objeto y evaluacion
                            $siguienteOBJ_array = BuscaSiguienteObjeto($cur->id_curso);
                            $siguienteEva_array = BuscaSiguienteEvaluacion();
                            $max_orden = 0;
                            $max_evaluacion = 0;
                            $max_orden = $siguienteOBJ_array[0]->MaxOrden + 1;
                            $max_evaluacion = $siguienteEva_array[0]->MaxEval + 1;
                            $id_objeto_sugerido = $cur->id_curso . "m" . $max_orden;
                            $id_objeto_evaluacion = $max_evaluacion;
                            $url_archivo_sugerido = $url_objetos . "/" . $cur->id_curso . "m" . $max_orden . "";
                            ////echo "$url_archivo_sugerido=$url_objetos $cur->id_curso $max_orden";
                            if (!file_exists($carpeta)) {
                                mkdir($url_archivo_sugerido, 0777, true);
                            }
                            $row_curso = str_replace("{OBJETO_URL}", $url_archivo_sugerido, $row_curso);
                            $row_curso = str_replace("{ID_OBJETO_SUGERIDO}", $id_objeto_sugerido, $row_curso);
                            $row_curso = str_replace("{ID_OBJETO_SUGERIDO_EVALUACION}", $id_objeto_sugerido, $row_curso);
                            $row_curso = str_replace("{ID_OBJETO_EVALUACION}", $id_objeto_evaluacion, $row_curso);
                            $row_curso = str_replace("{URL_OBJETO_ARCHIVO}", $url_archivo_sugerido, $row_curso);
                            $row_curso = str_replace("{OBJETO_ORDEN}", $max_orden, $row_curso);
                            $objetos_por_curso = TraeObjetosDadoCursoEmpresa($cur->id_curso, $id_empresa);
                            $html_objetos = "";
                            foreach ($objetos_por_curso as $obj) {
                                if ($obj->tipo_objeto == "3") {
                                    $tipo = "Módulo";
                                }
                                if ($obj->tipo_objeto == "5") {
                                    $tipo = "Evaluación";
                                }
                                $url = "";

                                //Get the first character using substr.
                                $firstCharacter = substr($obj->url, 0, 4);
                                if ($firstCharacter == "http") {
                                    $url = $obj->url;

                                } else {
                                    $url = "../front/" . $obj->url . "";
                                }
                                if ($obj->preguntas_aleatorias > 0) {
                                    $preg_aleatorias = $obj->preguntas_aleatorias . " aleatorias";
                                } else {
                                    $preg_aleatorias = "Todo el Banco de Preguntas";
                                }
                                if ($obj->tipo_objeto == "3") {
                                    $url = "<a href='" . $url . "' class='btn btn-info btn-xs' target='_blank'>Ver Contenido</a>";
                                } else {
                                    $url = "";
                                }
                                if ($obj->tipo_objeto == "5") {
                                    if ($obj->idmoodle == 1) {
                                        $recalcular_txt = "SI";
                                    }
                                    if ($obj->idmoodle == 2) {
                                        $recalcular_txt = "NO";
                                    }
                                    if ($obj->urlmoodle == 1) {
                                        $distribuir_txt = "Normal";
                                    }
                                    if ($obj->urlmoodle == 2) {
                                        $distribuir_txt = "Aleatoria";
                                    }
                                    if ($obj->urlmoodle == 3) {
                                        $distribuir_txt = "Aleatoria con ultima fija";
                                    }
                                    if ($obj->linkabrir == 1) {
                                        $vernota_txt = "SI";
                                    }
                                    if ($obj->linkabrir == 2) {
                                        $vernota_txt = "NO";
                                    }
                                    if ($obj->fecha_inicio <> '') {
                                        $fecha_inicio = $obj->fecha_inicio;
                                    } else {
                                        $fecha_inicio = "";
                                    }
                                    if ($obj->hora_inicio <> '') {
                                        $hora_inicio = $obj->hora_inicio;
                                    } else {
                                        $hora_inicio = "";
                                    }
                                    if ($obj->fecha_termino <> '') {
                                        $fecha_termino = $obj->fecha_termino;
                                    } else {
                                        $fecha_termino = "";
                                    }
                                    if ($obj->hora_termino <> '') {
                                        $hora_termino = $obj->hora_termino;
                                    } else {
                                        $hora_termino = "";
                                    }
                                    $activacion = "";
                                    if ($fecha_inicio == '' and $hora_inicio == '') {
                                        $activacion = " Activo todo el tiempo";
                                    }
                                    if ($obj->fecha_termino == '' and $obj->hora_termino == '') {
                                        $desactivacion = "";
                                    }

                                    $url = "
                                        <span class='mt-action-dot bg-green'></span> ID_Evaluacion: " . $obj->id_evaluacion . "
                                        <br><span class='mt-action-dot bg-green'></span> Banco Preguntas: " . $obj->numpreg . "
                                        <br><span class='mt-action-dot bg-green'></span> Preguntas Validas: " . $obj->numpregValidas . "
                                        <br><span class='mt-action-dot bg-green'></span> Preguntas a Realizar: " . $preg_aleatorias . "



                                        <br><span class='mt-action-dot bg-green'></span> Nota Aprobaci&oacute;n: " . $obj->nota_aprobacion . "%
                                        <br><span class='mt-action-dot bg-green'></span> Intentos: " . $obj->intentos_trivia . "
                                        <br><span class='mt-action-dot bg-green'></span> Recalculo notas: " . $recalcular_txt . "
                                        <br><span class='mt-action-dot bg-green'></span> Distribuci&oacute;n opciones: " . $distribuir_txt . "
                                        <br><span class='mt-action-dot bg-green'></span> Ver nota al terminar: " . $vernota_txt . "
                                        <br><span class='mt-action-dot bg-green'></span> Duraci&oacute;n: " . $obj->currentorg . "
                                        <br><span class='mt-action-dot bg-green'></span> Activaci&oacute;n: " . $fecha_inicio . " " . $hora_inicio . "" . $activacion . "
                                         " . $fecha_termino . " " . $hora_termino . "";
                                }
                                //echo $obj->tipo_objeto." - ".$obj->id."<br>";
                                $row_objetos = file_get_contents("views/capacitacion/lms_malla_clas_cursos/row_listado_lms_objeto.html");
                                if ($obj->tipo_objeto == "3") {
                                    $row_objetos = str_replace("{DATA_TARGET_EDITA_MODULO}", "Edita_{CODIGO_OBJETO}", $row_objetos);
                                } else if ($obj->tipo_objeto == "5") {
                                    $row_objetos = str_replace("{DATA_TARGET_EDITA_MODULO}", "Edita_Eval_{CODIGO_OBJETO}", $row_objetos);
                                }
                                //Replaces para el EDITAR
                                $row_objetos = str_replace("{NOMBRE_OBJETO}", $obj->titulo, $row_objetos);
                                $row_objetos = str_replace("{DESCRIPCION_OBJETO}", $obj->descripcion, $row_objetos);
                                $row_objetos = str_replace("{VALUE_NUMERO_INTENTO_" . $obj->intentos_trivia . "}", "selected='selected'", $row_objetos);
                                $row_objetos = str_replace("{PREGUNTAS_ALEATORIAS}", $obj->preguntas_aleatorias, $row_objetos);
                                $row_objetos = str_replace("{NOTA_APROBACION}", $obj->nota_aprobacion, $row_objetos);
                                $row_objetos = str_replace("{DURACION_VIDEO_EDIT}", $obj->duracion_video, $row_objetos);
                                $row_objetos = str_replace("{TIEMPO_TOTAL}", $obj->currentorg, $row_objetos);
                                $row_objetos = str_replace("{FECHA_INICIO}", $obj->fecha_inicio, $row_objetos);
                                $row_objetos = str_replace("{FECHA_TERMINO}", $obj->fecha_termino, $row_objetos);
                                $row_objetos = str_replace("{HORA_INICIO}", $obj->hora_inicio, $row_objetos);
                                $row_objetos = str_replace("{HORA_TERMINO}", $obj->hora_termino, $row_objetos);
                                $row_objetos = str_replace("{OBJETO_TITULO_CIERRE}", $obj->titulo_principal, $row_objetos);
                                $row_objetos = str_replace("{OBJETO_TEXTO_CIERRE}", $obj->bajada_principal, $row_objetos);
                                $row_objetos = str_replace("{ID_MALLA}", $unico->id, $row_objetos);
                                $row_objetos = str_replace("{CODIGO_CURSO}", $obj->id_curso, $row_objetos);
                                $row_objetos = str_replace("{CODIGO_PROGRAMA}", $id_programa, $row_objetos);
                                $row_objetos = str_replace("{SELECTED_" . $obj->tipo_objeto . "-" . $obj->extension_objeto . "}", "selected='selected'", $row_objetos);
                                $row_objetos = str_replace("{DATOS_PARAMETROS_OBJETO}", "" . $url, $row_objetos);
                                $row_objetos = str_replace("{CODIGO_OBJETO}", $obj->id, $row_objetos);
                                $row_objetos = str_replace("{TIPO_OBJETO_txt}", utf8_decode($tipo), $row_objetos);
                                $row_objetos = str_replace("{ORDEN_OBJETO}", $obj->orden, $row_objetos);
                                $row_objetos = str_replace("{TIPO_OBJETO}", $obj->n, $row_objetos);
                                $row_objetos = str_replace("{RUT}", $rut, $row_objetos);
                                $row_objetos = str_replace("{ID_OBJETO}", $obj->id, $row_objetos);
                                if ($rut) {
                                    $row_objetos = str_replace("{ACCION2}", "", $row_objetos);
                                    //Verifico si este objeto eta o no finalizado
                                    $objeto_finalizado = ObjetoFinalizadoDadoIdYRut($rut, $obj->id);
                                    if ($objeto_finalizado) {
                                        $row_objetos = str_replace("{ACCION}", file_get_contents("views/capacitacion/lms_malla_clas_cursos/row_aprobado.html"), $row_objetos);
                                        if ($objeto_finalizado[0]->nota === 0 or $objeto_finalizado[0]->nota > 0) {
                                            $row_objetos = str_replace("{NOTA}", "<span class='label label-sm label-warning lms_text_white_sm'>Nota: " . $objeto_finalizado[0]->nota . "%</span>", $row_objetos);
                                            $row_objetos = str_replace("{RESETEAR}", "<span id='bloqueResetear_{ID_OBJETO}_{RUT}'><span onclick='Resetear_Eval{ID_OBJETO}_{RUT}();'
                            class='btn btn-danger btn-sm'>Resetear Evaluaci&oacute;n</span></span><br><br>", $row_objetos);
                                        } else {
                                            $row_objetos = str_replace("{NOTA}", "", $row_objetos);
                                            $row_objetos = str_replace("{RESETEAR}", "", $row_objetos);
                                        }
                                    } else {
                                        $row_objetos = str_replace("{ACCION}", file_get_contents("views/capacitacion/lms_malla_clas_cursos/row_pendiente.html"), $row_objetos);
                                    }
                                } else {
                                    $row_objetos = str_replace("{ACCION}", "", $row_objetos);
                                }
                                $row_objetos = str_replace("{RUT}", $rut, $row_objetos);
                                $row_objetos = str_replace("{ID_OBJETO}", $obj->id, $row_objetos);
                                $row_objetos = str_replace("{NOMBRE_OBJETO}", $obj->titulo, $row_objetos);
                                $row_objetos = str_replace("{TIPO_OBJETO}", $obj->nombre, $row_objetos);
                                if ($obj->tipo_objeto == "5") {
                                    if ($obj->id_evaluacion) {
                                        $row_objetos = str_replace("{ACCION2}", "<a href='?sw=viewEval&idEval=" . $obj->id_evaluacion . "&programa=" . $id_programa . "' class='btn btn-primary btn-xs'>Gestionar Banco Preguntas</a><br>", $row_objetos);
                                        $row_objetos = str_replace("{ACCION3}", "
                            <a href='?sw=Download_Respuestas_Eval&idEval=" . $obj->id_evaluacion . "&ido=" . Encodear3($obj->id) . "&idc=" . Encodear3($obj->id_curso) . "' class='btn btn-link btn-sm'>Descargar Respuestas</a> <br>
                            <a href='?sw=ActualizarNotasEval&idEval=" . $obj->id_evaluacion . "&ido=" . Encodear3($obj->id) . "&idc=" . Encodear3($obj->id_curso) . "' class='btn btn-link btn-sm'>ReCalcular Nota</a>
                            ", $row_objetos);
                                        $row_objetos = str_replace("{ACCION4}", "", $row_objetos);
                                    } else {
//no tiene evaluacion
                                        $row_objetos = str_replace("{ACCION2}", "", $row_objetos);
                                        $row_objetos = str_replace("{ACCION3}", "", $row_objetos);
                                        $arreglo_evaluaciones = BuscaEvaluaciones($id_empresa);
                                        foreach ($arreglo_evaluaciones as $arreglo_evaluacion) {
                                            $opcion_evaluaciones .= "<option value='" . $arreglo_evaluacion->id . "'>(" . $arreglo_evaluacion->id . ") " . $arreglo_evaluacion->nombre_evaluacion . "</option>";
                                        }
                                        $row_objetos = str_replace("{ACCION4}", "
<form class='form-horizontal' method='POST' name='UpdateEvaluacion' id='UpdateEvaluacion' action='?sw=vista_mallas_clasificaciones_cursos_objetos&programa=" . $id_programa . "&id_objeto=" . $obj->id . "'>
<select name='id_evaluacion' id='id_evaluacion' class='form-control'>" . $opcion_evaluaciones . "</select>
<button type='submit' class='btn btn-primary btn-xs'>Asignar Banco Preguntas</button></form>
", $row_objetos);
                                    }
                                    $row_objetos = str_replace("{ACCION5}", "
<button type='button' class='btn btn-link btn-sm'
        data-toggle='modal'
        data-id_malla='{ID_MALLA}'
        data-target='#EliminarPreg_{ID_OBJETO}'>
            Eliminar Pregunta
</button>
                        ", $row_objetos);
//busco Preguntas de Evaluacion
                                    $arreglo_preguntas_objeto = BuscaPreguntasDadaEvaluacion($obj->id_evaluacion, $id_empresa);
//print_r($arreglo_preguntas_objeto);
                                    foreach ($arreglo_preguntas_objeto as $preguntaunica) {
                                        $options_preguntas .= "<option selected value='" . $preguntaunica->id . "'>" . ($preguntaunica->pregunta) . "</option>";
                                    }
                                    $row_objetos = str_replace("{OPTION_PREGUNTAS_DE_OBJETO}", $options_preguntas, $row_objetos);
                                    $row_objetos = str_replace("{ID_EVALUACION_OBJETO}", $obj->id_evaluacion, $row_objetos);
                                } else {
                                    $row_objetos = str_replace("{ACCION2}", "", $row_objetos);
                                    $row_objetos = str_replace("{ACCION3}", "", $row_objetos);
                                    $row_objetos = str_replace("{ACCION4}", "", $row_objetos);
                                    $row_objetos = str_replace("{ACCION5}", "", $row_objetos);
                                }
                                $row_objetos = str_replace("{RUT}", $rut, $row_objetos);
                                $row_objetos = str_replace("{ID_OBJETO}", $obj->id, $row_objetos);
                                $html_objetos .= $row_objetos;
                            }
                            $row_curso = str_replace("{CANTIDAD_OBJETOS}", count($objetos_por_curso), $row_curso);
                            $row_curso = str_replace("{ROW_LISTADO_OBJETOS}", $html_objetos, $row_curso);
                            $total_html_cursos .= $row_curso;
                        }
                        $row_clasificacion = str_replace("{CANTIDAD_CURSOS}", count($cursos), $row_clasificacion);
                        $row_clasificacion = str_replace("{ROW_CURSOS_POR_CLASIFICACION}", $total_html_cursos, $row_clasificacion);
                        $total_clasif .= $row_clasificacion;
                    }
                    $row = str_replace("{ROW_LISTADO_CLASIFICACION_POR_MALLA}", $total_clasif, $row);
                    $total_mallas .= $row;
                }
                if ($mallas) {
                    $PRINCIPAL = str_replace("{ROW_LISTADO_MALLAS}", utf8_encode($total_mallas), $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{ROW_LISTADO_MALLAS}", "", $PRINCIPAL);
                }
                $mallas = TraeMallasEmpresa($id_empresa);
                foreach ($mallas as $malla) {
                    if ($id_malla == $malla->id) {
                        $option_mallas .= '<option selected value="' . $malla->id . '">' . $malla->nombre . '</option>';
                    } else {
                        $option_mallas .= '<option value="' . $malla->id . '">' . $malla->nombre . '</option>';
                    }
                }
                $programas = TraeProgramasBBDDPorEmpresaElearning($id_empresa);
                //print_r($programas);
                foreach ($programas as $programa) {
                    if ($id_programa == $programa->id_programa) {
                        $option_programas .= '<option selected value="' . $programa->id_programa . '">' . $programa->nombre_programa . '</option>';
                    } else {
                        $option_programas .= '<option value="' . $programa->id_programa . '">' . $programa->nombre_programa . '</option>';
                    }
                }
//busca id malla sugerido
                $malla_orden = 1;
//check
                $existeMalla = 1;
                while ($existeMalla >= 1) {
                    //Aumentamos $i en uno
                    $id_malla_sugerido = $id_programa . "m" . $malla_orden;
                    $existeMalla = VerSiExisteMalla($id_malla_sugerido);
                    if ($existeMalla >= 1) {
                        $malla_orden++;
                    }
                }
                $id_malla_sugerido = $id_programa . "m" . $malla_orden;
                $PRINCIPAL = str_replace("{CODIGO_PROGRAMA}", $id_programa, $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_MALLA_SUGERIDO}", $id_malla_sugerido, $PRINCIPAL);
                $ArregloMallas = BuscaMallaPrograma($id_programa, $id_empresa);
                foreach ($ArregloMallas as $ArregloMalla) {
                    $opcion_mallas_de_programa .= "<option value='" . $ArregloMalla->id_malla . "'> " . utf8_encode($ArregloMalla->malla) . "  (" . $ArregloMalla->id_malla . ")</option>";
                }
                $ArregloClasificaciones = BuscaClasificacionPrograma($id_programa, $id_empresa);
                foreach ($ArregloClasificaciones as $ArregloClasificacion) {
                    $opcion_clasificacion_de_programa .= "<option value='" . $ArregloClasificacion->id_clasificacion . "'> " . utf8_encode($ArregloClasificacion->clasificacion) . "  (" . $ArregloClasificacion->id_clasificacion . ")</option>";
                }
                $ArregloCursos = BuscaCursoPrograma($id_programa, $id_empresa);
                foreach ($ArregloCursos as $ArregloCurso) {
                    $opcion_cursos_de_programa .= "<option value='" . $ArregloCurso->id_curso . "'> " . utf8_encode($ArregloCurso->curso) . "  (" . $ArregloCurso->id_curso . ")</option>";
                }
// Mallas, Clasificaciones, Cursos
                $PRINCIPAL = str_replace("{SELECT_MALLAS}", "
<select name='id_malla' id='id_malla' class='form-control'>" . $opcion_mallas_de_programa . "</select>", $PRINCIPAL);
                $PRINCIPAL = str_replace("{SELECT_CLASIFICACION}", "
<select name='id_clasificacion' id='id_clasificacion' class='form-control'>" . $opcion_clasificacion_de_programa . "</select>", $PRINCIPAL);
                $PRINCIPAL = str_replace("{SELECT_CURSOS}", "
<select name='id_curso' id='id_curso' class='form-control'>" . $opcion_cursos_de_programa . "</select>", $PRINCIPAL);
                $PRINCIPAL = str_replace("{MALLAS}", utf8_encode($option_mallas), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PROGRAMAS_ELEARNING}", utf8_encode($option_programas), $PRINCIPAL);
                $PRINCIPAL = str_replace("{RUT_COLABORADOR}", $rut, $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function IngresaDatosAMoodle($rut, $nombre, $apellido, $email)
            {
                $link2 = mysql_connect("gopartners.cl", "gopartne_moodle", "GMknehSNTpSR");
                mysql_select_db("gopartne_moodle26", $link2);
                $inserta_registro_mdl_user = "insert into mdl_user(confirmed, mnethostid, username, firstname, lastname,
        email, city, country, lang)
    value('1', '1', '$rut',  '$nombre', '$apellido', '$email', 'Valparaiso', 'CL', 'es')";
                //echo $inserta_registro_mdl_user;exit;
                $result = mysql_query($inserta_registro_mdl_user, $link2);
                $sql4 = "select max(id) as ultimo_id  from mdl_user ";
                $result4 = mysql_query($sql4, $link2);
                while ($row = mysql_fetch_array($result4)) {
                    $ultimo_id = $row['ultimo_id'];
                }
                //echo $ultimo_id;exit;
                //Con el id del usuario, actualizo el id usuario de moodle en la tabla_usuario
                ActualizaIdMoodleDeTablaUsuario($rut, $ultimo_id);
                $inserta_relacion_curso_usuario = "insert into mdl_user_enrolments(
        status, enrolid, userid ,timestart, timeend, modifierid, timecreated, timemodified)
    value('0', '25', '$ultimo_id', '1470027600', '0', '2', '1470063706', '1470063706'
)";
                $result = mysql_query($inserta_relacion_curso_usuario, $link2);
                $inserta_md_role_asignemt = "insert mdl_role_assignments(
        roleid, contextid, userid, timemodified, modifierid, component ,itemid, sortorder)
    value('5', '79', '$ultimo_id', '1470625354', '2','', '0', '0'
)";
                $result = mysql_query($inserta_md_role_asignemt, $link2);
                //return($id_usuario_moodle);
            }

            function ColocaCamposParaFormulario($PRINCIPAL, $id_empresa, $tipo)
            {
                $campos_por_empresa = listarEmpresaSubidaUsuarios($id_empresa);
                $acumulador_input_obligatorios = "";
                $acumulador_input_opcional = "";
                if ($tipo == "editar") {
                    $html_input = file_get_contents("views/basepersonas/input_edita.html");
                } else if ($tipo == "ingresar") {
                    $html_input = file_get_contents("views/basepersonas/input_ingresa.html");
                }
                foreach ($campos_por_empresa as $unico) {
                    if ($unico->obligatorio == 0) {
                        $acumulador_input_opcional .= $html_input;
                        $acumulador_input_opcional = str_replace("{REQUIRED}", "", $acumulador_input_opcional);
                        $acumulador_input_opcional = str_replace("{NOMBRE_MOSTRAR}", utf8_encode($unico->nombrecampoamostrar), $acumulador_input_opcional);
                        $acumulador_input_opcional = str_replace("{NOMBRE_INPUT}", $unico->campo, $acumulador_input_opcional);
                        $acumulador_input_opcional = str_replace("{PLACEHOLDER}", "Ingrese los datos", $acumulador_input_opcional);
                        $acumulador_input_opcional = str_replace("{VALUE_INPUT}", $unico->etiquetaparaeditar, $acumulador_input_opcional);
                        if ($unico->sololectura == 1) {
                            $acumulador_input_opcional = str_replace("{READONLY_INPUT}", "readonly", $acumulador_input_opcional);
                        } else {
                            $acumulador_input_opcional = str_replace("{READONLY_INPUT}", "", $acumulador_input_opcional);
                        }
                    } else if ($unico->obligatorio == 1) {
                        $acumulador_input_obligatorios .= $html_input;
                        $acumulador_input_obligatorios = str_replace("{REQUIRED}", "required", $acumulador_input_obligatorios);
                        $acumulador_input_obligatorios = str_replace("{NOMBRE_MOSTRAR}", utf8_encode($unico->nombrecampoamostrar), $acumulador_input_obligatorios);
                        $acumulador_input_obligatorios = str_replace("{NOMBRE_INPUT}", $unico->campo, $acumulador_input_obligatorios);
                        $acumulador_input_obligatorios = str_replace("{PLACEHOLDER}", "Ingrese los datos", $acumulador_input_obligatorios);
                        $acumulador_input_obligatorios = str_replace("{VALUE_INPUT}", $unico->etiquetaparaeditar, $acumulador_input_obligatorios);
                        if ($unico->sololectura == 1) {
                            $acumulador_input_obligatorios = str_replace("{READONLY_INPUT}", "readonly", $acumulador_input_obligatorios);
                        } else {
                            $acumulador_input_obligatorios = str_replace("{READONLY_INPUT}", "", $acumulador_input_obligatorios);
                        }
                    }
                }
                $PRINCIPAL = str_replace("{LISTADO_CAMPOS_OBLIGATORIOS}", $acumulador_input_obligatorios, $PRINCIPAL);
                $PRINCIPAL = str_replace("{LISTADO_CAMPOS_OPCIONALES}", $acumulador_input_opcional, $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function EstadoRetroAlimentacion($evaluado, $evaluador, $id_proceso)
            {
                $feedback = VerificoFeedbackSGD($evaluado, $evaluador, $id_proceso);
                if ($feedback[0]->realizado) {
                    if ($feedback[0]->realizado == "si") {
                        $arreglo[0] = '<span class="etiqueta  label-success">Si</span>';
                    } else if ($feedback[0]->realizado == "no") {
                        $arreglo[0] = '<span class="etiqueta  label-danger">No</span>';
                    }
                } else {
                    $arreglo[0] = '<span class="etiqueta  label-proceso">Pendiente</span>';
                }
                return ($arreglo);
            }

            function ListadoDetalleEstados($PRINCIPAL, $arreglo_post, $pagina, $tipo_listado, $id_proceso, $rut_evaluador, $excel, $campo_criterio, $criterio, $valor_criterio)
            {
                //Traigo el total de empresas que existen en el sistema
                //Con la variable tipo usuario, veo si es para el listado de usuarios, o para el listado de envio de correos.
                $datos_proceso = TraeProcesosDeEvaluacionPorIDProceso($id_proceso);
                $id_empresa = $_SESSION["id_empresa"];
                $datos_empresa = DatosEmpresa($id_empresa);
                if ($arreglo_post["n_registros"]) {
                    $usuarios_por_pagina = $arreglo_post["n_registros"];
                } else {
                    $usuarios_por_pagina = 200;
                }
                if (!$pagina) {
                    $pagina = 1;
                }
                //$usuarios=TotalUsuarios($arreglo_post, $_SESSION["id_empresa"], $pagina, $usuarios_por_pagina);
                //$usuarios=SelectParaPaginacionUsuario("tbl_usuario", $_SESSION["id_empresa"], $usuarios_por_pagina);
                $campos_para_reporte = CamposParaReporte("veRelacionesPorPoceso", $_SESSION["id_empresa"]);
                $campos_para_reporte_datos_evaluador = CamposParaReporte("veEvaluadorPorProceso", $_SESSION["id_empresa"]);
                $PRINCIPAL = str_replace("{NOMBRE_PROCESO}", utf8_encode($datos_proceso[0]->descripcion_proceso), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_PROCESO_ANUAL}", Encodear3($datos_proceso[0]->id_proceso_anual), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_PROCESO}", Encodear3($id_proceso), $PRINCIPAL);
                //$usuarios=DatosParaListadoPaginado("tbl_sgd_proceso_anual", $_SESSION["id_empresa"], $usuarios_por_pagina, $pagina, $arreglo_post);
                //$usuarios=TraeRelacionesPorProceso($id_proceso, $usuarios_por_pagina, $pagina, $arreglo_post, $rut_evaluador);
                $usuarios = TraeRelacionesPorProceso($id_proceso, $usuarios_por_pagina, $pagina, $arreglo_post, $rut_evaluador, $campo_criterio, $criterio, $valor_criterio, $campos_para_reporte, $campos_para_reporte_datos_evaluador, $datos_empresa);
                //$PRINCIPAL = str_replace("{PAGINACION}",ArmaPaginacionGenerico($pagina, "veRelacionesPorPoceso&i=".Encodear3($id_proceso), "tbl_sgd_relaciones", $usuarios_por_pagina, $arreglo_post, $_SESSION["id_empresa"], $id_proceso, "", $rut_evaluador),$PRINCIPAL);
                $PRINCIPAL = str_replace("{PAGINACION}", "", $PRINCIPAL);
                $total_empresas = "";
                if ($excel == 1) {
                    $html_row = file_get_contents("views/procesos/reportes/28_row_listado_relaciones_estados_excel.html");
                } else {
                    $html_row = file_get_contents("views/procesos/reportes/28_row_listado_relaciones_estados.html");
                }
                $i = 1;
                $valor_campo_criterio = "";
                foreach ($usuarios as $unico) {
                    $row = $html_row;
                    if ($pagina == 1) {
                        $row = str_replace("{N}", $i, $row);
                    } else {
                        $row = str_replace("{N}", $i + (($pagina - 1) * $usuarios_por_pagina), $row);
                    }
                    $i++;
                    $row = str_replace("{FOTO_EVALUADO}", VerificaFotoPersonalDesdeAdmin($unico->evaluado), $row);
                    $row = str_replace("{FOTO_EVALUADOR}", VerificaFotoPersonalDesdeAdmin($unico->evaluador), $row);
                    $row = str_replace("{RUT_EVALUADO}", $unico->rut_completo_evaluado, $row);
                    $row = str_replace("{RUT_EVALUADOR}", $unico->rut_completo_evaluador, $row);
                    $row = str_replace("{CAMPO1}", $unico->campo1, $row);
                    $row = str_replace("{CAMPO2}", $unico->campo2, $row);
                    $row = str_replace("{CAMPO3}", $unico->campo3, $row);
                    $row = str_replace("{CAMPO1_EVALUADOR}", $unico->campo1_evaluador, $row);
                    $row = str_replace("{CAMPO2_EVALUADOR}", $unico->campo2_evaluador, $row);
                    $row = str_replace("{CAMPO3_EVALUADOR}", $unico->campo3_evaluador, $row);
                    $row = str_replace("{NOMBRE_EVALUADO}", $unico->nombre_evaluado, $row);
                    $row = str_replace("{NOMBRE_EVALUADOR}", $unico->nombre_evaluador, $row);
                    $row = str_replace("{CARGO_EVALUADOR}", $unico->cargo_evaluador, $row);
                    $row = str_replace("{CARGO_EVALUADO}", $unico->cargo_evaluado, $row);
                    $row = str_replace("{GERENCIA_EVALUADOR}", $unico->gerencia_evaluador, $row);
                    $row = str_replace("{GERENCIA_EVALUADO}", $unico->gerencia_evaluado, $row);
                    $row = str_replace("{EMPRESA_EVALUADOR}", $unico->nombre_empresa_evaluador, $row);
                    $row = str_replace("{EMPRESA_EVALUADO}", $unico->nombre_empresa_evaluado, $row);
                    $row = str_replace("{PERFIL_EVALUACION}", $unico->nombre_perfil, $row);
                    $row = str_replace("{SUBPERFIL_EVALUACION}", $unico->nombre_sub_perfil, $row);
                    $row = str_replace("{ID_REGISTRO_FINALIZADO_EVALUADO_EVALUADOR}", Encodear3($unico->id_registro_finalizado), $row);
                    $row = str_replace("{ID_PROCESO_ENCODEADO}", Encodear3($id_proceso), $row);
                    if ($_SESSION["id_empresa"] == 43) {
                        $estado_evaluacion = ObtenerEstadoEvalDadoEvaluadoEvaluadorProceso($unico->evaluado, $unico->evaluador, $id_proceso, "turbus");
                    } else if ($_SESSION["id_empresa"] == 28) {
                        $estado_evaluacion = ObtenerEstadoEvalDadoEvaluadoEvaluadorProceso($unico->evaluado, $unico->evaluador, $id_proceso, "chilquinta");
                    } else {
                        $estado_evaluacion = ObtenerEstadoEvalDadoEvaluadoEvaluadorProceso($unico->evaluado, $unico->evaluador, $id_proceso, "");
                    }
                    $row = str_replace("{ESTADO_EVALUACION}", $estado_evaluacion[0], $row);
                    $retroalimentacion = EstadoRetroAlimentacion($unico->evaluado, $unico->evaluador, $id_proceso);
                    $row = str_replace("{RETRO_SI_NO}", $retroalimentacion[0], $row);
                    //$row = str_replace("{TOTAL_FINALIZADOS}",ColocaEtiquetaReportesSGD($unico->total_finalizados, $unico->total_evaluados),$row);
                    if (!$campo_criterio) {
                        $porcentaje_Avance_evaluado_evaluador = AvanceDeEvaluados($unico->evaluador, $id_proceso, "", "", "", $unico->evaluado);
                        $row = str_replace("{PORCENTAJE_AVANCE}", ColocarColoresConPorcentaje($porcentaje_Avance_evaluado_evaluador[0]), $row);
                    }
                    $row = str_replace("{ID_PROCESO_ANUAL_ENCODEADO}", Encodear3($unico->id), $row);
                    $row = str_replace("{ANO}", $unico->ano, $row);
                    if ($estado_evaluacion[1] == 3) {
                        $row = ArmaTemplareDeTablaResumen($row, "2015", $_SESSION["id_empresa"], $unico->perfil_evaluacion, $unico->evaluado, $unico->evaluador, "no");
                    } else {
                        $row = str_replace("{NOTA_FINAL}", "", $row);
                    }
                    $total_empresas .= $row;
                }
                if ($excel == 1) {
                    $PRINCIPAL = str_replace("{ROW_LISTADO_USUARIOS}", ($total_empresas), $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{ROW_LISTADO_USUARIOS}", utf8_encode($total_empresas), $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function SuboArchivoDoc($FILES, $extension_doc, $prefijo, $ruta, $numero)
            {
                //echo "$extension_archivo, $prefijo, $ruta";exit;
                //$ruta_con_archivo=$ruta."/".$prefijo."_BK.".$extension_archivo;
                $ruta_con_archivo = $ruta . "/" . $prefijo . "." . $extension_doc;
                copy($FILES['doc' . $numero]['tmp_name'], $ruta_con_archivo);
                $nombre_imagen_video = $prefijo . "." . $extension_doc;
                //RedimensionarImagenSlider($ruta_con_archivo, $nombre_imagen_slider);
                //Devuelvol un arreglo, con datos del archivo subido
                $arreglo[0] = $ruta_con_archivo;//Ruta Completa
                $arreglo[1] = $prefijo . "." . $extension_doc;//Nombre del Archivo
                $arreglo[2] = $ruta . "/" . $prefijo;//Ruta del Objeto sin el index
                return ($arreglo);
            }

            function SuboArchivoVideo($FILES, $extension_video, $prefijo, $ruta)
            {
                $extension_video = "mp4";
                //echo "$extension_archivo, $prefijo, $ruta";exit;
                //$ruta_con_archivo=$ruta."/".$prefijo."_BK.".$extension_archivo;
                $ruta_con_archivo = $ruta . "/" . $prefijo . ".mp4";
                copy($FILES['video_not']['tmp_name'], $ruta_con_archivo);
                $nombre_imagen_video = $prefijo . "." . $extension_archivo;
                //RedimensionarImagenSlider($ruta_con_archivo, $nombre_imagen_slider);
                //Devuelvol un arreglo, con datos del archivo subido
                $arreglo[0] = $ruta_con_archivo;//Ruta Completa
                $arreglo[1] = $prefijo . ".mp4";//Nombre del Archivo
                $arreglo[2] = $ruta . "/" . $prefijo;//Ruta del Objeto sin el index
                return ($arreglo);
            }

            function FormularioPagina($PRINCIPAL, $id_pagina)
            {
                $id_empresa = $_SESSION["id_empresa"];
                $datos_pagina = TraigoTotalPaginasPorEmpresaDetalle($id_pagina);
                //echo $datos_noticia[0]->contenido;
                $PRINCIPAL = str_replace("{CONTENIDO}", htmlentities($datos_pagina[0]->contenido), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_PAGINA}", Encodear3($id_pagina), $PRINCIPAL);
                if ($id_noticia) {
                    $PRINCIPAL = str_replace("{VALOR_BOTON}", "Editar", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ACTION}", "ednot", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ID_NOTICIA}", $id_noticia, $PRINCIPAL);
                    $PRINCIPAL = str_replace("{PORTADA}", "<img id='imgSalida' style='max-width:100%;' src='" . imagen_existe_portada($portada) . "' />", $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{VALOR_BOTON}", "Ingresar", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ACTION}", "adnot", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ID_NOTICIA}", '', $PRINCIPAL);
                    $PRINCIPAL = str_replace("{PORTADA}", "<img id='imgSalida' style='display:none;' src='' />", $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function ListadoPaginasParaAdmin($PRINCIPAL, $id_empresa)
            {
                $tnoticias = TraigoTotalPaginasPorEmpresa($id_empresa);
                //print_r($tnoticias);
                $total_noticias = "";
                $i = 1;
                $likes = "";
                $row = "";
                foreach ($tnoticias as $tnoti) {
                    $row = file_get_contents("views/paginas/row_listado.html");
                    $row = str_replace("{NUMERO}", $i, $row);
                    $i++;
                    $likes = cuenta_likes($tnoti->id);
                    //trae categoria
                    $lacategoria = UnaCategoria($tnoti->categoria);
                    //todos los campos
                    //$row = str_replace("{ID}",$tnoti->id,$row);
                    $row = str_replace("{NOMBRE}", ($tnoti->nombre_pagina), $row);
                    $row = str_replace("{DESCRIPCION}", ($tnoti->descriopcio), $row);
                    $row = str_replace("{ID}", Encodear3($tnoti->id), $row);
                    if ($tnoti->estado == '0') {
                        $row = str_replace("{BGCOLOR}", 'bgcolor="#F3F3F3"', $row);
                    } else {
                        $row = str_replace("{BGCOLOR}", 'bgcolor="#FFFFFF"', $row);
                    }
                    $total_noticias .= $row;
                }
                $PRINCIPAL = str_replace("{ROW_LISTADO_NOTICIAS}", $total_noticias, $PRINCIPAL);
                $PRINCIPAL = str_replace("{N_NOTICIAS}", CuentaNoticias($id_empresa), $PRINCIPAL);
                $PRINCIPAL = str_replace("{N_MEGUSTA}", cuenta_likes_noticias($id_empresa), $PRINCIPAL);
                $PRINCIPAL = str_replace("{N_COMENTARIOS}", CuentaComentarios($id_empresa), $PRINCIPAL);
                $PRINCIPAL = str_replace("{N_VISITAS}", cuenta_visitas_noticias($id_empresa), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_EMPRESA_ENCODEADO}", Encodear3($id_empresa), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function ReporteCapacitacionObjetos($PRINCIPAL, $id_empresa, $arreglo_post, $excel)
            {
                $tipo_de_reporte = "detallado";
                $datos_empresa = DatosEmpresa($id_empresa);
                $campo1 = $datos_empresa[0]->campo1;
                $campo2 = $datos_empresa[0]->campo2;
                $campo3 = $datos_empresa[0]->campo3;
                $id_objeto = $arreglo_post["objetos"];
                $mallas = TraeMallasEmpresa($id_empresa);
                foreach ($mallas as $malla) {
                    if ($arreglo_post["malla"] == $malla->id) {
                        $option_mallas .= '<option selected value="' . $malla->id . '">' . $malla->nombre . '</option>';
                    } else {
                        $option_mallas .= '<option value="' . $malla->id . '">' . $malla->nombre . '</option>';
                    }
                }
                //$cursos=TraeCursos("0",$id_empresa);
                $cursos = TraeCursos("0", $id_empresa);
                //$cursos=TraeCursos($arreglo_post["malla"],$id_empresa);
                $option_cursos = "";
                foreach ($cursos as $curso) {
                    if ($arreglo_post["curso"] == $curso->id) {
                        $option_cursos .= '<option value="' . $curso->id . '" selected>' . $curso->nombre . '</option>';
                    } else {
                        $option_cursos .= '<option value="' . $curso->id . '">' . $curso->nombre . '</option>';
                    }
                }
                $objetos = TraeObjetos($arreglo_post["curso"], $id_empresa);
                foreach ($objetos as $objeto) {
                    if ($arreglo_post["objetos"] == $objeto->id) {
                        $option_objetos .= '<option selected="selected" value="' . $objeto->id . '">' . $objeto->titulo . '</option>';
                    } else {
                        $option_objetos .= '<option value="' . $objeto->id . '">' . $objeto->titulo . '</option>';
                    }
                }
                $PRINCIPAL = str_replace("{MALLAS}", utf8_encode($option_mallas), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CURSOS}", utf8_encode($option_cursos), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OBJETOS}", utf8_encode($option_objetos), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_EMPRSA}", $id_empresa, $PRINCIPAL);
                //Traigo a todos los usuarios de esta empresa
                $usuarios_con_datos = TraigoUsuarioXObjetos($id_empresa, $campo1, $campo2, $campo3, $arreglo_post);
                if ($excel == 1) {
                    $row_html = file_get_contents("views/reportes/objetos/row_reporte_usuario_x_objetos_excel.html");
                } else {
                    $row_html = file_get_contents("views/reportes/objetos/row_reporte_usuario_x_objetos.html");
                }
                $i = 1;
                foreach ($usuarios_con_datos as $usu) {
                    $row = $row_html;
                    $row = str_replace("{NUM}", $i, $row);
                    $i++;
                    $row = str_replace("{RUT_COMPLETO_EVALUADO}", $usu->rut_completo, $row);
                    $row = str_replace("{NOMBRE_COMPLETO}", $usu->nombre_completo, $row);
                    $row = str_replace("{CAMPO1}", $usu->campo1_usuario, $row);
                    $row = str_replace("{CAMPO2}", $usu->campo2_usuario, $row);
                    $row = str_replace("{CAMPO3}", $usu->campo3_usuario, $row);
                    $row = str_replace("{CARGO}", $usu->cargo, $row);
                    $row = str_replace("{EMAIL}", $usu->email, $row);
                    $row = str_replace("{FOTO}", VerificaFotoPersonalDesdeAdmin($unico->rut), $row);
                    $row = str_replace("{IDMALLA}", $usu->id_malla, $row);
                    $row = str_replace("{MALLA}", $usu->nombre_malla, $row);
                    $row = str_replace("{IDCURSO}", $usu->id_curso, $row);
                    $row = str_replace("{CURSO}", $usu->nombre_curso, $row);
                    $row = str_replace("{IDOBJETO}", $usu->id_objeto, $row);
                    $row = str_replace("{OBJETO}", $usu->nombre_objeto, $row);
                    if ($usu->fecha_finalizacion_modulo) {
                        $row = str_replace("{ESTADO}", '<span class="etiqueta  label-success">Finalizado</span>', $row);
                        $row = str_replace("{PORCENTAJE_AVANCE}", ColocarColoresConPorcentaje(100), $row);
                    } else {
                        $row = str_replace("{ESTADO}", '<span class="etiqueta  label-proceso">Pendiente</span>', $row);
                        if ($usu->id_moodle) {
                            $datos_moodle = ObtenerDatosMoodle($usu, $HTML, $bloque, $usu->id_scorm, $usu->rut);
                            $row = str_replace("{PORCENTAJE_AVANCE}", ColocarColoresConPorcentaje($datos_moodle[0]), $row);
                        } else {
                            $row = str_replace("{PORCENTAJE_AVANCE}", ColocarColoresConPorcentaje(0), $row);
                        }
                    }
                    $total_row .= $row;
                }
                if ($excel == 1) {
                    $PRINCIPAL = str_replace("{LISTADO_USUARIOS}", ($total_row), $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{LISTADO_USUARIOS}", utf8_encode($total_row), $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function ReporteCapacitacionObjetosBK($PRINCIPAL, $id_empresa, $arreglo_post, $criterio, $excel)
            {
                $tipo_de_reporte = "detallado";
                $id_objeto = $arreglo_post["objetos"];
                $mallas = TraeMallasEmpresa($id_empresa);
                foreach ($mallas as $malla) {
                    if ($arreglo_post["malla"] == $malla->id) {
                        $option_mallas .= '<option selected value="' . $malla->id . '">' . $malla->nombre . '</option>';
                    } else {
                        $option_mallas .= '<option value="' . $malla->id . '">' . $malla->nombre . '</option>';
                    }
                }
                //$cursos=TraeCursos("0",$id_empresa);
                $cursos = TraeCursos("0", $id_empresa);
                //$cursos=TraeCursos($arreglo_post["malla"],$id_empresa);
                $option_cursos = "";
                foreach ($cursos as $curso) {
                    if ($arreglo_post["curso"] == $curso->id) {
                        $option_cursos .= '<option value="' . $curso->id . '" selected>' . $curso->nombre . '</option>';
                    } else {
                        $option_cursos .= '<option value="' . $curso->id . '">' . $curso->nombre . '</option>';
                    }
                }
                $objetos = TraeObjetos($arreglo_post["curso"], $id_empresa);
                foreach ($objetos as $objeto) {
                    if ($arreglo_post["objetos"] == $objeto->id) {
                        $option_objetos .= '<option selected="selected" value="' . $objeto->id . '">' . $objeto->titulo . '</option>';
                    } else {
                        $option_objetos .= '<option value="' . $objeto->id . '">' . $objeto->titulo . '</option>';
                    }
                }
                if ($id_objeto) {
                    $datos_objeto = DatosObjeto($id_objeto);
                    $datos_extension = DatosExtensionDeObjeto($datos_objeto[0]->extension_objeto);
                    if ($datos_objeto[0]->id_template) {
                        if (file_exists("../front/views/pagina/" . $datos_malla[0]->id_malla . "_" . ($datos_objeto[0]->template_para_entorno))) {
                            $template_objeto = "../front/views/pagina/" . $datos_malla[0]->id_malla . "_" . ($datos_objeto[0]->template_para_entorno);
                        } else {
                            $template_objeto = "../front/views/pagina/" . ($datos_objeto[0]->template_para_entorno);
                        }
                    } else {
                        $template_objeto = ($datos_extension[0]->template);
                    }
                    if ($datos_objeto[0]->extension_objeto == 11) {
                        $PRINCIPAL = str_replace("{BLOQUE_OBJETO}", file_get_contents("views/reportes/objetos/index_imagenes.html"), $PRINCIPAL);
                        $imagenes = FotosPorObjetoDesdeAdmin($id_objeto, $_SESSION["id_empresa"]);
                        $j = 1;
                        foreach ($imagenes as $img) {
                            if ($j == 1) {
                                $row_html .= "<tr>";
                            }
                            $row_html .= file_get_contents("views/reportes/objetos/row_imagen.html");
                            if ($j == 3) {
                                $row_html .= "</tr>";
                                $j = 1;
                            } else {
                                $j++;
                            }
                            $figura = '<a href="../front/galeria/' . $img->archivo . '" title="' . $img->descripcion . '" onclick="vista_galeria(' . $img->id . ')"  data-gallery><img src="../front/img/objetos/' . $img->archivo . '""></a>';
                            $row_html = str_replace("{FIGURA}", $figura, $row_html);
                            $row_html = str_replace("{URL_IMAGEN_ARCHIVO}", "../front/img/objetos/" . $img->archivo . "", $row_html);
                            $row_html = str_replace("{DESCRIPCION}", utf8_encode($img->nombre_completo), $row_html);
                            $row_html = str_replace("{COMENTARIO}", utf8_encode($img->comentarios), $row_html);
                            $row_html = str_replace("{CANTIDAD_MEGUSTA}", $img->total_megusta, $row_html);
                            $row_html = str_replace("{URL_IMAGEN_PERSONA}", VerificaFotoPersonalDesdeAdmin($img->rut_autor), $row_html);
                            if ($img->rut_autor == $rut) {
                                $row_html = str_replace("{MEGUSTA}", ColocaMeGusta($img->id, "id_imagen_galeria", $id_empresa, $rut, "autor"), $row_html);
                                $row_html = str_replace("{DELETE}", file_get_contents("views/cursos/objetos/subirFotos/" . $id_empresa . "_delete_imagen.html"), $row_html);
                                $row_html = str_replace("{ID_IMAGEN_ENCODEADA}", Encodear3($img->id), $row_html);
                            } else {
                                $row_html = str_replace("{MEGUSTA}", ColocaMeGusta($img->id, "id_imagen_galeria", $id_empresa, $rut), $row_html);
                                $row_html = str_replace("{DELETE}", "", $row_html);
                            }
                            $row_html = str_replace("{VISITAS}", 0, $row_html);
                            if ($img->modalidad == 1) {
                                $row_html = str_replace("{CATEGORIA}", "Mi Mamá", $row_html);
                            } else if ($img->modalidad == 2) {
                                $row_html = str_replace("{CATEGORIA}", "La Mamá de mis hijos", $row_html);
                            } else if ($img->modalidad == 3) {
                                $row_html = str_replace("{CATEGORIA}", "Yo como Mamá", $row_html);
                            }
                        }
                        $PRINCIPAL = str_replace("{GALERIA_FOTOS_USUARIOS_}", $row_html, $PRINCIPAL);
                    } else {
                        $PRINCIPAL = str_replace("{BLOQUE_OBJETO}", file_get_contents("../front/" . $template_objeto), $PRINCIPAL);
                        $PRINCIPAL = str_replace("{URL_OBJETO}", $datos_extension[0]->template, $PRINCIPAL);
                        $PRINCIPAL = str_replace("{BLOQUE_OBJETO}", $template_objeto, $PRINCIPAL);
                        $PRINCIPAL = str_replace("{NOMBRE_DOCUMENTO}", $datos_objeto[0]->url_objeto, $PRINCIPAL);
                        $PRINCIPAL = str_replace("{NOMBRE_VIDEO_MP4}", "../front/" . $datos_objeto[0]->url_objeto, $PRINCIPAL);
                        $PRINCIPAL = str_replace("{URL_OBJETO_LINK}", $datos_objeto[0]->url_objeto, $PRINCIPAL);
                        $PRINCIPAL = str_replace("{EXTENSION_OBJETO}", $datos_objeto[0]->duracion_video, $PRINCIPAL);
                    }
                    $PRINCIPAL = str_replace("{NOMBRE_OBJETO}", utf8_encode($datos_objeto[0]->titulo), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{NUMERO_OBJETO}", ($datos_objeto[0]->orden), $PRINCIPAL);
                    //PARA SESSIONS
                    $PRINCIPAL = str_replace("{TITULO}", utf8_encode($datos_objeto[0]->titulo), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{TEXTO_BAJADA}", utf8_encode($datos_objeto[0]->texto_bajada), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{BAJADA}", utf8_encode($datos_objeto[0]->bajada), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{URL_VIDEO}", utf8_encode($datos_objeto[0]->video), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{TRANSCRIPCION}", utf8_encode($datos_objeto[0]->transcripcion), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{titulo_principal}", utf8_encode($datos_objeto[0]->titulo_principal), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{pregunta_principal}", utf8_encode($datos_objeto[0]->pregunta_principal), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{bajada_principal}", utf8_encode($datos_objeto[0]->bajada_principal), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{titulo_secundario}", utf8_encode($datos_objeto[0]->titulo_secundario), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{bajada_secundario}", utf8_encode($datos_objeto[0]->bajada_secundario), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{subtitulo_principal}", utf8_encode($datos_objeto[0]->subtitulo_principal), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{bajada_subtitulo_principal}", utf8_encode($datos_objeto[0]->bajada_subtitulo_principal), $PRINCIPAL);
                    //Bloque para Pregunta
                    $PRINCIPAL = str_replace("{ENTORNO_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 1), $PRINCIPAL);
                    //Bloque para Comentarios - Post
                    $PRINCIPAL = str_replace("{LISTADO_COMENTARIOS}", ColocaBloqueComentariosPorObjeto($datos_objeto[0]->id, $rut), $PRINCIPAL);
                    //Arma paginacion para GALERIA DE IMAGENES
                }
                $PRINCIPAL = str_replace("{MALLAS}", utf8_encode($option_mallas), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CURSOS}", utf8_encode($option_cursos), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OBJETOS}", utf8_encode($option_objetos), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_EMPRSA}", $id_empresa, $PRINCIPAL);
                //Traigo el listado de usuarios
                return ($PRINCIPAL);
            }

            function ReporteCapacitacionDetallado($PRINCIPAL, $id_empresa, $arreglo_post, $criterio, $excel)
            {
                //echo "$id_empresa,  $criterio, $excel";
                //print_r($arreglo_post);
                //echo "hola";
                //exit();
                $datos_empresa = DatosEmpresa($id_empresa);
                $tipo_de_reporte = "detallado";
                $mallas = TraeMallasEmpresa($id_empresa);
                foreach ($mallas as $malla) {
                    if ($arreglo_post["malla"] == $malla->id) {
                        $option_mallas .= '<option selected value="' . $malla->id . '">' . $malla->nombre . '</option>';
                    } else {
                        $option_mallas .= '<option value="' . $malla->id . '">' . $malla->nombre . '</option>';
                    }
                }
                $cursos = TraeCursos("0", $id_empresa);
                $option_cursos = "";
                foreach ($cursos as $curso) {
                    if ($arreglo_post["curso"] == $curso->id) {
                        $option_cursos .= '<option value="' . $curso->id . '" selected>' . $curso->nombre . '</option>';
                    } else {
                        $option_cursos .= '<option value="' . $curso->id . '">' . $curso->nombre . '</option>';
                    }
                }
                $clasificaciones = TraeClasificaciones($arreglo_post["malla"], $id_empresa);
                $options_clasificaciones = "";
                foreach ($clasificaciones as $clasif) {
                    if ($arreglo_post["clasificacion"] == $clasif->id_clasificacion) {
                        $option_clasificaciones .= '<option value="' . $clasif->id_clasificacion . '" selected>' . $clasif->clasificacion . '</option>';
                    } else {
                        $option_clasificaciones .= '<option value="' . $clasif->id_clasificacion . '">' . $clasif->clasificacion . '</option>';
                    }
                }
//FOCOS Filtro
                $focos = TraeFocosPorEmpresa($id_empresa);
                $options_focos = "";
                foreach ($focos as $foc) {
                    if ($arreglo_post["foco"] == $foc->codigo_foco) {
                        $options_focos .= '<option value="' . $foc->codigo_foco . '" selected>' . $foc->descripcion . '</option>';
                    } else {
                        $options_focos .= '<option value="' . $foc->codigo_foco . '">' . $foc->descripcion . '</option>';
                    }
                }
                //PROGRAMAS BBDD Filtro
                $programasBBDD = TraeProgramasBBDDPorEmpresa($id_empresa);
                $options_programasBBDD = "";
                foreach ($programasBBDD as $progbbdd) {
                    if ($arreglo_post["programabbdd"] == $progbbdd->id_programa) {
                        $options_programasBBDD .= '<option value="' . $progbbdd->id_programa . '" selected>' . $progbbdd->nombre_programa . '</option>';
                    } else {
                        $options_programasBBDD .= '<option value="' . $progbbdd->id_programa . '">' . $progbbdd->nombre_programa . '</option>';
                    }
                }
                $c1BBDD = TraedatosDadoCampo($id_empresa, $datos_empresa[0]->campo1);
                $options_c1 = "";
                foreach ($c1BBDD as $c1) {
                    if ($arreglo_post["c1"] == $c1->valor) {
                        $options_c1 .= '<option value="' . $c1->valor . '" selected>' . $c1->valor . '</option>';
                    } else {
                        $options_c1 .= '<option value="' . $c1->valor . '">' . $c1->valor . '</option>';
                    }
                }
                $c2BBDD = TraedatosDadoCampo($id_empresa, $datos_empresa[0]->campo2);
                $options_c2 = "";
                foreach ($c2BBDD as $c2) {
                    if ($arreglo_post["c2"] == $c2->valor) {
                        $options_c2 .= '<option value="' . $c2->valor . '" selected>' . $c2->valor . '</option>';
                    } else {
                        $options_c2 .= '<option value="' . $c2->valor . '">' . $c2->valor . '</option>';
                    }
                }
                $c2BBDD = TraedatosDadoCampo($id_empresa, $datos_empresa[0]->campo3);
                $options_c3 = "";
                foreach ($c3BBDD as $c3) {
                    if ($arreglo_post["c3"] == $c3->valor) {
                        $options_c3 .= '<option value="' . $c3->valor . '" selected>' . $c3->valor . '</option>';
                    } else {
                        $options_c3 .= '<option value="' . $c3->valor . '">' . $c3->valor . '</option>';
                    }
                }
                $PRINCIPAL = str_replace("{OPTIONS_C1}", utf8_encode($options_c1), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_C2}", utf8_encode($options_c2), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_C3}", utf8_encode($options_c3), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_PROGRAMAS_BBDD}", utf8_encode($options_programasBBDD), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_FOCOS}", utf8_encode($options_focos), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CLASIFICACIONES}", utf8_encode($option_clasificaciones), $PRINCIPAL);
                $PRINCIPAL = str_replace("{MALLAS}", utf8_encode($option_mallas), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CURSOS}", utf8_encode($option_cursos), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_EMPRSA}", $id_empresa, $PRINCIPAL);
                $fechaactualizacion = LmsBuscaFechaReporte($id_empresa);
                $PRINCIPAL = str_replace("{FECHA_ACTUALIZACION_REPORTE}", $fechaactualizacion, $PRINCIPAL);
                $i = 0;
                $acumulador_porcentajes_avance_malla = 0;
                $acumulador_visitas = 0;
                if (count($arreglo_post) > 0) {
                    if ($criterio and $arreglo_post["malla"] <> '0') {
                        $PRINCIPAL = str_replace("{CRITERIO}", $criterio, $PRINCIPAL);
                        $valores_por_criterio = TraigoValoresDadoCampoPorEmpreas($criterio, $id_empresa);
                        $cursos = TraeCursosActivos($arreglo_post["malla"], $id_empresa, $arreglo_post["curso"]);
                        foreach ($cursos as $curso) {
                            foreach ($valores_por_criterio as $valores) {
                                $i++;
                                $usuarios = UsuariosPorEmpresaCapacitacion_sin($id_empresa, $arreglo_post, $criterio, utf8_encode($valores->valor));
                                if (count($usuarios) == 0) {
                                    continue;
                                }
                                $rows .= file_get_contents("views/reportes/capacitacion/row_avance_capacitacion_por_criterio_detallado.html");
                                $rows = str_replace("{NUM}", $i, $rows);
                                $rows = str_replace("{NOMBRE}", utf8_dencode($valores->valor), $rows);
                                $rows = str_replace("{NUM_USUARIOS}", count($usuarios), $rows);
                                $rows = str_replace("{CURSO}", utf8_encode($curso->nombre), $rows);
                                $acumulador_visitas = 0;
                                $acumulador_porcentajes_avance_malla = 0;
                                $acumulador_puntos = 0;
                                $acumulador_medallas = 0;
                                $acumulador_resultados = 0;
                                $contador_usuarios_con_resultados = 0;
                                foreach ($usuarios as $usu) {
                                    $arreglo_post[curso] = $curso->id;
                                    $datos_calculos_malla = ColocaDatosMallaCapacitacion($rows, $usu->rut, $id_empresa, "", "admin", $arreglo_post);
                                    $acumulador_porcentajes_avance_malla = $acumulador_porcentajes_avance_malla + $datos_calculos_malla[1];
                                    $acumulador_puntos = $acumulador_puntos + $datos_calculos_malla[2][6];
                                    $acumulador_medallas = $acumulador_medallas + $datos_calculos_malla[2][7];
                                    $acumulador_visitas = $acumulador_visitas + $datos_calculos_malla[2][8];
                                    if ($arreglo_post["malla"] <> '0' && $arreglo_post["curso"] <> '0') {
                                        $valor_nota_acumulada = GAMIFICACIONResultadosPorSoloCurso($usu->rut, $arreglo_post["curso"], $id_empresa);
                                        if ($valor_nota_acumulada === 0 or $valor_nota_acumulada > 0) {
                                            $contador_usuarios_con_resultados++;
                                        }
                                        $acumulador_resultados = $acumulador_resultados + $valor_nota_acumulada;
                                    } else if ($arreglo_post["malla"] <> '0' && $arreglo_post["curso"] == '0') {
                                        $valor_nota_acumulada = GAMIFICACIONResultadosPorSoloCurso($usu->rut, $arreglo_post["curso"], $id_empresa);
                                        if ($valor_nota_acumulada === 0 or $valor_nota_acumulada > 0) {
                                            $contador_usuarios_con_resultados++;
                                        }
                                        $acumulador_resultados = $acumulador_resultados + $valor_nota_acumulada;
                                    }
                                }
                                $rows = str_replace("{NUMERO_ACCESOS}", ColocarColoresConPorcentajeProgressBar(number_format(($acumulador_visitas * 100) / count($usuarios), 0, ",", ".")), $rows);
                                $rows = str_replace("{NUMERO_AVANCE}", ColocarColoresConPorcentajeProgressBar(number_format($acumulador_porcentajes_avance_malla / count($usuarios), 0, ",", ".")), $rows);
                                $rows = str_replace("{PUNTOS}", round($acumulador_puntos / count($usuarios)), $rows);
                                $rows = str_replace("{MEDALLAS}", round($acumulador_medallas / count($usuarios)), $rows);
                                if ($arreglo_post["malla"] <> '0' && $arreglo_post["curso"] <> '0') {
                                    $rows = str_replace("{RESULTADO}", number_format($acumulador_resultados / $contador_usuarios_con_resultados, 2, ",", "."), $rows);
                                } else if ($arreglo_post["malla"] <> '0' && $arreglo_post["curso"] == '0') {
                                    $rows = str_replace("{RESULTADO}", number_format($acumulador_resultados / $contador_usuarios_con_resultados, 2, ",", "."), $rows);
                                } else if ($arreglo_post["malla"] == '0' && $arreglo_post["curso"] == '0') {
                                    $rows = str_replace("{RESULTADO}", GAMIFICACIONResultadosPorCursoMalla($usu->rut, "", $arreglo_post["malla"], $id_empresa), $rows);
                                } else {
                                    $rows = str_replace("{RESULTADO}", "-", $rows);
                                }
                            }
                        }
                    } else {
                        //$usuarios=UsuariosPorEmpresaCapacitacion_sin($id_empresa, $arreglo_post);
                        //$datamalla=ObtenerDatosRelMallaUsuarioDadoRut($usu->rut, $id_empresa);
                        $cursos = TraeCursosActivos($arreglo_post["malla"], $id_empresa, $arreglo_post["curso"]);
                        //print_r($cursos);
                        //exit();
                        //traigo el total de datos por empresa
                        $datos_reporte = TraigoDatosTablareportes($id_empresa, $arreglo_post);
                        //echo count($datos_reporte);
                        //exit();
                        foreach ($datos_reporte as $dat) {
                            $i++;
                            if ($excel == 1) {
                                $rows = file_get_contents("views/reportes/capacitacion/row_avance_capacitacion_excel_detallado.html");
                            } else {
                                $rows .= file_get_contents("views/reportes/capacitacion/row_avance_capacitacion_detallado.html");
                            }
                            $rows = str_replace("{NUM}", $i, $rows);
                            $rows = str_replace("{RUT_COMPLETO_EVALUADO}", $dat->rut_completo, $rows);
                            $rows = str_replace("{NOMBRE_COMPLETO}", $dat->nombre, $rows);
                            $rows = str_replace("{CARGO}", $dat->cargo, $rows);
                            $rows = str_replace("{IDMALLA}", $dat->id_malla, $rows);
                            $rows = str_replace("{MALLA}", $dat->nombremalla, $rows);
                            $rows = str_replace("{IDCURSO}", $dat->id_curso, $rows);
                            $rows = str_replace("{CURSO}", $dat->nombrecurso, $rows);
                            $rows = str_replace("{CAMPO1}", $dat->c1, $rows);
                            $rows = str_replace("{CAMPO2}", $dat->c2, $rows);
                            $rows = str_replace("{CAMPO3}", $dat->c3, $rows);
                            $rows = str_replace("{EMAIL}", $dat->email, $rows);
                            $rows = str_replace("{NUMERO_AVANCE}", ColocarColoresConPorcentajeProgressBar($dat->avance), $rows);
                            $rows = str_replace("{PUNTOS}", $dat->puntos, $rows);
                            $rows = str_replace("{RESULTADO}", $dat->resultado, $rows);
                            $rows = str_replace("{MEDALLAS}", $dat->medallas, $rows);
                            if ($excel == 1) {
                                echo $rows;
                            }
                        }
                    }
                }
                $PRINCIPAL = str_replace("{LISTADO_USUARIOS}", $rows, $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS}", $i, $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_TOTAL}", number_format($acumulador_porcentajes_avance_malla / $i, 0, ",", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_ACCESOS}", $acumulador_visitas, $PRINCIPAL);
                //Bloque Total de Porcentaje Total
                $PRINCIPAL = str_replace("{GRAFICO_PORCENTAJE_TOTAL}", file_get_contents("views/graficos/grafico_circulo.html"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE}", number_format($acumulador_porcentajes_avance_malla / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{TEXTO}", "Avance", $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOMBRE_GRAFICO}", "Avance", $PRINCIPAL);
                //Bloque Total de ACESOS
                $PRINCIPAL = str_replace("{GRAFICO_CANTIDAD_ACCESOS}", file_get_contents("views/graficos/grafico_circulo.html"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE}", number_format($acumulador_visitas * 100 / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{TEXTO}", "Accesos", $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOMBRE_GRAFICO}", "Accesos", $PRINCIPAL);
                return ($PRINCIPAL);
                /*
    foreach($usuarios as $usu){
            foreach($cursos as $curso){
                $i++;
                if($excel==1 or $excel==2){
                    $rows=file_get_contents("views/reportes/capacitacion/row_avance_capacitacion_excel_detallado.html");
                }else if (!$excel){
                    $rows.=file_get_contents("views/reportes/capacitacion/row_avance_capacitacion_detallado.html");
                }
                $arreglo_post[curso]=$curso->id;
                $datos_calculos_malla=ColocaDatosMallaCapacitacion($rows, $usu->rut, $id_empresa, "", "admin", $arreglo_post, "", $tipo_de_reporte);
                $traeimagen=ColocaImagenVerificaAvatar($usu->rut, "admin");
                if($traeimagen<>'img/sinfoto.png'){
                    if($id_empresa=="59"){
                        $miimagenusuario=$traeimagen;
                    } else {
                        $miimagenusuario="../front/".$traeimagen;
                    }
                } else {
                    $miimagenusuario="../front/".$traeimagen;
                }
                $rows = str_replace("{FOTO}",$miimagenusuario,$rows);
                $rows = str_replace("{RUT_COMPLETO_EVALUADO}",$datos_calculos_malla[2][0],$rows);
                $rows = str_replace("{NOMBRE_COMPLETO}",$datos_calculos_malla[2][1],$rows);
                $rows = str_replace("{CARGO}",$datos_calculos_malla[2][2],$rows);
                $rows = str_replace("{CAMPO1}",$datos_calculos_malla[2][3],$rows);
                $rows = str_replace("{CAMPO2}",$datos_calculos_malla[2][4],$rows);
                $rows = str_replace("{CAMPO3}",$datos_calculos_malla[2][5],$rows);
                $rows = str_replace("{EMAIL}",$datos_calculos_malla[2][9],$rows);
                $rows = str_replace("{MALLA}",$arreglo_post["malla"],$rows);
                $rows = str_replace("{NUM}",$i,$rows);
                $rows = str_replace("{CURSO}",utf8_encode($curso->nombre),$rows);
                $rows = str_replace("{NUMERO_AVANCE}",ColocarColoresConPorcentajeProgressBar($datos_calculos_malla[1]),$rows);
                $rows = str_replace("{PUNTOS}",$datos_calculos_malla[2][6],$rows);
                $resultado=GAMIFICACIONResultadosPorSoloCurso($usu->rut, $curso->id, $id_empresa);
                $rows = str_replace("{RESULTADO}",$resultado,$rows);
                $rows = str_replace("{MEDALLAS}",$datos_calculos_malla[2][7],$rows);
                if($excel==1){
                }else{
                    $acumulador_porcentajes_avance_malla=$acumulador_porcentajes_avance_malla+$datos_calculos_malla[1];
                    $acumulador_visitas=$acumulador_visitas+$datos_calculos_malla[2][8];
                }
                if($excel==1 ){
                    echo utf8_decode($rows);
                }else if($excel==2){
                    }
            }
            }
    }
    }
            if($excel==1 or $excel==2){
                exit;
            }
    $PRINCIPAL = str_replace("{LISTADO_USUARIOS}",$rows,$PRINCIPAL);
    $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS}",$i,$PRINCIPAL);
    $PRINCIPAL = str_replace("{PORCENTAJE_TOTAL}",number_format($acumulador_porcentajes_avance_malla/$i,0,",","."),$PRINCIPAL);
    $PRINCIPAL = str_replace("{CANTIDAD_ACCESOS}",$acumulador_visitas,$PRINCIPAL);
    $PRINCIPAL = str_replace("{GRAFICO_PORCENTAJE_TOTAL}",file_get_contents("views/graficos/grafico_circulo.html"),$PRINCIPAL);
    $PRINCIPAL = str_replace("{PORCENTAJE}",number_format($acumulador_porcentajes_avance_malla/$i,0,".","."),$PRINCIPAL);
    $PRINCIPAL = str_replace("{TEXTO}","Avance",$PRINCIPAL);
    $PRINCIPAL = str_replace("{NOMBRE_GRAFICO}","Avance",$PRINCIPAL);
    $PRINCIPAL = str_replace("{GRAFICO_CANTIDAD_ACCESOS}",file_get_contents("views/graficos/grafico_circulo.html"),$PRINCIPAL);
    $PRINCIPAL = str_replace("{PORCENTAJE}",number_format($acumulador_visitas*100/$i,0,".","."),$PRINCIPAL);
    $PRINCIPAL = str_replace("{TEXTO}","Accesos",$PRINCIPAL);
    $PRINCIPAL = str_replace("{NOMBRE_GRAFICO}","Accesos",$PRINCIPAL);
    return($PRINCIPAL);
     * */
            }

            function BloqueContenidosTips($PRINCIPAL, $id_empresa)
            {
                $datos = ObtenerContenidosBloqueTips($id_empresa);
                $i = 1;
                foreach ($datos as $dat) {
                    $row .= file_get_contents("views/contenidos/tips/28_row.html");
                    $row = str_replace("{TEXTO}", utf8_encode($dat->texto), $row);
                    $row = str_replace("{NUMERO}", $i, $row);
                    $row = str_replace("{ID}", Encodear3($dat->id), $row);
                    $i++;
                }
                $PRINCIPAL = str_replace("{ROW_TIPS}", ($row), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function BloqueContenidosImportante($PRINCIPAL, $id_empresa)
            {
                $datos = ObtenerContenidosBloqueImportante($id_empresa);
                $i = 1;
                foreach ($datos as $dat) {
                    $row .= file_get_contents("views/contenidos/importante/28_row.html");
                    $row = str_replace("{TEXTO}", utf8_encode($dat->texto), $row);
                    $row = str_replace("{NUMERO}", $i, $row);
                    $row = str_replace("{ID}", Encodear3($dat->id), $row);
                    $i++;
                }
                $PRINCIPAL = str_replace("{ROW_IMPORTANTE}", ($row), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function BloqueContenidosHomeInicial($PRINCIPAL, $id_empresa)
            {
                $datos_contenido = ObtenerContenidosInicialSGDPorEmpresa($id_empresa);
                $PRINCIPAL = str_replace("{VALUE_TITULO}", utf8_encode($datos_contenido[0]->titulo), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_INTRODUCCION}", utf8_encode($datos_contenido[0]->introduccion), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_COMPETENCIAS_TRANSVERSALES}", utf8_encode($datos_contenido[0]->competencias_transversales), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_COMPETENCIAS_LIDERAZGO}", utf8_encode($datos_contenido[0]->competencias_liderazgo), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_TITULO_BLOQUE_CENTRAL}", utf8_encode($datos_contenido[0]->titulo_bloque_central), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_TITULO_COMPETENCIAS_TRANSVERSALES}", utf8_encode($datos_contenido[0]->titulo_competencias_transversales), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_TITULO_COMPETENCIAS_LIDERAZGO}", utf8_encode($datos_contenido[0]->titulo_competencias_liderazgo), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_TITULO_IMAGEN}", utf8_encode($datos_contenido[0]->titulo_imagen), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_TITULO_IMPORTANTE}", utf8_encode($datos_contenido[0]->titulo_importante), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_TITULO_TIPS}", utf8_encode($datos_contenido[0]->titulo_tips), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function AceptaProcesamientoPrevioRelaciones($id_empresa)
            {
                //traigo el total de registro de la tabla temporal
                $total_relaciones = TotalRelacionesTemp($id_empresa);
                foreach ($total_relaciones as $rel) {
                    //Primero verifico si el evaluado, mas el id del proceso, mas el id del subperfil, ya existe en la base, si es asi, actualizo la relacion, sino inserta
                    $existe_relacion_previa = VerificaRelEvaluadoProcesoSubperfil($rel->evaluado, $rel->id_proceso, $rel->subperfil);
                    if ($existe_relacion_previa) {
                        ActualizaRelacionSGDPorEvaluadoProcesoSubperfil($rel->evaluado, $rel->evaluador, $rel->calibrador, $rel->id_proceso, $rel->perfil_evaluacion_competencias, $rel->subperfil, $rel->comentario, $id_empresa);
                    } else {
                        InsertaRelacionSGD($rel->evaluado, $rel->evaluador, $rel->calibrador, $rel->id_proceso, $rel->perfil_evaluacion_competencias, $rel->subperfil, $rel->comentario, $id_empresa);
                    }
                }
                echo "
                    <script>
                    alert('Datos Actualizados exitosamente');
                    location.href='?sw=GestionRelacionesPorProceso&i=" . Encodear3($rel->id_proceso) . "';
                    </script>";
                exit;
            }

            function colocaDatosInformeBoletin($PRINCIPAL, $arreglo_post, $id_empresa, $id_proceso)
            {
                //echo $arreglo_post["filtro1"];
                $datos_empresa = DatosEmpresa($id_empresa);
                $campo1 = $datos_empresa[0]->campo1;
                $campo2 = $datos_empresa[0]->campo2;
                $campo3 = $datos_empresa[0]->campo3;
                $datosCampo1 = CriteriosParaTablaResumenReporteAvance2($id_empresa, $campo1, $arreglo_post);
                foreach ($datosCampo1 as $dat) {
                    $row .= '<table  class="table table-bordered table-hover table-condensed">
                    <tr class="bg-light">
                        <th></th>
                        <th></th>
                        <th>Avance</th>
                        <th>Total</th>
                        <th>Total Finalizados</th>
                        </tr>
                        ';
                    $row .= file_get_contents("views/procesos/reportes/resultadosVersion2/28_row_listado_boletin.html");
                    $row = str_replace("{CRITERIO}", $dat->valor, $row);
                    $datoCampo1 = AvanceDeEvaluados("", $id_proceso, "", "", "", "", "", $campo1, $dat->valor, "", "", "", "");
                    $row = str_replace("{AVANCE}", $datoCampo1[0], $row);
                    $cantidad = totalRelacionesDadoCriterio($id_empresa, $id_proceso, $campo1, "", "", $dat->valor, "", "");
                    $cantidad_finalizados = totalRelacionesDadoCriterioCruceFinalizados($id_empresa, $id_proceso, $campo1, "", "", $dat->valor, "", "");
                    //Por cada campo 1, traigo los campo2 2
                    $row = str_replace("{RESULTADO}", $cantidad[0]->total, $row);
                    $row = str_replace("{TOTAL_FINALIZADOS}", $cantidad_finalizados[0]->total, $row);
                    $datosCampo2 = CriteriosParaTablaResumenReporteAvance2Campo2($id_empresa, $campo2, $campo1, $dat->valor, $arreglo_post);
                    foreach ($datosCampo2 as $dat2) {
                        $row .= file_get_contents("views/procesos/reportes/resultadosVersion2/28_row_listado_boletin_campo2.html");
                        $row = str_replace("{CRITERIOCAMPO2}", $dat2->valor, $row);
                        $datoCampo2 = AvanceDeEvaluados("", $id_proceso, "", "", "", "", "", $campo1, $dat->valor, $campo2, $dat2->valor, "", "");
                        $row = str_replace("{AVANCECAMPO2}", $datoCampo2[0], $row);
                        $cantidad = totalRelacionesDadoCriterio($id_empresa, $id_proceso, $campo1, $campo2, "", $dat->valor, $dat2->valor, "");
                        $cantidadFinalizados = totalRelacionesDadoCriterioCruceFinalizados($id_empresa, $id_proceso, $campo1, $campo2, "", $dat->valor, $dat2->valor, "");
                        //Por cada campo 1, traigo los campo2 2
                        $row = str_replace("{RESULTADOCAMPO2}", $cantidad[0]->total, $row);
                        $row = str_replace("{TOTAL_FINALIZADOS2}", $cantidadFinalizados[0]->total, $row);
                        $datosCampo3 = CriteriosParaTablaResumenReporteAvance2Campo3($id_empresa, $campo3, $campo1, $dat->valor, $campo2, $dat2->valor);
                        foreach ($datosCampo3 as $dat3) {
                            $row .= file_get_contents("views/procesos/reportes/resultadosVersion2/28_row_listado_boletin_campo3.html");
                            $row = str_replace("{CRITERIOCAMPO3}", $dat3->valor, $row);
                            $datoCampo3 = AvanceDeEvaluados("", $id_proceso, "", "", "", "", "", $campo1, $dat->valor, $campo2, $dat2->valor, $campo3, $dat3->valor);
                            $row = str_replace("{AVANCECAMPO3}", $datoCampo3[0], $row);
                            $cantidad = totalRelacionesDadoCriterio($id_empresa, $id_proceso, $campo1, $campo2, $campo3, $dat->valor, $dat2->valor, $dat3->valor);
                            $cantidadFinalizados = totalRelacionesDadoCriterioCruceFinalizados($id_empresa, $id_proceso, $campo1, $campo2, $campo3, $dat->valor, $dat2->valor, $dat3->valor);
                            //Por cada campo 1, traigo los campo2 2
                            $row = str_replace("{RESULTADOCAMPO3}", $cantidad[0]->total, $row);
                            $row = str_replace("{TOTAL_FINALIZADOS3}", $cantidadFinalizados[0]->total, $row);
                        }
                    }
                    $row .= "</table>
            <br><br>";
                }
                $PRINCIPAL = str_replace("{ROW_LISTADO}", utf8_encode($row), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function GeneraBitacora($id_empresa, $ano)
            {
                $html = file_get_contents("views/bitacora/28_entorno.html");
                //traigo el listado de bitacoras
                $total_bitacoras = TraeTotalBitacorasPorEmpresa($id_empresa);
                foreach ($total_bitacoras as $bit) {
                    $row .= file_get_contents("views/bitacora/28_row.html");
                    $row = str_replace("{RUT_EVALUADO}", $bit->evaluado, $row);
                    $row = str_replace("{RUT_FIJADOR}", $bit->creador, $row);
                    $row = str_replace("{NOMBRE_EVALUADO}", $bit->nombre_evaluado, $row);
                    $row = str_replace("{CARGO_EVALUADO}", $bit->cargo_evaluado, $row);
                    $row = str_replace("{CAMPO1_EVALUADO}", $bit->campo1_evaluado, $row);
                    $row = str_replace("{CAMPO2_EVALUADO}", $bit->campo2_evaluado, $row);
                    $row = str_replace("{CAMPO3_EVALUADO}", $bit->campo3_evaluado, $row);
                    $row = str_replace("{NOMBRE_FIJADOR}", $bit->nombre_fijador, $row);
                    $row = str_replace("{CARGO_FIJADOR}", $bit->cargo_fijador, $row);
                    $row = str_replace("{CAMPO1_FIJADOR}", $bit->campo1_fijador, $row);
                    $row = str_replace("{CAMPO2_FIJADOR}", $bit->campo2_fijador, $row);
                    $row = str_replace("{CAMPO3_FIJADOR}", $bit->campo3_fijador, $row);
                    $row = str_replace("{COMPETENCIA}", $bit->nombre_valor, $row);
                    $row = str_replace("{VALORACION}", $bit->realizado, $row);
                    $row = str_replace("{SITUACION_TAREA}", utf8_decode($bit->texto_st), $row);
                }
                $html = str_replace("{ROW_BITACORAS}", $row, $html);
                return ($html);
            }

            function AceptaProcesamientoPrevioIncricionesCierre($id_empresa)
            {
                //dado el id de la empresa, traigo los datos de la tabla temporales
                $totalinsctemp = TotalPreviaCierreMasivoPorEmpresa($id_empresa);
                //echo "rut $rut";
                $listado = file_get_contents("views/inscripcion/cierre/entorno_listado_previa_cierres.html");
                foreach ($totalinsctemp as $unico) {
                    $row .= file_get_contents("views/inscripcion/cierre/row_listado_previa_cierres.html");
                    $row = str_replace("{ACCION}", $unico->accion, $row);
                    $row = str_replace("{RUT}", $unico->rut, $row);
                    $row = str_replace("{CURSO}", $unico->id_curso, $row);
                    $row = str_replace("{PORCENTAJE_ASISTENCIA}", $unico->porcentaje_asistencia, $row);
                    $row = str_replace("{NOTA}", $unico->nota, $row);
                    $row = str_replace("{ESTADO}", $unico->estado, $row);
                    if ($unico->nombre_completo) {
                        $row = str_replace("{NOMBRE}", $unico->nombre_completo, $row);
                    } else {
                        $row = str_replace("{NOMBRE}", "Sin Informacion", $row);
                    }
                    $rut = $unico->rut;
                    $id_curso = $unico->id_curso;
                    $nota = $unico->nota;
                    $porcentaje_asistencia = $unico->porcentaje_asistencia;
                    $estado = $unico->estado;
                    $comentario = $unico->comentario;
                    $fecha_inicio = $unico->fecha_inicio;
                    $fecha_termino = $unico->fecha_termino;
                    $ubicacion = $unico->ubicacion;
                    $region = $unico->region;
                    $lugar_ejecucion = $unico->lugar_ejecucion;
                    $rut_jefe = $unico->rut_jefe;
                    $nombre_jefe = $unico->nombre_jefe;
                    $rut_entrenador = $unico->rut_entrenador;
                    $nombre_entrenador = $unico->nombre_entrenador;
                    $observaciones = $unico->observaciones;
                    $accion = $unico->accion;
                    $id_empresa = $unico->id_empresa;
                    InsertaDatosTablaFinalCierreCapacitaciones($rut, $id_curso, $nota, $porcentaje_asistencia,
                        $estado, $comentario, $fecha_inicio, $fecha_termino, $ubicacion, $region, $lugar_ejecucion, $rut_jefe,
                        $nombre_jefe, $rut_entrenador, $nombre_entrenador, $observaciones, $accion, $id_empresa);
                }
                $listado = str_replace("{ROW_LISTADO}", utf8_encode($row), $listado);
                return ($listado);
            }

            function ListadoCierresMasivosPrevio($id_empresa)
            {
                $total = TotalPreviaCierreMasivoPorEmpresa($id_empresa);
                $listado = file_get_contents("views/inscripcion/cierre/entorno_listado_previa_cierres.html");
                foreach ($total as $unico) {
                    $row .= file_get_contents("views/inscripcion/cierre/row_listado_previa_cierres.html");
                    $row = str_replace("{ACCION}", $unico->accion, $row);
                    $row = str_replace("{RUT}", $unico->rut, $row);
                    $row = str_replace("{CURSO}", $unico->id_curso, $row);
                    $row = str_replace("{PORCENTAJE_ASISTENCIA}", $unico->porcentaje_asistencia, $row);
                    $row = str_replace("{NOTA}", $unico->nota, $row);
                    $row = str_replace("{ESTADO}", $unico->estado, $row);
                    if ($unico->nombre_completo) {
                        $row = str_replace("{NOMBRE}", $unico->nombre_completo, $row);
                    } else {
                        $row = str_replace("{NOMBRE}", "Sin Informacion", $row);
                    }
                }
                $listado = str_replace("{ROW_LISTADO}", utf8_encode($row), $listado);
                return ($listado);
            }

            function ListadoEvaluadoEvaluadoresPorProcesoFijacion($PRINCIPAL, $arreglo_post, $pagina, $tipo_listado, $id_proceso, $excel, $campo_criterio, $criterio, $valor_criterio, $id_empresa, $campo_criterio)
            {
                //IMPORTANTE////
                $datos_empresa = DatosEmpresa($id_empresa);
                //EL CAMPO CRITERIO, es para cuando se muestren los resumenes.
                //Traigo el total de empresas que existen en el sistema
                //Con la variable tipo usuario, veo si es para el listado de usuarios, o para el listado de envio de correos.
                $datos_proceso = TraeProcesosDeEvaluacionPorIDProceso($id_proceso);
                if ($arreglo_post["n_registros"]) {
                    $usuarios_por_pagina = $arreglo_post["n_registros"];
                } else {
                    $usuarios_por_pagina = 200;
                }
                if (!$pagina) {
                    $pagina = 1;
                }
                $campos_para_reporte = CamposParaReporte("veEvaluadorPorProceso", $_SESSION["id_empresa"]);
                //$usuarios=TraeEvaluadoresPorProceso3Campos($id_proceso, $usuarios_por_pagina, $pagina, $arreglo_post, $campo_criterio, $criterio, $valor_criterio, $campos_para_reporte, $datos_empresa);
                $usuarios = TraeEvaluadoEvaluadorPorProceso3Campos($id_proceso, $usuarios_por_pagina, $pagina, $arreglo_post, $campo_criterio, $criterio, $valor_criterio, $campos_para_reporte, $datos_empresa);
                $PRINCIPAL = str_replace("{ENCABEZADO_DINAMICO}", MuestraEncabezadoPorProceso($id_proceso), $PRINCIPAL);
                //$PRINCIPAL = str_replace("{PAGINACION}",ArmaPaginacionGenerico($pagina, "veEvaluadorPorProceso&i=".Encodear3($id_proceso), "tbl_sgd_relaciones", $usuarios_por_pagina, $arreglo_post, $_SESSION["id_empresa"], $id_proceso, "reporteEvaluador"),$PRINCIPAL);
                $PRINCIPAL = str_replace("{PAGINACION}", "", $PRINCIPAL);
                $total_empresas = "";
                $html_row = file_get_contents("views/procesos/reportes/" . $id_empresa . "_row_listado_evaluado_evaluador_por_proceso_fijacion_excel.html");
                $i = 1;
                $valor_campo_criterio = "";
                $contador_campo_criterio = 0;
                $contador_criterios = 1;
                foreach ($usuarios as $unico) {
                    $row = $html_row;
                    $i++;
                    $row = str_replace("{RUT_EVALUADOR}", $unico->rut_completo_evaluador, $row);
                    $row = str_replace("{FOTO_EVALUADOR}", VerificaFotoPersonalDesdeAdmin($unico->evaluador), $row);
                    $row = str_replace("{RUT_EVALUADOR_ENCODEADO}", Encodear3($unico->evaluador), $row);
                    $row = str_replace("{NOMBRE_EVALUADOR}", $unico->nombre_evaluador, $row);
                    $row = str_replace("{CARGO_EVALUADOR}", $unico->cargo_evaluador, $row);
                    $row = str_replace("{GERENCIA_EVALUADOR}", $unico->gerencia_evaluador, $row);
                    $row = str_replace("{GERENCIA_EVALUADOR}", $unico->gerencia_evaluador, $row);
                    $row = str_replace("{CAMPO1}", $unico->campo1, $row);
                    $row = str_replace("{CAMPO2}", $unico->campo2, $row);
                    $row = str_replace("{CAMPO3}", $unico->campo3, $row);
                    $row = str_replace("{RUT_EVALUADO}", $unico->rut_completo_evaluado, $row);
                    $row = str_replace("{FOTO_EVALUADO}", VerificaFotoPersonalDesdeAdmin($unico->evaluado), $row);
                    $row = str_replace("{RUT_EVALUADOR_ENCODEADO}", Encodear3($unico->evaluado), $row);
                    $row = str_replace("{NOMBRE_EVALUADO}", $unico->nombre_evaluado, $row);
                    $row = str_replace("{CARGO_EVALUADO}", $unico->cargo_evaluado, $row);
                    $row = str_replace("{GERENCIA_EVALUADO}", $unico->gerencia_evaluado, $row);
                    $row = str_replace("{GERENCIA_EVALUADO}", $unico->gerencia_evaluado, $row);
                    $row = str_replace("{CAMPO1_EVALUADO}", $unico->campo1_evaluado, $row);
                    $row = str_replace("{CAMPO2_EVALUADO}", $unico->campo2_evaluado, $row);
                    $row = str_replace("{CAMPO3_EVALUADO}", $unico->campo3_evaluado, $row);
                    if ($unico->total_finalizados_fijados > 0) {
                        $row = str_replace("{ESTADO_FIJACION}", "Finalizado", $row);
                    } else {
                        $row = str_replace("{ESTADO_FIJACION}", "Pendiente", $row);
                    }
                    if ($unico->total_validados > 0) {
                        $row = str_replace("{ESTADO_VALIDACION}", "Finalizado", $row);
                    } else {
                        $row = str_replace("{ESTADO_VALIDACION}", "Pendiente", $row);
                    }
                    if ($unico->total_descarga_informes > 0) {
                        $row = str_replace("{ESTADO_REUNION}", "Pendiente", $row);
                    } else {
                        $row = str_replace("{ESTADO_REUNION}", "Pendiente", $row);
                    }
                    //$row = str_replace("{CANTIDAD_EVALUADOS}",$unico->total_evaluados,$row);
                    //$row = str_replace("{CAMBIO_CLAVE}",ColocaEtiquetaReportesSGD($unico->clave_creada, 1),$row);
                    //$porcentaje_Avance_evaluador=AvanceDeEvaluados($unico->evaluador, $id_proceso, "", "");
                    //$row = str_replace("{TOTAL_FINALIZADOS}",ColocarColoresConPorcentaje($porcentaje_Avance_evaluador[0]),$row);
                    //$row = str_replace("{TOTAL_EN_PROCESO}",ColocaEtiquetaReportesSGD($unico->total_en_proceso+0, $unico->total_evaluados),$row);
                    //$row = str_replace("{ID_REGISTRO_FINALIZADO_EVALUADO_EVALUADOR}",Encodear3($unico->id_registro_finalizado),$row);
                    //$row = str_replace("{ID_PROCESO_ENCODEADO}",Encodear3($id_proceso),$row);
                    //$row = str_replace("{ID_PROCESO_ENCODEADO}",Encodear3($id_proceso),$row);
                    //$row_arreglo_datos=ColocaAvancesPorEvaluador($row, $unico->evaluador, $id_proceso, $id_empresa, "admin");
                    //$row = $row_arreglo_datos[3];
                    $total_empresas .= $row;
                }
                $PRINCIPAL = str_replace("{ROW_LISTADO_USUARIOS}", utf8_encode($total_empresas), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function ColocaAccesosPorEmpresa($PRINCIPAL, $id_empresa)
            {
                $accesosUnicos = VisitaUsuariosUnicos($id_empresa);
                $accesos = 1;
                foreach ($accesosUnicos as $accesoUnico) {
                    $accesos++;
                }
                $total_usuarios = TotalUsuariosPorEmpresa2($id_empresa);
                $PRINCIPAL = str_replace("{TOTAL_VISITAS_UNICAS}", count($accesos), $PRINCIPAL);
                $porcentaje_avance = ($accesos * 100) / $total_usuarios[0]->total;
                $PRINCIPAL = str_replace("{PORCENTAJE_ACCESOS}", number_format($porcentaje_avance, 0), $PRINCIPAL);
                $PRINCIPAL = str_replace("{USUARIO_ACCESOS}", number_format($accesos, 0), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_NO_ACCESOS}", number_format(100 - $porcentaje_avance, 0), $PRINCIPAL);
                $PRINCIPAL = str_replace("{USUARIO_NO_ACCESOS}", number_format($total_usuarios[0]->total, 0), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function ArmaGraficoVisitasAdmin($PRINCIPAL, $id_empresa, $tipo_est)
            {
                $datos_visitas = VisitasPorFecha($id_empresa, $tipo_est);
                //print_r($datos_visitas);
                $i = 1;
                if ($tipo_est == 'fullbloque') {
                    $titulo_grafico = "Bloque Horario";
                }
                if ($tipo_est == 'fullpaginas') {
                    $titulo_grafico = "Páginas Visitadas por Día";
                }
                if ($tipo_est == 'fullvisitas') {
                    $titulo_grafico = "Visitas totales por Día";
                }
                if ($tipo_est == '') {
                    $titulo_grafico = "Usuarios Únicos por Día";
                }
                if ($tipo_est <> 'fullbloque') {
                    foreach ($datos_visitas as $vis) {
                        $arreglo_fechas = explode("-", $vis->fecha);
                        $ano = $arreglo_fechas[0];
                        $mes = $arreglo_fechas[1] - 1;
                        $dia = $arreglo_fechas[2];
                        $datos_grafico .= "[Date.UTC(" . $ano . ", " . $mes . ", " . $dia . "), " . $vis->totalusuarios . "]";
                        if ($i < count($datos_visitas)) {
                            $datos_grafico .= ", ";
                        }
                        $i++;
                    }
                }
                if ($tipo_est == 'fullbloque') {
                    foreach ($datos_visitas as $vis) {
                        $datos_grafico .= "[" . $vis->fecha . ", " . $vis->totalusuarios . "]";
                        if ($i < count($datos_visitas)) {
                            $datos_grafico .= ", ";
                        }
                        $i++;
                    }
                }
                $PRINCIPAL = str_replace("{ARREGLO_DATOS}", $datos_grafico, $PRINCIPAL);
                $PRINCIPAL = str_replace("{TITULO_GRAFICO}", $titulo_grafico, $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function ArmaGraficoVisitasTotalesAdmin($PRINCIPAL, $id_empresa)
            {
                $datos_visitas = VisitasPorFecha($id_empresa);
                //print_r($datos_visitas);
                $i = 1;
                foreach ($datos_visitas as $vis) {
                    $arreglo_fechas = explode("-", $vis->fecha);
                    $ano = $arreglo_fechas[0];
                    $mes = $arreglo_fechas[1] - 1;
                    $dia = $arreglo_fechas[2];
                    $datos_grafico .= "[Date.UTC(" . $ano . ", " . $mes . ", " . $dia . "), " . $vis->totalusuarios . "]";
                    if ($i < count($datos_visitas)) {
                        $datos_grafico .= ", ";
                    }
                    $i++;
                }
                $PRINCIPAL = str_replace("{ARREGLO_DATOS}", $datos_grafico, $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function ArmaGraficoBloquesHorariosAdmin($PRINCIPAL, $id_empresa)
            {
                $datos_visitas = VisitasPorFecha($id_empresa);
                //print_r($datos_visitas);
                $i = 1;
                foreach ($datos_visitas as $vis) {
                    $arreglo_fechas = explode("-", $vis->fecha);
                    $ano = $arreglo_fechas[0];
                    $mes = $arreglo_fechas[1] - 1;
                    $dia = $arreglo_fechas[2];
                    $datos_grafico .= "[Date.UTC(" . $ano . ", " . $mes . ", " . $dia . "), " . $vis->totalusuarios . "]";
                    if ($i < count($datos_visitas)) {
                        $datos_grafico .= ", ";
                    }
                    $i++;
                }
                $PRINCIPAL = str_replace("{ARREGLO_DATOS}", $datos_grafico, $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function creaNuevaClaveTipoTNT($rut, $id_empresa)
            {
                $datos_usuario = DatosTablaUsuario($rut);
                //Traigo la nueva clave
                $caracteres_apaterno = strtolower(substr($datos_usuario[0]->apaterno, 0, 4));
                $caracteres_rut = substr($_POST["rut"], 0, 4);
                $nueva_clave = $caracteres_apaterno . "." . $caracteres_rut;
                InsertaNuevaClave($rut, $nueva_clave, $id_empresa);
            }

            function ListadoEvaluadoresPorProcesoFijacion($PRINCIPAL, $arreglo_post, $pagina, $tipo_listado, $id_proceso, $excel, $campo_criterio, $criterio, $valor_criterio, $id_empresa, $campo_criterio)
            {
                //IMPORTANTE////
                $datos_empresa = DatosEmpresa($id_empresa);
                //EL CAMPO CRITERIO, es para cuando se muestren los resumenes.
                //Traigo el total de empresas que existen en el sistema
                //Con la variable tipo usuario, veo si es para el listado de usuarios, o para el listado de envio de correos.
                $datos_proceso = TraeProcesosDeEvaluacionPorIDProceso($id_proceso);
                if ($arreglo_post["n_registros"]) {
                    $usuarios_por_pagina = $arreglo_post["n_registros"];
                } else {
                    $usuarios_por_pagina = 200;
                }
                if (!$pagina) {
                    $pagina = 1;
                }
                $campos_para_reporte = CamposParaReporte("veEvaluadorPorProceso", $_SESSION["id_empresa"]);
                //$usuarios=TotalUsuarios($arreglo_post, $_SESSION["id_empresa"], $pagina, $usuarios_por_pagina);
                //$usuarios=SelectParaPaginacionUsuario("tbl_usuario", $_SESSION["id_empresa"], $usuarios_por_pagina);
                $PRINCIPAL = str_replace("{FILTROS_SUPERIORES}", file_get_contents("views/filtros/barra_superior_reportes_avances.html"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{BUSCADOR}", file_get_contents("views/buscador_personas/buscador.html"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ENVIRONMENT}", "veEvaluadorPorProceso&i=" . Encodear3($id_proceso), $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOMBRE_PROCESO}", utf8_encode($datos_proceso[0]->descripcion_proceso), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_PROCESO_ANUAL}", Encodear3($datos_proceso[0]->id_proceso_anual), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_PROCESO_EVAL}", Encodear3($id_proceso), $PRINCIPAL);
                //$usuarios=DatosParaListadoPaginado("tbl_sgd_proceso_anual", $_SESSION["id_empresa"], $usuarios_por_pagina, $pagina, $arreglo_post);
                //$usuarios=TraeRelacionesPorProceso($id_proceso, $usuarios_por_pagina, $pagina, $arreglo_post);
                //$usuarios=TraeEvaluadoresPorProceso($id_proceso, $usuarios_por_pagina, $pagina, $arreglo_post, $campo_criterio, $criterio, $valor_criterio, $campos_para_reporte);
                if ($campo_criterio) {
                    $registros_por_criterio = DistinctCampoUsuario($id_empresa, $campo_criterio);
                } else {
                    $usuarios = TraeEvaluadoresPorProceso3Campos($id_proceso, $usuarios_por_pagina, $pagina, $arreglo_post, $campo_criterio, $criterio, $valor_criterio, $campos_para_reporte, $datos_empresa);
                }
                $PRINCIPAL = str_replace("{ENCABEZADO_DINAMICO}", MuestraEncabezadoPorProceso($id_proceso), $PRINCIPAL);
                //$PRINCIPAL = str_replace("{PAGINACION}",ArmaPaginacionGenerico($pagina, "veEvaluadorPorProceso&i=".Encodear3($id_proceso), "tbl_sgd_relaciones", $usuarios_por_pagina, $arreglo_post, $_SESSION["id_empresa"], $id_proceso, "reporteEvaluador"),$PRINCIPAL);
                $PRINCIPAL = str_replace("{PAGINACION}", "", $PRINCIPAL);
                $total_empresas = "";
                if ($excel == 1) {
                    $html_row = file_get_contents("views/procesos/reportes/" . $id_empresa . "_row_listado_evaluador_por_proceso_fijacion_excel.html");
                } else {
                    $html_row = file_get_contents("views/procesos/reportes/" . $id_empresa . "_row_listado_evaluador_por_proceso_fijacion.html");
                }
                $i = 1;
                $valor_campo_criterio = "";
                $contador_campo_criterio = 0;
                $contador_criterios = 1;
                if ($campo_criterio) {
                    foreach ($registros_por_criterio as $unico) {
                        $row = file_get_contents("views/procesos/reportes/" . $id_empresa . "_row_listado_por_criterio_fijacion.html");
                        $row = str_replace("{N}", $i, $row);
                        $row = str_replace("{N}", $i, $row);
                        $row = str_replace("{VALOR_CRITERIO}", $unico->valor, $row);
                        //Ahora por cada criterio, traigo el listado de usuarios
                        $usuarios_por_criterio = TraeEvaluadoresPorProceso3Campos($id_proceso, "", "", "", "", $campo_criterio, $unico->valor, $campos_para_reporte, $datos_empresa);
                        $acumulador_avance_total = 0;
                        $acumulador_fijacion = 0;
                        $acumulador_validacion = 0;
                        $acumulador_reunion = 0;
                        foreach ($usuarios_por_criterio as $usuarios_unico_cri) {
                            $row_arreglo_datos = ColocaAvancesPorEvaluador($row, $usuarios_unico_cri->evaluador, $id_proceso, $id_empresa, "admin");
                            $acumulador_fijacion = $acumulador_fijacion + $row_arreglo_datos[0];
                            $acumulador_validacion = $acumulador_validacion + $row_arreglo_datos[1];
                            $acumulador_reunion = $acumulador_reunion + $row_arreglo_datos[2];
                            $acumulador_avance_total = $acumulador_avance_total + $row_arreglo_datos[4];
                        }
                        $row = str_replace("{CANTIDAD_EVALUADOS}", count($usuarios_por_criterio), $row);
                        $row = str_replace("{POR_1}", number_format($acumulador_fijacion / count($usuarios_por_criterio), 0), $row);
                        $row = str_replace("{POR_3}", number_format($acumulador_validacion / count($usuarios_por_criterio), 0), $row);
                        $row = str_replace("{AVANCE_DESCARGA_INFORMES}", number_format($acumulador_reunion / count($usuarios_por_criterio), 0), $row);
                        $row = str_replace("{AVANCE_TOTAL_FIJACION}", number_format($acumulador_avance_total / count($usuarios_por_criterio), 0), $row);
                        $i++;
                        $total_empresas .= $row;
                    }
                    $PRINCIPAL = str_replace("{LISTADO_AREAS_DATOS}", utf8_encode($total_empresas), $PRINCIPAL);
                } else {
                    foreach ($usuarios as $unico) {
                        $row = $html_row;
                        if ($pagina == 1) {
                            $row = str_replace("{N}", $i, $row);
                        } else {
                            $row = str_replace("{N}", $i + (($pagina - 1) * $usuarios_por_pagina), $row);
                        }
                        $i++;
                        $row = str_replace("{RUT_EVALUADOR}", $unico->rut_completo_evaluador, $row);
                        $row = str_replace("{FOTO_EVALUADOR}", VerificaFotoPersonalDesdeAdmin($unico->evaluador), $row);
                        $row = str_replace("{RUT_EVALUADOR_ENCODEADO}", Encodear3($unico->evaluador), $row);
                        $row = str_replace("{NOMBRE_EVALUADOR}", $unico->nombre_evaluador, $row);
                        $row = str_replace("{CARGO_EVALUADOR}", $unico->cargo_evaluador, $row);
                        $row = str_replace("{GERENCIA_EVALUADOR}", $unico->gerencia_evaluador, $row);
                        $row = str_replace("{GERENCIA_EVALUADOR}", $unico->gerencia_evaluador, $row);
                        $row = str_replace("{CAMPO1}", $unico->campo1, $row);
                        $row = str_replace("{CAMPO2}", $unico->campo2, $row);
                        $row = str_replace("{CAMPO3}", $unico->campo3, $row);
                        $row = str_replace("{CANTIDAD_EVALUADOS}", $unico->total_evaluados, $row);
                        $row = str_replace("{CAMBIO_CLAVE}", ColocaEtiquetaReportesSGD($unico->clave_creada, 1), $row);
                        $porcentaje_Avance_evaluador = AvanceDeEvaluados($unico->evaluador, $id_proceso, "", "");
                        $row = str_replace("{TOTAL_FINALIZADOS}", ColocarColoresConPorcentaje($porcentaje_Avance_evaluador[0]), $row);
                        $row = str_replace("{TOTAL_EN_PROCESO}", ColocaEtiquetaReportesSGD($unico->total_en_proceso + 0, $unico->total_evaluados), $row);
                        $row = str_replace("{ID_REGISTRO_FINALIZADO_EVALUADO_EVALUADOR}", Encodear3($unico->id_registro_finalizado), $row);
                        $row = str_replace("{ID_PROCESO_ENCODEADO}", Encodear3($id_proceso), $row);
                        $row = str_replace("{ID_PROCESO_ENCODEADO}", Encodear3($id_proceso), $row);
                        $row_arreglo_datos = ColocaAvancesPorEvaluador($row, $unico->evaluador, $id_proceso, $id_empresa, "admin");
                        $row = $row_arreglo_datos[3];
                        $total_empresas .= $row;
                    }
                }
                $PRINCIPAL = str_replace("{ROW_LISTADO_USUARIOS}", utf8_encode($total_empresas), $PRINCIPAL);
                /*if($excel==1){
            $PRINCIPAL = str_replace("{LISTADO_AREAS_DATOS}",utf8_decode($html_row_tabla_resumen),$PRINCIPAL);
        }else{
            $PRINCIPAL = str_replace("{LISTADO_AREAS_DATOS}",utf8_encode($html_row_tabla_resumen),$PRINCIPAL);
        }
         * */
                return ($PRINCIPAL);
            }

            function ColocaValoresGraficoIndicadores($GRAFICO, $valores, $matriz, $numero_series, $nombre_series, $titulo_grafico)
            {
                //print_r($matriz[1][valores]);exit;
                for ($i = 0; $i < count($valores); $i++) {
                    //$datos_arreglo.="['".devuelveNombreMes($valores[$i]->mes)."', ".$valores[$i]->resultadomes."]";
                    $datos_arreglo .= "['" . devuelveNombreMes($valores[$i]->mes) . "', ";
                    for ($k = 1; $k <= $numero_series; $k++) {
                        //print_r($matriz[$k][valores][$i]->resultadomes);exit;
                        $datos_arreglo .= $matriz[$k][valores][$i]->resultadomes . "";
                        if ($k < $numero_series) {
                            $datos_arreglo .= ", ";
                        }
                        //$datos_arreglo.="] ";
                    }
                    //if($i<(count($valores)-1)){
                    //    $datos_arreglo.=",";
                    //}
                    $datos_arreglo .= "] ";
                    //print_r($datos_arreglo);exit;
                    if ($i < count($valores) - 1) {
                        $datos_arreglo .= ", ";
                    }
                }
                for ($j = 1; $j <= $numero_series; $j++) {
                    $encabezado_series .= "'" . $nombre_series[$j] . "'";
                    if ($j < $numero_series) $encabezado_series .= ", ";
                }
                $GRAFICO = str_replace("{ARREGLO_DATOS}", $datos_arreglo, $GRAFICO);
                $GRAFICO = str_replace("{ARREGLO_SERIES}", $encabezado_series, $GRAFICO);
                $GRAFICO = str_replace("{TITULO_GRAFICO}", $titulo_grafico, $GRAFICO);
                $GRAFICO = str_replace("{MEDIDA}", $matriz[$k - 1][valores][$i - 1]->unidadmedida_indicador, $GRAFICO);
                return ($GRAFICO);
            }

            function MuestraIndicadores($PRINCIPAL, $valores, $matriz_con_datos, $numero_series, $nombre_series, $titulo_grafico)
            {
                //print_r($matriz_con_datos[1][valores][0]->mes);exit;
                //print_r($matriz_con_datos[1][valores]);exit;
                $datos = "<table class='table table-bordered table-hover'>
    <tr>
        <td>Mes</td>";
                for ($i = 1; $i <= $numero_series; $i++) {
                    $datos .= "<td>" . $nombre_series[$i] . "</td>";
                }
                $datos .= "</tr>";
                foreach ($valores as $val) {
                    $datos .= "<tr>
            <td>" . devuelveNombreMes($val->mes) . "</td>";
                    for ($i = 1; $i <= $numero_series; $i++) {
                        //$datos.="<td>{VALOR_".$val->mes."_".$i."}</td>";
                        $datos .= "<td>" . $matriz_con_datos[$i][valores][$val->mes - 1]->resultadomes . "</td>";
                    }
                    $datos .= "</tr>";
                }
                $datos .= "<table>";
                $PRINCIPAL = str_replace("{BLOQUE_DATA}", $datos, $PRINCIPAL);
                $PRINCIPAL = str_replace("{BLOQUE_GRAFICO}", ColocaValoresGraficoIndicadores(file_get_contents("views/graficos/grafico_lineal.html"), $valores, $matriz_con_datos, $numero_series, $nombre_series, $titulo_grafico), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function MuestraIndicadoresBK($PRINCIPAL, $valores, $matriz_con_datos, $numero_series)
            {
                $datos = "<table class='table table-bordered table-hover'>
    <tr>
        <td>Mes</td>";
                for ($i = 1; $i <= $numero_series; $i++) {
                    $datos .= "<td>Serie " . $i . "</td>";
                }
                $datos .= "</tr>";
                foreach ($valores as $val) {
                    $datos .= "<tr>
        <td>" . devuelveNombreMes($val->mes) . "</td>
        <td>" . $val->resultadomes . "</td>
        </tr>";
                }
                $datos .= "<table>";
                $PRINCIPAL = str_replace("{BLOQUE_DATA}", $datos, $PRINCIPAL);
                $PRINCIPAL = str_replace("{BLOQUE_GRAFICO}", ColocaValoresGraficoIndicadores(file_get_contents("views/graficos/grafico_lineal.html"), $valores), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function FiltrosIndicadores($PRINCIPAL, $post, $numero_series)
            {
                //FAMILIAS
                $familia = DistinctFamilia();
                foreach ($familia as $fam) {
                    if ($post["familia"] == $fam->familia) {
                        $options_familia .= "<option value='" . $fam->familia . "' selected>" . $fam->familia . "</option>";
                        $suma_filtros .= " " . utf8_encode($fam->familia) . "";
                    } else {
                        $options_familia .= "<option value='" . $fam->familia . "'>" . $fam->familia . "</option>";
                    }
                }
                $PRINCIPAL = str_replace("{OPTIONS_FAMILIA}", $options_familia, $PRINCIPAL);
                //SUBFAMILIAS
                $subfamilia = DistinctSubFamilia();
                foreach ($subfamilia as $subfam) {
                    if (utf8_decode($post["subfamilia"]) == $subfam->subfamilia) {
                        $options_subfamilia .= "<option value='" . $subfam->subfamilia . "' selected>" . $subfam->subfamilia . "</option>";
                        $suma_filtros .= " " . utf8_encode($subfam->subfamilia) . "";
                    } else {
                        $options_subfamilia .= "<option value='" . $subfam->subfamilia . "'>" . $subfam->subfamilia . "</option>";
                    }
                }
                $PRINCIPAL = str_replace("{OPTIONS_SUBFAMILIAS}", utf8_encode($options_subfamilia), $PRINCIPAL);
                //INDICADORES
                $indicadores = DistinctIndicadores();
                foreach ($indicadores as $ind) {
                    if (utf8_decode($post["indicadores"]) == $ind->nombre_indicador) {
                        $options_indicadores .= "<option value='" . $ind->nombre_indicador . "' selected>" . $ind->nombre_indicador . "</option>";
                        $suma_filtros .= " " . utf8_encode($ind->nombre_indicador) . "";
                    } else {
                        $options_indicadores .= "<option value='" . $ind->nombre_indicador . "'>" . $ind->nombre_indicador . "</option>";
                    }
                }
                $PRINCIPAL = str_replace("{OPTIONS_INDICADORES}", utf8_encode($options_indicadores), $PRINCIPAL);
                //GERENCIAS
                $options = "";
                $gerencias = DistinctGerencias();
                for ($i = 1; $i <= 3; $i++) {
                    $options = "";
                    foreach ($gerencias as $gen) {
                        if (($gen->nombre_gerencia) == utf8_decode($post["nombre_gerencia" . $i])) {
                            $options .= "<option value='" . $gen->nombre_gerencia . "' selected>" . $gen->nombre_gerencia . "</option>";
                            $suma_filtros_encabezados[$i] = $suma_filtros_encabezados[$i] . " " . utf8_encode($gen->nombre_gerencia) . "";
                        } else {
                            $options .= "<option value='" . $gen->nombre_gerencia . "'>" . $gen->nombre_gerencia . "</option>";
                        }
                    }
                    $PRINCIPAL = str_replace("{OPTIONS_GERENCIAS" . $i . "}", utf8_encode($options), $PRINCIPAL);
                }
                $options = "";
                //UNIDADES
                $unidades = DistinctUnidades();
                for ($i = 1; $i <= 3; $i++) {
                    $options = "";
                    foreach ($unidades as $uni) {
                        if ($uni->nombre_unidad == utf8_decode($post["nombre_unidad" . $i])) {
                            $options .= "<option selected value='" . $uni->nombre_unidad . "'>" . $uni->nombre_unidad . "</option>";
                            $suma_filtros_encabezados[$i] = $suma_filtros_encabezados[$i] . " " . utf8_encode($uni->nombre_unidad) . "";
                        } else {
                            $options .= "<option value='" . $uni->nombre_unidad . "'>" . $uni->nombre_unidad . "</option>";
                        }
                    }
                    $PRINCIPAL = str_replace("{OPTIONS_UNIDAD" . $i . "}", utf8_encode($options), $PRINCIPAL);
                }
                $options = "";
                //AÑOS
                $agnos = DistinctAgnos();
                for ($i = 1; $i <= 3; $i++) {
                    $options = "";
                    foreach ($agnos as $an) {
                        if ($an->anho == $post["agno" . $i]) {
                            $options .= "<option selected value='" . $an->anho . "'>" . $an->anho . "</option>";
                            $suma_filtros_encabezados[$i] = $suma_filtros_encabezados[$i] . " " . utf8_encode($an->anho) . "";
                        } else {
                            $options .= "<option value='" . $an->anho . "'>" . $an->anho . "</option>";
                        }
                    }
                    $PRINCIPAL = str_replace("{OPTIONS_AGNOS" . $i . "}", utf8_encode($options), $PRINCIPAL);
                }
                $PRINCIPAL = str_replace("{SUMA_FILTROS}", $suma_filtros, $PRINCIPAL);
                $arreglo[0] = $PRINCIPAL;
                $arreglo[1] = $suma_filtros_encabezados;
                $arreglo[2] = $suma_filtros;
                return ($arreglo);
            }

            function GeneraEstadisticasGeneralesPorCaseDetalle($PRINCIPAL, $id_empresa, $case)
            {
                //Traigo los distinct dado la empresa y elcase
                if ($case == "galeria") {
                } else {
                    $id = ESTADISTICAS_5($case, $id_empresa);
                }
                foreach ($id as $dato) {
                    $rows_ .= file_get_contents("views/estadisticas/row.html");
                    if ($case == "biblioteca") {
                        $estadosticas = ESTADISTICAS_6($dato->id_detalle, $case, $id_empresa);
                    } else if ($case == "detnot") {
                        $estadosticas = ESTADISTICAS_7($dato->id_detalle, $case, $id_empresa);
                    } else if ($case == "galeria") {
                        $estadosticas = ESTADISTICAS_8($dato->id_detalle, $case, $id_empresa);
                    }
                    $rows_ = str_replace("{VISITAS}", $estadosticas[0]->visitas_por_ambiente_home, $rows_);
                    $rows_ = str_replace("{HOME}", $case, $rows_);
                    $rows_ = str_replace("{CATEGORIA}", "", $rows_);
                    $rows_ = str_replace("{DETALLE}", utf8_decode($estadosticas[0]->nombre), $rows_);
                    $rows_ = str_replace("{VERDETALLE}", "", $rows_);
                }
                $PRINCIPAL = str_replace("{ROW_LISTADO_ESTADISTICAS}", utf8_encode($rows_), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function GeneraEstadisticasGeneralesPorCase($PRINCIPAL, $id_empresa, $fecha_inicio, $fecha_termino, $tipo_est)
            {
                $PRINCIPAL = ArmaGraficoVisitasAdmin($PRINCIPAL, $id_empresa, $tipo_est);
                $PRINCIPAL = ColocaAccesosPorEmpresa($PRINCIPAL, $id_empresa);
                $est_visitas = ESTADISTICAS_1_VISITAS($fecha_inicio, $fecha_termino, $id_empresa);
                $PRINCIPAL = str_replace("{ROW_LISTADO_ESTADISTICAS}", utf8_encode($rows_), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function TraeModalidad($modalidad)
            {
                if ($modalidad == "1") {
                    return "Presencial";
                }
                if ($modalidad == "2") {
                    return "Elearning";
                }
                if ($modalidad == "3") {
                    return "Blended";
                }
            }

            function FuncionIngresaInscripcion2BK($PRINCIPAL, $Empresa)
            {
                $Incripciones = TraeCursosEmpresa($Empresa);
                $rows_ = "";
                $rows1_ = "";
                foreach ($Incripciones as $unico) {
                    $rows_ = file_get_contents("views/inscripcion/row_listado_cursos.html");
                    $rows_ = str_replace("{ID}", $unico->id, $rows_);
                    $rows_ = str_replace("{CLASIFICACION}", $unico->clasificacion, $rows_);
                    $rows_ = str_replace("{CURSO}", $unico->nombre, $rows_);
                    $rows_ = str_replace("{ID_MALLA}", TraeMallaCurso($unico->id, $Empresa), $rows_);
                    $rows_ = str_replace("{VALORHORACURSO}", $unico->valor_hora, $rows_);
                    $rows_ = str_replace("{VALORTOTAL}", ($unico->numero_horas) * ($unico->valor_hora), $rows_);
                    $total_html .= $rows_;
                }
                $usuarios = TraeUsuariosCommboIn($Empresa);
                foreach ($usuarios as $unico1) {
                    $option .= '<option value="' . $unico1->rut . '">' . $unico1->nombre_completo . '</option>';
                }
                $PRINCIPAL = str_replace("{USUARIOS}", utf8_encode($option), $PRINCIPAL);
                $PRINCIPAL = str_replace("{IDEMPRESA}", $Empresa, $PRINCIPAL);
                $PRINCIPAL = str_replace("{ROW_LISTADO_CURSOS}", "Aca2.2" . utf8_encode($total_html), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            //INCRIPCIONES V8
            function ListaInscripcionesBK($PRINCIPAL, $Empresa, $registros_pagina, $registros_total, $pagina, $desde)
            {
                if ($registros_total == "") {
                    $registros_total = CuentaIncripcionEmpresa($Empresa);
                }
                if ($registros_pagina == "") {
                    $registros_pagina = 10;
                }
                if ($pagina == "") {
                    $pagina = 1;
                }
                if ($desde == "") {
                    $desde = 1;
                }
                $Incripciones = TraeIncripcionEmpresa($Empresa, $desde, $registros_pagina);
                $rows_ = "";
                $rows1_ = "";
                foreach ($Incripciones as $unico) {
                    $rows_ = file_get_contents("views/capacitacion/inscripcion/row_listado_inscripcion.html");
                    $rows_ = str_replace("{CODIGOINCRIPCION}", $unico->codigo_inscripcion, $rows_);
                    $rows_ = str_replace("{CLASIFICACION}", $unico->clasificacion, $rows_);
                    $rows_ = str_replace("{CURSO}", $unico->nombre, $rows_);
                    $rows_ = str_replace("{FECHA_INICIO}", $unico->fecha_inicio, $rows_);
                    $rows_ = str_replace("{FECHA_TERMINO}", $unico->fecha_termino, $rows_);
                    $rows_ = str_replace("{PARTICIPANTES}", Total_Participantes($Empresa, $unico->codigo_inscripcion), $rows_);
                    $Incripcion2 = Total_Inscripciones($Empresa, $unico->codigo_inscripcion);
                    $total_html2 = "";
                    $rows1_ = "";
                    $cuenta = "";
                    $total_costo = "";
                    $franquicia = "";
                    $costoempresa = "";
                    $viatico = "";
                    $movilizacion = "";
                    foreach ($Incripcion2 as $unico2) {
                        $cuenta++;
                        $rows1_ = file_get_contents("views/capacitacion/inscripcion/row_listado_inscripcion_totales.html");
                        $rows1_ = str_replace("{EMPRESAHOLDING}", $unico2->empresa_holding, $rows1_);
                        $rows1_ = str_replace("{COSTOTOTAL}", colocarPesos($unico2->costototal), $rows1_);
                        $rows1_ = str_replace("{FRANQUICIA}", colocarPesos($unico2->franquicia), $rows1_);
                        $rows1_ = str_replace("{COSTOEMPRESA}", colocarPesos($unico2->costo_empresa), $rows1_);
                        $rows1_ = str_replace("{VIATICO}", colocarPesos($unico2->viatico), $rows1_);
                        $rows1_ = str_replace("{MOVILIZACION}", colocarPesos($unico2->movilizacion), $rows1_);
                        $total_costo = $total_costo + ($unico2->costototal);
                        $franquicia = $franquicia + ($unico2->franquicia);
                        $costoempresa = $costoempresa + ($unico2->costo_empresa);
                        $viatico = $viatico + ($unico2->viatico);
                        $movilizacion = $movilizacion + ($unico2->movilizacion);
                        $total_html2 .= $rows1_;
                    }
                    $cab = '<table class="table table-bordered table-hover"><thead><tr>
                                                <th class="width40 bg_gray">Empresa</th>
                                                <th class="width100 bg_gray">Valor Total</th>
                                                <th class="width140 bg_gray">Franquicia</th>
                                                <th class="width140 bg_gray">Costo Empresa</th>
                                                <th class="width140 bg_gray">Viatico</th>
                                                <th class="width140 bg_gray">Movilizacion</th>
                                            </tr>
                                        </thead>
                                        <tbody>';
                    if ($cuenta > 1) {
                        $tr = ' <tr>
                            <td class="miniSt"><strong>Total</strong</td>
                            <td class="miniSt"><strong>' . colocarPesos($total_costo) . '</strong></td>
                            <td class="miniSt"><strong>' . colocarPesos($franquicia) . '</strong></td>
                            <td class="miniSt"><strong>' . colocarPesos($costoempresa) . '</strong></td>
                            <td class="miniSt"><strong>' . colocarPesos($viatico) . '</strong></td>
                            <td class="miniSt"><strong>' . colocarPesos($movilizacion) . '</strong></td>
                        </tr>';
                        $total_html2 .= $tr;
                    }
                    $rows_ = str_replace("{TABLA}", $cab . $total_html2 . "</tbody></table>", $rows_);
                    $fecha_actual = date("Y-m-d");
                    if ($unico->fecha_inicio > $fecha_actual) {
                        //no iniciado gris
                        $estado = '<i class="fa fa-circle text-default"></i>';
                        $estadonom = "No Iniciado";
                    }
                    if ($unico->fecha_inicio < $fecha_actual && $fecha_actual < $unico->fecha_termino) {
                        //en proceso amarilla
                        $estadonom = "En proceso";
                        $estado = '<i class="fa fa-circle text-warning"></i>';
                    }
                    if ($fecha_actual > $unico->fecha_termino && $cuenta == "") {
                        //terminada roja
                        $estadonom = "Terminada";
                        $estado = '<i class="fa fa-circle text-danger"></i>';
                    }
                    if ($fecha_actual > $unico->fecha_termino && $cuenta != "") {
                        //finalizada verde
                        $estadonom = "Finalizada";
                        $estado = '<i class="fa fa-circle text-success"></i>';
                    }
                    if ($unico->fecha_inicio == "") {
                        //simple celeste
                        $estadonom = "Libre";
                        $estado = '<i class="fa fa-circle text-info"></i>';
                    }
                    $rows_ = str_replace("{ESTADO}", $estado, $rows_);
                    $rows_ = str_replace("{ESTADONOMBRE}", $estadonom, $rows_);
                    $total_html .= $rows_;
                }
                $total_paginas = redondea($registros_total / $registros_pagina);
                $total_paginas_ = $registros_total / $registros_pagina;
                //Pagina Anterior
                $pagina_anterior = $pagina - 1;
                //Pagina Siguiente
                $posterior = $pagina + 1;
                if ($pagina > 1) {
                    //$row.=file_get_contents("views/dnc/row_fichacurso.html");
                    //$row = str_replace("{CURSO}",$unico->curso,$row);
                    //$paginacion.="<a href='?sw=".$env."&p=".($pagina-1)."'><<&nbsp;&nbsp;</a>";
                    $paginacion .= file_get_contents("views/paginacion/1.html");
                    $paginacion = str_replace("{ENV}", "listaInscripciones", $paginacion);
                    $paginacion = str_replace("{PAGINA}", ($pagina - 1), $paginacion);
                    $paginacion = str_replace("{PAGINAINICIAL}", "1", $paginacion);
                    $paginacion = str_replace("{REGISTROS}", round($registros_pagina), $paginacion);
                    $paginacion = str_replace("{DESDEINICIO}", 1, $paginacion);
                    $paginacion = str_replace("{DESDE}", round($desde) - $registros_pagina, $paginacion);
                    $paginacion = str_replace("{TOTALREGISTROS}", round($registros_total), $paginacion);
                }
                if (($pagina + 10) > $total_paginas) {
                    $resta = $pagina + 10;
                    $valor = ($pagina + 10) - $total_paginas;
                    $pagina1 = $pagina - $valor;
                } else {
                    $pagina1 = $pagina;
                }
                for ($i = $pagina1; $i <= round(($pagina1) + 10); $i++) {
                    if ($pagina == $i) {
                        //$paginacion.="<b><strong><span style='color:#000'>".$i."</span></strong></b>";
                        $paginacion .= file_get_contents("views/paginacion/actual.html");
                        $paginacion = str_replace("{PAGINA}", ($i), $paginacion);
                        $paginacion = str_replace("{ENV}", "listaInscripciones", $paginacion);
                    } else {
                        //$paginacion.="<a href='?sw=".$env."&p=".$i."'>".$i."</a></b>";
                        if ($desde1 == "") {
                            $desde1 = (($registros_pagina * $i) + 1) - $registros_pagina;
                        }
                        $paginacion .= file_get_contents("views/paginacion/numero.html");
                        $paginacion = str_replace("{PAGINA}", ($i), $paginacion);
                        $paginacion = str_replace("{REGISTROS}", round($registros_pagina), $paginacion);
                        $paginacion = str_replace("{DESDE}", $desde1, $paginacion);
                        $paginacion = str_replace("{TOTALREGISTROS}", round($registros_total), $paginacion);
                        $paginacion = str_replace("{ENV}", "listaInscripciones", $paginacion);
                    }
                    $desde1 = ($registros_pagina * $i) + 1;
                }
                if ($pagina < $total_paginas) {
                    //$paginacion.="<a href='?sw=".$env."&p=".($pagina+1)."'>&nbsp;&nbsp;>></a>";
                    $paginacion .= file_get_contents("views/paginacion/4.html");
                    $paginacion = str_replace("{ENV}", "listaInscripciones", $paginacion);
                    $paginacion = str_replace("{PAGINA}", ($pagina + 1), $paginacion);
                    $paginacion = str_replace("{PAGINAFINAL}", $total_paginas, $paginacion);
                    $paginacion = str_replace("{REGISTROS}", round($registros_pagina), $paginacion);
                    $paginacion = str_replace("{DESDE}", ($pagina * $registros_pagina) + 1, $paginacion);
                    $paginacion = str_replace("{DESDEFINAL}", (((int)($total_paginas_)) * $registros_pagina) + 1, $paginacion);
                    $paginacion = str_replace("{TOTALREGISTROS}", round($registros_total), $paginacion);
                }
                $PRINCIPAL = str_replace("{REGISTROS" . $registros_pagina . "}", "selected", $PRINCIPAL);
                $PRINCIPAL = str_replace("{PAGINACION}", $paginacion, $PRINCIPAL);
                $PRINCIPAL = str_replace("{RANGO_FECHAS}", "", $PRINCIPAL);
                $PRINCIPAL = str_replace("{RESUMEN}", "Hay un total de " . $registros_total . " Inscripciones", $PRINCIPAL);
                $PRINCIPAL = str_replace("{ROW_LISTADO}", utf8_encode($total_html), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function redondea($valor)
            {
                $valorentero = (int)$valor;
                $resto = $valor - $valorentero;
                if ($resto > 0) {
                    $valor = $valorentero + 1;
                } else {
                    $valor = (int)$valor;
                }
                return $valor;
            }

            //PARTICPANTES
            function ListaParticipantes($PRINCIPAL, $id_empresa, $registros_pagina, $registros_total, $pagina, $desde, $scampo1, $scampo2, $scampo3, $id_malla_)
            {
                //Traigo el total de empresas que existen en el sistema
                $Campos = TraeCampos($id_empresa);
                $Campos1 = $Campos[0]->campo1;
                $Campos2 = $Campos[0]->campo2;
                $Campos3 = $Campos[0]->campo3;
                if ($id_malla_ == "todas") {
                    $id_malla_1 = $id_malla_;
                    $id_malla_ = "";
                } else {
                    $id_malla_1 = $id_malla_;
                }
                if ($scampo1 == "todos") {
                    $scampo1_ = $scampo1;
                    $scampo1 = "";
                } else {
                    $scampo1_ = $scampo1;
                }
                if ($scampo2 == "todos") {
                    $scampo2 = "";
                } else {
                    $scampo2_ = $scampo2;
                }
                if ($scampo3 == "todos") {
                    $scampo3_ = $scampo3;
                    $scampo3 = "";
                } else {
                    $scampo3_ = $scampo3;
                }
                if ($registros_total == "") {
                    $registros_total = CuentaParticipantesEmpresa($id_empresa, $Campos1, $Campos2, $Campos3, $scampo1, $scampo2, $scampo3, $id_malla_);
                }
                if ($registros_pagina == "") {
                    $registros_pagina = 10;
                }
                if ($pagina == "") {
                    $pagina = 1;
                }
                if ($desde == "") {
                    $desde = 0;
                }
                $total_html = "";
                $i = 1;
                $pi = 0;
                $participantes = TraeParticipantes($id_empresa, $Campos1, $Campos2, $Campos3, $desde, $registros_pagina, $scampo1, $scampo2, $scampo3, $id_malla_);
                $ACampo1 = array();
                $ACampo2 = array();
                $ACampo3 = array();
                $mallas = TraeMallasEmpresa($id_empresa);
                //$options_mallas.=('<option value="">SIN MALLA</option>');
                foreach ($mallas as $ma) {
                    $options_mallas .= ('<option value="' . $ma->id . '">' . $ma->nombre . '</option>');
                }
                foreach ($participantes as $unico) {
                    $row = file_get_contents("views/capacitacion/participantes/row_personas.html");
                    $row = str_replace("{FOTO}", VerificaFotoPersonalDesdeAdmin($unico->rut), $row);
                    $row = str_replace("{RUT}", $unico->rut, $row);
                    $row = str_replace("{NOMBRE}", $unico->nombre, $row);
                    $row = str_replace("{PATERNO}", $unico->apaterno, $row);
                    $row = str_replace("{MATERNO}", $unico->amaterno, $row);
                    $row = str_replace("{CARGO1}", $unico->cargo, $row);
                    $row = str_replace("{EMAIL}", $unico->email, $row);
                    $row = str_replace("{CAMPO1}", $unico->campo1, $row);
                    $row = str_replace("{CAMPO2}", $unico->campo2, $row);
                    $row = str_replace("{CAMPO3}", $unico->campo3, $row);
                    $ACampo1[$pi] = $unico->campo1;
                    $ACampo2[$pi] = $unico->campo2;
                    $ACampo3[$pi] = $unico->campo3;
                    $row = str_replace("{NCAMPO1}", str_replace("_", " ", ucwords($Campos1)), $row);
                    $row = str_replace("{NCAMPO2}", str_replace("_", " ", ucwords($Campos2)), $row);
                    $row = str_replace("{NCAMPO3}", str_replace("_", " ", ucwords($Campos3)), $row);
                    $row = str_replace("{MALLA}", $unico->malla, $row);
                    $row = str_replace("{ID_MALLA}", $unico->id_malla, $row);
                    $row = str_replace("{OPTIONSMALLAS}", $options_mallas, $row);
                    //$selected.='<script>
                    //$("#'.$unico->rut.'").val("'.$unico->idmalla.'");
                    //</script>';
                    $row = str_replace("{SCRIPT}", "", $row);
                    //obtener numero de cursos
                    $Cursos = TraeCursosInscritosMallaParticipante($id_empresa, $unico->id_malla, $unico->rut);
                    $CuentaC = 0;
                    $S = "";
                    $CuentaA = "";
                    $CuentaR = "";
                    $R = "";
                    foreach ($Cursos as $cur) {
                        $CuentaC++;
                        if ($CuentaC > 1) {
                            $S = "s";
                        }
                        $Consulta = ConsultaCursoCierreMalla($id_empresa, $unico->rut, $cur->id_curso);
                        if (($Consulta[0]->id) != "") {
                            $CuentaR++;
                        }
                        if (($Consulta[0]->estado) == "1") {
                            $CuentaA++;
                        }
                        if ($Consulta == "1" || $Consulta == "0") {
                            $R++;
                        }
                    }
                    //Avance
                    $avance = round((100 * $CuentaA) / $CuentaC);
                    $avanceCursos = round((100 * $CuentaR) / $CuentaC);
                    // if ($avance==100){
                    // $AC="0, 166, 90";
                    // $AC2="#00a65a";
                    // }else{
                    $AC = "60, 141, 188";
                    $AC2 = "#3c8dbc";
                    // }
                    $row = str_replace("{AVANCE}", round((100 * $CuentaA) / $CuentaC), $row);
                    $row = str_replace("{AVANCEC}", $AC, $row);
                    $row = str_replace("{AVANCECURSO}", $avanceCursos, $row);
                    $row = str_replace("{AVANCEC2}", $AC2, $row);
                    $row = str_replace("{S}", $S, $row);
                    $row = str_replace("{REALIZADO}", $R, $row);
                    $row = str_replace("{CURSOS}", $CuentaC, $row);
                    $row = str_replace("{OPCIONES}", "", $row);
                    $total_html .= $row;
                    $pi++;
                }
                $total_paginas = redondea($registros_total / $registros_pagina);
                $total_paginas_ = $registros_total / $registros_pagina;
                //Pagina Anterior
                $pagina_anterior = $pagina - 1;
                //Pagina Siguiente
                $posterior = $pagina + 1;
                if ($pagina > 1) {
                    //$row.=file_get_contents("views/dnc/row_fichacurso.html");
                    //$row = str_replace("{CURSO}",$unico->curso,$row);
                    //$paginacion.="<a href='?sw=".$env."&p=".($pagina-1)."'><<&nbsp;&nbsp;</a>";
                    $paginacion .= file_get_contents("views/paginacion/1.html");
                    $paginacion = str_replace("{ENV}", "listparticipantes&c1=" . $scampo1 . "&c2=" . $scampo2 . "&c3=" . $scampo3 . "", $paginacion);
                    $paginacion = str_replace("{PAGINA}", ($pagina - 1), $paginacion);
                    $paginacion = str_replace("{PAGINAINICIAL}", "1", $paginacion);
                    $paginacion = str_replace("{REGISTROS}", round($registros_pagina), $paginacion);
                    $paginacion = str_replace("{DESDEINICIO}", 1, $paginacion);
                    $paginacion = str_replace("{DESDE}", round($desde) - $registros_pagina, $paginacion);
                    $paginacion = str_replace("{TOTALREGISTROS}", round($registros_total), $paginacion);
                }
                $Cnum = 10;
                if ($Cnum > $total_paginas) {
                    $Cnum = $total_paginas;
                }
                if (($pagina + $Cnum) > $total_paginas) {
                    $resta = $pagina + $Cnum;
                    $valor = ($pagina + $Cnum) - $total_paginas;
                    $pagina1 = $pagina - $valor;
                } else {
                    $pagina1 = $pagina;
                }
                for ($i = $pagina1; $i <= round(($pagina1) + $Cnum); $i++) {
                    if ($i != 0) {
                        if ($pagina == $i) {
                            //$paginacion.="<b><strong><span style='color:#000'>".$i."</span></strong></b>";
                            $paginacion .= file_get_contents("views/paginacion/actual.html");
                            $paginacion = str_replace("{PAGINA}", ($i), $paginacion);
                            $paginacion = str_replace("{ENV}", "listparticipantes", $paginacion);
                        } else {
                            //$paginacion.="<a href='?sw=".$env."&p=".$i."'>".$i."</a></b>";
                            $paginacion .= file_get_contents("views/paginacion/numero.html");
                            $paginacion = str_replace("{PAGINA}", ($i), $paginacion);
                            $paginacion = str_replace("{REGISTROS}", round($registros_pagina), $paginacion);
                            if ($desde1 == "") {
                                $desde1 = (($registros_pagina * $i) + 1) - $registros_pagina;
                            }
                            $paginacion = str_replace("{DESDE}", $desde1, $paginacion);
                            $paginacion = str_replace("{TOTALREGISTROS}", round($registros_total), $paginacion);
                            $paginacion = str_replace("{ENV}", "listparticipantes&c1=" . $scampo1 . "&c2=" . $scampo2 . "&c3=" . $scampo3 . "", $paginacion);
                        }
                        $desde1 = ($registros_pagina * $i) + 1;
                    }
                }
                if ($pagina < $total_paginas) {
                    //$paginacion.="<a href='?sw=".$env."&p=".($pagina+1)."'>&nbsp;&nbsp;>></a>";
                    $paginacion .= file_get_contents("views/paginacion/4.html");
                    $paginacion = str_replace("{ENV}", "listparticipantes&c1=" . $scampo1 . "&c2=" . $scampo2 . "&c3=" . $scampo3 . "", $paginacion);
                    $paginacion = str_replace("{PAGINA}", ($pagina + 1), $paginacion);
                    $paginacion = str_replace("{PAGINAFINAL}", $total_paginas, $paginacion);
                    $paginacion = str_replace("{REGISTROS}", round($registros_pagina), $paginacion);
                    $paginacion = str_replace("{DESDE}", ($pagina * $registros_pagina) + 1, $paginacion);
                    $paginacion = str_replace("{DESDEFINAL}", (((int)($total_paginas_)) * $registros_pagina) + 1, $paginacion);
                    $paginacion = str_replace("{TOTALREGISTROS}", round($registros_total), $paginacion);
                }
                $PRINCIPAL = str_replace("{REGISTROS" . $registros_pagina . "}", "selected", $PRINCIPAL);
                $PRINCIPAL = str_replace("{PAGINACION}", $paginacion, $PRINCIPAL);
                $PRINCIPAL = str_replace("{RESUMEN}", "Hay un total de " . $registros_total . " Participantes", $PRINCIPAL);
                // AGRUPACION DE RESULTADOS PARA SELECT
                //$AgrupaCampo1=array_unique($ACampo1);
                //  foreach($AgrupaCampo1 as $C1){
                //    $OPCION1.='<option value="'.$C1.'">'.$C1.'</option>';
                // }
                // $AgrupaCampo2=array_unique($ACampo2);
                //   foreach($AgrupaCampo2 as $C2){
                //    $OPCION2.='<option value="'.$C2.'">'.$C2.'</option>';
                //  }
                // $AgrupaCampo3=array_unique($ACampo3);
                //   foreach($AgrupaCampo3 as $C3){
                //  $OPCION3.='<option value="'.$C3.'">'.$C3.'</option>';
                //  }
                $AgrupaCampo1 = AgrupaCampos($Campos1, $id_empresa);
                foreach ($AgrupaCampo1 as $C1) {
                    if ($C1->campo == $scampo1_) {
                        $selec = "selected";
                    } else {
                        $selec = "";
                    };
                    $OPCION1 .= '<option ' . $selec . ' value="' . $C1->campo . '">' . $C1->campo . '</option>';
                }
                $AgrupaCampo2 = AgrupaCampos($Campos2, $id_empresa);
                foreach ($AgrupaCampo2 as $C2) {
                    if ($C2->campo == $scampo2_) {
                        $selec2 = "selected";
                    } else {
                        $selec2 = "";
                    }
                    $OPCION2 .= '<option ' . $selec2 . ' value="' . $C2->campo . '">' . $C2->campo . '</option>';
                }
                $AgrupaCampo3 = AgrupaCampos($Campos3, $id_empresa);
                foreach ($AgrupaCampo3 as $C3) {
                    if ($C3->campo == $scampo3_) {
                        $selec3 = "selected";
                    } else {
                        $selec3 = "";
                    };
                    $OPCION3 .= '<option ' . $selec3 . ' value="' . $C3->campo . '">' . $C3->campo . '</option>';
                }
                //NOMBRE CAMPO TABLA
                $PRINCIPAL = str_replace("{CAMPO1}", $Campos1, $PRINCIPAL);
                $PRINCIPAL = str_replace("{CAMPO2}", $Campos2, $PRINCIPAL);
                $PRINCIPAL = str_replace("{CAMPO3}", $Campos3, $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_EMPRESA}", $id_empresa, $PRINCIPAL);
                //OPCIONS DE SELECT
                $PRINCIPAL = str_replace("{CAMPO1OP}", utf8_encode($OPCION1), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CAMPO2OP}", utf8_encode($OPCION2), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CAMPO3OP}", utf8_encode($OPCION3), $PRINCIPAL);
                //NOMBRE FORMATEADO
                $PRINCIPAL = str_replace("{NCAMPO1}", str_replace("_", " ", ucwords($Campos1)), $PRINCIPAL);
                $PRINCIPAL = str_replace("{NCAMPO2}", str_replace("_", " ", ucwords($Campos2)), $PRINCIPAL);
                $PRINCIPAL = str_replace("{NCAMPO3}", str_replace("_", " ", ucwords($Campos3)), $PRINCIPAL);
                $PRINCIPAL = str_replace("{FILTROMALLAS}", utf8_encode($options_mallas), $PRINCIPAL);
                $selected .= '<script>
            $("#filtro_malla").val("' . $id_malla_ . '");
        </script>';
                $PRINCIPAL = str_replace("{SCRIPTFILTRO}", $selected, $PRINCIPAL);
                $PRINCIPAL = str_replace("{ROW_LISTADO_PARTICIPANTES}", utf8_encode($total_html), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function crear_boton_orden($url, $total, $anterior, $tabla, $campo)
            {
                $btn = "";
                if ($anterior == 1) {
                    $orden = $anterior + 1;
                    $btn = '<a href="' . $url . '&total=' . $total . '&orden_anterior=' . $anterior . '&orden=' . $orden . '&tabla=' . $tabla . '&campo=' . $campo . '" class="pull-right"><i class="fa fa-fw fa-arrow-down"></i></a>';
                } else if ($total == $anterior) {
                    $orden = $anterior - 1;
                    $btn = '<a href="' . $url . '&total=' . $total . '&orden_anterior=' . $anterior . '&orden=' . $orden . '&tabla=' . $tabla . '&campo=' . $campo . '" class="pull-right"><i class="fa fa-fw fa-arrow-up"></i></a>';
                } else {
                    $bajar = $anterior - 1;
                    $subir = $anterior + 1;
                    $btn = '<a href="' . $url . '&total=' . $total . '&orden_anterior=' . $anterior . '&orden=' . $subir . '&tabla=' . $tabla . '&campo=' . $campo . '" class="pull-right"><i class="fa fa-fw fa-arrow-down"></i></a>';
                    $btn .= '<a href="' . $url . '&total=' . $total . '&orden_anterior=' . $anterior . '&orden=' . $bajar . '&tabla=' . $tabla . '&campo=' . $campo . '" class="pull-right"><i class="fa fa-fw fa-arrow-up"></i></a>';
                }
                return $btn;
            }

            function LmsexportarImparticionesXLS_fn($PRINCIPAL, $id_empresa, $excel)
            {
                $cursos = LmsexportarImparticionesXLS_fn_data($id_empresa);
                $total_html = "";
                $i = 1;
                //print_r($cursos);
                foreach ($cursos as $unico) {
                    $row .= file_get_contents("views/capacitacion/curso/row_listado_imparticiones_excel.html");
                    if ($unico->modalidadcurso == 1) {
                        $mod = "Elearning";
                    }
                    if ($unico->modalidadcurso == 2) {
                        $mod = "Presencial";
                    }
                    $row = str_replace("{id}", $unico->id, $row);
                    $row = str_replace("{nombre}", ($unico->nombrecurso), $row);
                    $row = str_replace("{descripcion}", ($unico->descripcioncurso), $row);
                    $row = str_replace("{modalidad}", $mod, $row);
                    $row = str_replace("{id_foco}", $unico->idfococurso, $row);
                    $row = str_replace("{Foco}", ($unico->Foco), $row);
                    $row = str_replace("{id_empresa_programa}", $unico->idprogramacurso, $row);
                    $row = str_replace("{Programa}", ($unico->Programa), $row);
                    $row = str_replace("{id_inscripcion}", ($unico->id), $row);
                    $row = str_replace("{fechainicio}", ($unico->fecha_inicio), $row);
                    $row = str_replace("{fechatermino}", ($unico->fecha_termino), $row);
                    $row = str_replace("{direccion}", ($unico->direccion), $row);
                    $row = str_replace("{ciudad}", ($unico->ciudad), $row);
                    $row = str_replace("{cupos}", ($unico->cupos), $row);
                    $row = str_replace("{sesiones}", ($unico->sesiones), $row);
                    $row = str_replace("{ejecutivo}", ($unico->ejecutivo), $row);
                    $row = str_replace("{participantes}", ($unico->participantes), $row);
//    echo "<br>".$unico->id;
                }
                $PRINCIPAL = str_replace("{ROW_LISTADO_IMPARTICIONES_EXCEL}", ($row), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function LmsexportarCursosXLS_fn($PRINCIPAL, $id_empresa, $excel)
            {
                $cursos = LmsexportarCursosXLS_fn_data($id_empresa);
                $total_html = "";
                $i = 1;
                foreach ($cursos as $unico) {
                    $row .= file_get_contents("views/capacitacion/curso/row_listado_cursos_excel.html");
                    if ($unico->modalidad == 1) {
                        $mod = "Elearning";
                    }
                    if ($unico->modalidad == 2) {
                        $mod = "Presencial";
                    }
                    $row = str_replace("{id}", $unico->id, $row);
                    $row = str_replace("{nombre}", ($unico->nombre), $row);
                    $row = str_replace("{descripcion}", strip_tags($unico->descripcion), $row);
                    $row = str_replace("{modalidad}", $mod, $row);
                    $row = str_replace("{NumImparticiones}", $unico->NumImparticiones, $row);
                    $row = str_replace("{id_foco}", $unico->id_foco, $row);
                    $row = str_replace("{Foco}", ($unico->Foco), $row);
                    $row = str_replace("{id_empresa_programa}", $unico->id_empresa_programa, $row);
                    $row = str_replace("{Programa}", ($unico->Programa), $row);
                }
                $PRINCIPAL = str_replace("{ROW_LISTADO_CURSOS_EXCEL}", ($row), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function ListadoCursosAdmin2T($PRINCIPAL, $id_empresa, $excel, $id_curso, $llamada)
            {
                //echo "$id_empresa, excel $excel, $id_curso, $llamada";
                $cursos = TotalCursosParaPaginacionT($id_empresa, $id_curso, $llamada);
                $total_html = "";
                $i = 1;
                foreach ($cursos as $unico) {
                    if ($excel == 1) {
                        $row = file_get_contents("views/capacitacion/cursoT/row_listado_excel.html");
                    } else if ($llamada == "imparticion_solo_preenciales") {
                        $row = file_get_contents("views/capacitacion/cursoT/row_listado_imparticion.html");
                    } else {
                        $row = file_get_contents("views/capacitacion/cursoT/row_listado.html");
                    }
                    $row = str_replace("{NUMERO}", $i, $row);
                    $i++;
                    $row = str_replace("{CODIGO}", "<span class='label bg-blue'>" . $unico->numero_identificador . "</span>", $row);
                    $row = str_replace("{CODIGO_CURSO}", "<span class='label bg-blue'>" . $unico->id . "</span>", $row);
                    $row = str_replace("{ID_CURSO}", $unico->id, $row);
                    $row = str_replace("{CODIGO_ENCODEADO}", Encodear($unico->id), $row);
                    $row = str_replace("{NOMBRE}", $unico->nombre, $row);
                    $row = str_replace("{NOMBRE_XLS}", ($unico->nombre), $row);
                    $row = str_replace("{FOCO}", $unico->nombre_foco, $row);
                    $row = str_replace("{FOCO_XLS}", ($unico->nombre_foco), $row);
                    $busca_imparticiones_array = BuscaIdImparticiondadoCursoT($unico->id, $id_empresa);
                    if (count($busca_imparticiones_array) > 0) {
                        $row = str_replace("{EJECUTIVO}", $unico->ejecutivo, $row);
                    } else {
                        $row = str_replace("{EJECUTIVO}", "[SIN EJECUTIVO]", $row);
                    }
                    $row = str_replace("{EJECUTIVO_XLS}", ($unico->ejecutivo), $row);
                    $row = str_replace("{PROGRAMA}", $unico->nombre_programa, $row);
                    $row = str_replace("{PROGRAMA_XLS}", ($unico->nombre_programa), $row);
                    $row = str_replace("{DESCRIPCION}", $unico->descripcion, $row);
                    $row = str_replace("{OBJETIVO_CURSO}", $unico->objetivo_curso, $row);
                    $row = str_replace("{CLASIFICACION}", $unico->nombre_clasificacion, $row);
                    //$row = str_replace("{NUM_IMPARTICIONES}",$unico->total_inscripciones_curso,$row);
                    //print_r($busca_imparticion_array);
                    $lista_imparticion = "";
                    $lista_imparticion_xls = "";
                    $suma_asistentes = 0;
                    $cuentaimp = 0;
                    //print_r($busca_imparticiones_array);
                    foreach ($busca_imparticiones_array as $buscimpart) {
                        $cuenta_Asistententes = BuscaAsistentesImparticion($buscimpart->codigo_inscripcion, $id_empresa);
                        $cuentaimp++;
                        $lista_imparticion .= $buscimpart->codigo_inscripcion . " (" . $cuenta_Asistententes[0]->asistentes . " Inscritos)
                <a href='?sw=DescargaPresencialImparticion&idc=" . Encodear($unico->id) . "' title='Descargar Participantes a Excel'>
                <i class='fas fa-cloud-download-alt'></i></a><br>";
                        $lista_imparticion_xls .= $buscimpart->codigo_inscripcion . ",";
                    }
                    //cuentaparticipantes
                    //$cuenta_Asistententes=BuscaAsistentesCursoImparticion($unico->id, $id_empresa);
                    $Asistententes = $cuenta_Asistententes[0]->asistentes;
                    $row = str_replace("{NUM_IMPARTICIONES}", $lista_imparticion, $row);
                    $row = str_replace("{NUM_IMPARTICIONES_XLS}", $lista_imparticion_xls, $row);
                    if ($unico->nombre_modalidad == "Presencial" and $cuentaimp > 0) {
                        $boton_ver = "<a href='?sw=listaInscripciones2&i=" . Encodear($unico->id) . "'  data-placement='left' title='Ver_Imparticiones'>
            Ver_Imparticiones</a>";
                    } else {
                        $boton_ver = "";
                    }
                    $row = str_replace("{VER_IMPARTICIONES}", $boton_ver, $row);
                    $row = str_replace("{SENCE}", $unico->sence, $row);
                    $row = str_replace("{PARTICIPANTES_MAX}", $unico->cantidad_maxima_participantes, $row);
                    $row = str_replace("{OTEC}", $unico->nombre_otec, $row);
                    $row = str_replace("{CBC}", $unico->cbc, $row);
                    $row = str_replace("{MODALIDAD}", "<span class='label bg-blue'>" . $unico->nombre_modalidad . "</span>", $row);
                    //$row = str_replace("{TIPO}",$unico->tipo,$row);
                    $row = str_replace("{TIPO}", $unico->nombre_tipo_curso, $row);
                    $row = str_replace("{PREREQUISITOS}", $unico->prerequisito, $row);
                    $preinscritos = "";
                    $postulantes = "";
                    $asistentes = "";
                    if ($unico->total_inscripciones_curso == 0) {
                        $inscritos = "<strong>0</strong> Inscritos";
                        if ($unico->nombre_modalidad == "Presencial") {
                            $preinscritos = "<br><strong>0</strong> Preinscritos";
                            $postulantes = "<br><strong>0</strong> Postulantes";
                        }
                    } else {
                        $inscritos = "<strong>" . $unico->inscritos . "</strong> Inscritos";
                        if ($unico->nombre_modalidad == "Presencial") {
                            if ($unico->preinscritos > 0) {
                                $preinscritos = "<br><strong>" . $unico->preinscritos . "</strong> Preinscritos";
                            } else {
                                $preinscritos = "<br><strong>0</strong> Preinscritos";
                            }
                            if ($unico->postulantes > 0) {
                                $postulantes = "<br><strong>" . $unico->postulantes . "</strong> Postulantes";
                            } else {
                                $postulantes = "";
                            }
                            if ($Asistententes > 0) {
                                $asistentes = "<br><strong>" . $Asistententes . "</strong> Asistentes";
                            } else {
                                $asistentes = "<br><strong>0</strong> Asistentes";
                            }
                        }
                    }
                    $row = str_replace("{INSCRITOS}", $inscritos, $row);
                    $row = str_replace("{PREINSCRITOS}", $preinscritos, $row);
                    $row = str_replace("{POSTULANTES}", $postulantes, $row);
                    $row = str_replace("{ASISTENTES}", $asistentes, $row);
                    $row = str_replace("{NUM_INSCRITOS}", $unico->inscritos, $row);
                    $row = str_replace("{NUM_PREINSCRITOS}", $unico->preinscritos, $row);
                    $row = str_replace("{NUM_POSTULANTES}", $unico->postulantes, $row);
                    $row = str_replace("{NUM_ASISTENTES}", $Asistententes, $row);
                    //Por cada curso, traigl el total de programas asociados desde rel lms malla curso
                    $programas = TraeProgramasUnicosDadoCursoDeRelMallaCurso($id_empresa, $unico->id);
                    $acumulador_programas = "";
                    foreach ($programas as $prog) {
                        $acumulador_programas .= $prog->nombre_programa . "<br>";
                    }
                    $row = str_replace("{PROGRAMAS_ASOCIADOS}", $acumulador_programas, $row);
                    $row = str_replace("{PROGRAMA_BBDD_ENCODEADO}", Encodear3($programas[0]->id_programa), $row);
                    $row = str_replace("{VALOR_HORA}", colocarPesos($unico->valor_hora), $row);
                    if ($unico->imagen && file_exists("../front/img/logos_cursos/" . $unico->imagen)) {
                        $row = str_replace("{IMAGEN}", "<img src='../front/img/logos_cursos/" . $unico->imagen . "' width='50' >", $row);
                    } else {
                        $row = str_replace("{IMAGEN}", "", $row);
                    }
                    $row = str_replace("{VALOR_HORA_SENCE}", colocarPesos($unico->valor_hora_sence), $row);
                    $row = str_replace("{NUM_HORAS}", $unico->numero_horas, $row);
                    $row = str_replace("{VALOR_CURSO}", colocarPesos($unico->numero_horas * $unico->valor_hora), $row);
                    $row = str_replace("{EJECUTIVO}", ($unico->ejecutivocapacitacion), $row);
                    $row = str_replace("{PARTICIPANTE}", ($unico->participantes), $row);
                    $row = str_replace("{VALOR_CURSO}", colocarPesos($unico->numero_horas * $unico->valor_hora), $row);
                    $row = str_replace("{FECHAI}", ($unico->fecha_inicio), $row);
                    $row = str_replace("{FECHAT}", ($unico->fecha_finalizacion), $row);
                    $total_html .= $row;
                }
                $PRINCIPAL = str_replace("{ROW_LISTADO}", utf8_encode($total_html), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ROW_LISTADO_xls}", ($total_html), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function ListadoCursosAdmin2Elearning($PRINCIPAL, $id_empresa, $excel, $id_curso, $llamada)
            {
                //echo "$id_empresa, excel $excel, $id_curso, $llamada";
                $cursos = TotalCursosParaPaginacion2Elearning($id_empresa, $id_curso, $llamada);
                $total_html = "";
                $i = 1;

                //print_r($cursos);
                foreach ($cursos as $unico) {
                    if ($excel == 1) {
                        $row = file_get_contents("views/capacitacion/cursoelearning/row_listado_excel.html");
                    } else if ($llamada == "imparticion_solo_preenciales") {
                        $row = file_get_contents("views/capacitacion/cursoelearning/row_listado_imparticion.html");
                    } else {
                        $row = file_get_contents("views/capacitacion/cursoelearning/row_listado.html");
                    }
                    $row = str_replace("{NUMERO}", $i, $row);
                    $i++;
                    $row = str_replace("{CODIGO}", "<span class='label bg-blue'>" . $unico->numero_identificador . "</span>", $row);

                    if ($unico->tipo == "2") {
                        $row = str_replace("{TIPO_CURSO}", "<br><br><span class='badge badge-pill-gray02'>Curso_Externo</span>", $row);
                        $link_inscripcion = "<a href='?sw=listProgramaCursoAsistenciaExts&id_curso=" . $unico->id . "'
         data-placement='left' title='Inscribir Participantes'>Asistencia Nota</a>";
                    } else {
                        $row = str_replace("{TIPO_CURSO}", "", $row);

                        $link_inscripcion = "<a href='?sw=listProgramas&id_programa={ID_PROGRAMA}'
         data-placement='left' title='Inscribir Participantes'>Inscripcion</a>";
                    }


                    $row = str_replace("{CODIGO_CURSO}", "<span class='label bg-blue'>" . $unico->id . "</span>", $row);
                    $row = str_replace("{CODIGO_ENCODEADO}", Encodear($unico->id), $row);
                    $row = str_replace("{NOMBRE}", $unico->nombre, $row);
                    $row = str_replace("{NOMBRE_XLS}", ($unico->nombre), $row);
                    $row = str_replace("{FOCO}", $unico->foco, $row);
                    $row = str_replace("{FOCO_XLS}", ($unico->foco), $row);

                    $row = str_replace("{INSCRIPCION_ASISTENCIA}", ($link_inscripcion), $row);


                    $busca_imparticiones_array = BuscaIdImparticiondadoCurso($unico->id, $id_empresa);
                    $objeto_arreglo = "";
                    $objetos = BuscaObjetosDadoIdCurso($unico->id);
                    foreach ($objetos as $objeto) {
                        if ($objeto->tipo_objeto == 5) {
                            $tipo_objeto = "<span class='btn btn-warning btn-xs'>EVALUACION</span>";
                        } else {
                            $tipo_objeto = "<span class='btn btn-info btn-xs'>MODULO</span>";
                        }
                        $objeto_arreglo .= $tipo_objeto . " " . $objeto->orden . "_" . $objeto->titulo . "_" . $objeto->titulo . "_(" . $objeto->id . ")<br>";
                    }

                    //Busca Programas Elearning dado curso desde rel-lms-malla-curso
                    $ProgramasElearning = BuscaProgramasDadoIdCurso($unico->id, $id_empresa);
                    $programas_elearning = "";
                    foreach ($ProgramasElearning as $unicoPe) {
                        $programas_elearning .= "" . $unicoPe->programa . " ";
                    }

                    $row = str_replace("{EJECUTIVO}", $unico->ejecutivo, $row);
                    $row = str_replace("{MODULOS}", $objeto_arreglo, $row);
                    $row = str_replace("{RUT_EJECUTIVO_XLS}", ($unico->rut_ejecutivo), $row);
                    $row = str_replace("{EJECUTIVO_XLS}", ($unico->ejecutivo), $row);
                    $row = str_replace("{PROGRAMA}", $unico->programa_global, $row);
                    $row = str_replace("{ID_PROGRAMA}", $unico->id_programa, $row);
                    $row = str_replace("{PROGRAMA_XLS}", ($unico->programa_global), $row);
                    $row = str_replace("{PROGRAMA_ELEARNING}", ($programas_elearning), $row);
                    $row = str_replace("{PROGRAMA_ELEARNING_XLS}", ($programas_elearning), $row);
                    $row = str_replace("{DESCRIPCION}", $unico->descripcion, $row);
                    $row = str_replace("{OBJETIVO_CURSO}", $unico->objetivo_curso, $row);
                    $row = str_replace("{CLASIFICACION}", $unico->nombre_clasificacion, $row);
                    //$row = str_replace("{NUM_IMPARTICIONES}",$unico->total_inscripciones_curso,$row);
                    //print_r($busca_imparticion_array);
                    $lista_imparticion = "";
                    $lista_imparticion_xls = "";
                    $suma_asistentes = 0;
                    $cuentaimp = 0;
                    foreach ($busca_imparticiones_array as $buscimpart) {
                        $cuentaimp++;
                        $lista_imparticion .= $buscimpart->codigo_inscripcion . "<br>";
                        $lista_imparticion_xls .= $buscimpart->codigo_inscripcion . ",";
                        $cuenta_Asistententes = BuscaAsistentesImparticion($buscimpart->codigo_inscripcion, $id_empresa);
                        $suma_asistentes = $suma_asistentes + $cuenta_Asistententes[0]->asistentes;
                        //print_r($cuenta_Asistententes);
                    }
                    //cuentaparticipantes
                    //$cuenta_Asistententes=BuscaAsistentesCursoImparticion($unico->id, $id_empresa);
                    $Asistententes = $cuenta_Asistententes[0]->asistentes;
                    $row = str_replace("{NUM_IMPARTICIONES}", $lista_imparticion, $row);
                    $row = str_replace("{NUM_IMPARTICIONES_XLS}", $lista_imparticion_xls, $row);
                    if ($unico->nombre_modalidad == "Presencial" and $cuentaimp > 0) {
                        $boton_ver = "<a href='?sw=listaInscripciones2&i=" . Encodear($unico->id) . "'  data-placement='left' title='Ver_Imparticiones'>Ver_Imparticiones</a>";
                    } else {
                        $boton_ver = "";
                    }
                    $row = str_replace("{VER_IMPARTICIONES}", $boton_ver, $row);
                    $row = str_replace("{SENCE}", $unico->sence, $row);
                    $row = str_replace("{PARTICIPANTES_MAX}", $unico->cantidad_maxima_participantes, $row);
                    $row = str_replace("{OTEC}", $unico->nombre_otec, $row);
                    $row = str_replace("{CBC}", $unico->cbc, $row);
                    $row = str_replace("{MODALIDAD}", "<span class='label bg-blue'>" . $unico->modalidadcurso . "</span>", $row);
                    //$row = str_replace("{TIPO}",$unico->tipo,$row);
                    $row = str_replace("{TIPO}", $unico->nombre_tipo_curso, $row);
                    $row = str_replace("{PREREQUISITOS}", $unico->prerequisito, $row);
                    $preinscritos = "";
                    $postulantes = "";
                    $asistentes = "";
                    if ($unico->total_inscripciones_curso == 0) {
                        $inscritos = "<strong>0</strong> Inscritos";
                        if ($unico->nombre_modalidad == "Presencial") {
                            $preinscritos = "<br><strong>0</strong> Preinscritos";
                            $postulantes = "<br><strong>0</strong> Postulantes";
                        }
                    } else {
                        $inscritos = "<strong>" . $unico->inscritos . "</strong> Inscritos";
                        if ($unico->nombre_modalidad == "Presencial") {
                            if ($unico->preinscritos > 0) {
                                $preinscritos = "<br><strong>" . $unico->preinscritos . "</strong> Preinscritos";
                            } else {
                                $preinscritos = "<br><strong>0</strong> Preinscritos";
                            }
                            if ($unico->postulantes > 0) {
                                $postulantes = "<br><strong>" . $unico->postulantes . "</strong> Postulantes";
                            } else {
                                $postulantes = "";
                            }
                            if ($Asistententes > 0) {
                                $asistentes = "<br><strong>" . $Asistententes . "</strong> Asistentes";
                            } else {
                                $asistentes = "<br><strong>0</strong> Asistentes";
                            }
                        }
                    }
                    $row = str_replace("{INSCRITOS}", $inscritos, $row);
                    $row = str_replace("{PREINSCRITOS}", $preinscritos, $row);
                    $row = str_replace("{POSTULANTES}", $postulantes, $row);
                    $row = str_replace("{ASISTENTES}", $asistentes, $row);
                    $row = str_replace("{NUM_INSCRITOS}", $unico->inscritos, $row);
                    $row = str_replace("{NUM_PREINSCRITOS}", $unico->preinscritos, $row);
                    $row = str_replace("{NUM_POSTULANTES}", $unico->postulantes, $row);
                    $row = str_replace("{NUM_ASISTENTES}", $Asistententes, $row);
                    //Por cada curso, traigl el total de programas asociados desde rel lms malla curso
                    $programas = TraeProgramasUnicosDadoCursoDeRelMallaCurso($id_empresa, $unico->id);
                    $acumulador_programas = "";
                    foreach ($programas as $prog) {
                        $acumulador_programas .= $prog->nombre_programa . "<br>";
                    }
                    $row = str_replace("{PROGRAMAS_ASOCIADOS}", $acumulador_programas, $row);
                    $row = str_replace("{PROGRAMA_BBDD_ENCODEADO}", Encodear3($programas[0]->id_programa), $row);
                    $row = str_replace("{VALOR_HORA}", colocarPesos($unico->valor_hora), $row);
                    if ($unico->imagen && file_exists("../front/img/logos_cursos/" . $unico->imagen)) {
                        $row = str_replace("{IMAGEN}", "<img src='../front/img/logos_cursos/" . $unico->imagen . "' width='50' >", $row);
                    } else {
                        $row = str_replace("{IMAGEN}", "", $row);
                    }
                    $row = str_replace("{VALOR_HORA_SENCE}", colocarPesos($unico->valor_hora_sence), $row);
                    $row = str_replace("{NUM_HORAS}", $unico->numero_horas, $row);
                    $row = str_replace("{VALOR_CURSO}", colocarPesos($unico->numero_horas * $unico->valor_hora), $row);
                    $row = str_replace("{EJECUTIVO}", ($unico->ejecutivocapacitacion), $row);
                    $row = str_replace("{PARTICIPANTE}", ($unico->participantes), $row);
                    $row = str_replace("{VALOR_CURSO}", colocarPesos($unico->numero_horas * $unico->valor_hora), $row);
                    $row = str_replace("{FECHAI}", ($unico->fecha_inicio), $row);
                    $row = str_replace("{FECHAT}", ($unico->fecha_finalizacion), $row);
                    $total_html .= $row;
                }
                $PRINCIPAL = str_replace("{ROW_LISTADO}", utf8_encode($total_html), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ROW_LISTADO_xls}", ($total_html), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function FormularioUsuarioSIGA($PRINCIPAL, $rut, $id_empresa)
            {
                $datos_usuario = UsuarioEnBasePersonas($rut);
                $PRINCIPAL = str_replace("{VA_RUT}", utf8_encode($datos_usuario[0]->rut), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VA_RUT_COMPLETO}", utf8_encode($datos_usuario[0]->rut_completo), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VA_DV}", utf8_encode($datos_usuario[0]->dv), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VA_NOMBRE}", utf8_encode($datos_usuario[0]->nombre), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VA_NOMBRE_COMPLETO}", utf8_encode($datos_usuario[0]->nombre_completo), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VA_APATERNO}", utf8_encode($datos_usuario[0]->apaterno), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VA_AMATERNO}", utf8_encode($datos_usuario[0]->amaterno), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VA_FECHA_NAC}", utf8_encode($datos_usuario[0]->fecha_nacimiento), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VA_EMAIL}", utf8_encode($datos_usuario[0]->email), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VA_GENERO}", utf8_encode($datos_usuario[0]->genero), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VA_NACIONALIDAD}", utf8_encode($datos_usuario[0]->nacionalidad), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VA_DIRECCION_PARTICULAR}", utf8_encode($datos_usuario[0]->direccion_particular), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VA_CODIGO_ESCOLARIDAD}", utf8_encode($datos_usuario[0]->codigo_escolaridad), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VA_CODIGO_NIVEL}", utf8_encode($datos_usuario[0]->codigo_nivel), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VA_GERENCIA}", utf8_encode($datos_usuario[0]->gerencia), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VA_SUBGERENCIA}", utf8_encode($datos_usuario[0]->gerencia), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VA_CARGO}", utf8_encode($datos_usuario[0]->cargo), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VA_UNIDAD_NEGOCIO}", utf8_encode($datos_usuario[0]->unidad_negocio), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VA_CENTRO_COSTO}", utf8_encode($datos_usuario[0]->centro_costo), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VA_NOMBREJEFATURA}", utf8_encode($datos_usuario[0]->nombre_jefatura), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VA_JEFE}", utf8_encode($datos_usuario[0]->jefe), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VA_VICEPRESIDENCIA}", utf8_encode($datos_usuario[0]->vicepresidencia), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VA_CENTRO_COSTO}", utf8_encode($datos_usuario[0]->centro_costo), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VA_FECHA_ANTIGUEDAD}", utf8_encode($datos_usuario[0]->fecha_antiguedad), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VA_TIPO_CONTRATO}", utf8_encode($datos_usuario[0]->tipo_contrato), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VA_TRAMO_SENCE}", utf8_encode($datos_usuario[0]->tramo_sence), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VA_PERFIL_COMPETENCIA}", utf8_encode($datos_usuario[0]->perfil_evaluacion), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_CODIGO_ESCOLARIDAD}", OptionsGenericoNombreDadoValores("tbl_codigo_escolaridad", $datos_usuario[0]->codigo_escolaridad, "codigo", "nivel"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_CODIGO_NIVEL}", OptionsGenericoNombreDadoValores("tbl_codigo_nivel", $datos_usuario[0]->codigo_nivel, "codigo", "nivel"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_TIPO_CONTRATO}", OptionsGenericoNombreDadoValores("tbl_tipo_contrato", $datos_usuario[0]->tipo_contrato, "descripcion", "descripcion"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTION_TRAMO_SENCE}", OptionsGenericoNombreDadoValores("tbl_tramo_sence", $datos_usuario[0]->tramo_sence, "descripcion", "descripcion"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VA_GENERO}", utf8_encode($datos_usuario[0]->genero), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_EMPRESA_HOLDING}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_empresa_holding", $datos_usuario[0]->empresa_holding, "empresa", "rut", "order by empresa", $_SESSION["id_empresa"]), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_GERENCIAS}", OptionsGenericoPorEmpresa("gerencia", "tbl_usuario", utf8_encode($datos_usuario[0]->gerencia), $_SESSION["id_empresa"]), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_CENTRO_COSTO}", OptionsGenericoPorEmpresa("centro_costo", "tbl_usuario", utf8_encode($datos_usuario[0]->centro_costo), $_SESSION["id_empresa"]), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_UNIDAD_NEGOCIO}", OptionsGenericoPorEmpresa("unidad_negocio", "tbl_usuario", utf8_encode($datos_usuario[0]->unidad_negocio), $_SESSION["id_empresa"]), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_PERFIL_EVALUACION}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_sgd_perfiles_ponderaciones", $datos_usuario[0]->perfil_evaluacion, "descripcion", "perfil", "order by descripcion asc", $_SESSION["id_empresa"]), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VA_CLAVE}", utf8_encode($datos_usuario[0]->clave_acceso), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VA_TELEFONO}", utf8_encode($datos_usuario[0]->telefono), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VA_FECHA_INICIO}", utf8_encode($datos_usuario[0]->fecha_inicio), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VA_ALTA}", utf8_encode($datos_usuario[0]->fecha_inicio), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VA_NOMBRE_JEFATURA}", utf8_encode($datos_usuario[0]->nombre_jefatura), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VA_CARGO_JEFATURA}", utf8_encode($datos_usuario[0]->cargo_jefatura), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VA_TELEFONO_JEFATURA}", utf8_encode($datos_usuario[0]->telefono_jefatura), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VA_EMAIL_JEFATURA}", utf8_encode($datos_usuario[0]->email_jefatura), $PRINCIPAL);
                //SELECCIONA COMBO GENERO}
                if (utf8_encode($datos_usuario[0]->genero) == "m") {
                    $PRINCIPAL = str_replace("{GENEROM}", "selected", $PRINCIPAL);
                }
                if (utf8_encode($datos_usuario[0]->genero) == "f") {
                    $PRINCIPAL = str_replace("{GENEROF}", "selected", $PRINCIPAL);
                }
                //FIN COMBO GENERO
                if ($datos_usuario) {
                    $PRINCIPAL = str_replace("{VALOR_BOTON}", "Editar Usuario", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ACTION}", "?sw=edusuarioSiga", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{TITULO}", "Formulario Edici&oacute;n de Usuarios", $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{VALOR_BOTON}", "Ingresar Usuario", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ACTION}", "?sw=adsuarioSiga", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{TITULO}", "Formulario Ingreso de Usuarios", $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function TransformarFEchaConBarra($fecha)
            {
                $fecha = str_replace("-", "/", $fecha);
                return ($fecha);
            }

            function getPuntosRut($rut)
            {
                $rutTmp = explode("-", $rut);
                return number_format($rutTmp[0], 0, "", ".") . '-' . $rutTmp[1];
            }

            function ListadoUsuariosSiga($PRINCIPAL, $arreglo_post, $pagina, $tipo_listado)
            {
                //Traigo el total de empresas que existen en el sistema
                //Con la variable tipo usuario, veo si es para el listado de usuarios, o para el listado de envio de correos.
                $id_empresa = $_SESSION["id_empresa"];
                $categorias = SeguimientoTotalCategoriasPorEmpresa($id_empresa);
                foreach ($categorias as $cat) {
                    $th .= file_get_contents("views/seguimiento/th_dinamicos.html");
                    $th = str_replace("{PASO}", $cat->nombre, $th);
                }
                $PRINCIPAL = str_replace("{TH_DINAMICOS}", utf8_encode($th), $PRINCIPAL);
                if ($arreglo_post["n_registros"]) {
                    $usuarios_por_pagina = $arreglo_post["n_registros"];
                } else {
                    $usuarios_por_pagina = 50;
                }
                if (!$pagina) {
                    $pagina = 1;
                }
                if ($tipo_listado == "correos") {
                    $entorno_para_paginacion = "listusuco";
                } else {
                    $entorno_para_paginacion = "listusu";
                }
                //$usuarios=TotalUsuarios($arreglo_post, $_SESSION["id_empresa"], $pagina, $usuarios_por_pagina);
                //$usuarios=SelectParaPaginacionUsuario("tbl_usuario", $_SESSION["id_empresa"], $usuarios_por_pagina);
                $PRINCIPAL = str_replace("{FILTROS_SUPERIORES}", file_get_contents("views/filtros/barra_superior_usuarios_SIGA.html"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ENVIRONMENT}", $entorno_para_paginacion, $PRINCIPAL);
                $usuarios = DatosParaListadoPaginadoSiga("tbl_usuario", $_SESSION["id_empresa"], $usuarios_por_pagina, $pagina, $arreglo_post);
                $categorias = SeguimientoTotalCategoriasPorEmpresa($id_empresa);
                $PRINCIPAL = str_replace("{PAGINACION}", ArmaPaginacionGenerico($pagina, $entorno_para_paginacion, "tbl_usuario", $usuarios_por_pagina, $arreglo_post, $_SESSION["id_empresa"]), $PRINCIPAL);
                $total_empresas = "";
                if ($tipo_listado == "correos") {
                    $html_row = file_get_contents("views/basepersonas/row_personas_envio_correos.html");
                } else if ($tipo_listado == "usuarios") {
                    if ($_SESSION["id_empresa"] == 28) {
                        $html_row = file_get_contents("views/basepersonas/row_personas_chilquinta.html");
                    } else {
                        $html_row = file_get_contents("views/basepersonas/siga/row_personas.html");
                    }
                }
                $i = 1;
                foreach ($usuarios as $unico) {
                    $row = $html_row;
                    if ($pagina == 1) {
                        $row = str_replace("{N}", $i, $row);
                    } else {
                        $row = str_replace("{N}", $i + (($pagina - 1) * $usuarios_por_pagina), $row);
                    }
                    $i++;
                    $vecesenviadoemail = vecesenviado($unico->rut, $proceso, $empresa);
                    foreach ($vecesenviadoemail as $vecesenviadoemailunico) {
                        $row = str_replace("{VECESENVIADO}", $vecesenviadoemailunico->cuenta, $row);
                    }
                    //Veo cantidad de colaboradores si es que es jefe
                    $datos_si_Es_jefe = count(ColaboradoresDadoJefe($unico->rut));
                    $row = str_replace("{LIDER}", $datos_si_Es_jefe, $row);
                    $row = str_replace("{NOMBRE_USUARIO}", $unico->nombre_completo, $row);
                    $row = str_replace("{APATERNO}", $unico->apaterno, $row);
                    $row = str_replace("{AMATERNO}", $unico->amaterno, $row);
                    $row = str_replace("{NOMBRE}", $unico->nombre, $row);
                    $row = str_replace("{NOMBRE_COMPLETO}", $unico->nombre_completo, $row);
                    //$row = str_replace("{RUT}",getPuntosRut($unico->rut_completo),$row);
                    $row = str_replace("{RUT}", $unico->rut_completo, $row);
                    $row = str_replace("{RUT_ENCODEADO}", Encodear3($unico->rut), $row);
                    $row = str_replace("{GERENCIA}", $unico->gerencia, $row);
                    $row = str_replace("{CENTROCOSTO}", $unico->centro_costo, $row);
                    //Veo si este rut estÃ¡ en la tabla de auto registro
                    $esta_auto_registrado = RevisaSiUsuarioEstaEnAutoRegistro($id_empresa, getPuntosRut($unico->rut_completo));
                    if ($esta_auto_registrado) {
                        $row = str_replace("{AUTOINSC}", "SI", $row);
                    } else {
                        $row = str_replace("{AUTOINSC}", "NO", $row);
                    }
                    $fecha_de_alta = ObtenerFechaDeAlta($unico->rut);
                    //rint_r($fecha_de_alta);echo "<br><br>";
                    $row = str_replace("{FECHA_ALTA}", TransformarFEchaConBarra($fecha_de_alta[0]->fecha_alta), $row);
                    $row = str_replace("{FECHA_INICIO}", TransformarFEchaConBarra("2015-11-30"), $row);
                    $row = str_replace("{CARGO}", $unico->cargo, $row);
                    if ($unico->vigencia == 0) {
                        $row = str_replace("{ESTADO}", "Activo", $row);
                    } else {
                        $row = str_replace("{ESTADO}", "Desvinculado", $row);
                    }
                    $row = str_replace("{TELEFONO}", $unico->telefono, $row);
                    $row = str_replace("{CLAVE}", $unico->clave, $row);
                    $row = str_replace("{EMPRESA_HOLDING}", $unico->nombre_empresa_holding, $row);
                    $row = str_replace("{EMAIL}", $unico->email, $row);
                    $row = str_replace("{PERFIL}", $unico->perfil_evaluacion, $row);
                    $row = str_replace("{TRAMO}", $unico->tramo_sence . "%", $row);
                    $td_dinamicos = "";
                    foreach ($categorias as $cat) {
                        $td_dinamicos .= file_get_contents("views/seguimiento/td_seguimiento_avance.html");
                        $estado = SeguimientoObtieneEstadoPorCategoria($cat->id, $unico->rut);
                        $td_dinamicos = str_replace("{ESTADO}", $estado[1], $td_dinamicos);
                    }
                    $row = str_replace("{TH_DINAMICOS_DATA}", ($td_dinamicos), $row);
                    $row = str_replace("{PERFIL_EVALUACION}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_sgd_perfiles_ponderaciones", "", "descripcion", "perfil", "order by descripcion asc", $_SESSION["id_empresa"]), $row);
                    $row = str_replace("{OPTIONS_TIPOS_CORREOS}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_correos", "", "asunto", "id", "order by asunto", $_SESSION["id_empresa"]), $row);
                    $PRINCIPAL = str_replace("{OPTIONS_GERENCIAS}", OptionsGenericoPorEmpresa("gerencia", "tbl_usuario", $arreglo_post["gerencia"], $_SESSION["id_empresa"]), $PRINCIPAL);
                    $total_empresas .= $row;
                }
                $PRINCIPAL = str_replace("{ROW_LISTADO_USUARIOS}", utf8_encode($total_empresas), $PRINCIPAL);
                //$PRINCIPAL = str_replace("{PAGINACION}",ArmaPaginacionUsuarios($pagina, "listusu", "tbl_usuario"),$PRINCIPAL);
                //PAGINACION
                return ($PRINCIPAL);
            }

            function SeguimientoObtieneEstadoPorCategoria($id_categoria, $rut)
            {
                //Verifico si la categoria para este usuario esta finalizada
                $categoria_finalizada = SeguimientoVerificaCategoriaFinalizada($id_categoria, $rut);
                if ($categoria_finalizada) {
                    $arreglo[0] = "Finalizada";
                    $arreglo[1] = '<span class="etiqueta  label-success">Finalizado</span>';
                } else {
                    $tiene_respuestas = SeguimientoVerificoRespuestaSoloPorCategoria($rut, $id_categoria);
                    if ($tiene_respuestas) {
                        $arreglo[0] = "En Proceso";
                        $arreglo[1] = '<span class="etiqueta  label-proceso">En Proceso</span>';
                    } else {
                        $arreglo[0] = "No Iniciado";
                        $arreglo[1] = '<span class="etiqueta  label-danger">No Iniciado</span>';
                    }
                }
                return ($arreglo);
            }

            function ListadoUsuariosResumenSeguimiento($html, $id_empresa)
            {
                $usuarios = DatosTablaUsuarioTodosPorEmpresa($id_empresa);
                $categorias = SeguimientoTotalCategoriasPorEmpresa($id_empresa);
                foreach ($categorias as $cat) {
                    $th .= file_get_contents("views/seguimiento/th_dinamicos.html");
                    $th = str_replace("{PASO}", $cat->nombre, $th);
                }
                $html = str_replace("{TH_DINAMICOS}", utf8_encode($th), $html);
                $i = 1;
                foreach ($usuarios as $usu) {
                    $row .= file_get_contents("views/seguimiento/row_seguimiento_resumen.html");
                    $row = str_replace("{NOMBRE}", ($usu->nombre_completo), $row);
                    $row = str_replace("{NUMERO}", ($i), $row);
                    $td_dinamicos = "";
                    foreach ($categorias as $cat) {
                        $td_dinamicos .= file_get_contents("views/seguimiento/td_seguimiento_avance.html");
                        $estado = SeguimientoObtieneEstadoPorCategoria($cat->id, $usu->rut);
                        $td_dinamicos = str_replace("{ESTADO}", $estado[1], $td_dinamicos);
                    }
                    $row = str_replace("{TH_DINAMICOS_DATA}", ($td_dinamicos), $row);
                    $i++;
                }
                $html = str_replace("{LISTADO_USUARIOS}", utf8_encode($row), $html);
                return ($html);
            }

            function SeguimientoPasos($PRINCIPAL, $categoria, $id_empresa, $excel)
            {
                //coloco los campos dinamicos
                //$pasos=PasosPorSeguimientoCategoria($categoria);
                $datos_categoria = SeguimientoTotalCategoriasPorEmpresaDadoId($categoria);
                $pasos = PasosPorSeguimientoCategoria($categoria);
                foreach ($pasos as $pas) {
                    $th .= file_get_contents("views/seguimiento/th_dinamicos.html");
                    $th = str_replace("{PASO}", $pas->pasos, $th);
                }
                if ($excel == 1) {
                    $PRINCIPAL = str_replace("{TH_DINAMICOS}", ($th), $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{TH_DINAMICOS}", utf8_encode($th), $PRINCIPAL);
                }
                $PRINCIPAL = str_replace("{ID_CATEGORIA_ENCODEADO}", Encodear3($categoria), $PRINCIPAL);
                //Traigo a los usuarios
                $usuarios = DatosTablaUsuarioTodosPorEmpresa($id_empresa);
                $i = 1;
                foreach ($usuarios as $usu) {
                    $row_usu .= file_get_contents("views/seguimiento/" . $datos_categoria[0]->row_template);
                    $row_usu = str_replace("{NOMBRE}", $usu->nombre, $row_usu);
                    $row_usu = str_replace("{RUT}", $usu->rut, $row_usu);
                    $row_usu = str_replace("{RUT_ENCODEADO}", Encodear3($usu->rut), $row_usu);
                    $row_usu = str_replace("{ID_CATEGORIA_ENCODEADO}", Encodear3($categoria), $row_usu);
                    $row_usu = str_replace("{NUMERO}", $i, $row_usu);
                    //Traigo los comentarios que corresponden a la etapa de Exploracion, para mostrarlos
                    $categoria1 = SeguimientoComentariosPorCategoriaYRut(2, $usu->rut);
                    $texto1 = "";
                    $i = 1;
                    foreach ($categoria1 as $val1) {
                        $texto1 .= $val1->comentario . "<br>";
                    }
                    $row_usu = str_replace("{COMENTARIOS1}", $texto1, $row_usu);
                    $categoria3 = SeguimientoComentariosPorCategoriaYRut(3, $usu->rut);
                    $texto3 = "";
                    $i = 1;
                    foreach ($categoria3 as $val3) {
                        $texto3 .= $val3->comentario . "<br>";
                    }
                    $row_usu = str_replace("{COMENTARIOS2}", $texto3, $row_usu);
                    $categoria4 = SeguimientoComentariosPorCategoriaYRut(4, $usu->rut);
                    $texto4 = "";
                    $i = 1;
                    foreach ($categoria4 as $val4) {
                        $texto4 .= $val4->comentario . "<br>";
                    }
                    $row_usu = str_replace("{COMENTARIOS3}", $texto4, $row_usu);
                    $row_usu_pasos = "";
                    foreach ($pasos as $pasos_evaluado) {
                        //Por cada uno veo si tiene respuesta
                        $tiene_respuesta = $tiene_respuesta = SeguimientoVerificoRespuestaPorRutCatePaso($usu->rut, $pasos_evaluado->id, $categoria);
                        $row_usu_pasos .= file_get_contents("views/seguimiento/td_seguimiento_dinamico.html");
                        if ($pasos_evaluado->id_alternativa) {
                            if ($excel == 1) {
                                $row_usu_pasos = str_replace("{RESPUESTA}", file_get_contents("views/seguimiento/td_lectura.html"), $row_usu_pasos);
                            } else {
                                $row_usu_pasos = str_replace("{RESPUESTA}", file_get_contents("views/seguimiento/td_select.html"), $row_usu_pasos);
                            }
                            $alternativas = SeguimientoAlternativasPorId($pasos_evaluado->id_alternativa);
                            $html_alternativas = "";
                            foreach ($alternativas as $altseg) {
                                $selected = "";
                                if ($altseg->puntaje == $tiene_respuesta[0]->respuesta) {
                                    $selected = "selected='selected'";
                                }
                                $html_alternativas .= "<option $selected value='" . $altseg->puntaje . "'>" . $altseg->puntaje . "</option>";
                            }
                            $row_usu_pasos = str_replace("{OPTIONS_SELECT}", $html_alternativas, $row_usu_pasos);
                        } else {
                            if ($excel == 1) {
                                $row_usu_pasos = str_replace("{RESPUESTA}", file_get_contents("views/seguimiento/td_lectura.html"), $row_usu_pasos);
                            } else {
                                $row_usu_pasos = str_replace("{RESPUESTA}", file_get_contents("views/seguimiento/td_textarea.html"), $row_usu_pasos);
                            }
                            $row_usu_pasos = str_replace("{RESPUESTA_TEXTAREA}", $tiene_respuesta[0]->respuesta, $row_usu_pasos);
                        }
                        $row_usu_pasos = str_replace("{NOMBRE_INPUT}", $usu->rut . "_" . $pasos_evaluado->id, $row_usu_pasos);
                        $row_usu_pasos = str_replace("{RESPUESTA_VALOR}", $tiene_respuesta[0]->respuesta, $row_usu_pasos);
                        if ($categoria == 1) {
                            $porcentaje_avance_curso = PorcentajeAvanceCurso(241, $usu->rut);
                            //$row = str_replace("{PORCENTAJE_AVANCE}",$porcentaje_avance_curso[1],$row);
                            $row_usu = str_replace("{CALIFICACION}", number_format($porcentaje_avance_curso[3], 1), $row_usu);
                        }
                        $row_usu_pasos = str_replace("{RESPUESTA_VALOR}", $tiene_respuesta[0]->respuesta, $row_usu_pasos);
                    }
                    if ($excel == 1) {
                        $row_usu = str_replace("{TH_DINAMICOS_DATA}", $row_usu_pasos, $row_usu);
                    } else {
                        $row_usu = str_replace("{TH_DINAMICOS_DATA}", $row_usu_pasos, $row_usu);
                    }
                    $i++;
                }
                if ($excel == 1) {
                    $PRINCIPAL = str_replace("{LISTADO_USUARIOS}", ($row_usu), $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{LISTADO_USUARIOS}", utf8_encode($row_usu), $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function RedimensionarImagenSlider($rutaImagenOriginal, $nombre_imagen)
            {
                $img_original = imagecreatefromjpeg($rutaImagenOriginal);
                //Se define el maximo ancho o alto que tendra la imagen final
                $max_ancho = 1140;
                $max_alto = 400;
                //Ancho y alto de la imagen original
                list($ancho, $alto) = getimagesize($rutaImagenOriginal);
                //Se calcula ancho y alto de la imagen final
                echo "ancho $ancho, alto $alto";
                exit;
                $x_ratio = $max_ancho / $ancho;
                $y_ratio = $max_alto / $alto;
                //Si el ancho y el alto de la imagen no superan los maximos,
                //ancho final y alto final son los que tiene actualmente
                if (($ancho <= $max_ancho) && ($alto <= $max_alto)) {//Si ancho
                    $ancho_final = $ancho;
                    $alto_final = $alto;
                } /*
     * si proporcion horizontal*alto mayor que el alto maximo,
     * alto final es alto por la proporcion horizontal
     * es decir, le quitamos al alto, la misma proporcion que
     * le quitamos al alto
     *
    */
                elseif (($x_ratio * $alto) < $max_alto) {
                    $alto_final = ceil($x_ratio * $alto);
                    $ancho_final = $max_ancho;
                } /*
     * Igual que antes pero a la inversa
    */
                else {
                    $ancho_final = ceil($y_ratio * $ancho);
                    $alto_final = $max_alto;
                }
                //Creamos una imagen en blanco de tamaÃ±o $ancho_final  por $alto_final .
                $tmp = imagecreatetruecolor($ancho_final, $alto_final);
                //Copiamos $img_original sobre la imagen que acabamos de crear en blanco ($tmp)
                imagecopyresampled($tmp, $img_original, 0, 0, 0, 0, $ancho_final, $alto_final, $ancho, $alto);
                //Se destruye variable $img_original para liberar memoria
                imagedestroy($img_original);
                //Definimos la calidad de la imagen final
                $calidad = 95;
                //Se crea la imagen final en el directorio indicado
                imagejpeg($tmp, "../front/img/noticias/slider/" . $nombre_imagen, $calidad);
            }

            function SuboArchivoSlider($FILES, $extension_archivo, $prefijo, $ruta)
            {
                //echo "$extension_archivo, $prefijo, $ruta";exit;
                //$ruta_con_archivo=$ruta."/".$prefijo."_BK.".$extension_archivo;
                $ruta_con_archivo = $ruta . "/" . $prefijo . "." . $extension_archivo;
                copy($FILES['imagen_slider']['tmp_name'], $ruta_con_archivo);
                $nombre_imagen_slider = $prefijo . "." . $extension_archivo;
                //RedimensionarImagenSlider($ruta_con_archivo, $nombre_imagen_slider);
                //Devuelvol un arreglo, con datos del archivo subido
                $arreglo[0] = $ruta_con_archivo;//Ruta Completa
                $arreglo[1] = $prefijo . "." . $extension_archivo;//Nombre del Archivo
                $arreglo[2] = $ruta . "/" . $prefijo;//Ruta del Objeto sin el index
                return ($arreglo);
            }

            function RedimensionarImagen($rutaImagenOriginal, $nombre_imagen, $ext)
            {
                //Ruta de la imagen original
                //$rutaImagenOriginal="./imagen/i2.jpg";
                //Creamos una variable imagen a partir de la imagen original
                if ($ext == "gif") {
                    $img_original = imagecreatefromgif($rutaImagenOriginal);
                } else if ($ext == "png") {
                    $img_original = imagecreatefrompng($rutaImagenOriginal);
                } else {
                    $img_original = imagecreatefromjpeg($rutaImagenOriginal);
                }
                //Se define el maximo ancho o alto que tendra la imagen final
                $max_ancho = 365;
                $max_alto = 365;
                //Ancho y alto de la imagen original
                list($ancho, $alto) = getimagesize($rutaImagenOriginal);
                //Se calcula ancho y alto de la imagen final
                $x_ratio = $max_ancho / $ancho;
                $y_ratio = $max_alto / $alto;
                //Si el ancho y el alto de la imagen no superan los maximos,
                //ancho final y alto final son los que tiene actualmente
                if (($ancho <= $max_ancho) && ($alto <= $max_alto)) {//Si ancho
                    $ancho_final = $ancho;
                    $alto_final = $alto;
                } /*
     * si proporcion horizontal*alto mayor que el alto maximo,
     * alto final es alto por la proporcion horizontal
     * es decir, le quitamos al alto, la misma proporcion que
     * le quitamos al alto
     *
    */
                elseif (($x_ratio * $alto) < $max_alto) {
                    $alto_final = ceil($x_ratio * $alto);
                    $ancho_final = $max_ancho;
                } /*
     * Igual que antes pero a la inversa
    */
                else {
                    $ancho_final = ceil($y_ratio * $ancho);
                    $alto_final = $max_alto;
                }
                //Creamos una imagen en blanco de tamaÃ±o $ancho_final  por $alto_final .
                $tmp = imagecreatetruecolor($ancho_final, $alto_final);
                //Copiamos $img_original sobre la imagen que acabamos de crear en blanco ($tmp)
                imagecopyresampled($tmp, $img_original, 0, 0, 0, 0, $ancho_final, $alto_final, $ancho, $alto);
                //Se destruye variable $img_original para liberar memoria
                imagedestroy($img_original);
                //Definimos la calidad de la imagen final
                $calidad = 95;
                //Se crea la imagen final en el directorio indicado
                //imagejpeg($tmp,"../front/img/noticias/thum/".$nombre_imagen,$calidad);
                if ($ext == "gif") {
                    imagegif($tmp, "../front/img/noticias/thum/" . $nombre_imagen);
                } else if ($ext == "png") {
                    imagepng($tmp, "../front/img/noticias/thum/" . $nombre_imagen);
                } else {
                    imagejpeg($tmp, "../front/img/noticias/thum/" . $nombre_imagen);
                }
                /* SI QUEREMOS MOSTRAR LA IMAGEN EN EL NAVEGADOR
     *
     * descomentamos las lineas 64 ( Header("Content-type: image/jpeg"); ) y 65 ( imagejpeg($tmp); )
     * y comentamos la linea 57 ( imagejpeg($tmp,"./imagen/retoque.jpg",$calidad); )
     */
                //Header("Content-type: image/jpeg");
                //imagejpeg($tmp);
            }

            function RedimensionarImagenPortada($rutaImagenOriginal, $nombre_imagen, $ext)
            {
                //Ruta de la imagen original
                //$rutaImagenOriginal="./imagen/i2.jpg";
                //Creamos una variable imagen a partir de la imagen original
                if ($ext == "gif") {
                    $img_original = imagecreatefromgif($rutaImagenOriginal);
                } else if ($ext == "png") {
                    $img_original = imagecreatefrompng($rutaImagenOriginal);
                } else {
                    $img_original = imagecreatefromjpeg($rutaImagenOriginal);
                }
                //$img_original = imagecreatefromjpeg($rutaImagenOriginal);
                //Se define el maximo ancho o alto que tendra la imagen final
                $max_ancho = 680;
                $max_alto = 680;
                //Ancho y alto de la imagen original
                list($ancho, $alto) = getimagesize($rutaImagenOriginal);
                //Se calcula ancho y alto de la imagen final
                $x_ratio = $max_ancho / $ancho;
                $y_ratio = $max_alto / $alto;
                //Si el ancho y el alto de la imagen no superan los maximos,
                //ancho final y alto final son los que tiene actualmente
                if (($ancho <= $max_ancho) && ($alto <= $max_alto)) {//Si ancho
                    $ancho_final = $ancho;
                    $alto_final = $alto;
                } /*
     * si proporcion horizontal*alto mayor que el alto maximo,
     * alto final es alto por la proporcion horizontal
     * es decir, le quitamos al alto, la misma proporcion que
     * le quitamos al alto
     *
    */
                elseif (($x_ratio * $alto) < $max_alto) {
                    $alto_final = ceil($x_ratio * $alto);
                    $ancho_final = $max_ancho;
                } /*
     * Igual que antes pero a la inversa
    */
                else {
                    $ancho_final = ceil($y_ratio * $ancho);
                    $alto_final = $max_alto;
                }
                //Creamos una imagen en blanco de tamaÃ±o $ancho_final  por $alto_final .
                $tmp = imagecreatetruecolor($ancho_final, $alto_final);
                //Copiamos $img_original sobre la imagen que acabamos de crear en blanco ($tmp)
                imagecopyresampled($tmp, $img_original, 0, 0, 0, 0, $ancho_final, $alto_final, $ancho, $alto);
                //Se destruye variable $img_original para liberar memoria
                imagedestroy($img_original);
                //Definimos la calidad de la imagen final
                $calidad = 95;
                //Se crea la imagen final en el directorio indicado
                if ($ext == "gif") {
                    imagegif($tmp, "../front/img/noticias/portada/" . $nombre_imagen);
                } else if ($ext == "png") {
                    imagepng($tmp, "../front/img/noticias/portada/" . $nombre_imagen);
                } else {
                    imagejpeg($tmp, "../front/img/noticias/portada/" . $nombre_imagen);
                }
                //imagejpeg($tmp,"../front/img/noticias/portada/".$nombre_imagen,$calidad);
                /* SI QUEREMOS MOSTRAR LA IMAGEN EN EL NAVEGADOR
     *
     * descomentamos las lineas 64 ( Header("Content-type: image/jpeg"); ) y 65 ( imagejpeg($tmp); )
     * y comentamos la linea 57 ( imagejpeg($tmp,"./imagen/retoque.jpg",$calidad); )
     */
                //Header("Content-type: image/jpeg");
                //imagejpeg($tmp);
            }

            function RedimensionarImagenPortadaFoto($rutaImagenOriginal, $nombre_imagen, $ext)
            {
                //Ruta de la imagen original
                //$rutaImagenOriginal="./imagen/i2.jpg";
                //Creamos una variable imagen a partir de la imagen original
                if ($ext == "gif") {
                    $img_original = imagecreatefromgif($rutaImagenOriginal);
                } else if ($ext == "png") {
                    $img_original = imagecreatefrompng($rutaImagenOriginal);
                } else {
                    $img_original = imagecreatefromjpeg($rutaImagenOriginal);
                }
                //$img_original = imagecreatefromjpeg($rutaImagenOriginal);
                //Se define el maximo ancho o alto que tendra la imagen final
                $max_ancho = 800;
                $max_alto = 800;
                //Ancho y alto de la imagen original
                list($ancho, $alto) = getimagesize($rutaImagenOriginal);
                //Se calcula ancho y alto de la imagen final
                $x_ratio = $max_ancho / $ancho;
                $y_ratio = $max_alto / $alto;
                //Si el ancho y el alto de la imagen no superan los maximos,
                //ancho final y alto final son los que tiene actualmente
                if (($ancho <= $max_ancho) && ($alto <= $max_alto)) {//Si ancho
                    $ancho_final = $ancho;
                    $alto_final = $alto;
                } /*
     * si proporcion horizontal*alto mayor que el alto maximo,
     * alto final es alto por la proporcion horizontal
     * es decir, le quitamos al alto, la misma proporcion que
     * le quitamos al alto
     *
    */
                elseif (($x_ratio * $alto) < $max_alto) {
                    $alto_final = ceil($x_ratio * $alto);
                    $ancho_final = $max_ancho;
                } /*
     * Igual que antes pero a la inversa
    */
                else {
                    $ancho_final = ceil($y_ratio * $ancho);
                    $alto_final = $max_alto;
                }
                //Creamos una imagen en blanco de tamaÃ±o $ancho_final  por $alto_final .
                $tmp = imagecreatetruecolor($ancho_final, $alto_final);
                //Copiamos $img_original sobre la imagen que acabamos de crear en blanco ($tmp)
                imagecopyresampled($tmp, $img_original, 0, 0, 0, 0, $ancho_final, $alto_final, $ancho, $alto);
                //Se destruye variable $img_original para liberar memoria
                imagedestroy($img_original);
                //Definimos la calidad de la imagen final
                $calidad = 95;
                //Se crea la imagen final en el directorio indicado
                if ($ext == "gif") {
                    imagegif($tmp, "../front/multimedia/" . $nombre_imagen);
                } else if ($ext == "png") {
                    imagepng($tmp, "../front/multimedia/" . $nombre_imagen);
                } else {
                    imagejpeg($tmp, "../front/multimedia/" . $nombre_imagen);
                }
                //imagejpeg($tmp,"../front/img/noticias/portada/".$nombre_imagen,$calidad);
                /* SI QUEREMOS MOSTRAR LA IMAGEN EN EL NAVEGADOR
     *
     * descomentamos las lineas 64 ( Header("Content-type: image/jpeg"); ) y 65 ( imagejpeg($tmp); )
     * y comentamos la linea 57 ( imagejpeg($tmp,"./imagen/retoque.jpg",$calidad); )
     */
                //Header("Content-type: image/jpeg");
                //imagejpeg($tmp);
            }

            function EncabezadoExcel($nombre)
            {
                $fechahoy = date("Y-m-d") . " " . date("H:i:s");
                header("Content-Type: application/vnd.ms-excel");
                header("Content-Disposition: attachment; filename=" . $nombre . "_" . $fechahoy . ".xls");
                header("Pragma: no-cache");
                header("Expires: 0");
            }

            function PorcentajeAvanceProcesoAnual($id_proceso_anual)
            {
                $procesos_eval_por_proc_anual = ProcesosEvalPorProcesoAnual($id_proceso_anual);
                $contador = 0;
                foreach ($procesos_eval_por_proc_anual as $proc) {
                    if ($proc->tipo_proceso == 1) {
                        //Obtengo el total de relaciones evaluado - evaluador
                        $porcentaje_avance_proceso = PorcentajeAvanceProcesoEvaluacion($proc->id_proceso);
                        //$total_relaciones=TotalRelacionesProPRoceso($proc->id_proceso);
                        //$total_finalizados=TotalFinalizadosPorProceso($proc->id_proceso);
                        //$row = str_replace("{PORCENTAJE_POR_PROCESO}",ColocarColoresConPorcentaje(FormatearPorcentajes($porcentaje_avance_proceso[0])),$row);
                        $acumulador = $acumulador + FormatearPorcentajes($porcentaje_avance_proceso[0]);
                        $contador++;
                    } else {
                        $row = str_replace("{PORCENTAJE_POR_PROCESO}", "", $row);
                    }
                }
                //$resultado=$acumulador/$contador;
                $avance_anual[0] = ColocarColoresConPorcentaje(FormatearPorcentajes($acumulador / $contador));
                return ($avance_anual);
            }

            function ListadoUsuariosAutoInscritos($PRINCIPAL, $arreglo_post, $pagina, $tipo_listado)
            {
                //Traigo el total de empresas que existen en el sistema
                //Con la variable tipo usuario, veo si es para el listado de usuarios, o para el listado de envio de correos.
                if ($arreglo_post["n_registros"]) {
                    $usuarios_por_pagina = $arreglo_post["n_registros"];
                } else {
                    $usuarios_por_pagina = 50;
                }
                if (!$pagina) {
                    $pagina = 1;
                }
                if ($tipo_listado == "correos") {
                    $entorno_para_paginacion = "listusuco";
                } else {
                    $entorno_para_paginacion = "listusu";
                }
                //$usuarios=TotalUsuarios($arreglo_post, $_SESSION["id_empresa"], $pagina, $usuarios_por_pagina);
                //$usuarios=SelectParaPaginacionUsuario("tbl_usuario", $_SESSION["id_empresa"], $usuarios_por_pagina);
                $PRINCIPAL = str_replace("{FILTROS_SUPERIORES}", file_get_contents("views/filtros/barra_superior_usuarios.html"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ENVIRONMENT}", $entorno_para_paginacion, $PRINCIPAL);
                $usuarios = DatosParaListadoPaginado("tbl_registro_login", $_SESSION["id_empresa"], $usuarios_por_pagina, $pagina, $arreglo_post);
                $PRINCIPAL = str_replace("{PAGINACION}", ArmaPaginacionGenerico($pagina, $entorno_para_paginacion, "tbl_registro_login", $usuarios_por_pagina, $arreglo_post, $_SESSION["id_empresa"]), $PRINCIPAL);
                $total_empresas = "";
                $html_row = file_get_contents("views/basepersonas/row_personas_auto_inscritas.html");
                $i = 1;
                foreach ($usuarios as $unico) {
                    $row = $html_row;
                    if ($pagina == 1) {
                        $row = str_replace("{N}", $i, $row);
                    } else {
                        $row = str_replace("{N}", $i + (($pagina - 1) * $usuarios_por_pagina), $row);
                    }
                    $i++;
                    $vecesenviadoemail = vecesenviado($unico->rut, $proceso, $empresa);
                    foreach ($vecesenviadoemail as $vecesenviadoemailunico) {
                        $row = str_replace("{VECESENVIADO}", $vecesenviadoemailunico->cuenta, $row);
                    }
                    //Veo cantidad de colaboradores si es que es jefe
                    $datos_si_Es_jefe = count(ColaboradoresDadoJefe($unico->rut));
                    $row = str_replace("{NOMBRE_USUARIO}", $unico->nombre . " " . $unico->apaterno . " " . $unico->amaterno, $row);
                    $row = str_replace("{NOMBRE}", $unico->nombre, $row);
                    $row = str_replace("{RUT}", $unico->rut, $row);
                    $row = str_replace("{RUT_ENCODEADO}", Encodear3($unico->rut), $row);
                    $row = str_replace("{CARGO}", $unico->cargo, $row);
                    $row = str_replace("{EMAIL}", $unico->email, $row);
                    $row = str_replace("{CELULAR}", $unico->celular, $row);
                    $row = str_replace("{FECHA_INGRESO}", $unico->fecha_ingreso, $row);
                    $row = str_replace("{RUT_JEFE}", $unico->rut_jefe, $row);
                    $row = str_replace("{NOMBRE_JEFE}", $unico->nombre_jefe, $row);
                    $row = str_replace("{CARGO_JEFE}", $unico->cargo_jefe, $row);
                    $row = str_replace("{CORREO_JEFE}", $unico->correo_jefe, $row);
                    $total_empresas .= $row;
                }
                $PRINCIPAL = str_replace("{ROW_LISTADO_USUARIOS}", utf8_encode($total_empresas), $PRINCIPAL);
                //$PRINCIPAL = str_replace("{PAGINACION}",ArmaPaginacionUsuarios($pagina, "listusu", "tbl_usuario"),$PRINCIPAL);
                //PAGINACION
                return ($PRINCIPAL);
            }

            function ResumenListadoEvaluadoresPorProceso($html, $id_proceso)
            {
                //$usuarios=TraeEvaluadoresPorProceso($id_proceso, $usuarios_por_pagina, $pagina, $arreglo_post);
                foreach ($usuarios as $unico) {
                    $row = $html_row;
                    if ($pagina == 1) {
                        $row = str_replace("{N}", $i, $row);
                    } else {
                        $row = str_replace("{N}", $i + (($pagina - 1) * $usuarios_por_pagina), $row);
                    }
                    $i++;
                    $row = str_replace("{RUT_EVALUADOR}", $unico->rut_completo_evaluador, $row);
                    $row = str_replace("{FOTO_EVALUADOR}", VerificaFotoPersonalDesdeAdmin($unico->evaluador), $row);
                    $row = str_replace("{RUT_EVALUADOR_ENCODEADO}", Encodear3($unico->evaluador), $row);
                    $row = str_replace("{NOMBRE_EVALUADOR}", $unico->nombre_evaluador, $row);
                    $row = str_replace("{CARGO_EVALUADOR}", $unico->cargo_evaluador, $row);
                    $row = str_replace("{GERENCIA_EVALUADOR}", $unico->gerencia_evaluador, $row);
                    $row = str_replace("{EMPRESA_EVALUADOR}", $unico->nombre_empresa_holding_evaluador, $row);
                    $row = str_replace("{CANTIDAD_EVALUADOS}", $unico->total_evaluados, $row);
                    $row = str_replace("{CAMBIO_CLAVE}", ColocaEtiquetaReportesSGD($unico->clave_creada, 1), $row);
                    //$row = str_replace("{TOTAL_FINALIZADOS}",ColocaEtiquetaReportesSGD($unico->total_finalizados, $unico->total_evaluados),$row);
                    $porcentaje_Avance_evaluador = PorcentajeAvanceEvaluador($unico->evaluador, $id_proceso);
                    //$porcentale_avance_evaluador_v2=AvanceDeEvaluados($unico->evaluador, $id_proceso);
                    $row = str_replace("{TOTAL_FIsNALIZADOS}", ColocarColoresConPorcentaje($porcentaje_Avance_evaluador[0]), $row);
                    //$row = str_replace("{TOTAL_FINALIZADOS}",ColocarColoresConPorcentaje($porcentale_avance_evaluador_v2[0]),$row);
                    $row = str_replace("{TOTAL_EN_PROCESO}", ColocaEtiquetaReportesSGD($unico->total_en_proceso + 0, $unico->total_evaluados), $row);
                    $row = str_replace("{ID_REGISTRO_FINALIZADO_EVALUADO_EVALUADOR}", Encodear3($unico->id_registro_finalizado), $row);
                    $row = str_replace("{ID_PROCESO_ENCODEADO}", Encodear3($id_proceso), $row);
                    $row = str_replace("{POR_FINALIZADOS}", ($unico->total_finalizados * 100) / $unico->total_evaluados . "%", $row);
                    $total_empresas .= $row;
                }
                return ($html);
            }

            function MuestraEncabezadoPorProceso($id_proceso)
            {
                //$pasos=PasosPorProceso($id_proceso);
                $pasos = PasosPorProcesoParaReportes($id_proceso);
                foreach ($pasos as $pas) {
                    $encabezado_dinamico .= file_get_contents("views/procesos/reportes/th_encabezado_dinamico.html");
                    $encabezado_dinamico = str_replace("{NOMBRE_PASO}", $pas->etapa, $encabezado_dinamico);
                }
                return (utf8_encode($encabezado_dinamico));
            }

            function PorcentajeAvanceProcesoEvaluacion($id_proceso)
            {
                $total_relaciones = TotalRelacionesProPRoceso($id_proceso);
                $total_finalizados = TotalFinalizadosPorProceso($id_proceso);
                $arreglo[0] = ($total_finalizados[0]->total * 100) / $total_relaciones[0]->total;
                return ($arreglo);
            }

            function EstadoProcesoSegunFechas($fecha_inicio, $fecha_termino)
            {
                $fecha_actual = date("Y-m-d");
                if ($fecha_actual < $fecha_inicio) {
                    $arreglo[0] = '<div class="etiqueta  label-danger">No Iniciado</div>';
                } else if ($fecha_actual >= $fecha_inicio && $fecha_actual <= $fecha_termino) {
                    $arreglo[0] = '<div class="etiqueta  label-proceso">En Proceso</div>';
                } else if ($fecha_actual > $fecha_termino) {
                    $arreglo[0] = '<div class="etiqueta  label-success">Finalizado</div>';
                }
                return ($arreglo);
            }

            function ColocarColoresConPorcentajeProgressBar($valor)
            {
                $valor = round($valor);
                if ($valor < 20) {
                    $valorwd = $valor + 10;
                } else {
                    $valorwd = $valor;
                }
                if ($valor < 50) {
                    //$arreglo='<div class="etiqueta  label-danger">'.$valor.'%</div>';
                    $arreglo = '
    <div class="progress-bar etiqueta_progressbar label-danger" role="progressbar" aria-valuenow="70" aria-valuemin="0" aria-valuemax="100" style="width:' . $valorwd . '%">
      <span>' . $valor . '%</span>
    </div>
  ';
                } else if ($valor >= 50 and $valor < 75) {
                    //$arreglo='<div class="etiqueta  label-success">'.$valor.'%</div>';
                    $arreglo = '
    <div class="progress-bar etiqueta_progressbar label-proceso" role="progressbar" aria-valuenow="70" aria-valuemin="0" aria-valuemax="100" style="width:' . $valorwd . '%">
        <span>' . $valor . '%</span>
    </div>
  ';
                } else {
                    //$arreglo='<div class="etiqueta  label-proceso">'.$valor.'%</div>';
                    $arreglo = '
    <div class="progress-bar etiqueta_progressbar label-success" role="progressbar" aria-valuenow="70" aria-valuemin="0" aria-valuemax="100" style="width:' . $valorwd . '%">
        <span>' . $valor . '%</span>
    </div>
';
                }
                return ($arreglo);
            }

            function ColocarColoresConPorcentaje($valor)
            {
                if ($valor == 0) {
                    $arreglo = '<div class="etiqueta  label-danger">' . $valor . '%</div>';
                } else if ($valor == 100) {
                    $arreglo = '<div class="etiqueta  label-success">' . $valor . '%</div>';
                } else {
                    $arreglo = '<div class="etiqueta  label-proceso">' . $valor . '%</div>';
                }
                return ($arreglo);
            }

            function ColocarColores($valor)
            {
                if ($valor == 0) {
                    $arreglo = '<div class="etiqueta  label-danger">' . $valor . '</div>';
                } else if ($valor == 100) {
                    $arreglo = '<div class="etiqueta  label-success">' . $valor . '</div>';
                } else {
                    $arreglo = '<div class="etiqueta  label-proceso">' . $valor . '</div>';
                }
                return ($arreglo);
            }

            function ListadoEvaluadoresPorProceso($PRINCIPAL, $arreglo_post, $pagina, $tipo_listado, $id_proceso, $excel, $campo_criterio, $criterio, $valor_criterio, $id_empresa)
            {
                //IMPORTANTE////
                $datos_empresa = DatosEmpresa($id_empresa);
                //EL CAMPO CRITERIO, es para cuando se muestren los resumenes.
                //Traigo el total de empresas que existen en el sistema
                //Con la variable tipo usuario, veo si es para el listado de usuarios, o para el listado de envio de correos.
                $datos_proceso = TraeProcesosDeEvaluacionPorIDProceso($id_proceso);
                $campos_para_reporte = CamposParaReporte("veEvaluadorPorProceso", $_SESSION["id_empresa"]);
                //$usuarios=TotalUsuarios($arreglo_post, $_SESSION["id_empresa"], $pagina, $usuarios_por_pagina);
                //$usuarios=SelectParaPaginacionUsuario("tbl_usuario", $_SESSION["id_empresa"], $usuarios_por_pagina);
                $PRINCIPAL = str_replace("{FILTROS_SUPERIORES}", file_get_contents("views/filtros/barra_superior_reportes_avances.html"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{BUSCADOR}", file_get_contents("views/buscador_personas/buscador.html"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ENVIRONMENT}", "veEvaluadorPorProceso&i=" . Encodear3($id_proceso), $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOMBRE_PROCESO}", utf8_encode($datos_proceso[0]->descripcion_proceso), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_PROCESO_ANUAL}", Encodear3($datos_proceso[0]->id_proceso_anual), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_PROCESO_EVAL}", Encodear3($id_proceso), $PRINCIPAL);
                //$usuarios=DatosParaListadoPaginado("tbl_sgd_proceso_anual", $_SESSION["id_empresa"], $usuarios_por_pagina, $pagina, $arreglo_post);
                //$usuarios=TraeRelacionesPorProceso($id_proceso, $usuarios_por_pagina, $pagina, $arreglo_post);
                //$usuarios=TraeEvaluadoresPorProceso($id_proceso, $usuarios_por_pagina, $pagina, $arreglo_post, $campo_criterio, $criterio, $valor_criterio, $campos_para_reporte);
                $usuarios = TraeEvaluadoresPorProceso3Campos($id_proceso, $usuarios_por_pagina, $pagina, $arreglo_post, $campo_criterio, $criterio, $valor_criterio, $campos_para_reporte, $datos_empresa);
                //Coloca Encabezado dinamico por empresa
                //Traigo los pasos por proceso
                $PRINCIPAL = str_replace("{ENCABEZADO_DINAMICO}", MuestraEncabezadoPorProceso($id_proceso), $PRINCIPAL);
                //$PRINCIPAL = str_replace("{PAGINACION}",ArmaPaginacionGenerico($pagina, "veEvaluadorPorProceso&i=".Encodear3($id_proceso), "tbl_sgd_relaciones", $usuarios_por_pagina, $arreglo_post, $_SESSION["id_empresa"], $id_proceso, "reporteEvaluador"),$PRINCIPAL);
                $PRINCIPAL = str_replace("{PAGINACION}", "", $PRINCIPAL);
                $total_empresas = "";
                if ($excel == 1) {
                    $html_row = file_get_contents("views/procesos/reportes/row_listado_evaluador_por_proceso_excel.html");
                } else {
                    $html_row = file_get_contents("views/procesos/reportes/" . $id_empresa . "_row_listado_evaluador_por_proceso.html");
                }
                $i = 1;
                $valor_campo_criterio = "";
                $contador_campo_criterio = 0;
                foreach ($usuarios as $unico) {
                    $row = $html_row;
                    if ($pagina == 1) {
                        $row = str_replace("{N}", $i, $row);
                    } else {
                        $row = str_replace("{N}", $i + (($pagina - 1) * $usuarios_por_pagina), $row);
                    }
                    $i++;
                    $row = str_replace("{RUT_EVALUADOR}", $unico->rut_completo_evaluador, $row);
                    $row = str_replace("{FOTO_EVALUADOR}", VerificaFotoPersonalDesdeAdmin($unico->evaluador), $row);
                    $row = str_replace("{RUT_EVALUADOR_ENCODEADO}", Encodear3($unico->evaluador), $row);
                    $row = str_replace("{NOMBRE_EVALUADOR}", $unico->nombre_evaluador, $row);
                    $row = str_replace("{CARGO_EVALUADOR}", $unico->cargo_evaluador, $row);
                    $row = str_replace("{GERENCIA_EVALUADOR}", $unico->gerencia_evaluador, $row);
                    $row = str_replace("{GERENCIA_EVALUADOR}", $unico->gerencia_evaluador, $row);
                    $row = str_replace("{CAMPO1}", $unico->campo1, $row);
                    $row = str_replace("{CAMPO2}", $unico->campo2, $row);
                    $row = str_replace("{CAMPO3}", $unico->campo3, $row);
                    $row = str_replace("{CANTIDAD_EVALUADOS}", $unico->total_evaluados, $row);
                    $row = str_replace("{CAMBIO_CLAVE}", ColocaEtiquetaReportesSGD($unico->clave_creada, 1), $row);
                    //$porcentaje_Avance_evaluador=PorcentajeAvanceEvaluador($unico->evaluador, $id_proceso);
                    $porcentaje_Avance_evaluador = AvanceDeEvaluados($unico->evaluador, $id_proceso, "", "");
                    //$row = str_replace("{TOTAL_FINALIZADOS}",ColocaEtiquetaReportesSGD($unico->total_finalizados, $unico->total_evaluados),$row);
                    $row = str_replace("{TOTAL_FINALIZADOS}", ColocarColoresConPorcentaje($porcentaje_Avance_evaluador[0]), $row);
                    $porcentaje_avance_feedback = round(($unico->total_feedback * 100) / $unico->total_evaluados);
                    $row = str_replace("{AVANCE_FEEDBACK}", ColocaEtiquetaReportesSGD($unico->total_feedback + 0, $unico->total_evaluados), $row);
                    $row = str_replace("{TOTAL_EN_PROCESO}", ColocaEtiquetaReportesSGD($unico->total_en_proceso + 0, $unico->total_evaluados), $row);
                    $row = str_replace("{ID_REGISTRO_FINALIZADO_EVALUADO_EVALUADOR}", Encodear3($unico->id_registro_finalizado), $row);
                    $row = str_replace("{ID_PROCESO_ENCODEADO}", Encodear3($id_proceso), $row);
                    //$row = str_replace("{POR_FINALIZADOS}",($unico->total_finalizados*100)/$unico->total_evaluados."%",$row);
                    if ($campo_criterio) {
                        //Total Evaluados
                        $total_total_evaluados = $total_total_evaluados + $unico->total_evaluados;
                        $total_total_claves = $total_total_claves + $unico->clave_creada;
                        $total_porcentaje_avance_evaluacion = $total_porcentaje_avance_evaluacion + $porcentaje_Avance_evaluador[0];
                        if ($valor_campo_criterio <> $unico->valor_campo_criterio) {
                            $contador_campo_criterio++;
                            $arreglo_campo_criterios[$contador_campo_criterio][0] = $unico->valor_campo_criterio;
                            $valor_campo_criterio = $unico->valor_campo_criterio;
                        }
                        //Total de Evaluados
                        //$arreglo_campo_criterios[$contador_campo_criterio][1]=$arreglo_campo_criterios[$contador_campo_criterio][1]+$unico->total_evaluados;
                        $arreglo_campo_criterios[$contador_campo_criterio][1]++;
                        //Total Claves
                        $arreglo_campo_criterios[$contador_campo_criterio][2] = $arreglo_campo_criterios[$contador_campo_criterio][2] + $unico->clave_creada;
                        //Porcentaje Eval
                        $arreglo_campo_criterios[$contador_campo_criterio][3] = $arreglo_campo_criterios[$contador_campo_criterio][3] + $porcentaje_Avance_evaluador[0];
                        $i++;
                        $total_claves_cambiadas = $total_claves_cambiadas + $unico->clave_creada;
                    }
                    $total_empresas .= $row;
                }
                $PRINCIPAL = str_replace("{ROW_LISTADO_USUARIOS}", utf8_encode($total_empresas), $PRINCIPAL);
                if ($campo_criterio) {
                    //LOS TOTALES
                    //$PRINCIPAL = str_replace("{TOTAL_EVALUADOS}",$total_total_evaluados,$PRINCIPAL);
                    $PRINCIPAL = str_replace("{TOTAL_EVALUADOS}", count($usuarios), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{TOTAL_CAMBIO_CLAVE}", ColocaEtiquetaReportesSGD($total_total_claves, count($usuarios)), $PRINCIPAL);
                    //$PRINCIPAL = str_replace("{TOTAL_EVAL}",ColocarColoresConPorcentaje(FormatearPorcentajes($total_porcentaje_avance_evaluacion/count($usuarios))),$PRINCIPAL);
                    $porcentaje_Avance_por_proceso = AvanceDeEvaluados("", $id_proceso, "", "");
                    $PRINCIPAL = str_replace("{TOTAL_EVAL}", ColocarColoresConPorcentaje($porcentaje_Avance_por_proceso[0]), $PRINCIPAL);
                    //Traigo los criterios de la tabla de resumen
                    //$criterios=CriteriosParaTablaResumenReporteAvance($_SESSION["id_empresa"], $campo_criterio);
                    //foreach($criterios as $cri){
                    //}
                    for ($j = 1; $j <= count($arreglo_campo_criterios); $j++) {
                        $html_row_tabla_resumen .= file_get_contents("views/procesos/reportes/row_tabla_superior_resumen.html");
                        $html_row_tabla_resumen = str_replace("{NOMBRE}", ($arreglo_campo_criterios[$j][0]), $html_row_tabla_resumen);
                        $html_row_tabla_resumen = str_replace("{TOTAL_EVALUADOS}", utf8_encode($arreglo_campo_criterios[$j][1]), $html_row_tabla_resumen);
                        $html_row_tabla_resumen = str_replace("{TOTAL_CAMBIO_CLAVE}", ColocaEtiquetaReportesSGD($arreglo_campo_criterios[$j][2], $arreglo_campo_criterios[$j][1]), $html_row_tabla_resumen);
                        //$html_row_tabla_resumen = str_replace("{TOTAL_EVAL}",ColocarColoresConPorcentaje(FormatearPorcentajes($arreglo_campo_criterios[$j][3]/count($usuarios))),$html_row_tabla_resumen);
                        $porcentaje_Avance_evaluador = AvanceDeEvaluados("", $id_proceso, $campo_criterio, $arreglo_campo_criterios[$j][0]);
                        $html_row_tabla_resumen = str_replace("{TOTAL_EVAL}", ColocarColoresConPorcentaje($porcentaje_Avance_evaluador[0]), $html_row_tabla_resumen);
                        $html_row_tabla_resumen = str_replace("{ID_PROCESO_ENCODEADO}", Encodear3($id_proceso), $html_row_tabla_resumen);
                        $html_row_tabla_resumen = str_replace("{CRITERIO_ENCODEADO}", Encodear3($campo_criterio), $html_row_tabla_resumen);
                        $html_row_tabla_resumen = str_replace("{VALOR_CRITERIO_ENCODEADO}", Encodear3($arreglo_campo_criterios[$j][0]), $html_row_tabla_resumen);
                    }
                    if ($excel == 1) {
                        $PRINCIPAL = str_replace("{LISTADO_AREAS_DATOS}", utf8_decode($html_row_tabla_resumen), $PRINCIPAL);
                    } else {
                        $PRINCIPAL = str_replace("{LISTADO_AREAS_DATOS}", utf8_encode($html_row_tabla_resumen), $PRINCIPAL);
                    }
                }
                return ($PRINCIPAL);
            }

            function ObtenerEstadoEvalDadoEvaluadoEvaluadorProceso($evaluado, $evaluador, $id_proceso, $nombre_empresa)
            {
                //Est funcion me devuelve No iniciado, en proceso o finalizado la evaluacion
                //primeri verifico si estÃ¡ finalizada en la tabla
                if ($nombre_empresa == "chilquinta") {
                    //Veo si la eval está calibrada o no
                    $eval_calibrada = VerificoCalibradoSGD($evaluado, $evaluador, $id_proceso);
                    if ($eval_calibrada) {
                        $arreglo[0] = '<div class="etiqueta  label-success">Finalizado</div>';
                        $arreglo[1] = 4;
                    } else {
                        $eval_finalizada = FinalizadoEvaluadoEvaluadorProProceso($evaluado, $evaluador, $id_proceso);
                        if ($eval_finalizada) {
                            $arreglo[0] = '<div class="etiqueta  label-success">En Calibracion</div>';
                            $arreglo[1] = 3;
                        } else {
                            $tiene_respuesta = TieneRespuestasPorEvaluadoEvaluadorIdProceso($evaluado, $evaluador, $id_proceso);
                            if ($tiene_respuesta) {
                                $arreglo[0] = '<div class="etiqueta  label-proceso">En Evaluacion</div>';
                                $arreglo[1] = 2;
                            } else {
                                $arreglo[0] = '<div class="etiqueta  label-danger">No Iniciado</div>';
                                $arreglo[1] = 1;
                            }
                        }
                    }
                } else {
                    $eval_finalizada = FinalizadoEvaluadoEvaluadorProProceso($evaluado, $evaluador, $id_proceso);
                    if ($eval_finalizada) {
                        if ($nombre_empresa == "chilquinta") {
                            $arreglo[0] = '<div class="etiqueta  label-success">En Calibracion</div>';
                            $arreglo[1] = 3;
                        } else {
                            $arreglo[0] = '<div class="etiqueta  label-success">Finalizado</div>';
                            $arreglo[1] = 3;
                        }
                    } else {
                        if ($nombre_empresa == "turbus") {
                            $tiene_respuesta = TieneRespuestasPorEvaluadoEvaluadorIdProcesoSinPrecargadas($evaluado, $evaluador, $id_proceso);
                        } else {
                            $tiene_respuesta = TieneRespuestasPorEvaluadoEvaluadorIdProceso($evaluado, $evaluador, $id_proceso);
                        }
                        if ($tiene_respuesta) {
                            $arreglo[0] = '<div class="etiqueta  label-proceso">En Evaluacion</div>';
                            $arreglo[1] = 2;
                        } else {
                            $arreglo[0] = '<div class="etiqueta  label-danger">No Iniciado</div>';
                            $arreglo[1] = 1;
                        }
                    }
                }
                return ($arreglo);
            }

            function ListadoRelacionesEvaluadoEvaluadorProProceso($PRINCIPAL, $arreglo_post, $pagina, $tipo_listado, $id_proceso, $rut_evaluador, $excel, $campo_criterio, $criterio, $valor_criterio)
            {
                //Traigo el total de empresas que existen en el sistema
                //Con la variable tipo usuario, veo si es para el listado de usuarios, o para el listado de envio de correos.
                $datos_proceso = TraeProcesosDeEvaluacionPorIDProceso($id_proceso);
                $id_empresa = $_SESSION["id_empresa"];
                $datos_empresa = DatosEmpresa($id_empresa);
                if ($arreglo_post["n_registros"]) {
                    $usuarios_por_pagina = $arreglo_post["n_registros"];
                } else {
                    $usuarios_por_pagina = 200;
                }
                if (!$pagina) {
                    $pagina = 1;
                }
                //$usuarios=TotalUsuarios($arreglo_post, $_SESSION["id_empresa"], $pagina, $usuarios_por_pagina);
                //$usuarios=SelectParaPaginacionUsuario("tbl_usuario", $_SESSION["id_empresa"], $usuarios_por_pagina);
                $PRINCIPAL = str_replace("{FILTROS_SUPERIORES}", file_get_contents("views/filtros/barra_superior_reportes_avances.html"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{BUSCADOR}", file_get_contents("views/buscador_personas/buscador.html"), $PRINCIPAL);
                $campos_para_reporte = CamposParaReporte("veRelacionesPorPoceso", $_SESSION["id_empresa"]);
                $campos_para_reporte_datos_evaluador = CamposParaReporte("veEvaluadorPorProceso", $_SESSION["id_empresa"]);
                if ($rut_evaluador) {
                    $datos_evaluador = DatosTablaUsuario($rut_evaluador);
                    $PRINCIPAL = str_replace("{ENVIRONMENT}", "veRelacionesPorPoceso&i=" . Encodear3($id_proceso) . "&revr=" . Encodear3($rut_evaluador), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{NOMBRE_EVALUADOR}", "<br>Evaluador: " . $datos_evaluador[0]->nombre_completo, $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{ENVIRONMENT}", "veRelacionesPorPoceso&i=" . Encodear3($id_proceso), $PRINCIPAL);
                }
                $PRINCIPAL = str_replace("{NOMBRE_PROCESO}", utf8_encode($datos_proceso[0]->descripcion_proceso), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_PROCESO_ANUAL}", Encodear3($datos_proceso[0]->id_proceso_anual), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_PROCESO}", Encodear3($id_proceso), $PRINCIPAL);
                //$usuarios=DatosParaListadoPaginado("tbl_sgd_proceso_anual", $_SESSION["id_empresa"], $usuarios_por_pagina, $pagina, $arreglo_post);
                //$usuarios=TraeRelacionesPorProceso($id_proceso, $usuarios_por_pagina, $pagina, $arreglo_post, $rut_evaluador);
                $usuarios = TraeRelacionesPorProceso($id_proceso, $usuarios_por_pagina, $pagina, $arreglo_post, $rut_evaluador, $campo_criterio, $criterio, $valor_criterio, $campos_para_reporte, $campos_para_reporte_datos_evaluador, $datos_empresa);
                //$PRINCIPAL = str_replace("{PAGINACION}",ArmaPaginacionGenerico($pagina, "veRelacionesPorPoceso&i=".Encodear3($id_proceso), "tbl_sgd_relaciones", $usuarios_por_pagina, $arreglo_post, $_SESSION["id_empresa"], $id_proceso, "", $rut_evaluador),$PRINCIPAL);
                $PRINCIPAL = str_replace("{PAGINACION}", "", $PRINCIPAL);
                $total_empresas = "";
                if ($excel == 1) {
                    $html_row = file_get_contents("views/procesos/reportes/row_listado_relaciones_por_proceso_excel.html");
                } else {
                    $html_row = file_get_contents("views/procesos/reportes/row_listado_relaciones_por_proceso.html");
                }
                $i = 1;
                $valor_campo_criterio = "";
                foreach ($usuarios as $unico) {
                    $row = $html_row;
                    if ($pagina == 1) {
                        $row = str_replace("{N}", $i, $row);
                    } else {
                        $row = str_replace("{N}", $i + (($pagina - 1) * $usuarios_por_pagina), $row);
                    }
                    $i++;
                    $row = str_replace("{FOTO_EVALUADO}", VerificaFotoPersonalDesdeAdmin($unico->evaluado), $row);
                    $row = str_replace("{FOTO_EVALUADOR}", VerificaFotoPersonalDesdeAdmin($unico->evaluador), $row);
                    $row = str_replace("{RUT_EVALUADO}", $unico > rut_completo_evaluado, $row);
                    $row = str_replace("{RUT_EVALUADOR}", $unico->rut_completo_evaluador, $row);
                    $row = str_replace("{CAMPO1}", $unico->campo1, $row);
                    $row = str_replace("{CAMPO2}", $unico->campo2, $row);
                    $row = str_replace("{CAMPO3}", $unico->campo3, $row);
                    $row = str_replace("{CAMPO1_EVALUADOR}", $unico->campo1_evaluador, $row);
                    $row = str_replace("{CAMPO2_EVALUADOR}", $unico->campo2_evaluador, $row);
                    $row = str_replace("{CAMPO3_EVALUADOR}", $unico->campo3_evaluador, $row);
                    $row = str_replace("{NOMBRE_EVALUADO}", $unico->nombre_evaluado, $row);
                    $row = str_replace("{NOMBRE_EVALUADOR}", $unico->nombre_evaluador, $row);
                    $row = str_replace("{CARGO_EVALUADOR}", $unico->cargo_evaluador, $row);
                    $row = str_replace("{CARGO_EVALUADO}", $unico->cargo_evaluado, $row);
                    $row = str_replace("{GERENCIA_EVALUADOR}", $unico->gerencia_evaluador, $row);
                    $row = str_replace("{GERENCIA_EVALUADO}", $unico->gerencia_evaluado, $row);
                    $row = str_replace("{EMPRESA_EVALUADOR}", $unico->nombre_empresa_evaluador, $row);
                    $row = str_replace("{EMPRESA_EVALUADO}", $unico->nombre_empresa_evaluado, $row);
                    $row = str_replace("{PERFIL_EVALUACION}", $unico->nombre_perfil, $row);
                    $row = str_replace("{SUBPERFIL_EVALUACION}", $unico->nombre_sub_perfil, $row);
                    $row = str_replace("{ID_REGISTRO_FINALIZADO_EVALUADO_EVALUADOR}", Encodear3($unico->id_registro_finalizado), $row);
                    $row = str_replace("{ID_PROCESO_ENCODEADO}", Encodear3($id_proceso), $row);
                    if ($_SESSION["id_empresa"] == 43) {
                        $estado_evaluacion = ObtenerEstadoEvalDadoEvaluadoEvaluadorProceso($unico->evaluado, $unico->evaluador, $id_proceso, "turbus");
                    } else if ($_SESSION["id_empresa"] == 28) {
                        $estado_evaluacion = ObtenerEstadoEvalDadoEvaluadoEvaluadorProceso($unico->evaluado, $unico->evaluador, $id_proceso, "chilquinta");
                    } else {
                        $estado_evaluacion = ObtenerEstadoEvalDadoEvaluadoEvaluadorProceso($unico->evaluado, $unico->evaluador, $id_proceso, "");
                    }
                    $row = str_replace("{ESTADO_EVALUACION}", $estado_evaluacion[0], $row);
                    //$row = str_replace("{TOTAL_FINALIZADOS}",ColocaEtiquetaReportesSGD($unico->total_finalizados, $unico->total_evaluados),$row);
                    if (!$campo_criterio) {
                        $porcentaje_Avance_evaluado_evaluador = AvanceDeEvaluados($unico->evaluador, $id_proceso, "", "", "", $unico->evaluado);
                        $row = str_replace("{PORCENTAJE_AVANCE}", ColocarColoresConPorcentaje($porcentaje_Avance_evaluado_evaluador[0]), $row);
                    }
                    $row = str_replace("{ID_PROCESO_ANUAL_ENCODEADO}", Encodear3($unico->id), $row);
                    $row = str_replace("{ANO}", $unico->ano, $row);
                    if ($estado_evaluacion[1] == 3) {
                        $row = ArmaTemplareDeTablaResumen($row, "2015", $_SESSION["id_empresa"], $unico->perfil_evaluacion, $unico->evaluado, $unico->evaluador, "no");
                    } else {
                        $row = str_replace("{NOTA_FINAL}", "", $row);
                    }
                    $total_empresas .= $row;
                    if ($campo_criterio) {
                        //Total Evaluados
                        //$total_total_evaluados=$total_total_evaluados+$unico->total_evaluados;
                        //$total_total_claves=$total_total_claves+$unico->clave_creada;
                        //$total_porcentaje_avance_evaluacion=$total_porcentaje_avance_evaluacion+$porcentaje_Avance_evaluador[0];
                        if ($valor_campo_criterio <> $unico->valor_campo_criterio) {
                            $contador_campo_criterio++;
                            $arreglo_campo_criterios[$contador_campo_criterio][0] = $unico->valor_campo_criterio;
                            $valor_campo_criterio = $unico->valor_campo_criterio;
                        }
                        //Total de Evaluados
                        $arreglo_campo_criterios[$contador_campo_criterio][1]++;
                        //$arreglo_campo_criterios[$contador_campo_criterio][1]++;
                        //Total Claves
                        //$arreglo_campo_criterios[$contador_campo_criterio][2]=$arreglo_campo_criterios[$contador_campo_criterio][2]+$unico->clave_creada;
                        //Porcentaje Eval
                        //$arreglo_campo_criterios[$contador_campo_criterio][3]=$arreglo_campo_criterios[$contador_campo_criterio][3]+$porcentaje_Avance_evaluador[0];
                        $i++;
                        $total_claves_cambiadas = $total_claves_cambiadas + $unico->clave_creada;
                    }
                }
                if ($campo_criterio) {
                    //LOS TOTALES
                    //$PRINCIPAL = str_replace("{TOTAL_EVALUADOS}",$total_total_evaluados,$PRINCIPAL);
                    $PRINCIPAL = str_replace("{TOTAL_EVALUADOS}", count($usuarios), $PRINCIPAL);
                    $porcentaje_avance_por_proceso = AvanceDeEvaluados("", $id_proceso, "", "", "", "", "");
                    $PRINCIPAL = str_replace("{TOTAL_EVAL}", ColocarColoresConPorcentaje($porcentaje_avance_por_proceso[0]), $PRINCIPAL);
                    //$PRINCIPAL = str_replace("{TOTAL_CAMBIO_CLAVE}",ColocaEtiquetaReportesSGD($total_total_claves, count($usuarios)),$PRINCIPAL);
                    //$PRINCIPAL = str_replace("{TOTAL_EVAL}",ColocarColoresConPorcentaje(FormatearPorcentajes(),$PRINCIPAL);
                    //Traigo los criterios de la tabla de resumen
                    //$criterios=CriteriosParaTablaResumenReporteAvance($_SESSION["id_empresa"], $campo_criterio);
                    //foreach($criterios as $cri){
                    //}
                    for ($j = 1; $j <= count($arreglo_campo_criterios); $j++) {
                        $html_row_tabla_resumen .= file_get_contents("views/procesos/reportes/row_tabla_superior_resumen_evaluado_evaluador.html");
                        $html_row_tabla_resumen = str_replace("{NOMBRE}", ($arreglo_campo_criterios[$j][0]), $html_row_tabla_resumen);
                        $html_row_tabla_resumen = str_replace("{TOTAL_EVALUADOS}", utf8_encode($arreglo_campo_criterios[$j][1]), $html_row_tabla_resumen);
                        $porcentaje_avance_por_criterio = AvanceDeEvaluados("", $id_proceso, $campo_criterio, $arreglo_campo_criterios[$j][0], "", "", "evaluadoEvaluador");
                        $html_row_tabla_resumen = str_replace("{TOTAL_EVAL}", ColocarColoresConPorcentaje($porcentaje_avance_por_criterio[0]), $html_row_tabla_resumen);
                        $html_row_tabla_resumen = str_replace("{ID_PROCESO_ENCODEADO}", Encodear3($id_proceso), $html_row_tabla_resumen);
                        $html_row_tabla_resumen = str_replace("{CRITERIO_ENCODEADO}", Encodear3($campo_criterio), $html_row_tabla_resumen);
                        $html_row_tabla_resumen = str_replace("{VALOR_CRITERIO_ENCODEADO}", Encodear3($arreglo_campo_criterios[$j][0]), $html_row_tabla_resumen);
                    }
                    $PRINCIPAL = str_replace("{LISTADO_AREAS_DATOS}", utf8_encode($html_row_tabla_resumen), $PRINCIPAL);
                }
                if ($excel == 1) {
                    $PRINCIPAL = str_replace("{ROW_LISTADO_USUARIOS}", ($total_empresas), $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{ROW_LISTADO_USUARIOS}", utf8_encode($total_empresas), $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function ListadoPreguntas($PRINCIPAL, $arreglo_post, $pagina, $tipo_listado)
            {
                //Traigo el total de empresas que existen en el sistema
                //Con la variable tipo usuario, veo si es para el listado de usuarios, o para el listado de envio de correos.
                if ($arreglo_post["n_registros"]) {
                    $usuarios_por_pagina = $arreglo_post["n_registros"];
                } else {
                    $usuarios_por_pagina = 50;
                }
                if (!$pagina) {
                    $pagina = 1;
                }
                //$usuarios=TotalUsuarios($arreglo_post, $_SESSION["id_empresa"], $pagina, $usuarios_por_pagina);
                //$usuarios=SelectParaPaginacionUsuario("tbl_usuario", $_SESSION["id_empresa"], $usuarios_por_pagina);
                $PRINCIPAL = str_replace("{FILTROS_SUPERIORES}", file_get_contents("views/filtros/barra_superior_usuarios.html"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ENVIRONMENT}", $entorno_para_paginacion, $PRINCIPAL);
                //$usuarios=DatosParaListadoPaginado("tbl_sgd_preguntas", $_SESSION["id_empresa"], $usuarios_por_pagina, $pagina, $arreglo_post);
                $preguntas = TotalPreguntasPorEmpresa($_SESSION["id_empresa"]);
                $PRINCIPAL = str_replace("{PAGINACION}", ArmaPaginacionGenerico($pagina, $entorno_para_paginacion, "tbl_sgd_proceso_anual", $usuarios_por_pagina, $arreglo_post, $_SESSION["id_empresa"]), $PRINCIPAL);
                $total_empresas = "";
                $html_row = file_get_contents("views/competencias/row_listado.html");
                $i = 1;
                foreach ($preguntas as $unico) {
                    $row = $html_row;
                    if ($pagina == 1) {
                        $row = str_replace("{N}", $i, $row);
                    } else {
                        $row = str_replace("{N}", $i + (($pagina - 1) * $usuarios_por_pagina), $row);
                    }
                    $i++;
                    $row = str_replace("{ID_COMPETENCIA}", Encodear3($unico->id), $row);
                    $row = str_replace("{NOMBRE}", $unico->pregunta, $row);
                    $row = str_replace("{ID_PERFIL}", Encodear3($unico->perfil), $row);
                    $row = str_replace("{DESCRIPCION}", $unico->descripcion, $row);
                    //Por cada pregunta, veo a que competencia estÃ¡ asociada
                    $datos_competencia = DatosCompetenciaDadoId($unico->id_competencia);
                    $row = str_replace("{PERFILES}", $datos_competencia[0]->nombre, $row);
                    $total_empresas .= $row;
                }
                $PRINCIPAL = str_replace("{ROW_LISTADO_USUARIOS}", utf8_encode($total_empresas), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function ListadoAlternativasPorEmpresa($PRINCIPAL, $id_empresa)
            {
                $PRINCIPAL = str_replace("{FILTROS_SUPERIORES}", file_get_contents("views/filtros/barra_superior_usuarios.html"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ENVIRONMENT}", $entorno_para_paginacion, $PRINCIPAL);
                $alternativas = TotalAlternativasPorEmpresa($_SESSION["id_empresa"]);
                $total_empresas = "";
                $html_row = file_get_contents("views/sgd_alternativas/row_listado.html");
                $i = 1;
                foreach ($alternativas as $unico) {
                    $row = $html_row;
                    $row = str_replace("{N}", $i, $row);
                    $i++;
                    //Traigo las alternativas, dado el id_grupo_alternativas
                    $total_alternativas = TraigoAlternativasDadoIdGrupoAlternativa($unico->id_grupo_alternativa);
                    $texto_alternativas = "<ul>";
                    foreach ($total_alternativas as $alt) {
                        $texto_alternativas .= "<li>" . $alt->alternativa . "</li>";
                    }
                    $texto_alternativas .= "</ul>";
                    $row = str_replace("{ALTERNATIVAS}", $texto_alternativas, $row);
                    $total_empresas .= $row;
                }
                $PRINCIPAL = str_replace("{ROW_LISTADO_USUARIOS}", utf8_encode($total_empresas), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function ListadoRelacionesCompetenciasPreguntas($PRINCIPAL, $id_competencia)
            {
                $id_empresa = $_SESSION["id_empresa"];
                $datos_competencia = DatosCompetenciaDadoId($id_competencia);
                $PRINCIPAL = str_replace("{ID_COMPETENCIA_ENCODEADO}", Encodear3($id_competencia), $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOMBRE_MALLA}", utf8_encode($datos_competencia[0]->nombre), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_COMPETENCIAS}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_sgd_preguntas", "", "pregunta", "id", "order by pregunta asc", $id_empresa), $PRINCIPAL);
                //Veo si existen relaciones nivel - curso
                //$relaciones=RelMallaPrograma($id_malla);
                //$relaciones=CompetenciasDadoPerfil21($id_perfil);
                $preguntas = PreguntasPorCompetencia($id_competencia);
                if ($preguntas) {
                    $total_row = "";
                    $i = 1;
                    foreach ($preguntas as $rel) {
                        $row = file_get_contents("views/instrumentos/row_rel_perfil_competencia.html");
                        $row = str_replace("{NOMBRE_PROGRAMA}", utf8_encode($rel->pregunta), $row);
                        $row = str_replace("{N}", $i, $row);
                        $i++;
                        $total_row .= $row;
                    }
                    $PRINCIPAL = str_replace("{LISTADO_REL_MALLA_PROGRAMA}", $total_row, $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{LISTADO_REL_MALLA_PROGRAMA}", '
        <tr class="odd">
            <td colspan="4" class=" sorting_1">No Existen programas asociados a este nivel</td>
        </tr>', $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function ListadoCompetencias($PRINCIPAL, $arreglo_post, $pagina, $tipo_listado)
            {
                //Traigo el total de empresas que existen en el sistema
                //Con la variable tipo usuario, veo si es para el listado de usuarios, o para el listado de envio de correos.
                if ($arreglo_post["n_registros"]) {
                    $usuarios_por_pagina = $arreglo_post["n_registros"];
                } else {
                    $usuarios_por_pagina = 50;
                }
                if (!$pagina) {
                    $pagina = 1;
                }
                //$usuarios=TotalUsuarios($arreglo_post, $_SESSION["id_empresa"], $pagina, $usuarios_por_pagina);
                //$usuarios=SelectParaPaginacionUsuario("tbl_usuario", $_SESSION["id_empresa"], $usuarios_por_pagina);
                $PRINCIPAL = str_replace("{FILTROS_SUPERIORES}", file_get_contents("views/filtros/barra_superior_usuarios.html"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ENVIRONMENT}", $entorno_para_paginacion, $PRINCIPAL);
                //$usuarios=DatosParaListadoPaginado("tbl_sgd_componente", $_SESSION["id_empresa"], $usuarios_por_pagina, $pagina, $arreglo_post);
                $componentes = TotalCompetenciasDadoEmpresa($_SESSION["id_empresa"]);
                $PRINCIPAL = str_replace("{PAGINACION}", ArmaPaginacionGenerico($pagina, $entorno_para_paginacion, "tbl_sgd_proceso_anual", $usuarios_por_pagina, $arreglo_post, $_SESSION["id_empresa"]), $PRINCIPAL);
                $total_empresas = "";
                $html_row = file_get_contents("views/competencias/row_listado.html");
                $i = 1;
                foreach ($componentes as $unico) {
                    $row = $html_row;
                    if ($pagina == 1) {
                        $row = str_replace("{N}", $i, $row);
                    } else {
                        $row = str_replace("{N}", $i + (($pagina - 1) * $usuarios_por_pagina), $row);
                    }
                    $i++;
                    $row = str_replace("{ID_COMPETENCIA}", Encodear3($unico->id), $row);
                    $row = str_replace("{NOMBRE}", $unico->nombre, $row);
                    $row = str_replace("{ID_PERFIL}", Encodear3($unico->perfil), $row);
                    $row = str_replace("{DESCRIPCION}", $unico->descripcion, $row);
                    //Por cada competencia, veo a cuantos perfiles esta asociados
                    $perfiles_por_competencia = PerfilesDadoCompetencias($unico->id);
                    $texto_perfiles = "";
                    foreach ($perfiles_por_competencia as $unico_per) {
                        $texto_perfiles .= $unico_per->nombre_perfil . "<br>";
                    }
                    $row = str_replace("{PERFILES}", $texto_perfiles, $row);
                    $total_empresas .= $row;
                }
                $PRINCIPAL = str_replace("{ROW_LISTADO_USUARIOS}", utf8_encode($total_empresas), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function ListadoRelacionesPerfilesCompetencias($PRINCIPAL, $id_perfil)
            {
                $id_empresa = $_SESSION["id_empresa"];
                $datos_perfil = TraePonderacionesPorPerfil($id_perfil);
                $PRINCIPAL = str_replace("{ID_PERFIL_ENCODEADO}", Encodear3($id_perfil), $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOMBRE_MALLA}", utf8_encode($datos_perfil[0]->descripcion), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_COMPETENCIAS}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_sgd_componente", "", "nombre", "id", "order by orden asc", $id_empresa), $PRINCIPAL);
                //Veo si existen relaciones nivel - curso
                //$relaciones=RelMallaPrograma($id_malla);
                $relaciones = CompetenciasDadoPerfil21($id_perfil);
                if ($relaciones) {
                    $total_row = "";
                    $i = 1;
                    foreach ($relaciones as $rel) {
                        $row = file_get_contents("views/instrumentos/row_rel_perfil_competencia.html");
                        $row = str_replace("{NOMBRE_PROGRAMA}", utf8_encode($rel->nombre_componente), $row);
                        $row = str_replace("{ID_PERFIL_ENCODEADO}", Encodear3($id_perfil), $row);
                        $row = str_replace("{ID_COMPETENCIA_ENCODEADA}", Encodear3($rel->id_componente), $row);
                        $row = str_replace("{N}", $i, $row);
                        $i++;
                        $total_row .= $row;
                    }
                    $PRINCIPAL = str_replace("{LISTADO_REL_MALLA_PROGRAMA}", $total_row, $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{LISTADO_REL_MALLA_PROGRAMA}", '
        <tr class="odd">
            <td colspan="4" class=" sorting_1">No existen competencias asociados a este perfil de evaluación</td>
        </tr>', $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function ListadoInstrumentos($PRINCIPAL, $arreglo_post, $pagina, $tipo_listado)
            {
                //Traigo el total de empresas que existen en el sistema
                //Con la variable tipo usuario, veo si es para el listado de usuarios, o para el listado de envio de correos.
                if ($arreglo_post["n_registros"]) {
                    $usuarios_por_pagina = $arreglo_post["n_registros"];
                } else {
                    $usuarios_por_pagina = 50;
                }
                if (!$pagina) {
                    $pagina = 1;
                }
                //$usuarios=TotalUsuarios($arreglo_post, $_SESSION["id_empresa"], $pagina, $usuarios_por_pagina);
                //$usuarios=SelectParaPaginacionUsuario("tbl_usuario", $_SESSION["id_empresa"], $usuarios_por_pagina);
                $PRINCIPAL = str_replace("{FILTROS_SUPERIORES}", file_get_contents("views/filtros/barra_superior_usuarios.html"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ENVIRONMENT}", $entorno_para_paginacion, $PRINCIPAL);
                //$usuarios=DatosParaListadoPaginado("tbl_sgd_perfiles_ponderaciones", $_SESSION["id_empresa"], $usuarios_por_pagina, $pagina, $arreglo_post);
                $perfiles = TotalPerfilesDeEvaluacionSgd($_SESSION["id_empresa"]);
                $PRINCIPAL = str_replace("{PAGINACION}", ArmaPaginacionGenerico($pagina, $entorno_para_paginacion, "tbl_sgd_proceso_anual", $usuarios_por_pagina, $arreglo_post, $_SESSION["id_empresa"]), $PRINCIPAL);
                $total_empresas = "";
                $html_row = file_get_contents("views/instrumentos/row_listado.html");
                $i = 1;
                foreach ($perfiles as $unico) {
                    $row = $html_row;
                    if ($pagina == 1) {
                        $row = str_replace("{N}", $i, $row);
                    } else {
                        $row = str_replace("{N}", $i + (($pagina - 1) * $usuarios_por_pagina), $row);
                    }
                    $i++;
                    $row = str_replace("{NOMBRE_PROCESO}", $unico->descripcion, $row);
                    $row = str_replace("{ID_PERFIL}", Encodear3($unico->perfil), $row);
                    $row = str_replace("{CODIGO_INSTRUMENTO}", $unico->perfil, $row);
                    $row = str_replace("{DESCRIPCION}", $unico->descripcion_texto, $row);
                    $row = str_replace("{ID_PROCESO_ANUAL_ENCODEADO}", Encodear3($unico->id), $row);
                    $row = str_replace("{ANO}", $unico->ano, $row);
                    $total_empresas .= $row;
                }
                $PRINCIPAL = str_replace("{ROW_LISTADO_USUARIOS}", utf8_encode($total_empresas), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function ColocaDatosProcesoAnual($PRINCIPAL, $id_proceso_anual, $id_empresa)
            {
                $datos_proceso_anual = DatosProcesoAnualPorId($id_proceso_anual);
                $PRINCIPAL = str_replace("{VALOR_BOTON}", "Agregar etapa a proceso anual", $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOMBRE_PROCESO}", utf8_encode($datos_proceso_anual[0]->nombre_proceso), $PRINCIPAL);
                $PRINCIPAL = str_replace("{TITULO}", "Asociar Etapas a Proceso Anual", $PRINCIPAL);
                $PRINCIPAL = str_replace("{DESCRIPCION_PROCESO}", utf8_encode($datos_proceso_anual[0]->descripcion), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ANO_PROCESO}", $datos_proceso_anual[0]->ano, $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_TIPOS_PROCESO_EVALUACION}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_sgd_proceso_tipo", "", "descripcion", "id", "order by descripcion asc", ""), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_PROCESO_ANUAL}", Encodear3($id_proceso_anual), $PRINCIPAL);
                //$procesos_eval_por_proc_anual=ProcesosEvalPorProcesoAnual($id_proceso_anual);
                if ($id_empresa == 22) {
                    $procesos_eval_por_proc_anual = ProcesosEvalPorProcesoAnualSoloFij($id_proceso_anual);
                } else {
                    //$procesos_eval_por_proc_anual=ProcesosEvalPorProcesoAnualSoloEval($id_proceso_anual);
                    $procesos_eval_por_proc_anual = ProcesosEvalPorProcesoAnual($id_proceso_anual);
                }
                $PRINCIPAL = str_replace("{FILTROS_SUPERIORES}", file_get_contents("views/filtros/barra_superior_usuarios.html"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ENVIRONMENT}", $entorno_para_paginacion, $PRINCIPAL);
                $usuarios = DatosParaListadoPaginado("tbl_sgd_proceso_anual", $_SESSION["id_empresa"], $usuarios_por_pagina, $pagina, $arreglo_post);
                $PRINCIPAL = str_replace("{PAGINACION}", "", $PRINCIPAL);
                if ($procesos_eval_por_proc_anual) {
                    $i = 1;
                    foreach ($procesos_eval_por_proc_anual as $proc) {
                        if ($proc->tipo_proceso == 1) {
                            $row .= file_get_contents("views/procesos/" . $id_empresa . "_row_etapas_por_proceso_anual.html");
                        } else if ($proc->tipo_proceso == 2) {
                            $row .= file_get_contents("views/procesos/" . $id_empresa . "_row_etapas_por_proceso_anual_fijacion_objetivos.html");
                        }
                        if ($proc->tipo_proceso == 1) {
                            $row = str_replace("{BOTON_GESTION_RELACIONES}", file_get_contents("views/procesos/boton_gestion_relaciones.html"), $row);
                        } else {
                            $row = str_replace("{BOTON_GESTION_RELACIONES}", "", $row);
                        }
                        $row = str_replace("{NUMERO}", $i, $row);
                        $row = str_replace("{NOMBRE}", $proc->descripcion_proceso, $row);
                        $row = str_replace("{DESCRIPCION}", $proc->descripcion, $row);
                        $row = str_replace("{FECHA_INICIO}", FormateaFecha($proc->fecha_inicio), $row);
                        $row = str_replace("{FECHA_TERMINO}", FormateaFecha($proc->fecha_termino), $row);
                        $estado_proc_ = EstadoProcesoSegunFechas($proc->fecha_inicio, $proc->fecha_termino);
                        $row = str_replace("{ESTADO}", $estado_proc_[0], $row);
                        $row = str_replace("{ID_PROCESO}", Encodear3($proc->id_proceso), $row);
                        $row = str_replace("{TIPO}", ($proc->tipo_proceso), $row);
                        $row = str_replace("{ID_PROCESO_RELACIONES}", Encodear3($proc->id_proceso_relaciones), $row);
                        $row = str_replace("{ID_PROCESO_ANUAL_ENCODEADO}", Encodear3($id_proceso_anual), $row);
                        $row = str_replace("{ID_PROCESO_SIN_ENCODEAR}", ($proc->id_proceso), $row);
                        /*if($proc->tipo_proceso==1){
                $porcentaje_avance_proceso=PorcentajeAvanceProcesoEvaluacion($proc->id_proceso);
                $row = str_replace("{PORCENTAJE_POR_PROCESO}",ColocarColoresConPorcentaje(FormatearPorcentajes($porcentaje_avance_proceso[0])),$row);
            }else{
                $row = str_replace("{PORCENTAJE_POR_PROCESO}","",$row);
            }*/
                        $porcentaje_Avance_evaluador = AvanceDeEvaluados("", $proc->id_proceso, "", "");
                        $row = str_replace("{PORCENTAJE_POR_PROCESO}", ColocarColoresConPorcentaje($porcentaje_Avance_evaluador[0]), $row);
                        $i++;
                    }
                    $PRINCIPAL = str_replace("{ROW_LISTADO_ETAPAS_POR_PROCESO_ANUAL}", utf8_encode($row), $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{ROW_LISTADO_ETAPAS_POR_PROCESO_ANUAL}", "<div class='col-md-12 miniSt'>No Tiene Etapas</div>", $PRINCIPAL);
                }
                $PRINCIPAL = str_replace("{ANO}", $datos_proceso_anual[0]->ano, $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function FormularioProcesosAnuales($PRINCIPAL, $id)
            {
                $PRINCIPAL = str_replace("{VALOR_BOTON}", "Ingresar proceso anual", $PRINCIPAL);
                $PRINCIPAL = str_replace("{ACTION}", "?sw=adProcAnual", $PRINCIPAL);
                $PRINCIPAL = str_replace("{TITULO}", "Creación nuevos procesos", $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function ListadoProcesosAnuales($PRINCIPAL, $arreglo_post, $pagina, $tipo_listado)
            {
                //Traigo el total de empresas que existen en el sistema
                //Con la variable tipo usuario, veo si es para el listado de usuarios, o para el listado de envio de correos.
                //$usuarios=TotalUsuarios($arreglo_post, $_SESSION["id_empresa"], $pagina, $usuarios_por_pagina);
                //$usuarios=SelectParaPaginacionUsuario("tbl_usuario", $_SESSION["id_empresa"], $usuarios_por_pagina);
                $PRINCIPAL = str_replace("{FILTROS_SUPERIORES}", file_get_contents("views/filtros/barra_superior_reportes_avances.html"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ENVIRONMENT}", $entorno_para_paginacion, $PRINCIPAL);
                //$usuarios=DatosParaListadoPaginado("tbl_sgd_proceso_anual", $_SESSION["id_empresa"], $usuarios_por_pagina, $pagina, $arreglo_post);
                $procesos = TraigoTotalProcesosPorEmpresa($_SESSION["id_empresa"]);
                $total_empresas = "";
                $i = 1;
                foreach ($procesos as $unico) {
                    if ($unico->activo == 1) {
                        $html_row = file_get_contents("views/procesos/" . $_SESSION["id_empresa"] . "_row_listado_activo.html");
                    } else if ($unico->desactivado == 1) {
                        $html_row = file_get_contents("views/procesos/" . $_SESSION["id_empresa"] . "_row_listado_desactivado.html");
                    } else {
                        $html_row = file_get_contents("views/procesos/" . $_SESSION["id_empresa"] . "_row_listado.html");
                    }
                    $row = $html_row;
                    if ($pagina == 1) {
                        $row = str_replace("{N}", $i, $row);
                    } else {
                        $row = str_replace("{N}", $i + (($pagina - 1) * $usuarios_por_pagina), $row);
                    }
                    $i++;
                    $row = str_replace("{NOMBRE_PROCESO}", $unico->nombre_proceso, $row);
                    $row = str_replace("{DESCRIPCION}", $unico->descripcion, $row);
                    $row = str_replace("{FECHA_INICIO}", FormateaFecha($unico->fecha_inicio), $row);
                    $row = str_replace("{FECHA_TERMINO}", FormateaFecha($unico->fecha_termino), $row);
                    if ($unico->activo == 1) {
                        $row = str_replace("{CHECKED_ANUAL}", "checked=checked'", $row);
                    } else {
                        $row = str_replace("{CHECKED_ANUAL}", "", $row);
                    }
                    $estado_proc_anual = EstadoProcesoSegunFechas($unico->fecha_inicio, $unico->fecha_termino);
                    //Traigo el proceso de la tabla procesos_evaluaciones por el proceso anual
                    $id_proceso_eval = TraeProcesoEvaluacionDadoIdProcesoAnual($unico->id);
                    if (count($id_proceso_eval) > 1) {
                        //    echo "uno de los procesos anuales de esta empresa tiene mas de un proceso de evaluacion";exit;
                    }
                    $row = str_replace("{ESTADO_PROC_ANUAL}", $estado_proc_anual[0], $row);
                    $row = str_replace("{ID_PROCESO_ANUAL_ENCODEADO}", Encodear3($unico->id), $row);
                    $row = str_replace("{ID_PROCESO_EVAL_ENCODEADO}", Encodear3($id_proceso_eval[0]->id_proceso), $row);
                    $row = str_replace("{ID_PROCESO_ANUAL}", ($unico->id), $row);
                    $row = str_replace("{ANO}", $unico->ano, $row);
                    $procesos_eval_por_proc_anual = ProcesosEvalPorProcesoAnual($unico->id);
                    $cont_proc_por_proc_anual = 0;
                    /*foreach($procesos_eval_por_proc_anual as $proc){
            $porcentaje_avance_proceso=PorcentajeAvanceProcesoEvaluacion($proc->id_proceso);
            $acum=$acum+$porcentaje_avance_proceso[0];
            $cont_proc_por_proc_anual++;
        }
         */
                    //$row = str_replace("{POR_AV_PROC_ANUAL}",ColocarColoresConPorcentaje(FormatearPorcentajes($acum/$cont_proc_por_proc_anual))."",$row);
                    //$avance=PorcentajeAvanceProcesoAnual($unico->id);
                    //$row = str_replace("{POR_AV_PROC_ANUAL}",$avance[0],$row);
                    $porcentaje_avance_anual = AvanceDeEvaluados("", "", "", "", $unico->id);
                    $row = str_replace("{POR_AV_PROC_ANUAL}", ColocarColoresConPorcentaje($porcentaje_avance_anual[0]), $row);
                    $total_empresas .= $row;
                }
                $PRINCIPAL = str_replace("{ROW_LISTADO_USUARIOS}", utf8_encode($total_empresas), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function ListadoUsuariosPorInscripcionEncuesta($id_inscripcion, $tipo_reporte, $id_empresa_holding, $arreglo_post)
            {
                $datos_inscripcion = DatosInscripcion2($id_inscripcion);
                //Traigo dimensiones dada la encuesta
                $id_encuesta = $datos_inscripcion[0]->id_encuesta_satisfaccion;
                //$listado_usuarios=TotalUsuariosPorInscripcionCerrados($id_inscripcion);
                if ($tipo_reporte == "casos_especiales") {
                    $listado_usuarios = TotalUsuariosPorInscripcionCerrados2SoloCasosEspeciales($id_inscripcion, "");
                } else {
                    $listado_usuarios = TotalUsuariosPorInscripcionCerrados2($id_inscripcion, $id_empresa_holding, "", "", "", $arreglo_post);
                }
                $row = "";
                $options = "";
                //total de usuarios aprobados
                $total_usuarios_aprobados = 0;
                foreach ($listado_usuarios as $unico) {
                    $options .= "<option value=" . $unico->rut . ">" . $unico->nombre_completo . "</option>";
                    if ($tipo_reporte == "pdf") {
                        $row .= file_get_contents("views/inscripcion/row_usuarios_por_inscripcion_reporte_pdf.html");
                    } else if ($tipo_reporte == "casos_especiales") {
                        $row .= file_get_contents("views/reporte/row_inasistencias_caso_especial.html");
                    } else {
                        $row .= file_get_contents("views/inscripcion/row_usuarios_por_inscripcion_encuesta.html");
                    }
                    //$row = str_replace("{RUT}",$unico->rut_completo,$row);
                    $row = str_replace("{RUT}", $unico->rut_sin_dv, $row);
                    $row = str_replace("{NOMBRE_USUARIO}", $unico->nombre . " " . $unico->apaterno . " " . $unico->amaterno, $row);
                    $row = str_replace("{NOMBRE_USUARIO_CASOS_ESPECIALES}", $unico->nombre . " " . $unico->apaterno . " " . $unico->amaterno, $row);
                    $row = str_replace("{CARGO}", $unico->cargo, $row);
                    $row = str_replace("{GERENCIA}", $unico->gerencia, $row);
                    $row = str_replace("{EMAIL}", $unico->email, $row);
                    $row = str_replace("{EMPRESA_HOLDING}", utf8_encode($unico->nombre_empresa_holding), $row);
                    $row = str_replace("{TRAMO}", $unico->tramo_sence, $row);
                    $row = str_replace("{CASO_ESPECIAL}", $unico->descripcion_caso_especial, $row);
                    //SECCION PORCENTAJES DE AVANCES
                    if ($unico->porcentaje_asistencia) {
                        if ($unico->porcentaje_asistencia >= 75) {
                            $row = str_replace("{PORCENTAJE_ASISTENCIA}", '<span class="label label-success">' . $unico->porcentaje_asistencia . '%</span>', $row);
                            $row = str_replace("{OPTIONS__POR_ASIS}", Option0a100($unico->porcentaje_asistencia), $row);
                        } else {
                            $row = str_replace("{PORCENTAJE_ASISTENCIA}", '<span class="label label-danger">' . $unico->porcentaje_asistencia . '%</span>', $row);
                            $row = str_replace("{OPTIONS__POR_ASIS}", Option0a100($unico->porcentaje_asistencia), $row);
                        }
                    } else {
                        $row = str_replace("{PORCENTAJE_ASISTENCIA}", '', $row);
                        $row = str_replace("{OPTIONS__POR_ASIS}", Option0a100(""), $row);
                    }
                    $row = str_replace("{IDINSCRIPCIONRUT}", $id_inscripcion . $unico->rut_sin_dv, $row);
                    $row = str_replace("{CASO_ESPECIAL}", utf8_encode($unico->descripcion_caso_especial), $row);
                    $row = str_replace("{OPTIONS_CASOS_ESPECIALES}", OptionsGenericoNombreDadoValores("tbl_inscripcion_excepciones", $unico->caso_especial, "descripcion", "id"), $row);
                    $dato_Caso_especial = CasosEspecialesPorId($unico->caso_especial);
                    $row = str_replace("{VALOR_OPTIONS_CASOS_ESPECIALES}", utf8_encode($dato_Caso_especial[0]->descripcion), $row);
                    //Veo si esta o no finalizada la encuesta
                    $encuesta_finalizada = EncuestasSatisFinalizadasPorInscripcionEncuestaRut($id_inscripcion, $id_encuesta, $unico->rut_sin_dv);
                    if ($encuesta_finalizada) {
                        $row = str_replace("{ESTADO_ENCUESTA}", '<span class="label label-success">Finalizada</span>', $row);
                        $row = str_replace("{ACCESO_ENCUESTA}", '', $row);
                    } else {
                        $row = str_replace("{ESTADO_ENCUESTA}", '<span class="label label-warning ">Pendiente</span>', $row);
                        $row = str_replace("{ACCESO_ENCUESTA}", '<a target="_blank" href="../front/index.php?sw=iexAd&r=' . Encodear3($unico->rut_sin_dv) . '&ii=' . Encodear3($id_inscripcion) . '">Realizar Encuesta</a>', $row);
                    }
                    if ($unico->nota) {
                        $row = str_replace("{NOTA}", $unico->nota, $row);
                    } else {
                        $row = str_replace("{NOTA}", "", $row);
                    }
                    if ($unico->estado == "1") {
                        $row = str_replace("{ESTADO}", '<span class="label label-success">Aprobado</span>', $row);
                        $total_usuarios_aprobados++;
                        //en la siguiente linea, multiplico la cantidad de participantes por las horas del curso
                        $acumulador_horas_capacitadas = $acumulador_horas_capacitadas + $unico->numero_horas;
                        $row = str_replace("{OKAPROBADO}", 'selected', $row);
                        $row = str_replace("{OKREPROPROBADO}", '', $row);
                    } else if ($unico->estado == "0") {
                        $row = str_replace("{ESTADO}", '<span class="label label-danger">Reprobado</span>', $row);
                        $row = str_replace("{OKAPROBADO}", '', $row);
                        $row = str_replace("{OKREPROPROBADO}", 'selected', $row);
                    } else {
                        $row = str_replace("{OKAPROBADO}", '', $row);
                        $row = str_replace("{OKREPROPROBADO}", '', $row);
                        $row = str_replace("{ESTADO}", '', $row);
                    }
                    //$row = str_replace("{VIATICO_UTILIZADO}",colocarPesos($unico->viatico_utilizado),$row);
                    $row = str_replace("{VIATICO_UTILIZADO}", $unico->viatico_utilizado, $row);
                    //$row = str_replace("{MOVILIZCION}",colocarPesos($unico->movilizacion_utilizada),$row);
                    $row = str_replace("{MOVILIZCION}", $unico->movilizacion_utilizada, $row);
                    //por cada uno de los participantes, calculo
                    $calculos = obtenerMontos($unico->tramo_sence, $id_inscripcion);
                    $row = str_replace("{MONTO_PERSONA}", colocarPesos($calculos[0]), $row);
                    if ($unico->porcentaje_asistencia < 75) {
                        if ($unico->cobertura_sence_caso_especial == 100) {
                            //$calculos[1]=$unico->cobertura_sence_caso_especial;
                            //$calculos[2]=$calculos[0];
                        } else {
                            $calculos[1] = 0;
                            $calculos[2] = $calculos[0];
                        }
                        $row = str_replace("{MONTO_FRANQUICIA}", colocarPesos($calculos[1]), $row);
                        $row = str_replace("{MONTO_EMPRESA}", colocarPesos($calculos[2]), $row);
                    } else {
                        $row = str_replace("{MONTO_FRANQUICIA}", colocarPesos($calculos[1]), $row);
                        $row = str_replace("{MONTO_EMPRESA}", colocarPesos($calculos[2]), $row);
                    }
                    $acumulador_franquicia = $acumulador_franquicia + $calculos[1];
                    $acumulador_empresa = $acumulador_empresa + $calculos[2];
                    $acumulador_viatico = $acumulador_viatico + $unico->viatico_utilizado;
                    $acumulador_movilizacion = $acumulador_movilizacion + $unico->movilizacion_utilizada;
                }
                //Combobox para mostrar alumnos
                for ($i = 0; $i <= 100; $i++) {
                    $option_pon .= "<option value=" . $i . ">" . $i . "</option>";
                }
                $arreglo[0] = ($row);
                $arreglo[1] = $acumulador_franquicia;
                $arreglo[2] = $acumulador_empresa;
                //Total de colaboradores
                $arreglo[3] = count($listado_usuarios);
                //Total Viatico
                $arreglo[4] = $acumulador_viatico;
                //Total Movilizacion
                $arreglo[5] = $acumulador_movilizacion;
                $arreglo[6] = $options;
                $arreglo[7] = $option_pon;
                //total de usuarios aprobados
                $arreglo[8] = $total_usuarios_aprobados;
                //Acumularor de horas capacitadas
                $arreglo[9] = $acumulador_horas_capacitadas;
                return ($arreglo);
            }

            function FuncionFormularioMuestraUsuariosPorInscripcion($PRINCIPAL, $id_curso, $id_inscripcion)
            {
                //$PRINCIPAL = str_replace("{ENTORNO_DETALLE_CURSO}",file_get_contents("views/inscripcion/entorno_detalle_curso.html"),$PRINCIPAL);
                if ($id_curso) {
                    $datos_curso = DatosCurso($id_curso);
                    $PRINCIPAL = str_replace("{ID_INSCRIPCION_ENCODEADA}", Encodear3($id_inscripcion), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ID_CURSO_ENCODEADA}", Encodear3($id_curso), $PRINCIPAL);
                    //Valor Hora Curso
                    $PRINCIPAL = str_replace("{VALOR_CURSO}", $datos_curso[0]->numero_horas * $datos_curso[0]->valor_hora, $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VALOR_HORA_CURSO}", $datos_curso[0]->valor_hora, $PRINCIPAL);
                    //con el dato de inscripcion, lo paso a una funcion, para que coloque todos los datos de la inscricpcion correspondiente
                    $PRINCIPAL = ColocaDatosInscripcion($PRINCIPAL, $id_inscripcion);
                    if ($id_inscripcion) {
                        $PRINCIPAL = str_replace("{SECCION_INSCRIPCION_USUARIOS}", file_get_contents("views/inscripcion/entorno_detalle_inscripcion.html"), $PRINCIPAL);
                        //ACA VALIDO SI ESTÃ?? CERRADA LA INSCRIPCION, NO MUESTRO EL BLOQUE DE FORMULARIO DE INSCRIPCION MASIVA, SI NO ESTÃ?? FINALIZADO, LO MUESTRO
                        if ($estado_inscripcion[1] == 1) {
                            $PRINCIPAL = str_replace("{FORMuLARIO_INSCRIPCION_PARTICIPANTES_MASIVOS}", "<br>", $PRINCIPAL);
                        } else {
                            $PRINCIPAL = str_replace("{FORMuLARIO_INSCRIPCION_PARTICIPANTES_MASIVOS}", file_get_contents("views/inscripcion/formularios_inscripcion_usuarios_por_inscripcion.html"), $PRINCIPAL);
                        }
                        $PRINCIPAL = str_replace("{OPTIONS_ALUMNOS}", utf8_encode(OptionUsuariosTodos2()), $PRINCIPAL);
                        $PRINCIPAL = str_replace("{ACTION_INSC}", "?sw=editinsc", $PRINCIPAL);
                        $PRINCIPAL = str_replace("{ID_INSCRIPCION_ENCODEADO}", Encodear3($id_inscripcion), $PRINCIPAL);
                        //Aca coloca el listado de usuarios por inscripcion
                        $datos_listado_usuario_por_inscripcion = ListadoUsuariosPorInscripcion($id_inscripcion, "no", "");
                        $PRINCIPAL = str_replace("{LISTADO_INSCRITOS_POR_CAPACITACION}", $datos_listado_usuario_por_inscripcion[0], $PRINCIPAL);
                        $PRINCIPAL = str_replace("{MONTO_SENCE}", colocarPesos($datos_listado_usuario_por_inscripcion[1]), $PRINCIPAL);
                        $PRINCIPAL = str_replace("{MONOT_EMPRESA}", colocarPesos($datos_listado_usuario_por_inscripcion[2]), $PRINCIPAL);
                        $PRINCIPAL = str_replace("{MONTO_TOTAL}", colocarPesos($datos_listado_usuario_por_inscripcion[1] + $datos_listado_usuario_por_inscripcion[2]), $PRINCIPAL);
                        $PRINCIPAL = str_replace("{NUM_PARTICIPANTES}", $datos_listado_usuario_por_inscripcion[3], $PRINCIPAL);
                        $PRINCIPAL = str_replace("{MONTO_VIATICO}", colocarPesos($datos_listado_usuario_por_inscripcion[4]), $PRINCIPAL);
                        $PRINCIPAL = str_replace("{MONTO_MOVILIZACION}", colocarPesos($datos_listado_usuario_por_inscripcion[5]), $PRINCIPAL);
                        //$PRINCIPAL = str_replace("{ROW_LISTADO_INSCRIPCIONES_RESUMEN}",ListadoInscripcionesResumen($id_curso),$PRINCIPAL);
                        $PRINCIPAL = str_replace("{ID_INSCRIPCION}", $id_inscripcion, $PRINCIPAL);
                    } else {
                        $PRINCIPAL = str_replace("{SECCION_INSCRIPCION_USUARIOS}", "", $PRINCIPAL);
                        $PRINCIPAL = str_replace("{ACTION_INSC}", "?sw=instertainsc", $PRINCIPAL);
                    }
                } else {
                    $PRINCIPAL = str_replace("{ENTORNO_DETALLE_CURSO}", "", $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function ReporteDinamico($arreglo_post, $id_empresa, $tipo_reporte)
            {
                $datos_reporte = TiposReportesPorEmpresa($id_empresa, $tipo_reporte);
                //$cursos=ObtenerTodosLosCursos($arreglo_post);
                $encabezado = file_get_contents("views/reportes/dinamicos/entorno_reporte.html");
                $encabezado = str_replace("{NOMBRE_REPORTE}", $datos_reporte[0]->nombre, $encabezado);
                //traigo los datos del reporte dado el id de tipo de reporte
                //Estos campos son los que se muestran en el reporte como encabezado
                $campos_reporte = DatosTiposReportesPorEmpresa($id_empresa, $tipo_reporte);
                //estos son los campos que se muestran con sol otexto de lectura de la tabla tbl_usuario
                $campos_para_sql = DatosTiposReportesPorEmpresaParaSQL($id_empresa, $tipo_reporte);
                //Estos son los campos que se muestran solo para calculos
                $campos_calculos_cursos = DatosTiposReportesPorEmpresaParaCalculosCursos($id_empresa, $tipo_reporte);
                $i = 1;
                foreach ($campos_reporte as $unico) {
                    $linea .= file_get_contents("views/reportes/dinamicos/linea_encabezado.html");
                    $linea = str_replace("{ENCABEZADO}", $unico->nombre, $linea);
                }
                //Con este ciclo, traigo los datos de la tabla.
                foreach ($campos_para_sql as $unico_sql) {
                    $sql .= $unico_sql->campo;
                    if ($i < count($campos_para_sql)) {
                        $sql .= ", ";
                    }
                    $i++;
                }
                $datos = DatosReporteDinamico($sql, $id_empresa);
                $encabezado = str_replace("{ENCABEZADOS}", utf8_encode($linea), $encabezado);
                echo $encabezado;
                //Con ete encabezado, muestro los campos de texto
                foreach ($datos as $key => $unico) {
                    $row = file_get_contents("views/reportes/dinamicos/row_reporte.html");
                    $campos1 = "";
                    for ($j = 1; $j <= $datos_reporte[0]->cantidad_campos_texto; $j++) {
                        $campos1 .= "<td>" . $unico->{"valor" . $j} . "</td>";
                    }
                    //Ahora veo el tema de los campos que son calculo.
                    $row = str_replace("{TDS_DINAMICOS_DATA}", utf8_encode($campos1), $row);
                    echo utf8_encode($row);
                }
                echo file_get_contents("views/reportes/dinamicos/entorno_reporte_footer.html");
                $arreglo[0] = count($cursos);
                return ($arreglo);
            }

            function ListadoMundos($PRINCIPAL, $id_empresa)
            {
                $categorias = MundosPorEmpresa($id_empresa);
                if ($categorias) {
                    $i = 1;
                    foreach ($categorias as $unico) {
                        $row .= file_get_contents("views/mundos/row_listado.html");
                        $row = str_replace("{NUMERO}", $i, $row);
                        $row = str_replace("{NOMBRE}", $unico->nombre, $row);
                        $row = str_replace("{DESCRIPCION}", $unico->descripcion, $row);
                        $i++;
                    }
                    $PRINCIPAL = str_replace("{ROW_LISTADO}", utf8_encode($row), $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{ROW_LISTADO}", "<tr><td>No existen mundos asociadas a esta empresa</td></tr>", $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function ListadoComunidades($PRINCIPAL, $id_empresa)
            {
                $categorias = ComunidadesPorEmpresa($id_empresa);
                if ($categorias) {
                    $i = 1;
                    foreach ($categorias as $unico) {
                        $row .= file_get_contents("views/comunidades/row_listado.html");
                        $row = str_replace("{NUMERO}", $i, $row);
                        $row = str_replace("{NOMBRE}", $unico->nombre, $row);
                        $row = str_replace("{DESCRIPCION}", $unico->descripcion, $row);
                        $i++;
                    }
                    $PRINCIPAL = str_replace("{ROW_LISTADO}", utf8_encode($row), $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{ROW_LISTADO}", "<tr><td>No existen comunidades asociadas a esta empresa</td></tr>", $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function ListadoCategorias($PRINCIPAL, $id_empresa)
            {
                $categorias = CategoriasNoticiasPorEmpresa($id_empresa);
                if ($categorias) {
                    $i = 1;
                    foreach ($categorias as $unico) {
                        $row .= file_get_contents("views/categorias/row_listado.html");
                        $row = str_replace("{NUMERO}", $i, $row);
                        $row = str_replace("{NOMBRE_MENU}", $unico->categoria, $row);
                        $row = str_replace("{CANTIDAD_SUBMENU}", $unico->tota_sub_cart, $row);
                        $row = str_replace("{ID_MENU_ENCODEADO}", Encodear3($unico->id), $row);
                        $i++;
                    }
                    $PRINCIPAL = str_replace("{ROW_LISTADO_MENUS}", utf8_encode($row), $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{ROW_LISTADO_MENUS}", "<tr><td>No existen categorias asociadas a esta empresa</td></tr>", $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function AccionCategoria($PRINCIPAL, $id_categoria)
            {
                $datos_menu = DatosMenuN1($id_menu);
                $PRINCIPAL = str_replace("{VALUE_NOMBRE}", utf8_encode($datos_menu[0]->nombre), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_DESCRIPCION}", utf8_encode($datos_menu[0]->descripcion), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_MENU_ENCODEADO}", Encodear3($id_menu), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALOR_BOTON}", "Actualizar Datos CategorÃ­a", $PRINCIPAL);
                $PRINCIPAL = str_replace("{ACTION}", "?sw=edcat", $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function AccionSubCategoria($PRINCIPAL, $id_categoria, $id_subcategoria)
            {
                $datos_categoria = UnaCategoria($id_categoria);
                $PRINCIPAL = str_replace("{NOMBRE_CATEGORIA}", utf8_encode($datos_categoria[0]->categoria), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_NOMBRE}", utf8_encode($datos_categoria[0]->categoria), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_DESCRIPCION}", utf8_encode($datos_categoria[0]->descripcion), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_CATEGORIA_ENCODEADO}", Encodear3($datos_categoria[0]->id), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_LINK}", utf8_encode($datos_menu[0]->link), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_MENU_ENCODEADO}", Encodear3($id_menu), $PRINCIPAL);
                if ($datos_menu) {
                    $PRINCIPAL = str_replace("{VALOR_BOTON}", "Actualizar Datos Menu", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ACTION}", "?sw=edm", $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{VALOR_BOTON}", "Ingresar Menu", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ACTION}", "?sw=addm", $PRINCIPAL);
                }
                //Seccion SubCategorias
                $datos_subcategoria = DatosSubCategoria($id_subcategoria);
                $PRINCIPAL = str_replace("{VALUE_NOMBRE_SUBCATEGORIA}", utf8_encode($datos_subcategoria[0]->nombre), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_DESCRIPCION_SUBCATEGORIA}", utf8_encode($datos_subcategoria[0]->descripcion), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_SUBCATEGORIA_ENCODEADO}", Encodear3($id_subcategoria), $PRINCIPAL);
                if ($id_subcategoria) {
                    $PRINCIPAL = str_replace("{VALOR_BOTON_SUB_CATEGORIA}", "Actualizar Datos SubCategoria", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ACTION_SUBCATEGORIA}", "?sw=eddsubcate", $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{VALOR_BOTON_SUB_CATEGORIA}", "Ingresar SubCategoria", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ACTION_SUBCATEGORIA}", "?sw=addsubcate", $PRINCIPAL);
                }
                //Traigo el listado de subcategorias dada la categoria y las listo
                $subcategorias = SubcategoriasDadaCategoria($id_categoria);
                if ($subcategorias) {
                    $i = 1;
                    foreach ($subcategorias as $unico) {
                        $row_subcategorias .= file_get_contents("views/categorias/row_listado_sub_categorias.html");
                        $row_subcategorias = str_replace("{NOMBRE}", $unico->nombre, $row_subcategorias);
                        $row_subcategorias = str_replace("{ID_SUBCAT_ENCO}", Encodear3($unico->id), $row_subcategorias);
                        $row_subcategorias = str_replace("{N}", $i, $row_subcategorias);
                        $i++;
                    }
                    $PRINCIPAL = str_replace("{ROW_LISTADO_SUBCATEGORIAS}", utf8_encode($row_subcategorias), $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{ROW_LISTADO_SUBCATEGORIAS}", "<tr><td colspan='3'>No posee Sub Categorias</td></tr>", $PRINCIPAL);
                }
                $PRINCIPAL = str_replace("{ID_CATEGORIA_ENCODEADO}", Encodear3($datos_categoria[0]->id), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function AccionMenu($PRINCIPAL, $id_menu, $id_submenu)
            {
                $datos_menu = DatosMenuN1($id_menu);
                $PRINCIPAL = str_replace("{VALUE_NOMBRE}", utf8_encode($datos_menu[0]->nombre), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_LINK}", utf8_encode($datos_menu[0]->link), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_MENU_ENCODEADO}", Encodear3($id_menu), $PRINCIPAL);
                $PRINCIPAL = str_replace("{SELECT" . $datos_menu[0]->tipo_link . "}", "selected", $PRINCIPAL);
                for ($i = 1; $i <= 10; $i++) {
                    if ($i <> $datos_menu[0]->tipo_link) {
                        $PRINCIPAL = str_replace("{STYLE" . $i . "}", 'style="display:none;"', $PRINCIPAL);
                    }
                }
                if ($datos_menu[0]->tipo_link == "2") {
                    $PRINCIPAL = str_replace("{OPTIONS_TEMPLATES}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_paginas_templates", $datos_menu[0]->link, "nombre", "id", "order by id", $_SESSION["id_empresa"]), $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{OPTIONS_TEMPLATES}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_paginas_templates", "", "nombre", "id", "order by id", $_SESSION["id_empresa"]), $PRINCIPAL);
                }
                if ($datos_menu) {
                    $PRINCIPAL = str_replace("{VALOR_BOTON}", "Actualizar Datos", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ACTION}", "?sw=edm", $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{VALOR_BOTON}", "Ingresar Menu", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ACTION}", "?sw=addm", $PRINCIPAL);
                }
                //Seccion SubMenu
                if ($id_submenu) {
                    $datos_submenu = DatosSubMenuNivel2($id_submenu);
                    $PRINCIPAL = str_replace("{VALUE_NOMBRESUBMENU}", utf8_encode($datos_submenu[0]->nombre), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{SELECT" . $datos_submenu[0]->tipo_link . "SUBMENU}", "selected", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ID_SUBMENU_ENCODEADO}", Encodear3($datos_submenu[0]->id), $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{VALUE_NOMBRESUBMENU}", "", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ID_SUBMENU_ENCODEADO}", "", $PRINCIPAL);
                }
                if ($datos_submenu[0]->tipo_link == "2") {
                    $PRINCIPAL = str_replace("{OPTIONS_TEMPLATES_SUBMENU}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_paginas_templates", $datos_submenu[0]->link, "nombre", "id", "order by id", $_SESSION["id_empresa"]), $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{OPTIONS_TEMPLATES_SUBMENU}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_paginas_templates", "", "nombre", "id", "order by id", $_SESSION["id_empresa"]), $PRINCIPAL);
                }
                //$PRINCIPAL = str_replace("{OPTIONS_TEMPLATES_SUBMENU}",OptionsGenericoNombreDadoValoresPorEmpresa("tbl_paginas_templates", "",  "nombre", "id", "order by id", $_SESSION["id_empresa"]),$PRINCIPAL);
                //Listado de SubMenÃºs Por Menu Principal
                $listado_submenus = DatosMenuNivel2DadoNivel1($id_menu);
                if ($listado_submenus) {
                    $i = 1;
                    foreach ($listado_submenus as $unico) {
                        $row .= file_get_contents("views/menu_secundario/row_listado_submenu.html");
                        $row = str_replace("{NUMERO}", ($i), $row);
                        $row = str_replace("{NOMBRE_MENU}", utf8_encode($unico->nombre), $row);
                        $row = str_replace("{ID_SUBSUBMENU_ENCO}", Encodear3($unico->id), $row);
                        $i++;
                    }
                    $PRINCIPAL = str_replace("{ROW_LISTADO_SUBMENUS}", ($row), $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{ROW_LISTADO_SUBMENUS}", "<tr><td colspan='3'>No posee SubMenÃºs</td></tr>", $PRINCIPAL);
                }
                $PRINCIPAL = str_replace("{ID_MENU_ENCODEADO}", Encodear3($id_menu), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function ListadoMenus($PRINCIPAL, $id_empresa)
            {
                $menus = DatosMenuNivel1DadoEmpresa($id_empresa);
                if ($menus) {
                    $i = 1;
                    foreach ($menus as $me) {
                        $row .= file_get_contents("views/menu_secundario/row_listado.html");
                        $row = str_replace("{NUMERO}", $i, $row);
                        $row = str_replace("{NOMBRE_MENU}", $me->nombre, $row);
                        $row = str_replace("{CANTIDAD_SUBMENU}", $me->total_nivel2, $row);
                        $row = str_replace("{ID_MENU_ENCODEADO}", Encodear3($me->id), $row);
                        $i++;
                    }
                    $PRINCIPAL = str_replace("{ROW_LISTADO_MENUS}", utf8_encode($row), $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{ROW_LISTADO_MENUS}", "<tr><td>No existen menus asociados a esta empresa</td></tr>", $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function ConsolidadoTotal($id_empresa, $PRINCIPAL, $arreglo_post)
            {
                //Filtro de FECHA
                $arreglo_fechas = explode("-", $arreglo_post["daterange-btn"]);
                $fecha_inicio = trim(str_replace("/", "-", $arreglo_fechas[0]));
                $fecha_termino = trim(str_replace("/", "-", $arreglo_fechas[1]));
                $PRINCIPAL = str_replace("{OPTIONS_EMPRESA}", OptionsGenericoNombreDadoValores("tbl_empresa_holding", $_POST["filtro_empresa"], "empresa", "rut", "order by empresa"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_CENTRO_COSTO}", OptionsGenericoPorEmpresa("centro_costo", "tbl_usuario", $arreglo_post["filtro_centrocosto"], $_SESSION["id_empresa"]), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_UN}", OptionsGenericoPorEmpresa("unidad_negocio", "tbl_usuario", $arreglo_post["filtro_unidadnegocio"], $_SESSION["id_empresa"]), $PRINCIPAL);
                if ($fecha_inicio && $fecha_termino) {
                    $PRINCIPAL = str_replace("{FILTROFECHAS}", $fecha_inicio . " - " . $fecha_termino, $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{FILTROFECHAS}", "Sin Filtro", $PRINCIPAL);
                }
                //SECCION DE RESULTADOS GENERALES
                //Traigo todos los cursos dado la empresa
                $cursos = CursosPorEmpresaPAraConsolidado($id_empresa, $fecha_inicio, $fecha_termino, $arreglo_post);
                $datos_totales = ColocaListadoInscripciones("", "cerradas", $fecha_inicio, $fecha_termino, $arreglo_post);
                $PRINCIPAL = str_replace("{SUMA_CURSOS_TOTALES}", count($cursos), $PRINCIPAL);
                $PRINCIPAL = str_replace("{SUMA_PARTICIPANTES_TOTALES}", $datos_totales[1], $PRINCIPAL);
                //$PRINCIPAL = str_replace("{SUMA_INSCRIPCIONES_TOTALES}",$datos_totales[2],$PRINCIPAL);
                $PRINCIPAL = str_replace("{SUMA_INSCRIPCIONES_TOTALES}", $datos_totales[9], $PRINCIPAL);
                $PRINCIPAL = str_replace("{SUMA_TOTAL_TOTALES}", colocarPesos($datos_totales[4]), $PRINCIPAL);
                $PRINCIPAL = str_replace("{SUMA_FRANQUICIA_TOTALES}", colocarPesos($datos_totales[5]), $PRINCIPAL);
                $PRINCIPAL = str_replace("{SUMA_FRANQUICIA_TOTALES_SF}", $datos_totales[5], $PRINCIPAL);
                $PRINCIPAL = str_replace("{SUMA_COSTO_EMPRESA_TOTALES}", colocarPesos($datos_totales[6]), $PRINCIPAL);
                $PRINCIPAL = str_replace("{SUMA_COSTO_EMPRESA_TOTALES}", colocarPesos($datos_totales[6]), $PRINCIPAL);
                $PRINCIPAL = str_replace("{SUMA_VIATICOS_TOTALES}", colocarPesos($datos_totales[7]), $PRINCIPAL);
                $PRINCIPAL = str_replace("{SUMA_MOVILIZACION_TOTALES}", colocarPesos($datos_totales[8]), $PRINCIPAL);
                //$PRINCIPAL = str_replace("{HORAS_CAPACITADAS}","Total Aprobados=".$datos_totales[11]." - ".$datos_totales[12],$PRINCIPAL);
                $PRINCIPAL = str_replace("{HORAS_CAPACITADAS}", $datos_totales[12], $PRINCIPAL);
                $row_por_curso = "";
                //SECCION PARA RESULTADOS GENERALES POR CURSO
                foreach ($cursos as $uncurso) {
                    $datos_por_curso = ColocaListadoInscripciones($uncurso->id, "cerradas", $fecha_inicio, $fecha_termino, $arreglo_post);
                    if ($datos_por_curso[9] <= 0) continue;
                    $row_por_curso .= file_get_contents("views/reportes/sk_resultado_consolidados_row_curso.html");
                    $row_por_curso = str_replace("{C_NOMBRE_CURSO}", $uncurso->nombre, $row_por_curso);
                    //Total de Participantes
                    $row_por_curso = str_replace("{C_PARTICIPANTES_TOTALES}", $datos_por_curso[1], $row_por_curso);
                    //$row_por_curso = str_replace("{C_PARTICIPANTES_TOTALES}",$uncurso->total_participantes_,$row_por_curso);
                    //$row_por_curso = str_replace("{C_INSCRIPCIONES_TOTALES}",$datos_por_curso[2],$row_por_curso);
                    $row_por_curso = str_replace("{C_INSCRIPCIONES_TOTALES}", $datos_por_curso[9], $row_por_curso);
                    $row_por_curso = str_replace("{C_TOTAL_TOTALES}", colocarPesos($datos_por_curso[4]), $row_por_curso);
                    $row_por_curso = str_replace("{C_FRANQUICIA_TOTALES}", colocarPesos($datos_por_curso[5]), $row_por_curso);
                    $row_por_curso = str_replace("{C_COSTO_EMPRESA_TOTALES}", colocarPesos($datos_por_curso[6]), $row_por_curso);
                    $row_por_curso = str_replace("{C_VIATICOS_TOTALES}", colocarPesos($datos_por_curso[7]), $row_por_curso);
                    $row_por_curso = str_replace("{C_MOVILIZACION_TOTALES}", colocarPesos($datos_por_curso[8]), $row_por_curso);
                    $row_por_curso = str_replace("{C_HORAS_CAPACITADAS}", $datos_por_curso[12], $row_por_curso);
                }
                $PRINCIPAL = str_replace("{ROW_LISTADO_RESUMENES_POR_CURSO}", $row_por_curso, $PRINCIPAL);
                //SECCION PARA LISTADO POR USUARIOS
                //traigo el listado de usuarios dado el id de empresa
                $personas = DatosTablaUsuarioPorEmpresa($_SESSION["id_empresa"], $fecha_inicio, $fecha_termino, $arreglo_post);
                foreach ($personas as $unapersona) {
                    if (!$unapersona->total_inscripciones) continue;
                    if ($unapersona->total_inscripciones <= 0) continue;
                    $row_persona .= file_get_contents("views/reportes/sk_resultado_consolidados_row_persona.html");
                    $row_persona = str_replace("{RUT_PERSONA}", $unapersona->rut, $row_persona);
                    $row_persona = str_replace("{NOMBRE_PERSONA}", $unapersona->rut . " - " . $unapersona->nombre . " " . $unapersona->apaterno . " " . $unapersona->amaterno, $row_persona);
                    $row_persona = str_replace("{CARGO}", $unapersona->cargo, $row_persona);
                    $row_persona = str_replace("{CENTRO_COSTO}", $unapersona->centro_costo, $row_persona);
                    $row_persona = str_replace("{EMPRESA}", $unapersona->nombre_empresa, $row_persona);
                    $row_persona = str_replace("{P_INSCRIPCIONES}", $unapersona->total_inscripciones, $row_persona);
                    $total_total_inscripciones = $total_total_inscripciones + $unapersona->total_inscripciones;
                    $datos_por_colaborador = TotalUsuariosPorInscripcionCerrados2("", "", $unapersona->rut, $fecha_inicio, $fecha_termino, "");
                    $acumulador_viatico_por_persona = 0;
                    $acumulador_movilizacion_por_persona = 0;
                    $acumulador_franquicia_por_persona = 0;
                    $acumulador_empresa_por_persona = 0;
                    $acumulador_monto_total_por_persona = 0;
                    $acumulador_horas_capacitadas = 0;
                    foreach ($datos_por_colaborador as $dat_col_unico) {
                        $acumulador_viatico_por_persona = $acumulador_viatico_por_persona + $dat_col_unico->viatico_utilizado;
                        $acumulador_movilizacion_por_persona = $acumulador_movilizacion_por_persona + $dat_col_unico->movilizacion_utilizada;
                        $calculos_por_persona = obtenerMontos($unapersona->tramo_sence, $dat_col_unico->id_inscripcion);
                        if ($dat_col_unico->porcentaje_asistencia < 75) {
                            if ($dat_col_unico->cobertura_sence_caso_especial == 100) {
                                //$calculos[1]=$unico->cobertura_sence_caso_especial;
                                //$calculos[2]=$calculos[0];
                            } else {
                                $calculos_por_persona[1] = 0;
                                $calculos_por_persona[2] = $calculos_por_persona[0];
                            }
                        }
                        $acumulador_franquicia_por_persona = $acumulador_franquicia_por_persona + $calculos_por_persona[1];
                        $acumulador_empresa_por_persona = $acumulador_empresa_por_persona + $calculos_por_persona[2];
                        $acumulador_monto_total_por_persona = $acumulador_monto_total_por_persona + ($calculos_por_persona[1] + $calculos_por_persona[2]);
                        if ($dat_col_unico->estado == "1") {
                            $row = str_replace("{ESTADO}", '<span class="label label-success">Aprobado</span>', $row);
                            //$total_usuarios_aprobados++;
                            //en la siguiente linea, multiplico la cantidad de participantes por las horas del curso
                            $acumulador_horas_capacitadas = $acumulador_horas_capacitadas + $dat_col_unico->numero_horas;
                        }
                    }
                    //VALOR TOTAL
                    $row_persona = str_replace("{P_VALOR_TOTAL}", colocarPesos($acumulador_monto_total_por_persona), $row_persona);
                    $total_total = $total_total + $acumulador_monto_total_por_persona;
                    //FRANQUCIA
                    $row_persona = str_replace("{P_VALOR_FRANQUICIA}", colocarPesos($acumulador_franquicia_por_persona), $row_persona);
                    $total_franquicia = $total_franquicia + $acumulador_franquicia_por_persona;
                    $row_persona = str_replace("{P_VALOR_VIATICO}", colocarPesos($acumulador_viatico_por_persona), $row_persona);
                    $total_total_viatico = $total_total_viatico + $acumulador_viatico_por_persona;
                    $row_persona = str_replace("{P_VALOR_MOVILIZACION}", colocarPesos($acumulador_movilizacion_por_persona), $row_persona);
                    $total_total_movilizacion = $total_total_movilizacion + $acumulador_movilizacion_por_persona;
                    $row_persona = str_replace("{P_VALOR_COSTO_EMPRESA}", $acumulador_empresa_por_persona, $row_persona);
                    $total_total_costo_empresa = $total_total_costo_empresa + $acumulador_empresa_por_persona;
                    $row_persona = str_replace("{P_HORAS_CAPACITADAS}", $acumulador_horas_capacitadas, $row_persona);
                    $total_horas_capacitadas = $total_horas_capacitadas + $acumulador_horas_capacitadas;
                }
                $PRINCIPAL = str_replace("{ROW_LISTADO_RESUMENES_POR_PERSONA}", utf8_encode($row_persona), $PRINCIPAL);
                $PRINCIPAL = str_replace("{P_TOTAL_TOTAL}", colocarPesos($total_total), $PRINCIPAL);
                $PRINCIPAL = str_replace("{P_TOTAL_TOTAL_FRANQUICIA}", colocarPesos($total_franquicia), $PRINCIPAL);
                $PRINCIPAL = str_replace("{P_TOTAL_HORASCAPACITADAS}", colocarPesos($total_horas_capacitadas), $PRINCIPAL);
                $PRINCIPAL = str_replace("{P_TOTAL_INSCRIPCIONES}", $total_total_inscripciones, $PRINCIPAL);
                $PRINCIPAL = str_replace("{P_TOTAL_COSTO_EMPRESA}", colocarPesos($total_total_costo_empresa), $PRINCIPAL);
                $PRINCIPAL = str_replace("{P_TOTAL_VIATICO}", colocarPesos($total_total_viatico), $PRINCIPAL);
                $PRINCIPAL = str_replace("{P_TOTAL_MOVILIZACION}", colocarPesos($total_total_movilizacion), $PRINCIPAL);
                if ($arreglo_post["filtro_empresa"]) {
                    $datos_empresa_holding = DatosEmpresaHolding($arreglo_post["filtro_empresa"]);
                    $filtro_organizacional = $datos_empresa_holding[0]->empresa;
                    if ($arreglo_post["filtro_centrocosto"]) {
                        $filtro_organizacional .= " - " . $arreglo_post["filtro_centrocosto"];
                    }
                    $PRINCIPAL = str_replace("{FILTROORGANIZACIONAL}", $filtro_organizacional, $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{FILTROORGANIZACIONAL}", "Sin Filtro", $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function ConsolidadoTotalBK($id_empresa, $PRINCIPAL)
            {
                $html = file_get_contents("views/reportes/resumen/entorno.html");
                $PRINCIPAL = str_replace("{BLOQUE_RESUMEN}", $html, $PRINCIPAL);
                echo $PRINCIPAL;
            }

            function ReplaceDatosDeCorreo($rut, $id_template_correo)
            {
                $detalle_correo = DatosDeCorreoDadoId($id_template_correo);
                $TEMPLATE = file_get_contents("../front/views/correos/" . $detalle_correo[0]->template . "");
                $datos_usuario = UsuarioEnBasePersonas($rut);
                $TEMPLATE = str_replace("{IMAGEBACKURL}", "http://www.plataformagop.ngd.cl/front/views/correos/img/" . $detalle_correo[0]->imageback, $TEMPLATE);
                $TEMPLATE = str_replace("{IMAGEBACK}", "../front/views/correos/img/" . $detalle_correo[0]->imageback, $TEMPLATE);
                $TEMPLATE = str_replace("{TITULO1}", htmlentities($detalle_correo[0]->titulo1), $TEMPLATE);
                $TEMPLATE = str_replace("{TITULO2}", htmlentities($detalle_correo[0]->titulo2), $TEMPLATE);
                $TEMPLATE = str_replace("{TEXTO1}", htmlentities($detalle_correo[0]->texto1), $TEMPLATE);
                $TEMPLATE = str_replace("{NOMBRE}", htmlentities($datos_usuario[0]->nombre) . " " . htmlentities($datos_usuario[0]->apaterno), $TEMPLATE);
                $TEMPLATE = str_replace("{TEXTO2}", htmlentities($detalle_correo[0]->texto2), $TEMPLATE);
                $TEMPLATE = str_replace("{TEXTOLINK}", htmlentities($detalle_correo[0]->textolink), $TEMPLATE);
                $TEMPLATE = str_replace("{TEXTO3}", htmlentities($detalle_correo[0]->texto3), $TEMPLATE);
                $TEMPLATE = str_replace("{TEXTO4}", htmlentities($detalle_correo[0]->texto4), $TEMPLATE);
                $TEMPLATE = str_replace("{TEXTOFOOTER1}", htmlentities($detalle_correo[0]->textofooter1), $TEMPLATE);
                $TEMPLATE = str_replace("{TEXTOFOOTER2}", htmlentities($detalle_correo[0]->textofooter2), $TEMPLATE);
                $TEMPLATE = str_replace("{IMAGE1}", "../front/views/correos/img/" . $detalle_correo[0]->image1, $TEMPLATE);
                $TEMPLATE = str_replace("{IMAGE1URL}", "http://www.plataformagop.ngd.cl/front/views/correos/img/" . $detalle_correo[0]->image1, $TEMPLATE);
                $TEMPLATE = str_replace("{LINK}", htmlentities($detalle_correo[0]->link), $TEMPLATE);
                return (utf8_encode($TEMPLATE));
            }

            function ReplaceDatosDeCorreoProcesoMAsivo($rut, $id_template_correo, $id_proceso)
            {
                $detalle_correo = DatosDeCorreoDadoId($id_template_correo);
                $TEMPLATE = file_get_contents("../front/views/correos/" . $detalle_correo[0]->template . "");
                $datos_usuario = DatosEnvioCorreoPorProceso($rut, $id_proceso);
                $TEMPLATE = str_replace("{IMAGEBACKURL}", "http://www.plataformagop.ngd.cl/front/views/correos/img/" . $detalle_correo[0]->imageback, $TEMPLATE);
                $TEMPLATE = str_replace("{IMAGEBACK}", "../front/views/correos/img/" . $detalle_correo[0]->imageback, $TEMPLATE);
                $TEMPLATE = str_replace("{TITULO1}", htmlentities($detalle_correo[0]->titulo1), $TEMPLATE);
                $TEMPLATE = str_replace("{TITULO2}", htmlentities($detalle_correo[0]->titulo2), $TEMPLATE);
                $TEMPLATE = str_replace("{TEXTO1}", htmlentities($detalle_correo[0]->texto1), $TEMPLATE);
                $TEMPLATE = str_replace("{NOMBRE}", htmlentities($datos_usuario[0]->nombre) . " " . htmlentities($datos_usuario[0]->apaterno), $TEMPLATE);
                $TEMPLATE = str_replace("{TEXTO2}", htmlentities($detalle_correo[0]->texto2), $TEMPLATE);
                $TEMPLATE = str_replace("{TEXTOLINK}", htmlentities($detalle_correo[0]->textolink), $TEMPLATE);
                $TEMPLATE = str_replace("{TEXTO3}", htmlentities($detalle_correo[0]->texto3), $TEMPLATE);
                $TEMPLATE = str_replace("{TEXTO4}", htmlentities($detalle_correo[0]->texto4), $TEMPLATE);
                $TEMPLATE = str_replace("{TEXTOFOOTER1}", htmlentities($detalle_correo[0]->textofooter1), $TEMPLATE);
                $TEMPLATE = str_replace("{TEXTOFOOTER2}", htmlentities($detalle_correo[0]->textofooter2), $TEMPLATE);
                $TEMPLATE = str_replace("{IMAGE1}", "../front/views/correos/img/" . $detalle_correo[0]->image1, $TEMPLATE);
                $TEMPLATE = str_replace("{IMAGE1URL}", "http://www.plataformagop.ngd.cl/front/views/correos/img/" . $detalle_correo[0]->image1, $TEMPLATE);
                $TEMPLATE = str_replace("{LINK}", htmlentities($detalle_correo[0]->link), $TEMPLATE);
                return (utf8_encode($TEMPLATE));
            }

            function ColcaFiltrosDinamicosSegunTablaUuarios($html, $arreglo_post, $id_empresa)
            {
                $acumulador_de_filtros = "";
                //Veo si la empresa, tiene gerencias, para eso aplico el distinct
                //Veo si tiene Area
                $valor_area = SelectDistValorPorEmpresa("area", "tbl_usuario", $id_empresa);
                if ($valor_area) {
                    $template_filtro = file_get_contents("views/reportes_obj/template_select.html");
                    $template_filtro = str_replace("{OPTIONS}", OptionsGenericoPorEmpresa("area", "tbl_usuario", $arreglo_post["area"], $id_empresa), $template_filtro);
                    $template_filtro = str_replace("{NOMBRE}", "area", $template_filtro);
                    $template_filtro = str_replace("{NOMBRE_ENCABEZADO}", "Filtro Area", $template_filtro);
                    $acumulador_de_filtros .= $template_filtro;
                }
                if ($acumulador_de_filtros) {
                    $html = str_replace("{SECCION_FILTROS}", file_get_contents("views/reportes_obj/encabezado_filtros_dinamicos.html"), $html);
                    $html = str_replace("{LISTADO_FILTROS}", $acumulador_de_filtros, $html);
                } else {
                    $html = str_replace("{SECCION_FILTROS}", "", $html);
                }
                return ($html);
            }

            function ColocaEtiquetaReportesObjetivos($valor1, $valor2)
            {
                if ($valor1 == $valor2) {
                    $valor = '<div class="etiqueta  label-success">' . FormatearPorcentajes(($valor1 * 100) / $valor2) . '%</div>';
                } else if ($valor1 == 0) {
                    $valor = '<div class="etiqueta  label-danger">' . FormatearPorcentajes(($valor1 * 100) / $valor2) . '%</div>';
                } else {
                    $valor = '<div class="etiqueta  label-proceso">' . FormatearPorcentajes(($valor1 * 100) / $valor2) . '%</div>';
                }
                return ($valor);
            }

            function ColocaEtiquetaReportesSGD($valor1, $valor2)
            {
                if ($valor1 == $valor2) {
                    $valor = '<div class="etiqueta  label-success">' . FormatearPorcentajes(($valor1 * 100) / $valor2) . '%</div>';
                } else if ($valor1 == 0) {
                    $valor = '<div class="etiqueta  label-danger">' . FormatearPorcentajes(($valor1 * 100) / $valor2) . '%</div>';
                } else {
                    $valor = '<div class="etiqueta  label-proceso">' . FormatearPorcentajes(($valor1 * 100) / $valor2) . '%</div>';
                }
                return ($valor);
            }

            function DevuelveCadenaHorario($id_inscripcion)
            {
                //$datos_inscripcion=DatosInscripcion($id_inscripcion);
                $datos_inscripcion = DatosInscripcionConCodigo($id_inscripcion);
                $cadena = "";
                if ($datos_inscripcion[0]->lunes_d_am or $datos_inscripcion[0]->lunes_h_am or $datos_inscripcion[0]->lunes_d_pm or $datos_inscripcion[0]->lunes_h_pm) {
                    $cadenaLu = "LU";
                    $anterior = "no";
                    $contl = 0;
                    if ($datos_inscripcion[0]->lunes_d_am && $datos_inscripcion[0]->lunes_h_am) {
                        $lunes_am_d = str_replace(":", "", $datos_inscripcion[0]->lunes_d_am);
                        $lunes_am_h = str_replace(":", "", $datos_inscripcion[0]->lunes_h_am);
                        $cadenaLu .= $lunes_am_d . ":" . $lunes_am_h;
                        $anterior = "si";
                        $contl++;
                    }
                    if ($datos_inscripcion[0]->lunes_d_pm && $datos_inscripcion[0]->lunes_h_pm) {
                        $lunes_pm_d = str_replace(":", "", $datos_inscripcion[0]->lunes_d_pm);
                        $lunes_pm_h = str_replace(":", "", $datos_inscripcion[0]->lunes_h_pm);
                        if ($anterior == "si") {
                            $cadenaLu .= "," . $lunes_pm_d . ":" . $lunes_pm_h;
                            $anterior = "no";
                        } else {
                            $cadenaLu .= $lunes_pm_d . ":" . $lunes_pm_h;
                            $anterior = "no";
                        }
                        $contl++;
                    }
                }
                if ($datos_inscripcion[0]->martes_d_am or $datos_inscripcion[0]->martes_h_am or $datos_inscripcion[0]->martes_d_pm or $datos_inscripcion[0]->martes_h_pm) {
                    $cadenaMa = "MA";
                    $anterior = "no";
                    $contma = 0;
                    if ($datos_inscripcion[0]->martes_d_am && $datos_inscripcion[0]->martes_h_am) {
                        $martes_d_am = str_replace(":", "", $datos_inscripcion[0]->martes_d_am);
                        $martes_h_am = str_replace(":", "", $datos_inscripcion[0]->martes_h_am);
                        $cadenaMa .= $martes_d_am . ":" . $martes_h_am;
                        $anterior = "si";
                        $contma++;
                    }
                    if ($datos_inscripcion[0]->martes_d_pm && $datos_inscripcion[0]->martes_h_pm) {
                        $martes_d_pm = str_replace(":", "", $datos_inscripcion[0]->martes_d_pm);
                        $martes_h_pm = str_replace(":", "", $datos_inscripcion[0]->martes_h_pm);
                        if ($anterior == "si") {
                            $cadenaMa .= "," . $martes_d_pm . ":" . $martes_h_pm;
                            $anterior = "no";
                        } else {
                            $cadenaMa .= $martes_d_pm . ":" . $martes_h_pm;
                            $anterior = "no";
                        }
                        $contma++;
                    }
                }
                if ($datos_inscripcion[0]->miercoles_d_am or $datos_inscripcion[0]->miercoles_h_am or $datos_inscripcion[0]->miercoles_d_pm or $datos_inscripcion[0]->miercoles_h_pm) {
                    $cadenaMi .= "MI";
                    $anterior = "no";
                    $contmi = 0;
                    if ($datos_inscripcion[0]->miercoles_d_am && $datos_inscripcion[0]->miercoles_h_am) {
                        $miercoles_d_am = str_replace(":", "", $datos_inscripcion[0]->miercoles_d_am);
                        $miercoles_h_am = str_replace(":", "", $datos_inscripcion[0]->miercoles_h_am);
                        $cadenaMi .= $miercoles_d_am . ":" . $miercoles_h_am;
                        $anterior = "si";
                        $contmi++;
                    }
                    if ($datos_inscripcion[0]->miercoles_d_pm && $datos_inscripcion[0]->miercoles_h_pm) {
                        $miercoles_d_pm = str_replace(":", "", $datos_inscripcion[0]->miercoles_d_pm);
                        $miercoles_h_pm = str_replace(":", "", $datos_inscripcion[0]->miercoles_h_pm);
                        if ($anterior == "si") {
                            $cadenaMi .= "," . $miercoles_d_pm . ":" . $miercoles_h_pm;
                            $anterior = "no";
                        } else {
                            $cadenaMi .= $miercoles_d_pm . ":" . $miercoles_h_pm;
                            $anterior = "no";
                        }
                        $contmi++;
                    }
                }
                if ($datos_inscripcion[0]->jueves_d_am or $datos_inscripcion[0]->jueves_h_am or $datos_inscripcion[0]->jueves_d_pm or $datos_inscripcion[0]->jueves_h_pm) {
                    $cadenaJe .= "JU";
                    $anterior = "no";
                    $contju = 0;
                    if ($datos_inscripcion[0]->jueves_d_am && $datos_inscripcion[0]->jueves_h_am) {
                        $jueves_d_am = str_replace(":", "", $datos_inscripcion[0]->jueves_d_am);
                        $jueves_h_am = str_replace(":", "", $datos_inscripcion[0]->jueves_h_am);
                        $cadenaJe .= $jueves_d_am . ":" . $jueves_h_am;
                        $anterior = "si";
                        $contju++;
                    }
                    if ($datos_inscripcion[0]->jueves_d_pm && $datos_inscripcion[0]->jueves_h_pm) {
                        $jueves_d_pm = str_replace(":", "", $datos_inscripcion[0]->jueves_d_pm);
                        $jueves_h_pm = str_replace(":", "", $datos_inscripcion[0]->jueves_h_pm);
                        if ($anterior == "si") {
                            $cadenaJe .= "," . $jueves_d_pm . ":" . $jueves_h_pm;
                            $anterior = "no";
                        } else {
                            $cadenaJe .= $jueves_d_pm . ":" . $jueves_h_pm;
                            $anterior = "no";
                        }
                        $contju++;
                    }
                }
                if ($datos_inscripcion[0]->viernes_d_am or $datos_inscripcion[0]->viernes_h_am or $datos_inscripcion[0]->viernes_d_pm or $datos_inscripcion[0]->viernes_h_pm) {
                    $cadenaVi .= "VI";
                    $anterior = "no";
                    $contvi = 0;
                    if ($datos_inscripcion[0]->viernes_d_am && $datos_inscripcion[0]->viernes_h_am) {
                        $viernes_d_am = str_replace(":", "", $datos_inscripcion[0]->viernes_d_am);
                        $viernes_h_am = str_replace(":", "", $datos_inscripcion[0]->viernes_h_am);
                        $cadenaVi .= $viernes_d_am . ":" . $viernes_h_am;
                        $anterior = "si";
                        $contvi++;
                    }
                    if ($datos_inscripcion[0]->viernes_d_pm && $datos_inscripcion[0]->viernes_h_pm) {
                        $viernes_d_pm = str_replace(":", "", $datos_inscripcion[0]->viernes_d_pm);
                        $viernes_h_pm = str_replace(":", "", $datos_inscripcion[0]->viernes_h_pm);
                        if ($anterior == "si") {
                            $cadenaVi .= "," . $viernes_d_pm . ":" . $viernes_h_pm;
                            $anterior = "no";
                        } else {
                            $cadenaVi .= $viernes_d_pm . ":" . $viernes_h_pm;
                            $anterior = "no";
                        }
                        $contvi++;
                    }
                }
                if ($contl > 0) $cadenaLu .= ",";
                if ($contma > 0) $cadenaMa .= ",";
                if ($contmi > 0) $cadenaMi .= ",";
                if ($contju > 0) $cadenaJe .= ",";
                if ($contvi > 0) $cadenaVi .= ",";
                $cadena = $cadenaLu . $cadenaMa . $cadenaMi . $cadenaJe . $cadenaVi;
                if ($cadena[strlen($cadena) - 1] == ",") {
                    $cadena[strlen($cadena) - 1] = "";
                }
                return ($cadena);
            }

            function OptionTiempo($selecciondo, $tipo)
            {
                $horarios = ObtenerHorarios($tipo);
                $options = "<option value=''>-Sel-</optionn>";
                foreach ($horarios as $unico) {
                    if ($selecciondo == $unico->tiempo) {
                        $options .= "<option selected value=" . $unico->tiempo . ">" . $unico->tiempo . "</option>";
                    } else {
                        $options .= "<option value=" . $unico->tiempo . ">" . $unico->tiempo . "</option>";
                    }
                }
                return ($options);
            }

            function OptionUsuariosTodos2()
            {
                $usuarios = DatosTablaUsuarioTodosSK();
                $option = "<option value=''>-Sel-</option>";
                foreach ($usuarios as $unico) {
                    $option .= "<option value=" . $unico->rut . ">" . $unico->apaterno . " " . $unico->amaterno . ", " . $unico->nombre . "</option>";
                }
                return ($option);
            }

            function OptionUsuariosDatosRelevantes($id_inscripcion, $seleccionado)
            {
                $listado_usuarios = TotalUsuariosPorInscripcionCerrados($id_inscripcion);
                foreach ($listado_usuarios as $listado_usuarios) {
                    if ($seleccionado == $listado_usuarios->rut) {
                        $option .= '<option selected value=' . $listado_usuarios->rut . '>' . $listado_usuarios->nombre . ' ' . $listado_usuarios->apaterno . ' ' . $listado_usuarios->amaterno . '</option>';
                    } else {
                        $option .= '<option  value=' . $listado_usuarios->rut . '>' . $listado_usuarios->nombre . ' ' . $listado_usuarios->apaterno . ' ' . $listado_usuarios->amaterno . '</option>';
                    }
                }
                return (($option));
            }

            function Option0a100($seleccionado)
            {
                if (!$seleccionado) {
                    $seleccionado = 100;
                }
                for ($i = 100; $i >= 0; $i--) {
                    if ($seleccionado == $i) {
                        $option .= "<option selected value=" . $i . ">" . $i . "%</option>";
                    } else {
                        $option .= "<option value=" . $i . ">" . $i . "%</option>";
                    }
                }
                return ($option);
            }

            function Option1a100($seleccionado)
            {
                for ($i = 1; $i <= 100; $i++) {
                    if ($seleccionado == $i) {
                        $option .= "<option selected value=" . $i . ">" . $i . "</option>";
                    } else {
                        $option .= "<option value=" . $i . ">" . $i . "</option>";
                    }
                }
                return ($option);
            }

            function ListadoUsuariosCerradosPorInscripcion($id_inscripcion, $tipo_reporte, $id_empresa_holding, $arreglo_post)
            {
                //$listado_usuarios=TotalUsuariosPorInscripcionCerrados($id_inscripcion);
                if ($tipo_reporte == "casos_especiales") {
                    $listado_usuarios = TotalUsuariosPorInscripcionCerrados2SoloCasosEspeciales($id_inscripcion, "");
                } else {
                    $listado_usuarios = TotalUsuariosPorInscripcionCerrados2($id_inscripcion, $id_empresa_holding, "", "", "", $arreglo_post);
                }
                $row = "";
                $options = "";
                //total de usuarios aprobados
                $total_usuarios_aprobados = 0;
                foreach ($listado_usuarios as $unico) {
                    $options .= "<option value=" . $unico->rut . ">" . $unico->nombre_completo . "</option>";
                    if ($tipo_reporte == "pdf") {
                        $row .= file_get_contents("views/inscripcion/row_usuarios_por_inscripcion_reporte_pdf.html");
                    } else if ($tipo_reporte == "casos_especiales") {
                        $row .= file_get_contents("views/reporte/row_inasistencias_caso_especial.html");
                    } else {
                        $row .= file_get_contents("views/inscripcion/row_usuarios_por_inscripcion_cerrado.html");
                    }
                    //$row = str_replace("{RUT}",$unico->rut_completo,$row);
                    $row = str_replace("{RUT}", $unico->rut_sin_dv, $row);
                    $row = str_replace("{NOMBRE_USUARIO}", $unico->nombre . " " . $unico->apaterno . " " . $unico->amaterno, $row);
                    $row = str_replace("{NOMBRE_USUARIO_CASOS_ESPECIALES}", $unico->nombre . " " . $unico->apaterno . " " . $unico->amaterno, $row);
                    $row = str_replace("{CARGO}", $unico->cargo, $row);
                    $row = str_replace("{GERENCIA}", $unico->gerencia, $row);
                    $row = str_replace("{EMAIL}", $unico->email, $row);
                    $row = str_replace("{EMPRESA_HOLDING}", utf8_encode($unico->nombre_empresa_holding), $row);
                    $row = str_replace("{TRAMO}", $unico->tramo_sence, $row);
                    $row = str_replace("{CASO_ESPECIAL}", $unico->descripcion_caso_especial, $row);
                    //SECCION PORCENTAJES DE AVANCES
                    if ($unico->porcentaje_asistencia) {
                        if ($unico->porcentaje_asistencia >= 75) {
                            $row = str_replace("{PORCENTAJE_ASISTENCIA}", '<span class="label label-success">' . $unico->porcentaje_asistencia . '%</span>', $row);
                            $row = str_replace("{OPTIONS__POR_ASIS}", Option0a100($unico->porcentaje_asistencia), $row);
                        } else {
                            $row = str_replace("{PORCENTAJE_ASISTENCIA}", '<span class="label label-danger">' . $unico->porcentaje_asistencia . '%</span>', $row);
                            $row = str_replace("{OPTIONS__POR_ASIS}", Option0a100($unico->porcentaje_asistencia), $row);
                        }
                    } else {
                        $row = str_replace("{PORCENTAJE_ASISTENCIA}", '', $row);
                        $row = str_replace("{OPTIONS__POR_ASIS}", Option0a100(""), $row);
                    }
                    $row = str_replace("{IDINSCRIPCIONRUT}", $id_inscripcion . $unico->rut_sin_dv, $row);
                    $row = str_replace("{CASO_ESPECIAL}", utf8_encode($unico->descripcion_caso_especial), $row);
                    $row = str_replace("{OPTIONS_CASOS_ESPECIALES}", OptionsGenericoNombreDadoValores("tbl_inscripcion_excepciones", $unico->caso_especial, "descripcion", "id"), $row);
                    $row = str_replace("{VALOR_OPTIONS_CASOS_ESPECIALES}", $unico->caso_especial, $row);
                    if ($unico->nota) {
                        $row = str_replace("{NOTA}", $unico->nota, $row);
                    } else {
                        $row = str_replace("{NOTA}", "", $row);
                    }
                    if ($unico->estado == "1") {
                        $row = str_replace("{ESTADO}", '<span class="label label-success">Aprobado</span>', $row);
                        $total_usuarios_aprobados++;
                        //en la siguiente linea, multiplico la cantidad de participantes por las horas del curso
                        $acumulador_horas_capacitadas = $acumulador_horas_capacitadas + $unico->numero_horas;
                        $row = str_replace("{OKAPROBADO}", 'selected', $row);
                        $row = str_replace("{OKREPROPROBADO}", '', $row);
                    } else if ($unico->estado == "0") {
                        $row = str_replace("{ESTADO}", '<span class="label label-danger">Reprobado</span>', $row);
                        $row = str_replace("{OKAPROBADO}", '', $row);
                        $row = str_replace("{OKREPROPROBADO}", 'selected', $row);
                    } else {
                        $row = str_replace("{OKAPROBADO}", '', $row);
                        $row = str_replace("{OKREPROPROBADO}", '', $row);
                        $row = str_replace("{ESTADO}", '', $row);
                    }
                    //$row = str_replace("{VIATICO_UTILIZADO}",colocarPesos($unico->viatico_utilizado),$row);
                    $row = str_replace("{VIATICO_UTILIZADO}", $unico->viatico_utilizado, $row);
                    //$row = str_replace("{MOVILIZCION}",colocarPesos($unico->movilizacion_utilizada),$row);
                    $row = str_replace("{MOVILIZCION}", $unico->movilizacion_utilizada, $row);
                    //por cada uno de los participantes, calculo
                    $calculos = obtenerMontos($unico->tramo_sence, $id_inscripcion);
                    $row = str_replace("{MONTO_PERSONA}", colocarPesos($calculos[0]), $row);
                    if ($unico->porcentaje_asistencia < 75) {
                        if ($unico->cobertura_sence_caso_especial == 100) {
                            //$calculos[1]=$unico->cobertura_sence_caso_especial;
                            //$calculos[2]=$calculos[0];
                        } else {
                            $calculos[1] = 0;
                            $calculos[2] = $calculos[0];
                        }
                        $row = str_replace("{MONTO_FRANQUICIA}", colocarPesos($calculos[1]), $row);
                        $row = str_replace("{MONTO_EMPRESA}", colocarPesos($calculos[2]), $row);
                    } else {
                        $row = str_replace("{MONTO_FRANQUICIA}", colocarPesos($calculos[1]), $row);
                        $row = str_replace("{MONTO_EMPRESA}", colocarPesos($calculos[2]), $row);
                    }
                    $acumulador_franquicia = $acumulador_franquicia + $calculos[1];
                    $acumulador_empresa = $acumulador_empresa + $calculos[2];
                    $acumulador_viatico = $acumulador_viatico + $unico->viatico_utilizado;
                    $acumulador_movilizacion = $acumulador_movilizacion + $unico->movilizacion_utilizada;
                }
                //Combobox para mostrar alumnos
                for ($i = 0; $i <= 100; $i++) {
                    $option_pon .= "<option value=" . $i . ">" . $i . "</option>";
                }
                $arreglo[0] = ($row);
                $arreglo[1] = $acumulador_franquicia;
                $arreglo[2] = $acumulador_empresa;
                //Total de colaboradores
                $arreglo[3] = count($listado_usuarios);
                //Total Viatico
                $arreglo[4] = $acumulador_viatico;
                //Total Movilizacion
                $arreglo[5] = $acumulador_movilizacion;
                $arreglo[6] = $options;
                $arreglo[7] = $option_pon;
                //total de usuarios aprobados
                $arreglo[8] = $total_usuarios_aprobados;
                //Acumularor de horas capacitadas
                $arreglo[9] = $acumulador_horas_capacitadas;
                return ($arreglo);
            }

            function EstadoInscriocionCurso($id_inscripcion)
            {
                $datos_empresa = DatosEmpresa($_SESSION["id_empresa"]);
                $color_cerrado = $datos_empresa[0]->color_aprobado;
                $color_finalizado = $datos_empresa[0]->color_reprobado;
                $color_noiniciado = $datos_empresa[0]->color_pendiente;
                $color_enproceso = $datos_empresa[0]->color_proceso;
                $datos_inscripcion = DatosInscripcion2($id_inscripcion);
                $fecha_actual = date("Y-m-d");
                $fecha_actual = strtotime($fecha_actual);
                $fecha_inicio = strtotime($datos_inscripcion[0]->fecha_inicio);
                $fecha_termino = strtotime($datos_inscripcion[0]->fecha_termino);
                if ($fecha_actual > $fecha_termino) {
                    //aca verifico si la inscripcion tiene datos en la tabla de cierre (datos reales), si es asi,
                    //el estado es Finalizado, si no tiene datos, solo se encuentra cerrado.
                    $tiene_datos_reales = VerificaEstaEnCierreSoloIdInscripcion($id_inscripcion, "");
                    if ($tiene_datos_reales) {
                        $arreglo[0] = '<span class="label label-success">Cerrado</span>';
                        $arreglo[1] = 1;
                        //Este lo ocupo para cuando hago los filtros de estado
                        $arreglo[2] = 4;
                    } else {
                        $arreglo[0] = '<span class="label label-danger">Finalizado</span>';
                        $arreglo[1] = 1;
                        $arreglo[2] = 3;
                    }
                } else if ($fecha_actual < $fecha_termino) {
                    $arreglo[0] = '<span class="label label-no-iniciado">No_Iniciado</span>';
                    $arreglo[1] = 2;
                    $arreglo[2] = 1;
                } else {
                    $arreglo[0] = '<span class="label label-warning">En_Proceso</span>';
                    $arreglo[1] = 3;
                    $arreglo[2] = 2;
                }
                return ($arreglo);
                exit;
            }

            function GeneraExcelPorInscripcion($id_inscripcion, $rut_empresa_holding)
            {
                //$datos_inscripcion=DatosInscripcion2($id_inscripcion);
                $html .= file_get_contents("views/inscripcion/encabezado_detalle_inscripcion_excel.html");
                $datos_inscripcion_curso = DatosInscripcion2($id_inscripcion);
                $total_inscripciones = TotalUsuariosPorInscripcion2($id_inscripcion, $rut_empresa_holding);
                foreach ($total_inscripciones as $unico) {
                    $row .= file_get_contents("views/inscripcion/row_detalle_inscripcion_excel.html");
                    $arreglo_rut = explode("-", $unico->rut_completo);
                    $codigo_sence = $unico->numero_identificador;
                    $codigo_sence = str_replace(".", "", $codigo_sence);
                    $codigo_sence = str_replace("-", "", $codigo_sence);
                    $codigo_sence = str_replace(" ", "", $codigo_sence);
                    $row = str_replace("{CODIGO_SENCE}", $codigo_sence, $row);
                    $row = str_replace("{RUT_SIN_DV}", $unico->rut, $row);
                    $row = str_replace("{NOMBRE_CURSO}", $unico->nombre_curso, $row);
                    //$row = str_replace("{DV}",$unico->dv,$row);
                    $row = str_replace("{DV}", $arreglo_rut[1], $row);
                    $row = str_replace("{NOMBRE}", $unico->nombre, $row);
                    $row = str_replace("{APATERNO}", $unico->apaterno, $row);
                    $row = str_replace("{AMATERNO}", $unico->amaterno, $row);
                    $arreglo_fecha_nac = explode("-", $unico->fecha_nacimiento);
                    //$row = str_replace("{FECHA_NAC}",$unico->fecha_nacimiento,$row);
                    $row = str_replace("{FECHA_NAC}", $arreglo_fecha_nac[2] . "-" . $arreglo_fecha_nac[1] . "-" . $arreglo_fecha_nac[0], $row);
                    $row = str_replace("{RUT_EMPRESA_HOLDING}", $unico->rutempresaholding, $row);
                    $row = str_replace("{NOMBRE_EMPRESA_HOLDING}", $unico->nombre_empresa_holding, $row);
                    $row = str_replace("{CODIGO_SUCURSAL_EMPRESA}", $unico->codigo_sucursal, $row);
                    $row = str_replace("{GENERO}", $unico->genero, $row);
                    $row = str_replace("{COD_ESCOLARIDAD}", $unico->codigo_escolaridad, $row);
                    $row = str_replace("{CODIGO_NIVEL}", $unico->codigo_nivel, $row);
                    $row = str_replace("{EMAIL}", $unico->email, $row);
                    $row = str_replace("{RUT_EMPRESA_HOLDING}", $unico->empresa, $row);
                    $row = str_replace("{NACIONALIDAD}", $unico->nacionalidad, $row);
                    $row = str_replace("{DIRECCION_PARTICULAR}", $unico->direccion_particular, $row);
                    $row = str_replace("{NUMERO_HH_CURSO}", $unico->numero_horas, $row);
                    $row = str_replace("{OTEC}", $unico->nombre_otec, $row);
                    $row = str_replace("{DIRECCION_OTEC}", $unico->direccion_otec, $row);
                    $row = str_replace("{VALOR_PARTICIPANTE}", $unico->numero_horas * $unico->valor_hora, $row);
                    $row = str_replace("{FONO_OTEC}", $unico->fono_otec, $row);
                    $fecha_inicio = $unico->fecha_inicio_ins;
                    $fecha_inicio = str_replace("-", "/", $fecha_inicio);
                    $row = str_replace("{FECHA_INICIO}", $fecha_inicio, $row);
                    $fecha_termino = $unico->fecha_termino_ins;
                    $fecha_termino = str_replace("-", "/", $fecha_termino);
                    $row = str_replace("{FECHA_TERMINO}", $fecha_termino, $row);
                    $row = str_replace("{HORARIOS}", DevuelveCadenaHorario($id_inscripcion), $row);
                    $row = str_replace("{CBC}", $unico->cbc, $row);
                    $row = str_replace("{LUGAR_REALIZACION}", utf8_decode($unico->direccion_inscripcion), $row);
                    $row = str_replace("{TIPO_CONTRATO}", $unico->tipo_contrato, $row);
                    $row = str_replace("{COMENTARIO}", utf8_decode($unico->comentario_inscripcion_curso), $row);
                    $row = str_replace("{COMUNA}", $unico->comuna_usuario, $row);
                    $row = str_replace("{VIATICO}", $unico->viatico, $row);
                    $row = str_replace("{MOVILIZACION}", $unico->movilizacion, $row);
                    $row = str_replace("{PORCENTAJE_FRANQUICIA}", $unico->tramo_sence, $row);
                    $row = str_replace("{REGION}", $unico->ciudad_inscripcion, $row);
                    $row = str_replace("{DNC}", "no", $row);
                    $row = str_replace("{CFT}", "", $row);
                }
                $html = str_replace("{LISTADO_USUARIOS}", ($row), $html);
                return ($html);
            }

            function OptionsGenericoNombreDadoValores2($seleccionado)
            {
                $valores = ValorSelectDinaico2Cursos();
                foreach ($valores as $val) {
                    if ($val->id == $seleccionado) {
                        $opciones .= "<option selected value='" . $val->id . "'>" . $val->nombre_clasificacion . " - " . $val->numero_identificador . " - " . $val->nombre . "</option>";
                    } else {
                        $opciones .= "<option value='" . $val->id . "'>" . $val->nombre_clasificacion . " - " . $val->numero_identificador . " - " . $val->nombre . "</option>";
                    }
                }
                return (utf8_encode($opciones));
            }

            function ListadoInscripcionesResumen($id_curso)
            {
                $datos_incripcion = DatosInscripcion2DadoIDCurso($id_curso);
                foreach ($datos_incripcion as $unico) {
                    $row .= file_get_contents("views/inscripcion/row_inscripcion_totales.html");
                    $row = str_replace("{ID_INSCRIPCION}", $unico->id, $row);
                    $row = str_replace("{NUM_PARTICIPANTES}", $unico->num_participantes, $row);
                    $row = str_replace("{MONTO_VIATICO}", $unico->suma_viatico, $row);
                    $row = str_replace("{MONTO_MOVILIZACION}", $unico->suma_movilizacion, $row);
                }
                return ($row);
            }

            function obtenerMontos($tramo, $id_inscripcion)
            {
                $datos = DatosInscripcion2($id_inscripcion);
                //Valor Persona Numero de horas curso, multiplicado por el valor hora curso
                //Valor Franquicia Numero de horas curso, multiplicado por el valor hora sence * el procentaje del tramo
                //Valor Empresa = valor persona - valor franquicia
                //Valor persona
                $arreglo[0] = $datos[0]->numero_horas * $datos[0]->valor_hora_curso;
                //Valor Franquicia
                $arreglo[1] = ($datos[0]->numero_horas * $datos[0]->valor_hora_sence) * ($tramo / 100);
                //Valor Empresa
                $arreglo[2] = $arreglo[0] - $arreglo[1];
                //Valor empresa para cuando no cubre SENCE
                $arreglo[3] = $arreglo[0];
                return ($arreglo);
            }

            function ListadoUsuariosPorInscripcion($id_inscripcion, $excel, $id_empresa_holding)
            {
                $listado_usuarios = TotalUsuariosPorInscripcion($id_inscripcion, $id_empresa_holding);
                foreach ($listado_usuarios as $unico) {
                    if ($excel == "si") {
                        $row .= file_get_contents("views/inscripcion/row_usuarios_por_inscripcion_excel_plantilla.html");
                    } else if ($excel == "no") {
                        $row .= file_get_contents("views/inscripcion/row_usuarios_por_inscripcion.html");
                    } else if ($excel == "reporte") {
                        $row .= file_get_contents("views/inscripcion/row_usuarios_por_inscripcion_reporte_pdf_inscritos.html");
                    } else {
                        $row .= file_get_contents("views/inscripcion/row_usuarios_por_inscripcion.html");
                    }
                    //$row = str_replace("{RUT}",$unico->rut_completo,$row);
                    $row = str_replace("{RUT}", $unico->rut_sin_dv, $row);
                    /*if($unico->nombre_completo){
            $row = str_replace("{NOMBRE_USUARIO}",$unico->nombre_completo,$row);
        }else{
            $row = str_replace("{NOMBRE_USUARIO}","Sin InformaciÃ³n",$row);
        }*/
                    $row = str_replace("{NOMBRE_USUARIO}", $unico->nombre . " " . $unico->apaterno . " " . $unico->amaterno, $row);
                    $row = str_replace("{CARGO}", $unico->cargo, $row);
                    $row = str_replace("{GERENCIA}", $unico->gerencia, $row);
                    $row = str_replace("{EMAIL}", $unico->email, $row);
                    $row = str_replace("{EMPRESA_HOLDING}", utf8_encode($unico->nombre_empresa_holding), $row);
                    $row = str_replace("{TRAMO}", $unico->tramo_sence . "%", $row);
                    //por cada uno de los participantes, calculo
                    $calculos = obtenerMontos($unico->tramo_sence, $id_inscripcion);
                    $row = str_replace("{MONTO_VIATICO}", colocarPesos($unico->viatico), $row);
                    $row = str_replace("{MONTO_MOVILIZACION}", colocarPesos($unico->movilizacion), $row);
                    $row = str_replace("{MONTO_PERSONA}", colocarPesos($calculos[0]), $row);
                    $row = str_replace("{MONTO_FRANQUICIA}", colocarPesos($calculos[1]), $row);
                    $row = str_replace("{MONTO_EMPRESA}", colocarPesos($calculos[2]), $row);
                    $acumulador_franquicia = $acumulador_franquicia + $calculos[1];
                    $acumulador_empresa = $acumulador_empresa + $calculos[2];
                    $acumulador_viatico = $acumulador_viatico + $unico->viatico;
                    $acumulador_movilizacion = $acumulador_movilizacion + $unico->movilizacion;
                }
                $arreglo[0] = ($row);
                $arreglo[1] = $acumulador_franquicia;
                $arreglo[2] = $acumulador_empresa;
                //Total de colaboradores
                $arreglo[3] = count($listado_usuarios);
                //Total Viatico
                $arreglo[4] = $acumulador_viatico;
                //Total Movilizacion
                $arreglo[5] = $acumulador_movilizacion;
                return ($arreglo);
            }

            function ListadoInscripciones($PRINCIPAL, $arreglo_post, $orderBy)
            {
                $row = ColocaListadoInscripciones("", "todas", "", "", $arreglo_post, $orderBy);
                $PRINCIPAL = str_replace("{ROW_LISTADO}", $row[0], $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function FormateaFecha($fecha)
            {
                $valor = date("d-m-Y", strtotime($fecha));
                return ($valor);
            }

            function ColocaListadoInscripciones($id_curso, $estado, $fecha_inicio, $fecha_termino, $arreglo_post, $orderBy)
            {
                $filtro_estado = $_POST["filtro_estado"];
                //Listado de inscripciones
                //Filtro de FECHA
                $arreglo_fechas = explode("-", $arreglo_post["daterange-btn"]);
                $fecha_inicio = trim(str_replace("/", "-", $arreglo_fechas[0]));
                $fecha_termino = trim(str_replace("/", "-", $arreglo_fechas[1]));
                if ($id_curso) {
                    $total = TotalInscripciones($id_curso, $estado, $fecha_inicio, $fecha_termino, $arreglo_post, $orderBy);
                } else {
                    $total = TotalInscripciones("", $estado, $fecha_inicio, $fecha_termino, $arreglo_post, $orderBy);
                }
                $html = "";
                //Numero_de_participantes_general
                $numero_participantes_general = 0;
                //Numero total de Inscripciones
                $numero_total_inscripciones = 0;
                //Suma general de las SUMAS TOTALES
                $sumas_totales_general = 0;
                //suma franquicia total
                $suma_total_franquicia = 0;
                //Suma Costo Empresa Total
                $suma_costo_empresa_total = 0;
                //Suma total de viaticos
                $suma_viaticos_total = 0;
                //suma total de movilizaciones
                $suma_movilizacion_total = 0;
                //suma total de inscripciones cerradas o reales
                $numero_total_inscripciones_reales = 0;
                //total de usuarios finalizados
                $total_usuarios_finalizados = 0;
                //Total de usuarios finalizados aprobados
                $total_usuarios_finalizados_aprobados = 0;
                //total de horas capacitadas.
                $total_horas_capacitadas = 0;
                foreach ($total as $unico) {
                    $estados = EstadoInscriocionCurso($unico->id);
                    if ($filtro_estado) {
                        if ($filtro_estado <> $estados[2]) continue;
                    }
                    $row .= file_get_contents("views/inscripcion/row_listado_inscripcion.html");
                    $numero_total_inscripciones++;
                    //Por cada inscripcion, hago un select distinc para saber que empresaas estan dentro de esta inscripcion en base a los usuarios.
                    $empresas_por_inscripcion = SelectDistinctEmpresaPorInscripcion($unico->id);
                    $rows_empresas = "";
                    foreach ($empresas_por_inscripcion as $unico2) {
                        $rows_empresas .= file_get_contents("views/inscripcion/row_inscripcion_rowspan.html");
                        $rows_empresas = str_replace("{NOMBRE_EMPRESA}", $unico2->nombre_empresa_holding, $rows_empresas);
                        $rows_empresas = str_replace("{RUT_EMPRESA_HOLDING}", Encodear3($unico2->empresa), $rows_empresas);
                        $tiene_datos_reales_por_empresa_holding = VerificaEstaEnCierreSoloIdInscripcion($unico->id, $unico2->empresa);
                        if ($tiene_datos_reales_por_empresa_holding) {
                            //ESTA SECCION ES PARA CUANDOYA SE ENCUENTRAN DATOS REALES EN LA INSCRIPCION
                            $listado_usuarios = ListadoUsuariosCerradosPorInscripcion($unico->id, "", $unico2->empresa, "");
                            $rows_empresas = str_replace("{MONTO_SENCE_H}", colocarPesos($listado_usuarios[1]), $rows_empresas);
                            $rows_empresas = str_replace("{MONTO_TOTAL_H}", colocarPesos($listado_usuarios[2] + $listado_usuarios[1]), $rows_empresas);
                            $rows_empresas = str_replace("{MONTO_EMPRESA_H}", colocarPesos($listado_usuarios[2]), $rows_empresas);
                            $rows_empresas = str_replace("{MONTO_VIATICO_H}", colocarPesos($listado_usuarios[4]), $rows_empresas);
                            $rows_empresas = str_replace("{MONTO_MOVILIZCION_H}", colocarPesos($listado_usuarios[5]), $rows_empresas);
                            $rows_empresas = str_replace("{ICONO_EXPORTAR_REPORTE_POR_EMPRESA}", '<a href="?sw=GR&ii=' . Encodear3($unico->id) . '&reh=' . Encodear3($unico2
                                    ->empresa) . '" onclick="abrirReporte(this.href);return false"><i class="fa fa-file-text"></i></a>', $rows_empresas);
                        } else {
                            $datos_no_reales_por_empresa_holding = TotalInscripcionesPorEmpresaHolding($unico->id, $unico2->empresa);
                            $rows_empresas = str_replace("{MONTO_VIATICO_H}", colocarPesos($datos_no_reales_por_empresa_holding[0]->suma_total_viaticos), $rows_empresas);
                            $rows_empresas = str_replace("{MONTO_MOVILIZCION_H}", colocarPesos($datos_no_reales_por_empresa_holding[0]->suma_total_movilizacion), $rows_empresas);
                            //Fecha Actual
                            $calculos_por_empresa_holding = ListadoUsuariosPorInscripcion($unico->id, "no", $unico2->empresa);
                            $rows_empresas = str_replace("{MONTO_SENCE_H}", number_format($calculos_por_empresa_holding[1], 0, ",", "."), $rows_empresas);
                            $rows_empresas = str_replace("{MONTO_EMPRESA_H}", number_format($calculos_por_empresa_holding[2], 0, ",", "."), $rows_empresas);
                            $rows_empresas = str_replace("{MONTO_TOTAL_H}", number_format($calculos_por_empresa_holding[1] + $calculos_por_empresa_holding[2], 0, ",", "."), $rows_empresas);
                            $rows_empresas = str_replace("{ICONO_EXPORTAR_REPORTE_POR_EMPRESA}", '', $rows_empresas);
                        }
                    }
                    $row = str_replace("{TOTAL_ROWSPAN}", count($empresas_por_inscripcion) + 1, $row);
                    $row = str_replace("{ROW_DERALLES_EMPRESAS}", $rows_empresas, $row);
                    $row = str_replace("{CURSO}", $unico->nombre_curso, $row);
                    $row = str_replace("{FECHA_INICIO}", FormateaFecha($unico->fecha_inicio), $row);
                    $row = str_replace("{ID}", ($unico->id), $row);
                    $row = str_replace("{FECHA_TERMINO}", FormateaFecha($unico->fecha_termino), $row);
                    //$row = str_replace("{NUMERO_PARTICIPANTES}",$unico->cantidad_maxima_participantes,$row);
                    $row = str_replace("{NUMERO_PARTICIPANTES}", $unico->total_inscritos, $row);
                    $row = str_replace("{PARTICIPANTES_ENCUESTA_FINALIZADO}", $unico->total_participantes_encuesta_finalizado, $row);
                    $row = str_replace("{TOTAL_ENVIO_CORREOS}", $unico->total_envio_correos, $row);
                    $numero_participantes_general = $numero_participantes_general + $unico->total_inscritos;
                    $row = str_replace("{CLASIFICACION}", $unico->nombre_clasificacion, $row);
                    $row = str_replace("{TIPO}", $unico->nombre_tipo, $row);
                    $row = str_replace("{ID_INSCRIPCION_ENCODEADO}", Encodear3($unico->id), $row);
                    //Dada la inscripcion, veo si hay encuestas de satisfaccion finalizadas para este id de Inscripcion
                    $enc_finalizadas = EncuestasSatisFinalizadasPorInscripcion($unico->id);
                    if (count($enc_finalizadas) > 0) {
                        $row = str_replace("{ICONO_VER_INFORMA_SATIS}", '&nbsp;&nbsp;<a href="?sw=InfEncXInsc&ii=' . Encodear3($unico->id) . '" onclick="abrir(this.href);return false"><i class="fa fa-file-text"></i></a>', $row);
                    } else {
                        $row = str_replace("{ICONO_VER_INFORMA_SATIS}", '', $row);
                    }
                    $row = str_replace("{ESTADO}", $estados[0], $row);
                    $tiene_datos_reales = VerificaEstaEnCierreSoloIdInscripcion($unico->id, "");
                    if ($tiene_datos_reales) {
                        $numero_total_inscripciones_reales++;
                        //ESTA SECCION ES PARA CUANDOYA SE ENCUENTRAN DATOS REALES EN LA INSCRIPCION
                        $row = str_replace("{DATOS}", '<span class="label label-success">Datos Reales</span>', $row);
                        $listado_usuarios = ListadoUsuariosCerradosPorInscripcion($unico->id, $arreglo_post);
                        $total_usuarios_finalizados = $total_usuarios_finalizados + $listado_usuarios[3];
                        $total_usuarios_finalizados_aprobados = $total_usuarios_finalizados_aprobados + $listado_usuarios[8];
                        $total_horas_capacitadas = $total_horas_capacitadas + $listado_usuarios[9];
                        $row = str_replace("{MONTO_SENCE}", colocarPesos($listado_usuarios[1]), $row);
                        $suma_total_franquicia = $suma_total_franquicia + $listado_usuarios[1];
                        $row = str_replace("{MONTO_TOTAL}", colocarPesos($listado_usuarios[2] + $listado_usuarios[1]), $row);
                        $sumas_totales_general = $sumas_totales_general + ($listado_usuarios[2] + $listado_usuarios[1]);
                        $row = str_replace("{MONTO_EMPRESA}", colocarPesos($listado_usuarios[2]), $row);
                        $suma_costo_empresa_total = $suma_costo_empresa_total + $listado_usuarios[2];
                        $row = str_replace("{MONTO_VIATICO}", colocarPesos($listado_usuarios[4]), $row);
                        $suma_viaticos_total = $suma_viaticos_total + $listado_usuarios[4];
                        $row = str_replace("{MONTO_MOVILIZCION}", colocarPesos($listado_usuarios[5]), $row);
                        $suma_movilizacion_total = $suma_movilizacion_total + $listado_usuarios[5];
                        //$row = str_replace("{ICONO_EXPORTAR_REPORTE}",'<a href="../front/clases/phpToPDF/examples/bw_landscape_pdf_from_html.php"><i class="fa fa-file-text"></i></a>',$row);
                        $row = str_replace("{ICONO_EXPORTAR_REPORTE}", '<a href="?sw=GR&ii=' . Encodear3($unico->id) . '" onclick="abrirReporte(this.href);return false"><i class="fa fa-file-text"></i></a>', $row);
                    } else {
                        $row = str_replace("{ICONO_EXPORTAR_REPORTE}", '', $row);
                        $row = str_replace("{DATOS}", '<span class="label label-danger">Datos Estimados</span>', $row);
                        $row = str_replace("{MONTO_VIATICO}", colocarPesos($unico->suma_total_viaticos), $row);
                        //$suma_viaticos_total=$suma_viaticos_total+$unico->suma_total_viaticos;
                        $row = str_replace("{MONTO_MOVILIZCION}", colocarPesos($unico->suma_total_movilizacion), $row);
                        //$suma_movilizacion_total=$suma_movilizacion_total+$unico->suma_total_movilizacion;
                        //Fecha Actual
                        $calculos = ListadoUsuariosPorInscripcion($unico->id, "no", "");
                        $row = str_replace("{MONTO_SENCE}", number_format($calculos[1], 0, ",", "."), $row);
                        //$suma_total_franquicia=$suma_total_franquicia+$calculos[1];
                        $row = str_replace("{MONTO_EMPRESA}", number_format($calculos[2], 0, ",", "."), $row);
                        //$suma_costo_empresa_total=$suma_costo_empresa_total+$calculos[2];
                        $row = str_replace("{MONTO_TOTAL}", number_format($calculos[1] + $calculos[2], 0, ",", "."), $row);
                        //$sumas_totales_general=$sumas_totales_general+($calculos[1]+$calculos[2]);
                    }
                }
                $arreglo[0] = utf8_encode($row);
                //Numero de participantes total
                $arreglo[1] = $numero_participantes_general;
                //total de inscripciones
                $arreglo[2] = $numero_total_inscripciones;
                //Suma total general
                $arreglo[4] = $sumas_totales_general;
                //Suma total de las franquicias
                $arreglo[5] = $suma_total_franquicia;
                //Suma costo empresa total
                $arreglo[6] = $suma_costo_empresa_total;
                //Suma viaticos total
                $arreglo[7] = $suma_viaticos_total;
                //Suma movilizacion total
                $arreglo[8] = $suma_movilizacion_total;
                //Suma Total inscripciones reales
                $arreglo[9] = $numero_total_inscripciones_reales;
                //total de Usuarios finalizados
                $arreglo[10] = $total_usuarios_finalizados;
                //Total usuarios aprobados
                $arreglo[11] = $total_usuarios_finalizados_aprobados;
                //Total de horas capacitadas
                $arreglo[12] = $total_horas_capacitadas;
                return ($arreglo);
            }

            function ColocaDatosInscripcion($PRINCIPAL, $id_inscripcion)
            {
                $datos = DatosInscripcion($id_inscripcion);
                $PRINCIPAL = str_replace("{VALUE_FECHA_INICIO}", $datos[0]->fecha_inicio, $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_FECHA_TERMINO}", $datos[0]->fecha_termino, $PRINCIPAL);
                $fecha_inicio = str_replace("-", "/", $datos[0]->fecha_inicio);
                $fecha_termino = str_replace("-", "/", $datos[0]->fecha_termino);
                $fecha_completa = $fecha_inicio . " - " . $fecha_termino;
                $PRINCIPAL = str_replace("{FECHA_COMPLETA}", $fecha_completa, $PRINCIPAL);
                $PRINCIPAL = str_replace("{NUMERO_DIAS}", $datos[0]->numero_dias, $PRINCIPAL);
                $PRINCIPAL = str_replace("{DIRECCION}", $datos[0]->direccion, $PRINCIPAL);
                $PRINCIPAL = str_replace("{COMUNA}", $datos[0]->comuna, $PRINCIPAL);
                $PRINCIPAL = str_replace("{CIUDAD}", $datos[0]->ciudad, $PRINCIPAL);
                $PRINCIPAL = str_replace("{COMENTARIOS}", $datos[0]->comentarios, $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_HOR_LUNES_D_AM}", $datos[0]->lunes_d_am, $PRINCIPAL);
                $PRINCIPAL = str_replace("{SELECT_HOR_LUNES_D_AM}", OptionTiempo($datos[0]->lunes_d_am, "am"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_HOR_LUNES_H_AM}", $datos[0]->lunes_h_am, $PRINCIPAL);
                $PRINCIPAL = str_replace("{SELECT_HOR_LUNES_H_AM}", OptionTiempo($datos[0]->lunes_h_am, "am"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_HOR_LUNES_D_PM}", $datos[0]->lunes_d_pm, $PRINCIPAL);
                $PRINCIPAL = str_replace("{SELECT_HOR_LUNES_D_PM}", OptionTiempo($datos[0]->lunes_d_pm, "pm"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_HOR_LUNES_H_PM}", $datos[0]->lunes_h_pm, $PRINCIPAL);
                $PRINCIPAL = str_replace("{SELECT_HOR_LUNES_H_PM}", OptionTiempo($datos[0]->lunes_h_pm, "pm"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_HOR_MARTES_D_AM}", $datos[0]->martes_d_am, $PRINCIPAL);
                $PRINCIPAL = str_replace("{SELECT_HOR_MARTES_D_AM}", OptionTiempo($datos[0]->martes_d_am, "am"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_HOR_MARTES_H_AM}", $datos[0]->martes_h_am, $PRINCIPAL);
                $PRINCIPAL = str_replace("{SELECT_HOR_MARTES_H_AM}", OptionTiempo($datos[0]->martes_h_am, "am"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_HOR_MARTES_D_PM}", $datos[0]->martes_d_pm, $PRINCIPAL);
                $PRINCIPAL = str_replace("{SELECT_HOR_MARTES_D_PM}", OptionTiempo($datos[0]->martes_d_pm, "pm"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_HOR_MARTES_H_PM}", $datos[0]->martes_h_pm, $PRINCIPAL);
                $PRINCIPAL = str_replace("{SELECT_HOR_MARTES_H_PM}", OptionTiempo($datos[0]->martes_h_pm, "pm"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_HOR_MIERCOLES_D_AM}", $datos[0]->miercoles_d_am, $PRINCIPAL);
                $PRINCIPAL = str_replace("{SELECT_HOR_MIERCOLES_D_AM}", OptionTiempo($datos[0]->miercoles_d_am, "am"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_HOR_MIERCOLES_H_AM}", $datos[0]->miercoles_h_am, $PRINCIPAL);
                $PRINCIPAL = str_replace("{SELECT_HOR_MIERCOLES_H_AM}", OptionTiempo($datos[0]->miercoles_h_am, "am"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_HOR_MIERCOLES_D_PM}", $datos[0]->miercoles_d_pm, $PRINCIPAL);
                $PRINCIPAL = str_replace("{SELECT_HOR_MIERCOLES_D_PM}", OptionTiempo($datos[0]->miercoles_d_pm, "pm"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_HOR_MIERCOLES_H_PM}", $datos[0]->miercoles_h_pm, $PRINCIPAL);
                $PRINCIPAL = str_replace("{SELECT_HOR_MIERCOLES_H_PM}", OptionTiempo($datos[0]->miercoles_h_pm, "pm"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_HOR_JUEVES_D_AM}", $datos[0]->jueves_d_am, $PRINCIPAL);
                $PRINCIPAL = str_replace("{SELECT_HOR_JUEVES_D_AM}", OptionTiempo($datos[0]->jueves_d_am, "am"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_HOR_JUEVES_H_AM}", $datos[0]->jueves_h_am, $PRINCIPAL);
                $PRINCIPAL = str_replace("{SELECT_HOR_JUEVES_H_AM}", OptionTiempo($datos[0]->jueves_h_am, "am"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_HOR_JUEVES_D_PM}", $datos[0]->jueves_d_pm, $PRINCIPAL);
                $PRINCIPAL = str_replace("{SELECT_HOR_JUEVES_D_PM}", OptionTiempo($datos[0]->jueves_d_pm, "pm"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_HOR_JUEVES_H_PM}", $datos[0]->jueves_h_pm, $PRINCIPAL);
                $PRINCIPAL = str_replace("{SELECT_HOR_JUEVES_H_PM}", OptionTiempo($datos[0]->jueves_h_pm, "pm"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_HOR_VIERNES_D_AM}", $datos[0]->viernes_d_am, $PRINCIPAL);
                $PRINCIPAL = str_replace("{SELECT_HOR_VIERNES_D_AM}", OptionTiempo($datos[0]->viernes_d_am, "am"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_HOR_VIERNES_H_AM}", $datos[0]->viernes_h_am, $PRINCIPAL);
                $PRINCIPAL = str_replace("{SELECT_HOR_VIERNES_H_AM}", OptionTiempo($datos[0]->viernes_h_am, "am"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_HOR_VIERNES_D_PM}", $datos[0]->viernes_d_pm, $PRINCIPAL);
                $PRINCIPAL = str_replace("{SELECT_HOR_VIERNES_D_PM}", OptionTiempo($datos[0]->viernes_d_pm, "pm"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_HOR_VIERNES_H_PM}", $datos[0]->viernes_h_pm, $PRINCIPAL);
                $PRINCIPAL = str_replace("{SELECT_HOR_VIERNES_H_PM}", OptionTiempo($datos[0]->viernes_h_pm, "pm"), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function FuncionIngresaInscripcion($PRINCIPAL, $id_curso, $id_inscripcion)
            {
                //Aca veo si estÃ¡ o nofinalizada la inscripcion
                if ($id_inscripcion) {
                    $estado_inscripcion = EstadoInscriocionCurso($id_inscripcion);
                    if ($estado_inscripcion[1] == 1) {
                        $PRINCIPAL = str_replace("{SECCION_FILTROS_CURSOS}", "", $PRINCIPAL);
                    } else {
                        $PRINCIPAL = str_replace("{SECCION_FILTROS_CURSOS}", file_get_contents("views/inscripcion/filtro_curso.html"), $PRINCIPAL);
                    }
                } else {
                    $PRINCIPAL = str_replace("{SECCION_FILTROS_CURSOS}", file_get_contents("views/inscripcion/filtro_curso.html"), $PRINCIPAL);
                }
                //$PRINCIPAL = str_replace("{OPTIONS_CURSOS}",OptionsGenericoNombreDadoValores("tbl_curso", $id_curso,  "nombre", "id"),$PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_CURSOS}", OptionsGenericoNombreDadoValores2($id_curso), $PRINCIPAL);
                if ($id_curso) {
                    $datos_curso = DatosCurso($id_curso);
                    $PRINCIPAL = str_replace("{ENTORNO_DETALLE_CURSO}", file_get_contents("views/inscripcion/entorno_detalle_curso.html"), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{CODIGO_SENCE}", utf8_encode($datos_curso[0]->numero_identificador), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{NOMBRE}", utf8_encode($datos_curso[0]->nombre), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{CLASIFICACION}", utf8_encode($datos_curso[0]->nombre_clasificacion), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{OTEC}", $datos_curso[0]->nombre_otec, $PRINCIPAL);
                    $PRINCIPAL = str_replace("{MODALIDAD}", $datos_curso[0]->nombre_modalidad, $PRINCIPAL);
                    $PRINCIPAL = str_replace("{TIPO}", $datos_curso[0]->nombre_tipo, $PRINCIPAL);
                    $PRINCIPAL = str_replace("{CBC}", $datos_curso[0]->cbc, $PRINCIPAL);
                    $PRINCIPAL = str_replace("{SENCE}", $datos_curso[0]->sence, $PRINCIPAL);
                    $PRINCIPAL = str_replace("{NUM_HORAS}", $datos_curso[0]->numero_horas, $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VALOR_HORA}", colocarPesos($datos_curso[0]->valor_hora), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VALOR_HORA_SENCE}", colocarPesos($datos_curso[0]->valor_hora_sence), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VALOR_CURSO_ENCABEZADO}", colocarPesos($datos_curso[0]->valor_hora * $datos_curso[0]->numero_horas), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ID_INSCRIPCION_ENCODEADA}", Encodear3($id_inscripcion), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ID_CURSO_ENCODEADA}", Encodear3($id_curso), $PRINCIPAL);
                    //Valor Hora Curso
                    $PRINCIPAL = str_replace("{VALOR_CURSO}", $datos_curso[0]->numero_horas * $datos_curso[0]->valor_hora, $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VALOR_HORA_CURSO}", $datos_curso[0]->valor_hora, $PRINCIPAL);
                    //con el dato de inscripcion, lo paso a una funcion, para que coloque todos los datos de la inscricpcion correspondiente
                    $PRINCIPAL = ColocaDatosInscripcion($PRINCIPAL, $id_inscripcion);
                    if ($id_inscripcion) {
                        $PRINCIPAL = str_replace("{SECCION_INSCRIPCION_USUARIOS}", file_get_contents("views/inscripcion/entorno_detalle_inscripcion.html"), $PRINCIPAL);
                        //ACA VALIDO SI ESTÃ?? CERRADA LA INSCRIPCION, NO MUESTRO EL BLOQUE DE FORMULARIO DE INSCRIPCION MASIVA, SI NO ESTÃ?? FINALIZADO, LO MUESTRO
                        if ($estado_inscripcion[1] == 1) {
                            $PRINCIPAL = str_replace("{FORMuLARIO_INSCRIPCION_PARTICIPANTES_MASIVOS}", "<br>", $PRINCIPAL);
                        } else {
                            $PRINCIPAL = str_replace("{FORMuLARIO_INSCRIPCION_PARTICIPANTES_MASIVOS}", file_get_contents("views/inscripcion/formularios_inscripcion_usuarios_por_inscripcion.html"), $PRINCIPAL);
                        }
                        $PRINCIPAL = str_replace("{OPTIONS_ALUMNOS}", utf8_encode(OptionUsuariosTodos2()), $PRINCIPAL);
                        $PRINCIPAL = str_replace("{ACTION_INSC}", "?sw=editinsc", $PRINCIPAL);
                        $PRINCIPAL = str_replace("{ID_INSCRIPCION_ENCODEADO}", Encodear3($id_inscripcion), $PRINCIPAL);
                        //Aca coloca el listado de usuarios por inscripcion
                        $datos_listado_usuario_por_inscripcion = ListadoUsuariosPorInscripcion($id_inscripcion, "no", "");
                        $PRINCIPAL = str_replace("{LISTADO_INSCRITOS_POR_CAPACITACION}", $datos_listado_usuario_por_inscripcion[0], $PRINCIPAL);
                        $PRINCIPAL = str_replace("{MONTO_SENCE}", colocarPesos($datos_listado_usuario_por_inscripcion[1]), $PRINCIPAL);
                        $PRINCIPAL = str_replace("{MONOT_EMPRESA}", colocarPesos($datos_listado_usuario_por_inscripcion[2]), $PRINCIPAL);
                        $PRINCIPAL = str_replace("{MONTO_TOTAL}", colocarPesos($datos_listado_usuario_por_inscripcion[1] + $datos_listado_usuario_por_inscripcion[2]), $PRINCIPAL);
                        $PRINCIPAL = str_replace("{NUM_PARTICIPANTES}", $datos_listado_usuario_por_inscripcion[3], $PRINCIPAL);
                        $PRINCIPAL = str_replace("{MONTO_VIATICO}", colocarPesos($datos_listado_usuario_por_inscripcion[4]), $PRINCIPAL);
                        $PRINCIPAL = str_replace("{MONTO_MOVILIZACION}", colocarPesos($datos_listado_usuario_por_inscripcion[5]), $PRINCIPAL);
                        //$PRINCIPAL = str_replace("{ROW_LISTADO_INSCRIPCIONES_RESUMEN}",ListadoInscripcionesResumen($id_curso),$PRINCIPAL);
                        $PRINCIPAL = str_replace("{ID_INSCRIPCION}", $id_inscripcion, $PRINCIPAL);
                    } else {
                        $PRINCIPAL = str_replace("{SECCION_INSCRIPCION_USUARIOS}", "", $PRINCIPAL);
                        $PRINCIPAL = str_replace("{ACTION_INSC}", "?sw=instertainsc", $PRINCIPAL);
                    }
                } else {
                    $PRINCIPAL = str_replace("{ENTORNO_DETALLE_CURSO}", "", $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function AceptaProcesamientoPrevioU($id_empresa)
            {
                //BORRA TODOS LOS USUARIOS DE UNA EMPRESA
                //Trae todos los datos de la tabla temporal.
                Lms_vigencia1_usuarios($id_empresa);
                $Utemp = TotalUsuariosTemp($id_empresa);
                $linea = 0;
                //DesvinculaUsuariosExcel($id_empresa);
                foreach ($Utemp as $key => $item) {
                    $coma = "";
                    $values = "";
                    $registros = "";
                    $accion = "";
                    $valuesUpdate = "";
                    $rut = "";
                    foreach ($item as $key2 => $valor) {
                        if ($key2 == "accion") {
                            $accion = $valor;
                        } else {
                            if ($key2 != "id") {
                                if ($key2 == "rut") {
                                    $rut = $valor;
                                }
                                if ($key2 <> 'id_malla') {
                                    $values .= $coma . $key2;
                                    $registros .= $coma . "'" . $valor . "'";
                                    $valuesUpdate .= $coma . $key2 . "='" . $valor . "'";
                                    $coma = ",";
                                }
                                if ($key2 == 'id_malla') {
                                    $id_malla = $valor;
                                }
                            }
                        }
                    }
                    if ($accion == "ACTUALIZAR") {
                        //ActualizaUsuarioMasivo($rut,$valuesUpdate,$id_empresa);
                        InsertaUsuarioMasivo($values, $registros);
                        Lms_Update_malla($rut, $id_malla, $id_empresa);
                    } else if ($accion == "INSERTAR") {
                        InsertaUsuarioMasivo($values, $registros);
                        Lms_Update_malla($rut, $id_malla, $id_empresa);
                    }
                    $linea++;
                }
                CancelaProcesamientoPrevioUsuarios($id_empresa);
            }

            function AceptaProcesamientoPrevio()
            {
                //Trae todos los datos de la tabla temporal.
                $todos_cur_temp = TodosLosCursosTemp();
                foreach ($todos_cur_temp as $unico) {
                    if ($unico->accion == "Actualizar") {
                        ActualizaCurso($unico->id_curso, $unico->nombre, $unico->descripcion, $unico->modalidad, $unico->tipo, $unico->prerequisito, $unico->objetivo_curso, $unico->sence, $unico->numero_horas, $nico->cantidad_maxima_participantes, $unico->rut_otec, $unico->clasificacion, $unico->cbc, $unico->valor_hora, $unico->valor_hora_sence);
                    } else if ($unico->accion == "Insertar") {
                        InsertaCurso($unico->nombre, $unico->descripcion, $unico->modalidad, $unico->tipo, $unico->prerequisito, "", $unico->objetivo_curso, $unico->sence, $unico->numero_horas, $unico->cantidad_maxima_participantes, $unico->rut_otec, $unico->clasificacion, $unico->cbc, $unico->numero_identificador, $unico->valor_hora, $unico->valor_hora_sence);
                    }
                }
                CancelaProcesamientoPrevio();
            }

            function ListadoCursosMasivosPrevio($tot_actualiza, $tot_inserta)
            {
                $total = TotalCursosTemp();
                $listado = file_get_contents("views/curso/entorno_listado_previa.html");
                foreach ($total as $unico) {
                    $row .= file_get_contents("views/curso/row_listado_previa.html");
                    $row = str_replace("{NOMBRE}", $unico->nombre, $row);
                    $row = str_replace("{DESCRIPCION}", $unico->descripcion, $row);
                    $row = str_replace("{OBJETIVO_CURSO}", $unico->objetivo_curso, $row);
                    $row = str_replace("{CLASIFICACION}", $unico->nombre_clasificacion, $row);
                    $row = str_replace("{SENCE}", $unico->sence, $row);
                    $row = str_replace("{PARTICIPANTES_MAX}", $unico->cantidad_maxima_participantes, $row);
                    $row = str_replace("{MODALIDAD}", $unico->nombre_modalidad, $row);
                    $row = str_replace("{TIPO}", $unico->tipo, $row);
                    $row = str_replace("{ACCION}", $unico->accion, $row);
                    if ($unico->accion == "Actualizar") {
                        $row = str_replace("{ETIQUETA}", "danger", $row);
                    } else if ($unico->accion == "Insertar") {
                        $row = str_replace("{ETIQUETA}", "success", $row);
                    }
                    $row = str_replace("{CODIGO_SENCE}", $unico->cod_sence, $row);
                    $row = str_replace("{NUMERO_IDENTIFICADOR}", $unico->numero_identificador, $row);
                }
                $listado = str_replace("{ROW_LISTADO}", $row, $listado);
                $listado = str_replace("{TOT_ACTUALIZAR}", $tot_actualiza, $listado);
                $listado = str_replace("{TOT_INSERTAR}", $tot_inserta, $listado);
                return ($listado);
            }

            function ListadoUsuariosMasivosPrevio($id_empresa)
            {
                $total = UsuariosTemporal($id_empresa);
                $listado = file_get_contents("views/basepersonas/entorno_listado_previa.html");
                foreach ($total as $unico) {
                    $row .= file_get_contents("views/basepersonas/row_listado_previa.html");
                    $row = str_replace("{NOMBRE_USUARIO}", $unico->nombre . " " . $unico->apaterno . " " . $unico->amaterno, $row);
                    $row = str_replace("{RUT}", $unico->rut, $row);
                    $row = str_replace("{RUT_ENCODEADO}", Encodear3($unico->rut), $row);
                    $row = str_replace("{GERENCIA}", $unico->gerencia, $row);
                    $row = str_replace("{CARGO}", $unico->cargo, $row);
                    $row = str_replace("{EMPRESA_HOLDING}", $unico->nombre_empresa_holding, $row);
                    $row = str_replace("{EMAIL}", $unico->email, $row);
                    $row = str_replace("{PERFIL}", $unico->perfil_evaluacion, $row);
                    $row = str_replace("{TRAMO}", $unico->tramo_sence . "%", $row);
                    //$row = str_replace("{ACCION1}",$unico->accion,$row);
                    $row = str_replace("{ACC}", $unico->accion, $row);
                    if ($unico->accion == "ACTUALIZAR") {
                        $row = str_replace("{ETIQUETA}", "warning", $row);
                    } else if ($unico->accion == "INSERTAR") {
                        $row = str_replace("{ETIQUETA}", "success", $row);
                    }
                    $row = str_replace("{CODIGO_SENCE}", $unico->cod_sence, $row);
                    $row = str_replace("{NUMERO_IDENTIFICADOR}", $unico->numero_identificador, $row);
                }
                $listado = str_replace("{ROW_LISTADO}", $row, $listado);
                return ($listado);
            }

            function ArmaPaginacionGenerico($pagina, $env, $tabla, $registros_por_pagina, $arreglo_post, $id_empresa, $id_proceso, $tipo_paginacion, $rut_evaluador)
            {
                //total de los registros
                if (!$pagina) {
                    $pagina = 1;
                }
                $maxpags = 0;
                if ($arreglo_post) {
                    $array_para_enviar_via_url = serialize($arreglo_post);
                    $array_para_enviar_via_url = urlencode($array_para_enviar_via_url);
                    $env .= "&arra=" . $array_para_enviar_via_url;
                }
                //total de registros
                if ($tipo_paginacion == "reporteEvaluador") {
                    $total_registros = SelectTotalParaPaginacionEvaluador($tabla, $_SESSION["id_empresa"], $arreglo_post, $id_proceso);
                } else {
                    $total_registros = SelectTotalParaPaginacionUsuario($tabla, $_SESSION["id_empresa"], $arreglo_post, $id_proceso, $rut_evaluador);
                }
                //Datos por paginacion
                //$datos_para_paginacion=SelectParaPaginacionUsuario($tabla, $_SESSION["id_empresa"], $registros_por_pagina, $id_proceso);
                //Con la funcion CEIL redodnea hacia arriba.
                //Total de paginas
                $total_paginas = ceil((count($total_registros) / $registros_por_pagina));
                //Pagina Anterior
                $pagina_anterior = $pagina - 1;
                //Pagina Siguiente
                $posterior = $pagina + 1;
                //Minimo para atras
                $minimo = $maxpags ? max(1, $pagina) : 1;
                //Maximo para adelante
                $maximo = $maxpags ? min($total_paginas, $pagina) : $total_paginas;
                if ($pagina > 1) {
                    //$row.=file_get_contents("views/dnc/row_fichacurso.html");
                    //$row = str_replace("{CURSO}",$unico->curso,$row);
                    //$paginacion.="<a href='?sw=".$env."&p=".($pagina-1)."'><<&nbsp;&nbsp;</a>";
                    $paginacion .= file_get_contents("views/paginacion/1.html");
                    $paginacion = str_replace("{ENV}", $env, $paginacion);
                    $paginacion = str_replace("{PAGINA}", ($pagina - 1), $paginacion);
                    $paginacion = str_replace("{PAGINAINICIAL}", "1", $paginacion);
                }
                if (($pagina + 10) > $total_paginas) {
                    $resta = $pagina + 10;
                    $valor = ($pagina + 10) - $total_paginas;
                    $pagina1 = $pagina - $valor;
                } else {
                    $pagina1 = $pagina;
                }
                for ($i = $pagina1; $i <= round(($pagina1 + 10)); $i++) {
                    if ($pagina == $i) {
                        //$paginacion.="<b><strong><span style='color:#000'>".$i."</span></strong></b>";
                        $paginacion .= file_get_contents("views/paginacion/actual.html");
                        $paginacion = str_replace("{PAGINA}", ($i), $paginacion);
                    } else {
                        //$paginacion.="<a href='?sw=".$env."&p=".$i."'>".$i."</a></b>";
                        $paginacion .= file_get_contents("views/paginacion/numero.html");
                        $paginacion = str_replace("{PAGINA}", ($i), $paginacion);
                        $paginacion = str_replace("{ENV}", ($env), $paginacion);
                    }
                }
                if ($pagina < round($total_paginas)) {
                    //$paginacion.="<a href='?sw=".$env."&p=".($pagina+1)."'>&nbsp;&nbsp;>></a>";
                    $paginacion .= file_get_contents("views/paginacion/4.html");
                    $paginacion = str_replace("{ENV}", $env, $paginacion);
                    $paginacion = str_replace("{PAGINA}", ($pagina + 1), $paginacion);
                    $paginacion = str_replace("{PAGINAFINAL}", ($total_paginas), $paginacion);
                }
                return ($paginacion);
            }

            function ArmaPaginacionGenericoBK22012016($pagina, $env, $tabla, $registros_por_pagina, $arreglo_post, $id_empresa, $id_proceso, $tipo_paginacion, $rut_evaluador)
            {
                //total de los registros
                if (!$pagina) {
                    $pagina = 1;
                }
                $maxpags = 0;
                if ($arreglo_post) {
                    $array_para_enviar_via_url = serialize($arreglo_post);
                    $array_para_enviar_via_url = urlencode($array_para_enviar_via_url);
                    $env .= "&arra=" . $array_para_enviar_via_url;
                }
                //total de registros
                if ($tipo_paginacion == "reporteEvaluador") {
                    $total_registros = SelectTotalParaPaginacionEvaluador($tabla, $_SESSION["id_empresa"], $arreglo_post, $id_proceso);
                } else {
                    $total_registros = SelectTotalParaPaginacionUsuario($tabla, $_SESSION["id_empresa"], $arreglo_post, $id_proceso, $rut_evaluador);
                }
                //Datos por paginacion
                //$datos_para_paginacion=SelectParaPaginacionUsuario($tabla, $_SESSION["id_empresa"], $registros_por_pagina, $id_proceso);
                //Con la funcion CEIL redodnea hacia arriba.
                //Total de paginas
                $total_paginas = ceil((count($total_registros) / $registros_por_pagina));
                //Pagina Anterior
                $pagina_anterior = $pagina - 1;
                //Pagina Siguiente
                $posterior = $pagina + 1;
                //Minimo para atras
                $minimo = $maxpags ? max(1, $pagina) : 1;
                //Maximo para adelante
                $maximo = $maxpags ? min($total_paginas, $pagina) : $total_paginas;
                if ($pagina > 1) {
                    //$row.=file_get_contents("views/dnc/row_fichacurso.html");
                    //$row = str_replace("{CURSO}",$unico->curso,$row);
                    //$paginacion.="<a href='?sw=".$env."&p=".($pagina-1)."'><<&nbsp;&nbsp;</a>";
                    $paginacion .= file_get_contents("views/paginacion/1.html");
                    $paginacion = str_replace("{ENV}", $env, $paginacion);
                    $paginacion = str_replace("{PAGINA}", ($pagina - 1), $paginacion);
                }
                for ($i = 1; $i <= round($total_paginas); $i++) {
                    if ($pagina == $i) {
                        //$paginacion.="<b><strong><span style='color:#000'>".$i."</span></strong></b>";
                        $paginacion .= file_get_contents("views/paginacion/actual.html");
                        $paginacion = str_replace("{PAGINA}", ($i), $paginacion);
                    } else {
                        //$paginacion.="<a href='?sw=".$env."&p=".$i."'>".$i."</a></b>";
                        $paginacion .= file_get_contents("views/paginacion/numero.html");
                        $paginacion = str_replace("{PAGINA}", ($i), $paginacion);
                        $paginacion = str_replace("{ENV}", ($env), $paginacion);
                    }
                }
                if ($pagina < round($total_paginas)) {
                    //$paginacion.="<a href='?sw=".$env."&p=".($pagina+1)."'>&nbsp;&nbsp;>></a>";
                    $paginacion .= file_get_contents("views/paginacion/4.html");
                    $paginacion = str_replace("{ENV}", $env, $paginacion);
                    $paginacion = str_replace("{PAGINA}", ($pagina + 1), $paginacion);
                }
                return ($paginacion);
            }

            function ArmaPaginacionUsuarios($pagina, $env, $tabla)
            {
                $datos_para_paginacion = SelectParaPaginacionUsuario($tabla, $_SESSION["id_empresa"]);
                //Con la funcion CEIL redodnea hacia arriba.
                $total_paginas = ceil((count($datos_para_paginacion) / 100));
                if ($pagina > 1) {
                    $paginacion .= "<a href='?sw=" . $env . "&p=" . ($pagina - 1) . "'><<&nbsp;&nbsp;</a>";
                }
                for ($i = 1; $i <= round($total_paginas); $i++) {
                    if ($pagina == $i) {
                        $paginacion .= "<b><strong><span style='color:#000'>" . $i . "</span></strong></b>";
                    } else {
                        $paginacion .= "<a href='?sw=" . $env . "&p=" . $i . "'>" . $i . "</a></b>";
                    }
                }
                if ($pagina < round($total_paginas)) {
                    $paginacion .= "<a href='?sw=" . $env . "&p=" . ($pagina + 1) . "'>&nbsp;&nbsp;>></a>";
                }
                return ($paginacion);
            }

            function ArmaPaginacion($pagina, $env, $tabla)
            {
                $datos_para_paginacion = SelectParaPaginacion($tabla);
                $total_paginas = (count($datos_para_paginacion) / 10);
                for ($i = 1; $i <= round($total_paginas); $i++) {
                    if ($pagina == $i) {
                        $paginacion .= "<b>" . $i . "</b>";
                    } else {
                        $paginacion .= "<a href='?sw=listcursos&p=" . $i . "'>" . $i . "</a></b>";
                    }
                }
                return ($paginacion);
            }

            function FiltrosListadoCursos($html, $arreglo_post, $pagina)
            {
                $html = str_replace("{OPTION_FILTRO_CLASIFICACION}", OptionsGenericoNombreDadoValores("tbl_curso_clasificacion", $arreglo_post["filtro_clasificacion"], "clasificacion", "id"), $html);
                $html = str_replace("{OPTION_FILTRO_TIPO_CURSO}", OptionsGenericoNombreDadoValores("tbl_curso_tipo", $arreglo_post["filtro_tipo_curso"], "nombre", "id"), $html);
                $html = str_replace("{OPTION_FILTRO_MODALIDAD}", OptionsGenericoNombreDadoValores("tbl_modalidad_curso", $arreglo_post["filtro_modalidad"], "modalidad", "id"), $html);
                $html = str_replace("{OPTION_FILTRO_OTEC}", OptionsGenericoNombreDadoValores("tbl_otec", $arreglo_post["filtro_otec"], "nombre", "rut"), $html);
                //PARA SENCE
                if ($arreglo_post["filtro_sence"] == "si") {
                    $html = str_replace("{SELECTEDSI}", "selected", $html);
                    $html = str_replace("{SELECTEDNO}", "", $html);
                } else if ($arreglo_post["filtro_sence"] == "no") {
                    $html = str_replace("{SELECTEDNO}", "selected", $html);
                    $html = str_replace("{SELECTEDSI}", "", $html);
                } else {
                    $html = str_replace("{SELECTEDNO}", "", $html);
                    $html = str_replace("{SELECTEDSI}", "", $html);
                }
                $html = str_replace("{OPTION_FILTRO_EMPRESA_HOLDING}", OptionsGenericoNombreDadoValores("tbl_empresa_holding", $arreglo_post["filtro_empresa_holding"], "empresa", "rut"), $html);
                $html = str_replace("{OPTION_CENTRO_COSTO}", OptionsGenericoPorEmpresa("centro_costo", "tbl_usuario", $arreglo_post["filtro_centrocosto"], $_SESSION["id_empresa"]), $html);
                $html = str_replace("value='" . $arreglo_post["orderBy"] . "'", "value='" . $arreglo_post["orderBy"] . "' selected", $html);
                $html = str_replace("value='" . $arreglo_post["asc_desc"] . "'", "value='" . $arreglo_post["asc_desc"] . "' selected", $html);
                if ($_POST["n_registros"]) {
                    $html = str_replace("{VALUE_NREGISTROS}", "value='" . $_POST["n_registros"] . "'", $html);
                } else {
                    $html = str_replace("{VALUE_NREGISTROS}", "", $html);
                }
                //$html = str_replace("{PAGINACION}",ArmaPaginacion($pagina, "listcursos", "tbl_curso"),$html);
                return ($html);
            }

            function MuestraConsolidadoPorCurso($PRINCIPAL, $post)
            {
                $tipo = $post["tipo"];
                $nivel = $post["nivel"];
                $gerencia = $post["gerencia"];
                //Traigo el listado en base a las variables recibidas.
                $datos = DatosconsolidadoDncCursos();
                $row = "";
                foreach ($datos as $unico) {
                    $row .= file_get_contents("views/dnc/row_fichacurso.html");
                    $row = str_replace("{CURSO}", $unico->curso, $row);
                    $row = str_replace("{TIPOCURSO}", $unico->gt, $row);
                    $rowdetalle = "";
                    $datosc = DatosporCursos($unico->curso);
                    foreach ($datosc as $datocurso) {
                        $rowdetalle .= file_get_contents("views/dnc/row_FichaCursoG.html");
                        $rowdetalle = str_replace("{CONDUCTA_ESPERADA}", $datocurso->conducta_esperada, $rowdetalle);
                    }
                    $row = str_replace("{FILADETALLECURSO}", $rowdetalle, $row);
                }
                $PRINCIPAL = str_replace("{ROW_CURSOS}", utf8_encode($row), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function MuestraConsolidadoPorCursoG($PRINCIPAL, $post)
            {
                $tipo = $post["tipo"];
                $nivel = $post["nivel"];
                $gerencia = $post["gerencia"];
                //Traigo el listado en base a las variables recibidas.
                $datos = DatosconsolidadoDncCursosG();
                $row = "";
                foreach ($datos as $unico) {
                    $row .= file_get_contents("views/dnc/row_fichacurso.html");
                    $row = str_replace("{CURSO}", $unico->curso, $row);
                    if ($unico->gt == "G") {
                        $row = str_replace("{TIPOCURSO}", "Curso General", $row);
                    }
                    if ($unico->gt == "T") {
                        $row = str_replace("{TIPOCURSO}", "Curso T&eacute;cnico", $row);
                    }
                    $rowdtematica = "";
                    $agrupaciontematica = "";
                    $datosc = DatosporTBLCursos($unico->curso);
                    foreach ($datosc as $datocurso) {
                        if ($datocurso->tematica <> '') {
                            $agrupaciontematica .= $datocurso->tematica . ". ";
                        }
                    }
                    $rowdtematica .= file_get_contents("views/dnc/row_FichaCursoTematica.html");
                    $rowdtematica = str_replace("{TEMATICA}", $agrupaciontematica . ". ", $rowdtematica);
                    $row = str_replace("{FILADETALLETEMATICAS}", $rowdtematica, $row);
                    $rowdetalle = "";
                    $datosc = DatosporpRIORIZACIONCursos($unico->curso);
                    foreach ($datosc as $datocurso) {
                        $rowdetalle .= file_get_contents("views/dnc/row_FichaCursoG.html");
                        $rowdetalle = str_replace("{CARGO}", $datocurso->cargo, $rowdetalle);
                        $rowdetalle = str_replace("{GERENCIA}", $datocurso->gerencia, $rowdetalle);
                        $rowdetalle = str_replace("{PRIORIDAD}", $datocurso->priorizacioncursos, $rowdetalle);
                    }
                    $row = str_replace("{FILADETALLECURSO}", $rowdetalle, $row);
                }
                $PRINCIPAL = str_replace("{ROW_CURSOSG}", utf8_encode($row), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function MuestraConsolidadorankingporCursoG($PRINCIPAL, $post)
            {
                $tipo = $post["tipo"];
                $nivel = $post["nivel"];
                $gerencia = $post["gerencia"];
                //Traigo el listado en base a las variables recibidas.
                $datos = DatosconsolidadoListaGerencia();
                $row = "";
                foreach ($datos as $unico) {
                    $row .= file_get_contents("views/dnc/row_ficharankingcurso.html");
                    $row = str_replace("{GERENCIA}", $unico->gerencia, $row);
                    $rowdetalle = "";
                    $datosc = DatosporpRankingRIORIZACIONCursos($unico->gerencia);
                    foreach ($datosc as $datocurso) {
                        //echo "<br /> ".$unico->gerencia." _ ".$datocurso->curso." _ ".$datocurso->cuenta;
                        $rowdetalle .= file_get_contents("views/dnc/row_FichaRankCursoG.html");
                        $rowdetalle = str_replace("{CURSO}", $datocurso->curso, $rowdetalle);
                        $rowdetalle = str_replace("{TIPO}", $unico->gerencia, $rowdetalle);
                        $rowdetalle = str_replace("{VECES}", $datocurso->cuenta, $rowdetalle);
                    }
                    $row = str_replace("{FILADETALLERANK}", $rowdetalle, $row);
                }
                $PRINCIPAL = str_replace("{ROW_RANKINGG}", utf8_encode($row), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function MuestraRFCursoRFG($PRINCIPAL, $post)
            {
                $tipo = $post["tipo"];
                $nivel = $post["nivel"];
                $gerencia = $post["gerencia"];
                //Traigo el listado en base a las variables recibidas.
                $datos = DatosconsolidadoListaGerencia();
                $row = "";
                foreach ($datos as $unico) {
                    $row .= file_get_contents("views/dnc/row_ficharankingcurso.html");
                    $row = str_replace("{GERENCIA}", $unico->gerencia, $row);
                    $rowdetalle = "";
                    $datosc = DatosporpRankingRIORIZACIONCursos($unico->gerencia);
                    foreach ($datosc as $datocurso) {
                        //echo "<br /> ".$unico->gerencia." _ ".$datocurso->curso." _ ".$datocurso->cuenta;
                        $rowdetalle .= file_get_contents("views/dnc/row_FichaRankCursoG.html");
                        $rowdetalle = str_replace("{CURSO}", $datocurso->curso, $rowdetalle);
                        $rowdetalle = str_replace("{TIPO}", $unico->gerencia, $rowdetalle);
                        $rowdetalle = str_replace("{VECES}", $datocurso->cuenta, $rowdetalle);
                    }
                    $row = str_replace("{FILADETALLERANK}", $rowdetalle, $row);
                }
                $PRINCIPAL = str_replace("{ROW_RANKINGG}", utf8_encode($row), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function MuestraReporteCursosVsCargo($PRINCIPAL, $post)
            {
                $tipo = $post["tipo"];
                $nivel = $post["nivel"];
                $gerencia = $post["gerencia"];
                //Traigo el listado en base a las variables recibidas.
                $datos = DatosconsolidadoListaCARGOS();
                $row = "";
                foreach ($datos as $unico) {
                    $row .= file_get_contents("views/dnc/row_FichaReporte_Cargos.html");
                    $row = str_replace("{CARGO}", $unico->cargo, $row);
                }
                $PRINCIPAL = str_replace("{ROW_REPORTE_CURSOS_CARGOS}", utf8_encode($row), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function MuestraReporteCursosPorCargo($PRINCIPAL, $post)
            {
                $tipo = $post["tipo"];
                $nivel = $post["nivel"];
                $gerencia = $post["gerencia"];
                //Traigo el listado en base a las variables recibidas.
                $datos = DatosconsolidadoListaCursos();
                $row = "";
                foreach ($datos as $unico) {
                    $row .= file_get_contents("views/dnc/row_FichaReporte_CursosPorCargos.html");
                    $row = str_replace("{CURSO}", $unico->curso, $row);
                    $rowdetalle = "";
                    $datosc = DatosconsolidadoListaCARGOS();
                    foreach ($datosc as $datocargo) {
                        //por cada cargo  busca si hay curso
                        $datosd = DatosconsolidadoBuscaPrioridadListaCARGOS($datocargo->codigo, $unico->curso);
                        $prioridad->priorizacioncursos = "";
                        foreach ($datosd as $prioridad) {
                            if ($datocurso->codigo == '62') {
                                //echo "<br />PRIORIDAD ".$prioridad->priorizacioncursos;
                            }
                        }
                        $rowdetalle .= file_get_contents("views/dnc/row_FichaReporte_CursosPorCargos_tdprioridad.html");
                        $rowdetalle = str_replace("{PRIORIDADCARGOCURSO}", $prioridad->priorizacioncursos, $rowdetalle);
                    }
                    $row = str_replace("{FILLADETALLECCURSOPORCARGO}", $rowdetalle, $row);
                }
                $PRINCIPAL = str_replace("{ROW_REPORTE_CURSOS_POR_CARGOS}", utf8_encode($row), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function MuestraConsolidadoPorCursoT($PRINCIPAL, $post)
            {
                $tipo = $post["tipo"];
                $nivel = $post["nivel"];
                $gerencia = $post["gerencia"];
                //Traigo el listado en base a las variables recibidas.
                $datos = DatosconsolidadoDncCursosT();
                $row = "";
                foreach ($datos as $unico) {
                    $row .= file_get_contents("views/dnc/row_fichacurso.html");
                    $row = str_replace("{CURSO}", $unico->curso, $row);
                    $row = str_replace("{TIPOCURSO}", "Curso T&eacute;cnico", $row);
                    $rowdtematica = "";
                    $agrupaciontematica = "";
                    $datosc = DatosporTBLCursos($unico->curso);
                    foreach ($datosc as $datocurso) {
                        if ($datocurso->tematica <> '') {
                            $agrupaciontematica .= $datocurso->tematica . ". ";
                        }
                    }
                    $rowdtematica .= file_get_contents("views/dnc/row_FichaCursoTematica.html");
                    $rowdtematica = str_replace("{TEMATICA}", $agrupaciontematica . ". ", $rowdtematica);
                    $row = str_replace("{FILADETALLETEMATICAS}", $rowdtematica, $row);
                    $rowdetalle = "";
                    $datosc = DatosporCursos($unico->curso);
                    foreach ($datosc as $datocurso) {
                        $rowdetalle .= file_get_contents("views/dnc/row_FichaCursoT.html");
                        $rowdetalle = str_replace("{CONDUCTA_ESPERADA}", $datocurso->conducta_esperada, $rowdetalle);
                    }
                    $row = str_replace("{FILADETALLECURSO}", $rowdetalle, $row);
                }
                $PRINCIPAL = str_replace("{ROW_CURSOST}", utf8_encode($row), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function MuestraEquipoPlanesTransversalesRF($PRINCIPAL, $post)
            {
                $tipo = $post["tipo"];
                $nivel = $post["nivel"];
                $gerencia = $post["gerencia"];
                //vista planes especificos
                $datos = DatosEquipoRF($tipo, $nivel, $gerencia);
                $row = "";
                $row .= file_get_contents("views/dnc/RF_planestransversales.html");
                foreach ($datos as $unico) {
                    $row .= file_get_contents("views/dnc/row_RF_planestransversales.html");
                    $row = str_replace("{gerencia}", $unico->gerencia, $row);
                    $row = str_replace("{nombre_completo}", $unico->nombre_completo, $row);
                    $row = str_replace("{cargo}", $unico->cargo, $row);
                    $row = str_replace("{email}", $unico->email, $row);
                    $row = str_replace("{nombrejefe}", $unico->nombrejefe, $row);
                }
                $PRINCIPAL = str_replace("{ROW_PLANES_TRANSVERSALES_RF}", utf8_encode($row), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function MuestraEquipoPlanesEspecificosRF($PRINCIPAL, $post)
            {
                $tipo = $post["tipo"];
                $nivel = $post["nivel"];
                $gerencia = $post["gerencia"];
                //vista planes especificos
                $datos = DatosSugerenciasRF($tipo, $nivel, $gerencia);
                $row = "";
                $row .= file_get_contents("views/dnc/RF_sugerencia.html");
                foreach ($datos as $unico) {
                    $row .= file_get_contents("views/dnc/row_RF_sugerencia.html");
                    $row = str_replace("{gerencia}", $unico->gerencia, $row);
                    $row = str_replace("{nombrejefe}", $unico->nombrejefe, $row);
                    $row = str_replace("{numero_sugerencia}", $unico->numero_sugerencia, $row);
                    $row = str_replace("{tipo}", $unico->tipo, $row);
                    $row = str_replace("{tematica_select}", $unico->tematica_select, $row);
                    $row = str_replace("{tematica_texto}", $unico->tematica_texto, $row);
                    $row = str_replace("{tipo_accion}", $unico->tipo_accion, $row);
                    $row = str_replace("{descripcion_accion}", $unico->descripcion_accion, $row);
                    $row = str_replace("{participantes}", $unico->participantes, $row);
                    $row = str_replace("{prioritarios}", $unico->prioritarios, $row);
                    $row = str_replace("{importantes}", $unico->importantes, $row);
                }
                $PRINCIPAL = str_replace("{ROW_PLANES_ESPECIFICOS_RF}", utf8_encode($row), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function MuestraConsolidadoPorCargo($PRINCIPAL, $post)
            {
                $tipo = $post["tipo"];
                $nivel = $post["nivel"];
                $gerencia = $post["gerencia"];
                //Traigo el listado en base a las variables recibidas.
                $datos = DatosconsolidadoDnc($tipo, $nivel, $gerencia);
                $row = "";
                foreach ($datos as $unico) {
                    $row .= file_get_contents("views/dnc/row_fichacargo.html");
                    $row = str_replace("{CARGO}", $unico->cargo, $row);
                    $row = str_replace("{GERENCIA}", $unico->gerencia, $row);
                    $row = str_replace("{GERENCIA}", $unico->gerencia, $row);
                    $row = str_replace("{CODIGO}", $unico->codigo, $row);
                    $row = str_replace("{NIVEL}", $unico->nivel, $row);
                    $row = str_replace("{OBJETIVO}", $unico->objetivo_cargo, $row);
                    //Traigo las conductas dado el id del Cargo
                    $conductas = DatosconsolidadoConductasDadoIdCargo($unico->id_cargo);
                    $row_conductas = "";
                    $row_cursos = "";
                    $row_cursosP = "";
                    $row_cursosG = "";
                    $row_cursosT = "";
                    $cuenta = 0;
                    foreach ($conductas as $cond) {
                        $row_conductas .= file_get_contents("views/dnc/row_conducta.html");
                        $row_conductas = str_replace("{PRIORIZACION}", $cond->priorizacion, $row_conductas);
                        $row_conductas = str_replace("{TIPO}", $cond->gt, $row_conductas);
                        $row_conductas = str_replace("{DIMENSION}", $cond->dimension, $row_conductas);
                        //Por cada Dimension, traigo el curso asociado.}
                        $row_conductas = str_replace("{CONDUCTA}", $cond->conducta, $row_conductas);
                        $row_conductas = str_replace("{CONDUCTA_ESPERADA}", $cond->conducta_esperada, $row_conductas);
                    }
                    //Traigo los cursos PRIORITARIOS P
                    $datos_c = DatosconsolidadoCursosDadoAgrupadosP($unico->id_cargo);
                    $cuenta1 = 0;
                    foreach ($datos_c as $da) {
                        $row_cursosP .= file_get_contents("views/dnc/row_cursosP.html");
                        $cuenta1++;
                        $row_cursosP = str_replace("{CURSO}", $da->curso, $row_cursosP);
                        $row_cursosP = str_replace("{PRIORIZACION}", $cuenta1, $row_cursosP);
                        $row_cursosP = str_replace("{DIMENSION}", $da->dimension, $row_cursosP);
                        $row_cursosP = str_replace("{CONDUCTA_ESPERADA}", $da->conducta_esperada, $row_cursosP);
                        $agrupaciontem = "";
                        $datos_d = TematicasconsolidadoDadoCursosCargo($da->curso);
                        foreach ($datos_d as $dcc) {
                            $agrupaciontem .= $dcc->tematica . ". ";
                        }
                        $row_cursosP = str_replace("{TEMATICAS}", $agrupaciontem, $row_cursosP);
                        //$row_cursosG = str_replace("{TEMATICAS}","",$row_cursosG);
                    }
                    //Traigo los cursos dado el id del cargo. G
                    $datos_c = DatosconsolidadoCursosDadoAgrupadosG($unico->id_cargo);
                    $cuenta2 = 0;
                    foreach ($datos_c as $da) {
                        $row_cursosG .= file_get_contents("views/dnc/row_cursosG.html");
                        //Para cuando sea Con Distinct Dimension
                        //$row_cursos.=file_get_contents("views/dnc/row_cursos_s.html");
                        $cuenta2++;
                        $row_cursosG = str_replace("{CURSO}", $da->curso, $row_cursosG);
                        $row_cursosG = str_replace("{PRIORIZACION}", $cuenta2, $row_cursosG);
                        $row_cursosG = str_replace("{DIMENSION}", $da->dimension, $row_cursosG);
                        $row_cursosG = str_replace("{CONDUCTA_ESPERADA}", $da->conducta_esperada, $row_cursosG);
                        $agrupaciontem = "";
                        $datos_d = TematicasconsolidadoDadoCursosCargo($da->curso);
                        foreach ($datos_d as $dcc) {
                            $agrupaciontem .= $dcc->tematica . ". ";
                        }
                        $row_cursosG = str_replace("{TEMATICAS}", $agrupaciontem, $row_cursosG);
                        //$row_cursosG = str_replace("{TEMATICAS}","",$row_cursosG);
                    }
                    //Traigo los cursos dado el id del cargo. T
                    $datos_c = DatosconsolidadoCursosDadoAgrupadosT($unico->id_cargo);
                    $cuenta3 = 0;
                    foreach ($datos_c as $da) {
                        $row_cursosT .= file_get_contents("views/dnc/row_cursosT.html");
                        //Para cuando sea Con Distinct Dimension
                        //$row_cursos.=file_get_contents("views/dnc/row_cursos_s.html");
                        $cuenta3++;
                        $row_cursosT = str_replace("{CURSO}", $da->curso, $row_cursosT);
                        $row_cursosT = str_replace("{PRIORIZACION}", $cuenta3, $row_cursosT);
                        $row_cursosT = str_replace("{DIMENSION}", $da->dimension, $row_cursosT);
                        $row_cursosT = str_replace("{CONDUCTA_ESPERADA}", $da->conducta_esperada, $row_cursosT);
                        $agrupaciontem = "";
                        $datos_d = TematicasconsolidadoDadoCursosCargo($da->curso);
                        foreach ($datos_d as $dcc) {
                            $agrupaciontem .= $dcc->tematica . ". ";
                        }
                        $row_cursosT = str_replace("{TEMATICAS}", $agrupaciontem, $row_cursosT);
                    }
                    $row = str_replace("{ROWS_CONDUCTAS}", $row_conductas, $row);
                    $row = str_replace("{ROW_CURSOS}", $row_cursos, $row);
                    $row = str_replace("{ROW_CURSOSP}", $row_cursosP, $row);
                    $row = str_replace("{ROW_CURSOSG}", $row_cursosG, $row);
                    $row = str_replace("{ROW_CURSOST}", $row_cursosT, $row);
                    $row .= "<br><br>";
                }
                $PRINCIPAL = str_replace("{ROW_FICHAS}", utf8_encode($row), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function ListadoConsolidadoPorCurso($arreglo_post, $id_empresa)
            {
                /*if($arreglo_post["curso"]<>"-"){
        //Aca obtengo listado de todos los cursos, sin ningun
        $cursos=ObtenerTodosLosCursosDinamico($arreglo_post["curso"]);
    }else{
        //Aca obtengo listado de todos los cursos, sin ningun
        $cursos=ObtenerTodosLosCursos();
    }*/
                $cursos = ObtenerTodosLosCursos($arreglo_post);
                echo file_get_contents("views/reportes/consolidado_por_curso/entorno_consolidado_curso.html");
                foreach ($cursos as $cur) {
                    $row = file_get_contents("views/reportes/consolidado_por_curso/row_consolidado_curso.html");
                    $row = str_replace("{CURSO}", $cur->nombre, $row);
                    $row = str_replace("{PROGRAMA}", $cur->NombrePrograma, $row);
                    $row = str_replace("{OBJETOS}", $cur->total_objetos, $row);
                    //Por cada curso, obtengo el total de participantes
                    $participantes_por_curso = ObtenerUsuariosDadoCurso($cur->id, $arreglo_post);
                    $row = str_replace("{PARTICIPANTES}", $participantes_por_curso[0], $row);
                    $row = str_replace("{TOTAL_APROBADOS}", $participantes_por_curso[1], $row);
                    $row = str_replace("{TOTAL_REPROBADOS}", $participantes_por_curso[2], $row);
                    $row = str_replace("{TOTAL_ENPROCESO}", $participantes_por_curso[3], $row);
                    $row = str_replace("{TOTAL_NOINICIADOS}", $participantes_por_curso[4], $row);
                    //Aca obtengo el porcentaje de avance
                    $row = str_replace("{PORCENTAJE_AVANCE}", number_format((($participantes_por_curso[1] + $participantes_por_curso[2]) * 100) / $participantes_por_curso[0], 0), $row);
                    //Porcentaje de aprobacion
                    $row = str_replace("{PORCENTAJE_APROBACION}", number_format(($participantes_por_curso[1] * 100) / $participantes_por_curso[0], 0), $row);
                    //Nota Promedio
                    $row = str_replace("{PROMEDIO_NOTAS}", 0, $row);
                    echo utf8_encode($row);
                }
                echo file_get_contents("views/reportes/consolidado_por_curso/entorno_consolidado_curso_footer.html");
                $arreglo[0] = count($cursos);
                return ($arreglo);
            }

            function ListadoPersonasConsolidado($arreglo_post, $id_empresa)
            {
                //Traigo el total de personas
                $usuarios = TotalUsuarios($arreglo_post, $_SESSION["id_empresa"]);
                echo file_get_contents("views/reportes/consolidado_persona_curso/entorno_consolidado_persona.html");
                $i = 1;
                foreach ($usuarios as $usu) {
                    $filas = file_get_contents("views/reportes/consolidado_persona_curso/row_consolidado_persona.html");
                    $filas = str_replace("{NOMBRE}", $usu->nombre_completo, $filas);
                    $filas = str_replace("{RUT}", $usu->rut_completo, $filas);
                    $filas = str_replace("{N}", $i, $filas);
                    $i++;
                    $filas = str_replace("{UN}", $usu->unidad_negocio, $filas);
                    $filas = str_replace("{GERENCIA}", $usu->gerencia, $filas);
                    $filas = str_replace("{DATOS}", $usu->email . ", " . $usu->telefono, $filas);
                    $cursos_por_usuario = TotalCursosPorUsuario($usu->rut, $usu->id_cargo, $usu->id_empresa);
                    $filas = str_replace("{TOTAL_CURSOS}", $cursos_por_usuario[0], $filas);
                    $filas = str_replace("{TOTAL_APROBADOS}", $cursos_por_usuario[1], $filas);
                    $filas = str_replace("{TOTAL_REPROBADOS}", $cursos_por_usuario[2], $filas);
                    $filas = str_replace("{TOTAL_NOINICIADOS}", $cursos_por_usuario[3], $filas);
                    $filas = str_replace("{TOTAL_ENPROCESO}", $cursos_por_usuario[4], $filas);
                    $filas = str_replace("{PORCENTAJE_AVANCE}", number_format((($cursos_por_usuario[1] + $cursos_por_usuario[2]) * 100) / $cursos_por_usuario[0], 0), $filas);
                    $filas = str_replace("{PORCENTAJE_APROBACION}", number_format(($cursos_por_usuario[1] * 100) / $cursos_por_usuario[0], 0), $filas);
                    $nota_promedio_curso = PromedioDeEvaluacionesDadoCursoYRut($unico->id, $rut);
                    $aprobado_reprobado = ApruebaReprueba($nota_promedio_curso[0]->promedio_nota_curso);
                    $fila = str_replace("{PROMEDIO_NOTAS}", $nota_promedio_curso[0]->promedio_nota_curso, $fila);
                    //$filas = str_replace("{PROMEDIO_NOTAS}",$cursos_por_usuario[5],$filas);
                    echo utf8_encode($filas);
                }
                //$PRINCIPAL = str_replace("{ROWS_PERSONAS_CONSOLIDADO}",utf8_encode($filas),$PRINCIPAL);
                //return($PRINCIPAL);
                echo file_get_contents("views/reportes/consolidado_persona_curso/entorno_consolidado_persona_footer.html");
                $arreglo[0] = count($usuarios);
                return ($arreglo);
            }

            function VerificaFotoPersonalDesdeAdmin($rut)
            {
                $datos_usuario = UsuarioEnBasePersonas($rut, $rut);
                $rut_completo = $datos_usuario[0]->rut_completo;
                $ruta_admin = "img/personas/" . $rut;
                $ruta = "../sgd/front/img/personas/" . $rut;
                $ruta_rut_completo = "../fsgd/ront/img/personas/" . $rut_completo;
                if (file_exists($ruta_admin . ".jpg")) {
                    $imagen = $ruta_admin . ".jpg";
                } else if (file_exists($ruta_admin . ".JPG")) {
                    $imagen = $ruta_admin . ".JPG";
                } else if (file_exists($ruta_admin . ".gif")) {
                    $imagen = $ruta_admin . ".gif";
                } else if (file_exists($ruta . ".jpg")) {
                    $imagen = $ruta . ".jpg";
                } else if (file_exists($ruta . ".JPG")) {
                    $imagen = $ruta . ".JPG";
                } else if (file_exists($ruta . ".gif")) {
                    $imagen = $ruta . ".gif";
                } else if (file_exists($ruta_rut_completo . ".jpg")) {
                    $imagen = $ruta_rut_completo . ".jpg";
                } else if (file_exists($ruta_rut_completo . ".JPG")) {
                    $imagen = $ruta_rut_completo . ".JPG";
                } else if (file_exists($ruta_rut_completo . ".gif")) {
                    $imagen = $ruta_rut_completo . ".gif";
                } else {
                    $imagen = "../front/img/foto_perfil.jpg";
                }
                return ($imagen);
            }

            function ReporteAvanceEvaluador($arreglo_post, $excel, $id_empresa)
            {
                //Traigo el total de todos los evaluadores de a tabla tbl_sgd_relaciones
                //$usuarios=TotalUsuarios($arreglo_post);
                $evaluadores = ObtenerTotalDeEvaluadores($arreglo_post, $id_empresa);
                if ($excel == 1) {
                    echo file_get_contents("views/reportes_obj/evaluador/entorno_excel.html");
                    $row = file_get_contents("views/reportes_obj/evaluador/row_excel.html");
                } else {
                    echo file_get_contents("views/reportes_obj/evaluador/entorno.html");
                    $row = file_get_contents("views/reportes_obj/evaluador/row.html");
                }
                $i = 1;
                $area = "";
                $contador_area = 0;
                foreach ($evaluadores as $unico) {
                    $filas = $row;
                    $filas = str_replace("{NOMBRE}", $unico->nombre_completo, $filas);
                    $filas = str_replace("{RUT}", $unico->rut_evaluador, $filas);
                    $filas = str_replace("{N}", $i, $filas);
                    $filas = str_replace("{IMAGEN_PERSONA}", VerificaFotoPersonalDesdeAdmin($unico->rut_evaluador), $filas);
                    $filas = str_replace("{CARGO}", $unico->cargo, $filas);
                    $filas = str_replace("{GERENCIA}", $unico->gerencia, $filas);
                    $filas = str_replace("{AREA}", $unico->area, $filas);
                    $filas = str_replace("{DATOS}", $unico->email . ", " . $unico->telefono, $filas);
                    $filas = str_replace("{TOTAL_EVALUADOS}", $unico->total_evaluados, $filas);
                    $filas = str_replace("{TOTAL_CLAVES_CAMBIADAS}", ColocaEtiquetaReportesObjetivos($unico->total_claves_cambiadas, $unico->total_evaluados), $filas);
                    $filas = str_replace("{TOTAL_PROP_OBJ}", ColocaEtiquetaReportesObjetivos($unico->total_proposicion_finalizadas, $unico->total_evaluados), $filas);
                    $filas = str_replace("{TOTAL_FIJ_OBJ}", ColocaEtiquetaReportesObjetivos($unico->total_fijacion_finalizados, $unico->total_evaluados), $filas);
                    $filas = str_replace("{TOTAL_VAL_OBJ}", ColocaEtiquetaReportesObjetivos($unico->total_validacion_finalizados, $unico->total_evaluados), $filas);
                    $filas = str_replace("{TOTAL_FIN_EVAL_IN}", ColocaEtiquetaReportesObjetivos($unico->total_evaluaciones_finalizadas, $unico->total_evaluados), $filas);
                    //echo $unico->area."<br>";
                    if ($area <> $unico->area) {
                        $contador_area++;
                        $arreglo_areas[$contador_area][0] = $unico->area;
                        $area = $unico->area;
                    }
                    //Total de Evaluados
                    $arreglo_areas[$contador_area][1] = $arreglo_areas[$contador_area][1] + $unico->total_evaluados;
                    //Claves Cambiadas
                    $arreglo_areas[$contador_area][2] = $arreglo_areas[$contador_area][2] + $unico->total_claves_cambiadas;
                    //Proposiciones de Objetivos
                    $arreglo_areas[$contador_area][3] = $arreglo_areas[$contador_area][3] + $unico->total_proposicion_finalizadas;
                    //Fijaciones de Objetivo
                    $arreglo_areas[$contador_area][4] = $arreglo_areas[$contador_area][4] + $unico->total_fijacion_finalizados;
                    //Total de Validaciones
                    $arreglo_areas[$contador_area][5] = $arreglo_areas[$contador_area][5] + $unico->total_validacion_finalizados;
                    //Total de Evaluadores
                    $arreglo_areas[$contador_area][6]++;
                    //Total de Evaluaciones Intermadias Finalizadas
                    $arreglo_areas[$contador_area][7] = $arreglo_areas[$contador_area][7] + $unico->total_evaluaciones_finalizadas;
                    $i++;
                    $total_evaluados = $total_evaluados + $unico->total_evaluados;
                    $total_claves_cambiadas = $total_claves_cambiadas + $unico->total_claves_cambiadas;
                    $total_propuestas_objetivos = $total_propuestas_objetivos + $unico->total_proposicion_finalizadas;
                    $total_fijacion_objetivos = $total_fijacion_objetivos + $unico->total_fijacion_finalizados;
                    $total_validaciones = $total_validaciones + $unico->total_validacion_finalizados;
                    //$total_validaciones=$total_validaciones+$unico->total_validacion_finalizados;
                    $total_evaluaciones_intermedias = $total_evaluaciones_intermedias + $unico->total_evaluaciones_finalizadas;
                    if ($excel == 1) {
                        echo $filas;
                    } else {
                        echo utf8_encode($filas);
                    }
                }
                //$PRINCIPAL = str_replace("{ROWS_PERSONAS_CONSOLIDADO}",utf8_encode($filas),$PRINCIPAL);
                //return($PRINCIPAL);
                if ($excel <> 1) {
                    echo file_get_contents("views/reportes/consolidado_persona_curso/entorno_consolidado_persona_footer.html");
                }
                //Total Usuarios
                $arreglo[0] = count($evaluadores);
                //total de Evaluados
                $arreglo[1] = $total_evaluados;
                //Total claves cambiadas
                $arreglo[2] = $total_claves_cambiadas;
                //Total propuestas
                $arreglo[3] = $total_propuestas_objetivos;
                //total Fijacion Objetivos
                $arreglo[4] = $total_fijacion_objetivos;
                //total de Validaciones
                $arreglo[5] = $total_validaciones;
                //Arreglo con Areas
                $array_para_enviar_via_url = serialize($arreglo_areas);
                $array_para_enviar_via_url = urlencode($array_para_enviar_via_url);
                $arreglo[6] = $array_para_enviar_via_url;
                //Total evaluacioes intemedias finalizadas
                $arreglo[7] = $total_evaluaciones_intermedias;
                return ($arreglo);
            }

            function SabanaPorObjetivosIndividuales($arreglo_post, $excel)
            {
                //Traigo el total de todos los evaluadores de a tabla tbl_sgd_relaciones
                //$usuarios=TotalUsuarios($arreglo_post);
                //$evaluadores=ObtenerTotalDetalleEvaluadoEvaluador($arreglo_post);
                $evaluadores = TotalObjetivosIndividuales($arreglo_post);
                if ($excel == "1") {
                    $row = file_get_contents("views/reportes_obj/sabana_objetivos/row_excel.html");
                    echo file_get_contents("views/reportes_obj/sabana_objetivos/entorno_excel.html");
                } else {
                    echo file_get_contents("views/reportes_obj/sabana_objetivos/entorno.html");
                    $row = file_get_contents("views/reportes_obj/sabana_objetivos/row.html");
                }
                $i = 1;
                foreach ($evaluadores as $unico) {
                    $filas = $row;
                    $filas = str_replace("{NOMBRE}", $unico->nombre_completo, $filas);
                    $filas = str_replace("{RUT}", $unico->rut_completo_evaluado, $filas);
                    $filas = str_replace("{N}", $i, $filas);
                    $i++;
                    $filas = str_replace("{IMAGEN_PERSONA}", VerificaFotoPersonalDesdeAdmin($unico->evaluado), $filas);
                    $filas = str_replace("{CARGO}", $unico->cargo, $filas);
                    $filas = str_replace("{GERENCIA}", $unico->gerencia, $filas);
                    $filas = str_replace("{DIMENSION}", $unico->nombre_dimension, $filas);
                    $filas = str_replace("{PONDERACION}", $unico->ponderacion, $filas);
                    $filas = str_replace("{OBJETIVO_DESCR}", $unico->descripcion_objetivo, $filas);
                    $filas = str_replace("{METRICA}", $unico->metrica, $filas);
                    $filas = str_replace("{MES}", $unico->mes, $filas);
                    $filas = str_replace("{AGNO}", $unico->ano, $filas);
                    $filas = str_replace("{IMAGEN_PERSONA_EVALUADOR}", VerificaFotoPersonalDesdeAdmin($unico->rut_evaluador), $filas);
                    $filas = str_replace("{RUT_EVALUADOR}", $unico->rut_completo_evaluador, $filas);
                    $filas = str_replace("{NOMBRE_EVALUADOR}", $unico->nombre_evaluador, $filas);
                    $filas = str_replace("{CARGO_EVALUADOR}", $unico->cargo_evaluador, $filas);
                    $filas = str_replace("{GERENCIA_EVALUADOR}", $unico->gerencia_evaluador, $filas);
                    $filas = str_replace("{IMAGEN_PERSONA_VALIDADOR}", VerificaFotoPersonalDesdeAdmin($unico->rut_validador), $filas);
                    $filas = str_replace("{RUT_VALIDADOR}", $unico->rut_completo_validador, $filas);
                    $filas = str_replace("{NOMBRE_VALIDADOR}", $unico->nombre_validador, $filas);
                    $filas = str_replace("{CARGO_VALIDADOR}", $unico->cargo_validador, $filas);
                    $filas = str_replace("{GERENCIA_VALIDADOR}", $unico->gerencia_validador, $filas);
                    $filas = str_replace("{AREA}", $unico->area, $filas);
                    $filas = str_replace("{DATOS}", $unico->email . ", " . $unico->telefono, $filas);
                    $filas = str_replace("{TOTAL_EVALUADOS}", $unico->total_evaluados, $filas);
                    $filas = str_replace("{TOTAL_CLAVES_CAMBIADAS}", ColocaEtiquetaReportesObjetivos($unico->total_claves_cambiadas, $unico->total_evaluados), $filas);
                    $filas = str_replace("{TOTAL_PROP_OBJ}", ColocaEtiquetaReportesObjetivos($unico->total_proposicion_finalizadas, $unico->total_evaluados), $filas);
                    $filas = str_replace("{TOTAL_FIJ_OBJ}", ColocaEtiquetaReportesObjetivos($unico->total_fijacion_finalizados, $unico->total_evaluados), $filas);
                    $filas = str_replace("{TOTAL_VAL_OBJ}", ColocaEtiquetaReportesObjetivos($unico->total_validacion_finalizados, $unico->total_evaluados), $filas);
                    if ($excel == "1") {
                        echo($filas);
                    } else {
                        echo utf8_encode($filas);
                    }
                }
            }

            function ReporteAvanceDetalleEvaluadoEvaluador($arreglo_post, $excel, $muestra, $id_empresa)
            {
                //Traigo el total de todos los evaluadores de a tabla tbl_sgd_relaciones
                //$usuarios=TotalUsuarios($arreglo_post);
                $evaluadores = ObtenerTotalDetalleEvaluadoEvaluador($arreglo_post, $id_empresa);
                if ($muestra == "si") {
                    if ($excel == 1) {
                        echo file_get_contents("views/reportes_obj/evaluado_evaluador/entorno_excel.html");
                        $row = file_get_contents("views/reportes_obj/evaluado_evaluador/row_excel.html");
                    } else {
                        echo file_get_contents("views/reportes_obj/evaluado_evaluador/entorno.html");
                        $row = file_get_contents("views/reportes_obj/evaluado_evaluador/row.html");
                    }
                }
                $i = 1;
                $area = "";
                $contador_area = 0;
                foreach ($evaluadores as $unico) {
                    $filas = $row;
                    $filas = str_replace("{NOMBRE}", $unico->nombre_completo, $filas);
                    $filas = str_replace("{RUT}", $unico->rut_completo_evaluado, $filas);
                    $filas = str_replace("{N}", $i, $filas);
                    $filas = str_replace("{IMAGEN_PERSONA}", VerificaFotoPersonalDesdeAdmin($unico->rut_evaluado), $filas);
                    $filas = str_replace("{CARGO}", $unico->cargo, $filas);
                    $filas = str_replace("{GERENCIA}", $unico->gerencia, $filas);
                    $filas = str_replace("{IMAGEN_PERSONA_EVALUADOR}", VerificaFotoPersonalDesdeAdmin($unico->rut_evaluador), $filas);
                    $filas = str_replace("{RUT_EVALUADOR}", $unico->rut_completo_evaluador, $filas);
                    $filas = str_replace("{NOMBRE_EVALUADOR}", $unico->nombre_evaluador, $filas);
                    $filas = str_replace("{CARGO_EVALUADOR}", $unico->cargo_evaluador, $filas);
                    $filas = str_replace("{GERENCIA_EVALUADOR}", $unico->gerencia_evaluador, $filas);
                    $filas = str_replace("{IMAGEN_PERSONA_VALIDADOR}", VerificaFotoPersonalDesdeAdmin($unico->rut_validador), $filas);
                    $filas = str_replace("{RUT_VALIDADOR}", $unico->rut_completo_validador, $filas);
                    $filas = str_replace("{NOMBRE_VALIDADOR}", $unico->nombre_validador, $filas);
                    $filas = str_replace("{CARGO_VALIDADOR}", $unico->cargo_validador, $filas);
                    $filas = str_replace("{GERENCIA_VALIDADOR}", $unico->gerencia_validador, $filas);
                    $filas = str_replace("{AREA}", $unico->area, $filas);
                    $filas = str_replace("{DATOS}", $unico->email . ", " . $unico->telefono, $filas);
                    $filas = str_replace("{TOTAL_EVALUADOS}", $unico->total_evaluados, $filas);
                    $filas = str_replace("{TOTAL_CLAVES_CAMBIADAS}", ColocaEtiquetaReportesObjetivos($unico->total_claves_cambiadas, $unico->total_evaluados), $filas);
                    $filas = str_replace("{TOTAL_PROP_OBJ}", ColocaEtiquetaReportesObjetivos($unico->total_proposicion_finalizadas, $unico->total_evaluados), $filas);
                    $filas = str_replace("{TOTAL_FIJ_OBJ}", ColocaEtiquetaReportesObjetivos($unico->total_fijacion_finalizados, $unico->total_evaluados), $filas);
                    $filas = str_replace("{TOTAL_VAL_OBJ}", ColocaEtiquetaReportesObjetivos($unico->total_validacion_finalizados, $unico->total_evaluados), $filas);
                    $filas = str_replace("{TOTAL_FIN_OBJ}", ColocaEtiquetaReportesObjetivos($unico->total_finalizacion_objetivos, $unico->total_evaluados), $filas);
                    $filas = str_replace("{TOTAL_REV_IN}", ColocaEtiquetaReportesObjetivos($unico->total_fin_rev_inte, $unico->total_evaluados), $filas);
                    //echo $unico->area."<br>";
                    if ($area <> $unico->area) {
                        $contador_area++;
                        $arreglo_areas[$contador_area][0] = $unico->area;
                        $area = $unico->area;
                    }
                    //Total de Evaluados
                    $arreglo_areas[$contador_area][1] = $arreglo_areas[$contador_area][1] + $unico->total_evaluados;
                    //Claves Cambiadas
                    $arreglo_areas[$contador_area][2] = $arreglo_areas[$contador_area][2] + $unico->total_claves_cambiadas;
                    //Proposiciones de Objetivos
                    $arreglo_areas[$contador_area][3] = $arreglo_areas[$contador_area][3] + $unico->total_proposicion_finalizadas;
                    //Fijaciones de Objetivo
                    $arreglo_areas[$contador_area][4] = $arreglo_areas[$contador_area][4] + $unico->total_fijacion_finalizados;
                    //Total de Validaciones
                    $arreglo_areas[$contador_area][5] = $arreglo_areas[$contador_area][5] + $unico->total_validacion_finalizados;
                    //Total de Evaluadores
                    $arreglo_areas[$contador_area][6]++;
                    //Total de Feedbacks Evaluados Finalizacion Objetivos
                    $arreglo_areas[$contador_area][7] = $arreglo_areas[$contador_area][7] + $unico->total_finalizacion_objetivos;
                    //Total de Finalizados Evaluacion Intermedia
                    $arreglo_areas[$contador_area][8] = $arreglo_areas[$contador_area][8] + $unico->total_fin_rev_inte;
                    $i++;
                    $total_claves_cambiadas = $total_claves_cambiadas + $unico->total_claves_cambiadas;
                    $total_proposicion_finalizada = $total_proposicion_finalizada + $unico->total_proposicion_finalizadas;
                    $total_fijacion_finalizada = $total_fijacion_finalizada + $unico->total_fijacion_finalizados;
                    $total_validacion_finalizada = $total_validacion_finalizada + $unico->total_validacion_finalizados;
                    $total_fin_feedback_objetivos = $total_fin_feedback_objetivos + $unico->total_finalizacion_objetivos;
                    $total_fin_eval = $total_fin_eval + $unico->total_fin_rev_inte;
                    if ($muestra == "si") {
                        if ($excel == "1") {
                            echo($filas);
                        } else {
                            echo utf8_encode($filas);
                        }
                    }
                }
                //**LOS SIGUIENTES DATOS SON PARA MOSTRAR EN LA TABLA SUPERIOR, SECCION DATOS GENERALES
                //total de Evaluados
                $arreglo[0] = count($evaluadores);
                //total claves finalizdas
                $arreglo[1] = $total_claves_cambiadas;
                //Total de Proposiciones
                $arreglo[2] = $total_proposicion_finalizada;
                //Total de fijaciones
                $arreglo[3] = $total_fijacion_finalizada;
                //Total de Validaciones
                $arreglo[4] = $total_validacion_finalizada;
                //Arreglo con Areas
                $array_para_enviar_via_url = serialize($arreglo_areas);
                $array_para_enviar_via_url = urlencode($array_para_enviar_via_url);
                $arreglo[5] = $array_para_enviar_via_url;
                //Total de Finalizados Feedback
                $arreglo[6] = $total_fin_feedback_objetivos;
                //total Fin Eval
                $arreglo[7] = $total_fin_eval;
                return ($arreglo);
            }

            function ListadoProgramasReporteAdmin($PRINCIPAL)
            {
                $programas = TodosLosPrograma();
                foreach ($programas as $pro) {
                    $filas .= file_get_contents("views/reportes/row_consolidado_programa.html");
                }
                $PRINCIPAL = str_replace("{ROWS_PROGRAMAS}", $filas, $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function ApruebaRepruebaBORRADO_POR_DUPLICIDAD_AL_UNIFICAR_EL_FUNCTION($nota)
            {
                if ($nota >= 80) {
                    $arreglo[0] = "aprobado";
                    $arreglo[1] = "aprobado_informe.png";
                    $arreglo[2] = "si";
                    $arreglo[3] = "badge bg-green";
                    return ($arreglo);
                } else {
                    $arreglo[0] = "reprobado";
                    $arreglo[1] = "reprobado_informe.png";
                    $arreglo[2] = "no";
                    $arreglo[3] = "badge bg-red";
                    return ($arreglo);
                }
            }

            function ListadoReporteDetalleUsuariosPorCurso($arreglo_post, $id_empresa, $excel)
            {
                //Traigo el total de usuarios
                echo file_get_contents("views/reportes/detalle_persona_curso/entorno_detalle_usuario_por_curso.html");
                $usuarios = TodosLosUsuariosParaReporte($arreglo_post, $id_empresa);
                $row = "";
                $i = 1;
                $aprobados = 0;
                $reprobados = 0;
                $noiniciado = 0;
                $total = 0;
                if ($excel == 1) {
                    $row_fila = file_get_contents("views/reportes/detalle_persona_curso/row_reporte_excel.html");
                } else {
                    $row_fila = file_get_contents("views/reportes/detalle_persona_curso/row_reporte.html");
                }
                foreach ($usuarios as $unico) {
                    $row = $row_fila;
                    $row = str_replace("{RUT_ENCODEADO}", Encodear3($unico->rut), $row);
                    $row = str_replace("{RUT}", $unico->rut_completo, $row);
                    $row = str_replace("{N}", $i, $row);
                    $i++;
                    $row = str_replace("{NOMBRE_CURSO}", $unico->nombre_curso, $row);
                    $row = str_replace("{ID_CURSO_ENCODEADO}", Encodear3($unico->id_curso), $row);
                    $row = str_replace("{NOMBRE_PROGRAMA}", $unico->nombre_programa, $row);
                    $row = str_replace("{FOTO_PERSONA}", "img/profile.png", $row);
                    $row = str_replace("{NOMBRE}", $unico->nombre_completo, $row);
                    $row = str_replace("{GERENCIA}", $unico->gerencia, $row);
                    $row = str_replace("{UN}", $unico->unidad_negocio, $row);
                    $row = str_replace("{DATOS}", $unico->email . ", " . $unico->telefono, $row);
                    $row = str_replace("{CARGO}", $unico->cargo, $row);
                    $porcentaje_avance_curso = PorcentajeAvanceCurso($unico->id_curso, $unico->rut);
                    $row = str_replace("{PORCENTAJE_AVANCE}", $porcentaje_avance_curso[1], $row);
                    $row = str_replace("{PORCENTAJE_NOTA}", number_format($porcentaje_avance_curso[3], 0), $row);
                    $aprueba_reprueba = ApruebaReprueba($porcentaje_avance_curso[3]);
                    if ($aprueba_reprueba[5] == "2") {
                        $aprobado++;
                    } else if ($aprueba_reprueba[5] == "1") {
                        $reprobado++;
                    } else if ($aprueba_reprueba[5] == "3") {
                        $noiniciado++;
                    }
                    $total++;
                    if ($excel == 1) {
                        echo($row);
                    } else {
                        echo utf8_encode($row);
                    }
                }
                if ($excel <> 1) {
                    echo file_get_contents("views/reportes/detalle_persona_curso/entorno_detalle_usuario_por_curso_footer.html");
                }
                $arreglo[0] = $aprobado;
                $arreglo[1] = $reprobado;
                //total usuarios
                $arreglo[2] = $total;
                //no iniciados
                $arreglo[3] = $noiniciado;
                return ($arreglo);
            }

            function ListadoReporteDetalleUsuariosPorModulo($arreglo_post, $id_empresa, $rut, $id_curso, $excel)
            {
                //Traigo el total de usuarios
                if ($excel == 1) {
                    echo file_get_contents("views/reportes/detalle_persona_modulo/entorno_detalle_excel.html");
                } else {
                    echo file_get_contents("views/reportes/detalle_persona_modulo/entorno_detalle.html");
                }
                $usuarios = TodosLosUsuariosParaReporteDetallePorModulo($arreglo_post, $id_empresa, $rut, $id_curso);
                $row = "";
                $i = 1;
                $aprobados = 0;
                $reprobados = 0;
                $noiniciado = 0;
                $total = 0;
                if ($excel == 1) {
                    $row_fila = file_get_contents("views/reportes/detalle_persona_modulo/row_reporte_excel.html");
                } else {
                    $row_fila = file_get_contents("views/reportes/detalle_persona_modulo/row_reporte.html");
                }
                foreach ($usuarios as $unico) {
                    $row = $row_fila;
                    $row = str_replace("{RUT}", $unico->rut_completo, $row);
                    $row = str_replace("{N}", $i, $row);
                    $i++;
                    $row = str_replace("{NOMBRE_MODULO}", $unico->nombre_modulo, $row);
                    $row = str_replace("{NOMBRE_CURSO}", $unico->nombre_curso, $row);
                    $row = str_replace("{NOMBRE_PROGRAMA}", $unico->nombre_programa, $row);
                    $row = str_replace("{FOTO_PERSONA}", "img/profile.png", $row);
                    $row = str_replace("{NOMBRE}", $unico->nombre_completo, $row);
                    $row = str_replace("{GERENCIA}", $unico->gerencia, $row);
                    $row = str_replace("{UN}", $unico->unidad_negocio, $row);
                    $row = str_replace("{DATOS}", $unico->email . ", " . $unico->telefono, $row);
                    $navegacion = SumaNavegacionesDadoRutYObjeto($unico->rut, $unico->id_objeto, $unico->id_curso);
                    $row = str_replace("{TIEMPO_NAVEGACION}", $navegacion[0]->total_tiempo, $row);
                    $row = str_replace("{CARGO}", $unico->cargo, $row);
                    $porcentaje_avance_curso = PorcentajeAvanceCurso($unico->id_curso, $unico->rut);
                    if ($unico->fecha_finalizado) {
                        $row = str_replace("{PORCENTAJE_AVANCE}", "100", $row);
                    } else {
                        $row = str_replace("{PORCENTAJE_AVANCE}", "0", $row);
                    }
                    //$row = str_replace("{PORCENTAJE_NOTA}",number_format($porcentaje_avance_curso[3], 0),$row);
                    /*$aprueba_reprueba=ApruebaReprueba($porcentaje_avance_curso[3]);
        if($aprueba_reprueba[5]=="2"){
            $aprobado++;
        }else if ($aprueba_reprueba[5]=="1"){
            $reprobado++;
        }else if($aprueba_reprueba[5]=="3"){
            $noiniciado++;
        }
         *
         * */
                    $total++;
                    echo utf8_encode($row);
                }
                echo file_get_contents("views/reportes/detalle_persona_curso/entorno_detalle_usuario_por_curso_footer.html");
                $arreglo[0] = $aprobado;
                $arreglo[1] = $reprobado;
                //total usuarios
                $arreglo[2] = $total;
                //no iniciados
                $arreglo[3] = $noiniciado;
                return ($arreglo);
            }

            function FiltrosReportes($PRINCIPAL, $arreglo_post, $id_empresa)
            {
                //Tipo de Reportes
                $PRINCIPAL = str_replace("{OPTIONS_TIPO_REPORTES}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_reportes", $arreglo_post["tipo_reporte"], "nombre", "id", "order by nombre desc", $id_empresa), $PRINCIPAL);
                //$PRINCIPAL = str_replace("{OPTIONS_MALLAS}",OptionsGenericoNombre("tbl_malla", $arreglo_post["malla"]),$PRINCIPAL);
                //$PRINCIPAL = str_replace("{OPTIONS_MALLAS}",OptionsGenericoNombrePorEmpresa("tbl_malla", $arreglo_post["malla"], $id_empresa),$PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_MALLAS}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_malla", $arreglo_post["malla"], "nombre", "id", "order by nombre desc", $id_empresa), $PRINCIPAL);
                //$PRINCIPAL = str_replace("{OPTIONS_PROGRAMAS}",OptionsGenericoNombre("tbl_programa", $arreglo_post["programa"]),$PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_PROGRAMAS}", OptionsProgramaPorEmpresa($arreglo_post["programa"], $id_empresa), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_CURSOS}", OptionsGenericoNombrePorEmpresa("tbl_curso", $arreglo_post["curso"], $id_empresa), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_CURSOS2}", OptionsGenericoNombrePorEmpresa("tbl_curso", $arreglo_post["filtro_curso"], $id_empresa), $PRINCIPAL);
                //---------UNIDAD DE NEGOCIO
                //$PRINCIPAL = str_replace("{OPTIONS_UN}",OptionsGenerico("unidad_negocio", "tbl_usuario", $arreglo_post["un"]),$PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_UN}", OptionsGenericoPorEmpresa("unidad_negocio", "tbl_usuario", $arreglo_post["un"], $id_empresa), $PRINCIPAL);
                //---------GERENCIA
                //$PRINCIPAL = str_replace("{OPTIONS_GERENCIAS}",OptionsGenerico("gerencia", "tbl_usuario", $arreglo_post["gerencia"]),$PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_GERENCIAS}", OptionsGenericoPorEmpresa("gerencia", "tbl_usuario", $arreglo_post["gerencia"], $id_empresa), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_COMUNAS}", OptionsGenericoPorEmpresa("comuna", "tbl_usuario", $arreglo_post["comuna"], $id_empresa), $PRINCIPAL);
                //---------AREA
                //$PRINCIPAL = str_replace("{OPTIONS_AREAS}",OptionsGenerico("area", "tbl_usuario", $arreglo_post["area"]),$PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_AREAS}", OptionsGenericoPorEmpresa("area", "tbl_usuario", $arreglo_post["area"], $id_empresa), $PRINCIPAL);
                //CENTRO DE COSTO
                $PRINCIPAL = str_replace("{OPTIONS_CENTRO_COSTO}", OptionsGenericoPorEmpresa("centro_costo", "tbl_usuario", $arreglo_post["area"], $id_empresa), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTION_TIPOS}", OptionsGenerico("gt", "tbl_dnc_base_consolidado"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTION_NIVEL}", OptionsGenerico("nivel", "tbl_dnc_base_consolidado"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTION_GERENCIA}", OptionsGenerico("gerencia", "tbl_dnc_base_consolidado"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUEESTADO" . $arreglo_post["filtro_estado"] . "}", "selected", $PRINCIPAL);
                $PRINCIPAL = str_replace("{RANGO_FECHAS}", $arreglo_post["daterange-btn"], $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function FiltrosReportesAvancesSgd($PRINCIPAL, $arreglo_post, $id_empresa)
            {
                //---------UNIDAD DE NEGOCIO
                //$PRINCIPAL = str_replace("{OPTIONS_UN}",OptionsGenerico("unidad_negocio", "tbl_usuario", $arreglo_post["un"]),$PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_UN}", OptionsGenericoPorEmpresa("unidad_negocio", "tbl_usuario", $arreglo_post["un"], $_SESSION["id_empresa"]), $PRINCIPAL);
                //---------GERENCIA
                //$PRINCIPAL = str_replace("{OPTIONS_GERENCIAS}",OptionsGenerico("gerencia", "tbl_usuario", $arreglo_post["gerencia"]),$PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_GERENCIAS}", OptionsGenericoPorEmpresa("gerencia", "tbl_usuario", $arreglo_post["gerencia"], $_SESSION["id_empresa"]), $PRINCIPAL);
                //---------AREA
                //$PRINCIPAL = str_replace("{OPTIONS_AREAS}",OptionsGenerico("area", "tbl_usuario", $arreglo_post["area"]),$PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_AREAS}", OptionsGenericoPorEmpresa("area", "tbl_usuario", $arreglo_post["area"], $_SESSION["id_empresa"]), $PRINCIPAL);
                //---------SELECT DE TIPO DE REPORTE
                if ($arreglo_post["tipo_reporte"] == 1) {
                    $PRINCIPAL = str_replace("{VALUE1}", "selected", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VALUE2}", "", $PRINCIPAL);
                } else if ($arreglo_post["tipo_reporte"] == 2) {
                    $PRINCIPAL = str_replace("{VALUE2}", "selected", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VALUE1}", "", $PRINCIPAL);
                } else if ($arreglo_post["tipo_reporte"] == "total") {
                    $PRINCIPAL = str_replace("{SELECTEDTOTAL}", "selected", $PRINCIPAL);
                } else if ($arreglo_post["tipo_reporte"] == "corporativas") {
                    $PRINCIPAL = str_replace("{SELECTEDCORPORATIVAS}", "selected", $PRINCIPAL);
                } else if ($arreglo_post["tipo_reporte"] == "areas") {
                    $PRINCIPAL = str_replace("{SELECTEDAREAS}", "selected", $PRINCIPAL);
                } else if ($arreglo_post["tipo_reporte"] == "individuales") {
                    $PRINCIPAL = str_replace("{SELECTEDINDIVIDUALES}", "selected", $PRINCIPAL);
                } else if ($arreglo_post["tipo_reporte"] == "competencias") {
                    $PRINCIPAL = str_replace("{SELECTEDCOMPETENCIAS}", "selected", $PRINCIPAL);
                }
                //Filtro de los 3 campos de empresa
                $datos_empresa = DatosEmpresa($id_empresa);
                if ($arreglo_post["filtro1"] == $datos_empresa[0]->campo1) {
                    $filtro123 = "<option selected value='" . $datos_empresa[0]->campo1 . "'>" . $datos_empresa[0]->campo1 . "</option>";
                } else {
                    $filtro123 = "<option value='" . $datos_empresa[0]->campo1 . "'>" . $datos_empresa[0]->campo1 . "</option>";
                }
                if ($arreglo_post["filtro1"] == $datos_empresa[0]->campo2) {
                    $filtro123 .= "<option value='" . $datos_empresa[0]->campo2 . "' selected>" . $datos_empresa[0]->campo2 . "</option>";
                } else {
                    $filtro123 .= "<option value='" . $datos_empresa[0]->campo2 . "'>" . $datos_empresa[0]->campo2 . "</option>";
                }
                if ($arreglo_post["filtro1"] == $datos_empresa[0]->campo3) {
                    $filtro123 .= "<option selected value='" . $datos_empresa[0]->campo3 . "'>" . $datos_empresa[0]->campo3 . "</option>";
                } else {
                    $filtro123 .= "<option value='" . $datos_empresa[0]->campo3 . "'>" . $datos_empresa[0]->campo3 . "</option>";
                }
                $PRINCIPAL = str_replace("{COMBOBOX_CAMPOS123}", $filtro123, $PRINCIPAL);
                $PRINCIPAL = str_replace("{COMBOBOX_CAMPO1}", OptionsGenericoPorEmpresa($datos_empresa[0]->campo1, "tbl_usuario", "", $_SESSION["id_empresa"]), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function Multifiltro($PRINCIPAL)
            {
                $PRINCIPAL = str_replace("{OPCIONES_EMPRESA}", OptionsGenerico("negocio", "tbl_usuario"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPCIONES_ZONA}", OptionsGenerico("zona", "tbl_usuario"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPCIONES_GERENCIA}", OptionsGenerico("gerencia", "tbl_usuario"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPCIONES_AREA}", OptionsGenerico("area", "tbl_usuario"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPCIONES_LOCAL}", OptionsGenerico("local", "tbl_usuario"), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function ListadoObjetivosPorCargo($PRINCIPAL, $jefe, $cargo)
            {
                $datos_jefe = DatosTablaUsuario($jefe);
                $PRINCIPAL = str_replace("{RUT}", $jefe, $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOMBRE}", utf8_encode($datos_jefe[0]->nombre_completo), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CARGO}", utf8_encode($datos_jefe[0]->cargo), $PRINCIPAL);
                $PRINCIPAL = str_replace("{GERENCIA}", utf8_encode($datos_jefe[0]->gerencia), $PRINCIPAL);
                $PRINCIPAL = str_replace("{EMAIL}", utf8_encode($datos_jefe[0]->email), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CARGO_OBJETIVO}", utf8_encode($cargo), $PRINCIPAL);
                $PRINCIPAL = str_replace("{JEFE_ENCODEADO}", Encodear3($jefe), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CARGO_ENCODEADO}", Encodear3($cargo), $PRINCIPAL);
                $objetivos = TraeObjetivosDadoCargoYJefe($jefe, $cargo);
                foreach ($objetivos as $obj) {
                    $row .= file_get_contents("views/dnc/row_detalle_objetivos.html");
                    $row = str_replace("{OBJETVO}", $obj->objetivo, $row);
                    $row = str_replace("{CONDUCTA1}", $obj->conducta1, $row);
                    $row = str_replace("{CONDUCTA2}", $obj->conducta2, $row);
                    $row = str_replace("{CONDUCTA3}", $obj->conducta3, $row);
                    $row = str_replace("{ID}", $obj->id, $row);
                }
                $PRINCIPAL = str_replace("{CARGO}", utf8_encode($datos_jefe[0]->cargo), $PRINCIPAL);
                $PRINCIPAL = str_replace("{LISTADO_OBJETIVOS_POR_CARGO}", utf8_encode($row), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_OBJETIVOS}", count($objetivos), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function ListadoCargosPorJefeBORRADO_POR_DUPLICIDAD_AL_UNIFICAR_EL_FUNCTION($PRINCIPAL, $jefe)
            {
                $datos_jefe = DatosTablaUsuario($jefe);
                $PRINCIPAL = str_replace("{RUT}", $jefe, $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOMBRE}", utf8_encode($datos_jefe[0]->nombre_completo), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CARGO}", utf8_encode($datos_jefe[0]->cargo), $PRINCIPAL);
                $PRINCIPAL = str_replace("{GERENCIA}", utf8_encode($datos_jefe[0]->gerencia), $PRINCIPAL);
                $PRINCIPAL = str_replace("{EMAIL}", utf8_encode($datos_jefe[0]->email), $PRINCIPAL);
                $cargos = ListadoCargosDistinct($jefe);
                foreach ($cargos as $c) {
                    $row .= file_get_contents("views/dnc/row_detalle_cargos.html");
                    $row = str_replace("{CARGO}", $c->cargo, $row);
                    $row = str_replace("{CARGO_ENCODEADO}", Encodear3($c->cargo), $row);
                    $row = str_replace("{RUT_JEFE_ENCODEADO}", Encodear3($jefe), $row);
                    $row = str_replace("{CANTIDAD_COLABORADORES}", $c->numero_colaboradores, $row);
                    $estado = VerificaDNCFinalizado($jefe, $c->cargo);
                    if ($estado) {
                        $row = str_replace("{ESTADO}", "Terminado", $row);
                        $row = str_replace("{COLOR}", "green", $row);
                    } else {
                        $row = str_replace("{ESTADO}", "Pendiente", $row);
                        $row = str_replace("{COLOR}", "red", $row);
                    }
                }
                $PRINCIPAL = str_replace("{LISTADO_CARGOS_POR_JEFE}", $row, $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function PorcentajeAvanceIngresoObjetivosPorJefeBORRADO_POR_DUPLICIDAD_AL_UNIFICAR_EL_FUNCTION($rut)
            {
                $total_cargos = count(ListadoCargosDistinct($rut));
                $total_finalizados = count(ListadoCargosFinalizadosPorJefe($rut));
                $porcentaje = ($total_finalizados * 100) / $total_cargos;
                $arreglo[0] = $total_cargos;
                $arreglo[1] = $total_finalizados;
                $arreglo[2] = number_format($porcentaje, 0);
                return ($arreglo);
            }

            function ListadoJefatura($PRINCIPAL, $POST)
            {
                //Obtengo el listado de las jefaturas
                $jefes = ListadoJefes($POST);
                foreach ($jefes as $jef) {
                    $row .= file_get_contents("views/dnc/row_jefaturas.html");
                    $row = str_replace("{RUT_JEFATURA}", $jef->jefe, $row);
                    $datos_usuario = DatosTablaUsuario($jef->jefe);
                    $row = str_replace("{NOMBRE_JEFATURA}", $datos_usuario[0]->nombre_completo, $row);
                    $row = str_replace("{RUT_JEFATURA}", $jef->jefe, $row);
                    $row = str_replace("{RUT_JEFATURA}", $jef->jefe, $row);
                    $porcentaje = PorcentajeAvanceIngresoObjetivosPorJefe($jef->jefe);
                    $row = str_replace("{TOTAL_CARGOS}", $porcentaje[0], $row);
                    $row = str_replace("{TOTAL_FINALIZADOS}", $porcentaje[1], $row);
                    $row = str_replace("{PORCENTAJE_AVANCE}", $porcentaje[2], $row);
                    $row = str_replace("{JEFE_ENCODEADO}", $jef->jefe, $row);
                }
                $PRINCIPAL = str_replace("{LISTADO_JEFATURAS}", $row, $PRINCIPAL);
                return ($PRINCIPAL);
            }

            //De aqui para abajo juega el CHIS
            function FormularioNoticia($PRINCIPAL, $id_noticia)
            {
                $id_empresa = $_SESSION["id_empresa"];
                $datos_noticia = DatosNoticias($id_noticia);
                //echo $datos_noticia[0]->contenido;
                $PRINCIPAL = str_replace("{TITULO}", utf8_encode($datos_noticia[0]->titulo), $PRINCIPAL);
                $PRINCIPAL = str_replace("{BAJADA}", utf8_encode($datos_noticia[0]->bajada), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CONTENIDO}", htmlentities($datos_noticia[0]->contenido), $PRINCIPAL);
                $PRINCIPAL = str_replace("{TAG}", utf8_encode($datos_noticia[0]->tag), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_DESCRIPCION_DOC1}", utf8_encode($datos_noticia[0]->descripcion_doc1), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_DESCRIPCION_DOC2}", utf8_encode($datos_noticia[0]->descripcion_doc2), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_DESCRIPCION_DOC3}", utf8_encode($datos_noticia[0]->descripcion_doc3), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_DESCRIPCION_DOC4}", utf8_encode($datos_noticia[0]->descripcion_doc4), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_DESCRIPCION_DOC5}", utf8_encode($datos_noticia[0]->descripcion_doc5), $PRINCIPAL);
                //$PRINCIPAL = str_replace("{CATEGORIA}",Traercategorias($datos_noticia[0]->categoria),$PRINCIPAL);
                $PRINCIPAL = str_replace("{PERFIL}", TodosLosPerfiles(), $PRINCIPAL);
                $PRINCIPAL = str_replace("{FECHACREACION}", $datos_noticia[0]->fecha_creacion, $PRINCIPAL);
                $PRINCIPAL = str_replace("{LIKE}", $datos_noticia[0]->like, $PRINCIPAL);
                $PRINCIPAL = str_replace("{SELECT" . $datos_noticia[0]->estado . "}", "selected", $PRINCIPAL);
                //$PRINCIPAL = str_replace("{ESTADO}",Traerestado($datos_noticia[0]->estado),$PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_GERENCIAS}", OptionsGenericoPorEmpresa("gerencia", "tbl_usuario", $datos_noticia[0]->gerencia, $_SESSION["id_empresa"]), $PRINCIPAL);
                //$PRINCIPAL = str_replace("{OPTIONS_MUNDOS}",OptionsGenericoPorEmpresa("mundo", "tbl_usuario", $datos_noticia[0]->mundo, $_SESSION["id_empresa"]),$PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_MUNDOS}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_mundos", $datos_noticia[0]->id_mundo, "nombre", "id", "order by nombre", $_SESSION["id_empresa"]), $PRINCIPAL);
                //traigo el total de las galerias
                $total_album = TraigoAlbunesPorEmpresa($id_empresa);
                $options_album = "";
                foreach ($total_album as $alb) {
                    $options_album .= "<option value='" . $alb->id . "'>" . $alb->categoria . "</option>";
                }
                $PRINCIPAL = str_replace("{OPTIONS_GALERIAS}", $options_album, $PRINCIPAL);
                //traigo el total de bibliotecas
                $total_bibliotecas = TraigoBibliotecasPorEmpresa($id_empresa);
                $options_album = "";
                foreach ($total_bibliotecas as $biblio) {
                    $options_bibliotecas .= "<option value='" . $biblio->id . "'>" . $biblio->categoria . "</option>";
                }
                $PRINCIPAL = str_replace("{OPTIONS_BIBLIOTECA}", $options_bibliotecas, $PRINCIPAL);
                //$principales=TraePrincipalEmpresa($id_empresa);
                //$options.="<option value='0'>No aplica</option>";
                //for ($j=1;$j<=$principales;$j++){
                //    if ($datos_noticia[0]->principal==$j){$selected="selected";}else{$selected="";}
                //    $options.="<option value=".$j." ".$selected." >".$j."</option>";
                //}
                if ($datos_noticia[0]->principal === 0) {
                    $PRINCIPAL = str_replace("{VALUE_PRINCIPAL_NO}", "selected='selected'", $PRINCIPAL);
                } else if ($datos_noticia[0]->principal == 1) {
                    $PRINCIPAL = str_replace("{VALUE_PRINCIPAL_SI}", "selected='selected'", $PRINCIPAL);
                }
                $PRINCIPAL = str_replace("{OPTIONS_PRINCIPAL}", $options, $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_COMUNIDADES}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_comunidades", $datos_noticia[0]->id_comunidad, "nombre", "id", "order by nombre", $_SESSION["id_empresa"]), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_CATEGORIAS}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_noticias_categorias", $datos_noticia[0]->categoria, "categoria", "id", "order by categoria", $_SESSION["id_empresa"]), $PRINCIPAL);
                //$PRINCIPAL = str_replace("{OPTIONS_ESTADOS}",OptionsGenericoNombreDadoValoresPorEmpresa("tbl_noticias_estados", $datos_noticia[0]->estado,  "estado", "id", "order by estado", $_SESSION["id_empresa"]),$PRINCIPAL);
                if ($datos_noticia[0]->estado == 4) {
                    $PRINCIPAL = str_replace("{ESTADO_BORRADOR}", "selected='selected'", $PRINCIPAL);
                } else if ($datos_noticia[0]->estado == 1) {
                    $PRINCIPAL = str_replace("{ESTADO_PUBLICADO}", "selected='selected'", $PRINCIPAL);
                }
                if ($datos_noticia[0]->imagen_slider) {
                    //echo "tiene slider";
                    $PRINCIPAL = str_replace("{SELECTSLIDERSI}", "selected", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{SELECTSLIDERNO}", "", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{DISPLAYSLIDER}", "block", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{BLOQUE_VE_IMAGEN_SLIDER}", "<img id='imgSalidaSlider'  style='max-width:100%;' src='../front/img/noticias/slider/" . $datos_noticia[0]->imagen_slider . "' />", $PRINCIPAL);
                } else {
                    //echo "no tiene slider";
                    $PRINCIPAL = str_replace("{SELECTSLIDERSI}", "", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{SELECTSLIDERNO}", "selected", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{DISPLAYSLIDER}", "none", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{BLOQUE_VE_IMAGEN_SLIDER}", "<img id='imgSalidaSlider' style='display:none;' src='' />", $PRINCIPAL);
                }
                //pasamos la portada a una variable
                $portada = $datos_noticia[0]->portada;
                if ($id_noticia) {
                    $PRINCIPAL = str_replace("{VALOR_BOTON}", "Editar", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ACTION}", "ednot", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ID_NOTICIA}", $id_noticia, $PRINCIPAL);
                    $PRINCIPAL = str_replace("{PORTADA}", "<img id='imgSalida' style='max-width:100%;' src='" . imagen_existe_portada_2020($portada) . "' />", $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{VALOR_BOTON}", "Ingresar", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ACTION}", "adnot", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ID_NOTICIA}", '', $PRINCIPAL);
                    $PRINCIPAL = str_replace("{PORTADA}", "<img id='imgSalida' style='display:none;' src='' />", $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function FormularioNoticiaBK08012015($PRINCIPAL, $id_noticia)
            {
                $datos_noticia = DatosNoticias($id_noticia);
                //echo $datos_noticia[0]->contenido;
                $PRINCIPAL = str_replace("{TITULO}", utf8_encode($datos_noticia[0]->titulo), $PRINCIPAL);
                $PRINCIPAL = str_replace("{BAJADA}", utf8_encode($datos_noticia[0]->bajada), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CONTENIDO}", htmlentities($datos_noticia[0]->contenido), $PRINCIPAL);
                $PRINCIPAL = str_replace("{TAG}", utf8_encode($datos_noticia[0]->tag), $PRINCIPAL);
                //$PRINCIPAL = str_replace("{CATEGORIA}",Traercategorias($datos_noticia[0]->categoria),$PRINCIPAL);
                $PRINCIPAL = str_replace("{PERFIL}", TodosLosPerfiles(), $PRINCIPAL);
                $PRINCIPAL = str_replace("{FECHACREACION}", $datos_noticia[0]->fecha_creacion, $PRINCIPAL);
                $PRINCIPAL = str_replace("{LIKE}", $datos_noticia[0]->like, $PRINCIPAL);
                $PRINCIPAL = str_replace("{SELECT" . $datos_noticia[0]->estado . "}", "selected", $PRINCIPAL);
                //$PRINCIPAL = str_replace("{ESTADO}",Traerestado($datos_noticia[0]->estado),$PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_GERENCIAS}", OptionsGenericoPorEmpresa("gerencia", "tbl_usuario", $datos_noticia[0]->gerencia, $_SESSION["id_empresa"]), $PRINCIPAL);
                //$PRINCIPAL = str_replace("{OPTIONS_MUNDOS}",OptionsGenericoPorEmpresa("mundo", "tbl_usuario", $datos_noticia[0]->mundo, $_SESSION["id_empresa"]),$PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_MUNDOS}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_mundos", $datos_noticia[0]->id_mundo, "nombre", "id", "order by nombre", $_SESSION["id_empresa"]), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_COMUNIDADES}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_comunidades", $datos_noticia[0]->id_comunidad, "nombre", "id", "order by nombre", $_SESSION["id_empresa"]), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_CATEGORIAS}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_noticias_categorias", $datos_noticia[0]->categoria, "categoria", "id", "order by categoria", $_SESSION["id_empresa"]), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_ESTADOS}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_noticias_estados", $datos_noticia[0]->estado, "estado", "id", "order by estado", $_SESSION["id_empresa"]), $PRINCIPAL);
                if ($datos_noticia[0]->imagen_slider) {
                    //echo "tiene slider";
                    $PRINCIPAL = str_replace("{SELECTSLIDERSI}", "selected", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{SELECTSLIDERNO}", "", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{DISPLAYSLIDER}", "block", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{BLOQUE_VE_IMAGEN_SLIDER}", "<img width='500' src='../front/img/noticias/slider/" . $datos_noticia[0]->imagen_slider . "'>", $PRINCIPAL);
                } else {
                    //echo "no tiene slider";
                    $PRINCIPAL = str_replace("{SELECTSLIDERSI}", "", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{SELECTSLIDERNO}", "selected", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{DISPLAYSLIDER}", "none", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{BLOQUE_VE_IMAGEN_SLIDER}", "", $PRINCIPAL);
                }
                //pasamos la portada a una variable
                $portada = $datos_noticia[0]->portada;
                if ($id_noticia) {
                    $PRINCIPAL = str_replace("{VALOR_BOTON}", "Editar", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ACTION}", "ednot", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ID_NOTICIA}", $id_noticia, $PRINCIPAL);
                    $PRINCIPAL = str_replace("{PORTADA}", '<img src="' . imagen_existe($portada) . '" width="400px">', $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{VALOR_BOTON}", "Ingresar", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ACTION}", "adnot", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ID_NOTICIA}", '', $PRINCIPAL);
                    $PRINCIPAL = str_replace("{PORTADA}", '', $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function SuboImagenNoticia($FILES, $extension_archivo, $prefijo, $ruta)
            {
                if ($extension_archivo == "zip") {
                    //Primero copio el archivo a la ruta que debe ser
                    //$destino =  "../schoolv02/objetos/".$prefijo.".jpg";
                    $ruta_con_archivo = $ruta . "/" . $prefijo . "." . $extension_archivo;
                    copy($FILES['archivo']['tmp_name'], $ruta_con_archivo);
                    //Ahora que el archivo ZIP ya estÃ¡ guardado, se debe descomprimir
                    $zip = new ZipArchive;
                    if ($zip->open($ruta_con_archivo) === TRUE) {
                        $zip->extractTo($ruta . "/" . $prefijo);
                        $zip->close();
                        echo 'ok';
                    } else {
                        echo 'Fayo en el archivo';
                    }
                } else {
                    $ruta_con_archivo = $ruta . "/" . $prefijo . "." . $extension_archivo;
                    copy($FILES['archivo']['tmp_name'], $ruta_con_archivo);
                }
                //Devuelvol un arreglo, con datos del archivo subido
                $arreglo[0] = $ruta_con_archivo;//Ruta Completa
                $arreglo[1] = $prefijo . "." . $extension_archivo;//Nombre del Archivo
                $arreglo[2] = $ruta . "/" . $prefijo;//Ruta del Objeto sin el index
                return ($arreglo);
            }

            function Traercategorias($id_categoria)
            {
                $TodosCategorias = TodosCategorias();
                $html = '<select name="categoria">
                <option>- Seleccione -</option>';
                foreach ($TodosCategorias as $tcategorias) {
                    if ($id_categoria == $tcategorias->id) {
                        $check = 'selected="selected"';
                    } else {
                        $check = '';
                    }
                    $html .= '<option ' . $check . ' value="' . utf8_encode($tcategorias->id) . '">' . utf8_encode($tcategorias->categoria) . '</option>';
                }
                $html .= '</select>';
                return $html;
            }

            function Traerestado($id_estado)
            {
                $TodosEstados = TodosEstados();
                $html = '<select name="estado_noticia">';
                foreach ($TodosEstados as $testados) {
                    if ($id_estado == $testados->id) {
                        $check = 'selected="selected"';
                    } else {
                        $check = '';
                    }
                    $html .= '<option ' . $check . ' value="' . utf8_encode($testados->id) . '">' . utf8_encode($testados->estado) . '</option>';
                }
                $html .= '</select>';
                return $html;
            }

            function ListadoNoticiasAdminBK08012015($PRINCIPAL, $id_empresa)
            {
                //Traigo las noticias principales
                $noticias_principales = TraeNoticiasPrincipales($id_empresa, "", "");
                $row_principales = "";
                foreach ($noticias_principales as $not_prin) {
                    $row_principales .= file_get_contents("views/noticias/row_listado_noticias.html");
                    //todos los campos
                    $row_principales = str_replace("{ID}", $not_prin->prioridad, $row_principales);
                    $row_principales = str_replace("{PORTADA}", imagen_existe($not_prin->portada), $row_principales);
                    $row_principales = str_replace("{TITULO}", recortar_texto($not_prin->titulo, 30), $row_principales);
                    $row_principales = str_replace("{CONTENIDO}", recortar_texto($not_prin->contenido, 70), $row_principales);
                    $row_principales = str_replace("{TAG}", $not_prin->tag, $row_principales);
                    $row_principales = str_replace("{CATEGORIA}", $lacategoria[0]->categoria, $row_principales);
                    $row_principales = str_replace("{PERFIL}", $not_prin->perfil, $row_principales);
                    $row_principales = str_replace("{FECHA_CREACION}", $not_prin->fecha_creacion, $row_principales);
                    $row_principales = str_replace("{LIKE}", $not_prin->like, $row_principales);
                    $row_principales = str_replace("{ID_NOTICIA_ENCODEADO}", Encodear($not_prin->id), $row_principales);
                    if ($not_prin->estado == '0') {
                        $row_principales = str_replace("{BGCOLOR}", 'bgcolor="#F3F3F3"', $row_principales);
                    } else {
                        $row_principales = str_replace("{BGCOLOR}", 'bgcolor="#FFFFFF"', $row_principales);
                    }
                }
                $PRINCIPAL = str_replace("{ROW_LISTADO_NOTICIAS_PRINCIPALES}", $row_principales, $PRINCIPAL);
                //Traigo el total de empresas que existen en el sistema
                //$tnoticias=TotalNoticias();
                $tnoticias = TotalNoticiasSinPrincipal($id_empresa);
                //print_r($tnoticias);
                $total_noticias = "";
                $i = 1;
                foreach ($tnoticias as $tnoti) {
                    $row = file_get_contents("views/noticias/row_listado_noticias.html");
                    $row = str_replace("{NUMERO}", $i, $row);
                    $row = str_replace("{ID}", $i, $row);
                    $i++;
                    //trae categoria
                    $lacategoria = UnaCategoria($tnoti->categoria);
                    //todos los campos
                    //$row = str_replace("{ID}",$tnoti->id,$row);
                    $row = str_replace("{PORTADA}", imagen_existe($tnoti->portada), $row);
                    $row = str_replace("{TITULO}", recortar_texto($tnoti->titulo, 30), $row);
                    $row = str_replace("{CONTENIDO}", recortar_texto($tnoti->contenido, 70), $row);
                    $row = str_replace("{TAG}", $tnoti->tag, $row);
                    $row = str_replace("{CATEGORIA}", $lacategoria[0]->categoria, $row);
                    $row = str_replace("{PERFIL}", $tnoti->perfil, $row);
                    $row = str_replace("{FECHA_CREACION}", $tnoti->fecha_creacion, $row);
                    $row = str_replace("{LIKE}", $tnoti->like, $row);
                    $row = str_replace("{ID_NOTICIA_ENCODEADO}", Encodear($tnoti->id), $row);
                    if ($tnoti->estado == '0') {
                        $row = str_replace("{BGCOLOR}", 'bgcolor="#F3F3F3"', $row);
                    } else {
                        $row = str_replace("{BGCOLOR}", 'bgcolor="#FFFFFF"', $row);
                    }
                    $total_noticias .= $row;
                }
                $PRINCIPAL = str_replace("{ROW_LISTADO_NOTICIAS}", $total_noticias, $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function imagen_existe_thumb($imagen)
            {
                $imagenexiste = "../chileactivo/front/img/noticias/thum/" . $imagen;
                if (is_null($imagen)) {
                    $comprobacion = "../chileactivo/front/img/noticias/no_image.png";
                } else {
                    if (file_exists($imagenexiste)) {
                        $comprobacion = $imagenexiste;
                    } else {
                        $comprobacion = "../chileactivo/front/img/noticias/no_image.png";
                    }
                }
                return $comprobacion;
            }

            function imagen_existe_portada_2020($imagen)
            {
                $imagenexiste = "../chileactivo/front/img/noticias/" . $imagen;
                if (is_null($imagen)) {
                    $comprobacion = "../chileactivo/front/img/noticias/no_image.png";
                } else {
                    if (file_exists($imagenexiste)) {
                        $comprobacion = $imagenexiste;
                    } else {
                        $comprobacion = "../chileactivo/front/img/noticias/no_image.png";
                    }
                }
                return $comprobacion;
            }

            function imagen_existe_slider($imagen)
            {
                $imagenexiste = "../chileactivo/front/img/noticias/slider/" . $imagen;
                if (is_null($imagen)) {
                    $comprobacion = "../chileactivo/front/img/noticias/no_image.png";
                } else {
                    if (file_exists($imagenexiste)) {
                        $comprobacion = $imagenexiste;
                    } else {
                        $comprobacion = "../chileactivo/front/img/noticias/no_image.png";
                    }
                }
                return $comprobacion;
            }

            function ListadoNoticiasAdmin($PRINCIPAL, $id_empresa)
            {

                //echo "hola ListadoNoticiasAdmin";

                $tnoticias1 = TotalNoticiasSlider($id_empresa);
                //print_r($tnoticias);
                $total_noticias1 = "";
                $i = 1;
                $likes = "";
                foreach ($tnoticias1 as $tnotis) {
                    $row = file_get_contents("views/noticias/row_listado_noticias_slider.html");
                    $likes = cuenta_likes($tnotis->id);
                    //trae categoria
                    $lacategoria = UnaCategoria($tnotis->categoria);
                    //todos los campos
                    $row = str_replace("{ID}", $tnotis->id, $row);
                    $row = str_replace("{IMAGEN}", imagen_existe_slider($tnotis->imagen_slider), $row);
                    //$row = str_replace("{PORTADA}",imagen_existe($tnoti->portada),$row);
                    $row = str_replace("{TITULO}", recortar_texto($tnotis->titulo, 80), $row);
                    $row = str_replace("{CONTENIDO}", recortar_texto($tnotis->contenido, 70), $row);
                    $row = str_replace("{TAG}", $tnotis->tag, $row);
                    $row = str_replace("{ID_MUNDO}", $tnotis->id_mundo, $row);
                    $row = str_replace("{ID_COMUNIDAD}", $tnotis->id_comunidad, $row);
                    $row = str_replace("{CATEGORIA}", $lacategoria[0]->categoria, $row);
                    $row = str_replace("{PERFIL}", $tnotis->perfil, $row);
                    $row = str_replace("{VISITAS}", $tnotis->visitas, $row);
                    $row = str_replace("{CREADOR}", $tnotis->rut_creador, $row);
                    $row = str_replace("{FECHA_CREACION}", $tnotis->fecha_creacion, $row);
                    $row = str_replace("{LIKE}", $likes[0]->total, $row);
                    $row = str_replace("{ORDEN}", $i, $row);
                    $i++;
                    $row = str_replace("{ID_NOTICIA_ENCODEADO}", Encodear($tnotis->id), $row);
                    if ($tnotis->estado == '0') {
                        $row = str_replace("{BGCOLOR}", 'bgcolor="#F3F3F3"', $row);
                    } else {
                        $row = str_replace("{BGCOLOR}", 'bgcolor="#FFFFFF"', $row);
                    }
                    $total_noticias1 .= $row;
                }
                $PRINCIPAL = str_replace("{ROW_LISTADO_NOTICIAS_SLIDER}", $total_noticias1, $PRINCIPAL);
                //Traigo las noticias principales
                $noticias_principales = Total_Noticias_Principal($id_empresa);
                $row_principales = "";
                foreach ($noticias_principales as $not_prin) {
                    $lacategoria = UnaCategoria($not_prin->categoria);
                    $row_principales .= file_get_contents("views/noticias/row_listado_noticias_2020.html");
                    //todos los campos
                    $likes = cuenta_likes($not_prin->id);
                    $row_principales = str_replace("{ID}", $not_prin->prioridad, $row_principales);
                    $row = str_replace("{IMAGEN}", imagen_existe($not_prin->portada), $row);
                    $row = str_replace("{PORTADA}", imagen_existe($tnoti->portada), $row);
                    //$row_principales = str_replace("{TITULO}",recortar_texto($not_prin->titulo,30),$row_principales);
                    $row_principales = str_replace("{ID}", $not_prin->id, $row_principales);
                    $row_principales = str_replace("{TITULO}", recortar_texto($not_prin->titulo, 80), $row_principales);
                    $row_principales = str_replace("{CONTENIDO}", recortar_texto($not_prin->contenido, 70), $row_principales);
                    $row_principales = str_replace("{ID_MUNDO}", $not_prin->id_mundo, $row_principales);
                    $row_principales = str_replace("{CREADOR}", $not_prin->rut_creador, $row_principales);
                    $row_principales = str_replace("{ID_COMUNIDAD}", $not_prin->id_comunidad, $row_principales);
                    $row_principales = str_replace("{VISITAS}", $not_prin->visitas, $row_principales);
                    $row_principales = str_replace("{TAG}", $not_prin->tag, $row_principales);
                    $row_principales = str_replace("{CATEGORIA}", $lacategoria[0]->categoria, $row_principales);
                    $row_principales = str_replace("{PERFIL}", $not_prin->perfil, $row_principales);
                    $row_principales = str_replace("{ORDEN_NOTICIA}", $not_prin->orden, $row_principales);
                    $row_principales = str_replace("{FECHA_CREACION}", $not_prin->fecha_creacion, $row_principales);
                    $row_principales = str_replace("{LIKE}", $likes[0]->total, $row_principales);
                    $row_principales = str_replace("{ID_NOTICIA_ENCODEADO}", Encodear($not_prin->id), $row_principales);
                    $row_principales = str_replace("{ID_NOTICIA}", ($not_prin->id), $row_principales);
                    if ($not_prin->estado == '0') {
                        $row_principales = str_replace("{BGCOLOR}", 'bgcolor="#F3F3F3"', $row_principales);
                    } else {
                        $row_principales = str_replace("{BGCOLOR}", 'bgcolor="#FFFFFF"', $row_principales);
                    }
                }
                $PRINCIPAL = str_replace("{ROW_LISTADO_NOTICIAS_PRINCIPALES}", $row_principales, $PRINCIPAL);
                //Traigo el total de empresas que existen en el sistema
                //$tnoticias=TotalNoticias();
                $tnoticias = Total_Noticias_SinPrincipal($id_empresa);
                //print_r($tnoticias);
                $total_noticias = "";
                $i = 1;
                $likes = "";
                $row = "";
                foreach ($tnoticias as $tnoti) {
                    $row = file_get_contents("views/noticias/row_listado_noticias_2020.html");
                    $row = str_replace("{NUMERO}", $i, $row);
                    $row = str_replace("{ID}", $i, $row);
                    $i++;
                    $likes = cuenta_likes($tnoti->id);
                    //trae categoria
                    $lacategoria = UnaCategoria($tnoti->categoria);
                    //todos los campos
                    $row = str_replace("{ID_SIN_ENCODEAR}", $tnoti->id, $row);
                    $row = str_replace("{IMAGEN}", imagen_existe_thumb($tnoti->imagen_thumb), $row);
                    $row = str_replace("{PORTADA}", imagen_existe_2020($tnoti->portada), $row);
                    $row = str_replace("{TITULO}", recortar_texto($tnoti->titulo, 100), $row);
                    $row = str_replace("{CONTENIDO}", recortar_texto($tnoti->contenido, 70), $row);
                    $row = str_replace("{TAG}", $tnoti->tag, $row);
                    $row = str_replace("{ID_MUNDO}", $tnoti->id_mundo, $row);
                    $row = str_replace("{ID_COMUNIDAD}", $tnoti->id_comunidad, $row);
                    $row = str_replace("{CATEGORIA}", $lacategoria[0]->categoria, $row);
                    $row = str_replace("{PERFIL}", $tnoti->perfil, $row);
                    $row = str_replace("{VISITAS}", $tnoti->visitas, $row);
                    $row = str_replace("{CREADOR}", $tnoti->rut_creador, $row);
                    $row = str_replace("{FECHA_CREACION}", $tnoti->fecha_creacion, $row);
                    $row = str_replace("{LIKE}", $likes[0]->total, $row);
                    $row = str_replace("{ORDEN_NOTICIA}", $tnoti->orden, $row);
                    $row = str_replace("{ID_NOTICIA_ENCODEADO}", Encodear($tnoti->id), $row);
                    $row = str_replace("{ID_NOTICIA}", ($tnoti->id), $row);
                    if ($tnoti->estado == '0') {
                        $row = str_replace("{BGCOLOR}", 'bgcolor="#F3F3F3"', $row);
                    } else {
                        $row = str_replace("{BGCOLOR}", 'bgcolor="#FFFFFF"', $row);
                    }
                    $total_noticias .= $row;
                }
                $PRINCIPAL = str_replace("{ROW_LISTADO_NOTICIAS}", $total_noticias, $PRINCIPAL);
                $tnoticiasb = TotalNoticiasBorrador($id_empresa);
                // print_r($tnoticias);
                $total_noticiasb = "";
                $likes = "";
                $row = "";
                foreach ($tnoticiasb as $tnotib) {

                    //echo "<br>bORRADOR<BR>";
                    $row = file_get_contents("views/noticias/row_listado_noticias_borrador_2020.html");
                    $likes = cuenta_likes($tnotib->id);
                    //trae categoria
                    $lacategoria = UnaCategoria($tnotib->categoria);
                    //todos los campos
                    $row = str_replace("{ID_SIN_ENCODEAR}", $tnotib->id, $row);
                    $row = str_replace("{IMAGEN}", imagen_existe_thumb($tnotib->imagen_thumb), $row);
                    $row = str_replace("{PORTADA}", imagen_existe_2020($tnotib->portada), $row);
                    $row = str_replace("{TITULO}", recortar_texto($tnotib->titulo, 100), $row);
                    $row = str_replace("{CONTENIDO}", recortar_texto($tnotib->contenido, 70), $row);
                    $row = str_replace("{TAG}", $tnotib->tag, $row);
                    $row = str_replace("{ID_MUNDO}", $tnotib->id_mundo, $row);
                    $row = str_replace("{ID_COMUNIDAD}", $tnotib->id_comunidad, $row);
                    $row = str_replace("{CATEGORIA}", $lacategoria[0]->categoria, $row);
                    $row = str_replace("{PERFIL}", $tnotib->perfil, $row);
                    $row = str_replace("{VISITAS}", $tnotib->visitas, $row);
                    $row = str_replace("{CREADOR}", $tnotib->rut_creador, $row);
                    $row = str_replace("{FECHA_CREACION}", $tnotib->fecha_creacion, $row);
                    $row = str_replace("{LIKE}", $likes[0]->total, $row);
                    $row = str_replace("{ID_NOTICIA_ENCODEADO}", Encodear($tnotib->id), $row);
                    if ($tnotib->estado == '0') {
                        $row = str_replace("{BGCOLOR}", 'bgcolor="#F3F3F3"', $row);
                    } else {
                        $row = str_replace("{BGCOLOR}", 'bgcolor="#FFFFFF"', $row);
                    }
                    $total_noticiasb .= $row;
                }
                $PRINCIPAL = str_replace("{ROW_LISTADO_NOTICIAS_BORRADOR}", $total_noticiasb, $PRINCIPAL);
                $PRINCIPAL = str_replace("{N_NOTICIAS}", CuentaNoticias($id_empresa), $PRINCIPAL);
                $PRINCIPAL = str_replace("{N_MEGUSTA}", cuenta_likes_noticias($id_empresa), $PRINCIPAL);
                $PRINCIPAL = str_replace("{N_COMENTARIOS}", CuentaComentarios($id_empresa), $PRINCIPAL);
                $PRINCIPAL = str_replace("{N_VISITAS}", cuenta_visitas_noticias($id_empresa), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_EMPRESA_ENCODEADO}", Encodear3($id_empresa), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function TotalComentarios($id_empresa)
            {
                global $c_host, $c_user, $c_pass, $c_db;
                $database = new database($c_host, $c_user, $c_pass);
                $database->setDb($c_db);
                $sql = "SELECT
    tbl_noticias_comentarios.id,
    tbl_noticias_comentarios.comentario,
    tbl_noticias_comentarios.fecha,
    tbl_noticias_comentarios.estado,
    tbl_noticias_comentarios.id_usuario,
    titulo
FROM
    `tbl_noticias_comentarios`
INNER JOIN tbl_noticias ON tbl_noticias.id = tbl_noticias_comentarios.id_noticia
WHERE
    tbl_noticias.id_empresa = '$id_empresa' ";
                $database->setquery($sql);
                $database->query();
                $cod = $database->listObjects();
                return $cod;
            }

            function ListadoComentariosAdmin($PRINCIPAL, $id_empresa)
            {
                $comentarios = TotalComentarios($id_empresa);
                //$comentarios=TotalComentariosPorEmpresa($id_empresa);
                foreach ($comentarios as $val) {
                    $row = file_get_contents("views/noticias/row_listado_comentarios.html");
                    //todos los campos
                    $row = str_replace("{ID}", $val->id, $row);
                    $row = str_replace("{TITULO}", $val->titulo, $row);
                    $row = str_replace("{COMENTARIO}", utf8_decode($val->comentario), $row);
                    $row = str_replace("{FECHA}", $val->fecha, $row);
                    $row = str_replace("{USUARIO}", $val->nombre_comentario, $row);
                    if ($val->estado == '0') {
                        $estado = '<div id="app_' . $val->id . '"><button  class="btn btn-danger btn-sm flat" onclick="aprobar(\'' . $val->id . '\')">Aprobar</button></div>';
                    } else {
                        $estado = "Aprobado";
                    }
                    $row = str_replace("{ESTADO}", $estado, $row);
                    $total_comentarios .= $row;
                }
                $PRINCIPAL = str_replace("{ROW_LISTADO_COMENTARIOS}", $total_comentarios, $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function UltimoSlider($id_empresa)
            {
                global $c_host, $c_user, $c_pass, $c_db;
                $database = new database($c_host, $c_user, $c_pass);
                $database->setDb($c_db);
                $sql = "select MAX(slider_activo) as slider from tbl_noticias where id_empresa='$id_empresa'";
                $database->setquery($sql);
                $database->query();
                $cod = $database->listObjects();
                return 1 + ($cod[0]->slider);
            }

            function ListadoNoticiasAdminBK22012016($PRINCIPAL, $id_empresa)
            {
                //Traigo las noticias principales
                $noticias_principales = TraeNoticiasPrincipales($id_empresa, "", "");
                $row_principales = "";
                foreach ($noticias_principales as $not_prin) {
                    $lacategoria = UnaCategoria($not_prin->categoria);
                    $row_principales .= file_get_contents("views/noticias/row_listado_noticias.html");
                    //todos los campos
                    $row_principales = str_replace("{ID}", $not_prin->prioridad, $row_principales);
                    $row_principales = str_replace("{PORTADA}", imagen_existe($not_prin->portada), $row_principales);
                    //$row_principales = str_replace("{TITULO}",recortar_texto($not_prin->titulo,30),$row_principales);
                    $row_principales = str_replace("{TITULO}", recortar_texto($not_prin->titulo, 80), $row_principales);
                    $row_principales = str_replace("{CONTENIDO}", recortar_texto($not_prin->contenido, 70), $row_principales);
                    $row_principales = str_replace("{TAG}", $not_prin->tag, $row_principales);
                    $row_principales = str_replace("{CATEGORIA}", $lacategoria[0]->categoria, $row_principales);
                    $row_principales = str_replace("{PERFIL}", $not_prin->perfil, $row_principales);
                    $row_principales = str_replace("{FECHA_CREACION}", $not_prin->fecha_creacion, $row_principales);
                    $row_principales = str_replace("{LIKE}", cuenta_likes($tnoti->id), $row_principales);
                    $row_principales = str_replace("{ID_NOTICIA_ENCODEADO}", Encodear($not_prin->id), $row_principales);
                    if ($not_prin->estado == '0') {
                        $row_principales = str_replace("{BGCOLOR}", 'bgcolor="#F3F3F3"', $row_principales);
                    } else {
                        $row_principales = str_replace("{BGCOLOR}", 'bgcolor="#FFFFFF"', $row_principales);
                    }
                }
                $PRINCIPAL = str_replace("{ROW_LISTADO_NOTICIAS_PRINCIPALES}", $row_principales, $PRINCIPAL);
                //Traigo el total de empresas que existen en el sistema
                //$tnoticias=TotalNoticias();
                $tnoticias = TotalNoticiasSinPrincipal($id_empresa);
                //print_r($tnoticias);
                $total_noticias = "";
                $i = 1;
                foreach ($tnoticias as $tnoti) {
                    $row = file_get_contents("views/noticias/row_listado_noticias.html");
                    $row = str_replace("{NUMERO}", $i, $row);
                    $row = str_replace("{ID}", $i, $row);
                    $i++;
                    //trae categoria
                    $lacategoria = UnaCategoria($tnoti->categoria);
                    //todos los campos
                    //$row = str_replace("{ID}",$tnoti->id,$row);
                    $row = str_replace("{PORTADA}", imagen_existe($tnoti->portada), $row);
                    $row = str_replace("{TITULO}", recortar_texto($tnoti->titulo, 80), $row);
                    $row = str_replace("{CONTENIDO}", recortar_texto($tnoti->contenido, 70), $row);
                    $row = str_replace("{TAG}", $tnoti->tag, $row);
                    $row = str_replace("{CATEGORIA}", $lacategoria[0]->categoria, $row);
                    $row = str_replace("{PERFIL}", $tnoti->perfil, $row);
                    $row = str_replace("{FECHA_CREACION}", $tnoti->fecha_creacion, $row);
                    $row = str_replace("{LIKE}", cuenta_likes($tnoti->id), $row);
                    $row = str_replace("{ID_NOTICIA_ENCODEADO}", Encodear($tnoti->id), $row);
                    if ($tnoti->estado == '0') {
                        $row = str_replace("{BGCOLOR}", 'bgcolor="#F3F3F3"', $row);
                    } else {
                        $row = str_replace("{BGCOLOR}", 'bgcolor="#FFFFFF"', $row);
                    }
                    $total_noticias .= $row;
                }
                $PRINCIPAL = str_replace("{ROW_LISTADO_NOTICIAS}", $total_noticias, $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function recortar_texto($texto, $limite = 100)
            {
                $texto = trim($texto);
                $texto = strip_tags($texto);
                $tamano = strlen($texto);
                $resultado = '';
                if ($tamano <= $limite) {
                    return $texto;
                } else {
                    $texto = substr($texto, 0, $limite);
                    $palabras = explode(' ', $texto);
                    $resultado = implode(' ', $palabras);
                    $resultado .= '...';
                }
                return $resultado;
            }

            function imagen_existe_2020($imagen)
            {
                $imagenexiste = '../chileactivo/front/img/noticias/' . $imagen;
                if (file_exists($imagenexiste)) {
                    $comprobacion = $imagenexiste;
                } else {
                    $comprobacion = '../chileactivo/front/img/noticiapordefecto.jpg';
                }
                return $comprobacion;
            }

            function TodosLosPerfiles()
            {
                $TodosPerfiles = TodosPerfiles();
                $perfiles = '';
                $i = 1;
                foreach ($TodosPerfiles as $tperf) {
                    $perfiles .= '<input type="checkbox" name="perfil[' . $i . ']" value="' . $tperf->cargo . '" />' . $tperf->cargo;
                    $i++;
                }
                return $perfiles;
            }

            //FIN CHIS
            function SuboArchivoEstandar($FILES, $extension_archivo, $prefijo, $ruta, $nombre_file)
            {
                if ($extension_archivo == "zip") {
                    //Primero copio el archivo a la ruta que debe ser
                    //$destino =  "../schoolv02/objetos/".$prefijo.".jpg";
                    $ruta_con_archivo = $ruta . "/" . $prefijo . "." . $extension_archivo;
                    copy($FILES[$nombre_file]['tmp_name'], $ruta_con_archivo);
                    //Ahora que el archivo ZIP ya estÃ¡ guardado, se debe descomprimir
                    $zip = new ZipArchive;
                    if ($zip->open($ruta_con_archivo) === TRUE) {
                        $zip->extractTo($ruta . "/" . $prefijo);
                        $zip->close();
                        echo 'ok';
                    } else {
                        echo 'failed';
                    }
                } else {
                    $ruta_con_archivo = $ruta . "/" . $prefijo . "." . $extension_archivo;
                    copy($FILES[$nombre_file]['tmp_name'], $ruta_con_archivo);
                }
                //Devuelvol un arreglo, con datos del archivo subido
                $arreglo[0] = $ruta_con_archivo;//Ruta Completa
                $arreglo[1] = $prefijo . "." . $extension_archivo;//Nombre del Archivo
                $arreglo[2] = $ruta . "/" . $prefijo;//Ruta del Objeto sin el index
                return ($arreglo);
            }

            function MuestraListadoPreguntasPorEval($id_evaluacion)
            {
                $preguntas = ListadoDePreguntasDadaEvaluacion($id_evaluacion);
                if ($preguntas) {
                    $total_rows = "";
                    $i = 1;
                    foreach ($preguntas as $preg) {
                        $total_rows .= file_get_contents("views/evaluaciones/row_listado_preguntas.html");
                        $total_rows = str_replace("{N}", $i, $total_rows);
                        $total_rows = str_replace("{PREGUNTA}", $preg->pregunta, $total_rows);
                        $total_rows = str_replace("{TIPO_PREGUNTA}", $preg->tipo_pregunta, $total_rows);
                        $i++;
                    }
                    return (utf8_encode($total_rows));
                } else {
                    return ("");
                }
            }

            function OptionsTiposPreguntas()
            {
                $total_tipos_preguntas = ListadoTiposPreguntas();
                $total_options = "";
                foreach ($total_tipos_preguntas as $preg) {
                    $total_options .= '<option value="' . $preg->id . '">' . $preg->tipo . '</option>';
                }
                return ($total_options);
            }

            function FormularioEvaluacion($PRINCIPAL, $id_evaluacion)
            {
                $datos_evaluacion = DatosEvaluacion($id_evaluacion);
                $PRINCIPAL = str_replace("{NOM_EVALUACION}", utf8_encode($datos_evaluacion[0]->nombre_evaluacion), $PRINCIPAL);
                $PRINCIPAL = str_replace("{DES_EVALUACION}", utf8_encode($datos_evaluacion[0]->descripcion), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_EVALUACION_ENCODEADA}", Encodear3($id_evaluacion), $PRINCIPAL);
                if ($datos_evaluacion) {
                    $PRINCIPAL = str_replace("{VALOR_BOTON}", "Editar Evaluacion", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ACTION}", "?sw=edval", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{TITULO}", "Formulario Edici&oacute;n de Evaluacion", $PRINCIPAL);
                    //Combobox OPTIONS_TIPO_PREGUNTAS
                    $PRINCIPAL = str_replace("{OPTIONS_TIPO_PREGUNTAS}", OptionsTiposPreguntas(), $PRINCIPAL);
                    //Aca muestro el listado de las preguntas dada la evaluacion
                    //obtengo el listado de preguntas dado el id de evaluacion
                    //$preguntas=ListadoDePreguntasDadaEvaluacion($id_evaluacion);
                    $PRINCIPAL = str_replace("{LISTADO_PREGUNTAS_POR_EVALUACION}", MuestraListadoPreguntasPorEval($id_evaluacion), $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{VALOR_BOTON}", "Ingresar Evaluacion", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ACTION}", "?sw=adeval", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{TITULO}", "Formulario Ingreso de Evaluacion", $PRINCIPAL);
                }
                $PRINCIPAL = str_replace("{NOMBRE_FORMULARIO}", "FormEval", $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_TIPOS_OBJETOS}", OptionsTipoObjeto($datos_evaluacion[0]->tipo_objeto), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_CURSOS}", OptionsCursos($datos_evaluacion[0]->id_curso), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_OBJETO_ENCODEADO}", Encodear(Encodear($datos_evaluacion[0]->id)), $PRINCIPAL);
                //Combobox para las evaluaciones
                $PRINCIPAL = str_replace("{OPTIONS_EVALUACIONES}", OptionsEvaluaciones(), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function ListadoEvaluaciones($PRINCIPAL)
            {
                $evaluaciones = TotalEvaluaciones();
                $total_rows = "";
                if ($evaluaciones) {
                    $i = 1;
                    foreach ($evaluaciones as $eval) {
                        $row = file_get_contents("views/evaluaciones/row_listado_evaluacion.html");
                        $row = str_replace("{N}", $i, $row);
                        $row = str_replace("{NOMBRE_EVALUACION}", $eval->nombre_evaluacion, $row);
                        $row = str_replace("{DESCRIPCION}", $eval->descripcion, $row);
                        $row = str_replace("{NUMERO_PREGUNTAS}", $eval->total_preguntas, $row);
                        $row = str_replace("{ID_EVALUACION_ENCODEADO}", Encodear3($eval->id), $row);
                        $i++;
                        $total_rows .= $row;
                    }
                    $PRINCIPAL = str_replace("{ROW_LISTADO_EVALUACIONES}", utf8_encode($total_rows), $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{ROW_LISTADO_EVALUACIONES}", "<tr><td colspan='5'>No existen evaluaciones</td></tr>", $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function OptionsEvaluaciones()
            {
                //traigo el total de evaluaciones
                $evaluaciones = TotalEvaluaciones();
                $total_options = "";
                foreach ($evaluaciones as $eval) {
                    $total_options .= "<option value='" . $eval->id . "'>" . $eval->nombre_evaluacion . "</option>";
                }
                return ($total_options);
            }

            function SuboArchivo($FILES, $extension_archivo, $prefijo, $ruta)
            {
                if ($extension_archivo == "zip") {
                    //Primero copio el archivo a la ruta que debe ser
                    //$destino =  "../schoolv02/objetos/".$prefijo.".jpg";
                    $ruta_con_archivo = $ruta . "/" . $prefijo . "." . $extension_archivo;
                    copy($FILES['archivo']['tmp_name'], $ruta_con_archivo);
                    //Ahora que el archivo ZIP ya estÃ¡ guardado, se debe descomprimir
                    $zip = new ZipArchive;
                    if ($zip->open($ruta_con_archivo) === TRUE) {
                        $zip->extractTo($ruta . "/" . $prefijo);
                        $zip->close();
                        echo 'ok';
                    } else {
                        echo 'failed';
                    }
                } else {
                    $ruta_con_archivo = $ruta . "/" . $prefijo . "." . $extension_archivo;
                    copy($FILES['archivo']['tmp_name'], $ruta_con_archivo);
                    $nombre_imagen_thum = $_SESSION["id_empresa"] . "_thum_" . $prefijo . "." . $extension_archivo;
                    RedimensionarImagen($ruta_con_archivo, $nombre_imagen_thum, $extension_archivo);
                    RedimensionarImagenPortada($ruta_con_archivo, $prefijo . "." . $extension_archivo, $extension_archivo);
                }
                //Devuelvol un arreglo, con datos del archivo subido
                $arreglo[0] = $ruta_con_archivo;//Ruta Completa
                $arreglo[1] = $prefijo . "." . $extension_archivo;//Nombre del Archivo
                $arreglo[2] = $ruta . "/" . $prefijo;//Ruta del Objeto sin el index
                $arreglo[3] = $nombre_imagen_thum;
                return ($arreglo);
            }

            function MPSuboArchivoFoto($FILES, $extension_archivo, $prefijo, $ruta)
            {

                $ruta_con_archivo = $ruta . "/" . $prefijo . "." . $extension_archivo;

                // echo    " $ruta_con_archivo $ruta $prefijo $extension_archivo;    " ;sleep(5);
                copy($FILES['archivo']['tmp_name'], $ruta_con_archivo);
                $nombre_imagen_thum = $_SESSION["id_empresa"] . "_thum_" . $prefijo . "." . $extension_archivo;
                RedimensionarImagenPortadaFoto($ruta_con_archivo, $prefijo . "." . $extension_archivo, $extension_archivo);

                //Devuelvol un arreglo, con datos del archivo subido
                $arreglo[0] = $ruta_con_archivo;//Ruta Completa
                $arreglo[1] = $prefijo . "." . $extension_archivo;//Nombre del Archivo
                $arreglo[2] = $ruta . "/" . $prefijo;//Ruta del Objeto sin el index
                $arreglo[3] = $nombre_imagen_thum;
                return ($arreglo);
            }

            function SuboSliderImagen($FILES, $extension_archivo, $prefijo, $ruta)
            {

                $ruta_con_archivo = $ruta . "/" . $prefijo . "." . $extension_archivo;

                // echo    " $ruta_con_archivo $ruta $prefijo $extension_archivo;    " ;sleep(5);
                copy($FILES['archivo']['tmp_name'], $ruta_con_archivo);
                $nombre_imagen_thum = $_SESSION["id_empresa"] . "_thum_" . $prefijo . "." . $extension_archivo;
                RedimensionarImagenPortadaFoto($ruta_con_archivo, $prefijo . "." . $extension_archivo, $extension_archivo);

                //Devuelvol un arreglo, con datos del archivo subido
                $arreglo[0] = $ruta_con_archivo;//Ruta Completa
                $arreglo[1] = $prefijo . "." . $extension_archivo;//Nombre del Archivo
                $arreglo[2] = $ruta . "/" . $prefijo;//Ruta del Objeto sin el index
                $arreglo[3] = $nombre_imagen_thum;
                return ($arreglo);
            }

            function ListadoProgramasParaSelectMultiple()
            {
                $total_programas = TodosLosPrograma();
                $total_html = "";
                foreach ($total_programas as $prog) {
                    $total_html .= "<option value='" . $prog->id . "'>" . $prog->nombre . "</option>";
                }
                return (utf8_encode($total_html));
            }

            function ListadoCursosParaSelectMultiple()
            {
                $total_cursos = TotalCursos2();
                $total_html = "";
                foreach ($total_cursos as $curso) {
                    $total_html .= "<option value='" . $curso->id . "'>" . $curso->nombre . "</option>";
                }
                return (utf8_encode($total_html));
            }

            function ListadoRelacionesMallaPrograma($PRINCIPAL, $id_malla)
            {
                $datos_malla = DatosMalla($id_malla);
                $PRINCIPAL = str_replace("{ID_MALLA_ENCODEADO}", Encodear3($id_malla), $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOMBRE_MALLA}", utf8_encode($datos_malla[0]->nombre), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_PROGRAMAS}", ListadoProgramasParaSelectMultiple(), $PRINCIPAL);
                //Veo si existen relaciones nivel - curso
                $relaciones = RelMallaPrograma($id_malla);
                if ($relaciones) {
                    $total_row = "";
                    $i = 1;
                    foreach ($relaciones as $rel) {
                        $row = file_get_contents("views/malla/row_rel_malla_programa.html");
                        $row = str_replace("{NOMBRE_PROGRAMA}", utf8_encode($rel->nombre_programa), $row);
                        $row = str_replace("{N}", $i, $row);
                        $i++;
                        $total_row .= $row;
                    }
                    $PRINCIPAL = str_replace("{LISTADO_REL_MALLA_PROGRAMA}", $total_row, $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{LISTADO_REL_MALLA_PROGRAMA}", '
        <tr class="odd">
            <td colspan="4" class=" sorting_1">No Existen programas asociados a este nivel</td>
        </tr>', $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function ListadoRelacionesNivelCurso($PRINCIPAL, $id_nivel)
            {
                $datos_nivel = DatosNivel($id_nivel);
                $PRINCIPAL = str_replace("{ID_NIVEL_ENCODEADO}", Encodear3($id_nivel), $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOMBRE_NIVEL}", utf8_encode($datos_nivel[0]->nombre), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_CURSOS}", ListadoCursosParaSelectMultiple(), $PRINCIPAL);
                //Veo si existen relaciones nivel - curso
                $relaciones = RelNivelCurso($id_nivel);
                if ($relaciones) {
                    $total_row = "";
                    $i = 1;
                    foreach ($relaciones as $rel) {
                        $row = file_get_contents("views/nivel/row_rel_nivel_curso.html");
                        $row = str_replace("{NOMBRE_CURSO}", utf8_encode($rel->nombre), $row);
                        $row = str_replace("{N}", $i, $row);
                        $i++;
                        $row = str_replace("{MODALIDAD_CURSO}", utf8_encode($rel->modalidad_curso), $row);
                        $total_row .= $row;
                    }
                    $PRINCIPAL = str_replace("{LISTADO_REL_NIVEL_CURSO}", $total_row, $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{LISTADO_REL_NIVEL_CURSO}", '
        <tr class="odd">
            <td colspan="4" class=" sorting_1">No Existen Cursos asociados a este nivel</td>
        </tr>', $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function FormularioObjeto($PRINCIPAL, $id_objeto)
            {
                $datos_objeto = DatosObjeto($id_objeto);
                $PRINCIPAL = str_replace("{NOM_OBJETO}", utf8_encode($datos_objeto[0]->titulo), $PRINCIPAL);
                $PRINCIPAL = str_replace("{DES_OBJETO}", utf8_encode($datos_objeto[0]->descripcion), $PRINCIPAL);
                if ($datos_objeto) {
                    $PRINCIPAL = str_replace("{VALOR_BOTON}", "Editar Objeto", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ACTION}", "?sw=edobjeto", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{TITULO}", "Formulario Edici&oacute;n de Objetos", $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{VALOR_BOTON}", "Ingresar Objeto", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ACTION}", "?sw=adobjeto", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{TITULO}", "Formulario Ingreso de Objeto", $PRINCIPAL);
                }
                $PRINCIPAL = str_replace("{NOMBRE_FORMULARIO}", "FormObjeto", $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_TIPOS_OBJETOS}", OptionsTipoObjeto($datos_objeto[0]->tipo_objeto), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_CURSOS}", OptionsCursos($datos_objeto[0]->id_curso), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_OBJETO_ENCODEADO}", Encodear(Encodear($datos_objeto[0]->id)), $PRINCIPAL);
                //Combobox para las evaluaciones
                $PRINCIPAL = str_replace("{OPTIONS_EVALUACIONES}", OptionsEvaluaciones(), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function FormularioCurso($PRINCIPAL, $id_curso)
            {
                $datos_curso = DatosCurso($id_curso);
                $PRINCIPAL = str_replace("{NOM_CURSO}", utf8_encode($datos_curso[0]->nombre), $PRINCIPAL);
                $PRINCIPAL = str_replace("{DES_CURSO}", utf8_encode($datos_curso[0]->descripcion), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OBJETIVO_CURSO}", utf8_encode($datos_curso[0]->objetivo_curso), $PRINCIPAL);
                $PRINCIPAL = str_replace("{NUMERO_HORAS}", utf8_encode($datos_curso[0]->numero_horas), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_MAXIMA_PARTICIPANTES}", utf8_encode($datos_curso[0]->cantidad_maxima_participantes), $PRINCIPAL);
                $PRINCIPAL = str_replace("{TIPO_CURSO}", utf8_encode($datos_curso[0]->tipo), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CHECKED" . $datos_curso[0]->sence . "}", "checked", $PRINCIPAL);
                $PRINCIPAL = str_replace("{CHECKED" . $datos_curso[0]->cbc . "CBC}", "checked", $PRINCIPAL);
                $PRINCIPAL = str_replace("{PREREQUISITO_CURSO}", utf8_encode($datos_curso[0]->prerequisito), $PRINCIPAL);
                $PRINCIPAL = str_replace("{COD_SENCE}", utf8_encode($datos_curso[0]->cod_sence), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALOR_HORA}", utf8_encode($datos_curso[0]->valor_hora), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALOR_HORA_SENCE}", utf8_encode($datos_curso[0]->valor_hora_sence), $PRINCIPAL);
                $PRINCIPAL = str_replace("{COD_IDENTIFICADOR}", utf8_encode($datos_curso[0]->numero_identificador), $PRINCIPAL);
                $PRINCIPAL = str_replace("{NUMERO_IDENTIFICADOR}", utf8_encode($datos_curso[0]->numero_identificador), $PRINCIPAL);
                if ($datos_curso) {
                    $PRINCIPAL = str_replace("{VALOR_BOTON}", "Editar Curso", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ACTION}", "?sw=edcurso", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{TITULO}", "Formulario Edici&oacute;n de Cursos", $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{VALOR_BOTON}", "Ingresar Curso", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ACTION}", "?sw=adcurso", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{TITULO}", "Formulario Ingreso de Cursos", $PRINCIPAL);
                }
                $PRINCIPAL = str_replace("{NOMBRE_FORMULARIO}", "FormCurso", $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_MODALIDAD}", OptionsModalidad($datos_curso[0]->modalidad), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_CLASIFICACION}", OptionsGenericoNombreDadoValores("tbl_curso_clasificacion", $datos_curso[0]->clasificacion, "clasificacion", "id"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_RUT_OTEC}", OptionsGenericoNombreDadoValores("tbl_otec", $datos_curso[0]->rut_otec, "nombre", "rut"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_CURSO_ENCODEADO}", Encodear(Encodear($datos_curso[0]->id)), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_TIPO_CURSO}", OptionsGenericoNombreDadoValores("tbl_curso_tipo", $datos_curso[0]->tipo, "nombre", "id"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{SELSENCE" . trim($datos_curso[0]->sence) . "}", "selected='selected'", $PRINCIPAL);
                $PRINCIPAL = str_replace("{SELCBC" . trim($datos_curso[0]->cbc) . "}", "selected='selected'", $PRINCIPAL);
                if ($datos_curso[0]->sence == "si") {
                    $PRINCIPAL = str_replace("{STYLE_DISPLAY_COD_SENCE}", '', $PRINCIPAL);
                    $PRINCIPAL = str_replace("{STYLE_DISPLAY_NUM_IDEN}", 'style="display:none;"', $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{STYLE_DISPLAY_COD_SENCE}", 'style="display:none;"', $PRINCIPAL);
                    $PRINCIPAL = str_replace("{STYLE_DISPLAY_NUM_IDEN}", '', $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function ListadoRelacionesMasivosPrevio($id_empresa)
            {
                //$total=RelacionesTemporal($id_empresa);
                $total = TotalRelacionesTemp($id_empresa);
                $listado = file_get_contents("views/sgd_relaciones/entorno_listado_previa_relaciones.html");
                foreach ($total as $unico) {
                    $row .= '<tr class="{ETIQUETA}">
                                            <td class="miniSt">' . $unico->evaluado . '</td>
                                         <td class="miniSt">' . $unico->evaluador . '</td>
                                         <td class="miniSt">' . $unico->perfil_evaluacion_competencias . '</td>
                                                <td class="miniSt">' . $unico->subperfil . '</td>
                                                <td class="miniSt">' . $unico->calibrador . '</td>
                                                <td class="miniSt">' . $unico->comentario . '</td>
                </tr>';
                }
                $listado = str_replace("{ROW_LISTADO}", $row, $listado);
                return ($listado);
            }

            function FormularioUsuario($PRINCIPAL, $rut, $id_empresa)
            {
                if ($rut != "") {
                    $datos_usuario = UsuarioEnBasePersonas($rut);
                    $claves = buscaclave($rut);
                    $secret = "goprogo2017";
                    $word = base64_encode($secret) . base64_encode($rut);
                    $PRINCIPAL = str_replace("{FOTO}", VerificaFotoPersonalDesdeAdmin($datos_usuario[0]->rut), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_RUT}", utf8_encode($datos_usuario[0]->rut), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_RUT_COMPLETO}", utf8_encode($datos_usuario[0]->rut_completo), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_CLAVE}", utf8_encode($claves[0]->clave), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{WORD}", $word, $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_DV}", utf8_encode($datos_usuario[0]->dv), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_NOMBRE}", utf8_encode($datos_usuario[0]->nombre), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_NOMBRE_COMPLETO}", utf8_encode($datos_usuario[0]->nombre_completo), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_APATERNO}", utf8_encode($datos_usuario[0]->apaterno), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_AMATERNO}", utf8_encode($datos_usuario[0]->amaterno), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_FECHA_INGRESO}", utf8_encode($datos_usuario[0]->fecha_ingreso), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_FECHA_NAC}", utf8_encode($datos_usuario[0]->fecha_nacimiento), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_EMAIL}", utf8_encode($datos_usuario[0]->email), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_TELEFONO}", utf8_encode($datos_usuario[0]->telefono), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_ANEXO}", utf8_encode($datos_usuario[0]->anexo), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_JEFE}", utf8_encode($datos_usuario[0]->jefe), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_CELULAR}", utf8_encode($datos_usuario[0]->celular), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_GENERO}", utf8_encode($datos_usuario[0]->genero), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_NACIONALIDAD}", utf8_encode($datos_usuario[0]->nacionalidad), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_DIRECCION_PARTICULAR}", utf8_encode($datos_usuario[0]->direccion_particular), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_CODIGO_ESCOLARIDAD}", utf8_encode($datos_usuario[0]->codigo_escolaridad), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_CODIGO_NIVEL}", utf8_encode($datos_usuario[0]->codigo_nivel), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_GERENCIA}", utf8_encode($datos_usuario[0]->gerencia), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_IDGERENCIA}", utf8_encode($datos_usuario[0]->id_gerencia), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_CARGO}", utf8_encode($datos_usuario[0]->cargo), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_IDCARGO}", utf8_encode($datos_usuario[0]->id_cargo), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_SUBGERENCIA}", utf8_encode($datos_usuario[0]->subgerencia), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_IDSUBGERENCIA}", utf8_encode($datos_usuario[0]->id_subgerencia), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_UNIDAD_NEGOCIO}", utf8_encode($datos_usuario[0]->unidad_negocio), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_IDUNIDAD_NEGOCIO}", utf8_encode($datos_usuario[0]->id_unidad_negocio), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_CENTRO_COSTO}", utf8_encode($datos_usuario[0]->centro_costo), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_IDCENTRO_COSTO}", utf8_encode($datos_usuario[0]->id_centro_costo), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_DEPARTAMENTO}", utf8_encode($datos_usuario[0]->departamento), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_ZONA}", utf8_encode($datos_usuario[0]->zona), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_PERFIL_COMPETENCIA}", utf8_encode($datos_usuario[0]->perfil_competencia), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_DIVISION}", utf8_encode($datos_usuario[0]->division), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_SUCURSAL}", utf8_encode($datos_usuario[0]->sucursal), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_REGIONAL}", utf8_encode($datos_usuario[0]->regional), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_ZONAL}", utf8_encode($datos_usuario[0]->zonal), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_TIPO_SERVICIO}", utf8_encode($datos_usuario[0]->tipo_servicio), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_MUNDO}", utf8_encode($datos_usuario[0]->mundo), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_RESPONSABLE}", utf8_encode($datos_usuario[0]->responsable), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_AVATAR}", utf8_encode($datos_usuario[0]->avatar), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_NOMBRE_EMPRESA_HOLDING}", utf8_encode($datos_usuario[0]->nombre_empresa_holding), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_EMPRESA_HOLDING}", utf8_encode($datos_usuario[0]->empresa_holding), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_NOMBRE_JEFATURA}", utf8_encode($datos_usuario[0]->nombre_jefatura), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_NOMBRE_JEFATURA}", utf8_encode($datos_usuario[0]->nombre_jefatura), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_FECHA_NACIMIENTO}", utf8_encode($datos_usuario[0]->fecha_nacimiento), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_VICEPRESIDENCIA}", utf8_encode($datos_usuario[0]->vicepresidencia), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_NOMBREJEFATURA}", utf8_encode($datos_usuario[0]->nombre_jefatura), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_GERENCIAR2}", utf8_encode($datos_usuario[0]->gerenciaR2), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_GERENCIAR1}", utf8_encode($datos_usuario[0]->gerencia), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_GERENCIAR3}", utf8_encode($datos_usuario[0]->gerenciaR3), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_AREA}", utf8_encode($datos_usuario[0]->area), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_ORGANICA}", utf8_encode($datos_usuario[0]->organica), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_UBICACION}", utf8_encode($datos_usuario[0]->ubicacion), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_EMPRESAHOLDING}", utf8_encode($datos_usuario[0]->nombre_empresa_holding), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_RUTEMPRESAHOLDING}", utf8_encode($datos_usuario[0]->empresa_holding), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_FECHA_ANTIGUEDAD}", utf8_encode($datos_usuario[0]->fecha_antiguedad), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_TIPO_CONTRATO}", utf8_encode($datos_usuario[0]->tipo_contrato), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_TRAMO_SENCE}", utf8_encode($datos_usuario[0]->tramo_sence), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_PERFILCOMPETENCIA}", utf8_encode($datos_usuario[0]->perfil_competencia), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_IDPERFILCOMPETENCIA}", utf8_encode($datos_usuario[0]->id_perfil_competencia), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{OPTIONS_CODIGO_ESCOLARIDAD}", OptionsGenericoNombreDadoValores("tbl_codigo_escolaridad", $datos_usuario[0]->codigo_escolaridad, "codigo", "nivel"), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{OPTIONS_CODIGO_NIVEL}", OptionsGenericoNombreDadoValores("tbl_codigo_nivel", $datos_usuario[0]->codigo_nivel, "codigo", "nivel"), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{OPTIONS_TIPO_CONTRATO}", OptionsGenericoNombreDadoValores("tbl_tipo_contrato", $datos_usuario[0]->tipo_contrato, "descripcion", "descripcion"), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{OPTION_TRAMO_SENCE}", OptionsGenericoNombreDadoValores("tbl_tramo_sence", $datos_usuario[0]->tramo_sence, "descripcion", "descripcion"), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{OPTIONS_EMPRESA_HOLDING}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_empresa_holding", $datos_usuario[0]->empresa_holding, "empresa", "rut", "order by empresa", $_SESSION["id_empresa"]), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{OPTIONS_GERENCIAS}", OptionsGenericoPorEmpresa("gerencia", "tbl_usuario", utf8_encode($datos_usuario[0]->gerencia), $_SESSION["id_empresa"]), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{OPTIONS_CENTRO_COSTO}", OptionsGenericoPorEmpresa("centro_costo", "tbl_usuario", utf8_encode($datos_usuario[0]->centro_costo), $_SESSION["id_empresa"]), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{OPTIONS_UNIDAD_NEGOCIO}", OptionsGenericoPorEmpresa("unidad_negocio", "tbl_usuario", utf8_encode($datos_usuario[0]->unidad_negocio), $_SESSION["id_empresa"]), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{OPTIONS_PERFIL_EVALUACION}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_sgd_perfiles_ponderaciones", $datos_usuario[0]->perfil_evaluacion, "descripcion", "perfil", "order by descripcion asc", $_SESSION["id_empresa"]), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_OPERADOR}", utf8_encode($datos_usuario[0]->operador), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_PAIS}", utf8_encode($datos_usuario[0]->pais), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_FAMILIA_CARGO}", utf8_encode($datos_usuario[0]->familia_cargo), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_TIPO_CARGO}", utf8_encode($datos_usuario[0]->tipo_cargo), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VA_CODIGO_SAP}", utf8_encode($datos_usuario[0]->codigo_sap), $PRINCIPAL);
                    //SELECCIONA COMBO GENERO}
                    if ($datos_usuario[0]->genero == "m" || $datos_usuario[0]->genero == "M") {
                        $PRINCIPAL = str_replace("{GENEROM}", "selected", $PRINCIPAL);
                    }
                    if ($datos_usuario[0]->genero == "f" || $datos_usuario[0]->genero == "F") {
                        $PRINCIPAL = str_replace("{GENEROF}", "selected", $PRINCIPAL);
                    }
                    //FIN COMBO GENERO
                    $PRINCIPAL = str_replace("{VALOR_BOTON}", "Editar Usuario", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ACTION}", "?sw=edusuario", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{TITULO}", "Formulario Edici&oacute;n de Usuarios", $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{OPTIONS_CODIGO_ESCOLARIDAD}", OptionsGenericoNombreDadoValores("tbl_codigo_escolaridad", $datos_usuario[0]->codigo_escolaridad, "codigo", "nivel"), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{OPTIONS_CODIGO_NIVEL}", OptionsGenericoNombreDadoValores("tbl_codigo_nivel", $datos_usuario[0]->codigo_nivel, "codigo", "nivel"), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{OPTIONS_TIPO_CONTRATO}", OptionsGenericoNombreDadoValores("tbl_tipo_contrato", $datos_usuario[0]->tipo_contrato, "descripcion", "descripcion"), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{OPTION_TRAMO_SENCE}", OptionsGenericoNombreDadoValores("tbl_tramo_sence", $datos_usuario[0]->tramo_sence, "descripcion", "descripcion"), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{OPTIONS_PERFIL_EVALUACION}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_sgd_perfiles_ponderaciones", $datos_usuario[0]->perfil_evaluacion, "descripcion", "perfil", "order by descripcion asc", $_SESSION["id_empresa"]), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{FOTO}", "./img/foto_perfil1.jpg", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VALOR_BOTON}", "Ingresar Usuario", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ACTION}", "?sw=adsuario", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{TITULO}", "Formulario Ingreso de Usuarios", $PRINCIPAL);
                }
                $tres_campos_empresa = TraeCampos($id_empresa);
                $PRINCIPAL = str_replace("{REQUIRED_" . $tres_campos_empresa[0]->campo1 . "}", "required", $PRINCIPAL);
                $PRINCIPAL = str_replace("{REQUIRED_" . $tres_campos_empresa[0]->campo2 . "}", "required", $PRINCIPAL);
                $PRINCIPAL = str_replace("{REQUIRED_" . $tres_campos_empresa[0]->campo3 . "}", "required", $PRINCIPAL);
                $PRINCIPAL = str_replace("{TOTALU}", colocarPesos($totalusuarios), $PRINCIPAL);
                $totalusuarios = CuentaUsuarios($id_empresa);
                $PRINCIPAL = str_replace("{TOTALU}", colocarPesos($totalusuarios), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_EMPRESA}", $id_empresa, $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function FormularioNivel($PRINCIPAL, $id_nivel)
            {
                $datos_nivel = DatosNivel($id_nivel);
                $PRINCIPAL = str_replace("{NOM_NIVEL}", utf8_encode($datos_nivel[0]->nombre), $PRINCIPAL);
                $PRINCIPAL = str_replace("{DES_NIVEL}", utf8_encode($datos_nivel[0]->descripcion), $PRINCIPAL);
                if ($datos_nivel) {
                    $PRINCIPAL = str_replace("{VALOR_BOTON}", "Editar Nivel", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ACTION}", "?sw=ednivel", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{TITULO}", "Formulario Edici&oacute;n de Niveles", $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{VALOR_BOTON}", "Ingresar Nivel", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ACTION}", "?sw=adnivel", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{TITULO}", "Formulario Ingreso de Niveles", $PRINCIPAL);
                }
                $PRINCIPAL = str_replace("{NOMBRE_FORMULARIO}", "FormNivel", $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_TUTORES}", OptionsTutores($datos_nivel[0]->tutor), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_PROGRAMAS}", OptionsProgramas($datos_nivel[0]->id_programa), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_PROGRAMA_ENCODEADO}", Encodear(Encodear($datos_nivel[0]->id)), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function ListadoNivelesAdmin($PRINCIPAL)
            {
                //Traigo el total de empresas que existen en el sistema
                $niveles = TotalNiveles();
                $total_html = "";
                $i = 1;
                foreach ($niveles as $unico) {
                    $row = file_get_contents("views/nivel/row_listado.html");
                    $row = str_replace("{NUMERO}", $i, $row);
                    $i++;
                    $row = str_replace("{CODIGO}", $unico->id, $row);
                    $row = str_replace("{CODIGO_ENCODEADO}", Encodear($unico->id), $row);
                    $row = str_replace("{NOMBRE}", $unico->nombre, $row);
                    $row = str_replace("{DESCRIPCION}", $unico->descripcion, $row);
                    $row = str_replace("{TUTOR}", $unico->nombre_completo, $row);
                    $row = str_replace("{MALLA}", $unico->nombre_malla, $row);
                    $row = str_replace("{PROGRAMA}", $unico->nombre_programa, $row);
                    $total_html .= $row;
                }
                if ($niveles) {
                    $PRINCIPAL = str_replace("{ROW_LISTADO}", utf8_encode($total_html), $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{ROW_LISTADO}", "<tr><td colspan='7'>No existen niveles ingresados en la base de datos</td></tr>", $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function ListadoUsuariosProProcesoEnvioCorreo($PRINCIPAL, $id_proceso)
            {
                //Traigo el total de usuarios por el proceso
                $usuarios = TraigoUsuariosDadoIdPRocesoTotal($id_proceso);
                $total_html = "";
                $i = 1;
                foreach ($usuarios as $unico) {
                    $row = file_get_contents("views/correos/row_listado_usuarios_por_proceso_reenvia.html");
                    $row = str_replace("{NUMERO}", $i, $row);
                    $i++;
                    $row = str_replace("{NOMBRE}", $unico->nombre_completo, $row);
                    $row = str_replace("{RUT}", $unico->rut, $row);
                    $row = str_replace("{RUT_ENCODEADO}", Encodear3($unico->rut), $row);
                    $row = str_replace("{CARGO}", $unico->cargo, $row);
                    $row = str_replace("{GERENCIA}", $unico->gerencia, $row);
                    $row = str_replace("{EMAIL}", $unico->email, $row);
                    $row = str_replace("{CANTIDAD_ENVIOS}", $unico->total_envios, $row);
                    $row = str_replace("{OPTIONS_TIPOS_CORREOS}", utf8_decode(OptionsGenericoNombreDadoValoresPorEmpresa("tbl_correos", "", "asunto", "id", "order by asunto", $_SESSION["id_empresa"])), $row);
                    $total_html .= $row;
                }
                if ($usuarios) {
                    $PRINCIPAL = str_replace("{ROW_LISTADO_USUARIOS_DETALLE}", utf8_encode($total_html), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ID_PROCESO_ENCODEADO}", Encodear3($id_proceso), $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{LISTADO_USUARIOS}", "<tr><td colspan='7'>No existen niveles ingresados en la base de datos</td></tr>", $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function formularioOtec($PRINCIPAL, $rut_otec)
            {
                if ($rut_otec) {
                    $PRINCIPAL = str_replace("{TITULO}", "Formulario de EdiciÃ³n de OTEC", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VALOR_BOTON}", "Editar Datos", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ACTION}", "?sw=edotec", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{READONLY}", "readonly", $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{TITULO}", "Formulario de Ingreso de OTEC", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VALOR_BOTON}", "Ingresar OTEC", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ACTION}", "?sw=agreotec", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{READONLY}", "", $PRINCIPAL);
                }
                $datos_otec = DatosOtecDadoRut($rut_otec);
                $PRINCIPAL = str_replace("{ID_OTEC_ENCODEADO}", Encodear3($datos_otec[0]->id), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_RUT_OTEC}", utf8_encode($rut_otec), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_NOMBRE_OTEC}", utf8_encode($datos_otec[0]->nombre), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_DIRECCION_OTEC}", utf8_encode($datos_otec[0]->direccion), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_TELEFONO_OTEC}", utf8_encode($datos_otec[0]->telefono), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_EMAIL_OTEC}", utf8_encode($datos_otec[0]->email), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_CONTACTO_OTEC}", utf8_encode($datos_otec[0]->contacto), $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOMBRE_FORMULARIO}", "FormOtec", $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function ListadoOtec($PRINCIPAL, $id_empresa)
            {
                //Traigo el total de empresas que existen en el sistema
                $otecs = TraeOtec($id_empresa);
                $total_html = "";
                $i = 1;
                foreach ($otecs as $unico) {
                    $row = file_get_contents("views/otec/row_listado.html");
                    $row = str_replace("{RUT}", $unico->rut, $row);
                    $row = str_replace("{RUT_OTEC_ENCODEADO}", Encodear3($unico->rut), $row);
                    $row = str_replace("{NOMBRE}", $unico->nombre, $row);
                    $row = str_replace("{DIRECCION}", $unico->direccion, $row);
                    $row = str_replace("{TELEFONO}", $unico->telefono, $row);
                    $row = str_replace("{EMAIL}", $unico->email, $row);
                    $row = str_replace("{CONTACTO}", $unico->contacto, $row);
                    $total_html .= $row;
                }
                $PRINCIPAL = str_replace("{ROW_LISTADO}", utf8_encode($total_html), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function ListadoOtecBK($PRINCIPAL, $id_empresa)
            {
                //Traigo el total de empresas que existen en el sistema
                $otecs = TotalOtecs($id_empresa);
                $total_html = "";
                $i = 1;
                foreach ($otecs as $unico) {
                    $row = file_get_contents("views/otec/row_listado.html");
                    $row = str_replace("{NUMERO}", $i, $row);
                    $i++;
                    $row = str_replace("{RUT}", $unico->rut, $row);
                    $row = str_replace("{RUT_OTEC_ENCODEADO}", Encodear3($unico->rut), $row);
                    $row = str_replace("{NOMBRE}", $unico->nombre, $row);
                    $row = str_replace("{DIRECCION}", $unico->direccion, $row);
                    $row = str_replace("{TELEFONO}", $unico->telefono, $row);
                    $row = str_replace("{EMAIL}", $unico->email, $row);
                    $row = str_replace("{CONTACTO}", $unico->contacto, $row);
                    $total_html .= $row;
                }
                if ($otecs) {
                    $PRINCIPAL = str_replace("{ROW_LISTADO}", utf8_encode($total_html), $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{ROW_LISTADO}", "<tr><td colspan='8'>No existen Objetos ingresados en la base de datos</td></tr>", $PRINCIPAL);
                }
                $PRINCIPAL = str_replace("{PAGINACION}", ArmaPaginacionGenerico($pagina, "listotec", "tbl_otec", 10, $arreglo_post, $id_empresa), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function ListadoProcesosCorreos($PRINCIPAL, $id_empresa)
            {
                //Traigo el total de empresas que existen en el sistema
                $listado = TotalProcesosDeCorreos($id_empresa);
                $total_html = "";
                $i = 1;
                foreach ($listado as $unico) {
                    $row = file_get_contents("views/correos/row_listado.html");
                    $row = str_replace("{NUMERO}", $i, $row);
                    $i++;
                    $Txt_textos = "Asunto: " . $unico->subject . "<br>Titulo: " . $unico->titulo1 . "<br>Subtitulo: " . $unico->subtitulo1 .
                        "<br>Texto1: " . $unico->texto1 . "<br>Texto2: " . $unico->texto2 . "<br>Texto3: " . $unico->texto3 . "<br>Texto4: " . $unico->texto4 .
                        "<br>Texto Url: " . $unico->texto_url . "<br>Url: " . $unico->url;
                    $row = str_replace("{DESCRIPCION}", $unico->descripcion, $row);
                    $row = str_replace("{TEXTOS}", $Txt_textos, $row);
                    $row = str_replace("{ID_PROCESO_ENCODEADO}", Encodear3($unico->id), $row);
                    $row = str_replace("{CANTIDAD}", $unico->total_usuarios_por_inscripcion, $row);
                    $row = str_replace("{NOMBRE}", $unico->nombre, $row);
                    $total_html .= $row;
                }
                if ($listado) {
                    $PRINCIPAL = str_replace("{ROW_LISTADO}", utf8_encode($total_html), $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{ROW_LISTADO}", "<tr><td colspan='8'>No existen Objetos ingresados en la base de datos</td></tr>", $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function ListadoObjetosAdmin($PRINCIPAL)
            {
                //Traigo el total de empresas que existen en el sistema
                $objetos = TotalObjetos();
                $total_html = "";
                $i = 1;
                foreach ($objetos as $unico) {
                    $row = file_get_contents("views/objeto/row_listado.html");
                    $row = str_replace("{NUMERO}", $i, $row);
                    $i++;
                    $row = str_replace("{CODIGO}", $unico->id, $row);
                    $row = str_replace("{CODIGO_ENCODEADO}", Encodear($unico->id), $row);
                    $row = str_replace("{NOMBRE}", $unico->titulo, $row);
                    $row = str_replace("{DESCRIPCION}", $unico->descripcion, $row);
                    $row = str_replace("{TIPO_OBJETO}", $unico->nombre_objeto, $row);
                    $row = str_replace("{CURSO}", $unico->nombre_curso, $row);
                    $total_html .= $row;
                }
                if ($objetos) {
                    $PRINCIPAL = str_replace("{ROW_LISTADO}", utf8_encode($total_html), $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{ROW_LISTADO}", "<tr><td colspan='8'>No existen Objetos ingresados en la base de datos</td></tr>", $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function ListadoCursosAdmin($PRINCIPAL, $arreglo_post, $pagina, $id_empresa)
            {
                $total_por_pagina = 10;
                //Traigo el total de empresas que existen en el sistema
                /*if($pagina==0){
        $cursos=TotalCursos($arreglo_post);
    }else{
        $cursos=TotalCursosParaPaginacion($arreglo_post, $pagina);
    }*/
                $cursos = TotalCursosParaPaginacion($arreglo_post, $pagina, $id_empresa);
                $total_html = "";
                $i = 1;
                foreach ($cursos as $unico) {
                    $row = file_get_contents("views/curso/row_listado.html");
                    $row = str_replace("{NUMERO}", $i, $row);
                    $i++;
                    $row = str_replace("{CODIGO}", $unico->numero_identificador, $row);
                    $row = str_replace("{CODIGO_ENCODEADO}", Encodear($unico->id), $row);
                    $row = str_replace("{NOMBRE}", $unico->nombre, $row);
                    $row = str_replace("{DESCRIPCION}", $unico->descripcion, $row);
                    $row = str_replace("{OBJETIVO_CURSO}", $unico->objetivo_curso, $row);
                    $row = str_replace("{CLASIFICACION}", $unico->nombre_clasificacion, $row);
                    $row = str_replace("{SENCE}", $unico->sence, $row);
                    $row = str_replace("{PARTICIPANTES_MAX}", $unico->cantidad_maxima_participantes, $row);
                    $row = str_replace("{OTEC}", $unico->nombre_otec, $row);
                    $row = str_replace("{CBC}", $unico->cbc, $row);
                    $row = str_replace("{MODALIDAD}", $unico->nombre_modalidad, $row);
                    //$row = str_replace("{TIPO}",$unico->tipo,$row);
                    $row = str_replace("{TIPO}", $unico->nombre_tipo_curso, $row);
                    $row = str_replace("{PREREQUISITOS}", $unico->prerequisito, $row);
                    $row = str_replace("{VALOR_HORA}", colocarPesos($unico->valor_hora), $row);
                    $row = str_replace("{VALOR_HORA_SENCE}", colocarPesos($unico->valor_hora_sence), $row);
                    $row = str_replace("{NUM_HORAS}", $unico->numero_horas, $row);
                    $row = str_replace("{VALOR_CURSO}", colocarPesos($unico->numero_horas * $unico->valor_hora), $row);
                    $total_html .= $row;
                }
                if ($cursos) {
                    $PRINCIPAL = str_replace("{ROW_LISTADO}", utf8_encode($total_html), $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{ROW_LISTADO}", "<tr><td colspan='8'>No existen cursos ingresados en la base de datos</td></tr>", $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function OptionsTipoObjeto($id_tipo_objeto)
            {
                $total_tipos_objetos = TotalTiposObjetos();
                $select = "";
                foreach ($total_tipos_objetos as $tipo) {
                    if ($tipo->id == $id_tipo_objeto) {
                        $select .= '<option selected value="' . $tipo->id . '">' . $tipo->nombre . '</option>';
                    } else {
                        $select .= '<option value="' . $tipo->id . '">' . $tipo->nombre . '</option>';
                    }
                }
                return (utf8_encode($select));
            }

            function OptionsCursos($id_curso)
            {
                $total_cursos = TotalCursos();
                $select = "";
                foreach ($total_cursos as $curso) {
                    if ($curso->id == $id_curso) {
                        $select .= '<option selected value="' . $curso->id . '">' . $curso->nombre . '</option>';
                    } else {
                        $select .= '<option value="' . $curso->id . '">' . $curso->nombre . '</option>';
                    }
                }
                return (utf8_encode($select));
            }

            function OptionsModalidad($id_modalidad)
            {
                $total_modalidad = TotalModalidad2();
                $select = "";
                foreach ($total_modalidad as $modalidad) {
                    if ($modalidad->id == $id_modalidad) {
                        $select .= '<option selected value="' . $modalidad->id . '">' . $modalidad->modalidad . '</option>';
                    } else {
                        $select .= '<option value="' . $modalidad->id . '">' . $modalidad->modalidad . '</option>';
                    }
                }
                return (utf8_encode($select));
            }

            function OptionsTutores($rut_tutor)
            {
                $total_tutores = TotalTutores();
                $select = "";
                foreach ($total_tutores as $tutor) {
                    if ($tutor->rut == $rut_tutor) {
                        $select .= '<option selected value="' . $tutor->rut . '">' . $tutor->nombre_completo . '</option>';
                    } else {
                        $select .= '<option value="' . $tutor->rut . '">' . $tutor->nombre_completo . '</option>';
                    }
                }
                return (utf8_encode($select));
            }

            function OptionsProgramas($id_programa)
            {
                $total_programas = TotalProgramas();
                $select = "";
                foreach ($total_programas as $programa) {
                    if ($programa->id == $id_programa) {
                        $select .= '<option selected value="' . $programa->id . '">' . $programa->nombre . '</option>';
                    } else {
                        $select .= '<option value="' . $programa->id . '">' . $programa->nombre . '</option>';
                    }
                }
                return (utf8_encode($select));
            }

            function OptionsMallas($id_malla)
            {
                $total_mallas = TotalMallas();
                $select = "";
                $select .= '<option selected value="">111</option>';
                foreach ($total_mallas as $malla) {
                    if ($malla->id == $id_malla) {
                        $select .= '<option selected value="' . $malla->id . '">' . $malla->nombre . '</option>';
                    } else {
                        $select .= '<option value="' . $malla->id . '">' . $malla->nombre . '</option>';
                    }
                }
                return ($select);
            }

            function FormularioPrograma($PRINCIPAL, $id_programa)
            {
                $datos_programa = DatosPrograma($id_programa);
                $PRINCIPAL = str_replace("{NOM_PROGRAMA}", utf8_encode($datos_programa[0]->nombre), $PRINCIPAL);
                $PRINCIPAL = str_replace("{DES_PROGRAMA}", utf8_encode($datos_programa[0]->descripcion), $PRINCIPAL);
                if ($id_programa) {
                    $PRINCIPAL = str_replace("{VALOR_BOTON}", "Editar Programa", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ACTION}", "?sw=edprograma", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{TITULO}", "Formulario Edici&oacute;n de Programas", $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{VALOR_BOTON}", "Ingresar Programa", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ACTION}", "?sw=adprograma", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{TITULO}", "Formulario Ingreso de Programas", $PRINCIPAL);
                }
                $PRINCIPAL = str_replace("{NOMBRE_FORMULARIO}", "FormPrograma", $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_MALLAS}", OptionsMallas($datos_programa[0]->id_malla), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_PROGRAMA_ENCODEADO}", Encodear(Encodear($datos_programa[0]->id)), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function ListadoProgramasAdmin($PRINCIPAL)
            {
                //Traigo el total de empresas que existen en el sistema
                $programas = TotalProgramas();
                $total_html = "";
                $i = 1;
                foreach ($programas as $unico) {
                    $row = file_get_contents("views/programa/row_listado.html");
                    $row = str_replace("{NUMERO}", $i, $row);
                    $i++;
                    $row = str_replace("{CODIGO}", $unico->id, $row);
                    $row = str_replace("{CODIGO_ENCODEADO}", Encodear($unico->id), $row);
                    $row = str_replace("{NOMBRE}", $unico->nombre, $row);
                    $row = str_replace("{DESCRIPCION}", $unico->descripcion, $row);
                    $row = str_replace("{MALLA}", $unico->nombre_malla, $row);
                    $total_html .= $row;
                }
                if ($programas) {
                    $PRINCIPAL = str_replace("{ROW_LISTADO}", utf8_encode($total_html), $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{ROW_LISTADO}", "<tr><td colspan='5'>No existen programas ingresados en la base de datos</td></tr>", $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function FormularioMalla($PRINCIPAL, $id_malla)
            {
                $datos_malla = DatosMalla($id_malla);
                $PRINCIPAL = str_replace("{COD_MALLA}", Encodear(Encodear($datos_malla[0]->id)), $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOM_MALLA}", utf8_encode($datos_malla[0]->nombre), $PRINCIPAL);
                $PRINCIPAL = str_replace("{DES_MALLA}", utf8_encode($datos_malla[0]->descripcion), $PRINCIPAL);
                $PRINCIPAL = str_replace("{EM_EMPRESA}", $datos_empresa[0]->correo, $PRINCIPAL);
                if ($id_malla) {
                    $PRINCIPAL = str_replace("{VALOR_BOTON}", "Editar", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ACTION}", "?sw=edmallla", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{TITULO}", "Formulario Edici&oacute;n de Malla", $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{VALOR_BOTON}", "Ingresar", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ACTION}", "?sw=admallla", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{TITULO}", "Formulario Ingreso de Malla", $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function ListadoMallas($PRINCIPAL)
            {
                //Traigo el total de empresas que existen en el sistema
                $mallas = TotalMallas();
                $total_mallas = "";
                $i = 1;
                foreach ($mallas as $unico) {
                    $row = file_get_contents("views/malla/row_listado_malla.html");
                    $row = str_replace("{NUMERO}", $i, $row);
                    $i++;
                    $row = str_replace("{CODIGO_MALLA}", $unico->id, $row);
                    $row = str_replace("{CODIGO_MALLA_ENCODEADO}", Encodear($unico->id), $row);
                    $row = str_replace("{NOMBRE_MALLA}", $unico->nombre, $row);
                    $row = str_replace("{TIPO_MALLA}", $unico->tipo, $row);
                    $row = str_replace("{CORREO_RESPONSABLE}", $unico->correo, $row);
                    $total_mallas .= $row;
                }
                if ($mallas) {
                    $PRINCIPAL = str_replace("{ROW_LISTADO_MALLAS}", utf8_encode($total_mallas), $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{ROW_LISTADO_MALLAS}", "<tr><td colspan='5'>No existen mallas en la base de datos</td></tr>", $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function FormularioEmpresa($PRINCIPAL, $id_empresa)
            {
                $datos_empresa = DatosEmpresa($id_empresa);
                $PRINCIPAL = str_replace("{COD_EMPRESA}", $datos_empresa[0]->cod_empresa, $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOM_EMPRESA}", $datos_empresa[0]->nombre_empresa, $PRINCIPAL);
                $PRINCIPAL = str_replace("{RES_EMPRESA}", $datos_empresa[0]->responsable, $PRINCIPAL);
                $PRINCIPAL = str_replace("{EM_EMPRESA}", $datos_empresa[0]->correo, $PRINCIPAL);
                $PRINCIPAL = str_replace("{TIT_EMPRESA}", $datos_empresa[0]->titulo_pagina, $PRINCIPAL);
                if ($id_empresa) {
                    $PRINCIPAL = str_replace("{VALOR_BOTON}", "Editar", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ACTION}", "Editar", $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{VALOR_BOTON}", "Ingresar", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ACTION}", "Editar", $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function ListadoEmpresas($PRINCIPAL)
            {
                //Traigo el total de empresas que existen en el sistema
                $empresas = TotalEmpresas();
                $total_empresas = "";
                $i = 1;
                foreach ($empresas as $emp) {
                    $row = file_get_contents("views/empresa/row_listado_empresa.html");
                    $row = str_replace("{NUMERO}", $i, $row);
                    $i++;
                    $row = str_replace("{CODIGO_EMPRESA}", $emp->cod_empresa, $row);
                    $row = str_replace("{ID_EMPRESA_ENCODEADO}", Encodear($emp->cod_empresa), $row);
                    $row = str_replace("{NOMBRE_EMPRESA}", $emp->nombre_empresa, $row);
                    $row = str_replace("{RESPONSABLE_EMPRESA}", $emp->responsable, $row);
                    $row = str_replace("{CORREO_RESPONSABLE}", $emp->correo, $row);
                    $total_empresas .= $row;
                }
                $PRINCIPAL = str_replace("{ROW_LISTADO_EMPRESAS}", $total_empresas, $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function ListadoUsuarios($PRINCIPAL, $id_empresa, $registros_pagina, $registros_total, $pagina, $desde, $scampo1, $scampo2, $scampo3, $excel, $rut_colaborador)
            {
                //Traigo el total de empresas que existen en el sistema
                $Campos = TraeCampos($id_empresa);
                $Campos1 = $Campos[0]->campo1;
                $Campos2 = $Campos[0]->campo2;
                $Campos3 = $Campos[0]->campo3;
                $total_html = "";
                $i = 1;
                $pi = 0;
                //MIDE TIEMPO DE EJECUCION FOREACH
                //$time_start = microtime(true);
                $Usuarios = TraeUsuariosEmpresaFiltros($id_empresa, $Campos1, $Campos2, $Campos3, $rut_colaborador);
                $ACampo1 = array();
                $ACampo2 = array();
                $ACampo3 = array();
                if ($excel == 1) {
                    $row_html = file_get_contents("views/basepersonas/" . $id_empresa . "_row_personas_excel.html");
                } else {
                    $row_html = file_get_contents("views/basepersonas/" . $id_empresa . "_row_personas.html");
                }
                foreach ($Usuarios as $unico) {
                    $row = $row_html;
                    $row = str_replace("{NOMBRE_USUARIO}", $unico->nombre . " " . $unico->apaterno . " " . $unico->amaterno, $row);
                    $row = str_replace("{APATERNO}", $unico->apaterno, $row);
                    $row = str_replace("{PERFIL_COMPETENCIAS}", $unico->perfil_competencia, $row);
                    $row = str_replace("{AMATERNO}", $unico->amaterno, $row);
                    $row = str_replace("{CLAVE}", $unico->clave, $row);
                    if ($unico->cambiado == "0") {
                        $cambio = "(Sin cambios)";
                    } else {
                        if ($unico->cambiado == "") {
                            $cambio = "(Sin datos)";
                        } else {
                            if ($unico->fecha_cambio_clave) {
                                $cambio = "(Actualizada - " . $unico->fecha_cambio_clave . ")";
                            } else {
                                $cambio = "(Actualizada)";
                            }
                        }
                    }
                    $row = str_replace("{CAMBIO}", $cambio, $row);
                    $row = str_replace("{RUT_ENCODEADO}", Encodear3($unico->rut), $row);
                    $row = str_replace("{CARGO}", $unico->cargo, $row);
                    $row = str_replace("{EMAIL}", $unico->email, $row);
                    if ($unico->id_malla) {
                        //$row = str_replace("{TIENE_MALLA}",'Malla: <span class="etiqueta  label-success">Si</span>',$row);
                        $row = str_replace("{TIENE_MALLA}", '<span class="etiqueta  label-success">{NOMBREMALLA}</span>', $row);
                    } else {
                        $row = str_replace("{TIENE_MALLA}", '<span class="etiqueta  label-danger">[Sin Malla]</span>', $row);
                    }
                    $row = str_replace("{MALLA}", $unico->id_malla, $row);
                    $row = str_replace("{NOMBREMALLA}", $unico->nombre_malla, $row);
                    //$row = str_replace("{JEFATURA}",$unico->jefe,$row);
                    $row = str_replace("{OPTIONS_MALLAS}", utf8_decode(OptionsGenericoNombreDadoValoresPorEmpresa("tbl_lms_malla", $unico->id_malla, "nombre", "id", "order by nombre", $_SESSION["id_empresa"])), $row);
                    $row = str_replace("{JEFATURA}", $unico->nombre_completo_jefe, $row);
                    $row = str_replace("{ACCESOS}", $unico->total_accesos, $row);
                    $row = str_replace("{ULTIMOACCESO}", $unico->ultimo_ingreso, $row);
                    $row = str_replace("{ACTUALIZACION}", $unico->fecha_actualizacion, $row);
                    $row = str_replace("{RUT}", $unico->rut, $row);
                    $row = str_replace("{RUTCOMPLETO}", $unico->rut_completo, $row);
                    $row = str_replace("{CAMPO1}", $unico->campo1, $row);
                    $row = str_replace("{CAMPO2}", $unico->campo2, $row);
                    $row = str_replace("{CAMPO3}", $unico->campo3, $row);
                    $row = str_replace("{ID_EMPRESA}", $id_empresa, $row);
                    $ACampo1[$pi] = $unico->campo1;
                    $ACampo2[$pi] = $unico->campo2;
                    $ACampo3[$pi] = $unico->campo3;
                    $row = str_replace("{NCAMPO1}", str_replace("_", " ", ucwords($Campos1)), $row);
                    $row = str_replace("{NCAMPO2}", str_replace("_", " ", ucwords($Campos2)), $row);
                    $row = str_replace("{NCAMPO3}", str_replace("_", " ", ucwords($Campos3)), $row);
                    $row = str_replace("{MALLA}", $unico->malla, $row);
                    //obtener numero de cursos
                    $row = str_replace("{OPCIONES}", "", $row);
                    //echo $row;
                    $total_html .= $row;
                    $pi++;
                }
                //MIDE TIEMPO DE EJECUCION FOREACH
                //$time_end = microtime(true);
                //$execution_time = ($time_end - $time_start);
                //echo '<b>Total Execution Time ForEach:</b> '.$execution_time.' Segundos';
                //NOMBRE CAMPO TABLA
                $PRINCIPAL = str_replace("{CAMPO1}", $Campos1, $PRINCIPAL);
                $PRINCIPAL = str_replace("{CAMPO2}", $Campos2, $PRINCIPAL);
                $PRINCIPAL = str_replace("{CAMPO3}", $Campos3, $PRINCIPAL);
                //OPCIONS DE SELECT
                $PRINCIPAL = str_replace("{CAMPO1OP}", utf8_encode($OPCION1), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CAMPO2OP}", utf8_encode($OPCION2), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CAMPO3OP}", utf8_encode($OPCION3), $PRINCIPAL);
                //NOMBRE FORMATEADO
                $PRINCIPAL = str_replace("{NCAMPO1}", str_replace("_", " ", ucwords($Campos1)), $PRINCIPAL);
                $PRINCIPAL = str_replace("{NCAMPO2}", str_replace("_", " ", ucwords($Campos2)), $PRINCIPAL);
                $PRINCIPAL = str_replace("{NCAMPO3}", str_replace("_", " ", ucwords($Campos3)), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ROW_LISTADO_USUARIOS}", utf8_encode($total_html), $PRINCIPAL);
                return ($PRINCIPAL);
                exit;
                //Traigo el total de empresas que existen en el sistema
                //Con la variable tipo usuario, veo si es para el listado de usuarios, o para el listado de envio de correos.
                if ($arreglo_post["n_registros"]) {
                    $usuarios_por_pagina = $arreglo_post["n_registros"];
                } else {
                    $usuarios_por_pagina = 20;
                }
                if (!$pagina) {
                    $pagina = 1;
                }
                if ($tipo_listado == "correos") {
                    $entorno_para_paginacion = "listusuco";
                } else {
                    $entorno_para_paginacion = "listusu";
                }
                //$usuarios=TotalUsuarios($arreglo_post, $_SESSION["id_empresa"], $pagina, $usuarios_por_pagina);
                //$usuarios=SelectParaPaginacionUsuario("tbl_usuario", $_SESSION["id_empresa"], $usuarios_por_pagina);
                $PRINCIPAL = str_replace("{FILTROS_SUPERIORES}", file_get_contents("views/filtros/barra_superior_usuarios.html"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ENVIRONMENT}", $entorno_para_paginacion, $PRINCIPAL);
                $usuarios = DatosParaListadoPaginado("tbl_usuario", $_SESSION["id_empresa"], $usuarios_por_pagina, $pagina, $arreglo_post);
                $PRINCIPAL = str_replace("{PAGINACION}", ArmaPaginacionGenerico($pagina, $entorno_para_paginacion, "tbl_usuario", $usuarios_por_pagina, $arreglo_post, $_SESSION["id_empresa"]), $PRINCIPAL);
                $total_empresas = "";
                if ($tipo_listado == "correos") {
                    $html_row = file_get_contents("views/basepersonas/row_personas_envio_correos.html");
                } else if ($tipo_listado == "usuarios") {
                    if ($_SESSION["id_empresa"] == 28) {
                        $html_row = file_get_contents("views/basepersonas/row_personas_chilquinta.html");
                    } else {
                        $html_row = file_get_contents("views/basepersonas/row_personas.html");
                    }
                }
                $i = 1;
                foreach ($usuarios as $unico) {
                    $row = $html_row;
                    if ($pagina == 1) {
                        $row = str_replace("{N}", $i, $row);
                    } else {
                        $row = str_replace("{N}", $i + (($pagina - 1) * $usuarios_por_pagina), $row);
                    }
                    $i++;
                    /*$vecesenviadoemail=vecesenviado($unico->rut, $proceso, $empresa);
            foreach($vecesenviadoemail as $vecesenviadoemailunico){
                    $row = str_replace("{VECESENVIADO}",$vecesenviadoemailunico->cuenta,$row);
                }
        $datos_si_Es_jefe=count(ColaboradoresDadoJefe($unico->rut));
        */
                    $row = str_replace("{LIDER}", $datos_si_Es_jefe, $row);
                    $row = str_replace("{NOMBRE_USUARIO}", $unico->nombre . " " . $unico->apaterno . " " . $unico->amaterno, $row);
                    $row = str_replace("{APATERNO}", $unico->apaterno, $row);
                    $row = str_replace("{AMATERNO}", $unico->amaterno, $row);
                    $row = str_replace("{NOMBRE}", $unico->nombre, $row);
                    $row = str_replace("{NOMBRE_COMPLETO}", $unico->nombre_completo, $row);
                    $row = str_replace("{CLAVE}", $unico->clave, $row);
                    if ($unico->cambiado == "0") {
                        $cambio = "(Sin cambios)";
                    } else {
                        $cambio = "(Actualizada)";
                    }
                    $row = str_replace("{CAMBIO}", $cambio, $row);
                    $row = str_replace("{RUT}", $unico->rut_completo, $row);
                    $row = str_replace("{RUT_ENCODEADO}", Encodear3($unico->rut), $row);
                    $row = str_replace("{GERENCIA}", $unico->gerencia, $row);
                    $row = str_replace("{CENTROCOSTO}", $unico->centro_costo, $row);
                    $row = str_replace("{CARGO}", $unico->cargo, $row);
                    $row = str_replace("{EMPRESA_HOLDING}", $unico->nombre_empresa_holding_, $row);
                    $row = str_replace("{EMAIL}", $unico->email, $row);
                    $row = str_replace("{PERFIL}", $unico->perfil_evaluacion, $row);
                    $row = str_replace("{TRAMO}", $unico->tramo_sence . "%", $row);
                    //$row = str_replace("{PERFIL_EVALUACION}",OptionsGenericoNombreDadoValoresPorEmpresa("tbl_sgd_perfiles_ponderaciones", $unico->perfil_evaluacion,  "descripcion", "perfil", "order by descripcion asc", $_SESSION["id_empresa"]),$row);
                    $row = str_replace("{PERFIL_EVALUACION}", $unico->perfil_evaluacion_descripcion, $row);
                    $row = str_replace("{OPTIONS_TIPOS_CORREOS}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_correos", "", "asunto", "id", "order by asunto", $_SESSION["id_empresa"]), $row);
                    $PRINCIPAL = str_replace("{OPTIONS_GERENCIAS}", OptionsGenericoPorEmpresa("gerencia", "tbl_usuario", $arreglo_post["gerencia"], $_SESSION["id_empresa"]), $PRINCIPAL);
                    $total_empresas .= $row;
                }
                $PRINCIPAL = str_replace("{ROW_LISTADO_USUARIOS}", utf8_encode($total_empresas), $PRINCIPAL);
                //$PRINCIPAL = str_replace("{PAGINACION}",ArmaPaginacionUsuarios($pagina, "listusu", "tbl_usuario"),$PRINCIPAL);
                //PAGINACION
                return ($PRINCIPAL);
            }

            function ListadoUsuariosUltimo($PRINCIPAL, $id_empresa, $registros_pagina, $registros_total, $pagina, $desde, $scampo1, $scampo2, $scampo3, $excel)
            {
                //Traigo el total de empresas que existen en el sistema
                $Campos = TraeCampos($id_empresa);
                $Campos1 = $Campos[0]->campo1;
                $Campos2 = $Campos[0]->campo2;
                $Campos3 = $Campos[0]->campo3;
                $total_html = "";
                $i = 1;
                $pi = 0;
                $Usuarios = TraeUsuariosEmpresaFiltrosUltimo($id_empresa, $Campos1, $Campos2, $Campos3);
                $ACampo1 = array();
                $ACampo2 = array();
                $ACampo3 = array();
                if ($excel == 1) {
                    $row_html = file_get_contents("views/basepersonas/" . $id_empresa . "_row_personas_excel.html");
                } else {
                    $row_html = file_get_contents("views/basepersonas/" . $id_empresa . "_row_personas.html");
                }
                foreach ($Usuarios as $unico) {
                    $row = $row_html;
                    //$row = str_replace("{FOTO}",VerificaFotoPersonalDesdeAdmin($unico->rut),$row);
                    //$row = str_replace("{FOTO}",ColocaImagenVerificaAvatar($unico->rut, "admin"),$row);
                    //$row = str_replace("{LIDER}",$datos_si_Es_jefe,$row);
                    $row = str_replace("{NOMBRE_USUARIO}", $unico->nombre . " " . $unico->apaterno . " " . $unico->amaterno, $row);
                    $row = str_replace("{APATERNO}", $unico->apaterno, $row);
                    $row = str_replace("{AMATERNO}", $unico->amaterno, $row);
                    $row = str_replace("{CLAVE}", $unico->clave, $row);
                    if ($unico->cambiado == "0") {
                        $cambio = "(Sin cambios)";
                    } else {
                        if ($unico->cambiado == "") {
                            $cambio = "(Sin datos)";
                        } else {
                            if ($unico->fecha_cambio_clave) {
                                $cambio = "(Actualizada - " . $unico->fecha_cambio_clave . ")";
                            } else {
                                $cambio = "(Actualizada)";
                            }
                        }
                    }
                    $row = str_replace("{CAMBIO}", $cambio, $row);
                    $row = str_replace("{RUT_ENCODEADO}", Encodear3($unico->rut), $row);
                    $row = str_replace("{CARGO}", $unico->cargo, $row);
                    $row = str_replace("{EMAIL}", $unico->email, $row);
                    if ($unico->id_malla) {
                        //$row = str_replace("{TIENE_MALLA}",'Malla: <span class="etiqueta  label-success">Si</span>',$row);
                        $row = str_replace("{TIENE_MALLA}", '<span class="etiqueta  label-success">{NOMBREMALLA}</span>', $row);
                    } else {
                        $row = str_replace("{TIENE_MALLA}", '<span class="etiqueta  label-danger">Sin Malla</span>', $row);
                    }
                    $row = str_replace("{MALLA}", $unico->id_malla, $row);
                    $row = str_replace("{NOMBREMALLA}", $unico->nombre_malla, $row);
                    //$row = str_replace("{JEFATURA}",$unico->jefe,$row);
                    $row = str_replace("{OPTIONS_MALLAS}", utf8_decode(OptionsGenericoNombreDadoValoresPorEmpresa("tbl_lms_malla", $unico->id_malla, "nombre", "id", "order by nombre", $_SESSION["id_empresa"])), $row);
                    $row = str_replace("{JEFATURA}", $unico->nombre_completo_jefe, $row);
                    $row = str_replace("{ACCESOS}", $unico->total_accesos, $row);
                    $row = str_replace("{ULTIMOACCESO}", $unico->ultimo_ingreso, $row);
                    $row = str_replace("{ACTUALIZACION}", $unico->fecha_actualizacion, $row);
                    $row = str_replace("{RUT}", $unico->rut, $row);
                    $row = str_replace("{RUTCOMPLETO}", $unico->rut_completo, $row);
                    $row = str_replace("{CAMPO1}", $unico->campo1, $row);
                    $row = str_replace("{CAMPO2}", $unico->campo2, $row);
                    $row = str_replace("{CAMPO3}", $unico->campo3, $row);
                    $row = str_replace("{ID_EMPRESA}", $id_empresa, $row);
                    $ACampo1[$pi] = $unico->campo1;
                    $ACampo2[$pi] = $unico->campo2;
                    $ACampo3[$pi] = $unico->campo3;
                    $row = str_replace("{NCAMPO1}", str_replace("_", " ", ucwords($Campos1)), $row);
                    $row = str_replace("{NCAMPO2}", str_replace("_", " ", ucwords($Campos2)), $row);
                    $row = str_replace("{NCAMPO3}", str_replace("_", " ", ucwords($Campos3)), $row);
                    $row = str_replace("{MALLA}", $unico->malla, $row);
                    //obtener numero de cursos
                    $row = str_replace("{OPCIONES}", "", $row);
                    //echo $row;
                    $total_html .= $row;
                    $pi++;
                }
                /*
    $total_paginas=redondea($registros_total/$registros_pagina);
    $total_paginas_=$registros_total/$registros_pagina;
    $pagina_anterior = $pagina - 1;
    $posterior = $pagina + 1;
        if($pagina>1){
        $paginacion.=file_get_contents("views/paginacion/1.html");
        $paginacion = str_replace("{ENV}","listusu&c1=".$scampo1."&c2=".$scampo2."&c3=".$scampo3."",$paginacion);
        $paginacion = str_replace("{PAGINA}",($pagina-1),$paginacion);
        $paginacion = str_replace("{PAGINAINICIAL}","1",$paginacion);
        $paginacion = str_replace("{REGISTROS}",round($registros_pagina),$paginacion);
        $paginacion = str_replace("{DESDEINICIO}",1,$paginacion);
        $paginacion = str_replace("{DESDE}",round($desde)-$registros_pagina,$paginacion);
        $paginacion = str_replace("{TOTALREGISTROS}",round($registros_total),$paginacion);
    }
    $Cnum=10;
       if($Cnum>$total_paginas){
       $Cnum=$total_paginas;
    }
    if(($pagina+$Cnum)>$total_paginas){
        $resta=$pagina+$Cnum;
        $valor=($pagina+$Cnum)-$total_paginas;
        $pagina1=$pagina-$valor;
    }else{
    $pagina1=$pagina;
    }
    for($i=$pagina1;$i<=round(($pagina1)+$Cnum);$i++){
        if ($i!=0){
        if($pagina==$i){
            $paginacion.=file_get_contents("views/paginacion/actual.html");
            $paginacion = str_replace("{PAGINA}",($i),$paginacion);
            $paginacion = str_replace("{ENV}","listusu",$paginacion);
        }else{
            $paginacion.=file_get_contents("views/paginacion/numero.html");
            $paginacion = str_replace("{PAGINA}",($i),$paginacion);
            $paginacion = str_replace("{REGISTROS}",round($registros_pagina),$paginacion);
            if ($desde1==""){
             $desde1=(($registros_pagina*$i)+1)-$registros_pagina;
             }
            $paginacion = str_replace("{DESDE}",$desde1,$paginacion);
            $paginacion = str_replace("{TOTALREGISTROS}",round($registros_total),$paginacion);
            $paginacion = str_replace("{ENV}","listusu&c1=".$scampo1."&c2=".$scampo2."&c3=".$scampo3."",$paginacion);
        }
        $desde1=($registros_pagina*$i)+1;
        }
    }
    if($pagina<$total_paginas){
        $paginacion.=file_get_contents("views/paginacion/4.html");
        $paginacion = str_replace("{ENV}","listusu&c1=".$scampo1."&c2=".$scampo2."&c3=".$scampo3."",$paginacion);
        $paginacion = str_replace("{PAGINA}",($pagina+1),$paginacion);
        $paginacion = str_replace("{PAGINAFINAL}",$total_paginas,$paginacion);
        $paginacion = str_replace("{REGISTROS}",round($registros_pagina),$paginacion);
        $paginacion = str_replace("{DESDE}",($pagina*$registros_pagina)+1,$paginacion);
        $paginacion = str_replace("{DESDEFINAL}",(((int)($total_paginas_))*$registros_pagina)+1,$paginacion);
        $paginacion = str_replace("{TOTALREGISTROS}",round($registros_total),$paginacion);
    }
        $PRINCIPAL = str_replace("{REGISTROS".$registros_pagina."}","selected",$PRINCIPAL);
        $PRINCIPAL = str_replace("{PAGINACION}",$paginacion,$PRINCIPAL);
        $PRINCIPAL = str_replace("{RESUMEN}","Hay un total de ".$registros_total." Usuarios",$PRINCIPAL);
          $AgrupaCampo1=AgrupaCampos($Campos1);
          foreach($AgrupaCampo1 as $C1){
            if($C1->campo==$scampo1_){$selec="selected";}else{$selec="";};
               $OPCION1.='<option '.$selec.' value="'.$C1->campo.'">'.$C1->campo.'</option>';
          }
          $AgrupaCampo2=AgrupaCampos($Campos2);
          foreach($AgrupaCampo2 as $C2){
            if($C2->campo==$scampo2_){
                $selec2="selected";
                }else{
                $selec2="";
                }
               $OPCION2.='<option '.$selec2.' value="'.$C2->campo.'">'.$C2->campo.'</option>';
          }
          $AgrupaCampo3=AgrupaCampos($Campos3);
          foreach($AgrupaCampo3 as $C3){
            if($C3->campo==$scampo3_){$selec3="selected";}else{$selec3="";};
               $OPCION3.='<option '.$selec3.' value="'.$C3->campo.'">'.$C3->campo.'</option>';
          }
            */
                //NOMBRE CAMPO TABLA
                $PRINCIPAL = str_replace("{CAMPO1}", $Campos1, $PRINCIPAL);
                $PRINCIPAL = str_replace("{CAMPO2}", $Campos2, $PRINCIPAL);
                $PRINCIPAL = str_replace("{CAMPO3}", $Campos3, $PRINCIPAL);
                //OPCIONS DE SELECT
                $PRINCIPAL = str_replace("{CAMPO1OP}", utf8_encode($OPCION1), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CAMPO2OP}", utf8_encode($OPCION2), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CAMPO3OP}", utf8_encode($OPCION3), $PRINCIPAL);
                //NOMBRE FORMATEADO
                $PRINCIPAL = str_replace("{NCAMPO1}", str_replace("_", " ", ucwords($Campos1)), $PRINCIPAL);
                $PRINCIPAL = str_replace("{NCAMPO2}", str_replace("_", " ", ucwords($Campos2)), $PRINCIPAL);
                $PRINCIPAL = str_replace("{NCAMPO3}", str_replace("_", " ", ucwords($Campos3)), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ROW_LISTADO_USUARIOS}", utf8_encode($total_html), $PRINCIPAL);
                return ($PRINCIPAL);
                exit;
                //Traigo el total de empresas que existen en el sistema
                //Con la variable tipo usuario, veo si es para el listado de usuarios, o para el listado de envio de correos.
                if ($arreglo_post["n_registros"]) {
                    $usuarios_por_pagina = $arreglo_post["n_registros"];
                } else {
                    $usuarios_por_pagina = 20;
                }
                if (!$pagina) {
                    $pagina = 1;
                }
                if ($tipo_listado == "correos") {
                    $entorno_para_paginacion = "listusuco";
                } else {
                    $entorno_para_paginacion = "listusu";
                }
                //$usuarios=TotalUsuarios($arreglo_post, $_SESSION["id_empresa"], $pagina, $usuarios_por_pagina);
                //$usuarios=SelectParaPaginacionUsuario("tbl_usuario", $_SESSION["id_empresa"], $usuarios_por_pagina);
                $PRINCIPAL = str_replace("{FILTROS_SUPERIORES}", file_get_contents("views/filtros/barra_superior_usuarios.html"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ENVIRONMENT}", $entorno_para_paginacion, $PRINCIPAL);
                $usuarios = DatosParaListadoPaginado("tbl_usuario", $_SESSION["id_empresa"], $usuarios_por_pagina, $pagina, $arreglo_post);
                $PRINCIPAL = str_replace("{PAGINACION}", ArmaPaginacionGenerico($pagina, $entorno_para_paginacion, "tbl_usuario", $usuarios_por_pagina, $arreglo_post, $_SESSION["id_empresa"]), $PRINCIPAL);
                $total_empresas = "";
                if ($tipo_listado == "correos") {
                    $html_row = file_get_contents("views/basepersonas/row_personas_envio_correos.html");
                } else if ($tipo_listado == "usuarios") {
                    if ($_SESSION["id_empresa"] == 28) {
                        $html_row = file_get_contents("views/basepersonas/row_personas_chilquinta.html");
                    } else {
                        $html_row = file_get_contents("views/basepersonas/row_personas.html");
                    }
                }
                $i = 1;
                foreach ($usuarios as $unico) {
                    $row = $html_row;
                    if ($pagina == 1) {
                        $row = str_replace("{N}", $i, $row);
                    } else {
                        $row = str_replace("{N}", $i + (($pagina - 1) * $usuarios_por_pagina), $row);
                    }
                    $i++;
                    /*$vecesenviadoemail=vecesenviado($unico->rut, $proceso, $empresa);
            foreach($vecesenviadoemail as $vecesenviadoemailunico){
                    $row = str_replace("{VECESENVIADO}",$vecesenviadoemailunico->cuenta,$row);
                }
        $datos_si_Es_jefe=count(ColaboradoresDadoJefe($unico->rut));
        */
                    $row = str_replace("{LIDER}", $datos_si_Es_jefe, $row);
                    $row = str_replace("{NOMBRE_USUARIO}", $unico->nombre . " " . $unico->apaterno . " " . $unico->amaterno, $row);
                    $row = str_replace("{APATERNO}", $unico->apaterno, $row);
                    $row = str_replace("{AMATERNO}", $unico->amaterno, $row);
                    $row = str_replace("{NOMBRE}", $unico->nombre, $row);
                    $row = str_replace("{NOMBRE_COMPLETO}", $unico->nombre_completo, $row);
                    $row = str_replace("{CLAVE}", $unico->clave, $row);
                    if ($unico->cambiado == "0") {
                        $cambio = "(Sin cambios)";
                    } else {
                        $cambio = "(Actualizada)";
                    }
                    $row = str_replace("{CAMBIO}", $cambio, $row);
                    $row = str_replace("{RUT}", $unico->rut_completo, $row);
                    $row = str_replace("{RUT_ENCODEADO}", Encodear3($unico->rut), $row);
                    $row = str_replace("{GERENCIA}", $unico->gerencia, $row);
                    $row = str_replace("{CENTROCOSTO}", $unico->centro_costo, $row);
                    $row = str_replace("{CARGO}", $unico->cargo, $row);
                    $row = str_replace("{EMPRESA_HOLDING}", $unico->nombre_empresa_holding_, $row);
                    $row = str_replace("{EMAIL}", $unico->email, $row);
                    $row = str_replace("{PERFIL}", $unico->perfil_evaluacion, $row);
                    $row = str_replace("{TRAMO}", $unico->tramo_sence . "%", $row);
                    //$row = str_replace("{PERFIL_EVALUACION}",OptionsGenericoNombreDadoValoresPorEmpresa("tbl_sgd_perfiles_ponderaciones", $unico->perfil_evaluacion,  "descripcion", "perfil", "order by descripcion asc", $_SESSION["id_empresa"]),$row);
                    $row = str_replace("{PERFIL_EVALUACION}", $unico->perfil_evaluacion_descripcion, $row);
                    $row = str_replace("{OPTIONS_TIPOS_CORREOS}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_correos", "", "asunto", "id", "order by asunto", $_SESSION["id_empresa"]), $row);
                    $PRINCIPAL = str_replace("{OPTIONS_GERENCIAS}", OptionsGenericoPorEmpresa("gerencia", "tbl_usuario", $arreglo_post["gerencia"], $_SESSION["id_empresa"]), $PRINCIPAL);
                    $total_empresas .= $row;
                }
                $PRINCIPAL = str_replace("{ROW_LISTADO_USUARIOS}", utf8_encode($total_empresas), $PRINCIPAL);
                //$PRINCIPAL = str_replace("{PAGINACION}",ArmaPaginacionUsuarios($pagina, "listusu", "tbl_usuario"),$PRINCIPAL);
                //PAGINACION
                return ($PRINCIPAL);
            }

            function Encodear3BORRADO_POR_DUPLICIDAD_AL_UNIFICAR_EL_FUNCTION($valor)
            {
                $valor = Encodear(Encodear(Encodear($valor)));
                return ($valor);
            }

            function EncodearBORRADO_POR_DUPLICIDAD_AL_UNIFICAR_EL_FUNCTION($valor)
            {
                $valor = base64_encode(base64_encode(base64_encode($valor)));
                return ($valor);
            }

            function Decodear3BORRADO_POR_DUPLICIDAD_AL_UNIFICAR_EL_FUNCTION($valor)
            {
                $valor = Decodear(Decodear(Decodear($valor)));
                return ($valor);
            }

            function DecodearBORRADO_POR_DUPLICIDAD_AL_UNIFICAR_EL_FUNCTION($valor)
            {
                $valor = base64_decode(base64_decode(base64_decode($valor)));
                return ($valor);
            }

            function FuncionesTransversalesAdmin($html)
            {
                $id_empresa = $_SESSION["id_empresa"];
                $datos_proceso = DatosProceso();
                //Dado el perfil, muestro el menu izquierdo

                $perfil = PerfilAdmin($_SESSION["perfil"]);
                $acceso_admin_perfil = VerificaTipoDePerfilAdminAcceso($_SESSION["user_"]);
                //echo "<h1>".$acceso_admin_perfil[0]->template."</h1>";
                //$html = str_replace("{MENU_IZQUIERDO}",file_get_contents("views/menu_izquierdo/".$perfil[0]->template.""),$html);
                $html = str_replace("{MENU_IZQUIERDO}", file_get_contents("views/menu_izquierdo/" . $acceso_admin_perfil[0]->template . ""), $html);
                $random = rand(5, 100005);

                //Veo si existen reportes de capacitacion en la tabla, para que se coloquen en el menu izquierdo
                //Reportes Capacitacion por empresa
                $reportes_capacitacion = TiposReportesPorEmpresa($id_empresa, 1);
                foreach ($reportes_capacitacion as $unico) {
                    $ul .= file_get_contents("views/menu_izquierdo/li_menu.html");
                    $ul = str_replace("{NOMBRE_REPORTE}", $unico->nombre, $ul);
                    $ul = str_replace("{CASE_REPORTE}", $unico->case, $ul);
                }
                $html = str_replace("{REPORTES_CAPACITACION}", $ul, $html);
                //$html = str_replace("{MENU_INFERIOR}",file_get_contents("views/menu_inferior.html"),$html);
                //$html = str_replace("{FOOTER}",file_get_contents("views/footer.html"),$html);
                //$html = str_replace("{LOGO}",file_get_contents("views/logo.html"),$html);
                $html = str_replace("{HEAD}", file_get_contents("views/head.html"), $html);
                //$html = str_replace("{HEAD_FOOTER}",file_get_contents("views/head_footer.html"),$html);
                $html = str_replace("{HEADER}", file_get_contents("views/header.html"), $html);
                $html = str_replace("{NAVEGACION}", file_get_contents("views/navegacion.html"), $html);
                $html = str_replace("{USER_TEMPLATE}", file_get_contents("views/menu_izquierdo/user_menu.html"), $html);
                $html = str_replace("{IMAGEN_USUARIO}", VerificaFotoPersonalDesdeAdmin($_SESSION["admin_"]), $html);
                $html = str_replace("{FOOTER_ADMIN}", file_get_contents("views/footer.html"), $html);
                $html = str_replace("{HOME_INICIAL}", $perfil[0]->home, $html);

                $html = str_replace("{RANDOM}", $random, $html);


                //$html = str_replace("{STATUS_SUPERIOR_DERECHA}",file_get_contents("views/status_superior_derecha.html"),$html);
                $html = str_replace("{TITTLE}", "Administracion", $html);
                $html = str_replace("{NOMBRE_USUARIO}", utf8_encode($_SESSION["nombre"]), $html);
                $html = str_replace("{PERFIL_ADMIN}", utf8_encode($perfil[0]->nombre_perfil), $html);

                global $Texto_Pilar, $Texto_Programa;
                $html = str_replace("{Texto_Pilar}", ($Texto_Pilar), $html);
                $html = str_replace("{Texto_Programa}", ($Texto_Programa), $html);


                return ($html);
            }

            //FUNCIONES ADMIN GALERIA
            function lista_carpetas($html, $id_empresa)
            {
                //$categorias=TraeCarpetas();
                $categorias = TraeCarpetasPorEmpresa($id_empresa);
                $total_html = "";
                foreach ($categorias as $Cat) {
                    $row = file_get_contents("views/admin/galeria/lista_categorias.html");
                    $row = str_replace("{CATEGORIA}", $Cat->categoria, $row);
                    $row = str_replace("{DESCRIPCION}", $Cat->descripcion, $row);
                    $row = str_replace("{DETALLE}", Total_Albunes($Cat->id), $row);
                    $row = str_replace("{ID}", $Cat->id, $row);
                    $total_html .= $row;
                }
                $total_html = str_replace("{NIVEL}", "2", $total_html);
                $total_html = str_replace("{SUB_CAT}", "", $total_html);
                $total_html = str_replace("{NSUB}", "", $total_html);
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Carpetas", $html);
                $html = str_replace("{BTN}", "Nueva Carpeta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_galeria&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Carpeta', $html);
                return ($html);
            }

            function lista_subcarpetas($html, $id, $ncat)
            {
                $categorias = TraeSubCarpetas($id);
                $total_html = "";
                foreach ($categorias as $Cat) {
                    $row = file_get_contents("views/admin/galeria/lista_subcategorias.html");
                    $row = str_replace("{CATEGORIA}", $Cat->categoria, $row);
                    $row = str_replace("{DESCRIPCION}", $Cat->descripcion, $row);
                    $row = str_replace("{DETALLE}", Total_imagenes($Cat->id), $row);
                    $row = str_replace("{MUNDO}", $Cat->nombre_mundos, $row);
                    $row = str_replace("{COMUNIDAD}", $Cat->nombre_comunidades, $row);
                    $row = str_replace("{ID}", $Cat->id, $row);
                    $total_html .= $row;
                }
                $total_html = str_replace("{NIVEL}", "3", $total_html);
                $total_html = str_replace("{SUB_CAT}", $id, $total_html);
                $total_html = str_replace("{NSUB}", $ncat, $total_html);
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", $ncat, $html);
                $html = str_replace("{BTN}", "Nuevo Album", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_galeria&n=fs&id_cat=" . $id . "&cn=" . $ncat, $html);
                $html = str_replace("{BTN_VOLVER}", '<a href="?sw=admin_galeria&n=1" class="btn btn-default btn-xs" title="button"><i class="glyphicon glyphicon-arrow-left"></i>&nbsp; Volver</a>', $html);
                $html = str_replace("{COLUMNA}", 'Album', $html);
                return ($html);
            }

            function lista_galeria_archivos($html, $id, $ncat, $id_sub, $nscat)
            {
                $archivos = TraeArchivosGaleria($id);
                $total_html = "";
                foreach ($archivos as $Cat) {
                    $row = file_get_contents("views/admin/galeria/lista_archivos.html");
                    if ($Cat->tipo == "video") {
                        $row = str_replace("{TIPO}", "video", $row);
                        $row = str_replace("{ARCHIVO}", 'img/galeria/video.png', $row);
                    } else {
                        $row = str_replace("{TIPO}", "imagen", $row);
                        $row = str_replace("{ARCHIVO}", "galeria/" . $Cat->archivo, $row);
                    }
                    $row = str_replace("{DESCRIPCION}", $Cat->descripcion, $row);
                    $row = str_replace("{TAGS}", $Cat->tags, $row);
                    $row = str_replace("{VISTAS}", $Cat->vistas . " Visto", $row);
                    $row = str_replace("{MEGUSTA}", $Cat->megusta . " Me gusta", $row);
                    $row = str_replace("{VALOR}", $Cat->valoracion, $row);
                    $row = str_replace("{ID}", $Cat->id, $row);
                    $row = str_replace("{NIVEL}", $Cat->id, $row);
                    $row = str_replace("{ID_1}", $id, $row);
                    $row = str_replace("{CN}", $ncat, $row);
                    $row = str_replace("{NSCAT}", $nscat, $row);
                    $row = str_replace("{IDSUB}", $id_sub, $row);
                    $total_html .= $row;
                }
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", $ncat, $html);
                $html = str_replace("{BTN}", "Subir Imagenes", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_galeria&n=fa&id=" . $id . "&cn=" . $ncat . "&id_sub=" . $id_sub . "&nsub=" . $nscat . "&id_ar=0", $html);
                $html = str_replace("{BTN_VOLVER}", '<a href="?sw=admin_galeria&n=2&id=' . $id_sub . '&cn=' . $nscat . '" class="btn btn-default btn-xs" title="button"><i class="glyphicon glyphicon-arrow-left"></i>&nbsp; Volver</a>', $html);
                $html = str_replace("{COLUMNA}", 'Imagen', $html);
                return ($html);
            }

            function subir_archivo_galeria($html, $id_cat, $ncat, $id_subcat, $nsubcat, $id_ar)
            {
                if ($id_ar != "0") {
                    $Categoria = TraeArchivoGaleria($id_ar);
                    $html = str_replace("{ID_CATEGORIA}", $id_cat, $html);
                    $html = str_replace("{ID_AR}", $id_ar, $html);
                    $html = str_replace("{ID_SUBCATEGORIA}", $id_subcat, $html);
                    $html = str_replace("{N_CATEGORIA}", $ncat, $html);
                    $html = str_replace("{IMG}", $Categoria[0]->imagen, $html);
                    $html = str_replace("{NOMBRE}", $Categoria[0]->titulo, $html);
                    $html = str_replace("{DESCRIPCION}", $Categoria[0]->descripcion, $html);
                    $html = str_replace("{BTN}", "editar_archivo();", $html);
                    $html = str_replace("{IDCAT}", $id_cat, $html);
                    $html = str_replace("{NCAT}", $ncat, $html);
                    $html = str_replace("{IDSUB}", $id_subcat, $html);
                    $html = str_replace("{NSUB}", $nsubcat, $html);
                    $html = str_replace("{TIPO}", "EDITAR IMAGENES", $html);
                    $html = str_replace("{INPUTFILE}", "", $html);
                    return ($html);
                } else {
                    $html = str_replace("{ID_CATEGORIA}", $id_cat, $html);
                    $html = str_replace("{ID_AR}", "0", $html);
                    $html = str_replace("{NOMBRE}", "", $html);
                    $html = str_replace("{DESCRIPCION}", "", $html);
                    $html = str_replace("{BTN}", "subirArchivos();", $html);
                    $html = str_replace("{IDCAT}", $id_cat, $html);
                    $html = str_replace("{NCAT}", $ncat, $html);
                    $html = str_replace("{IDSUB}", $id_subcat, $html);
                    $html = str_replace("{NSUB}", $nsubcat, $html);
                    $html = str_replace("{TIPO}", "SUBIR ARCHIVOS", $html);
                    $html = str_replace("{N_CATEGORIA}", $ncat, $html);
                    return ($html);
                }
            }

            function nueva_carpeta($html, $id_cat)
            {
                if ($id_cat != "") {
                    $Categoria = TraeCarpeta($id_cat);
                    $html = str_replace("{ID_CATEGORIA}", $id_cat, $html);
                    $html = str_replace("{CATEGORIA}", $Categoria[0]->categoria, $html);
                    $html = str_replace("{DESCRIPCION}", $Categoria[0]->descripcion, $html);
                    $html = str_replace("{BTN}", "edita_carpeta();", $html);
                    $html = str_replace("{TIPO}", "EDITAR CARPETA", $html);
                    return ($html);
                } else {
                    $html = str_replace("{ID_CATEGORIA}", "", $html);
                    $html = str_replace("{CATEGORIA}", "", $html);
                    $html = str_replace("{DESCRIPCION}", "", $html);
                    $html = str_replace("{BTN}", "nueva_carpeta();", $html);
                    $html = str_replace("{TIPO}", "NUEVA CARPETA", $html);
                    return ($html);
                }
            }

            function nuevo_album($html, $id_cat, $ncat, $id_subcat)
            {
                $comboCat = TraeCarpetas();
                if ($id_subcat != "") {
                    foreach ($comboCat as $Cat) {
                        if ($id_cat == $Cat->id) {
                            $select = "selected";
                        } else {
                            $select = "";
                        }
                        $row = "<option value='" . $Cat->id . "' " . $select . ">" . $Cat->categoria . "</option>";
                        $COMBO .= $row;
                    }
                    $html = str_replace("{COMBOCAT}", $COMBO, $html);
                    $Categoria = TraeCarpeta($id_subcat);
                    $html = str_replace("{ID_CATEGORIA}", $id_cat, $html);
                    $html = str_replace("{ID_SUBCATEGORIA}", $id_subcat, $html);
                    $html = str_replace("{N_CATEGORIA}", $ncat, $html);
                    $html = str_replace("{IMG}", $Categoria[0]->imagen, $html);
                    $html = str_replace("{SUBCATEGORIA}", $Categoria[0]->categoria, $html);
                    $html = str_replace("{DESCRIPCION}", $Categoria[0]->descripcion, $html);
                    $html = str_replace("{OPTIONS_MUNDOS}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_mundos", $Categoria[0]->id_mundo, "nombre", "id", "order by nombre", $_SESSION["id_empresa"]), $html);
                    $html = str_replace("{OPTIONS_COMUNIDADES}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_comunidades", $Categoria[0]->id_comunidad, "nombre", "id", "order by nombre", $_SESSION["id_empresa"]), $html);
                    $html = str_replace("{BTN}", "edita_album()", $html);
                    $html = str_replace("{TIPO}", "Editar Album", $html);
                    return ($html);
                } else {
                    foreach ($comboCat as $Cat) {
                        if ($id_cat == $Cat->id) {
                            $select = "selected";
                        } else {
                            $select = "";
                        }
                        $row = "<option value='" . $Cat->id . "' " . $select . ">" . $Cat->categoria . "</option>";
                        $COMBO .= $row;
                    }
                    $html = str_replace("{COMBOCAT}", $COMBO, $html);
                    $html = str_replace("{ID_CATEGORIA}", $id_cat, $html);
                    $html = str_replace("{ID_SUBCATEGORIA}", $id_subcat, $html);
                    $html = str_replace("{SUBCATEGORIA}", "", $html);
                    $html = str_replace("{DESCRIPCION}", "", $html);
                    $html = str_replace("{OPTIONS_MUNDOS}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_mundos", "", "nombre", "id", "order by nombre", $_SESSION["id_empresa"]), $html);
                    $html = str_replace("{OPTIONS_COMUNIDADES}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_comunidades", "", "nombre", "id", "order by nombre", $_SESSION["id_empresa"]), $html);
                    $html = str_replace("{BTN}", "nuevo_album()", $html);
                    $html = str_replace("{TIPO}", "Nuevo Album", $html);
                    $html = str_replace("{N_CATEGORIA}", $ncat, $html);
                    return ($html);
                }
            }

            //MODULO PREGUNTASYRESPUESTAS
            function lista_preguntasyrespuestas($html, $id_empresa, $idcategoria)
            {
                //$categorias=TraeCategorias();
                $categorias = TraepreguntasyrespuestasPorEmpresa($idcategoria, $id_empresa);
                $total_html = "";
                foreach ($categorias as $Cat) {
                    //    print_r($Cat);
                    $row = file_get_contents("views/preguntasyrespuestas/lista_categorias.html");
                    $row = str_replace("{PREGUNTA}", utf8_encode($Cat->mensaje), $row);
                    $row = str_replace("{TIPO}", utf8_encode($Cat->tipo), $row);
                    $row = str_replace("{DESTINATARIO}", utf8_encode($Cat->destinatario), $row);
                    $row = str_replace("{NOMBREAUTOR}", utf8_encode($Cat->nombrepersona), $row);
                    $row = str_replace("{FECHAPREGUNTA}", $Cat->fecha, $row);
                    $total_html .= $row;
                }
                $total_html = str_replace("{NIVEL}", "2", $total_html);
                $total_html = str_replace("{SUB_CAT}", "", $total_html);
                $total_html = str_replace("{NSUB}", "", $total_html);
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Preguntas y Respuestas", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function truncateMejorPractica($text, $length)
            {
                $length = abs((int)$length);
                if (strlen($text) > $length) {
                    $text = preg_replace("/^(.{1,$length})(\s.*|$)/s", '\\1...', $text);
                }
                return ($text);
            }

            function Mejores_Practicas_Estadisticas($html, $id_empresa, $idcategoria, $interaccion, $fi, $ft)
            {

                //header('Content-type: text/plain');
                //header('Content-Disposition: attachment; filename=MP_estadisticas_'.$fi.'_'.$ft.'.csv');
                //echo "CODIGO IMPARTICION;EJECUTIVO;EJECUTIVO NOMBRE;FOCO ESTRATEGICO;PROGRAMA;PROGRAMA_ELEARNING;NOMBRE INTERNO IMPARTICION;TIPO CURSO;ANNO INICIO;MES INICIO;FECHA INICIO;ANNO FIN;MES TERMINO;FECHA TERMINO;FORMATO STATUS;HORAS TOTALES;LUGAR DE EJECUCION(DIRECCION);INSCRITOS;ASISTENTES;INCOMPLETOS;INASISTENTES;\r\n";

//$MP_dias=TraeDiasEstadisticas($id_empresa);
                $MP_dias = TraeDiasEstadisticasFechas($id_empresa, $fi, $ft);
//print_R($MP_dias);
                foreach ($MP_dias as $MP_dia) {
                    //echo " <br> fecha ".$MP_dia->fecha." ".$MP_dia->dia." ".$MP_dia->mes." ".$MP_dia->ano;
                    if ($interaccion == "0"
                        or $interaccion == "ACEPTA_CONDICIONES"
                        or $interaccion == "APTITUD_VALIDADA"
                        or $interaccion == "BUSQUEDA"
                        or $interaccion == "COMENTARIO"
                        or $interaccion == "COMPARTIDOCONTERCERO"
                        or $interaccion == "DESPUBLICACION_ALERTA"
                        or $interaccion == "MEGUSTA"
                        or $interaccion == "PUBLICACION_EDITADA"
                        or $interaccion == "PUBLICACION_SEGUIDO"
                        or $interaccion == "SEGUIDO"
                        or $interaccion == "TAGUEADO"
                        or $interaccion == "VISITA"
                    ) {
                        $MP_Interacciones = MPTraeInteraccionesPorDia($MP_dia->fecha, $id_empresa, $interaccion);
                    }
                    //print_r($MP_Interacciones); exit();
                    foreach ($MP_Interacciones as $MP_Interaccion) {
                        //$categorias=TraeCategorias();
                        if ($MP_Interaccion->tipoInteraccion == "COMPARTIDOCONMIGO") {
                            //echo "<br>COMPARTIDOCONMIGO   ".$MP_Interaccion->RUTcolaborador." ".$MP_Interaccion->RUTremitente;
                            if ($MP_Interaccion->tipoInteraccion == "COMPARTIDOCONMIGO" and
                                $MP_Interaccion->RUTcolaborador <> $MP_Interaccion->RUTremitente
                                and $MP_Interaccion->RUTremitente <> ''
                            ) {
                                $MP_Interaccion->tipoInteraccion = "COMPARTIDOCONTERCERO";
                                //echo "<br>----HOLA COMPARTIDOCONTERCERO";
                            }
                        }
                        //echo "<br>Interaccion ".$MP_Interaccion->tipoInteraccion;
                        if ($MP_Interaccion->tipoInteraccion == "BUSQUEDA") {
                            //echo "NEPE";
                            $mensaje = utf8_encode($MP_Interaccion->contenido);
                            //echo "mensaje $mensaje";
                        } else {
                            $mensaje = $MP_Interaccion->mensaje;
                        }
                        if ($MP_Interaccion->tipoInteraccion == "VISITA") {
                            $MP_Interaccion->RUTremitente = "";
                            $MP_Interaccion->RemCargo = "";
                            $MP_Interaccion->RemEmail = "";
                            $MP_Interaccion->RemGerencia = "";
                            $MP_Interaccion->RemGerenciaR2 = "";
                            $MP_Interaccion->RemGerenciaR3 = "";
                        }
                        if ($MP_Interaccion->tipoInteraccion == "VISITA_VIDEO") {
                            $MP_Interaccion->tipoInteraccion = "VISITA";
                        }


                        $row = file_get_contents("views/mejores_practicas/row_estadisticas.html");
                        $row = str_replace("{FechaInt}", ($MP_Interaccion->FechaInt), $row);
                        $row = str_replace("{tipoInteraccion}", ($MP_Interaccion->tipoInteraccion), $row);
                        $row = str_replace("{RUTcolaborador}", ($MP_Interaccion->RUTcolaborador), $row);
                        $row = str_replace("{ColNombre}", ($MP_Interaccion->ColNombre), $row);
                        $row = str_replace("{ColCargo}", ($MP_Interaccion->ColCargo), $row);
                        $row = str_replace("{ColEmail}", ($MP_Interaccion->ColEmail), $row);
                        $row = str_replace("{ColGerencia}", ($MP_Interaccion->ColGerencia), $row);
                        $row = str_replace("{ColGerenciaR2}", ($MP_Interaccion->ColGerenciaR2), $row);
                        $row = str_replace("{ColGerenciaR3}", ($MP_Interaccion->ColGerenciaR3), $row);
                        $row = str_replace("{GrupoSeguido}", $MP_Interaccion->GrupoSeguido, $row);
                        $row = str_replace("{Aptitud}", ($MP_Interaccion->Aptitud), $row);
                        $row = str_replace("{mensaje}", ($mensaje), $row);
                        $row = str_replace("{id_post}", ($MP_Interaccion->id_post), $row);
                        $row = str_replace("{mensaje}", ($MP_Interaccion->mensaje), $row);
                        $row = str_replace("{id_post}", ($MP_Interaccion->id_post), $row);

                        if ($MP_Interaccion->TituloPost == "") {

                            $DatosGPTW = BuscaDatosMPFotoGPTW($MP_Interaccion->id_post);
                            $row = str_replace("{TituloPost}", "GPTW", $row);
                            $row = str_replace("{RutAutor}", ($DatosGPTW[0]->RutAutor), $row);
                            $row = str_replace("{NombreAutor}", ($DatosGPTW[0]->NombreAutor), $row);
                            $row = str_replace("{AutorCargo}", ($DatosGPTW[0]->AutorCargo), $row);
                            $row = str_replace("{AutorEmail}", ($DatosGPTW[0]->AutorEmail), $row);
                            $row = str_replace("{AutorGerencia}", ($DatosGPTW[0]->AutorGerencia), $row);
                            $row = str_replace("{AutorGerenciaR2}", ($DatosGPTW[0]->AutorGerenciaR2), $row);
                            $row = str_replace("{AutorGerenciaR3}", ($DatosGPTW[0]->AutorGerenciaR3), $row);
                            $row = str_replace("{TipoPost}", "FOTO", $row);


                        } else {

                            $row = str_replace("{TituloPost}", ($MP_Interaccion->TituloPost), $row);
                            $row = str_replace("{RutAutor}", ($MP_Interaccion->RutAutor), $row);
                            $row = str_replace("{NombreAutor}", ($MP_Interaccion->NombreAutor), $row);
                            $row = str_replace("{AutorCargo}", ($MP_Interaccion->AutorCargo), $row);
                            $row = str_replace("{AutorEmail}", ($MP_Interaccion->AutorEmail), $row);
                            $row = str_replace("{AutorGerencia}", ($MP_Interaccion->AutorGerencia), $row);
                            $row = str_replace("{AutorGerenciaR2}", ($MP_Interaccion->AutorGerenciaR2), $row);
                            $row = str_replace("{AutorGerenciaR3}", ($MP_Interaccion->AutorGerenciaR3), $row);
                            $row = str_replace("{TipoPost}", ($MP_Interaccion->TipoPost), $row);


                        }


                        $row = str_replace("{id_GrupoIntPost}", ($MP_Interaccion->id_GrupoIntPost), $row);
                        $row = str_replace("{GrupoIntPost}", ($MP_Interaccion->GrupoIntPost), $row);
                        $row = str_replace("{RUTremitente}", ($MP_Interaccion->RUTremitente), $row);
                        $row = str_replace("{RemNombre}", ($MP_Interaccion->RemNombre), $row);
                        $row = str_replace("{RemCargo}", ($MP_Interaccion->RemCargo), $row);
                        $row = str_replace("{RemEmail}", ($MP_Interaccion->RemEmail), $row);
                        $row = str_replace("{RemGerencia}", ($MP_Interaccion->RemGerencia), $row);
                        $row = str_replace("{RemGerenciaR2}", ($MP_Interaccion->RemGerenciaR2), $row);
                        $row = str_replace("{RemGerenciaR3}", ($MP_Interaccion->RemGerenciaR3), $row);
                        echo $row;
                    }
                    if ($interaccion == "0" or $interaccion == "ACEPTA_CONDICIONES") {
                        $MP_Posteos = MPTraeAceptaCondicionesPorDia($MP_dia->fecha, $id_empresa);
                    }
                    foreach ($MP_Posteos as $MP_Post) {
                        //$categorias=TraeCategorias();
                        $row = file_get_contents("views/mejores_practicas/row_estadisticas.html");
                        $row = str_replace("{FechaInt}", ($MP_Post->FechaInt), $row);
                        $row = str_replace("{tipoInteraccion}", ($MP_Post->tipoInteraccion), $row);
                        $row = str_replace("{RUTcolaborador}", ($MP_Post->RUTcolaborador), $row);
                        $row = str_replace("{ColNombre}", ($MP_Post->ColNombre), $row);
                        $row = str_replace("{ColCargo}", ($MP_Post->ColCargo), $row);
                        $row = str_replace("{ColEmail}", ($MP_Post->ColEmail), $row);
                        $row = str_replace("{ColGerencia}", ($MP_Post->ColGerencia), $row);
                        $row = str_replace("{ColGerenciaR2}", ($MP_Post->ColGerenciaR2), $row);
                        $row = str_replace("{ColGerenciaR3}", ($MP_Post->ColGerenciaR3), $row);
                        $row = str_replace("{GrupoSeguido}", $MP_Post->GrupoSeguido, $row);
                        $row = str_replace("{Aptitud}", ($MP_Post->Aptitud), $row);
                        $row = str_replace("{mensaje}", ($MP_Post->mensaje), $row);
                        $row = str_replace("{id_post}", ($MP_Post->id_post), $row);
                        $row = str_replace("{mensaje}", ($MP_Post->mensaje), $row);
                        $row = str_replace("{id_post}", ($MP_Post->id_post), $row);
                        $row = str_replace("{TituloPost}", ($MP_Post->TituloPost), $row);
                        $row = str_replace("{RutAutor}", ($MP_Post->RutAutor), $row);
                        $row = str_replace("{NombreAutor}", ($MP_Post->NombreAutor), $row);
                        $row = str_replace("{AutorCargo}", ($MP_Post->AutorCargo), $row);
                        $row = str_replace("{AutorEmail}", ($MP_Post->AutorEmail), $row);
                        $row = str_replace("{AutorGerencia}", ($MP_Post->AutorGerencia), $row);
                        $row = str_replace("{AutorGerenciaR2}", ($MP_Post->AutorGerenciaR2), $row);
                        $row = str_replace("{AutorGerenciaR3}", ($MP_Post->AutorGerenciaR3), $row);
                        $row = str_replace("{TipoPost}", ($MP_Post->TipoPost), $row);
                        $row = str_replace("{id_GrupoIntPost}", ($MP_Post->id_GrupoIntPost), $row);
                        $row = str_replace("{GrupoIntPost}", ($MP_Post->GrupoIntPost), $row);
                        $row = str_replace("{RUTremitente}", ($MP_Post->RUTremitente), $row);
                        $row = str_replace("{RemNombre}", ($MP_Post->RemNombre), $row);
                        $row = str_replace("{RemCargo}", ($MP_Post->RemCargo), $row);
                        $row = str_replace("{RemEmail}", ($MP_Post->RemEmail), $row);
                        $row = str_replace("{RemGerencia}", ($MP_Post->RemGerencia), $row);
                        $row = str_replace("{RemGerenciaR2}", ($MP_Post->RemGerenciaR2), $row);
                        $row = str_replace("{RemGerenciaR3}", ($MP_Post->RemGerenciaR3), $row);
                        echo $row;
                    }
                    if ($interaccion == "0" or $interaccion == "PUBLICACION_POST") {
                        $MP_Posteos = MPTraePostPorDia($MP_dia->fecha, $id_empresa);
                    }
                    foreach ($MP_Posteos as $MP_Post) {
                        //$categorias=TraeCategorias();
                        $row = file_get_contents("views/mejores_practicas/row_estadisticas.html");
                        $row = str_replace("{FechaInt}", ($MP_Post->FechaInt), $row);
                        $row = str_replace("{tipoInteraccion}", ($MP_Post->tipoInteraccion), $row);
                        $row = str_replace("{RUTcolaborador}", ($MP_Post->RUTcolaborador), $row);
                        $row = str_replace("{ColNombre}", ($MP_Post->ColNombre), $row);
                        $row = str_replace("{ColCargo}", ($MP_Post->ColCargo), $row);
                        $row = str_replace("{ColEmail}", ($MP_Post->ColEmail), $row);
                        $row = str_replace("{ColGerencia}", ($MP_Post->ColGerencia), $row);
                        $row = str_replace("{ColGerenciaR2}", ($MP_Post->ColGerenciaR2), $row);
                        $row = str_replace("{ColGerenciaR3}", ($MP_Post->ColGerenciaR3), $row);
                        $row = str_replace("{GrupoSeguido}", $MP_Post->GrupoSeguido, $row);
                        $row = str_replace("{Aptitud}", ($MP_Post->Aptitud), $row);
                        $row = str_replace("{mensaje}", ($MP_Post->mensaje), $row);
                        $row = str_replace("{id_post}", ($MP_Post->id_post), $row);
                        $row = str_replace("{mensaje}", ($MP_Post->mensaje), $row);
                        $row = str_replace("{id_post}", ($MP_Post->id_post), $row);
                        $row = str_replace("{TituloPost}", ($MP_Post->TituloPost), $row);
                        $row = str_replace("{RutAutor}", ($MP_Post->RutAutor), $row);
                        $row = str_replace("{NombreAutor}", ($MP_Post->NombreAutor), $row);
                        $row = str_replace("{AutorCargo}", ($MP_Post->AutorCargo), $row);
                        $row = str_replace("{AutorEmail}", ($MP_Post->AutorEmail), $row);
                        $row = str_replace("{AutorGerencia}", ($MP_Post->AutorGerencia), $row);
                        $row = str_replace("{AutorGerenciaR2}", ($MP_Post->AutorGerenciaR2), $row);
                        $row = str_replace("{AutorGerenciaR3}", ($MP_Post->AutorGerenciaR3), $row);
                        $row = str_replace("{TipoPost}", ($MP_Post->TipoPost), $row);
                        $row = str_replace("{id_GrupoIntPost}", ($MP_Post->id_GrupoIntPost), $row);
                        $row = str_replace("{GrupoIntPost}", ($MP_Post->GrupoIntPost), $row);
                        $row = str_replace("{RUTremitente}", ($MP_Post->RUTremitente), $row);
                        $row = str_replace("{RemNombre}", ($MP_Post->RemNombre), $row);
                        $row = str_replace("{RemCargo}", ($MP_Post->RemCargo), $row);
                        $row = str_replace("{RemEmail}", ($MP_Post->RemEmail), $row);
                        $row = str_replace("{RemGerencia}", ($MP_Post->RemGerencia), $row);
                        $row = str_replace("{RemGerenciaR2}", ($MP_Post->RemGerenciaR2), $row);
                        $row = str_replace("{RemGerenciaR3}", ($MP_Post->RemGerenciaR3), $row);
                        echo $row;
                    }
                    if ($interaccion == "0" or $interaccion == "LOGIN") {
                        $MP_Logueos = MPTraeLogueosPorDia($MP_dia->fecha, $id_empresa);
                    }
                    foreach ($MP_Logueos as $MP_Logueo) {
                        $row = file_get_contents("views/mejores_practicas/row_estadisticas.html");
                        $row = str_replace("{FechaInt}", ($MP_Logueo->FechaInt), $row);
                        $row = str_replace("{tipoInteraccion}", ($MP_Logueo->tipoInteraccion), $row);
                        $row = str_replace("{RUTcolaborador}", ($MP_Logueo->RUTcolaborador), $row);
                        $row = str_replace("{ColNombre}", ($MP_Logueo->ColNombre), $row);
                        $row = str_replace("{ColCargo}", ($MP_Logueo->ColCargo), $row);
                        $row = str_replace("{ColEmail}", ($MP_Logueo->ColEmail), $row);
                        $row = str_replace("{ColGerencia}", ($MP_Logueo->ColGerencia), $row);
                        $row = str_replace("{ColGerenciaR2}", ($MP_Logueo->ColGerenciaR2), $row);
                        $row = str_replace("{ColGerenciaR3}", ($MP_Logueo->ColGerenciaR3), $row);
                        $row = str_replace("{GrupoSeguido}", $MP_Logueo->GrupoSeguido, $row);
                        $row = str_replace("{Aptitud}", ($MP_Logueo->Aptitud), $row);
                        $row = str_replace("{mensaje}", ($MP_Logueo->mensaje), $row);
                        $row = str_replace("{id_post}", ($MP_Logueo->id_post), $row);
                        $row = str_replace("{mensaje}", ($MP_Logueo->mensaje), $row);
                        $row = str_replace("{id_post}", ($MP_Logueo->id_post), $row);
                        $row = str_replace("{TituloPost}", ($MP_Logueo->TituloPost), $row);
                        $row = str_replace("{RutAutor}", ($MP_Logueo->RutAutor), $row);
                        $row = str_replace("{NombreAutor}", ($MP_Logueo->NombreAutor), $row);
                        $row = str_replace("{AutorCargo}", ($MP_Logueo->AutorCargo), $row);
                        $row = str_replace("{AutorEmail}", ($MP_Logueo->AutorEmail), $row);
                        $row = str_replace("{AutorGerencia}", ($MP_Logueo->AutorGerencia), $row);
                        $row = str_replace("{AutorGerenciaR2}", ($MP_Logueo->AutorGerenciaR2), $row);
                        $row = str_replace("{AutorGerenciaR3}", ($MP_Logueo->AutorGerenciaR3), $row);
                        $row = str_replace("{TipoPost}", ($MP_Logueo->TipoPost), $row);
                        $row = str_replace("{id_GrupoIntPost}", ($MP_Logueo->id_GrupoIntPost), $row);
                        $row = str_replace("{GrupoIntPost}", ($MP_Logueo->GrupoIntPost), $row);
                        $row = str_replace("{RUTremitente}", ($MP_Logueo->RUTremitente), $row);
                        $row = str_replace("{RemNombre}", ($MP_Logueo->RemNombre), $row);
                        $row = str_replace("{RemCargo}", ($MP_Logueo->RemCargo), $row);
                        $row = str_replace("{RemEmail}", ($MP_Logueo->RemEmail), $row);
                        $row = str_replace("{RemGerencia}", ($MP_Logueo->RemGerencia), $row);
                        $row = str_replace("{RemGerenciaR2}", ($MP_Logueo->RemGerenciaR2), $row);
                        $row = str_replace("{RemGerenciaR3}", ($MP_Logueo->RemGerenciaR3), $row);
                        echo $row;
                    }
                    //MPTraeLogueosPorDia($fecha, $id_empresa);
                    //MPTraeLogueosPorDia($fecha, $id_empresa);
                }
            }

            function lista_practicas($html, $id_empresa, $idcategoria)
            {
//trae mejores practicas
                $MejoresPracticas = TraeMejoresPracticasPorEmpresa($idproceso, $id_empresa, "");
                //print_r($MejoresPracticas);
                $row = file_get_contents("views/mejores_practicas/entorno_practicas.html");
                foreach ($MejoresPracticas as $MejorPractica) {
                    //$categorias=TraeCategorias();
                    $row = file_get_contents("views/mejores_practicas/lista_practicas.html");
                    $autor = $MejorPractica->nombreautor;
                    $contenido = truncateMejorPractica($MejorPractica->contenido, 80);
                    $tags = buscaTags($MejorPractica->id_mp, $id_empresa);
                    $id_estado = $MejorPractica->id_estado;
                    $row = str_replace("{ID_MP}", utf8_encode($MejorPractica->id_mp), $row);
                    $row = str_replace("{ID_GRUPO}", utf8_encode($MejorPractica->id_subcategoria), $row);
                    $row = str_replace("{GRUPO}", utf8_encode($MejorPractica->grupo), $row);
                    $row = str_replace("{ESTADO}", utf8_encode($MejorPractica->nombreestado), $row);
                    $row = str_replace("{ESTILOESTADO}", $MejorPractica->nombreestiloestado, $row);
                    $row = str_replace("{FECHA}", utf8_encode($MejorPractica->fecha), $row);
                    $row = str_replace("{CATEGORIA}", utf8_encode($MejorPractica->nombrecategoria), $row);
                    $row = str_replace("{ICONOCATEGORIA}", utf8_encode($MejorPractica->iconocategoria), $row);
                    $row = str_replace("{STYLE}", utf8_encode($MejorPractica->style), $row);
                    $row = str_replace("{PRACTICA}", utf8_encode($MejorPractica->nombre), $row);
                    $row = str_replace("{CONTENIDO}", utf8_encode($contenido), $row);
                    $row = str_replace("{CONTENIDOFULL}", utf8_encode($MejorPractica->contenido), $row);
                    $row = str_replace("{GRUPOCERRADO}", utf8_encode($MejorPractica->grupocerrado), $row);
                    $row = str_replace("{VISITAS}", utf8_encode($MejorPractica->numvisitastotales), $row);
                    $row = str_replace("{VISITANTES}", utf8_encode($MejorPractica->numvisitantes), $row);
                    $row = str_replace("{DESCARGAS}", utf8_encode($MejorPractica->numdescargas), $row);
                    $row = str_replace("{MEGUSTA}", utf8_encode($MejorPractica->nummegusta), $row);
                    $row = str_replace("{FAVORITA}", utf8_encode($MejorPractica->numfavorita), $row);
                    $row = str_replace("{COMENTARIOS}", utf8_encode($MejorPractica->numcomentarios), $row);
                    $row = str_replace("{OBJETIVO}", utf8_encode($MejorPractica->objetivo), $row);
                    $row = str_replace("{IMPACTO}", utf8_encode($MejorPractica->impacto), $row);
                    $row = str_replace("{TAG}", utf8_encode($tags), $row);
                    $row = str_replace("{AUTOR}", utf8_encode($autor), $row);
                    $row = str_replace("{OPTIONS_ESTADOS_MEJORES_PRACTICAS}", utf8_encode($estados_options), $row);
                    $row = str_replace("{OPTIONS_CATEGORIAS_MEJORES_PRACTICAS}", utf8_encode($categorias_options), $row);
                    $row = str_replace("{OPTIONS_USUARIOS_MEJORES_PRACTICAS}", utf8_encode($usuarios_options), $row);
                    $total_html .= $row;
                }
                $total_html = str_replace("{NIVEL}", "2", $total_html);
                $total_html = str_replace("{SUB_CAT}", "", $total_html);
                $total_html = str_replace("{NSUB}", "", $total_html);
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Preguntas y Respuestas", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_practicas_preguntas($html, $id_empresa, $idcategoria)
            {
//trae mejores practicas
                $MejoresPracticas = TraeMejoresPracticasPreguntasPorEmpresa($idproceso, $id_empresa, "");
                $row = file_get_contents("views/mejores_practicas/entorno_practicas.html");
                foreach ($MejoresPracticas as $MejorPractica) {
                    //$categorias=TraeCategorias();
                    $row = file_get_contents("views/mejores_practicas/lista_preguntas.html");
                    $autor = $MejorPractica->nombreautor;
                    $contenido = truncateMejorPractica($MejorPractica->contenido, 1000);
                    //echo "<br><br><br><br>contenido ".$MejorPractica->contenido;
                    if ($MejorPractica->contenido <> '') {
                        $row = str_replace("{ESTILOESTADO}", "mp_estado_5", $row);
                        $row = str_replace("{ESTADO}", "RESPONDIDA", $row);
                    } else {
                        $row = str_replace("{ESTILOESTADO}", "mp_estado_3", $row);
                        $row = str_replace("{ESTADO}", "SIN RESPONDER", $row);
                    }
                    $tags = buscaTags($MejorPractica->id_mp, $id_empresa);
                    $id_estado = $MejorPractica->id_estado;
                    $row = str_replace("{ID_MP}", utf8_encode($MejorPractica->id_mp), $row);
                    $row = str_replace("{FECHA}", utf8_encode($MejorPractica->fecha), $row);
                    $row = str_replace("{CATEGORIA}", utf8_encode($MejorPractica->nombrecategoria), $row);
                    $row = str_replace("{ICONOCATEGORIA}", utf8_encode($MejorPractica->iconocategoria), $row);
                    $row = str_replace("{STYLE}", utf8_encode($MejorPractica->style), $row);
                    $row = str_replace("{PRACTICA}", utf8_encode($MejorPractica->nombre), $row);
                    $row = str_replace("{CONTENIDO}", utf8_encode($contenido), $row);
                    $row = str_replace("{CONTENIDOFULL}", utf8_encode($MejorPractica->contenido), $row);
                    $row = str_replace("{VISITAS}", utf8_encode($MejorPractica->numvisitas), $row);
                    $row = str_replace("{DESCARGAS}", utf8_encode($MejorPractica->numdescargas), $row);
                    $row = str_replace("{MEGUSTA}", utf8_encode($MejorPractica->nummegusta), $row);
                    $row = str_replace("{FAVORITA}", utf8_encode($MejorPractica->numfavorita), $row);
                    $row = str_replace("{COMENTARIOS}", utf8_encode($MejorPractica->numcomentarios), $row);
                    $row = str_replace("{OBJETIVO}", utf8_encode($MejorPractica->objetivo), $row);
                    $row = str_replace("{IMPACTO}", utf8_encode($MejorPractica->impacto), $row);
                    $row = str_replace("{TAG}", utf8_encode($tags), $row);
                    $row = str_replace("{AUTOR}", utf8_encode($autor), $row);
                    $row = str_replace("{OPTIONS_ESTADOS_MEJORES_PRACTICAS}", utf8_encode($estados_options), $row);
                    $row = str_replace("{OPTIONS_CATEGORIAS_MEJORES_PRACTICAS}", utf8_encode($categorias_options), $row);
                    $row = str_replace("{OPTIONS_USUARIOS_MEJORES_PRACTICAS}", utf8_encode($usuarios_options), $row);
                    $total_html .= $row;
                }
                $total_html = str_replace("{NIVEL}", "2", $total_html);
                $total_html = str_replace("{SUB_CAT}", "", $total_html);
                $total_html = str_replace("{NSUB}", "", $total_html);
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Preguntas y Respuestas", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_practicas_full($html, $id_empresa, $id_mp)
            {
//trae mejores practicas
                $MejoresPracticas = TraeMejoresPracticasPorEmpresa($idproceso, $id_empresa, $id_mp);
                $row = file_get_contents("views/mejores_practicas/entorno_practicas.html");
                $options_grupo_interes = mp_busca_Categorias($id_empresa);
                $options_estados = mp_busca_Estados($id_empresa);
                $options_grupos_cerrados = mp_busca_Olas_GruposCerrados($id_empresa);
                //print_r($options_grupo_interes);
                //print_r($MejoresPracticas);
                foreach ($MejoresPracticas as $MejorPractica) {
                    //$categorias=TraeCategorias();
                    $row = file_get_contents("views/mejores_practicas/lista_practicas_full.html");
                    $autor = $MejorPractica->nombreautor;
                    $contenido = truncateMejorPractica($MejorPractica->contenido, 80);
                    $tags = buscaTags($MejorPractica->id_mp, $id_empresa);
                    $id_estado = $MejorPractica->id_estado;
                    $row = str_replace("{ID_MP}", utf8_encode($MejorPractica->id_mp), $row);
                    $row = str_replace("{RUT_AUTOR}", utf8_encode($MejorPractica->rut), $row);
                    $row = str_replace("{TIPO}", utf8_encode($MejorPractica->tipo), $row);
                    $row = str_replace("{FUENTE}", utf8_encode($MejorPractica->fuente), $row);
                    $row = str_replace("{RESUMEN}", utf8_encode($MejorPractica->resumen), $row);
                    $row = str_replace("{NOMBRE_AUTOR}", utf8_encode($MejorPractica->nombreautor), $row);
                    $row = str_replace("{ID_ESTADO}", utf8_encode($MejorPractica->id_estado), $row);
                    $row = str_replace("{ID_AMBITO}", utf8_encode($MejorPractica->id_ambito), $row);
                    $row = str_replace("{ESTADO}", utf8_encode($MejorPractica->nombreestado), $row);
                    $row = str_replace("{ESTILOESTADO}", $MejorPractica->nombreestiloestado, $row);
                    $row = str_replace("{FECHA}", utf8_encode($MejorPractica->fecha), $row);
                    $row = str_replace("{VIDEO}", utf8_encode($MejorPractica->video), $row);
                    $row = str_replace("{URL}", utf8_encode($MejorPractica->url_documento), $row);
                    $row = str_replace("{ID_CATEGORIA}", utf8_encode($MejorPractica->id_categoria), $row);
                    $row = str_replace("{CATEGORIA}", utf8_encode($MejorPractica->nombrecategoria), $row);
                    $row = str_replace("{ICONOCATEGORIA}", utf8_encode($MejorPractica->iconocategoria), $row);
                    $row = str_replace("{STYLE}", utf8_encode($MejorPractica->style), $row);
                    $row = str_replace("{PRACTICA}", utf8_encode($MejorPractica->nombre), $row);
                    $row = str_replace("{CONTENIDO}", utf8_encode($contenido), $row);
                    $row = str_replace("{CONTENIDOFULL}", utf8_encode($MejorPractica->contenido), $row);
                    $row = str_replace("{IMAGEN_FONDO}", utf8_encode($MejorPractica->imagenfondo), $row);
                    $row = str_replace("{ID_SUBCATEGORIA}", utf8_encode($MejorPractica->id_subcategoria), $row);
                    $row = str_replace("{OBJETIVO}", utf8_encode($MejorPractica->objetivo), $row);
                    $row = str_replace("{IMPACTO}", utf8_encode($MejorPractica->impacto), $row);
                    $row = str_replace("{TAG1}", utf8_encode($MejorPractica->tag1), $row);
                    $row = str_replace("{TAG2}", utf8_encode($MejorPractica->tag2), $row);
                    $row = str_replace("{TAG3}", utf8_encode($MejorPractica->tag3), $row);
                    $row = str_replace("{TAG4}", utf8_encode($MejorPractica->tag4), $row);
                    $row = str_replace("{TAG5}", utf8_encode($MejorPractica->tag5), $row);
                    $row = str_replace("{URL}", utf8_encode($MejorPractica->url_documento), $row);
                    $row = str_replace("{ARCHIVO}", utf8_encode($MejorPractica->archivo), $row);
                    $row = str_replace("{AUTOR}", utf8_encode($autor), $row);
                    $row = str_replace("{OPTIONS_ESTADOS_MEJORES_PRACTICAS}", utf8_encode($options_estados), $row);
                    $row = str_replace("{OPTIONS_CATEGORIAS_MEJORES_PRACTICAS}", utf8_encode($options_grupo_interes), $row);
                    $row = str_replace("{OPTIONS_GRUPOS_CERRADOS}", utf8_encode($options_grupos_cerrados), $row);
                    $total_html .= $row;
                }
//FORM COMENTARIO
                $MPComentarios = MP_Comentarios_nivel1($MejorPractica->id_mp);
//print_r($MPComentarios);
                foreach ($MPComentarios as $MPComentario) {
                    //$categorias=TraeCategorias();
                    $row = file_get_contents("views/mejores_practicas/lista_comentarios_nivel1.html");
                    $row = str_replace("{ID_COMENTARIO}", utf8_encode($MPComentario->id), $row);
                    $row = str_replace("{NOMBRE_COMENTARIO}", utf8_encode($MPComentario->nombre), $row);
                    $row = str_replace("{COMENTARIO}", utf8_encode($MPComentario->comentario), $row);
                    $total_html .= $row;
                    ///sub comentarios
                    $MPComentarios2 = MP_Comentarios_nivel2($MejorPractica->id_mp, $MPComentario->id);
                    //print_r($MPComentarios2);
                    foreach ($MPComentarios2 as $MPComentario2) {
                        $row = file_get_contents("views/mejores_practicas/lista_comentarios_nivel2.html");
                        $row = str_replace("{ID_COMENTARIO_N2}", utf8_encode($MPComentario2->id), $row);
                        $row = str_replace("{NOMBRE_COMENTARIO_N2}", utf8_encode($MPComentario2->nombre), $row);
                        $row = str_replace("{COMENTARIO_N2}", utf8_encode($MPComentario2->comentario), $row);
                        $total_html .= $row;
                    }
                }
                $total_html = str_replace("{NIVEL}", "2", $total_html);
                $total_html = str_replace("{SUB_CAT}", "", $total_html);
                $total_html = str_replace("{NSUB}", "", $total_html);
                $html = str_replace("{LISTA_FULL}", $total_html, $html);
                $html = str_replace("{TITULO}", "Preguntas y Respuestas", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_practicas_full_pregunta($html, $id_empresa, $id_mp)
            {
//trae mejores practicas
                $MejoresPracticas = TraeMejoresPracticasPreguntasPorEmpresa($idproceso, $id_empresa, $id_mp);
                $row = file_get_contents("views/mejores_practicas/entorno_preguntas.html");
                $options_grupo_interes = mp_busca_Categorias($id_empresa);
                $options_estados = mp_busca_Estados($id_empresa);
                //print_r($options_grupo_interes);
                //print_r($MejoresPracticas);
                foreach ($MejoresPracticas as $MejorPractica) {
                    //$categorias=TraeCategorias();
                    $row = file_get_contents("views/mejores_practicas/lista_practicas_full_pregunta.html");
                    $autor = $MejorPractica->nombreautor;
                    $contenido = truncateMejorPractica($MejorPractica->contenido, 80);
                    $tags = buscaTags($MejorPractica->id_mp, $id_empresa);
                    $id_estado = $MejorPractica->id_estado;
                    $row = str_replace("{ID_MP}", utf8_encode($MejorPractica->id_mp), $row);
                    $row = str_replace("{RUT_AUTOR}", utf8_encode($MejorPractica->rut), $row);
                    $row = str_replace("{TIPO}", utf8_encode($MejorPractica->tipo), $row);
                    $row = str_replace("{FUENTE}", utf8_encode($MejorPractica->fuente), $row);
                    $row = str_replace("{RESUMEN}", utf8_encode($MejorPractica->resumen), $row);
                    $row = str_replace("{NOMBRE_AUTOR}", utf8_encode($MejorPractica->nombreautor), $row);
                    $row = str_replace("{ID_ESTADO}", utf8_encode($MejorPractica->id_estado), $row);
                    $row = str_replace("{ID_AMBITO}", utf8_encode($MejorPractica->id_ambito), $row);
                    $row = str_replace("{ESTADO}", utf8_encode($MejorPractica->nombreestado), $row);
                    $row = str_replace("{ESTILOESTADO}", $MejorPractica->nombreestiloestado, $row);
                    $row = str_replace("{FECHA}", utf8_encode($MejorPractica->fecha), $row);
                    $row = str_replace("{VIDEO}", utf8_encode($MejorPractica->video), $row);
                    $row = str_replace("{URL}", utf8_encode($MejorPractica->url_documento), $row);
                    $row = str_replace("{ID_CATEGORIA}", utf8_encode($MejorPractica->id_categoria), $row);
                    $row = str_replace("{CATEGORIA}", utf8_encode($MejorPractica->nombrecategoria), $row);
                    $row = str_replace("{ICONOCATEGORIA}", utf8_encode($MejorPractica->iconocategoria), $row);
                    $row = str_replace("{STYLE}", utf8_encode($MejorPractica->style), $row);
                    $row = str_replace("{PRACTICA}", utf8_encode($MejorPractica->nombre), $row);
                    $row = str_replace("{CONTENIDO}", utf8_encode($contenido), $row);
                    $row = str_replace("{CONTENIDOFULL}", utf8_encode($MejorPractica->contenido), $row);
                    $row = str_replace("{OBJETIVO}", utf8_encode($MejorPractica->objetivo), $row);
                    $row = str_replace("{IMPACTO}", utf8_encode($MejorPractica->impacto), $row);
                    $row = str_replace("{TAG1}", utf8_encode($MejorPractica->tag1), $row);
                    $row = str_replace("{TAG2}", utf8_encode($MejorPractica->tag2), $row);
                    $row = str_replace("{TAG3}", utf8_encode($MejorPractica->tag3), $row);
                    $row = str_replace("{TAG4}", utf8_encode($MejorPractica->tag4), $row);
                    $row = str_replace("{TAG5}", utf8_encode($MejorPractica->tag5), $row);
                    $row = str_replace("{URL}", utf8_encode($MejorPractica->url_documento), $row);
                    $row = str_replace("{ARCHIVO}", utf8_encode($MejorPractica->archivo), $row);
                    $row = str_replace("{AUTOR}", utf8_encode($autor), $row);
                    $row = str_replace("{OPTIONS_ESTADOS_MEJORES_PRACTICAS}", utf8_encode($options_estados), $row);
                    $row = str_replace("{OPTIONS_CATEGORIAS_MEJORES_PRACTICAS}", utf8_encode($options_grupo_interes), $row);
                    $total_html .= $row;
                }
                $total_html = str_replace("{NIVEL}", "2", $total_html);
                $total_html = str_replace("{SUB_CAT}", "", $total_html);
                $total_html = str_replace("{NSUB}", "", $total_html);
                $html = str_replace("{LISTA_FULL}", $total_html, $html);
                $html = str_replace("{TITULO}", "Preguntas y Respuestas", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_practicas_categorias($html, $id_empresa, $idcategoria)
            {
                $CategoriasPracticas = TraeCategoriasMP($id_empresa);
                //print_r($CategoriasPracticas);
                $row = file_get_contents("views/mejores_practicas/entorno_practicas_edit_categorias.html");
                foreach ($CategoriasPracticas as $CategoriaPractica) {
                    //$categorias=TraeCategorias();
                    $row = file_get_contents("views/mejores_practicas/lista_practicas_edit_categorias.html");
                    $row = str_replace("{CATEGORIA}", utf8_encode($CategoriaPractica->categoria), $row);
                    $row = str_replace("{ID_CATEGORIA}", utf8_encode($CategoriaPractica->id_categoria), $row);
                    $visitas = TraeInteraccionporGrupo("VISITA", $CategoriaPractica->id_categoria, $id_empresa);
                    $megusta = TraeInteraccionporGrupo("MEGUSTA", $CategoriaPractica->id_categoria, $id_empresa);
                    $compartidoconmigo = TraeInteraccionporGrupo("COMPARTIDOCONMIGO", $CategoriaPractica->id_categoria, $id_empresa);
                    $comentarios = TraeInteraccionporGrupo("COMENTARIO", $CategoriaPractica->id_categoria, $id_empresa);
                    $row = str_replace("{VISITAS}", utf8_encode($visitas), $row);
                    $row = str_replace("{MEGUSTA}", utf8_encode($megusta), $row);
                    $row = str_replace("{FAVORITA}", utf8_encode($compartidoconmigo), $row);
                    $row = str_replace("{COMENTARIOS}", utf8_encode($comentarios), $row);
                    $total_html .= $row;
                }
                $total_html = str_replace("{NIVEL}", "2", $total_html);
                $total_html = str_replace("{SUB_CAT}", "", $total_html);
                $total_html = str_replace("{NSUB}", "", $total_html);
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Preguntas y Respuestas", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_practicas_palabras_prohibidas($html, $id_empresa, $idcategoria)
            {
                $PalabrasProhibidas = TraePalabrasMP($id_empresa);
                $row = file_get_contents("views/mejores_practicas/entorno_practicas_edit_palabras.html");
                foreach ($PalabrasProhibidas as $PalabraProhibida) {
                    $row = file_get_contents("views/mejores_practicas/lista_practicas_edit_palabras.html");
                    $row = str_replace("{PALABRA}", utf8_encode($PalabraProhibida->palabra), $row);
                    $row = str_replace("{ID_PALABRA}", utf8_encode($PalabraProhibida->id), $row);
                    $total_html .= $row;
                }
                $total_html = str_replace("{NIVEL}", "2", $total_html);
                $total_html = str_replace("{SUB_CAT}", "", $total_html);
                $total_html = str_replace("{NSUB}", "", $total_html);
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Preguntas y Respuestas", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_practicas_tag($html, $id_empresa, $idcategoria)
            {
                $Tags = TraeTagsMP($id_empresa);
                $row = file_get_contents("views/mejores_practicas/entorno_practicas_edit_tag.html");
                foreach ($Tags as $Tag) {
                    $row = file_get_contents("views/mejores_practicas/lista_practicas_edit_tag.html");
                    $row = str_replace("{TAG}", utf8_encode($Tag->tag), $row);
                    $row = str_replace("{NUM_PUBLICACIONES_TAG}", utf8_encode($Tag->cuenta), $row);
                    $row = str_replace("{ID_TAG}", utf8_encode($Tag->id), $row);
                    $total_html .= $row;
                }
                $total_html = str_replace("{NIVEL}", "2", $total_html);
                $total_html = str_replace("{SUB_CAT}", "", $total_html);
                $total_html = str_replace("{NSUB}", "", $total_html);
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Preguntas y Respuestas", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_practicas_frases($html, $id_empresa, $idcategoria)
            {
                $Frases = TraeFrasesMP($id_empresa);
                $row = file_get_contents("views/mejores_practicas/entorno_practicas_edit_frases.html");
                foreach ($Frases as $Frase) {
                    $row = file_get_contents("views/mejores_practicas/lista_practicas_edit_frases.html");
                    $row = str_replace("{FRASE}", utf8_encode($Frase->frase), $row);
                    $row = str_replace("{AUTOR}", utf8_encode($Frase->autor), $row);
                    $row = str_replace("{ID_FRASE}", utf8_encode($Frase->id), $row);
                    $total_html .= $row;
                }
                $total_html = str_replace("{NIVEL}", "2", $total_html);
                $total_html = str_replace("{SUB_CAT}", "", $total_html);
                $total_html = str_replace("{NSUB}", "", $total_html);
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Preguntas y Respuestas", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_practicas_mini_encuestas($html, $id_empresa, $idcategoria)
            {
                $Encuestas = TraeMiniEncuestasMP($id_empresa);
                foreach ($Encuestas as $Encuesta) {
                    $row = file_get_contents("views/mejores_practicas/lista_practicas_edit_miniencuestas.html");
                    $row = str_replace("{PREGUNTA}", utf8_encode($Encuesta->pregunta), $row);
                    $row = str_replace("{OPCION1}", utf8_encode($Encuesta->opcion1), $row);
                    $row = str_replace("{OPCION2}", utf8_encode($Encuesta->opcion2), $row);
                    $row = str_replace("{OPCION3}", utf8_encode($Encuesta->opcion3), $row);
                    $row = str_replace("{OPCION4}", utf8_encode($Encuesta->opcion4), $row);
                    $row = str_replace("{ACTIVA}", utf8_encode($Encuesta->activa), $row);
                    $row = str_replace("{ID_ENCUESTA}", utf8_encode($Encuesta->id), $row);
                    $row = str_replace("{NUM_RESPUESTAS}", utf8_encode($Encuesta->num_respuestas), $row);
                    if ($Encuesta->activa == 1) {
                        $row = str_replace("{ACTIVA_CHECKED}", "checked", $row);
                    } else {
                        $row = str_replace("{ACTIVA_CHECKED}", "", $row);
                    }
                    $total_html .= $row;
                }
                $total_html = str_replace("{NIVEL}", "2", $total_html);
                $total_html = str_replace("{SUB_CAT}", "", $total_html);
                $total_html = str_replace("{NSUB}", "", $total_html);
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Preguntas y Respuestas", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_practicas_expertos($html, $id_empresa, $idcategoria)
            {
                $ExpertosPracticas = TraExpertosPorEmpresa($id_empresa);
                //print_r($ExpertosPracticas);
                $categorias_options = mp_busca_Categorias($id_empresa);
                //print_r($categorias_options);
                $row = file_get_contents("views/mejores_practicas/entorno_expertos.html");
                foreach ($ExpertosPracticas as $ExpertoPractica) {
                    //echo "<br>hoa";
                    //print_r($ExpertoPractica);
                    //$categorias=TraeCategorias();
                    $row = file_get_contents("views/mejores_practicas/lista_practicas_edit_expertos.html");
                    $row = str_replace("{ID_EXPERTO}", utf8_encode($ExpertoPractica->id), $row);
                    $row = str_replace("{RUT_EXPERTO}", utf8_encode($ExpertoPractica->rut_completo), $row);
                    $row = str_replace("{RUT}", utf8_encode($ExpertoPractica->codigo), $row);
                    $row = str_replace("{EXPERTO}", utf8_encode($ExpertoPractica->nombre_completo), $row);
                    $row = str_replace("{CARGO}", utf8_encode($ExpertoPractica->cargo), $row);
                    $row = str_replace("{GERENCIA}", utf8_encode($ExpertoPractica->gerencia), $row);
                    $row = str_replace("{GRUPO}", utf8_encode($ExpertoPractica->categoria), $row);
                    $row = str_replace("{IDGRUPO}", utf8_encode($ExpertoPractica->contenido), $row);
                    $row = str_replace("{OPTIONS_CATEGORIAS_MEJORES_PRACTICAS}", utf8_encode($categorias_options), $row);
                    $total_html .= $row;
                }
                $total_html = str_replace("{NIVEL}", "2", $total_html);
                $total_html = str_replace("{SUB_CAT}", "", $total_html);
                $total_html = str_replace("{NSUB}", "", $total_html);
                $html = str_replace("{OPTIONS_CATEGORIAS_MEJORES_PRACTICAS_NUEVO}", utf8_encode($categorias_options), $html);
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Preguntas y Respuestas", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_puntos_stock($html, $id_empresa, $idcategoria)
            {
                $lista_puntos_stock_fe = lista_puntos_stock_data($id_empresa);
                //print_r($lista_puntos_stock_fe);    //$categorias_options=mp_busca_Categorias($id_empresa);    //print_r($categorias_options);

                $row = file_get_contents("views/puntos/entorno_puntos_stock.html");
                foreach ($lista_puntos_stock_fe as $unico) {
                    $row = file_get_contents("views/puntos/row_puntos_stock.html");
                    $row = str_replace("{ID}", utf8_encode($unico->id), $row);
                    $row = str_replace("{ORDEN}", utf8_encode($unico->orden), $row);
                    $row = str_replace("{CODIGO}", utf8_encode($unico->id_premio), $row);
                    $row = str_replace("{NOMBRE}", utf8_encode($unico->premio), $row);
                    $row = str_replace("{DESCRIPCION}", utf8_encode($unico->premio_descripcion), $row);
                    $row = str_replace("{CONDICIONES}", utf8_encode($unico->condiciones), $row);
                    $row = str_replace("{REQUISITOS}", utf8_encode($unico->requisitos), $row);
                    $row = str_replace("{DIMENSION}", utf8_encode($unico->dimension), $row);
                    $row = str_replace("{SEGMENTO}", utf8_encode($unico->segmento), $row);
                    $row = str_replace("{PUNTOS}", utf8_encode($unico->puntos), $row);
                    $row = str_replace("{CANJEADOS}", utf8_encode($unico->canjeados), $row);
                    $row = str_replace("{VALIDAJEFE}", utf8_encode($unico->aprobacionjefe), $row);
                    $row = str_replace("{TEMPORAL}", utf8_encode($unico->temporalidad), $row);
                    $row = str_replace("{REGION}", utf8_encode($unico->region), $row);
                    $row = str_replace("{DIA}", utf8_encode($unico->dia), $row);
                    $row = str_replace("{SOLICITADIA}", utf8_encode($unico->solicitadia), $row);
                    $row = str_replace("{ULTIMASUNIDADES}", utf8_encode($unico->alertaultimasunidades), $row);
                    $row = str_replace("{STOCK}", utf8_encode($unico->stock), $row);
                    $row = str_replace("{SALDO}", round($unico->stock - $unico->canjeados), $row);
                    $row = str_replace("{ALERTAWEB}", utf8_encode($unico->alertaweb), $row);
                    $row = str_replace("{ALERTAEMAILCOL}", utf8_encode($unico->alertaemailusuario), $row);
                    $row = str_replace("{ALERTAEMAILJEFE}", utf8_encode($unico->alertaemailjefe), $row);
                    $row = str_replace("{IMAGEN}", ($unico->imagen), $row);
                    $row = str_replace("{FECHA_VENCIMIENTO}", utf8_encode($unico->fecha_vencimiento), $row);
                    $row = str_replace("{FECHA_INICIO}", utf8_encode($unico->fecha_inicio), $row);
                    $total_html .= $row;
                }

                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Gestión de Stock", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function Lista_fc_eventos($html, $id_empresa, $idcategoria)
            {
                $lista_puntos_stock_fe = Lista_fc_eventos_data($id_empresa);
                //print_r($lista_puntos_stock_fe);

                //$categorias_options=mp_busca_Categorias($id_empresa);    //print_r($categorias_options);
                $row = file_get_contents("views/formacion_continua/entorno_formacioncontinua_eventos.html");
                foreach ($lista_puntos_stock_fe as $unico) {
                    $row = file_get_contents("views/formacion_continua/row_fc_eventos.html");
                    $row = str_replace("{ID}", utf8_encode($unico->id), $row);

                    if ($unico->invisible == 1) {
                        $estado = "<span class='label bg-red'>DESACTIVO</span>";
                    } else {
                        $estado = "<span class='label bg-blue'>ACTIVO</span>";
                    }

                    $row = str_replace("{ESTADO}", utf8_encode($estado), $row);
                    $row = str_replace("{CODIGO}", utf8_encode($unico->id_postulable), $row);
                    $row = str_replace("{NOMBRE}", utf8_encode($unico->nombre), $row);
                    $row = str_replace("{DESCRIPCION}", utf8_encode($unico->descripcion), $row);
                    $row = str_replace("{DATO1}", utf8_encode($unico->dato1), $row);
                    $row = str_replace("{MODALIDAD}", utf8_encode($unico->modalidad), $row);
                    $row = str_replace("{FICHA}", utf8_encode($unico->ficha), $row);
                    $row = str_replace("{INSTITUCION}", utf8_encode($unico->institucion), $row);
                    $row = str_replace("{REGION}", utf8_encode($unico->region), $row);
                    $row = str_replace("{DIMENSION}", utf8_encode($unico->dimension), $row);
                    $row = str_replace("{DESACTIVO}", utf8_encode($unico->desactivo), $row);
                    $total_html .= $row;
                }
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Gestión de Eventos Formación Continua", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_agradecimiento($html, $id_empresa, $year, $idcategoria)
            {

                //echo "$id_empresa, $year, $idcategoria";
                $lista = lista_agradecimiento_data($id_empresa, $year);
                //print_r($lista_puntos_stock_fe);    //$categorias_options=mp_busca_Categorias($id_empresa);    //print_r($categorias_options);
                foreach ($lista as $unico) {


                    $Datos_Remitente = TraeNombreUsuario($unico->rut_remitente);
                    $Datos_Destinatario = TraeNombreUsuario($unico->rut_destinatario);

                    if ($unico->estadovalidacion == "1") {
                        $estado = "VALIDADO";
                        $estado_estilo = "<span class='badge badge-info'>Validado</span>";
                        $accion1 = "";
                        $accion2 = "";
                    }
                    if ($unico->estadovalidacion == "2") {
                        $estado = "PENDIENTE";
                        $estado_estilo = "<span class='badge badge-warning'>Pendiente</span>";
                    }
                    if ($unico->estadovalidacion == "3") {
                        $estado = "RECHAZADO";
                        $estado_estilo = "<span class='badge badge-danger'>Rechazado</span>";
                        $accion1 = "";
                        $accion2 = "";
                    }

                    // $accion1="<a href='?sw=puntos_canjes&idbencanj=".$unico->id."&valida=1' class='btn btn-success btn-xs' style='display: inline;'>Validar</a>";
                    // $accion2="<a href='?sw=puntos_canjes&idbencanj=".$unico->id."&valida=3' class='btn btn-danger btn-xs' style='display: inline;'>Rechazar</a>";
                    $fecha_espanol = FechaEspanol($unico->fecha);
                    $row = file_get_contents("views/reconocimiento/row_agradecimientos.html");
                    $row = str_replace("{ID}", utf8_encode($unico->id), $row);
                    $row = str_replace("{NOMBRE_DESTINATARIO}", utf8_encode($Datos_Destinatario[0]->nombre_completo), $row);
                    $row = str_replace("{RUT_DESTINATARIO}", utf8_encode($unico->rut_destinatario), $row);
                    $row = str_replace("{NOMBRE_REMITENTE}", utf8_encode($Datos_Remitente[0]->nombre_completo), $row);
                    $row = str_replace("{RUT_REMITENTE}", utf8_encode($unico->rut_remitente), $row);
                    $row = str_replace("{CATEGORIA}", utf8_encode($unico->categorita), $row);
                    $row = str_replace("{MENSAJE}", utf8_encode($unico->mensaje), $row);
                    $row = str_replace("{FECHA}", ($fecha_espanol), $row);
                    $row = str_replace("{ESTADO}", utf8_encode($unico->estado), $row);
                    $row = str_replace("{BOTON_ACCION1}", utf8_encode($accion1), $row);
                    $row = str_replace("{BOTON_ACCION2}", utf8_encode($accion2), $row);

                    $total_html .= $row;
                }
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Agradecimientos", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                $html = str_replace("{YEAR}", $year, $html);

                return ($html);
            }

            function lista_reconocimiento($html, $id_empresa, $year, $s, $tipo, $idcategoria)
            {

                //echo "<br>$id_empresa, $year, $s, $tipo, $idcategoria<br>";
                $lista = lista_reconocimiento_data($id_empresa, $year, $s, $tipo);

                //$categorias_options=mp_busca_Categorias($id_empresa);    //print_r($categorias_options);
                foreach ($lista as $unico) {
                    //$datos_colaborador=TraeDatosUsuario($unico->rut);
                    //$datos_jefe=TraeDatosUsuario($datos_colaborador[0]->jefe);
                    if ($unico->estadovalidacion == "1") {
                        $estado = "VALIDADO";
                        $estado_estilo = "<span class='badge badge-info'>Validado</span>";
                        $accion1 = "";
                        $accion2 = "";
                    }
                    if ($unico->estadovalidacion == "2") {
                        $estado = "PENDIENTE";
                        $estado_estilo = "<span class='badge badge-warning'>Pendiente</span>";
                    }
                    if ($unico->estadovalidacion == "3") {
                        $estado = "RECHAZADO";
                        $estado_estilo = "<span class='badge badge-danger'>Rechazado</span>";
                        $accion1 = "";
                        $accion2 = "";
                    }

                    //$accion1="<a href='?sw=puntos_canjes&idbencanj=".$unico->id."&valida=1' class='btn btn-success btn-xs' style='display: inline;'>Validar</a>";
                    //$accion2="<a href='?sw=puntos_canjes&idbencanj=".$unico->id."&valida=3' class='btn btn-danger btn-xs' style='display: inline;'>Rechazar</a>";


                    if ($tipo == "col") {
                        $categoria = "COLABORACION";
                    }
                    if ($tipo == "sel") {
                        $categoria = "SELECCION DEL CHILE";
                    }

                    $Datos_Remitente = TraeNombreUsuario($unico->rut_remitente);
                    $Datos_Destinatario = TraeNombreUsuario($unico->rut_destinatario);
                    $fecha_espanol = FechaEspanol($unico->fecha);

                    $row = file_get_contents("views/reconocimiento/row_reconocimientos.html");
                    $row = str_replace("{ID}", utf8_encode($unico->id), $row);
                    $row = str_replace("{NOMBRE_DESTINATARIO}", utf8_encode($Datos_Destinatario[0]->nombre_completo), $row);
                    $row = str_replace("{RUT_DESTINATARIO}", utf8_encode($unico->rut_destinatario), $row);
                    $row = str_replace("{NOMBRE_REMITENTE}", utf8_encode($Datos_Remitente[0]->nombre_completo), $row);
                    $row = str_replace("{RUT_REMITENTE}", utf8_encode($unico->rut_remitente), $row);
                    $row = str_replace("{CATEGORIA}", utf8_encode($categoria), $row);
                    $row = str_replace("{MENSAJE}", utf8_encode($unico->mensaje), $row);
                    $row = str_replace("{FECHA}", ($fecha_espanol), $row);
                    $row = str_replace("{ESTADO}", utf8_encode($unico->estado), $row);
                    $row = str_replace("{PUNTOS}", utf8_encode($unico->puntos), $row);
                    $row = str_replace("{BOTON_ACCION1}", utf8_encode($accion1), $row);
                    $row = str_replace("{BOTON_ACCION2}", utf8_encode($accion2), $row);
                    $total_html .= $row;
                }
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Reconocimientos", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{YEAR}", $year, $html);
                $html = str_replace("{S}", $s, $html);
                $html = str_replace("{TIPO}", $tipo, $html);

                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_qa_lista_tickets($html, $id_empresa, $idcategoria)
            {
                $lista_puntos_stock_fe = lista_puntos_canjes_data($id_empresa);
                //print_r($lista_puntos_stock_fe);    //$categorias_options=mp_busca_Categorias($id_empresa);    //print_r($categorias_options);
                foreach ($lista_puntos_stock_fe as $unico) {
                    $datos_colaborador = TraeDatosUsuario($unico->rut);
                    $datos_jefe = TraeDatosUsuario($datos_colaborador[0]->jefe);
                    if ($unico->estadovalidacion == "1") {
                        $estado = "VALIDADO";
                        $estado_estilo = "<span class='badge badge-info'>Respondido</span>";
                        $accion1 = "";
                        $accion2 = "";
                    }
                    if ($unico->estadovalidacion == "2") {
                        $estado = "PENDIENTE";
                        $estado_estilo = "<span class='badge badge-warning'>Pendiente</span>";
                    }
                    if ($unico->estadovalidacion == "3") {
                        $estado = "RECHAZADO";
                        $estado_estilo = "<span class='badge badge-danger'>Derivado</span>";
                        $accion1 = "";
                        $accion2 = "";
                    }

                    $accion1 = "<a href='?sw=puntos_canjes&idbencanj=" . $unico->id . "&valida=1' class='btn btn-success btn-xs' style='display: inline;'>Responder</a>";
                    $accion2 = "<a href='?sw=puntos_canjes&idbencanj=" . $unico->id . "&valida=3' class='btn btn-info btn-xs' style='display: inline;'>Derivar</a>";

                    $row = file_get_contents("views/qa/row_tickets.html");
                    $row = str_replace("{ID_CANJE}", utf8_encode($unico->id), $row);
                    $row = str_replace("{NOMBRE_COMPLETO}", utf8_encode($datos_colaborador[0]->nombre_completo), $row);
                    $row = str_replace("{CARGO}", utf8_encode($unico->rut), $row);
                    $row = str_replace("{PREMIO}", "Categoria", $row);
                    $row = str_replace("{DIMENSION}", "Tema", $row);
                    $row = str_replace("{PUNTOS}", "La Pregunta del Colaborador", $row);
                    $row = str_replace("{DETALLES_PREMIO}", utf8_encode($unico->dimension), $row);
                    $row = str_replace("{NOMBRE_JEFATURA}", utf8_encode($datos_jefe[0]->nombre_completo), $row);
                    $row = str_replace("{CARGO_JEFATURA}", utf8_encode($datos_jefe[0]->cargo), $row);
                    $row = str_replace("{FECHA_CANJE}", utf8_encode($unico->fecha), $row);
                    $row = str_replace("{ESTADO}", utf8_encode($estado_estilo), $row);
                    $row = str_replace("{BOTON_ACCION1}", utf8_encode($accion1), $row);
                    $row = str_replace("{BOTON_ACCION2}", utf8_encode($accion2), $row);
                    $total_html .= $row;
                }
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Tickets", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_puntos_canjes($html, $id_empresa, $idcategoria)
            {
                $lista_puntos_stock_fe = lista_puntos_canjes_data($id_empresa);
                //print_r($lista_puntos_stock_fe);    //$categorias_options=mp_busca_Categorias($id_empresa);    //print_r($categorias_options);
                foreach ($lista_puntos_stock_fe as $unico) {
                    $datos_colaborador = TraeDatosUsuario($unico->rut);
                    $datos_jefe = TraeDatosUsuario($datos_colaborador[0]->jefe);
                    if ($unico->estadovalidacion == "1") {
                        $estado = "VALIDADO";
                        $estado_estilo = "<span class='badge badge-info'>Validado</span>";
                        $accion1 = "";
                        $accion2 = "";
                    }
                    if ($unico->estadovalidacion == "2") {
                        $estado = "PENDIENTE";
                        $estado_estilo = "<span class='badge badge-warning'>Pendiente</span>";
                    }
                    if ($unico->estadovalidacion == "3") {
                        $estado = "RECHAZADO";
                        $estado_estilo = "<span class='badge badge-danger'>Rechazado</span>";
                        $accion1 = "";
                        $accion2 = "";
                    }

                    $accion1 = "<a href='?sw=puntos_canjes&idbencanj=" . $unico->id . "&valida=1' class='btn btn-success btn-xs' style='display: inline;'>Validar</a>";
                    $accion2 = "<a href='?sw=puntos_canjes&idbencanj=" . $unico->id . "&valida=3' class='btn btn-danger btn-xs' style='display: inline;'>Rechazar</a>";

                    $row = file_get_contents("views/puntos/row_puntos_canjes.html");
                    $row = str_replace("{ID_CANJE}", utf8_encode($unico->id), $row);
                    $row = str_replace("{NOMBRE_COMPLETO}", utf8_encode($datos_colaborador[0]->nombre_completo), $row);
                    $row = str_replace("{CARGO}", utf8_encode($unico->rut), $row);
                    $row = str_replace("{PREMIO}", utf8_encode($unico->premio), $row);
                    $row = str_replace("{DIMENSION}", utf8_encode($unico->dimension), $row);
                    $row = str_replace("{PUNTOS}", utf8_encode($unico->puntos), $row);
                    $row = str_replace("{DETALLES_PREMIO}", utf8_encode($unico->dimension), $row);
                    $row = str_replace("{NOMBRE_JEFATURA}", utf8_encode($datos_jefe[0]->nombre_completo), $row);
                    $row = str_replace("{CARGO_JEFATURA}", utf8_encode($datos_jefe[0]->cargo), $row);
                    $row = str_replace("{FECHA_CANJE}", utf8_encode($unico->fecha), $row);
                    $row = str_replace("{ESTADO}", utf8_encode($estado_estilo), $row);
                    $row = str_replace("{BOTON_ACCION1}", utf8_encode($accion1), $row);
                    $row = str_replace("{BOTON_ACCION2}", utf8_encode($accion2), $row);
                    $total_html .= $row;
                }
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Canjes Realizados", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_puntos_canjes_despachos($html, $id_empresa, $idcategoria)
            {
                $lista_puntos_stock_fe = lista_puntos_canjes_despachos_data($id_empresa);
                //print_r($lista_puntos_stock_fe);    //$categorias_options=mp_busca_Categorias($id_empresa);    //print_r($categorias_options);
                foreach ($lista_puntos_stock_fe as $unico) {
                    $datos_colaborador = TraeDatosUsuario($unico->rut);
                    $datos_jefe = TraeDatosUsuario($datos_colaborador[0]->jefe);

                    $accion1 = "
<a href='?sw=puntos_canjes_despachos&idbencanj=" . $unico->id . "&valida=CAP' class='btn btn-success btn-xs' style='display: inline;'>CAP</a>
<a href='?sw=puntos_canjes_despachos&idbencanj=" . $unico->id . "&valida=VALIJA' class='btn btn-success btn-xs' style='display: inline;'>VALIJA</a>
<a href='?sw=puntos_canjes_despachos&idbencanj=" . $unico->id . "&valida=BCH' class='btn btn-success btn-xs' style='display: inline;'>BCH</a>
<a href='?sw=puntos_canjes_despachos&idbencanj=" . $unico->id . "&valida=CDR' class='btn btn-success btn-xs' style='display: inline;'>CDR</a>


";
                    $accion2 = "<a href='?sw=puntos_canjes_despachos&idbencanj=" . $unico->id . "&valida=3' class='btn btn-danger btn-xs' style='display: inline;'>Deshacer</a>";


                    if ($unico->despacho == "CAP") {
                        $estado = "DESPACHADO CAP";
                        $estado_estilo = "<span class='badge badge-info'>Despachado por CAP</span>";
                        $accion1 = "";
                    }
                    if ($unico->despacho == "VALIJA") {
                        $estado = "DESPACHADO VALIJA";
                        $estado_estilo = "<span class='badge badge-info'>Despachado por VALIJA</span>";
                        $accion1 = "";
                    }
                    if ($unico->despacho == "BCH") {
                        $estado = "DESPACHADO BCH";
                        $estado_estilo = "<span class='badge badge-info'>Despachado por BCH</span>";
                        $accion1 = "";
                    }
                    if ($unico->despacho == "") {
                        $estado = "PENDIENTE";
                        $estado_estilo = "<span class='badge badge-warning'>Pendiente</span>";
                        $accion2 = "";
                    }
                    if ($unico->despacho == "3") {
                        $estado = "RECHAZADO";
                        $estado_estilo = "<span class='badge badge-danger'>Rechazado</span>";
                        $accion2 = "";
                    }


                    $row = file_get_contents("views/puntos/row_puntos_canjes_despachos.html");
                    $row = str_replace("{ID_CANJE}", utf8_encode($unico->id), $row);
                    $row = str_replace("{NOMBRE_COMPLETO}", utf8_encode($datos_colaborador[0]->nombre_completo), $row);
                    $row = str_replace("{CARGO}", utf8_encode($unico->rut), $row);
                    $row = str_replace("{PREMIO}", utf8_encode($unico->premio), $row);
                    $row = str_replace("{DIMENSION}", utf8_encode($unico->dimension), $row);
                    $row = str_replace("{PUNTOS}", utf8_encode($unico->puntos), $row);
                    $row = str_replace("{DETALLES_PREMIO}", utf8_encode($unico->dimension), $row);
                    $row = str_replace("{NOMBRE_JEFATURA}", utf8_encode($datos_jefe[0]->nombre_completo), $row);
                    $row = str_replace("{CARGO_JEFATURA}", utf8_encode($datos_jefe[0]->cargo), $row);
                    $row = str_replace("{FECHA_DESPACHO}", utf8_encode($unico->fecha_despacho), $row);
                    $row = str_replace("{FECHA}", utf8_encode($unico->fecha), $row);
                    $row = str_replace("{ESTADO_DESPACHO}", utf8_encode($estado_estilo), $row);
                    $row = str_replace("{BOTON_ACCION1}", utf8_encode($accion1), $row);
                    $row = str_replace("{BOTON_ACCION2}", utf8_encode($accion2), $row);
                    $total_html .= $row;
                }
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Lista de Despachos", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_puntos_canjes_entregas($html, $id_empresa, $idcategoria)
            {
                $lista_puntos_stock_fe = lista_puntos_canjes_entregas_data($id_empresa);
                //print_r($lista_puntos_stock_fe);    //$categorias_options=mp_busca_Categorias($id_empresa);    //print_r($categorias_options);
                foreach ($lista_puntos_stock_fe as $unico) {
                    $datos_colaborador = TraeDatosUsuario($unico->rut);
                    $datos_jefe = TraeDatosUsuario($datos_colaborador[0]->jefe);

                    $accion1 = "<a href='?sw=puntos_canjes_entregas&idbencanj=" . $unico->id . "&valida=1' class='btn btn-success btn-xs' style='display: inline;'>Entregado</a>";
                    $accion2 = "<a href='?sw=puntos_canjes_entregas&idbencanj=" . $unico->id . "&valida=3' class='btn btn-danger btn-xs' style='display: inline;'>Deshacer</a>";

                    if ($unico->entrega == "1") {
                        $estado = "ENTREGADO";
                        $estado_estilo = "<span class='badge badge-info'>Entregado</span>";
                        $accion1 = "";
                    }
                    if ($unico->entrega == "") {
                        $estado = "PENDIENTE";
                        $estado_estilo = "<span class='badge badge-warning'>Pendiente</span>";
                        $accion2 = "";
                    }
                    if ($unico->entrega == "3") {
                        $estado = "RECHAZADO";
                        $estado_estilo = "<span class='badge badge-danger'>Rechazado</span>";
                        $accion1 = "";
                    }


                    $row = file_get_contents("views/puntos/row_puntos_canjes_entregas.html");
                    $row = str_replace("{ID_CANJE}", utf8_encode($unico->id), $row);
                    $row = str_replace("{NOMBRE_COMPLETO}", utf8_encode($datos_colaborador[0]->nombre_completo), $row);
                    $row = str_replace("{CARGO}", utf8_encode($unico->rut), $row);
                    $row = str_replace("{PREMIO}", utf8_encode($unico->premio), $row);
                    $row = str_replace("{DIMENSION}", utf8_encode($unico->dimension), $row);
                    $row = str_replace("{PUNTOS}", utf8_encode($unico->puntos), $row);
                    $row = str_replace("{DETALLES_PREMIO}", utf8_encode($unico->dimension), $row);
                    $row = str_replace("{NOMBRE_JEFATURA}", utf8_encode($datos_jefe[0]->nombre_completo), $row);
                    $row = str_replace("{CARGO_JEFATURA}", utf8_encode($datos_jefe[0]->cargo), $row);
                    $row = str_replace("{FECHA}", utf8_encode($unico->fecha), $row);
                    $row = str_replace("{DESPACHO}", utf8_encode($unico->despacho), $row);
                    $row = str_replace("{FECHA_DESPACHO}", utf8_encode($unico->fecha_despacho), $row);
                    $row = str_replace("{FECHA_ENTREGA}", utf8_encode($unico->fecha_entrega), $row);
                    $row = str_replace("{ESTADO_ENTREGA}", utf8_encode($estado_estilo), $row);
                    $row = str_replace("{BOTON_ACCION1}", utf8_encode($accion1), $row);
                    $row = str_replace("{BOTON_ACCION2}", utf8_encode($accion2), $row);
                    $total_html .= $row;
                }
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Lista de Entregas CAP", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_puntos_canjes_entregas_cdr($html, $id_empresa, $idcategoria)
            {
                $lista_puntos_stock_fe = lista_puntos_canjes_entregas_data_cdr($id_empresa);
                //print_r($lista_puntos_stock_fe);    //$categorias_options=mp_busca_Categorias($id_empresa);    //print_r($categorias_options);
                foreach ($lista_puntos_stock_fe as $unico) {
                    $datos_colaborador = TraeDatosUsuario($unico->rut);
                    $datos_jefe = TraeDatosUsuario($datos_colaborador[0]->jefe);

                    $accion1 = "<a href='?sw=puntos_canjes_entregas_cdr&idbencanj=" . $unico->id . "&valida=1' class='btn btn-success btn-xs' style='display: inline;'>Entregado</a>";
                    $accion2 = "<a href='?sw=puntos_canjes_entregas_cdr&idbencanj=" . $unico->id . "&valida=3' class='btn btn-danger btn-xs' style='display: inline;'>Deshacer</a>";

                    if ($unico->entrega == "1") {
                        $estado = "ENTREGADO";
                        $estado_estilo = "<span class='badge badge-info'>Entregado</span>";
                        $accion1 = "";
                    }
                    if ($unico->entrega == "") {
                        $estado = "PENDIENTE";
                        $estado_estilo = "<span class='badge badge-warning'>Pendiente</span>";
                        $accion2 = "";
                    }
                    if ($unico->entrega == "3") {
                        $estado = "RECHAZADO";
                        $estado_estilo = "<span class='badge badge-danger'>Rechazado</span>";
                        $accion1 = "";
                    }


                    $row = file_get_contents("views/puntos/row_puntos_canjes_entregas_cdr.html");
                    $row = str_replace("{ID_CANJE}", utf8_encode($unico->id), $row);
                    $row = str_replace("{NOMBRE_COMPLETO}", utf8_encode($datos_colaborador[0]->nombre_completo), $row);
                    $row = str_replace("{CARGO}", utf8_encode($unico->rut), $row);
                    $row = str_replace("{PREMIO}", utf8_encode($unico->premio), $row);
                    $row = str_replace("{DIMENSION}", utf8_encode($unico->dimension), $row);
                    $row = str_replace("{PUNTOS}", utf8_encode($unico->puntos), $row);
                    $row = str_replace("{DETALLES_PREMIO}", utf8_encode($unico->dimension), $row);
                    $row = str_replace("{NOMBRE_JEFATURA}", utf8_encode($datos_jefe[0]->nombre_completo), $row);
                    $row = str_replace("{CARGO_JEFATURA}", utf8_encode($datos_jefe[0]->cargo), $row);
                    $row = str_replace("{FECHA}", utf8_encode($unico->fecha), $row);
                    $row = str_replace("{DESPACHO}", utf8_encode($unico->despacho), $row);
                    $row = str_replace("{FECHA_DESPACHO}", utf8_encode($unico->fecha_despacho), $row);
                    $row = str_replace("{FECHA_ENTREGA}", utf8_encode($unico->fecha_entrega), $row);
                    $row = str_replace("{ESTADO_ENTREGA}", utf8_encode($estado_estilo), $row);
                    $row = str_replace("{BOTON_ACCION1}", utf8_encode($accion1), $row);
                    $row = str_replace("{BOTON_ACCION2}", utf8_encode($accion2), $row);
                    $total_html .= $row;
                }
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Lista de Entregas CDR", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_puntos_canjes_jefe($html, $id_empresa, $idcategoria)
            {
                $lista_puntos_stock_fe = lista_puntos_canjes_jefe_data($id_empresa);
                //print_r($lista_puntos_stock_fe);    //$categorias_options=mp_busca_Categorias($id_empresa);    //print_r($categorias_options);
                //print_r($lista_puntos_stock_fe);
                foreach ($lista_puntos_stock_fe as $unico) {

                    $datos_colaborador = TraeDatosUsuario($unico->rut);
                    $datos_colaborador2 = TraeDatosUsuario($unico->rut_col);

                    $accion2 = "<a href='?sw=puntos_canjes_jefe&idbencanj=" . $unico->id . "&valida=3' class='btn btn-danger btn-xs' style='display: inline;'>Revertir</a>";

                    $row = file_get_contents("views/puntos/row_puntos_canjes_jefe.html");
                    $row = str_replace("{ID_CANJE}", utf8_encode($unico->id), $row);
                    $row = str_replace("{NOMBRE_COMPLETO}", utf8_encode($datos_colaborador[0]->nombre_completo), $row);
                    $row = str_replace("{CARGO}", utf8_encode($unico->rut), $row);
                    $row = str_replace("{PREMIO}", utf8_encode($unico->premio), $row);
                    $row = str_replace("{DIMENSION}", utf8_encode($unico->dimension), $row);
                    $row = str_replace("{PUNTOS}", utf8_encode($unico->puntos), $row);
                    $row = str_replace("{DESCRIPCION}", utf8_encode($unico->descripcion), $row);
                    $row = str_replace("{NOMBRE_JEFATURA}", utf8_encode($datos_colaborador2[0]->nombre_completo), $row);
                    $row = str_replace("{CARGO_JEFATURA}", utf8_encode($datos_colaborador2[0]->cargo), $row);
                    $row = str_replace("{FECHA_CANJE}", utf8_encode($unico->fecha), $row);
                    $row = str_replace("{ESTADO}", utf8_encode($estado_estilo), $row);
                    $row = str_replace("{BOTON_ACCION1}", utf8_encode($accion1), $row);
                    $row = str_replace("{BOTON_ACCION2}", utf8_encode($accion2), $row);
                    $total_html .= $row;
                }
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Entrega de Puntos de Jefaturas", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_notificaciones($html, $id_empresa, $idcategoria)
            {
                $emb_notificaciones = lista_notificaciones_data($id_empresa);
                //print_r($emb_notificaciones);
                //$categorias_options=mp_busca_Categorias($id_empresa);
                //print_r($categorias_options);
                $row = file_get_contents("views/notificaciones/entorno_notificaciones.html");
                foreach ($emb_notificaciones as $unico) {
                    $row = file_get_contents("views/notificaciones/row_notificaciones.html");
                    $row = str_replace("{ID}", utf8_encode($unico->id), $row);
                    $row = str_replace("{ID}", utf8_encode($unico->id), $row);
                    $row = str_replace("{CODIGO}", utf8_encode($unico->codigo), $row);
                    $row = str_replace("{NOMBRE}", utf8_encode($unico->nombre), $row);
                    $row = str_replace("{DESCRIPCION}", utf8_encode($unico->descripcion), $row);
                    $row = str_replace("{TIPOMENSAJE}", utf8_encode($unico->tipomensaje), $row);
                    $row = str_replace("{SUBJECT}", utf8_encode($unico->subject), $row);
                    $row = str_replace("{TITULO1}", utf8_encode($unico->titulo1), $row);
                    $row = str_replace("{SUBTITULO1}", utf8_encode($unico->subtitulo1), $row);
                    $row = str_replace("{TEXTO1}", utf8_encode($unico->texto1), $row);
                    $row = str_replace("{TEXTO2}", utf8_encode($unico->texto2), $row);
                    $row = str_replace("{TEXTO3}", utf8_encode($unico->texto3), $row);
                    $row = str_replace("{TEXTO4}", utf8_encode($unico->texto4), $row);
                    $total_html .= $row;
                }
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Notificaciones", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }


            function lista_notificaciones_a_buscar($html, $id_empresa, $idcategoria)
            {
                $emb_notificaciones = lista_notificaciones_a_buscar_data($id_empresa);
                //print_r($emb_notificaciones);
                //$categorias_options=mp_busca_Categorias($id_empresa);
                //print_r($categorias_options);
                $row = file_get_contents("views/notificaciones/entorno_notificaciones.html");
                foreach ($emb_notificaciones as $unico) {
                    $row = file_get_contents("views/notificaciones/row_notificaciones_pendientes.html");
                    $row = str_replace("{ID}", utf8_encode($unico->id), $row);
                    $row = str_replace("{TIPO_ENVIO}", utf8_encode($unico->tipoenvio), $row);
                    $row = str_replace("{NUM_CUENTA}", utf8_encode($unico->cuenta), $row);
                    $total_html .= $row;
                }
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Notificaciones", $html);
                $html = str_replace("{BTN}", "Notificaciones Pendientes Automáticas", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }


            function Copia_lista_notificaciones_a_buscar_detalle($id_empresa, $tipoenvio)
            {
                $emb_notificaciones = lista_notificaciones_a_buscar_data_detalle($id_empresa, $tipoenvio);

                $count_total_loop = count($emb_notificaciones);
                ini_set('output_buffering', 0);
                ini_set('zlib.output_compression', 0);
                if (!ob_get_level()) {
                    ob_start();
                } else {
                    ob_end_clean();
                    ob_start();
                }


                foreach ($emb_notificaciones as $unico) {

                    $cuenta_loop++;
                    echo "<center><span style='position: absolute;z-index:$current;background:#36C6D3; padding:10px; color:#FFF'>Procesando $cuenta_loop de $count_total_loop Registros</span></center>";
                    flush();
                    ob_flush();

                    $tipoenvio = $unico->tipoenvio;
                    $rut = $unico->rut;
                    $fecha_envio = $unico->fecha_envio;
                    $estado = $unico->estado;
                    $hacia = $unico->hacia;
                    $nombreto = $unico->nombreto;
                    $desde = $unico->desde;
                    $nombrefrom = $unico->nombrefrom;
                    $tipo = $unico->tipo;
                    $asunto = $unico->asunto;
                    $titulo1 = $unico->titulo1;
                    $subtitulo1 = $unico->subtitulo1;
                    $texto1 = $unico->texto1;
                    $url = $unico->url;
                    $texto_url = $unico->texto_url;
                    $texto2 = $unico->texto2;
                    $texto3 = $unico->texto3;
                    $texto4 = $unico->texto4;
                    $logo = $unico->logo;
                    $tipomensaje = $unico->tipomensaje;
                    $clave = $unico->clave;
                    $template = $unico->template;
                    $subject = $unico->asunto;

                    // echo "<br>$tipoenvio,$nombre,$rut,$fecha_envio,$id_empresa,$to,$nombreto,$from,$nombrefrom,$tipo,$subject,$titulo1,$subtitulo1,$texto1,$url,$texto_url,$texto2,    $texto3,$texto4,$logo,$tipomensaje,$key,$template";


                    echo "<br>$tipoenvio, $rut";
                    Notificaciones_crea_not_automaticas($tipoenvio, $tipoenvio, $rut, $fecha_envio, $id_empresa, $hacia, $nombreto, $desde, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $tipomensaje, $rut, $template);

                }


            }

            function lista_eventos($html, $id_empresa, $id_dimension)
            {
                // echo "<br>...........$id_empresa, $id_dimension";
                $eventos = lista_eventos_data($id_empresa, $id_dimension);
                //print_r($emb_tareas);
                //$categorias_options=mp_busca_Categorias($id_empresa);
                //print_r($categorias_options);
                $row = file_get_contents("views/eventos/entorno_eventos.html");
                foreach ($eventos as $unico) {
//print_r($unico);
                    $row = file_get_contents("views/eventos/row_eventos.html");
                    $row = str_replace("{ID}", utf8_encode($unico->id), $row);

                    $html = str_replace("{CATEGORIAS}", $listas_cat, $html);
                    $row = str_replace("{CODIGO}", utf8_encode($unico->codigo), $row);
                    $row = str_replace("{NOMBRE}", utf8_encode($unico->nombre), $row);
                    $row = str_replace("{DESCRIPCION}", utf8_encode($unico->descripcion), $row);
                    $row = str_replace("{ID_CATEGORIA}", utf8_encode($unico->id_categoria), $row);
                    $row = str_replace("{NOMBRE_CATEGORIA}", utf8_encode($unico->NombreCategoria), $row);
                    $row = str_replace("{POSTULABLE}", utf8_encode($unico->postulable), $row);
                    $row = str_replace("{FECHA_INICIO}", utf8_encode($unico->fecha_inicio), $row);
                    $row = str_replace("{FECHA_TERMINO}", utf8_encode($unico->fecha_termino), $row);
                    $row = str_replace("{DIRECCION}", utf8_encode($unico->direccion), $row);
                    $row = str_replace("{INSTRUCCIONES}", utf8_encode($unico->instruccion), $row);
                    $row = str_replace("{HORA_INICIO}", utf8_encode($unico->hora_inicio), $row);
                    $row = str_replace("{HORA_TERMINO}", utf8_encode($unico->hora_termino), $row);

                    if ($unico->invisible == "1") {
                        $visible = "INVISIBLE";
                        $id_visible = "1";
                    }
                    if ($unico->invisible == "0") {
                        $visible = "VISIBLE";
                        $id_visible = "0";
                    }

                    $row = str_replace("{ID_VISIBLE}", utf8_encode($id_visible), $row);
                    $row = str_replace("{VISIBLE}", utf8_encode($visible), $row);


                    $row = str_replace("{HORA_TERMINO}", utf8_encode($unico->hora_termino), $row);

                    $listas_cat = "";
                    $emb_categoria = lista_eventos_categorias_data_solo($id_empresa, $id_dimension);
                    foreach ($emb_categoria as $emb_cat) {
                        $listas_cat .= "<option value='" . $emb_cat->id_categoria . "'>" . utf8_encode($emb_cat->nombre) . " (" . $emb_cat->id_categoria . ")</option>";
                    }
                    $row = str_replace("{OPTIONS_CATEGORIA}", $listas_cat, $row);
                    $row = str_replace("{REGION}", utf8_encode($unico->region), $row);
                    $row = str_replace("{LINK}", utf8_encode($unico->link_acceso), $row);
                    $total_html .= $row;
                }
                $listas_cat = "";
                $emb_categoria = lista_eventos_categorias_data_solo($id_empresa, $id_dimension);
                foreach ($emb_categoria as $emb_cat) {
                    $listas_cat .= "<option value='" . $emb_cat->id_categoria . "'>" . ($emb_cat->nombre) . " (" . $emb_cat->id_categoria . ")</option>";
                }

                $html = str_replace("{OPTIONS_CATEGORIA_EVENTO}", utf8_encode($listas_cat), $html);
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Eventos", $html);
                $html = str_replace("{ID_DIMENSION}", $id_dimension, $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }


            function lista_empresas_ext($html, $id_empresa, $id_dimension)
            {


                $empresas = lista_empresas_ext_data($id_empresa, $id_dimension);
                $row = file_get_contents("views/ext_empresas/entorno_ext_empresas.html");

                foreach ($empresas as $unico) {                    //print_r($unico);
                    $row = file_get_contents("views/ext_empresas/row_ext_empresas.html");
                    $row = str_replace("{ID}", utf8_encode($unico->id), $row);

                    $html = str_replace("{CATEGORIAS}", $listas_cat, $html);
                    $row = str_replace("{NOMBRE}", utf8_encode($unico->nombre), $row);
                    $row = str_replace("{DESCRIPCION}", utf8_encode($unico->descripcion), $row);


                    $row = str_replace("{RUT}", utf8_encode($unico->rut), $row);
                    $row = str_replace("{DOMINIO}", utf8_encode($unico->dominio), $row);
                    $row = str_replace("{TIPO_MALLA}", utf8_encode($unico->malla), $row);
                    $row = str_replace("{EJECUTIVO}", utf8_encode($unico->ejecutivo), $row);


                    $listas_cat = "";
                    $emb_categoria = lista_eventos_categorias_data_solo($id_empresa, $id_dimension);
                    foreach ($emb_categoria as $emb_cat) {
                        $listas_cat .= "<option value='" . $emb_cat->id_categoria . "'>" . utf8_encode($emb_cat->nombre) . " (" . $emb_cat->id_categoria . ")</option>";
                    }

                    $row = str_replace("{OPTIONS_CATEGORIA}", $listas_cat, $row);
                    $row = str_replace("{REGION}", utf8_encode($unico->region), $row);
                    $row = str_replace("{LINK}", utf8_encode($unico->link_acceso), $row);


                    $divisiones = lista_empresas_ext_divisiones_data($unico->rut, $id_empresa, $id_dimension);

                    //            echo "<pre>";            print_r($divisiones);

                    $row2 = "";
                    foreach ($divisiones as $divuni) {
                        $row2 .= file_get_contents("views/ext_empresas/row_ext_empresas_division.html");
                        $row2 = str_replace("{CODIGO}", utf8_encode($divuni->codigo), $row2);
                        $row2 = str_replace("{DIVISION}", utf8_encode($divuni->nombredivision), $row2);
                        $row2 = str_replace("{SINDICATO}", utf8_encode($divuni->nombresindicato), $row2);
                        $row2 = str_replace("{RUT}", utf8_encode($unico->rut), $row2);

                    }

                    $row = str_replace("{LISTA_SINDICATOS_DIVISIONES}", $row2, $row);


                    $total_html .= $row;
                }
                $listas_cat = "";
                $emb_categoria = lista_eventos_categorias_data_solo($id_empresa, $id_dimension);
                foreach ($emb_categoria as $emb_cat) {
                    $listas_cat .= "<option value='" . $emb_cat->id_categoria . "'>" . ($emb_cat->nombre) . " (" . $emb_cat->id_categoria . ")</option>";
                }

                $html = str_replace("{OPTIONS_CATEGORIA_EVENTO}", utf8_encode($listas_cat), $html);
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Gestión de Empresas", $html);
                $html = str_replace("{ID_DIMENSION}", $id_dimension, $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_emb_tareas($html, $id_empresa, $idcategoria)
            {
                $emb_tareas = lista_emb_tareas_data($id_empresa);
                //print_r($emb_tareas);
                //$categorias_options=mp_busca_Categorias($id_empresa);
                //print_r($categorias_options);
                $row = file_get_contents("views/embajadores/entorno_emb_tareas.html");
                foreach ($emb_tareas as $unico) {
                    $row = file_get_contents("views/embajadores/row_emb_tareas.html");
                    $row = str_replace("{ID}", utf8_encode($unico->id), $row);
                    $emb_olas = lista_emb_olas_data_solo($id_empresa);
                    foreach ($emb_olas as $emb_ola) {
                        $listas_olas .= "<option value='" . $emb_ola->codigo . "'>" . utf8_encode($emb_ola->nombre) . " (" . $emb_ola->codigo . ")</option>";
                    }
                    $html = str_replace("{EMB_OLAS}", $listas_olas, $html);
                    $row = str_replace("{CODIGO}", utf8_encode($unico->codigo), $row);
                    $row = str_replace("{ID_GRUPO_INTERES}", utf8_encode($unico->id_grupo_interes), $row);
                    $row = str_replace("{NOMBRE}", utf8_encode($unico->nombre), $row);
                    $row = str_replace("{DESCRIPCION}", utf8_encode($unico->descripcion), $row);
                    $row = str_replace("{DURACION}", utf8_encode($unico->duracion), $row);
                    $row = str_replace("{FECHA_TERMINO}", utf8_encode($unico->fecha_termino), $row);
                    $row = str_replace("{LINK_MATERIAL}", utf8_encode($unico->link_material), $row);
                    $row = str_replace("{LINK_MATERIAL2}", utf8_encode($unico->link_material2), $row);
                    $row = str_replace("{LINK_MATERIAL3}", utf8_encode($unico->link_material3), $row);

                    $row = str_replace("{PREGUNTA1}", utf8_encode($unico->pregunta1), $row);
                    $row = str_replace("{PREGUNTA2}", utf8_encode($unico->pregunta2), $row);
                    $row = str_replace("{PREGUNTA3}", utf8_encode($unico->pregunta3), $row);


                    $row = str_replace("{ACCION}", utf8_encode($unico->accion), $row);
                    $row = str_replace("{DESCRIPCION_ACCION}", utf8_encode($unico->descripcion_accion), $row);
                    $row = str_replace("{LINK_ARCHIVO_TRABAJO}", utf8_encode($unico->link_archivo_trabajo), $row);
                    $row = str_replace("{INSTRUCCION_TUTOR}", utf8_encode($unico->instruccion_tutor), $row);
                    $row = str_replace("{LINK_TUTOR}", utf8_encode($unico->link_tutor), $row);
                    $total_html .= $row;
                }
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Tareas", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_emb_dashboard($html, $id_empresa, $id_ola, $fecha_inicio, $fecha_termino)
            {
                //echo "$id_empresa, $id_ola";
                $array_olas = Com_Busca_olas($id_empresa);
                foreach ($array_olas as $ola) {
                    $option_olas .= "<option value='" . $ola->codigo . "'>" . utf8_encode($ola->nombre) . "</option>";
                }

                $hoy = date("Y-m-d");

                //echo "$fecha_inicio, $fecha_termino";

                $fecha_inicio = str_replace('/', '-', $fecha_inicio);
                $fecha_termino = str_replace('/', '-', $fecha_termino);
                $fecha_inicio = date("Y-m-d", strtotime($fecha_inicio));
                $fecha_termino = date("Y-m-d", strtotime($fecha_termino));

                //echo "$fecha_inicio, $fecha_termino";


                if ($fecha_inicio == "1969-12-31") {
                    $fecha_inicio = "";
                }
                if ($fecha_termino == "1969-12-31") {
                    $fecha_termino = "";
                }

                if ($fecha_inicio == "") {
                    $fecha_inicio = "2017-05-01";
                }
                if ($fecha_termino == "") {
                    $fecha_termino = $hoy;
                }


                $fecha_inicio_txt = date("d-m-Y", strtotime($fecha_inicio));
                $fecha_termino_txt = date("d-m-Y", strtotime($fecha_termino));

                $rango_fechas = "";
                //Resultados desde el $fecha_inicio_txt al  $fecha_termino_txt
                $array_visitantes = Com_BuscaVisitas_Total($id_empresa, $id_ola, $fecha_inicio, $fecha_termino);
                $porcentaje_usuarios = round(100 * $array_visitantes[0]->CuentaComparte / $array_visitantes[0]->CuentaBci);
                $array_publicaciones = Com_BuscaPublicaciones_Total($id_empresa, $id_ola, $fecha_inicio, $fecha_termino);
                $array_tagueados = Com_BuscaTagueados_Total($id_empresa, $id_ola, $fecha_inicio, $fecha_termino);
                $array_comentarios = Com_BuscaComentarios_Total($id_empresa, $id_ola, $fecha_inicio, $fecha_termino);

                $html = str_replace("{FILTRO_FECHAS}", $rango_fechas, $html);


                $html = str_replace("{LISTA_FORM_OLAS}", $option_olas, $html);
                $html = str_replace("{VISITANTES}", $array_visitantes[0]->CuentaComparte, $html);
                $html = str_replace("{PORCENTAJE_DE_EMPRESA}", $porcentaje_usuarios, $html);
                $html = str_replace("{PUBLICACIONES}", $array_publicaciones[0]->CuentaPost, $html);
                $html = str_replace("{PUBLICACIONES_AUTORES}", $array_publicaciones[0]->Autores, $html);
                $html = str_replace("{TAGUEADOS}", $array_tagueados[0]->CuentaTagueos, $html);
                $html = str_replace("{TAGUEADOS_AUTORES}", $array_tagueados[0]->Autores, $html);
                $html = str_replace("{COMENTARIOS}", $array_comentarios[0]->CuentaComentarios, $html);
                $html = str_replace("{COMENTARIOS_AUTORES}", $array_comentarios[0]->Autores, $html);

                // echo "<br>fechas  $fecha_inicio, $fecha_termino<br>";

                $array_visitas = Com_Busca_Estadisticas_Visitas($fecha_inicio, $fecha_termino, $id_ola, $id_empresa);
                //echo "<pre>";    print_r($array_visitas);
                $ultima_fecha = $fecha_inicio;
                $i = 0;
                foreach ($array_visitas as $unico) {
                    // echo "<br>-.--i $i -". $unico->fecha;
                    if ($unico->fecha == $ultima_fecha) {
                        $arrat_data[$i] .= "" . $unico->data . ",";
                        $arrat_date[$i] = $unico->fecha;
                    }
                    if ($unico->fecha <> $ultima_fecha) {
                        $i++;
                        $arrat_data[$i] .= "" . $unico->data . ",";
                        $arrat_date[$i] = $unico->fecha;
                    }
                    // echo "<br> arreglo ". $arrat_date[$i];

                    // echo "<br>-.--i $i -". $unico->fecha;

                    $ultima_fecha = $unico->fecha;
                }
                // echo "<br>";echo "<br>";    echo "<pre>";    print_r($arrat_date);


                for ($k = 0; $k <= $i; $k++) {
                    $arra_visitas_series .= "['" . $arrat_date[$k] . "', " . $arrat_data[$k] . "],";
                }
                //    echo "<br>".$arra_visitas_series;    //echo $arra_visitas_series;
                $html = str_replace("{ARRAY_VISITA_SERIES}", $arra_visitas_series, $html);


                $array_interacciones = Com_Busca_Estadisticas_Interacciones($fecha_inicio, $fecha_termino, $id_ola, $id_empresa);
                /* echo "<pre>";    print_r($array_visitas); */
                $ultima_fecha = $fecha_inicio;
                $i = 0;
                foreach ($array_interacciones as $unico) {
                    $arratp_date[$i] = $unico->fecha;
                    if ($unico->fecha == $ultima_fecha) {
                        $arratp_data[$i] .= "" . $unico->data . ",";
                    }
                    if ($unico->fecha <> $ultima_fecha) {
                        $i++;
                        $arratp_data[$i] .= "" . $unico->data . ",";
                    }
                    $ultima_fecha = $unico->fecha;
                }
                /* echo "<br>";    echo "<pre>";    print_r($arrat_data);    echo "<br>";    echo "<pre>";    print_r($arrat_date); */


                for ($k = 0; $k <= $i; $k++) {
                    $arra_pub_series .= "['" . $arratp_date[$k] . "', " . $arratp_data[$k] . "],";
                }
                //echo "<br>";    //echo $arra_visitas_series;
                $html = str_replace("{ARRAY_PUBLICACIONES_SERIES}", $arra_pub_series, $html);

                $html = str_replace("{BTN_VOLVER}", "", $html);
                $html = str_replace("{TITULO}", "DashBoard Comunidad", $html);
                return ($html);
            }

            function lista_admin_dashboard($html, $id_empresa, $filtro, $fecha_inicio, $fecha_termino)
            {
                //echo "$id_empresa, $id_ola";


                $hoy = date("Y-m-d");

                //echo "$fecha_inicio, $fecha_termino";

                $fecha_inicio = str_replace('/', '-', $fecha_inicio);
                $fecha_termino = str_replace('/', '-', $fecha_termino);
                $fecha_inicio = date("Y-m-d", strtotime($fecha_inicio));
                $fecha_termino = date("Y-m-d", strtotime($fecha_termino));

                //echo "$fecha_inicio, $fecha_termino";


                if ($fecha_inicio == "1969-12-31") {
                    $fecha_inicio = "";
                }
                if ($fecha_termino == "1969-12-31") {
                    $fecha_termino = "";
                }

                if ($fecha_inicio == "") {
                    $fecha_inicio = "2018-01-01";
                }
                if ($fecha_termino == "") {
                    $fecha_termino = $hoy;
                }


                $fecha_inicio_txt = date("d-m-Y", strtotime($fecha_inicio));
                $fecha_termino_txt = date("d-m-Y", strtotime($fecha_termino));

                $admin_Data = Dashboard_admin_data($id_empresa);
                //print_r($admin_Data);

                $html = str_replace("{INSCRITOS}", $admin_Data[0], $html);
                $html = str_replace("{VISITAS}", $admin_Data[1], $html);
                $html = str_replace("{PORCENTAJE_VISITAS}", round(100 * $admin_Data[1] / $admin_Data[0]) . "%", $html);
                $html = str_replace("{TOTAL_VISITAS}", $admin_Data[2], $html);

                $html = str_replace("{VIDEO01}", $admin_Data[8], $html);
                $html = str_replace("{VIDEO02}", $admin_Data[9], $html);
                $html = str_replace("{VIDEO03}", $admin_Data[10], $html);
                $html = str_replace("{VIDEO04}", $admin_Data[11], $html);
                $html = str_replace("{VIDEO05}", $admin_Data[12], $html);
                $html = str_replace("{VIDEO06}", $admin_Data[13], $html);


                $html = str_replace("{AGRADECIMIENTOS}", $admin_Data[4], $html);
                $html = str_replace("{RECO_SELECCIONCHILE}", $admin_Data[5], $html);
                $html = str_replace("{RECO_COLABORACION}", $admin_Data[6], $html);
                $html = str_replace("{PUNTOS_ENTREGADOS}", $admin_Data[7], $html);

                $html = str_replace("{FC_CURSOS_PRESENCIALES}", $admin_Data[21], $html);
                $html = str_replace("{FC_CURSOS_MARCAPROPIA}", $admin_Data[22], $html);
                $html = str_replace("{FC_CURSOS_PRESENCIALES_INSCRITOS}", $admin_Data[23], $html);
                $html = str_replace("{FC_CURSOS_MARCAPROPIA_INSCRITOS}", $admin_Data[24], $html);

                $html = str_replace("{LMS_CURSOS_ELEARNING}", $admin_Data[25], $html);
                $html = str_replace("{LMS_CURSOS_ELEARNING_INSCRITOS}", $admin_Data[26], $html);
                $html = str_replace("{LMS_CURSOS_ELEARNING_FINALIZADOS}", $admin_Data[27], $html);
                $html = str_replace("{LMS_CURSOS_ELEARNING_NO_FINALIZADOS}", $admin_Data[29], $html);

                $nps = round(100 * $admin_Data[32] / $admin_Data[31]) - round(100 * $admin_Data[33] / $admin_Data[31]);

                $html = str_replace("{NPS_ENCUESTA}", $nps, $html);
                $html = str_replace("{NPS_RESPUESTAS}", $admin_Data[31], $html);
                $html = str_replace("{POLO_POSITIVO}", $admin_Data[32], $html);
                $html = str_replace("{POLO_NEGATIVO}", $admin_Data[33], $html);
                $promedio_encuesta = round($admin_Data[34], 2);
                $html = str_replace("{PROMEDIO_ENCUESTA}", $promedio_encuesta, $html);
                $html = str_replace("{ARRAY_PUBLICACIONES_SERIES}", $arra_pub_series, $html);
                $html = str_replace("{FILTRO_FECHAS}", "", $html);

                $html = str_replace("{BTN_VOLVER}", "", $html);
                $html = str_replace("{TITULO}", "DashBoard Comunidad", $html);
                return ($html);
            }

            function lista_emb_olas($html, $id_empresa, $idcategoria)
            {
                $emb_olas = lista_emb_olas_data($id_empresa);
                $row = file_get_contents("views/embajadores/entorno_emb_olas.html");
                foreach ($emb_olas as $unico) {
                    $row = file_get_contents("views/embajadores/row_emb_olas.html");
                    $row = str_replace("{ID}", utf8_encode($unico->id), $row);
                    $row = str_replace("{CODIGO}", utf8_encode($unico->codigo), $row);
                    $row = str_replace("{NOMBRE}", utf8_encode($unico->nombre), $row);
                    $row = str_replace("{DESCRIPCION}", utf8_encode($unico->descripcion), $row);
                    $row = str_replace("{INSCRITOS}", utf8_encode($unico->Inscritos), $row);
                    $row = str_replace("{INGRESOS}", utf8_encode($unico->Ingresos), $row);

                    $id_codigo_enc = Encodear3($unico->codigo);
                    if ($id_empresa == "62") {
                        $link_directo = "https://compartebci.cl/front/?sw=login_ext&ambiente=com_mp_personal&sess=" . $id_codigo_enc;
                    }

                    $row = str_replace("{URL_LINK_DIRECTO}", utf8_encode($link_directo), $row);


                    $total_html .= $row;
                }
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Grupos Cerrados", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_stories_360($html, $id_empresa, $idcategoria)
            {
                $id_empresa = $_SESSION["id_empresa"];
                $stories = lista_stories_360_data($id_empresa);
                $row = file_get_contents("views/mejores_practicas/entorno_stories_360.html");
                foreach ($stories as $unico) {
                    $row = file_get_contents("views/mejores_practicas/row_stories_360.html");
                    $row = str_replace("{ID}", utf8_encode($unico->id), $row);
                    $row = str_replace("{RUT}", utf8_encode($unico->rut), $row);
                    $row = str_replace("{ID_ST}", utf8_encode($unico->id_st), $row);
                    $row = str_replace("{NOMBRE_COMPLETO}", utf8_encode($unico->nombre_completo), $row);
                    $row = str_replace("{FECHA}", utf8_encode($unico->fecha), $row);
                    $row = str_replace("{HORA}", utf8_encode($unico->hora), $row);
                    $row = str_replace("{VIDEO}", utf8_encode($unico->video), $row);
                    $row = str_replace("{IMAGEN}", utf8_encode($unico->imagen), $row);
                    $total_html .= $row;
                }
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Videos 360", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_stories_twit($html, $id_empresa, $idcategoria)
            {
                $stories = lista_stories_twit_data($id_empresa);
                $row = file_get_contents("views/mejores_practicas/entorno_stories_twit.html");
                foreach ($stories as $unico) {
                    $row = file_get_contents("views/mejores_practicas/row_stories_twit.html");
                    $row = str_replace("{ID}", utf8_encode($unico->id), $row);
                    $row = str_replace("{RUT}", utf8_encode($unico->rut), $row);
                    $row = str_replace("{ID_ST}", utf8_encode($unico->id_st), $row);
                    $row = str_replace("{NOMBRE_COMPLETO}", utf8_encode($unico->nombre_completo), $row);
                    $row = str_replace("{FECHA}", utf8_encode($unico->fecha), $row);
                    $row = str_replace("{HORA}", utf8_encode($unico->hora), $row);
                    $row = str_replace("{CONTENIDO}", utf8_encode($unico->stories), $row);
                    $row = str_replace("{IMAGEN}", utf8_encode($unico->imagen), $row);
                    $total_html .= $row;
                }
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Twits", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_becas($html, $id_empresa, $idcategoria)
            {
                $emb_olas = lista_becas_data($id_empresa);
                foreach ($emb_olas as $unico) {
                    $row = file_get_contents("views/becas/row_becas.html");

                    //echo "<br>nombre beca ".$unico->nombre_beca;


                    if ($unico->tipo_beca == "beca_pre_2022_1") {
                        $nombreBeca = "Beca Pregrado 2021";
                    }
                    if ($unico->tipo_beca == "beca_post_2022_1") {
                        $nombreBeca = "Beca Postgrado 2021";
                    }
                    if ($unico->tipo_beca == "beca_post_ext_2022_1") {
                        $nombreBeca = "Beca Postgrado Extranjero 2021";
                    }


                    if ($unico->tipo_beca == "beca_pre_2021_2") {
                        $nombreBeca = "Beca Pregrado 2021 S2";
                    }
                    if ($unico->tipo_beca == "beca_post_2021_2") {
                        $nombreBeca = "Beca Postgrado 2021 S2";
                    }
                    if ($unico->tipo_beca == "beca_post_ext_2021_2") {
                        $nombreBeca = "Beca Postgrado Extranjero 2021 S2";
                    }


                    if ($unico->tipo_beca == "beca_pre_2021_1") {
                        $nombreBeca = "Beca Pregrado 2021 S1";
                    }
                    if ($unico->tipo_beca == "beca_post_2021_1") {
                        $nombreBeca = "Beca Postgrado 2021 S1";
                    }


                    if ($unico->tipo_beca == "beca_post_2020") {
                        $nombreBeca = "Beca Postgrado 2020";
                    }
                    if ($unico->tipo_beca == "beca_pre_2020") {
                        $nombreBeca = "Beca Pregrado 2020";
                    }
                    if ($unico->tipo_beca == "bch_prg") {
                        $nombreBeca = "Beca Pregrado 2018";
                    }
                    if ($unico->tipo_beca == "beca_post_2019") {
                        $nombreBeca = "Beca Postgrado 2019";
                    }
                    if ($unico->tipo_beca == "beca_pre_2019") {
                        $nombreBeca = "Beca Pregrado 2019";
                    }


                    $row = str_replace("{ID}", utf8_encode($unico->tipo_beca), $row);
                    $row = str_replace("{NOMBRE}", utf8_encode($nombreBeca), $row);
                    $row = str_replace("{POSTULANTES}", utf8_encode($unico->postulantes), $row);
                    $row = str_replace("{DOCUMENTACION_OK}", utf8_encode($unico->documentacion_ok), $row);
                    $row = str_replace("{VALIDACION_JEFE_1}", utf8_encode($unico->validacionjefe_1), $row);
                    $row = str_replace("{VALIDACION_JEFE_2}", utf8_encode($unico->validacionjefe_2), $row);
                    $total_html .= $row;
                }
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Becas", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_innovacion($html, $id_empresa, $idcategoria, $proceso)
            {
                $id_empresa = $_SESSION["id_empresa"];
                $lista = lista_innovacion_data($proceso, $id_empresa);
                //print_r($lista);
                foreach ($lista as $unico) {
                    $usu = TraeDatosUsuario($unico->rut);

                    $autor = $usu[0]->nombre_completo . "<br>" . $usu[0]->cargo . " " . $usu[0]->division;
                    //echo "autor $autor";
                    $row = file_get_contents("views/innovacion/row_innovacion.html");
                    $row = str_replace("{ID}", utf8_encode($unico->id), $row);
                    $row = str_replace("{NOMBRE}", utf8_encode($unico->titulo), $row);
                    $row = str_replace("{RETO}", utf8_encode($unico->id_categoria), $row);
                    $row = str_replace("{FECHA}", utf8_encode($unico->fecha), $row);
                    $row = str_replace("{HORA}", utf8_encode($unico->hora), $row);
                    $row = str_replace("{AUTOR}", utf8_encode($autor), $row);
                    $row = str_replace("{ESTADO}", utf8_encode($unico->estado), $row);

                    if ($unico->estado == "Recepcionada") {
                        $class_estado = "1";
                    }
                    if ($unico->estado == "Preseleccionada") {
                        $class_estado = "warning";
                    }
                    if ($unico->estado == "NO_Preseleccionada") {
                        $class_estado = "danger";
                    }
                    if ($unico->estado == "Seleccionada") {
                        $class_estado = "info";
                    }
                    if ($unico->estado == "Publica") {
                        $class_estado = "success";
                    }

                    if ($unico->estado == "Recepcionada") {
                        $boton_preseleccionado = "<center><a href='?sw=innova_ideas_lista&id=" . $unico->id . "&ac=1' class='btn btn-success'>Preseleccionar</a> <a href='?sw=innova_ideas_lista&id=" . $unico->id . "&ac=2' class='btn btn-danger'>No</a> </center>";
                    }
                    if ($unico->estado == "NO_Preseleccionada") {
                        $boton_preseleccionado = "";
                    }
                    if ($unico->estado == "Preseleccionada") {
                        $boton_preseleccionado = "";
                    }

                    //echo "<br>estado <br>".$unico->estado."<br>clase_estado $class_estado";
                    $row = str_replace("{CLASS_ESTADO}", ($class_estado), $row);

                    $row = str_replace("{BOTON_PRESELECCIONAR}", $boton_preseleccionado, $row);

                    $array_res = InnovaBuscaEvaluacion($proceso, $unico->id, $id_empresa);
                    $resultado_ponderado = $array_res[0]->avg_resultado;
                    if ($resultado_ponderado > 0) {
                        $resultado_txt = number_format($resultado_ponderado, 2, ',', ' ');
                    } else {
                        $resultado_txt = "";
                    }
                    if ($resultado_txt <> "") {
                        $total_jueces = "" . $array_res[0]->cuenta . " de " . $array_res[0]->total_jueces;
                    } else {
                        $total_jueces = "";
                    }

                    $array_res_g = InnovaBuscaEvaluacionGerente($proceso, $unico->id, $id_empresa);
                    $resultado_ponderado_g = $array_res_g[0]->avg_resultado;
                    if ($resultado_ponderado_g > 0) {
                        $resultado_g_txt = number_format($resultado_ponderado_g, 2, ',', ' ');
                    } else {
                        $resultado_g_txt = "";
                    }
                    if ($resultado_g_txt <> "") {
                        $total_gerentes = "" . $array_res_g[0]->cuenta . " de " . $array_res_g[0]->total_jueces;
                    } else {
                        $total_gerentes = "";
                    }

                    $row = str_replace("{RESULTADO_JUEZ}", $resultado_txt . "  <br><small>" . $total_jueces . "  </small>", $row);
                    $row = str_replace("{RESULTADO_GERENTE}", $resultado_g_txt . "<br><small>" . $total_gerentes . "</small>", $row);


                    if ($unico->suma_votos > 0) {
                        $votos = $unico->suma_votos;
                    } else {
                        $votos = 0;
                    }
                    $row = str_replace("{VOTOS}", $votos, $row);
                    $total_html .= $row;
                }

                $html = str_replace("{PROCESO}", $proceso, $html);


                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "IDEAS PORTAL INNOVAVISTA ADMINISTRADOR", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }


            function lista_innovacion_jueces($html, $id_empresa, $idcategoria, $proceso)
            {

                $lista = lista_jueces_data($id_empresa, $proceso);
                foreach ($lista as $unico) {
                    $usu = TraeDatosUsuario($unico->rut);
                    $creador = $usu[0]->nombre_completo . "<br>" . $usu[0]->cargo . " " . $usu[0]->division;
                    $row = file_get_contents("views/innovacion/row_jueces.html");


                    $num_evaluadas = $unico->evaluadas;
                    $num_total = $unico->totalideas;

                    $porcentaje = round(100 * $num_evaluadas / $num_total);
                    $porcentaje = $porcentaje . "%";

                    $row = str_replace("{RUT}", utf8_encode($unico->rut), $row);
                    $row = str_replace("{CREADOR}", utf8_encode($creador), $row);
                    $row = str_replace("{NUM_EVALUACIONES}", ($num_evaluadas), $row);
                    $row = str_replace("{PORCENTAJE_EVALUACIONES}", ($porcentaje), $row);

                    $row = str_replace("{RUTCOL}", Encodear3($unico->rut), $row);
                    $total_html .= $row;
                }

                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "JUECES PORTAL INNOVA VISTA ADMINISTRADOR", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }


            function lista_innovacion_jueces_gerentes($html, $id_empresa, $idcategoria, $proceso)
            {
                $lista = lista_jueces_gerentes_data($id_empresa, $proceso);
                foreach ($lista as $unico) {
                    $usu = TraeDatosUsuario($unico->rut);
                    $creador = $usu[0]->nombre_completo . "<br>" . $usu[0]->cargo . " " . $usu[0]->division;
                    $row = file_get_contents("views/innovacion/row_jueces_gerentes.html");

                    $num_evaluadas = $unico->evaluadas;
                    $num_total = $unico->totalideas;

                    $porcentaje = round(100 * $num_evaluadas / $num_total);
                    $porcentaje = $porcentaje . "%";
                    $row = str_replace("{RUT}", utf8_encode($unico->rut), $row);
                    $row = str_replace("{CREADOR}", utf8_encode($creador), $row);
                    $row = str_replace("{NUM_EVALUACIONES}", ($num_evaluadas), $row);
                    $row = str_replace("{PORCENTAJE_EVALUACIONES}", ($porcentaje), $row);
                    $row = str_replace("{RUTCOL}", Encodear3($unico->rut), $row);
                    $total_html .= $row;
                }

                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "JUECES  GERENTES PORTAL INNOVA VISTA ADMINISTRADOR", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }


            function lista_beneficios($html, $id_empresa, $idcategoria)
            {
                $form1 = lista_beneficios_data_form($id_empresa, "id_form1");
                //print_r($form1);
                //exit();
                foreach ($form1 as $unico) {

                    $row = file_get_contents("views/beneficios/row_beneficios.html");
                    $tipo = "";
                    if ($unico->validacionjefe == "SI") {
                        $tipo = "REQUIERE VALIDACION JEFE";
                    }
                    //echo "<br>tipo $tipo tipo valida ".$unico->validacionjefe;
                    $no_vistos = $unico->solicitudes - $unico->visto;
                    //echo "no visto $no_vistos.";

                    if ($no_vistos > 0) {
                        if ($no_vistos == 1) {
                            $nuevo = "<span class='badge badge-warning'>" . $no_vistos . " nuevo</span>";
                        } else {
                            $nuevo = "<span class='badge badge-warning'>" . $no_vistos . " nuevos</span>";
                        }
                    } else {
                        $nuevo = "";
                    }


                    $num_cerrados = 0;
                    $num_proceso = 0;
                    $num_pendientes = 0;
                    //por cada beneficio, hago una barrido por cada solicitudes-$unico-
                    $array_solicitudes = Beneficios_BarridoSolicitudes($unico->id_beneficios, $id_empresa);
                    foreach ($array_solicitudes as $unico_sol) {
                        $val = Beneficios_Busca_Estado_Solo_Data($unico_sol->id, $unico->tipo_workflow);
                        if ($val == "Pendiente") {
                            $num_pendientes++;
                        }
                        if ($val == "En Proceso") {
                            $num_proceso++;
                        }
                        if ($val == "Cerrado") {
                            $num_cerrados++;
                        }


                    }


                    $row = str_replace("{ID}", utf8_encode($unico->id_beneficios), $row);
                    $row = str_replace("{TIPO}", utf8_encode($unico->nombre_tipo_workflow), $row);
                    $row = str_replace("{NOMBRE}", utf8_encode($unico->nombre), $row);
                    $row = str_replace("{SOLICITUDES}", utf8_encode($unico->solicitudes), $row);
                    $row = str_replace("{APROBADOS", utf8_encode($unico->validacion1), $row);

                    $row = str_replace("{PENDIENTES}", $num_pendientes, $row);
                    $row = str_replace("{EN_PROCESO}", $num_proceso, $row);
                    $row = str_replace("{CERRADAS}", $num_cerrados, $row);

                    $row = str_replace("{PENDIENTE}", utf8_encode($unico->validacion2), $row);
                    $row = str_replace("{RECHAZADOS_MODIFICACION}", utf8_encode($unico->validacion3), $row);
                    $row = str_replace("{RECHAZADOS}", utf8_encode($unico->validacion4), $row);
                    $row = str_replace("{ID_FORM}", utf8_encode($unico->id_form1), $row);


                    $row = str_replace("{NUEVO}", utf8_encode($nuevo), $row);


                    $row = str_replace("{ACCIONJEFE}", utf8_encode($unico->validacionjefeaccion), $row);
                    $row = str_replace("{PENDIENTESJEFE}", utf8_encode($pendientes_jefe), $row);
                    $row = str_replace("{ACCIONADMIN}", utf8_encode($unico->validacionadmin), $row);
                    $row = str_replace("{PENDIENTESADMIN}", utf8_encode($pendientes_admin), $row);

                    $total_html .= $row;
                }

                $form2 = lista_beneficios_data_form($id_empresa, "id_form2");
                //print_r($form1);
                foreach ($form2 as $unico) {

                    $row = file_get_contents("views/beneficios/row_beneficios.html");
                    $tipo = "";
                    if ($unico->validacionjefe == "SI") {
                        $tipo = "REQUIERE VALIDACION JEFE";
                    }
                    //echo "<br>tipo $tipo tipo valida ".$unico->validacionjefe;
                    $no_vistos = $unico->solicitudes - $unico->visto;
                    //echo "no visto $no_vistos.";

                    if ($no_vistos > 0) {
                        if ($no_vistos == 1) {
                            $nuevo = "<span class='badge badge-danger'>" . $no_vistos . " nuevo</span>";
                        } else {
                            $nuevo = "<span class='badge badge-danger'>" . $no_vistos . " nuevos</span>";
                        }
                    } else {
                        $nuevo = "";
                    }


                    $num_cerrados = 0;
                    $num_proceso = 0;
                    $num_pendientes = 0;
                    //por cada beneficio, hago una barrido por cada solicitudes-$unico-
                    $array_solicitudes = Beneficios_BarridoSolicitudes($unico->id_beneficios, $id_empresa);
                    foreach ($array_solicitudes as $unico_sol) {
                        $val = Beneficios_Busca_Estado_Solo_Data($unico_sol->id, $unico->tipo_workflow);
                        if ($val == "Pendiente") {
                            $num_pendientes++;
                        }
                        if ($val == "En Proceso") {
                            $num_proceso++;
                        }
                        if ($val == "Cerrado") {
                            $num_cerrados++;
                        }


                    }


                    $row = str_replace("{ID}", utf8_encode($unico->id_beneficios), $row);
                    $row = str_replace("{ID_FORM}", utf8_encode($unico->id_form2), $row);
                    $row = str_replace("{TIPO}", utf8_encode($unico->nombre_tipo_workflow), $row);
                    $row = str_replace("{NOMBRE}", utf8_encode($unico->nombre_formulario), $row);
                    $row = str_replace("{SOLICITUDES}", utf8_encode($unico->solicitudes), $row);
                    $row = str_replace("{APROBADOS", utf8_encode($unico->validacion1), $row);

                    $row = str_replace("{PENDIENTES}", $num_pendientes, $row);
                    $row = str_replace("{EN_PROCESO}", $num_proceso, $row);
                    $row = str_replace("{CERRADAS}", $num_cerrados, $row);

                    $row = str_replace("{PENDIENTE}", utf8_encode($unico->validacion2), $row);
                    $row = str_replace("{RECHAZADOS_MODIFICACION}", utf8_encode($unico->validacion3), $row);
                    $row = str_replace("{RECHAZADOS}", utf8_encode($unico->validacion4), $row);


                    $row = str_replace("{NUEVO}", utf8_encode($nuevo), $row);


                    $row = str_replace("{ACCIONJEFE}", utf8_encode($unico->validacionjefeaccion), $row);
                    $row = str_replace("{PENDIENTESJEFE}", utf8_encode($pendientes_jefe), $row);
                    $row = str_replace("{ACCIONADMIN}", utf8_encode($unico->validacionadmin), $row);
                    $row = str_replace("{PENDIENTESADMIN}", utf8_encode($pendientes_admin), $row);

                    $total_html .= $row;
                }
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Beneficios Bch", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }


            function lista_beneficios_historicos($html, $id_empresa, $idcategoria)
            {
                $form1 = lista_beneficios_historicos_data_form($id_empresa, "id_form1");
                //print_r($form1);
                //exit();
                foreach ($form1 as $unico) {

                    $row = file_get_contents("views/beneficios/row_beneficios_historicos.html");
                    $tipo = "";
                    if ($unico->validacionjefe == "SI") {
                        $tipo = "REQUIERE VALIDACION JEFE";
                    }
                    //echo "<br>tipo $tipo tipo valida ".$unico->validacionjefe;
                    $no_vistos = $unico->solicitudes - $unico->visto;
                    //echo "no visto $no_vistos.";

                    if ($no_vistos > 0) {
                        if ($no_vistos == 1) {
                            $nuevo = "<span class='badge badge-warning'>" . $no_vistos . " nuevo</span>";
                        } else {
                            $nuevo = "<span class='badge badge-warning'>" . $no_vistos . " nuevos</span>";
                        }
                    } else {
                        $nuevo = "";
                    }


                    $num_cerrados = 0;
                    $num_proceso = 0;
                    $num_pendientes = 0;
                    //por cada beneficio, hago una barrido por cada solicitudes-$unico-
                    $array_solicitudes = Beneficios_BarridoSolicitudes($unico->id_beneficios, $id_empresa);
                    foreach ($array_solicitudes as $unico_sol) {
                        $val = Beneficios_Busca_Estado_Solo_Data($unico_sol->id, $unico->tipo_workflow);
                        if ($val == "Pendiente") {
                            $num_pendientes++;
                        }
                        if ($val == "En Proceso") {
                            $num_proceso++;
                        }
                        if ($val == "Cerrado") {
                            $num_cerrados++;
                        }


                    }


                    $row = str_replace("{ID}", utf8_encode($unico->id_beneficios), $row);
                    $row = str_replace("{TIPO}", utf8_encode($unico->nombre_tipo_workflow), $row);
                    $row = str_replace("{NOMBRE}", utf8_encode($unico->nombre), $row);
                    $row = str_replace("{SOLICITUDES}", utf8_encode($unico->solicitudes), $row);
                    $row = str_replace("{APROBADOS", utf8_encode($unico->validacion1), $row);

                    $row = str_replace("{PENDIENTES}", $num_pendientes, $row);
                    $row = str_replace("{EN_PROCESO}", $num_proceso, $row);
                    $row = str_replace("{CERRADAS}", $num_cerrados, $row);

                    $row = str_replace("{PENDIENTE}", utf8_encode($unico->validacion2), $row);
                    $row = str_replace("{RECHAZADOS_MODIFICACION}", utf8_encode($unico->validacion3), $row);
                    $row = str_replace("{RECHAZADOS}", utf8_encode($unico->validacion4), $row);
                    $row = str_replace("{ID_FORM}", utf8_encode($unico->id_form1), $row);


                    $row = str_replace("{NUEVO}", utf8_encode($nuevo), $row);


                    $row = str_replace("{ACCIONJEFE}", utf8_encode($unico->validacionjefeaccion), $row);
                    $row = str_replace("{PENDIENTESJEFE}", utf8_encode($pendientes_jefe), $row);
                    $row = str_replace("{ACCIONADMIN}", utf8_encode($unico->validacionadmin), $row);
                    $row = str_replace("{PENDIENTESADMIN}", utf8_encode($pendientes_admin), $row);

                    $total_html .= $row;
                }

                $form2 = lista_beneficios_historicos_data_form($id_empresa, "id_form2");
                //print_r($form1);
                foreach ($form2 as $unico) {

                    $row = file_get_contents("views/beneficios/row_beneficios_historicos.html");
                    $tipo = "";
                    if ($unico->validacionjefe == "SI") {
                        $tipo = "REQUIERE VALIDACION JEFE";
                    }
                    //echo "<br>tipo $tipo tipo valida ".$unico->validacionjefe;
                    $no_vistos = $unico->solicitudes - $unico->visto;
                    //echo "no visto $no_vistos.";

                    if ($no_vistos > 0) {
                        if ($no_vistos == 1) {
                            $nuevo = "<span class='badge badge-danger'>" . $no_vistos . " nuevo</span>";
                        } else {
                            $nuevo = "<span class='badge badge-danger'>" . $no_vistos . " nuevos</span>";
                        }
                    } else {
                        $nuevo = "";
                    }


                    $num_cerrados = 0;
                    $num_proceso = 0;
                    $num_pendientes = 0;
                    //por cada beneficio, hago una barrido por cada solicitudes-$unico-
                    $array_solicitudes = Beneficios_BarridoSolicitudes($unico->id_beneficios, $id_empresa);
                    foreach ($array_solicitudes as $unico_sol) {
                        $val = Beneficios_Busca_Estado_Solo_Data($unico_sol->id, $unico->tipo_workflow);
                        if ($val == "Pendiente") {
                            $num_pendientes++;
                        }
                        if ($val == "En Proceso") {
                            $num_proceso++;
                        }
                        if ($val == "Cerrado") {
                            $num_cerrados++;
                        }


                    }


                    $row = str_replace("{ID}", utf8_encode($unico->id_beneficios), $row);
                    $row = str_replace("{ID_FORM}", utf8_encode($unico->id_form2), $row);
                    $row = str_replace("{TIPO}", utf8_encode($unico->nombre_tipo_workflow), $row);
                    $row = str_replace("{NOMBRE}", utf8_encode($unico->nombre_formulario), $row);
                    $row = str_replace("{SOLICITUDES}", utf8_encode($unico->solicitudes), $row);
                    $row = str_replace("{APROBADOS", utf8_encode($unico->validacion1), $row);

                    $row = str_replace("{PENDIENTES}", $num_pendientes, $row);
                    $row = str_replace("{EN_PROCESO}", $num_proceso, $row);
                    $row = str_replace("{CERRADAS}", $num_cerrados, $row);

                    $row = str_replace("{PENDIENTE}", utf8_encode($unico->validacion2), $row);
                    $row = str_replace("{RECHAZADOS_MODIFICACION}", utf8_encode($unico->validacion3), $row);
                    $row = str_replace("{RECHAZADOS}", utf8_encode($unico->validacion4), $row);


                    $row = str_replace("{NUEVO}", utf8_encode($nuevo), $row);


                    $row = str_replace("{ACCIONJEFE}", utf8_encode($unico->validacionjefeaccion), $row);
                    $row = str_replace("{PENDIENTESJEFE}", utf8_encode($pendientes_jefe), $row);
                    $row = str_replace("{ACCIONADMIN}", utf8_encode($unico->validacionadmin), $row);
                    $row = str_replace("{PENDIENTESADMIN}", utf8_encode($pendientes_admin), $row);

                    $total_html .= $row;
                }
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Beneficios Bch", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_beneficios_fichas_sociales($html, $id_empresa, $idcategoria)
            {
                $form1 = lista_beneficios_data_fichas_sociales_form($id_empresa, "id_form1");
                // print_r($form1);
                // exit();


                foreach ($form1 as $unico) {

                    $row = file_get_contents("views/beneficios/row_beneficios_ficha_social.html");
                    $tipo = "";
                    if ($unico->validacionjefe == "SI") {
                        $tipo = "REQUIERE VALIDACION JEFE";
                    }
                    //echo "<br>tipo $tipo tipo valida ".$unico->validacionjefe;
                    $no_vistos = $unico->solicitudes - $unico->visto;
                    //echo "no visto $no_vistos.";

                    if ($no_vistos > 0) {
                        if ($no_vistos == 1) {
                            $nuevo = "<span class='badge badge-warning'>" . $no_vistos . " nuevo</span>";
                        } else {
                            $nuevo = "<span class='badge badge-warning'>" . $no_vistos . " nuevos</span>";
                        }
                    } else {
                        $nuevo = "";
                    }


                    $num_cerrados = 0;
                    $num_proceso = 0;
                    $num_pendientes = 0;
                    //por cada beneficio, hago una barrido por cada solicitudes-$unico-
                    $array_solicitudes = Beneficios_BarridoSolicitudes($unico->id_beneficios, $id_empresa);
                    foreach ($array_solicitudes as $unico_sol) {
                        $val = Beneficios_Busca_Estado_Solo_Data($unico_sol->id, $unico->tipo_workflow);
                        if ($val == "Pendiente") {
                            $num_pendientes++;
                        }
                        if ($val == "En Proceso") {
                            $num_proceso++;
                        }
                        if ($val == "Cerrado") {
                            $num_cerrados++;
                        }


                    }


                    $row = str_replace("{ID}", utf8_encode($unico->id_beneficios), $row);
                    $row = str_replace("{ID_FORM_FICHA}", utf8_encode($unico->id), $row);
                    $row = str_replace("{TIPO}", utf8_encode($unico->nombre_tipo_workflow), $row);
                    $row = str_replace("{NOMBRE}", utf8_encode($unico->nombre), $row);
                    $row = str_replace("{SOLICITUDES}", utf8_encode($unico->solicitudes), $row);
                    $row = str_replace("{APROBADOS", utf8_encode($unico->validacion1), $row);

                    $row = str_replace("{PENDIENTES}", $num_pendientes, $row);
                    $row = str_replace("{EN_PROCESO}", $num_proceso, $row);
                    $row = str_replace("{CERRADAS}", $num_cerrados, $row);

                    $row = str_replace("{PENDIENTE}", utf8_encode($unico->validacion2), $row);
                    $row = str_replace("{RECHAZADOS_MODIFICACION}", utf8_encode($unico->validacion3), $row);
                    $row = str_replace("{RECHAZADOS}", utf8_encode($unico->validacion4), $row);
                    $row = str_replace("{ID_FORM}", utf8_encode($unico->id_form1), $row);


                    $row = str_replace("{NUEVO}", utf8_encode($nuevo), $row);


                    $row = str_replace("{ACCIONJEFE}", utf8_encode($unico->validacionjefeaccion), $row);
                    $row = str_replace("{PENDIENTESJEFE}", utf8_encode($pendientes_jefe), $row);
                    $row = str_replace("{ACCIONADMIN}", utf8_encode($unico->validacionadmin), $row);
                    $row = str_replace("{PENDIENTESADMIN}", utf8_encode($pendientes_admin), $row);

                    $total_html .= $row;
                }


                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Beneficios Bch", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }


            function lista_beneficios_item_estadisticas($html, $id_empresa, $idcategoria)
            {


                $Ben = Beneficios_Estadisticas_data();
                foreach ($Ben as $unico) {


                    $id_ben_enc = Encodear3($unico->id_beneficios);
                    $Visitas = Beneficios_Estadisticas_idItemsEnc_($id_ben_enc);

                    $row_estadisticas .= "
	<tr>
		<td>" . utf8_encode($unico->nombre) . "</td>
		<td>" . $unico->id_beneficios . "</td>
		<td>" . Encodear3($unico->id_beneficios) . "</td>
		<td>" . $Visitas . "</td>
	</tr>	
		";

                }

                $html = str_replace("{LISTA}", $row_estadisticas, $html);
                $html = str_replace("{TITULO}", "Beneficios Bch", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_beneficios_agendamiento($html, $id_empresa, $idcategoria)
            {
                $lista_becav = lista_beneficios_agendamiento_data($idcategoria, $id_empresa);
                //print_r($lista_becav);
                foreach ($lista_becav as $unico) {
                    //echo "<br>ho<br>";
                    //print_r($unico);


                    $row = file_get_contents("views/beneficios/row_lista_beneficios_agendamiento.html");
                    $row = str_replace("{ID_BENEFICIO}", $idcategoria, $row);
                    $row = str_replace("{ID}", utf8_encode($unico->id), $row);

                    $row = str_replace("{RUT}", utf8_encode($unico->ocupada), $row);
                    $row = str_replace("{NOMBRE}", utf8_encode($unico->nombre_completo), $row);


                    $row = str_replace("{CARGO}", utf8_encode($unico->cargo), $row);
                    $row = str_replace("{EMAIL}", utf8_encode($unico->email), $row);
                    $row = str_replace("{DIVISION}", utf8_encode($unico->division), $row);

                    $row = str_replace("{Fecha}", (fechaCastellano($unico->fecha_inicio)) . "<br>" . $unico->fecha_inicio, $row);
                    $row = str_replace("{Hora}", utf8_encode($unico->hora_inicio), $row);

                    $row = str_replace("{Modalidad}", ($unico->modalidad), $row);

                    $Evento = Beneficios_Agenda_2020_VistaEvento($unico->id_evento);
                    if ($Evento[0]->agenda == "Show Room Vestuario Corporativo") {
                        continue;
                    }

                    $row = str_replace("{Agenda}", utf8_encode($Evento[0]->agenda), $row);


                    $row = str_replace("{Especialista}", utf8_encode($Evento[0]->especialista), $row);


//tipo worfklow
                    $bloque_validacion_ = "";
                    if ($unico->tipo_workflow == "1003") {
                        // Check admin val1

                        if ($unico->validacion1 == "Validado") {
                            $bloque_validacion_1 = "<label style='padding-left: 15px;'></label><div class='alert alert-success'>Validado</div>";
                        } elseif ($unico->validacion1 == "Rechazado_edicion") {
                            $bloque_validacion_1 = "<label style='padding-left: 15px;'></label><div class='alert alert-warning'>Rechazo para Editar</div>";
                        } elseif ($unico->validacion1 == "Rechazado") {
                            $bloque_validacion_1 = "<label style='padding-left: 15px;'></label><div class='alert alert-danger'>Rechazado</div>";
                        } else {
                            $bloque_validacion_1 = "
						<div class='alert alert-warning'>
							<form action='?sw=beneficios_validacion' method='post' name=''>
							<label>Validaci?n 1 Administrador</label><br>
								<select name='validacion' class='form form-control'>
									<option value=''></option>
									<option value='Validado'>Validar</option>
									<option value='Rechazado_edicion'>Rechazado para Editar</option>
									<option value='Rechazado'>Rechazar Definitivamente</option>
								</select>	<br>
								<label>Comentarios</label><br>
								<input type='text' name='comentarios' class='form form-control'>
								<input type='hidden' name='id_bene' value='" . $unico->id . "' class='form form-control'>
								<input type='hidden' name='id' value='" . $idcategoria . "' class='form form-control'>
								<input type='hidden' name='val' value='validacion1' class='form form-control'>
								<input type='submit' class='btn btn-info' value='Guardar Validaci?n'>
							</form>	
						</div>";
                        }

                        if ($unico->validacion2 == "Validado") {
                            $bloque_validacion_2 = "<label style='padding-left: 15px;'><strong>Validaci?n 2 Especialista</strong></label><div class='alert alert-success'>Validado</div>";
                        } elseif ($unico->validacion2 == "Rechazado_edicion") {
                            $bloque_validacion_2 = "<label style='padding-left: 15px;'><strong>Validaci?n 2 Especialista</strong></label><div class='alert alert-warning'>Rechazo para Editar</div>";
                        } elseif ($unico->validacion2 == "Rechazado") {
                            $bloque_validacion_2 = "<label style='padding-left: 15px;'><strong>Validaci?n 2 Especialista</strong></label><div class='alert alert-danger'>Rechazado</div>";
                        } else {
                            $bloque_validacion_2 = "
						<div class='alert alert-warning'>
							<form action='?sw=beneficios_validacion' method='post' name=''>
								<label>Validaci?n 2 Especialista</label><br>
									<select name='validacion' class='form form-control'>
										<option value=''></option>
										<option value='Validado'>Validar</option>
										<option value='Rechazado_edicion'>Rechazado para Editar</option>
										<option value='Rechazado'>Rechazar Definitivamente</option>
									</select>	<br>
								<label>Comentarios</label><br>
									<input type='text' name='comentarios' class='form form-control'>
								<input type='hidden' name='id_bene' value='" . $unico->id . "' class='form form-control'>
								<input type='hidden' name='id' value='" . $idcategoria . "' class='form form-control'>
								<input type='hidden' name='val' value='validacion2' class='form form-control'>
									<input type='submit' class='btn btn-info' value='Guardar Validaci?n'>
							</form>	
						</div>";
                        }
                        $bloque_validacion_ = $bloque_validacion_1 . "<br>" . $bloque_validacion_2;

                    }


                    if ($unico->tipo_workflow == "1004") {
                        // Check admin val1

                        if ($unico->validacion1 == "Validado") {
                            $bloque_validacion_1 = "<label style='padding-left: 15px;'></label><div class='alert alert-success'>Validado</div>";
                        } elseif ($unico->validacion1 == "Rechazado_edicion") {
                            $bloque_validacion_1 = "<label style='padding-left: 15px;'></label><div class='alert alert-warning'>Rechazo para Editar</div>";
                        } elseif ($unico->validacion1 == "Rechazado") {
                            $bloque_validacion_1 = "<label style='padding-left: 15px;'></label><div class='alert alert-danger'>Rechazado</div>";
                        } else {

                            $bloque_validacion_1 = "
						<div class='alert alert-warning'>
							<form action='?sw=beneficios_validacion' method='post' name=''>
							<label>Validaci?n 1 Administrador</label><br>
								<select name='validacion' class='form form-control'>
									<option value=''></option>
									<option value='Validado'>Validar</option>
									<option value='Rechazado_edicion'>Rechazado para Editar</option>
									<option value='Rechazado'>Rechazar Definitivamente</option>
								</select>	<br>
								<label>Comentarios</label><br>
								<input type='text' name='comentarios' class='form form-control'>
								<input type='hidden' name='id_bene' value='" . $unico->id . "' class='form form-control'>
								<input type='hidden' name='id' value='" . $idcategoria . "' class='form form-control'>
								
								<input type='hidden' name='val' value='validacion1' class='form form-control'>
								
								<input type='submit' class='btn btn-info' value='Guardar Validaci?n'>
							</form>	
						</div>";
                        }


                        if ($unico->validacion2 == "Validado") {
                            $bloque_validacion_2 = "<label style='padding-left: 15px;'><strong>Validaci?n 2 Especialista</strong></label><div class='alert alert-success'>Validado</div>";
                        } elseif ($unico->validacion2 == "Rechazado_edicion") {
                            $bloque_validacion_2 = "<label style='padding-left: 15px;'><strong>Validaci?n 2 Especialista</strong></label><div class='alert alert-warning'>Rechazo para Editar</div>";
                        } elseif ($unico->validacion2 == "Rechazado") {
                            $bloque_validacion_2 = "<label style='padding-left: 15px;'><strong>Validaci?n 2 Especialista</strong></label><div class='alert alert-danger'>Rechazado</div>";
                        } else {
                            $bloque_validacion_2 = "
						<div class='alert alert-warning'>
							<form action='?sw=beneficios_validacion' method='post' name=''>
								<label>Validaci?n 2 Especialista</label><br>
									<select name='validacion' class='form form-control'>
										<option value=''></option>
										<option value='Validado'>Validar</option>
										<option value='Rechazado_edicion'>Rechazado para Editar</option>
										<option value='Rechazado'>Rechazar Definitivamente</option>
									</select>	<br>
								<label>Comentarios</label><br>
									<input type='text' name='comentarios' class='form form-control'>
								<input type='hidden' name='id_bene' value='" . $unico->id . "' class='form form-control'>
								<input type='hidden' name='id' value='" . $idcategoria . "' class='form form-control'>
								
								<input type='hidden' name='val' value='validacion2' class='form form-control'>
									
									<input type='submit' class='btn btn-info' value='Guardar Validaci?n'>
							</form>	
						</div>";
                        }

                        if ($unico->validacion3 == "Ganador") {
                            $bloque_validacion_3 = "<label style='padding-left: 15px;'><strong>Validaci?n 2 Especialista</strong></label><div class='alert alert-success'>Ganador</div>";
                        } elseif ($unico->validacion3 == "Rechazado_edicion") {
                            $bloque_validacion_3 = "<label style='padding-left: 15px;'><strong>Validaci?n 2 Especialista</strong></label><div class='alert alert-warning'>No Ganador</div>";
                        } elseif ($unico->validacion3 == "No Ganador") {
                            $bloque_validacion_3 = "<label style='padding-left: 15px;'><strong>Validaci?n 2 Especialista</strong></label><div class='alert alert-danger'>No Ganador</div>";
                        } else {
                            $bloque_validacion_3 = "
						<div class='alert alert-warning'>
							<form action='?sw=beneficios_validacion' method='post' name=''>
								<label>Validaci?n 3 Ganador</label><br>
									<select name='validacion' class='form form-control'>
										<option value=''></option>
										<option value='Ganador'>Ganador</option>
										<option value='No_Ganador'>No_Ganador</option>
									</select>	<br>
								<label>Comentarios</label><br>
									<input type='text' name='comentarios' class='form form-control'>
								<input type='hidden' name='id_bene' value='" . $unico->id . "' class='form form-control'>
								<input type='hidden' name='id' value='" . $idcategoria . "' class='form form-control'>
								
								<input type='hidden' name='val' value='validacion3' class='form form-control'>
									
									<input type='submit' class='btn btn-info' value='Guardar Validaci?n'>
							</form>	
						</div>";
                        }
                        $bloque_validacion_ = $bloque_validacion_1 . "<br>" . $bloque_validacion_2 . "<br>" . $bloque_validacion_3;
                    }


                    if ($unico->tipo_workflow == "1005") {
                        // Check admin val1

                        if ($unico->validacion1 == "Validado") {
                            $bloque_validacion_1 = "<label style='padding-left: 15px;'></label><div class='alert alert-success'>Validado</div>";
                        } elseif ($unico->validacion1 == "Rechazado_edicion") {
                            $bloque_validacion_1 = "<label style='padding-left: 15px;'></label><div class='alert alert-warning'>Rechazo para Editar</div>";
                        } elseif ($unico->validacion1 == "Rechazado") {
                            $bloque_validacion_1 = "<label style='padding-left: 15px;'></label><div class='alert alert-danger'>Rechazado</div>";
                        } else {
                            $bloque_validacion_1 = "
						<div class='alert alert-warning'>
							<form action='?sw=beneficios_validacion' method='post' name=''>
							<label>Validaci?n 1 Administrador</label><br>
								<select name='validacion' class='form form-control'>
									<option value=''></option>
									<option value='Validado'>Validar</option>
									<option value='Rechazado_edicion'>Rechazado para Editar</option>
									<option value='Rechazado'>Rechazar Definitivamente</option>
								</select>	<br>
								<label>Comentarios</label><br>
								<input type='text' name='comentarios' class='form form-control'>
								<input type='hidden' name='id_bene' value='" . $unico->id . "' class='form form-control'>
								<input type='hidden' name='id' value='" . $idcategoria . "' class='form form-control'>
								
								<input type='hidden' name='val' value='validacion1' class='form form-control'>
								
								<input type='submit' class='btn btn-info' value='Guardar Validaci?n'>
							</form>	
						</div>";
                        }

                        if ($unico->validacion2 == "Validado") {
                            $bloque_validacion_2 = "<label style='padding-left: 15px;'><strong>Validaci?n 2 Especialista</strong></label><div class='alert alert-success'>Validado</div>";
                        } elseif ($unico->validacion2 == "Rechazado_edicion") {
                            $bloque_validacion_2 = "<label style='padding-left: 15px;'><strong>Validaci?n 2 Especialista</strong></label><div class='alert alert-warning'>Rechazo para Editar</div>";
                        } elseif ($unico->validacion2 == "Rechazado") {
                            $bloque_validacion_2 = "<label style='padding-left: 15px;'><strong>Validaci?n 2 Especialista</strong></label><div class='alert alert-danger'>Rechazado</div>";
                        } else {

                            $bloque_validacion_2 = "
						<div class='alert alert-warning'>
							<form action='?sw=beneficios_validacion' method='post' name=''>
								<label>Validaci?n 2 Especialista</label><br>
									<select name='validacion' class='form form-control'>
										<option value=''></option>
										<option value='Validado'>Validar</option>
										<option value='Rechazado_edicion'>Rechazado para Editar</option>
										<option value='Rechazado'>Rechazar Definitivamente</option>
									</select>	<br>
								<label>Comentarios</label><br>
									<input type='text' name='comentarios' class='form form-control'>
								<input type='hidden' name='id_bene' value='" . $unico->id . "' class='form form-control'>
								<input type='hidden' name='id' value='" . $idcategoria . "' class='form form-control'>
								
								<input type='hidden' name='val' value='validacion2' class='form form-control'>
									
									<input type='submit' class='btn btn-info' value='Guardar Validaci?n'>
							</form>	
						</div>";
                        }

                        if ($unico->validacion3 == "Validado") {
                            $bloque_validacion_3 = "<label style='padding-left: 15px;'><strong>Validaci?n 3 Administrador</strong></label><div class='alert alert-success'>Validado</div>";
                        } elseif ($unico->validacion3 == "Rechazado_edicion") {
                            $bloque_validacion_3 = "<label style='padding-left: 15px;'><strong>Validaci?n 3 Administrador</strong></label><div class='alert alert-warning'>Rechazo para Editar</div>";
                        } elseif ($unico->validacion3 == "Rechazado") {
                            $bloque_validacion_3 = "<label style='padding-left: 15px;'><strong>Validaci?n 3 Administrador</strong></label><div class='alert alert-danger'>Rechazado</div>";
                        } else {
                            $bloque_validacion_3 = "
						<div class='alert alert-warning'>
							<form action='?sw=beneficios_validacion' method='post' name=''>
							<label>Validaci?n 1 Administrador</label><br>
								<select name='validacion' class='form form-control'>
									<option value=''></option>
									<option value='Validado'>Validar</option>
									<option value='Rechazado_edicion'>Rechazado para Editar</option>
									<option value='Rechazado'>Rechazar Definitivamente</option>
								</select>	<br>
								<label>Comentarios</label><br>
								<input type='text' name='comentarios' class='form form-control'>
								<input type='hidden' name='id_bene' value='" . $unico->id . "' class='form form-control'>
								<input type='hidden' name='id' value='" . $idcategoria . "' class='form form-control'>
								
								<input type='hidden' name='val' value='validacion3' class='form form-control'>
								
								<input type='submit' class='btn btn-info' value='Guardar Validaci?n'>
							</form>	
						</div>";
                        }


                        if ($unico->validacion4 == "Validado") {
                            $bloque_validacion_4 = "<label style='padding-left: 15px;'><strong>Validaci?n 4 Especialista</strong></label><div class='alert alert-success'>Validado</div>";
                        } elseif ($unico->validacion4 == "Rechazado_edicion") {
                            $bloque_validacion_4 = "<label style='padding-left: 15px;'><strong>Validaci?n 4 Especialista</strong></label><div class='alert alert-warning'>Rechazo para Editar</div>";
                        } elseif ($unico->validacion4 == "Rechazado") {
                            $bloque_validacion_4 = "<label style='padding-left: 15px;'><strong>Validaci?n 4 Especialista</strong></label><div class='alert alert-danger'>Rechazado</div>";
                        } else {
                            $bloque_validacion_4 = "
						<div class='alert alert-warning'>
							<form action='?sw=beneficios_validacion' method='post' name=''>
								<label>Validaci?n 2 Especialista</label><br>
									<select name='validacion' class='form form-control'>
										<option value=''></option>
										<option value='Validado'>Validar</option>
										<option value='Rechazado_edicion'>Rechazado para Editar</option>
										<option value='Rechazado'>Rechazar Definitivamente</option>
									</select>	<br>
								<label>Comentarios</label><br>
									<input type='text' name='comentarios' class='form form-control'>
								<input type='hidden' name='id_bene' value='" . $unico->id . "' class='form form-control'>
								<input type='hidden' name='id' value='" . $idcategoria . "' class='form form-control'>
								
								<input type='hidden' name='val' value='validacion4' class='form form-control'>
									
									<input type='submit' class='btn btn-info' value='Guardar Validaci?n'>
							</form>	
						</div>";
                        }
                        $bloque_validacion_ = $bloque_validacion_1 . "<br>" . $bloque_validacion_2 . "<br>" . $bloque_validacion_3 . "<br>" . $bloque_validacion_4;
                    }


                    $row = str_replace("{WORKFLOW_FORMULARIO}", ($bloque_validacion_), $row);


                    $id_enc = Encodear3($unico->id);
                    $botones_documentacion = '';

                    $botones_validacion = '';
//echo $botones_documentacion;

                    $tipo = "";
                    if ($unico->tipo_wf == "SI") {
                        $tipo = "REQUIERE_VALIDACION_JEFATURA";
                    }

                    $row = str_replace("{BENEFICIO}", utf8_encode($unico->beneficio), $row);
                    $row = str_replace("{TIPO_WORKFLOW}", "", $row);

                    $fecha_inicio = $unico->fecha_inicio;
                    $fecha_termino = $unico->fecha_termino;
                    $dia1 = $unico->dia;
                    $dia2 = $unico->dia2;
                    $fecha_nacimiento = $unico->fecha_nac;
                    $anexo = $unico->anexo;
                    $celular = $unico->num_celular;
                    $cargo = $unico->cargo;
                    $mundo = $unico->mundo;
                    $datos = "";


// POR CADA CAMPO CON RESPUESTA VOY CREANDO LISTA


                    if ($unico->idc01 <> "") {
                        $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc01", $unico->id_form1);
                        $datos .= "<strong>" . $NombreCampo . "</strong>: " . ($unico->idc01) . "<br>";
                    }

                    if ($unico->idc02 <> "") {
                        $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc02", $unico->id_form1);
                        $datos .= "<strong>" . $NombreCampo . "</strong>: " . ($unico->idc02) . "<br>";
                    }

                    if ($unico->idc03 <> "") {
                        $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc03", $unico->id_form1);
                        $datos .= "<strong>" . $NombreCampo . "</strong>: " . ($unico->idc03) . "<br>";
                    }

                    if ($unico->idc04 <> "") {
                        $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc04", $unico->id_form1);
                        $datos .= "<strong>" . $NombreCampo . "</strong>: " . ($unico->idc04) . "<br>";
                    }

                    if ($unico->idc05 <> "") {
                        $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc05", $unico->id_form1);
                        $datos .= "<strong>" . $NombreCampo . "</strong>: " . ($unico->idc05) . "<br>";
                    }

                    if ($unico->idc06 <> "") {
                        $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc06", $unico->id_form1);
                        $datos .= "<strong>" . $NombreCampo . "</strong>: " . ($unico->idc06) . "<br>";
                    }

                    if ($unico->idc07 <> "") {
                        $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc07", $unico->id_form1);
                        $datos .= "<strong>" . $NombreCampo . "</strong>: " . ($unico->idc07) . "<br>";
                    }

                    if ($unico->idc08 <> "") {
                        $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc08", $unico->id_form1);
                        $datos .= "<strong>" . $NombreCampo . "</strong>: " . ($unico->idc08) . "<br>";
                    }

                    if ($unico->idc09 <> "") {
                        $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc09", $unico->id_form1);
                        $datos .= "<strong>" . $NombreCampo . "</strong>: " . ($unico->idc09) . "<br>";
                    }

                    if ($unico->idc10 <> "") {
                        $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc10", $unico->id_form1);
                        $datos .= "<strong>" . $NombreCampo . "</strong>: " . ($unico->idc10) . "<br>";
                    }


                    $row = str_replace("{DATOS}", utf8_encode($datos), $row);

                    $botones_validacionok = '<span class="badge badge-warning">PENDIENTE</span> ';

                    if ($unico->validacionok == '1') {
                        $botones_validacionok = '<span class="badge badge-success">VALIDADO</span> ';
                    }

                    if ($unico->validacionok == '3') {
                        $botones_validacionok = '<span class="badge badge-danger">RECHAZADO</span> ';
                    }


                    $botones_documentacionok = '<span class="badge badge-warning">PENDIENTE</span> ';

                    if ($unico->documentacionok == '1') {
                        $botones_documentacionok = '<span class="badge badge-success">VALIDADO</span> ';
                    }

                    if ($unico->documentacionok == '3') {
                        $botones_documentacionok = '<span class="badge badge-danger">RECHAZADO</span> ';
                    }


                    //$botones_documentacion.='<span class="badge badge-danger">RECHAZADO</span><br><br>';
                    $botones_documentacionBK .= '<br>
	<a href="?sw=beneficios_validacion&idenc=' . $id_enc . '&d=1&id=' . $idcategoria . '" 
	class="btn btn-success btn-sm" onclick="Valida' . $unico->id . '();">Validar</a>
	
	<br><br>
	
	<a href="?sw=beneficios_validacion&idenc=' . $id_enc . '&d=2&id=' . $idcategoria . '" 
	class="btn btn-danger btn-sm" onclick="Rechaza' . $unico->id . '();">Rechazar</a> 
	';


                    $botones_documentacion .= '<br>
	<a 
	class="btn btn-success btn-sm" onclick="Valida' . $unico->id . '();">Validar</a>
	
	<br><br>
	
	<a  
	class="btn btn-danger btn-sm" onclick="Rechaza' . $unico->id . '();">Rechazar</a> 
	';


                    $estado_final_beneficio = Beneficios_Busca_Estado($unico->id, $unico->tipo_workflow);


                    $row = str_replace("{DOCUMENTACION}", utf8_encode($documentacion), $row);
                    $row = str_replace("{VALIDACION_JEFE}", utf8_encode($botones_validacionok), $row);
                    $row = str_replace("{DOCUMENTACION_OK}", utf8_encode($estado_final_beneficio), $row);

                    $row = str_replace("{VALIDACION_FINAL}", utf8_encode($botones_documentacion), $row);
                    $total_html .= $row;
                }
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Beneficios", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '<a href="?sw=beneficios" class="btn btn-info">< Volver</a>', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                $html = str_replace("{ID_BENEFICIO}", $idcategoria, $html);

                return ($html);
            }


            function beneficios_agendamiento_v2($html, $id_empresa, $idcategoria)
            {
                $lista_becav = lista_beneficios_agendamiento_v2_data($idcategoria, $id_empresa);
                //print_r($lista_becav);
                foreach ($lista_becav as $unico) {
                    //echo "<br>ho<br>";
                    //print_r($unico);


                    $row = file_get_contents("views/beneficios/row_lista_beneficios_agendamiento.html");
                    $row = str_replace("{ID_BENEFICIO}", $idcategoria, $row);
                    $row = str_replace("{ID}", utf8_encode($unico->id), $row);

                    $row = str_replace("{RUT}", utf8_encode($unico->ocupada), $row);
                    $row = str_replace("{NOMBRE}", utf8_encode($unico->nombre_completo), $row);


                    $row = str_replace("{CARGO}", utf8_encode($unico->cargo), $row);
                    $row = str_replace("{EMAIL}", utf8_encode($unico->email), $row);
                    $row = str_replace("{DIVISION}", utf8_encode($unico->division), $row);

                    $row = str_replace("{Fecha}", (fechaCastellano($unico->fecha_inicio)), $row);
                    $row = str_replace("{Hora}", utf8_encode($unico->hora_inicio), $row);

                    $row = str_replace("{Modalidad}", ($unico->modalidad), $row);

                    $Evento = Beneficios_Agenda_2020_VistaEvento($unico->id_evento);
                    if ($Evento[0]->agenda <> "Show Room Vestuario Corporativo") {
                        continue;
                    }

                    $row = str_replace("{Agenda}", utf8_encode($Evento[0]->agenda), $row);


                    $row = str_replace("{Especialista}", utf8_encode($Evento[0]->especialista), $row);


//tipo worfklow
                    $bloque_validacion_ = "";
                    if ($unico->tipo_workflow == "1003") {
                        // Check admin val1

                        if ($unico->validacion1 == "Validado") {
                            $bloque_validacion_1 = "<label style='padding-left: 15px;'></label><div class='alert alert-success'>Validado</div>";
                        } elseif ($unico->validacion1 == "Rechazado_edicion") {
                            $bloque_validacion_1 = "<label style='padding-left: 15px;'></label><div class='alert alert-warning'>Rechazo para Editar</div>";
                        } elseif ($unico->validacion1 == "Rechazado") {
                            $bloque_validacion_1 = "<label style='padding-left: 15px;'></label><div class='alert alert-danger'>Rechazado</div>";
                        } else {
                            $bloque_validacion_1 = "
						<div class='alert alert-warning'>
							<form action='?sw=beneficios_validacion' method='post' name=''>
							<label>Validaci?n 1 Administrador</label><br>
								<select name='validacion' class='form form-control'>
									<option value=''></option>
									<option value='Validado'>Validar</option>
									<option value='Rechazado_edicion'>Rechazado para Editar</option>
									<option value='Rechazado'>Rechazar Definitivamente</option>
								</select>	<br>
								<label>Comentarios</label><br>
								<input type='text' name='comentarios' class='form form-control'>
								<input type='hidden' name='id_bene' value='" . $unico->id . "' class='form form-control'>
								<input type='hidden' name='id' value='" . $idcategoria . "' class='form form-control'>
								<input type='hidden' name='val' value='validacion1' class='form form-control'>
								<input type='submit' class='btn btn-info' value='Guardar Validaci?n'>
							</form>	
						</div>";
                        }

                        if ($unico->validacion2 == "Validado") {
                            $bloque_validacion_2 = "<label style='padding-left: 15px;'><strong>Validaci?n 2 Especialista</strong></label><div class='alert alert-success'>Validado</div>";
                        } elseif ($unico->validacion2 == "Rechazado_edicion") {
                            $bloque_validacion_2 = "<label style='padding-left: 15px;'><strong>Validaci?n 2 Especialista</strong></label><div class='alert alert-warning'>Rechazo para Editar</div>";
                        } elseif ($unico->validacion2 == "Rechazado") {
                            $bloque_validacion_2 = "<label style='padding-left: 15px;'><strong>Validaci?n 2 Especialista</strong></label><div class='alert alert-danger'>Rechazado</div>";
                        } else {
                            $bloque_validacion_2 = "
						<div class='alert alert-warning'>
							<form action='?sw=beneficios_validacion' method='post' name=''>
								<label>Validaci?n 2 Especialista</label><br>
									<select name='validacion' class='form form-control'>
										<option value=''></option>
										<option value='Validado'>Validar</option>
										<option value='Rechazado_edicion'>Rechazado para Editar</option>
										<option value='Rechazado'>Rechazar Definitivamente</option>
									</select>	<br>
								<label>Comentarios</label><br>
									<input type='text' name='comentarios' class='form form-control'>
								<input type='hidden' name='id_bene' value='" . $unico->id . "' class='form form-control'>
								<input type='hidden' name='id' value='" . $idcategoria . "' class='form form-control'>
								<input type='hidden' name='val' value='validacion2' class='form form-control'>
									<input type='submit' class='btn btn-info' value='Guardar Validaci?n'>
							</form>	
						</div>";
                        }
                        $bloque_validacion_ = $bloque_validacion_1 . "<br>" . $bloque_validacion_2;

                    }


                    if ($unico->tipo_workflow == "1004") {
                        // Check admin val1

                        if ($unico->validacion1 == "Validado") {
                            $bloque_validacion_1 = "<label style='padding-left: 15px;'></label><div class='alert alert-success'>Validado</div>";
                        } elseif ($unico->validacion1 == "Rechazado_edicion") {
                            $bloque_validacion_1 = "<label style='padding-left: 15px;'></label><div class='alert alert-warning'>Rechazo para Editar</div>";
                        } elseif ($unico->validacion1 == "Rechazado") {
                            $bloque_validacion_1 = "<label style='padding-left: 15px;'></label><div class='alert alert-danger'>Rechazado</div>";
                        } else {

                            $bloque_validacion_1 = "
						<div class='alert alert-warning'>
							<form action='?sw=beneficios_validacion' method='post' name=''>
							<label>Validaci?n 1 Administrador</label><br>
								<select name='validacion' class='form form-control'>
									<option value=''></option>
									<option value='Validado'>Validar</option>
									<option value='Rechazado_edicion'>Rechazado para Editar</option>
									<option value='Rechazado'>Rechazar Definitivamente</option>
								</select>	<br>
								<label>Comentarios</label><br>
								<input type='text' name='comentarios' class='form form-control'>
								<input type='hidden' name='id_bene' value='" . $unico->id . "' class='form form-control'>
								<input type='hidden' name='id' value='" . $idcategoria . "' class='form form-control'>
								
								<input type='hidden' name='val' value='validacion1' class='form form-control'>
								
								<input type='submit' class='btn btn-info' value='Guardar Validaci?n'>
							</form>	
						</div>";
                        }


                        if ($unico->validacion2 == "Validado") {
                            $bloque_validacion_2 = "<label style='padding-left: 15px;'><strong>Validaci?n 2 Especialista</strong></label><div class='alert alert-success'>Validado</div>";
                        } elseif ($unico->validacion2 == "Rechazado_edicion") {
                            $bloque_validacion_2 = "<label style='padding-left: 15px;'><strong>Validaci?n 2 Especialista</strong></label><div class='alert alert-warning'>Rechazo para Editar</div>";
                        } elseif ($unico->validacion2 == "Rechazado") {
                            $bloque_validacion_2 = "<label style='padding-left: 15px;'><strong>Validaci?n 2 Especialista</strong></label><div class='alert alert-danger'>Rechazado</div>";
                        } else {
                            $bloque_validacion_2 = "
						<div class='alert alert-warning'>
							<form action='?sw=beneficios_validacion' method='post' name=''>
								<label>Validaci?n 2 Especialista</label><br>
									<select name='validacion' class='form form-control'>
										<option value=''></option>
										<option value='Validado'>Validar</option>
										<option value='Rechazado_edicion'>Rechazado para Editar</option>
										<option value='Rechazado'>Rechazar Definitivamente</option>
									</select>	<br>
								<label>Comentarios</label><br>
									<input type='text' name='comentarios' class='form form-control'>
								<input type='hidden' name='id_bene' value='" . $unico->id . "' class='form form-control'>
								<input type='hidden' name='id' value='" . $idcategoria . "' class='form form-control'>
								
								<input type='hidden' name='val' value='validacion2' class='form form-control'>
									
									<input type='submit' class='btn btn-info' value='Guardar Validaci?n'>
							</form>	
						</div>";
                        }

                        if ($unico->validacion3 == "Ganador") {
                            $bloque_validacion_3 = "<label style='padding-left: 15px;'><strong>Validaci?n 2 Especialista</strong></label><div class='alert alert-success'>Ganador</div>";
                        } elseif ($unico->validacion3 == "Rechazado_edicion") {
                            $bloque_validacion_3 = "<label style='padding-left: 15px;'><strong>Validaci?n 2 Especialista</strong></label><div class='alert alert-warning'>No Ganador</div>";
                        } elseif ($unico->validacion3 == "No Ganador") {
                            $bloque_validacion_3 = "<label style='padding-left: 15px;'><strong>Validaci?n 2 Especialista</strong></label><div class='alert alert-danger'>No Ganador</div>";
                        } else {
                            $bloque_validacion_3 = "
						<div class='alert alert-warning'>
							<form action='?sw=beneficios_validacion' method='post' name=''>
								<label>Validaci?n 3 Ganador</label><br>
									<select name='validacion' class='form form-control'>
										<option value=''></option>
										<option value='Ganador'>Ganador</option>
										<option value='No_Ganador'>No_Ganador</option>
									</select>	<br>
								<label>Comentarios</label><br>
									<input type='text' name='comentarios' class='form form-control'>
								<input type='hidden' name='id_bene' value='" . $unico->id . "' class='form form-control'>
								<input type='hidden' name='id' value='" . $idcategoria . "' class='form form-control'>
								
								<input type='hidden' name='val' value='validacion3' class='form form-control'>
									
									<input type='submit' class='btn btn-info' value='Guardar Validaci?n'>
							</form>	
						</div>";
                        }
                        $bloque_validacion_ = $bloque_validacion_1 . "<br>" . $bloque_validacion_2 . "<br>" . $bloque_validacion_3;
                    }


                    if ($unico->tipo_workflow == "1005") {
                        // Check admin val1

                        if ($unico->validacion1 == "Validado") {
                            $bloque_validacion_1 = "<label style='padding-left: 15px;'></label><div class='alert alert-success'>Validado</div>";
                        } elseif ($unico->validacion1 == "Rechazado_edicion") {
                            $bloque_validacion_1 = "<label style='padding-left: 15px;'></label><div class='alert alert-warning'>Rechazo para Editar</div>";
                        } elseif ($unico->validacion1 == "Rechazado") {
                            $bloque_validacion_1 = "<label style='padding-left: 15px;'></label><div class='alert alert-danger'>Rechazado</div>";
                        } else {
                            $bloque_validacion_1 = "
						<div class='alert alert-warning'>
							<form action='?sw=beneficios_validacion' method='post' name=''>
							<label>Validaci?n 1 Administrador</label><br>
								<select name='validacion' class='form form-control'>
									<option value=''></option>
									<option value='Validado'>Validar</option>
									<option value='Rechazado_edicion'>Rechazado para Editar</option>
									<option value='Rechazado'>Rechazar Definitivamente</option>
								</select>	<br>
								<label>Comentarios</label><br>
								<input type='text' name='comentarios' class='form form-control'>
								<input type='hidden' name='id_bene' value='" . $unico->id . "' class='form form-control'>
								<input type='hidden' name='id' value='" . $idcategoria . "' class='form form-control'>
								
								<input type='hidden' name='val' value='validacion1' class='form form-control'>
								
								<input type='submit' class='btn btn-info' value='Guardar Validaci?n'>
							</form>	
						</div>";
                        }

                        if ($unico->validacion2 == "Validado") {
                            $bloque_validacion_2 = "<label style='padding-left: 15px;'><strong>Validaci?n 2 Especialista</strong></label><div class='alert alert-success'>Validado</div>";
                        } elseif ($unico->validacion2 == "Rechazado_edicion") {
                            $bloque_validacion_2 = "<label style='padding-left: 15px;'><strong>Validaci?n 2 Especialista</strong></label><div class='alert alert-warning'>Rechazo para Editar</div>";
                        } elseif ($unico->validacion2 == "Rechazado") {
                            $bloque_validacion_2 = "<label style='padding-left: 15px;'><strong>Validaci?n 2 Especialista</strong></label><div class='alert alert-danger'>Rechazado</div>";
                        } else {

                            $bloque_validacion_2 = "
						<div class='alert alert-warning'>
							<form action='?sw=beneficios_validacion' method='post' name=''>
								<label>Validaci?n 2 Especialista</label><br>
									<select name='validacion' class='form form-control'>
										<option value=''></option>
										<option value='Validado'>Validar</option>
										<option value='Rechazado_edicion'>Rechazado para Editar</option>
										<option value='Rechazado'>Rechazar Definitivamente</option>
									</select>	<br>
								<label>Comentarios</label><br>
									<input type='text' name='comentarios' class='form form-control'>
								<input type='hidden' name='id_bene' value='" . $unico->id . "' class='form form-control'>
								<input type='hidden' name='id' value='" . $idcategoria . "' class='form form-control'>
								
								<input type='hidden' name='val' value='validacion2' class='form form-control'>
									
									<input type='submit' class='btn btn-info' value='Guardar Validaci?n'>
							</form>	
						</div>";
                        }

                        if ($unico->validacion3 == "Validado") {
                            $bloque_validacion_3 = "<label style='padding-left: 15px;'><strong>Validaci?n 3 Administrador</strong></label><div class='alert alert-success'>Validado</div>";
                        } elseif ($unico->validacion3 == "Rechazado_edicion") {
                            $bloque_validacion_3 = "<label style='padding-left: 15px;'><strong>Validaci?n 3 Administrador</strong></label><div class='alert alert-warning'>Rechazo para Editar</div>";
                        } elseif ($unico->validacion3 == "Rechazado") {
                            $bloque_validacion_3 = "<label style='padding-left: 15px;'><strong>Validaci?n 3 Administrador</strong></label><div class='alert alert-danger'>Rechazado</div>";
                        } else {
                            $bloque_validacion_3 = "
						<div class='alert alert-warning'>
							<form action='?sw=beneficios_validacion' method='post' name=''>
							<label>Validaci?n 1 Administrador</label><br>
								<select name='validacion' class='form form-control'>
									<option value=''></option>
									<option value='Validado'>Validar</option>
									<option value='Rechazado_edicion'>Rechazado para Editar</option>
									<option value='Rechazado'>Rechazar Definitivamente</option>
								</select>	<br>
								<label>Comentarios</label><br>
								<input type='text' name='comentarios' class='form form-control'>
								<input type='hidden' name='id_bene' value='" . $unico->id . "' class='form form-control'>
								<input type='hidden' name='id' value='" . $idcategoria . "' class='form form-control'>
								
								<input type='hidden' name='val' value='validacion3' class='form form-control'>
								
								<input type='submit' class='btn btn-info' value='Guardar Validaci?n'>
							</form>	
						</div>";
                        }


                        if ($unico->validacion4 == "Validado") {
                            $bloque_validacion_4 = "<label style='padding-left: 15px;'><strong>Validaci?n 4 Especialista</strong></label><div class='alert alert-success'>Validado</div>";
                        } elseif ($unico->validacion4 == "Rechazado_edicion") {
                            $bloque_validacion_4 = "<label style='padding-left: 15px;'><strong>Validaci?n 4 Especialista</strong></label><div class='alert alert-warning'>Rechazo para Editar</div>";
                        } elseif ($unico->validacion4 == "Rechazado") {
                            $bloque_validacion_4 = "<label style='padding-left: 15px;'><strong>Validaci?n 4 Especialista</strong></label><div class='alert alert-danger'>Rechazado</div>";
                        } else {
                            $bloque_validacion_4 = "
						<div class='alert alert-warning'>
							<form action='?sw=beneficios_validacion' method='post' name=''>
								<label>Validaci?n 2 Especialista</label><br>
									<select name='validacion' class='form form-control'>
										<option value=''></option>
										<option value='Validado'>Validar</option>
										<option value='Rechazado_edicion'>Rechazado para Editar</option>
										<option value='Rechazado'>Rechazar Definitivamente</option>
									</select>	<br>
								<label>Comentarios</label><br>
									<input type='text' name='comentarios' class='form form-control'>
								<input type='hidden' name='id_bene' value='" . $unico->id . "' class='form form-control'>
								<input type='hidden' name='id' value='" . $idcategoria . "' class='form form-control'>
								
								<input type='hidden' name='val' value='validacion4' class='form form-control'>
									
									<input type='submit' class='btn btn-info' value='Guardar Validaci?n'>
							</form>	
						</div>";
                        }
                        $bloque_validacion_ = $bloque_validacion_1 . "<br>" . $bloque_validacion_2 . "<br>" . $bloque_validacion_3 . "<br>" . $bloque_validacion_4;
                    }


                    $row = str_replace("{WORKFLOW_FORMULARIO}", ($bloque_validacion_), $row);


                    $id_enc = Encodear3($unico->id);
                    $botones_documentacion = '';

                    $botones_validacion = '';
//echo $botones_documentacion;

                    $tipo = "";
                    if ($unico->tipo_wf == "SI") {
                        $tipo = "REQUIERE_VALIDACION_JEFATURA";
                    }

                    $row = str_replace("{BENEFICIO}", utf8_encode($unico->beneficio), $row);
                    $row = str_replace("{TIPO_WORKFLOW}", "", $row);

                    $fecha_inicio = $unico->fecha_inicio;
                    $fecha_termino = $unico->fecha_termino;
                    $dia1 = $unico->dia;
                    $dia2 = $unico->dia2;
                    $fecha_nacimiento = $unico->fecha_nac;
                    $anexo = $unico->anexo;
                    $celular = $unico->num_celular;
                    $cargo = $unico->cargo;
                    $mundo = $unico->mundo;
                    $datos = "";


// POR CADA CAMPO CON RESPUESTA VOY CREANDO LISTA


                    if ($unico->idc01 <> "") {
                        $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc01", $unico->id_form1);
                        $datos .= "<strong>" . $NombreCampo . "</strong>: " . ($unico->idc01) . "<br>";
                    }

                    if ($unico->idc02 <> "") {
                        $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc02", $unico->id_form1);
                        $datos .= "<strong>" . $NombreCampo . "</strong>: " . ($unico->idc02) . "<br>";
                    }

                    if ($unico->idc03 <> "") {
                        $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc03", $unico->id_form1);
                        $datos .= "<strong>" . $NombreCampo . "</strong>: " . ($unico->idc03) . "<br>";
                    }

                    if ($unico->idc04 <> "") {
                        $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc04", $unico->id_form1);
                        $datos .= "<strong>" . $NombreCampo . "</strong>: " . ($unico->idc04) . "<br>";
                    }

                    if ($unico->idc05 <> "") {
                        $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc05", $unico->id_form1);
                        $datos .= "<strong>" . $NombreCampo . "</strong>: " . ($unico->idc05) . "<br>";
                    }

                    if ($unico->idc06 <> "") {
                        $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc06", $unico->id_form1);
                        $datos .= "<strong>" . $NombreCampo . "</strong>: " . ($unico->idc06) . "<br>";
                    }

                    if ($unico->idc07 <> "") {
                        $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc07", $unico->id_form1);
                        $datos .= "<strong>" . $NombreCampo . "</strong>: " . ($unico->idc07) . "<br>";
                    }

                    if ($unico->idc08 <> "") {
                        $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc08", $unico->id_form1);
                        $datos .= "<strong>" . $NombreCampo . "</strong>: " . ($unico->idc08) . "<br>";
                    }

                    if ($unico->idc09 <> "") {
                        $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc09", $unico->id_form1);
                        $datos .= "<strong>" . $NombreCampo . "</strong>: " . ($unico->idc09) . "<br>";
                    }

                    if ($unico->idc10 <> "") {
                        $NombreCampo = BeneficiosBuscaNombreCampoIdCampo("idc10", $unico->id_form1);
                        $datos .= "<strong>" . $NombreCampo . "</strong>: " . ($unico->idc10) . "<br>";
                    }


                    $row = str_replace("{DATOS}", utf8_encode($datos), $row);

                    $botones_validacionok = '<span class="badge badge-warning">PENDIENTE</span> ';

                    if ($unico->validacionok == '1') {
                        $botones_validacionok = '<span class="badge badge-success">VALIDADO</span> ';
                    }

                    if ($unico->validacionok == '3') {
                        $botones_validacionok = '<span class="badge badge-danger">RECHAZADO</span> ';
                    }


                    $botones_documentacionok = '<span class="badge badge-warning">PENDIENTE</span> ';

                    if ($unico->documentacionok == '1') {
                        $botones_documentacionok = '<span class="badge badge-success">VALIDADO</span> ';
                    }

                    if ($unico->documentacionok == '3') {
                        $botones_documentacionok = '<span class="badge badge-danger">RECHAZADO</span> ';
                    }


                    //$botones_documentacion.='<span class="badge badge-danger">RECHAZADO</span><br><br>';
                    $botones_documentacionBK .= '<br>
	<a href="?sw=beneficios_validacion&idenc=' . $id_enc . '&d=1&id=' . $idcategoria . '" 
	class="btn btn-success btn-sm" onclick="Valida' . $unico->id . '();">Validar</a>
	
	<br><br>
	
	<a href="?sw=beneficios_validacion&idenc=' . $id_enc . '&d=2&id=' . $idcategoria . '" 
	class="btn btn-danger btn-sm" onclick="Rechaza' . $unico->id . '();">Rechazar</a> 
	';


                    $botones_documentacion .= '<br>
	<a 
	class="btn btn-success btn-sm" onclick="Valida' . $unico->id . '();">Validar</a>
	
	<br><br>
	
	<a  
	class="btn btn-danger btn-sm" onclick="Rechaza' . $unico->id . '();">Rechazar</a> 
	';


                    $estado_final_beneficio = Beneficios_Busca_Estado($unico->id, $unico->tipo_workflow);


                    $row = str_replace("{DOCUMENTACION}", utf8_encode($documentacion), $row);
                    $row = str_replace("{VALIDACION_JEFE}", utf8_encode($botones_validacionok), $row);
                    $row = str_replace("{DOCUMENTACION_OK}", utf8_encode($estado_final_beneficio), $row);

                    $row = str_replace("{VALIDACION_FINAL}", utf8_encode($botones_documentacion), $row);
                    $total_html .= $row;
                }
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Beneficios", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '<a href="?sw=beneficios" class="btn btn-info">< Volver</a>', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                $html = str_replace("{ID_BENEFICIO}", $idcategoria, $html);

                return ($html);
            }

            function lista_becas_becas($html, $id_empresa, $id_tipo_beca)
            {
                $emb_olas = lista_becas_becas_data($id_empresa, $id_tipo_beca);
                //print_r($emb_olas);

                foreach ($emb_olas as $unico) { //  print_r($unico);
                    $row = file_get_contents("views/becas_becas/row_becas.html");
                    $row = str_replace("{ID}", utf8_encode($unico->tipo_beca), $row);
                    $row = str_replace("{NOMBRE}", utf8_encode($unico->nombre_beca), $row);
                    $row = str_replace("{POSTULANTES}", utf8_encode($unico->postulantes), $row);
                    $row = str_replace("{DOCUMENTACIONOK}", utf8_encode($unico->documentacionok), $row);
                    $row = str_replace("{DOCUMENTACIONNO}", utf8_encode($unico->documentacionno), $row);
                    $row = str_replace("{VALIDADOS}", utf8_encode($unico->validados), $row);
                    $row = str_replace("{RECHAZADOS}", utf8_encode($unico->rechazados), $row);
                    $total_html .= $row;
                }

                //print_r($total_html);

                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Becas", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function Lista_Busca_Cursos_historicos_admin($PRINCIPAL, $id_empresa, $rut)
            {
                $cursos_historicos = VistaCursosHistoricosData($rut, $id_empresa);
                // print_r($cursos_historicos);
                foreach ($cursos_historicos as $unico) {
                    if ($unico->estado == "APROBADO") {
                        $estado_curso = "<span class='label label-sm label-success'> Aprobado </span>";
                        $txt_estado = "APROBADO";
                    } elseif ($unico->estado <> "APROBADO" and $unico->avance2 > 0 and $unico->avance2 < 100) {
                        $txt_estado = "EN_PROCESO";
                        $estado_curso = "<span class='label label-sm label-warning'> En Proceso </span>";
                    } elseif ($unico->estado <> "APROBADO" and $unico->avance2 > 0 and $unico->avance2 < 100) {
                        $txt_estado = "EN_PROCESO";
                        $estado_curso = "<span class='label label-sm label-warning'> En Proceso </span>";
                    } else {
                        $txt_estado = "REPROBADO";
                        $estado_curso = "";
                    }
                    if ($unico->modalidad == "1") {
                        $modalidad = "Elearning";
                    } else {
                        $modalidad = "Presencial";
                    }
                    if ($unico->avance <> '') {
                        $avance = $unico->avance . "%";
                    } else {
                        if ($unico->avance2 <> '') {
                            $avance = $unico->avance2 . "%";
                        } else {
                            $avance = "-";
                        }
                    }
                    if ($unico->nota <> '') {
                        $nota = $unico->nota;
                    } else {
                        if ($unico->nota2 <> '') {
                            $nota = $unico->nota2;
                        } else {
                            $nota = "-";
                        }
                    }
                    //    <td>".utf8_encode($unico->id_inscripcion)."</td>
                    if ($txt_estado == "APROBADO") {
                        $rows .= "<tr>
    <td style='text-transform: uppercase;'>" . utf8_encode($unico->curso) . "</td>
    <td>" . utf8_encode($modalidad) . "</td>
    <td>" . utf8_encode($unico->fecha_inicio) . "</td>
    <td>" . utf8_encode($unico->fecha_termino) . "</td>
    <td>" . utf8_encode($estado_curso) . "</td>
    <td>" . utf8_encode($avance) . "</td>
    <td>" . utf8_encode($nota) . "</td>
    <td><center><input type='checkbox' name='" . $unico->id_inscripcion . "' value='" . $unico->id_inscripcion . "'></center></td>
</tr>";
                    } else if ($txt_estado == "EN_PROCESO") {
                        $rows .= "<tr>
    <td style='text-transform: uppercase;'>" . utf8_encode($unico->curso) . "</td>
    <td>" . utf8_encode($modalidad) . "</td>
    <td>" . utf8_encode($unico->fecha_inicio) . "</td>
    <td>" . utf8_encode($unico->fecha_termino) . "</td>
    <td>" . utf8_encode($estado_curso) . "</td>
    <td>" . utf8_encode($avance) . "</td>
    <td>" . utf8_encode($nota) . "</td>
    <td></td>
</tr>";
                    } else if ($txt_estado == "REPROBADO") {
                        $rows .= "<tr>
    <td style='text-transform: uppercase;'>" . utf8_encode($unico->curso) . "</td>
    <td >" . utf8_encode($modalidad) . "</td>
    <td>" . utf8_encode($unico->fecha_inicio) . "</td>
    <td>" . utf8_encode($unico->fecha_termino) . "</td>
    <td>" . utf8_encode($estado_curso) . "</td>
    <td>" . utf8_encode($avance) . "</td>
    <td>" . utf8_encode($nota) . "</td>
    <td></td>
</tr>";
                    }
                    // echo "$options";
                }
                return ($rows);
            }


            function lista_formacion_continua($html, $id_empresa, $idcategoria)
            {
                $lista_fc = lista_formacion_continua_data($id_empresa);
                foreach ($lista_fc as $unico) {
                    $row = file_get_contents("views/formacion_continua/row_formacioncontinua.html");
                    $row = str_replace("{ID}", utf8_encode($unico->id_postulable), $row);
                    $row = str_replace("{NOMBRE}", utf8_encode($unico->nombre), $row);
                    $row = str_replace("{DESCRIPCION}", utf8_encode($unico->descripcion), $row);
                    $row = str_replace("{DIMENSION}", utf8_encode($unico->dimension), $row);
                    $row = str_replace("{POSTULANTES}", utf8_encode($unico->postulantes), $row);
                    $row = str_replace("{JEFEOK}", utf8_encode($unico->jefeok), $row);
                    $row = str_replace("{JEFENOOK}", utf8_encode($unico->jefeno), $row);
                    $row = str_replace("{VALIDADOS}", utf8_encode($unico->validados), $row);
                    $row = str_replace("{RECHAZADOS}", utf8_encode($unico->rechazados), $row);
                    $total_html .= $row;
                }
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Formación Continua", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }


            function lista_eventos_gestion($html, $id_empresa, $id_dimension)
            {
                $lista_ev = lista_eventos_gestion_data($id_empresa, $id_dimension);
                foreach ($lista_ev as $unico) {
                    $row = file_get_contents("views/eventos/row_eventos_gestion.html");
                    $row = str_replace("{ID}", utf8_encode($unico->id), $row);
                    $row = str_replace("{ID_DIMENSION}", utf8_encode($unico->id_dimension), $row);
                    $row = str_replace("{CODIGO}", utf8_encode($unico->codigo), $row);
                    $row = str_replace("{NOMBRE}", utf8_encode($unico->nombre), $row);
                    $row = str_replace("{DESCRIPCION}", utf8_encode($unico->descripcion), $row);

                    $row = str_replace("{FECHA_INICIO}", utf8_encode($unico->fecha_inicio), $row);
                    $row = str_replace("{HORA_INICIO}", utf8_encode($unico->hora_inicio), $row);

                    $row = str_replace("{FECHA_TERMINO}", utf8_encode($unico->fecha_termino), $row);
                    $row = str_replace("{HORA_TERMINO}", utf8_encode($unico->hora_termino), $row);

                    $row = str_replace("{INSCRITOS}", utf8_encode($unico->postulantes), $row);
                    $row = str_replace("{VALIDADOS}", utf8_encode($unico->validados), $row);
                    $row = str_replace("{INVITACIONES}", utf8_encode($unico->invitaciones), $row);
                    $total_html .= $row;
                }
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Gestión de Eventos / Inscritos", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }


            function lista_Ext_Empresas_gestion($html, $id_empresa, $id_dimension)
            {
                $lista_ev = lista_Ext_Empresas_gestion_data($id_empresa, $id_dimension);


                //print_r($lista_ev);
                foreach ($lista_ev as $unico) {
                    $row = file_get_contents("views/ext_empresas/row_ext_empresas_gestion.html");


                    $row = str_replace("{ID}", utf8_encode($unico->id), $row);
                    $row = str_replace("{ID_DIMENSION}", utf8_encode($unico->id_dimension), $row);
                    $row = str_replace("{RUT}", utf8_encode($unico->rut), $row);
                    $row = str_replace("{NOMBRE}", utf8_encode($unico->nombre), $row);

                    $row = str_replace("{DOMINIO}", utf8_encode($unico->dominio), $row);
                    $row = str_replace("{MALLA}", utf8_encode($unico->malla), $row);

                    $row = str_replace("{DIVISION1}", utf8_encode($unico->division1), $row);
                    $row = str_replace("{DIVISION2}", utf8_encode($unico->division2), $row);
                    $row = str_replace("{DIVISION3}", utf8_encode($unico->division3), $row);
                    $row = str_replace("{DIVISION4}", utf8_encode($unico->division4), $row);

                    $row = str_replace("{SINDICATO1}", utf8_encode($unico->sindicato1), $row);
                    $row = str_replace("{SINDICATO2}", utf8_encode($unico->sindicato2), $row);
                    $row = str_replace("{SINDICATO3}", utf8_encode($unico->sindicato3), $row);
                    $row = str_replace("{SINDICATO4}", utf8_encode($unico->sindicato4), $row);

                    $proceso = $unico->inscritos - $unico->Suma4CNoInic - $unico->Suma4Cap100;

                    $row = str_replace("{INSCRITOS}", utf8_encode($unico->inscritos), $row);
                    $row = str_replace("{NO_INICIADOS}", utf8_encode($unico->Suma4CNoInic), $row);
                    $row = str_replace("{EN_PROCESOS}", utf8_encode($proceso), $row);
                    $row = str_replace("{FINALIZADOS}", utf8_encode($unico->Suma4Cap100), $row);

                    $total_html .= $row;
                }
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Lista de Empresas", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }


            function talent_procesa($id_empresa)
            {
                //echo "hola";
                $lista_fc = lista_talent_data($id_empresa);
                foreach ($lista_fc as $unico) {
                    //echo "<br> ".$unico->id_cargo;
                    //busca usuarios por cargo
                    $array_usuarios = Talent_id_cargo_busca_usuarios($unico->id_cargo, $id_empresa);
                    foreach ($array_usuarios as $unico_us) {
                        //echo "<br>... rut ".$unico_us->rut;
                        //echo "<br>... nivel ".$unico_us->nivel_esperado;
                        // cuenta preguntas por cargo y nivel esperado
                        $array_puntajes = Talent_preguntas_respuestas_puntos($unico_us->rut, $unico_us->nivel_esperado, $unico->id_cargo, $id_empresa);
                        foreach ($array_puntajes as $unico_pts) {
                            //echo "<pre>";
                            //print_r($unico_pts);
                            $id_skill = $unico_pts->id_skill;
                            $skill = $unico_pts->skill;
                            $id_cargo = $unico_pts->id_cargo;
                            $cargo = $unico_pts->cargo;
                            $id_nivel_esperado = $unico_pts->nivel_esperado;
                            $puntos = $unico_pts->SumaPuntos;
                            if ($puntos <= 1) {
                                $id_nivel = "0";
                                $nivel = "Skill no Desarrollada";
                            }
                            if ($puntos >= 2 and $puntos <= 6) {
                                $id_nivel = "1";
                                $nivel = "Básico";
                            }
                            if ($puntos >= 7 and $puntos <= 13) {
                                $id_nivel = "2";
                                $nivel = "Medio";
                            }
                            if ($puntos >= 14 and $puntos <= 18) {
                                $id_nivel = "3";
                                $nivel = "Experto";
                            }
                            if ($id_nivel_esperado == "1") {
                                $nivel_esperado = "Básico";
                            }
                            if ($id_nivel_esperado == "2") {
                                $nivel_esperado = "Medio";
                            }
                            if ($id_nivel_esperado == "3") {
                                $nivel_esperado = "Experto";
                            }
                            $ajuste = $id_nivel - $unico_pts->nivel_esperado;
                            $skill_esperado_basico = BuscaSkillEsperado("1", $id_skill, $id_cargo, $id_empresa);
                            $skill_esperado_medio = BuscaSkillEsperado("2", $id_skill, $id_cargo, $id_empresa);
                            $skill_esperado_experto = BuscaSkillEsperado("3", $id_skill, $id_cargo, $id_empresa);
                            $ajuste_basico = $id_nivel - $skill_esperado_basico;
                            $ajuste_medio = $id_nivel - $skill_esperado_medio;
                            $ajuste_experto = $id_nivel - $skill_esperado_experto;
                            InsertTblSkill_resultados($id_skill, $skill, $id_cargo, $cargo, $id_nivel_esperado, $nivel_esperado, $id_empresa, $puntos, $id_nivel, $nivel, $ajuste, $unico_us->rut, $skill_esperado_basico, $ajuste_basico, $skill_esperado_medio, $ajuste_medio, $skill_esperado_experto, $ajuste_experto);
                        }
                    }
                    //bnusca respuestas por rut cargo
                }
            }

            function lista_talent($html, $id_empresa, $idcategoria)
            {
                $lista_fc = lista_talent_data($id_empresa);
                foreach ($lista_fc as $unico) {
                    $row = file_get_contents("views/talent/row_talent.html");
                    $row = str_replace("{ID}", utf8_encode($unico->id_cargo), $row);
                    $row = str_replace("{CARGO}", utf8_encode($unico->cargo), $row);
                    $row = str_replace("{NIVEL_ESPERADO}", utf8_encode($unico->nivel_esperado), $row);
                    $row = str_replace("{POSTULANTES}", utf8_encode($unico->postulantes), $row);
                    $cuenta_respondidos = 0;
                    $CuentaRespuestas = Talent_buscarespuestas($unico->id_cargo, $unico->nivel_esperado, $id_empresa);
                    foreach ($CuentaRespuestas as $unicoRes) {
                        //echo "<br><br>";
                        //print_r($unicoRes);
                        if ($unicoRes->cuenta > 0) {
                            $cuenta_respondidos++;
                        }
                    }
                    $row = str_replace("{CONTESTADOS}", $cuenta_respondidos, $row);
                    $pendientes = $unico->postulantes - $cuenta_respondidos;
                    $row = str_replace("{PENDIENTES}", utf8_encode($pendientes), $row);
                    $total_html .= $row;
                }
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Talent Assessment Vista Cargos", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }


            function lista_audiencia($html, $id_empresa, $filtro_edit,
                                     $filtro1, $filtro2, $filtro3, $filtro4, $filtro5, $filtro6, $excluir, $incluir,
                                     $nombre_audiencia, $descripcion_audiencia, $campos_filtros, $id_audiencia, $reset, $filtro_creador, $filtro_mes_ano)
            {

                /*echo "<BR> $id_empresa, $filtro_edit,
$filtro1, $filtro2, $filtro3, $filtro4, $filtro5, $filtro6, $excluir, $incluir,
$nombre_audiencia, $descripcion_audiencia, $campos_filtros, $id_audiencia, $reset, $filtro_creador, $filtro_mes_ano";
*/
//echo "id_audiencia $id_audiencia";


                $array_Audiencia = BuscaDatosAudiencia($id_audiencia);
//print_r($array_Audiencia);

                $arreglo = MatrizIncentivos_Lista_campo_data("division", "area", "zona", "sucursal", "unidad_negocio", "cargo", $filtro1, $filtro2, $filtro3, $filtro4, $filtro5, $filtro6, $excluir, $incluir, $id_empresa);
                //echo "<pre>";print_r($arreglo);exit();

                foreach ($arreglo[1] as $unico) {
                    $row1 .= file_get_contents("views/incentivos/row_lista_checkbox.html");
                    $row1 = str_replace("{CAMPO}", ($unico->dato), $row1);
                    $row1 = str_replace("{ID}", "campo1_" . ($unico->dato), $row1);
                    if ($id_audiencia > 0) {
                        if (in_array($unico->dato, $filtro_edit[1])) {
                            $checked1 = "checked";
                        } else {
                            $checked1 = "";
                        }
                    } else {
                        if ($filtro1 <> "") {
                            $checked1 = "checked";
                        } else {
                            $checked1 = "";
                        }
                    }
                    $row1 = str_replace("{CHECKED}", $checked1, $row1);
                }

                foreach ($arreglo[2] as $unico) {
                    $row2 .= file_get_contents("views/incentivos/row_lista_checkbox.html");
                    $row2 = str_replace("{CAMPO}", ($unico->dato), $row2);
                    $row2 = str_replace("{ID}", "campo2_" . ($unico->dato), $row2);
                    if ($id_audiencia > 0) {
                        if (in_array($unico->dato, $filtro_edit[2])) {
                            $checked2 = "checked";
                        } else {
                            $checked2 = "";
                        }
                    } else {
                        if ($filtro2 <> "") {
                            $checked2 = "checked";
                        } else {
                            $checked2 = "";
                        }
                    }
                    $row2 = str_replace("{CHECKED}", $checked2, $row2);
                }

                foreach ($arreglo[3] as $unico) {
                    $row3 .= file_get_contents("views/incentivos/row_lista_checkbox.html");
                    $row3 = str_replace("{CAMPO}", ($unico->dato), $row3);
                    $row3 = str_replace("{ID}", "campo3_" . ($unico->dato), $row3);
                    if ($id_audiencia > 0) {
                        if (in_array($unico->dato, $filtro_edit[3])) {
                            $checked3 = "checked";
                        } else {
                            $checked3 = "";
                        }
                    } else {
                        if ($filtro3 <> "") {
                            $checked3 = "checked";
                        } else {
                            $checked3 = "";
                        }
                    }
                    $row3 = str_replace("{CHECKED}", $checked3, $row3);
                }

                foreach ($arreglo[4] as $unico) {
                    $row4 .= file_get_contents("views/incentivos/row_lista_checkbox.html");
                    $row4 = str_replace("{CAMPO}", ($unico->dato), $row4);
                    $row4 = str_replace("{ID}", "campo4_" . ($unico->dato), $row4);
                    if ($id_audiencia > 0) {
                        if (in_array($unico->dato, $filtro_edit[4])) {
                            $checked4 = "checked";
                        } else {
                            $checked4 = "";
                        }
                    } else {
                        if ($filtro4 <> "") {
                            $checked4 = "checked";
                        } else {
                            $checked4 = "";
                        }
                    }
                    $row4 = str_replace("{CHECKED}", $checked4, $row4);
                }

                foreach ($arreglo[5] as $unico) {
                    $row5 .= file_get_contents("views/incentivos/row_lista_checkbox.html");
                    $row5 = str_replace("{CAMPO}", ($unico->dato), $row5);
                    $row5 = str_replace("{ID}", "campo5_" . ($unico->dato), $row5);
                    if ($id_audiencia > 0) {
                        if (in_array($unico->dato, $filtro_edit[5])) {
                            $checked5 = "checked";
                        } else {
                            $checked5 = "";
                        }
                    } else {
                        if ($filtro5 <> "") {
                            $checked5 = "checked";
                        } else {
                            $checked5 = "";
                        }
                    }
                    $row5 = str_replace("{CHECKED}", $checked5, $row5);
                }

                foreach ($arreglo[6] as $unico) {
                    $row6 .= file_get_contents("views/incentivos/row_lista_checkbox.html");
                    $row6 = str_replace("{CAMPO}", ($unico->dato), $row6);
                    $row6 = str_replace("{ID}", "campo6_" . ($unico->dato), $row6);


                    //echo "filtro 6, id audiencia $id_audiencia, print filtro edit 6  ". print_r($filtro_edit[6]);

                    if ($id_audiencia > 0) {
                        if (in_array($unico->dato, $filtro_edit[6])) {
                            $checked6 = "checked";
                        } else {
                            $checked6 = "";
                        }
                    } else {
                        if ($filtro6 <> "") {
                            $checked6 = "checked";
                        } else {
                            $checked6 = "";
                        }
                    }
                    $row6 = str_replace("{CHECKED}", $checked6, $row6);
                }
                //echo "<br>Numero ".$arreglo[5];//echo "<br>Usuario ".$arreglo[6];//echo "<br>Sql ".$arreglo[7];

                if ($nombre_audiencia <> "" and $arreglo[9] <> "" and $descripcion_audiencia <> "") {
                    //echo "<sql> ".$arreglo[7];	//echo "<br>Encodear3 ".Encodear3($arreglo[7]);	//echo "zbr>Descodear3 ".Decodear3(Encodear3($arreglo[7]));
                    Audiencia_Save_NuevaAudiencia($nombre_audiencia, $descripcion_audiencia, $id_empresa, Encodear3($arreglo[9]), $excluir, $incluir, $campos_filtros, $id_audiencia);

                    if ($id_audiencia > 0) {
                        echo "<script>alert('Audiencia Actualizada');</script>";
                        echo "<script>location.href='?sw=lista_audiencias&reset=1';    </script>";

                    } else {
                        echo "<script>alert('Audiencia Registrada');</script>";
                        echo "<script>location.href='?sw=lista_audiencias&reset=1';    </script>";
                    }
                }

                if ($nombre_audiencia == "") {
                    $nombre_audiencia = $array_Audiencia[0]->nombre;
                }
                if ($descripcion_audiencia == "") {
                    $descripcion_audiencia = $array_Audiencia[0]->descripcion;
                }

//echo "<br>excluir $excluir. POST ".$array_Audiencia[0]->excluir;
//echo "<br>incluir $incluir. POST ".$array_Audiencia[0]->incluir;

                if ($excluir == "") {
                    $excluir = $array_Audiencia[0]->excluir;
                }
                if ($incluir == "") {
                    $incluir = $array_Audiencia[0]->incluir;
                }

//echo "<br>excluir $excluir. POST ".$array_Audiencia[0]->excluir;
//echo "<br>incluir $incluir. POST ".$array_Audiencia[0]->incluir;

                $html = str_replace("{NUMERO_PERSONAS}", $arreglo[7], $html);
                $html = str_replace("{EXCLUIR}", $excluir, $html);
                $html = str_replace("{INCLUIR}", $incluir, $html);
                $html = str_replace("{NOMBRE_AUDIENCIA}", $nombre_audiencia, $html);
                $html = str_replace("{DESCRIPCION_AUDIENCIA}", $descripcion_audiencia, $html);

                $lista_fc = lista_audiencia_data($id_empresa, $filtro_creador, $filtro_mes_ano);
                foreach ($lista_fc as $unico) {

                    //echo "<br>";
                    //print_r($unico);
                    //echo "<br>";

                    $campos_filtros_data = "";

                    $campos_filtros_data = $unico->campos_filtros;


                    $num_colaboradores = Cuenta_Audiencia_Sql(Decodear3($unico->sqlquery), $unico->id, $id_empresa);

                    if ($_SESSION["admin_"] == "control_gestion" or $unico->no_editable == "1") {
                        $row = file_get_contents("views/incentivos/row_audienciat_read.html");
                    } else {
                        $row = file_get_contents("views/incentivos/row_audienciat.html");
                    }

                    $row = str_replace("{ID_AUDIENCIA}", utf8_encode($unico->id), $row);
                    $row = str_replace("{NOMBRE_AUDIENCIA}", utf8_encode($unico->nombre), $row);
                    $row = str_replace("{DESCRIPCION_AUDIENCIA}", utf8_encode($unico->descripcion), $row);
                    $row = str_replace("{FILTRO}", ($campos_filtros_data), $row);

                    $row = str_replace("{SQLQUERY}", ($unico->sqlquery), $row);
                    $row = str_replace("{SQLQUERY_DEC}", (Decodear3($unico->sqlquery)), $row);
                    $row = str_replace("{EXCLUSION}", ($unico->excluir), $row);
                    $row = str_replace("{INCLUSION}", ($unico->incluir), $row);

                    $row = str_replace("{CREADOR}", ($unico->autor), $row);
                    $row = str_replace("{FECHA_CREACION}", ($unico->fecha_creacion), $row);


                    $row = str_replace("{FORMULARIO_EDITAR}", "
					
					<form name='form_" . $unico->id . "' id='form_" . $unico->id . "' action='?sw=lista_audiencias&id_audiencia=" . Encodear3($unico->id) . "&filt_enc=" . ($unico->campos_filtros_enc) . "' method='post'>
						<input type='submit' class='btn btn-link flat' value='Editar Audiencia' style='margin-top: 0px;margin-right: 10px;  font-size: 10px; display: inline-flex;'>
					</form>
					
					", $row);
                    $row = str_replace("{ELIMINA}", "
					<a href='?sw=lista_audiencias&delaudiencia=1&ida=" . Encodear3($unico->id) . "' 
					class='btn btn-link' style='font-size: 12px;' onclick='return confirm(\"Estas seguro de eliminar la Audiencia\")'>
					<small>Eliminar</small></a>", $row);


                    $row = str_replace("{DESCARGAR_USUARIOS}", "
					
					<form name='form_" . $unico->id . "2' id='form_" . $unico->id . "2' action='?sw=FC_Descarga_Audiencia' method='post'>
					
					<input type='hidden' id='sqlquery' name='sqlquery' value='" . $unico->sqlquery . "'>
					<input type='submit' class='btn btn-link flat' value='Descargar Usuarios Audiencia' style='margin-top: 0px;margin-right: 10px;  font-size: 10px; display: inline-flex;'>
					</form>
					
					", $row);


                    $row = str_replace("{NUM_COLABORADORES}", $num_colaboradores, $row);
                    $row = str_replace("{DESCARGA_EXCEL}", $unico->sqlquery, $row);
                    $total_html .= $row;


                }

                ///print_r($row5);

                $html = str_replace("{VISTA_AGRUPACION_CAMPO1}", $row1, $html);
                $html = str_replace("{VISTA_AGRUPACION_CAMPO2}", $row2, $html);
                $html = str_replace("{VISTA_AGRUPACION_CAMPO3}", $row3, $html);
                $html = str_replace("{VISTA_AGRUPACION_CAMPO4}", $row4, $html);
                $html = str_replace("{VISTA_AGRUPACION_CAMPO5}", $row5, $html);
                $html = str_replace("{VISTA_AGRUPACION_CAMPO6}", $row6, $html);

                //echo "reset $reset funciones";
                if ($reset == 1) {

                    $campos_filtros = "";

                }
                //echo "campos_filtros $campos_filtros";

                $html = str_replace("{CADENA_FILTRO}", $campos_filtros, $html);
                $html = str_replace("{ID_AUDIENCIA_EDIT}", $id_audiencia, $html);

                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Lista de Audiencias", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);

                return ($html);
            }

            function lista_notificaciones_creacion_fn($html, $id_empresa, $idcategoria, $filtro1, $filtro2, $filtro3, $filtro4, $filtro5, $filtro6, $excluir, $nombre_audiencia, $descripcion_audiencia, $campos_filtros, $id_documento, $filtro_creador, $filtro_mes_ano)
            {


                $html = str_replace("{NUMERO_PERSONAS}", $arreglo[7], $html);
                $html = str_replace("{EXCLUIR}", $excluir, $html);
                $html = str_replace("{NOMBRE_AUDIENCIA}", $nombre_audiencia, $html);
                $html = str_replace("{DESCRIPCION_AUDIENCIA}", $descripcion_audiencia, $html);

                $lista_fc = lista_notificaciones_creacion_data($id_empresa, $filtro_creador, $filtro_mes_ano);
                foreach ($lista_fc as $unico) {

                    $row = file_get_contents("views/incentivos/row_notificaciones_creacion.html");
                    $row = str_replace("{ASUNTO}", utf8_encode($unico->asunto), $row);
                    $row = str_replace("{TITULO}", utf8_encode($unico->titulo), $row);
                    $row = str_replace("{TEXTO}", utf8_encode($unico->texto), $row);
                    $row = str_replace("{FECHA}", ($unico->fecha), $row);
                    $row = str_replace("{ID_NOTIFICACION}", ($unico->id), $row);
                    $row = str_replace("{CREADOR}", ($unico->autor), $row);
                    $row = str_replace("{FECHA_CREACION}", ($unico->fecha_creacion), $row);
                    $row = str_replace("{FORMULARIO_EDITAR}", "
					
					
					
					
					<form name='form_" . $unico->id . ">
						<input type='text' name='id_audiencia' id='id_audiencia' value='" . $unico->id . "'>
						<input type='submit' class='btn btn-primary btn-sm pull-right flat' value='Editar Notificaciones' style='margin-top: 10px;margin-right: 10px;font-size: 14px; width: 150px;'>
					</form>
					
					", $row);

                    $total_html .= $row;
                }

                ///print_r($row5);

                $html = str_replace("{VISTA_AGRUPACION_CAMPO1}", $row1, $html);
                $html = str_replace("{VISTA_AGRUPACION_CAMPO2}", $row2, $html);
                $html = str_replace("{VISTA_AGRUPACION_CAMPO3}", $row3, $html);
                $html = str_replace("{VISTA_AGRUPACION_CAMPO4}", $row4, $html);
                $html = str_replace("{VISTA_AGRUPACION_CAMPO5}", $row5, $html);
                $html = str_replace("{VISTA_AGRUPACION_CAMPO6}", $row6, $html);

                $html = str_replace("{CADENA_FILTRO}", $campos_filtros, $html);
                $html = str_replace("{ID_AUDIENCIA_EDIT}", $id_audiencia, $html);

                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Lista de Tipos de Notificaciones", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);

                return ($html);
            }


            function lista_documentos_fn($html, $id_empresa, $idcategoria, $filtro1, $filtro2, $filtro3, $filtro4, $filtro5, $filtro6, $excluir, $nombre_audiencia, $descripcion_audiencia, $campos_filtros, $id_documento, $filtro_creador, $filtro_mes_ano)
            {


                $html = str_replace("{NUMERO_PERSONAS}", $arreglo[7], $html);
                $html = str_replace("{EXCLUIR}", $excluir, $html);
                $html = str_replace("{NOMBRE_AUDIENCIA}", $nombre_audiencia, $html);
                $html = str_replace("{DESCRIPCION_AUDIENCIA}", $descripcion_audiencia, $html);

                $lista_fc = lista_documentos_data($id_empresa, $filtro_creador, $filtro_mes_ano);
                foreach ($lista_fc as $unico) {


                    $num_colaboradores = Audiencia_Sql(Decodear3($unico->sqlquery));

                    if ($_SESSION["admin_"] == "control_gestion") {

                        $row = file_get_contents("views/incentivos/row_documentos_read.html");


                    } else {

                        $row = file_get_contents("views/incentivos/row_documentos.html");

                    }
                    $row = str_replace("{NOMBRE_DOCUMENTO}", utf8_encode($unico->nombre), $row);
                    $row = str_replace("{DESCRIPCION_DOCUMENTO}", utf8_encode($unico->descripcion), $row);
                    $row = str_replace("{FILENAME}", ($unico->filename), $row);
                    $row = str_replace("{FILENAME_ENC}", "docs/" . ($unico->filename_enc), $row);
                    $row = str_replace("{FECHA}", ($unico->fecha), $row);
                    $row = str_replace("{ID_DOC}", ($unico->id), $row);
                    $row = str_replace("{CREADOR}", ($unico->autor), $row);
                    $row = str_replace("{FECHA_CREACION}", ($unico->fecha_creacion), $row);


                    $row = str_replace("{FORMULARIO_EDITAR}", "
					
					
					
					
					<form name='form_" . $unico->id . ">
						<input type='text' name='id_audiencia' id='id_audiencia' value='" . $unico->id . "'>
						<input type='submit' class='btn btn-primary btn-sm pull-right flat' value='Editar Audiencia' style='margin-top: 10px;margin-right: 10px;font-size: 14px; width: 150px;'>
					</form>
					
					", $row);

                    $total_html .= $row;
                }

                ///print_r($row5);

                $html = str_replace("{VISTA_AGRUPACION_CAMPO1}", $row1, $html);
                $html = str_replace("{VISTA_AGRUPACION_CAMPO2}", $row2, $html);
                $html = str_replace("{VISTA_AGRUPACION_CAMPO3}", $row3, $html);
                $html = str_replace("{VISTA_AGRUPACION_CAMPO4}", $row4, $html);
                $html = str_replace("{VISTA_AGRUPACION_CAMPO5}", $row5, $html);
                $html = str_replace("{VISTA_AGRUPACION_CAMPO6}", $row6, $html);

                $html = str_replace("{CADENA_FILTRO}", $campos_filtros, $html);
                $html = str_replace("{ID_AUDIENCIA_EDIT}", $id_audiencia, $html);

                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Lista de Documentos", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);

                return ($html);
            }

            function lista_noti_fn($html, $id_empresa, $idcategoria, $filtro1, $filtro2, $filtro3, $filtro4, $filtro5, $filtro6, $excluir, $nombre_audiencia, $descripcion_audiencia, $campos_filtros, $id_documento)
            {

                $html = str_replace("{NUMERO_PERSONAS}", $arreglo[7], $html);
                $html = str_replace("{EXCLUIR}", $excluir, $html);
                $html = str_replace("{NOMBRE_AUDIENCIA}", $nombre_audiencia, $html);
                $html = str_replace("{DESCRIPCION_AUDIENCIA}", $descripcion_audiencia, $html);


//TIPOS DE NOTIFICACIONES

                $array_noti = lista_notificaciones_creacion_options_data($id_empresa, $filtro_creador, $filtro_mes_ano);

                foreach ($array_noti as $unico) {
                    $options_notificaciones .= "<option value='" . $unico->id . "'>" . utf8_encode($unico->titulo) . "</option>";
                }


                $lista_fc = lista_noti_fns_data($id_empresa);
                //print_r($lista_fc);

                foreach ($lista_fc as $unico) {


                    $row = file_get_contents("views/incentivos/row_notificaciones.html");
                    $row = str_replace("{ID_ENC}", Encodear3($unico->id), $row);

                    $row = str_replace("{ID_PUBLICACION}", ($unico->id), $row);
                    $row = str_replace("{OPTIONS_TIPO_NOTIFICACIONES}", ($options_notificaciones), $row);

                    $row = str_replace("{NOMBRE_PUBLICACION}", utf8_encode($unico->nombre), $row);
                    $row = str_replace("{DESCRIPCION_PUBLICACION}", utf8_encode($unico->descripcion), $row);
                    $row = str_replace("{FECHA_INICIO}", ($unico->fecha_inicio), $row);
                    $row = str_replace("{FECHA_TERMINO}", ($unico->fecha_termino), $row);

                    $row = str_replace("{DOCUMENTO}", utf8_encode($unico->documento), $row);
                    $row = str_replace("{TEXTO_ADICIONAL}", utf8_encode($unico->texto_adicional), $row);
                    $no_envios = $unico->num_colaboradores - $unico->num_notificaciones;
                    if ($no_envios < 0) {
                        $no_envios = 0;
                    }

                    $row = str_replace("{NUM_COLABORADORES}", utf8_encode($unico->num_colaboradores), $row);
                    $row = str_replace("{NUM_ENVIOS}", utf8_encode($unico->num_notificaciones), $row);
                    $row = str_replace("{NUM_POR_ENVIAR}", utf8_encode($no_envios), $row);

                    if ($no_envios > 0) {
                        $boton_enviar = "	

<input type='hidden' id='id_publicacion' name='id_publicacion' value='" . Encodear3($unico->id) . "'>
<input type='submit' value='Enviar' class='btn btn-info'>

			";
                    } else {

                        $boton_enviar = "	<small>[ NOTIFICACIONES ENVIADAS ]</small>
					";
                    }
                    $row = str_replace("{ID_PUBLICACION}", utf8_encode($unico->id), $row);
                    $row = str_replace("{BOTON_ENVIAR}", $boton_enviar, $row);

                    $total_html .= $row;
                }

                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Notificaciones", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);

                return ($html);
            }

            function lista_publicaciones_fn($html, $id_empresa, $idcategoria, $filtro1, $filtro2, $filtro3, $filtro4, $filtro5, $filtro6, $excluir, $nombre_audiencia, $descripcion_audiencia, $campos_filtros, $id_documento, $filtro_categoria, $perfil_admin, $nombre_perfil_admin, $filtro_temporalidad, $filtro_creador, $filtro_mes_ano)
            {

                $html = str_replace("{NUMERO_PERSONAS}", $arreglo[7], $html);
                $html = str_replace("{EXCLUIR}", $excluir, $html);
                $html = str_replace("{NOMBRE_AUDIENCIA}", $nombre_audiencia, $html);
                $html = str_replace("{DESCRIPCION_AUDIENCIA}", $descripcion_audiencia, $html);


                if ($perfil_admin == "113") {
                    $lista_fc = lista_publicaciones_fns_categoria_data($filtro_categoria, $nombre_perfil_admin, $id_empresa, $filtro_temporalidad, $filtro_creador, $filtro_mes_ano);
                } else {
                    $lista_fc = lista_publicaciones_fns_categoria_data($filtro_categoria, "", $id_empresa, $filtro_temporalidad, $filtro_creador, $filtro_mes_ano);
                }
                //print_r($lista_fc);

                foreach ($lista_fc as $unico) {
                    //$num_colaboradores=Audiencia_Sql(Decodear3($unico->sqlquery));

                    if ($perfil_admin == "113") {
                        $row = file_get_contents("views/incentivos/row_publicaciones_read.html");
                    } else {
                        $row = file_get_contents("views/incentivos/row_publicaciones.html");
                    }


                    $row = str_replace("{NOMBRE_PUBLICACION}", utf8_encode($unico->nombre), $row);
                    $row = str_replace("{DESCRIPCION_PUBLICACION}", utf8_encode($unico->descripcion), $row);
                    $row = str_replace("{FECHA_INICIO}", ($unico->fecha_inicio), $row);
                    $row = str_replace("{FECHA_TERMINO}", ($unico->fecha_termino), $row);
                    $row = str_replace("{CATEGORIA}", ($unico->agrupacion), $row);
                    $row = str_replace("{NEGOCIO}", utf8_encode($unico->nombre_negocio), $row);


                    if ($unico->perfil == "") {
                        $perfil = "TODOS";
                    } else {
                        $perfil = $unico->perfil;
                    }

                    $row = str_replace("{PERFIL}", utf8_encode($perfil), $row);
                    $row = str_replace("{DOCUMENTO}", utf8_encode($unico->documento), $row);
                    $row = str_replace("{AUDIENCIA}", utf8_encode($unico->audiencia), $row);
                    $row = str_replace("{ID_PUBLICACION}", utf8_encode($unico->id), $row);

                    $row = str_replace("{CREADOR}", utf8_encode($unico->autor), $row);
                    $row = str_replace("{FECHA_CREACION}", utf8_encode($unico->fecha_creacion), $row);

                    $row = str_replace("{VERDOCUMENTO_AUDIENCIA}", "




<a href='docs/" . $unico->filename_enc . "' class='btn btn-info  btn-sm' target='_blank' style='margin-top: 10px;margin-right: 10px;font-size: 12px; '>Ver Documento</a>

<BR><BR>

<a href='?sw=FC_Descarga_Audiencia&amp;sql=" . $unico->sqlquery . "' class='btn btn-info btn-sm' style='margin-top: 10px;'>Descargar Colaboradores</a>"

                        , $row);

                    $row = str_replace("{FORMULARIO_EDITAR}", "
					
					
					
					
					<form name='form_" . $unico->id . ">
						<input type='text' name='id_audiencia' id='id_audiencia' value='" . $unico->id . "'>
						<input type='submit' class='btn btn-primary btn-sm pull-right flat' value='Editar Publicacion' style='margin-top: 10px;margin-right: 10px;font-size: 14px; width: 150px;'>
					</form>
					
					", $row);

                    $total_html .= $row;


                }

                $html = str_replace("{VISTA_AGRUPACION_CAMPO1}", $row1, $html);
                $html = str_replace("{VISTA_AGRUPACION_CAMPO2}", $row2, $html);
                $html = str_replace("{VISTA_AGRUPACION_CAMPO3}", $row3, $html);
                $html = str_replace("{VISTA_AGRUPACION_CAMPO4}", $row4, $html);
                $html = str_replace("{VISTA_AGRUPACION_CAMPO5}", $row5, $html);
                $html = str_replace("{VISTA_AGRUPACION_CAMPO6}", $row6, $html);

                $html = str_replace("{CADENA_FILTRO}", $campos_filtros, $html);
                $html = str_replace("{ID_AUDIENCIA_EDIT}", $id_audiencia, $html);


                $data_negocio = lista_negocios_data($id_empresa);
                $option_negocio .= " <option value=''></option>";
                foreach ($data_negocio as $unique1) {
                    $option_negocio .= " <option value='" . $unique1->id . "'>" . utf8_encode($unique1->negocio) . "</option>";
                }


                $data_documentos = lista_documentos_data($id_empresa);
                $option_documentos .= " <option value=''></option>";
                foreach ($data_documentos as $unique1) {
                    $option_documentos .= " <option value='" . $unique1->id . "'>" . utf8_encode($unique1->nombre) . "</option>";
                }


                $YEAR_ACTUAL = date("Y");
                $data_documentos = lista_documentos_data_tipoYear($id_empresa, "", "", $YEAR_ACTUAL, "yearactual");
                $option_documentos_year_actual .= " <option value=''></option>";
                foreach ($data_documentos as $unique1) {
                    $option_documentos_year_actual .= " <option value='" . $unique1->id . "'>" . utf8_encode($unique1->nombre) . "</option>";
                }


                $data_documentos = lista_documentos_data_tipoYear($id_empresa, "", "", $YEAR_ACTUAL, "NOT_yearactual");
                $option_documentos_historicos .= " <option value=''></option>";
                foreach ($data_documentos as $unique1) {
                    $option_documentos_historicos .= " <option value='" . $unique1->id . "'>" . utf8_encode($unique1->nombre) . "</option>";
                }


                $data_audiencia = AUDIENCIA_TotalAudienciasPorempresaOrderDesc($id_empresa);
                $option_audiencia .= " <option value=''></option>";
                foreach ($data_audiencia as $unique1) {
                    $option_audiencia .= " <option value='" . $unique1->id . "'>" . utf8_encode($unique1->nombre) . "</option>";
                }


                $html = str_replace("{SELECT_OPTION_DOCUMENTO}", $option_documentos, $html);

                $html = str_replace("{SELECT_OPTION_DOCUMENTO_YEAR_ACTUAL}", $option_documentos_year_actual, $html);
                $html = str_replace("{SELECT_OPTION_DOCUMENTO_historicos}", $option_documentos_historicos, $html);

                $html = str_replace("{SELECT_OPTION_NEGOCIO}", $option_negocio, $html);


                $html = str_replace("{SELECT_OPTION_AUDIENCIA}", $option_audiencia, $html);

                $html = str_replace("{FILTRO_CATEGORIA}", ($filtro_categoria), $html);


                $html = str_replace("{LISTA_READ}", $total_html, $html);


                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Publicaciones", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);

                return ($html);
            }

            function lista_certificacionT($html, $id_empresa, $idcategoria)
            {
                $lista_fc = lista_certificacionT_data($id_empresa);
                foreach ($lista_fc as $unico) {

                    $row = file_get_contents("views/capacitacion/certificacionT/row_certificaciones.html");
                    $row = str_replace("{NOMBRE_CURSO}", utf8_encode($unico->nombre_curso), $row);
                    $row = str_replace("{ID_CURSO}", utf8_encode($unico->id_curso), $row);
                    $row = str_replace("{CODIGO_INSCRIPCION}", utf8_encode($unico->codigo_inscripcion), $row);
                    $row = str_replace("{FECHA_INICIO}", utf8_encode($unico->fecha_inicio), $row);
                    $row = str_replace("{FECHA_TERMINO}", utf8_encode($unico->fecha_termino), $row);
                    $row = str_replace("{INSCRITOS}", utf8_encode($unico->Inscritos), $row);
                    $row = str_replace("{NOTA}", utf8_encode($unico->nota_reporte), $row);

                    $realizados = 0;
                    $aprobados = 0;
                    $reprobados = 0;
                    $en_proceso = 0;
                    $reprobados_inasistencia = 0;
                    $inconsistencias = 0;
                    //SI FECHA HOY ES IGUAL O MAYOR A FECHA INICIO
                    $hoy = date("Y-m-d");
                    //echo "<br>hoy $hoy, fecha inicio ".$unico->fecha_inicio;

                    if ($unico->fecha_inicio > $hoy) {
                        //echo "......OK";
                    }

                    if ($unico->fecha_inicio <= $hoy) {

                        $array_Agrupado = Agrupado_certificacionT_data($unico->codigo_inscripcion, $unico->id_curso, $id_empresa);

                        foreach ($array_Agrupado as $unicoRes) {

                            if ($unicoRes->cuenta_usuarios_respuestas > 0 or $unicoRes->cuenta_usuarios_respuestas_intentos > 0) {

                            }
                            if ($realizados > $unico->Inscritos) {
                                $realizados = $unico->Inscritos;
                            }

                            if ($unicoRes->ESTADO_inscripcion_cierre_finalizado == 'APROBADO') {
                                $aprobados++;
                                $realizados++;
                            }

                            if ($unicoRes->ESTADO_inscripcion_cierre_finalizado == 'REPROBADO' and $unicoRes->cuenta_inscripcion_cierre_finalizado > 0) {
                                $reprobados++;
                                $realizados++;
                            }

                            if ($unicoRes->ESTADO_inscripcion_cierre_finalizado == 'EN_PROCESO') {
                                $en_proceso++;
                                $inconsistencias++;
                                $realizados++;
                                // ACTUALIZA LMS REPORTES
                            }

                            if (($unicoRes->cuenta_usuarios_respuestas == 0 and $unicoRes->cuenta_usuarios_respuestas_intentos == 0) or $unicoRes->cuenta_inscripcion_cierre_finalizado == 0) {
                                $reprobados_inasistencia++;
                                // ACTUALIZA LMS REPORTES
                            }


                            if ($unicoRes->cuenta_inscripcion_cierre_finalizado == 0 and $unicoRes->cuenta_inscripcion_cierre_proceso == 0
                                and ($unicoRes->cuenta_usuarios_respuestas > 0 or $unicoRes->cuenta_usuarios_respuestas_intentos > 0)

                            ) {
                                //$inconsistencias++;

                            }


                            if ($unicoRes->cuenta_lms_reportes == 0
                                and $unicoRes->cuenta_inscripcion_cierre_proceso == 0
                                and ($unicoRes->cuenta_inscripcion_cierre_finalizado == 1 or $unicoRes->cuenta_inscripcion_cierre_proceso == 1)

                            ) {
                                $inconsistencias++;

                            }


                            if ($unicoRes->nota_reporte > 0 and ($aprobados + $reprobados + $reprobados_inasistencia + $en_proceso) == 0) {

                                $inconsistencias++;
                            }

                        }
                        $comprobacion = $unico->Inscritos - ($aprobados + $reprobados + $reprobados_inasistencia + $en_proceso);
                        if ($comprobacion > 0) {
                            $inconsistencias++;
                        }
                    }
                    $realizadoReal = $aprobados + $reprobados;


                    $row = str_replace("{REALIZADOS}", $realizadoReal, $row);
                    $row = str_replace("{APROBADOS}", $aprobados, $row);
                    $row = str_replace("{REPROBADOS}", $reprobados, $row);
                    $row = str_replace("{REPROBADOS_INASISTENCIA}", $reprobados_inasistencia, $row);
                    $row = str_replace("{PENDIENTES}", $en_proceso, $row);

                    $row = str_replace("{INCONSISTENCIA}", $inconsistencias, $row);


                    $pendientes = $unico->postulantes - $cuenta_respondidos;
                    $row = str_replace("{PENDIENTES}", utf8_encode($pendientes), $row);
                    $total_html .= $row;
                }
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Certificaciones", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_clima_Seguimiento($html, $id_empresa, $filtro)
            {

                Clima_Actualiza_id_tipo_gerencia($id_empresa);

                //echo "<br> lista_clima_Seguimiento id_empresa $id_empresa";
                $lista_fc = lista_clima_seguimiento_data($id_empresa, $filtro);
                $porcentaje_total = round(100 * $lista_fc[0]->CuentaClima / $lista_fc[0]->CuentaTotal);
                $html = str_replace("{AVANCE_CLIMA}", $porcentaje_total, $html);
                $html = str_replace("{CONTESTADO_CLIMA}", $lista_fc[0]->CuentaClima, $html);
                $html = str_replace("{PENDIENTES_CLIMA}", ($lista_fc[0]->CuentaTotal - $lista_fc[0]->CuentaClima), $html);
                $lista_fcg = lista_clima_seguimiento_gerencia_data($id_empresa, $filtro);
//print_r($lista_fcg);
                foreach ($lista_fcg as $unico) {
                    //echo "<br><br>linea unico<br>";print_r($unico);
                    $Cuenta_array = lista_clima_seguimiento_gerencia_Detalle_data($id_empresa, $unico->gerencia);
                    //echo "<br>gerencia ".utf8_encode($unico->gerencia);
                    //print_r($Cuenta_array);
                    $row = file_get_contents("views/clima/row_clima_seguimiento.html");
                    $row = str_replace("{GERENCIA_CLIMA}", utf8_encode($unico->gerencia), $row);
                    $pendientes = ($unico->cuenta) - ($Cuenta_array[0]->cuenta);
                    $avance = round(100 * $Cuenta_array[0]->cuenta / $unico->cuenta);
                    $row = str_replace("{REALIZADOS_CLIMA}", utf8_encode($Cuenta_array[0]->cuenta), $row);
                    $row = str_replace("{PENDIENTES_CLIMA}", utf8_encode($pendientes), $row);
                    $row = str_replace("{AVANCE_CLIMA}", utf8_encode($avance), $row);
                    $total_html .= $row;
                }
//print_r($lista_fcg);
                $html = str_replace("{TODOS}", $porcentaje_total, $html);
                $html = str_replace("{INDUCCION}", $porcentaje_induccion, $html);
                $html = str_replace("{FASE1}", $porcentaje_fase1, $html);
                $html = str_replace("{FASE2}", $porcentaje_fase2, $html);
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Seguimiento Clima", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_clima_Reportes($html, $id_empresa, $filtro1, $filtro2, $filtro3)
            {

                $lista_fc = lista_clima_reportes_data($id_empresa, $filtro1, $filtro2, $filtro3);//print_r($lista_fc);
                $total = $lista_fc[0]->positivo + $lista_fc[0]->negativo + $lista_fc[0]->neutro;
                $resultado_positivo_basecien = round(100 * $lista_fc[0]->positivo / $total);
                $resultado_negativo_basecien = round(100 * $lista_fc[0]->negativo / $total);
                $resultado_neutro_basecien = round(100 * $lista_fc[0]->neutro / $total);
                $html = str_replace("{RESULTADO_POSITIVO_BASE_100}", $resultado_positivo_basecien, $html);
                $html = str_replace("{RESULTADO_NEGATIVO_BASE_100}", $resultado_negativo_basecien, $html);
                $html = str_replace("{RESULTADO_NEUTRO_BASE_100}", $resultado_neutro_basecien, $html);
                $html = str_replace("{REALIZADOS}", $lista_fc[0]->realizados, $html);
                $html = str_replace("{TOTAL_POSIBLES}", $lista_fc[0]->posibles, $html);
                $html = str_replace("{PORCENTAJE_RESPUESTA}", round(100 * $lista_fc[0]->realizados / $lista_fc[0]->posibles), $html);


// GENERO    M
                $html = str_replace("{F}", round(100 * $lista_fc[0]->positivoF / $lista_fc[0]->todosF), $html);
                $html = str_replace("{NUMF}", round($lista_fc[0]->todosFR), $html);
                $html = str_replace("{M}", round(100 * $lista_fc[0]->positivoM / $lista_fc[0]->todosM), $html);
                $html = str_replace("{NUMM}", round($lista_fc[0]->todosMR), $html);


// RANGO EDAD     25,2535,3545,4555,55
                $html = str_replace("{R25}", round(100 * $lista_fc[0]->positivo25 / $lista_fc[0]->todos25), $html);
                $html = str_replace("{NUMR25}", round($lista_fc[0]->todos25R), $html);
                $html = str_replace("{R2535}", round(100 * $lista_fc[0]->positivo2535 / $lista_fc[0]->todos2535), $html);
                $html = str_replace("{NUMR2535}", round($lista_fc[0]->todos2535R), $html);
                $html = str_replace("{R3545}", round(100 * $lista_fc[0]->positivo3545 / $lista_fc[0]->todos3545), $html);
                $html = str_replace("{NUMR3545}", round($lista_fc[0]->todos3545R), $html);
                $html = str_replace("{R4555}", round(100 * $lista_fc[0]->positivo4555 / $lista_fc[0]->todos4555), $html);
                $html = str_replace("{NUMR4555}", round($lista_fc[0]->todos4555R), $html);
                $html = str_replace("{R55}", round(100 * $lista_fc[0]->positivo55 / $lista_fc[0]->todos55), $html);
                $html = str_replace("{NUMR55}", round($lista_fc[0]->todos55R), $html);


//ANTIGUEDAD


                $porcentaje_total = round(100 * $lista_fc[0]->CuentaClima / $lista_fc[0]->CuentaTotal);
                $html = str_replace("{AVANCE_CLIMA}", $porcentaje_total, $html);
                $html = str_replace("{CONTESTADO_CLIMA}", $lista_fc[0]->CuentaClima, $html);
                $html = str_replace("{PENDIENTES_CLIMA}", ($lista_fc[0]->CuentaTotal - $lista_fc[0]->CuentaClima), $html);


                $lista_fcg = lista_clima_reporte_dimension_data($id_empresa, $filtro1, $filtro2, $filtro3);

                foreach ($lista_fcg as $unico) {
                    $array_pregunta = lista_clima_reporte_pregunta_data($unico->id_dimension, $id_empresa, $filtro1, $filtro2, $filtro3);
                    //echo "<br><br>id_dimension ..".$unico->id_dimension;
                    $positivo = 0;
                    $negativo = 0;
                    $neutro = 0;
                    $total_html2 = "";
                    foreach ($array_pregunta as $unico_idpreg) {
                        //print_r($unico_idpreg);
                        //echo "<br><br>_______________id preg <br>".$unico_idpreg->id_pregunta;

                        $positivo_prg = 0;
                        $negativo_prg = 0;
                        $neutro_prg = 0;
                        $todas_prg = 0;
                        $por_positivo_prg = 0;
                        $negativo_prg = 0;
                        $neutro_prg = 0;
                        $array_respuestas = lista_clima_reporte_respuestas_pregunta_data($unico_idpreg->id_pregunta, $id_empresa, $filtro1, $filtro2, $filtro3);


                        $positivo_prg = $array_respuestas[0]->positivo;
                        $negativo_prg = $array_respuestas[0]->negativo;
                        $neutro_prg = $array_respuestas[0]->neutro;
                        $todas_prg = $positivo_prg + $neutro_prg + $negativo_prg;

                        $por_positivo_prg = round(100 * $positivo_prg / $todas_prg);
                        $por_negativo_prg = round(100 * $negativo_prg / $todas_prg);
                        $por_neutro_prg = round(100 * $neutro_prg / $todas_prg);

                        $row2 = file_get_contents("views/clima/row_clima_reportes_preg.html");
                        $row2 = str_replace("{PREGUNTA}", utf8_encode($array_respuestas[0]->pregunta), $row2);
                        $row2 = str_replace("{PROMEDIO_DIMENSION_POSITIVO_BASE_100}", utf8_encode($por_positivo_prg), $row2);
                        $row2 = str_replace("{PROMEDIO_DIMENSION_NEGATIVO_BASE_100}", utf8_encode($por_negativo_prg), $row2);
                        $row2 = str_replace("{PROMEDIO_DIMENSION_NEUTRO_BASE_100}", utf8_encode($por_neutro_prg), $row2);
                        $total_html2 .= $row2;


                        //print_r($array_respuestas);
                        $positivo = $array_respuestas[0]->positivo + $positivo;
                        $negativo = $array_respuestas[0]->negativo + $negativo;
                        $neutro = $array_respuestas[0]->neutro + $neutro;
                    }
                    $todas = $positivo + $negativo + $neutro;
                    $por_positivo = round(100 * $positivo / $todas);
                    $por_negativo = round(100 * $negativo / $todas);
                    $por_neutro = round(100 * $neutro / $todas);
                    $row = file_get_contents("views/clima/row_clima_reportes.html");
                    $row = str_replace("{DIMENSION}", utf8_encode($unico->dimension), $row);
                    $row = str_replace("{PROMEDIO_DIMENSION_POSITIVO_BASE_100}", utf8_encode($por_positivo), $row);
                    $row = str_replace("{PROMEDIO_DIMENSION_NEGATIVO_BASE_100}", utf8_encode($por_negativo), $row);
                    $row = str_replace("{PROMEDIO_DIMENSION_NEUTRO_BASE_100}", utf8_encode($por_neutro), $row);


                    $row = str_replace("{LISTA_CLIMA_RESULTADOS_PREGUNTAS}", $total_html2, $row);


                    $total_html .= $row;
                }


                $tipos_array = lista_divisiones_clima($id_empresa);
                //print_r($tipos_array);
                foreach ($tipos_array as $unico) {

                    $select_id_tipo .= "<option value='" . $unico->id_tipo . "'>" . utf8_encode($unico->id_tipo) . "</option>";

                }
                //   echo "filtros $filtro1, $filtro2, $filtro3";
                $Datos_f3 = TraeDatosUsuario($filtro3);
                $html = str_replace("{LISTA_CLIMA_RESULTADOS_DIMENSION}", $total_html, $html);

                $html = str_replace("{SELECT_ID_TIPO}", $select_id_tipo, $html);


                if ($filtro1 <> '') {
                    $txt_filtro .= " $filtro1";
                } else {
                    $txt_filtro .= "";
                }
                if ($filtro2 <> '') {
                    $txt_filtro .= " , $filtro2";
                } else {
                    $txt_filtro .= "";
                }
                if ($filtro3 <> '') {
                    $txt_filtro .= " , " . $Datos_f3[0]->nombre_completo . "";
                } else {
                    $txt_filtro .= "";
                }

                $html = str_replace("{FILTRO}", $txt_filtro, $html);


                $html = str_replace("{INDUCCION}", $porcentaje_induccion, $html);
                $html = str_replace("{FASE1}", $porcentaje_fase1, $html);
                $html = str_replace("{FASE2}", $porcentaje_fase2, $html);
                $html = str_replace("{TITULO}", "Resultados Clima", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }


            function lista_academia_lider($html, $id_empresa, $r1, $r2, $r3)
            {


                //  $lista_Gerencia=Lista_Gerencias($id_empresa);
                foreach ($lista_Gerencia as $unico) {


//echo "<br>". $unico->gerencia;
                    $lista_fc = lista_academia_lider_data($id_empresa, $unico->gerencia, $r2, $r3);
                    //print_r($lista_fc);

                    $invitacion = "";
                    $cuenta = "";
                    $cuenta_induccion = 0;
                    $cuenta_fase1 = 0;
                    $cuenta_fase2 = 0;
                    $cuenta_fase12 = 0;
                    foreach ($lista_fc as $unico) {
                        $cuenta++;
                        if ($unico->rutmaster == '0') {
                            $status = "<span class='badge bg-purple'>Jefe_Nuevo</span>";;
                        }
                        if ($unico->rutmaster == '1' and $unico->induccion_a == '' and $unico->fase1_a == '' and $unico->fase2_a == '') {
                            $status = "<span class='badge bg-violet'>S/A</span>";
                        }
                        if ($unico->induccion_a <> '') {
                            $cuenta_induccion++;
                        }
                        if ($unico->fase1_a <> '') {
                            $cuenta_fase1++;
                        }
                        if ($unico->fase2_a <> '') {
                            $cuenta_fase2++;
                        }
                        if ($unico->fase1_a <> '' and $unico->fase2_a <> '') {
                            $cuenta_fase12++;
                        }

                    }

                    // echo ". induccion $cuenta_induccion";
                    $row2 = file_get_contents("views/academia_lider/row_academia_gerencia.html");
                    $row2 = str_replace("{GERENCIA}", utf8_encode($unico->gerencia), $row2);
                    $row2 = str_replace("{INDUCCION}", $cuenta_induccion, $row2);
                    $row2 = str_replace("{FASE1}", $cuenta_fase1, $row2);
                    $row2 = str_replace("{FASE2}", $cuenta_fase2, $row2);
                    $row2 = str_replace("{FASE1FASE2}", round(100 * $cuenta_fase12 / $cuenta), $row2);
                    $total_html2 .= $row2;
                }

                $lista_fc = lista_academia_lider_data($id_empresa, $r1, $r2, $r3);
                //print_r($lista_fc);

                $invitacion = "";
                foreach ($lista_fc as $unico) {
                    $cuenta++;
                    $status = "";
                    $invitacion = "";
                    $invitacion_inducion = "";
                    $invitacion_fase1 = "";
                    $invitacion_fase2 = "";
                    if ($unico->rutmaster == '0') {
                        $status = "<span class='badge bg-purple'>Jefe_Nuevo</span>";;
                    }
                    if ($unico->rutmaster == '1' and $unico->induccion_a == '' and $unico->fase1_a == '' and $unico->fase2_a == '') {
                        $status = "<span class='badge bg-violet'>S/A</span>";
                    }
                    //echo $status;
                    $row = file_get_contents("views/academia_lider/row_academia.html");
                    $row = str_replace("{ID}", utf8_encode($unico->id_cargo), $row);
                    $row = str_replace("{RUT_COMPLETO}", utf8_encode($unico->rut_completo), $row);
                    $row = str_replace("{NOMBRE_COMPLETO}", utf8_encode($unico->nombre_completo), $row);
                    $row = str_replace("{CARGO}", utf8_encode($unico->cargo), $row);
                    $row = str_replace("{NOMBRE_COMPLETO}", utf8_encode($unico->nombre_completo), $row);
                    $row = str_replace("{GERENCIA}", utf8_encode($unico->gerencia), $row);
                    $row = str_replace("{GERENCIAR2}", utf8_encode($unico->gerenciaR2), $row);
                    $row = str_replace("{GERENCIAR3}", utf8_encode($unico->gerenciaR3), $row);
                    $row = str_replace("{STATUS_jefe}", ($status), $row);
                    $row = str_replace("{INDUCCION}", utf8_encode($unico->induccion_a), $row);
                    $row = str_replace("{FASE1}", utf8_encode($unico->fase1_a), $row);
                    $row = str_replace("{FASE2}", utf8_encode($unico->fase2_a), $row);
                    //$row = str_replace("{FACILITADOR}",            utf8_encode($unico->rut_facilitador),$row);


                    $invitacion_ = Lid_BuscaEventodIMlIMIT1($unico->rut, "aca_lid", $id_empresa);


                    $facilitador = "";
                    $invitacion = "";
                    $invitacion .= "<span class='badge bg-gris'>" . $invitacion_ . "</span>. ";

                    if ($unico->rut_facilitador > 0) {
                        $facilitador .= "<span class='badge bg-verde'>FACILITADOR</span>. ";
                    }

                    $row = str_replace("{INVITACION}", ($invitacion), $row);
                    $row = str_replace("{FACILITADOR}", ($facilitador), $row);


                    if ($unico->induccion_a <> '') {
                        $cuenta_induccion++;
                    }
                    if ($unico->fase1_a <> '') {
                        $cuenta_fase1++;
                    }
                    if ($unico->fase2_a <> '') {
                        $cuenta_fase2++;
                    }
                    if ($unico->fase1_a <> '' and $unico->fase2_a <> '') {
                        $cuenta_fase12++;
                    }
                    $total_html .= $row;
                }


                $porcentaje_induccion = round(100 * $cuenta_induccion / $cuenta);
                $porcentaje_fase1 = round(100 * $cuenta_fase1 / $cuenta);
                $porcentaje_fase2 = round(100 * $cuenta_fase2 / $cuenta);
                $porcentaje_total = round(100 * $cuenta_fase12 / $cuenta);
                $html = str_replace("{TODOS}", $porcentaje_total, $html);
                $html = str_replace("{INDUCCION}", $porcentaje_induccion, $html);
                $html = str_replace("{FASE1}", $porcentaje_fase1, $html);
                $html = str_replace("{FASE2}", $porcentaje_fase2, $html);
                $html = str_replace("{NUM_TODOS}", $cuenta_fase12, $html);
                $html = str_replace("{NUM_INDUCCION}", $cuenta_induccion, $html);
                $html = str_replace("{NUM_FASE1}", $cuenta_fase1, $html);
                $html = str_replace("{NUM_FASE2}", $cuenta_fase2, $html);

                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{LISTA_GERENCIA}", $total_html2, $html);
                $html = str_replace("{TITULO}", "Academia de Liderazgo", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_becas_validacion($html, $id_empresa, $idcategoria)
            {
                $lista_becav = lista_becas_validacion_data($idcategoria, $id_empresa);
                foreach ($lista_becav as $unico) {
                    $row = file_get_contents("views/becas/row_lista_becas.html");
                    $row = str_replace("{ID}", utf8_encode($unico->id), $row);
                    $row = str_replace("{RUT}", utf8_encode($unico->rut), $row);
                    $row = str_replace("{NOMBRE}", utf8_encode($unico->nombre), $row);
                    $row = str_replace("{CARGO}", utf8_encode($unico->cargo), $row);
                    $row = str_replace("{DIVISION}", utf8_encode($unico->division), $row);
                    $row = str_replace("{FECHA}", utf8_encode($unico->fecha), $row);

                    $Jefe1 = TraeDatosUsuario($unico->rutjefe1);
                    $Jefe2 = TraeDatosUsuario($unico->rutjefe2);
                    //echo "tipo beca ".$unico->tipo_beca;

                    if (strpos($unico->tipo_beca, 'pre') !== false) {
                        $nombre_beca = "Beca Pregrado";
                    } else {
                        $nombre_beca = "Beca PostGrado";
                    }

                    if ($unico->comentario1jefe1 <> "") {
                        $unico->comentario1jefe1 = " -Meritos: " . $unico->comentario1jefe1;
                    }
                    if ($unico->comentario2jefe1 <> "") {
                        $unico->comentario2jefe1 = " -Aspectos: " . $unico->comentario2jefe1;
                    }


                    if ($unico->validacionjefe1 == "1") {

                        $validacion_jefe1 = "<div class='alert alert-success'>Aprobado por Jefe 1 <br>" . $Jefe1[0]->nombre_completo . " " . $Jefe1[0]->email . "<br>" . utf8_encode($unico->comentario1jefe1) . "<br>" . utf8_encode($unico->comentario2jefe1) . "</div>";


                        if ($unico->validacionjefe2 == "1") {
                            $validacion_jefe2 = "<div class='alert alert-success'>Aprobado por Jefe 2  <br>" . $Jefe2[0]->nombre_completo . " " . $Jefe2[0]->email . " </div>";
                        } elseif ($unico->validacionjefe2 == "2") {
                            $validacion_jefe2 = "<div class='alert alert-danger'>No Aprobado por Jefe 2 <br>" . $Jefe2[0]->nombre_completo . " " . $Jefe2[0]->email . " </div>";
                        } else {
                            $validacion_jefe2 = "<div class='alert alert-warning'>Pendiente Jefe 2  <br>" . $Jefe2[0]->nombre_completo . " " . $Jefe2[0]->email . " </div>";
                        }

                    } elseif ($unico->validacionjefe1 == "2") {
                        $validacion_jefe1 = "<div class='alert alert-danger'>No Aprobado por Jefe 1  <br>" . $Jefe1[0]->nombre_completo . " " . $Jefe1[0]->email . "<br>" . utf8_encode($unico->comentario1jefe1) . "<br>" . utf8_encode($unico->comentario2jefe1) . "</div>";
                        $validacion_jefe2 = "";
                    } else {
                        $validacion_jefe1 = "<div class='alert alert-warning'>Pendiente Jefe 1  <br>" . $Jefe1[0]->nombre_completo . " " . $Jefe1[0]->email . "<br>" . utf8_encode($unico->comentario1jefe1) . "<br>" . utf8_encode($unico->comentario2jefe1) . "</div>";
                        $validacion_jefe2 = "";

                    }

                    $row = str_replace("{NOMBRE_BECA}", $nombre_beca, $row);
                    $row = str_replace("{NOMBRE_CARRERA}", utf8_encode($unico->carrera) . utf8_encode($unico->otracarrera), $row);
                    $row = str_replace("{NOMBRE_INSTITUCION}", utf8_encode($unico->otracasa), $row);

                    $documentacion = "";

                    if (strpos($unico->tipo_beca, 'pre') !== false) {
                        if ($unico->certificado_acredita <> '') {
                            $documentacion .= '<br><br> <a href="../front/docs/' . utf8_decode($unico->certificado_acredita) . '" target="_blank" class="btn btn-info">Certificado Alumno Regular </a> ';


                            if ($unico->certificado_acredita_doc_ok == "") {
                                $documentacion .= "
												                    			<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=certificado_acredita_doc_ok&v=1&nombre=Carta aceptacion' class='btn btn-success pull-right'>Validar</a>
												                    			<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=certificado_acredita_doc_ok&v=2&nombre=Carta aceptacion' class='btn btn-danger pull-right'>Rechazar</a>
												                    			";
                            } elseif ($unico->certificado_acredita_doc_ok == "SI") {
                                $documentacion .= "<div class='badge badge-success pull-right'>Validado</div><br>
												                    		<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=certificado_acredita_doc_ok&v=2&nombre=Carta aceptacionr' class='btn btn-danger pull-right'>Rechazar</a>";
                            } elseif ($unico->certificado_acredita_doc_ok == "NO") {
                                $documentacion .= "<div class='badge badge-danger pull-right'>Rechazado</div><br>
												                    		<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=certificado_acredita_doc_ok&v=1&nombre=Carta aceptacion' class='btn btn-success pull-right'>Validar</a>
												                    		<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=certificado_acredita_doc_ok&v=2&nombre=Carta aceptacion' class='btn btn-danger pull-right'>Rechazar</a>
												                    		";
                            }

                        }

                        if ($unico->certificado_carga <> '') {
                            $documentacion .= '<br><br> <a href="../front/docs/' . utf8_decode($unico->certificado_carga) . '" target="_blank" class="btn btn-info">Certificado Concentracion Notas </a> ';


                            if ($unico->certificado_carga_doc_ok == "") {
                                $documentacion .= "
												                    			<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=certificado_carga_doc_ok&v=1&nombre=Detalle postgrado' class='btn btn-success pull-right'>Validar</a>
												                    			<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=certificado_carga_doc_ok&v=2&nombre=Detalle postgrado' class='btn btn-danger pull-right'>Rechazar</a>
												                    			";
                            } elseif ($unico->certificado_carga_doc_ok == "SI") {
                                $documentacion .= "<div class='badge badge-success pull-right'>Validado</div>
												                    		<br>
												                    		<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=certificado_carga_doc_ok&v=2&nombre=Detalle postgrado' class='btn btn-danger pull-right'>Rechazar</a>
												                    		";
                            } elseif ($unico->certificado_carga_doc_ok == "NO") {
                                $documentacion .= "<div class='badge badge-danger pull-right'>Rechazado</div><br>
												                    		<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=certificado_carga_doc_ok&v=1&nombre=Detalle postgrado' class='btn btn-success pull-right'>Validar</a>
												                    		<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=certificado_carga_doc_ok&v=2&nombre=Detalle postgrado' class='btn btn-danger pull-right'>Rechazar</a>
												                    		";
                            }

                        }

                        if ($unico->concentracion_notas <> '') {
                            $documentacion .= '<br><br> <a href="../front/docs/' . utf8_decode($unico->concentracion_notas) . '" target="_blank" class="btn btn-info">Pago Matricula </a> ';

                            if ($unico->concentracion_notas_doc_ok == "") {
                                $documentacion .= "
												                    			<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=concentracion_notas_doc_ok&v=1&nombre=Comprobante Pago' class='btn btn-success pull-right'>Validar</a>
												                    			<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=concentracion_notas_doc_ok&v=2&nombre=Comprobante Pago' class='btn btn-danger pull-right'>Rechazar</a>
												                    			";
                            } elseif ($unico->concentracion_notas_doc_ok == "SI") {
                                $documentacion .= "<div class='badge badge-success pull-right'>Validado</div><br>
												                    		<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=concentracion_notas_doc_ok&v=2&nombre=Comprobante Pago' class='btn btn-danger pull-right'>Rechazar</a>";
                            } elseif ($unico->concentracion_notas_doc_ok == "NO") {
                                $documentacion .= "<div class='badge badge-danger pull-right'>Rechazado</div><br>
												                    		<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=concentracion_notas_doc_ok&v=1&nombre=Comprobante Pago' class='btn btn-success pull-right'>Validar</a>
												                    		<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=concentracion_notas_doc_ok&v=2&nombre=Comprobante Pago' class='btn btn-danger pull-right'>Rechazar</a>
												                    		";
                            }


                        }


                        if ($unico->licencia_edmedia <> '') {
                            $documentacion .= '<br><br> <a href="../front/docs/' . utf8_decode($unico->licencia_edmedia) . '" target="_blank" class="btn btn-info">Comprobante Arancel </a> ';

                            if ($unico->licencia_edmedia_doc_ok == "") {
                                $documentacion .= "
												                    			<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=licencia_edmedia_doc_ok&v=1&nombre=Certificado titulo' class='btn btn-success pull-right pull-right'>Validar</a>
												                    			<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=licencia_edmedia_doc_ok&v=2&nombre=Certificado titulo' class='btn btn-danger pull-right pull-right'>Rechazar</a>
												                    			";
                            } elseif ($unico->licencia_edmedia_doc_ok == "SI") {
                                $documentacion .= "<div class='badge badge-success pull-right'>Validado</div>
												                    		<br>
												                    		<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=licencia_edmedia_doc_ok&v=2&nombre=Certificado titulo' class='btn btn-danger pull-right'>Rechazar</a>";
                            } elseif ($unico->licencia_edmedia_doc_ok == "NO") {
                                $documentacion .= "<div class='badge badge-danger pull-right'>Rechazado</div><br>
												                    		<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=licencia_edmedia_doc_ok&v=1&nombre=Certificado titulo' class='btn btn-success pull-right pull-right'>Validar</a>
												                    		<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=licencia_edmedia_doc_ok&v=2&nombre=Certificado titulo' class='btn btn-danger pull-right pull-right'>Rechazar</a>
												                    		";
                            }


                        }


                        if ($unico->certificado_notas <> '') {
                            $documentacion .= '<br><br> <a href="../front/docs/' . utf8_decode($unico->certificado_notas) . '" target="_blank" class="btn btn-info">Pago Arancel </a> ';

                            if ($unico->certificado_notas_doc_ok == "") {
                                $documentacion .= "
												                    			<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=certificado_notas_doc_ok&v=1&nombre=Declaracion Jurada' class='btn btn-success pull-right'>Validar</a>
												                    			<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=certificado_notas_doc_ok&v=2&nombre=Declaracion Jurada' class='btn btn-danger pull-right'>Rechazar</a>
												                    			";
                            } elseif ($unico->certificado_notas_doc_ok == "SI") {
                                $documentacion .= "<div class='badge badge-success pull-right'>Validado</div><br>
												                    		<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=certificado_notas_doc_ok&v=2&nombre=Declaracion Jurada' class='btn btn-danger pull-right'>Rechazar</a>";
                            } elseif ($unico->certificado_notas_doc_ok == "NO") {
                                $documentacion .= "<div class='badge badge-danger pull-right'>Rechazado</div><br>
												                    		<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=certificado_notas_doc_ok&v=1&nombre=Declaracion Jurada' class='btn btn-success pull-right'>Validar</a>
												                    		<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=certificado_notas_doc_ok&v=2&nombre=Declaracion Jurada' class='btn btn-danger pull-right'>Rechazar</a>
												                    		";
                            }


                        }


                        if ($unico->pago_arancel <> '') {
                            $documentacion .= '<br><br> <a href="../front/docs/' . utf8_decode($unico->pago_arancel) . '" target="_blank" class="btn btn-info">Archivo Adicional </a> ';

                        }

                        $documentacion .= "<hr><br>   			<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&vdocs=docs_pendiente' class='btn btn-primary'>Recordatorio Docs Pendientes</a>";


                    } else {

                        if ($unico->certificado_acredita <> '') {
                            $documentacion .= '<br><br> <a href="../front/docs/' . utf8_decode($unico->certificado_acredita) . '" target="_blank" class="btn btn-info">Carta Aceptacion</a> ';


                            if ($unico->certificado_acredita_doc_ok == "") {
                                $documentacion .= "
												                    			<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=certificado_acredita_doc_ok&v=1&nombre=Carta aceptacion' class='btn btn-success pull-right'>Validar</a>
												                    			<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=certificado_acredita_doc_ok&v=2&nombre=Carta aceptacion' class='btn btn-danger pull-right'>Rechazar</a>
												                    			";
                            } elseif ($unico->certificado_acredita_doc_ok == "SI") {
                                $documentacion .= "<div class='badge badge-success pull-right'>Validado</div><br>
												                    		<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=certificado_acredita_doc_ok&v=2&nombre=Carta aceptacionr' class='btn btn-danger pull-right'>Rechazar</a>";
                            } elseif ($unico->certificado_acredita_doc_ok == "NO") {
                                $documentacion .= "<div class='badge badge-danger pull-right'>Rechazado</div><br>
												                    		<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=certificado_acredita_doc_ok&v=1&nombre=Carta aceptacion' class='btn btn-success pull-right'>Validar</a>
												                    		<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=certificado_acredita_doc_ok&v=2&nombre=Carta aceptacion' class='btn btn-danger pull-right'>Rechazar</a>
												                    		";
                            }

                        }

                        if ($unico->certificado_carga <> '') {
                            $documentacion .= '<br><br> <a href="../front/docs/' . utf8_decode($unico->certificado_carga) . '" target="_blank" class="btn btn-info">Detalle PostGrado</a> ';


                            if ($unico->certificado_carga_doc_ok == "") {
                                $documentacion .= "
												                    			<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=certificado_carga_doc_ok&v=1&nombre=Detalle postgrado' class='btn btn-success pull-right'>Validar</a>
												                    			<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=certificado_carga_doc_ok&v=2&nombre=Detalle postgrado' class='btn btn-danger pull-right'>Rechazar</a>
												                    			";
                            } elseif ($unico->certificado_carga_doc_ok == "SI") {
                                $documentacion .= "<div class='badge badge-success pull-right'>Validado</div>
												                    		<br>
												                    		<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=certificado_carga_doc_ok&v=2&nombre=Detalle postgrado' class='btn btn-danger pull-right'>Rechazar</a>
												                    		";
                            } elseif ($unico->certificado_carga_doc_ok == "NO") {
                                $documentacion .= "<div class='badge badge-danger pull-right'>Rechazado</div><br>
												                    		<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=certificado_carga_doc_ok&v=1&nombre=Detalle postgrado' class='btn btn-success pull-right'>Validar</a>
												                    		<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=certificado_carga_doc_ok&v=2&nombre=Detalle postgrado' class='btn btn-danger pull-right'>Rechazar</a>
												                    		";
                            }

                        }

                        if ($unico->concentracion_notas <> '') {
                            $documentacion .= '<br><br> <a href="../front/docs/' . utf8_decode($unico->concentracion_notas) . '" target="_blank" class="btn btn-info">Pago Matricula </a> ';

                            if ($unico->concentracion_notas_doc_ok == "") {
                                $documentacion .= "
												                    			<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=concentracion_notas_doc_ok&v=1&nombre=Comprobante Pago' class='btn btn-success pull-right'>Validar</a>
												                    			<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=concentracion_notas_doc_ok&v=2&nombre=Comprobante Pago' class='btn btn-danger pull-right'>Rechazar</a>
												                    			";
                            } elseif ($unico->concentracion_notas_doc_ok == "SI") {
                                $documentacion .= "<div class='badge badge-success pull-right'>Validado</div><br>
												                    		<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=concentracion_notas_doc_ok&v=2&nombre=Comprobante Pago' class='btn btn-danger pull-right'>Rechazar</a>";
                            } elseif ($unico->concentracion_notas_doc_ok == "NO") {
                                $documentacion .= "<div class='badge badge-danger pull-right'>Rechazado</div><br>
												                    		<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=concentracion_notas_doc_ok&v=1&nombre=Comprobante Pago' class='btn btn-success pull-right'>Validar</a>
												                    		<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=concentracion_notas_doc_ok&v=2&nombre=Comprobante Pago' class='btn btn-danger pull-right'>Rechazar</a>
												                    		";
                            }


                        }


                        if ($unico->licencia_edmedia <> '') {
                            $documentacion .= '<br><br> <a href="../front/docs/' . utf8_decode($unico->licencia_edmedia) . '" target="_blank" class="btn btn-info">Carta Motivacional </a> ';

                            if ($unico->licencia_edmedia_doc_ok == "") {
                                $documentacion .= "
												                    			<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=licencia_edmedia_doc_ok&v=1&nombre=Certificado titulo' class='btn btn-success pull-right pull-right'>Validar</a>
												                    			<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=licencia_edmedia_doc_ok&v=2&nombre=Certificado titulo' class='btn btn-danger pull-right pull-right'>Rechazar</a>
												                    			";
                            } elseif ($unico->licencia_edmedia_doc_ok == "SI") {
                                $documentacion .= "<div class='badge badge-success pull-right'>Validado</div>
												                    		<br>
												                    		<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=licencia_edmedia_doc_ok&v=2&nombre=Certificado titulo' class='btn btn-danger pull-right'>Rechazar</a>";
                            } elseif ($unico->licencia_edmedia_doc_ok == "NO") {
                                $documentacion .= "<div class='badge badge-danger pull-right'>Rechazado</div><br>
												                    		<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=licencia_edmedia_doc_ok&v=1&nombre=Certificado titulo' class='btn btn-success pull-right pull-right'>Validar</a>
												                    		<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=licencia_edmedia_doc_ok&v=2&nombre=Certificado titulo' class='btn btn-danger pull-right pull-right'>Rechazar</a>
												                    		";
                            }


                        }


                        if ($unico->certificado_notas <> '') {
                            $documentacion .= '<br><br> <a href="../front/docs/' . utf8_decode($unico->certificado_notas) . '" target="_blank" class="btn btn-info">Pago Arancel </a> ';

                            if ($unico->certificado_notas_doc_ok == "") {
                                $documentacion .= "
												                    			<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=certificado_notas_doc_ok&v=1&nombre=Declaracion Jurada' class='btn btn-success pull-right'>Validar</a>
												                    			<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=certificado_notas_doc_ok&v=2&nombre=Declaracion Jurada' class='btn btn-danger pull-right'>Rechazar</a>
												                    			";
                            } elseif ($unico->certificado_notas_doc_ok == "SI") {
                                $documentacion .= "<div class='badge badge-success pull-right'>Validado</div><br>
												                    		<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=certificado_notas_doc_ok&v=2&nombre=Declaracion Jurada' class='btn btn-danger pull-right'>Rechazar</a>";
                            } elseif ($unico->certificado_notas_doc_ok == "NO") {
                                $documentacion .= "<div class='badge badge-danger pull-right'>Rechazado</div><br>
												                    		<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=certificado_notas_doc_ok&v=1&nombre=Declaracion Jurada' class='btn btn-success pull-right'>Validar</a>
												                    		<a href='?sw=becas_validacion&idenc=" . Encodear3($unico->id) . "&id=" . $idcategoria . "&tipo=certificado_notas_doc_ok&v=2&nombre=Declaracion Jurada' class='btn btn-danger pull-right'>Rechazar</a>
												                    		";
                            }


                        }

                    }

                    $row = str_replace("{VALIDACION_JEFE_1}", $validacion_jefe1, $row);
                    $row = str_replace("{VALIDACION_JEFE_2}", $validacion_jefe2, $row);


                    $id_enc = Encodear3($unico->id);
                    $botones_documentacion = '';
                    if ($unico->documentacionok == '') {
                        $botones_documentacion = '<a href="?sw=becas_validacion&idenc=' . $id_enc . '&d=1&id=' . $idcategoria . '" class="btn btn-success">Validar</a><br><br> <a href="?sw=becas_validacion&idenc=' . $id_enc . '&d=2&id=' . $idcategoria . '" class="btn btn-danger">Rechazar</a> ';
                    } else {
                        if ($unico->documentacionok == 'SI') {
                            $botones_documentacion = '<span class="badge badge-success">SI</span>';
                            $botones_documentacion .= '<a href="?sw=becas_validacion&idenc=' . $id_enc . '&d=1&id=' . $idcategoria . '" class="btn btn-success">Validar</a><br><br> <a href="?sw=becas_validacion&idenc=' . $id_enc . '&d=2&id=' . $idcategoria . '" class="btn btn-danger">Rechazar</a> ';

                        } elseif ($unico->documentacionok == 'NO') {
                            $botones_documentacion .= '<span class="badge badge-danger">NO</span><br><br>';
                            $botones_documentacion .= '<a href="?sw=becas_validacion&idenc=' . $id_enc . '&d=1&id=' . $idcategoria . '" class="btn btn-success">Validar</a><br><br> <a href="?sw=becas_validacion&idenc=' . $id_enc . '&d=2&id=' . $idcategoria . '" class="btn btn-danger">Rechazar</a> ';
                        }
                        //echo "hola $botones_documentacion";
                    }
                    $botones_validacion = '';
                    //echo $botones_documentacion;
                    if ($unico->validacionok == '') {
                        $botones_validacion = '<a href="?sw=becas_validacion&idenc=' . $id_enc . '&v=1&id=' . $idcategoria . '" class="btn btn-success">Validar</a><br><br> <a href="?sw=becas_validacion&idenc=' . $id_enc . '&v=2&id=' . $idcategoria . '" class="btn btn-danger">Rechazar</a> ';
                    } else {
                        if ($unico->validacionok == 'SI') {
                            $botones_validacion = '<span class="badge badge-success">SI</span>';
                        } else {
                            $botones_validacion = '<span class="badge badge-danger">NO</span>';
                        }
                    }
                    $row = str_replace("{BECA}", utf8_encode($unico->nombre_beca), $row);
                    $row = str_replace("{DOCUMENTACION}", utf8_encode($documentacion), $row);
                    $row = str_replace("{CHEQUEO_DOCS}", utf8_encode($botones_documentacion), $row);
                    $row = str_replace("{VALIDACION_FINAL}", utf8_encode($botones_validacion), $row);
                    $row = str_replace("{ID_BECAS_ENC}", utf8_encode($id_enc), $row);
                    $row = str_replace("{idcategoria_enc}", ($idcategoria), $row);

                    $total_html .= $row;
                }
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Becas", $html);
                $html = str_replace("{IDENC}", ($idcategoria), $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '<a href="?sw=becas" class="btn btn-info">< Volver</a>', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_becas_becas_validacion($html, $id_empresa, $idcategoria)
            {
                $lista_becav = lista_becas_becas_validacion_data($idcategoria, $id_empresa);
                foreach ($lista_becav as $unico) {
                    $row = file_get_contents("views/becas_becas/row_lista_becas.html");
                    $row = str_replace("{ID}", utf8_encode($unico->id), $row);
                    $row = str_replace("{RUT}", utf8_encode($unico->rut), $row);
                    $row = str_replace("{NOMBRE}", utf8_encode($unico->nombre), $row);
                    $row = str_replace("{FECHA}", utf8_encode($unico->fecha), $row);
                    $documentacion = "";
                    if ($unico->ficha_postulacion <> '') {
                        $documentacion .= '<a href="../front/' . utf8_decode($unico->ficha_postulacion) . '" target="_blank" class="btn btn-info" target="_blank">Ficha Postulacion </a><br><br>';
                    }
                    if ($unico->certificado_notas <> '') {
                        $documentacion .= '<a href="../front/' . utf8_decode($unico->certificado_notas) . '" target="_blank" class="btn btn-info">Certificado Notas </a><br><br>';
                    }
                    if ($unico->pago_arancel <> '') {
                        $documentacion .= '<a href="../front/' . utf8_decode($unico->pago_arancel) . '" target="_blank" class="btn btn-info">Pago Arancel </a><br><br>';
                    }
                    if ($unico->certificado_carga <> '') {
                        $documentacion .= '<a href="../front/' . utf8_decode($unico->certificado_carga) . '" target="_blank" class="btn btn-info">Certificado Carga </a><br><br>';
                    }
                    if ($unico->concentracion_notas <> '') {
                        $documentacion .= '<a href="../front/' . utf8_decode($unico->concentracion_notas) . '" target="_blank" class="btn btn-info">Concentracion Notas </a><br><br>';
                    }
                    if ($unico->licencia_edmedia <> '') {
                        $documentacion .= '<a href="../front/' . utf8_decode($unico->licencia_edmedia) . '" target="_blank" class="btn btn-info">Licencia Ed Media </a><br><br>';
                    }
                    if ($unico->boletinpsu <> '') {
                        $documentacion .= '<a href="../front/' . utf8_decode($unico->boletinpsu) . '" class="btn btn-info">Carta Patrocinio </a><br><br>';
                    }
                    if ($unico->certificado_egreso <> '') {
                        $documentacion .= '<a href="../front/' . utf8_decode($unico->certificado_egreso) . '" target="_blank" class="btn btn-info">Certificado Egreso </a><br><br>';
                    }
                    if ($unico->certificado_acredita <> '') {
                        $documentacion .= '<a href="../front/' . utf8_decode($unico->certificado_acredita) . '" target="_blank" class="btn btn-info">Certificado Acreditacion </a><br><br>';
                    }

                    if ($unico->vivienda_foto_escritura <> '') {
                        $documentacion .= '<a href="../front/' . utf8_decode($unico->vivienda_foto_escritura) . '" target="_blank" class="btn btn-info">Fotocopia Escritura Acreditacion </a><br><br>';
                    }
                    if ($unico->vivienda_cedula <> '') {
                        $documentacion .= '<a href="../front/' . utf8_decode($unico->vivienda_cedula) . '" target="_blank" class="btn btn-info">Cedula Propietario </a><br><br>';
                    }
                    if ($unico->vivienda_residencia <> '') {
                        $documentacion .= '<a href="../front/' . utf8_decode($unico->vivienda_residencia) . '" target="_blank" class="btn btn-info">Certificado de Residencia </a><br><br>';
                    }
                    if ($unico->vivienda_matrimonio <> '') {
                        $documentacion .= '<a href="../front/' . utf8_decode($unico->vivienda_matrimonio) . '" target="_blank" class="btn btn-info">Certificado Matrimonio </a><br><br>';
                    }

                    $id_enc = Encodear3($unico->id);
                    $botones_documentacion = '';
                    if ($unico->documentacionok == '') {
                        $botones_documentacion = '<a href="?sw=becas_becas_validacion&idenc=' . $id_enc . '&d=1&id=' . $idcategoria . '" class="btn btn-success">Validar</a><br><br> <a href="?sw=becas_validacion&idenc=' . $id_enc . '&d=2&id=' . $idcategoria . '" class="btn btn-danger">Rechazar</a> ';
                    } else {
                        if ($unico->documentacionok == 'SI') {
                            $botones_documentacion = '<span class="badge badge-success">SI</span>';
                        } elseif ($unico->documentacionok == 'NO') {
                            $botones_documentacion .= '<span class="badge badge-danger">NO</span><br><br>';
                            $botones_documentacion .= '<a href="?sw=becas_becas_validacion&idenc=' . $id_enc . '&d=1&id=' . $idcategoria . '" class="btn btn-success">Validar</a><br><br> <a href="?sw=becas_validacion&idenc=' . $id_enc . '&d=2&id=' . $idcategoria . '" class="btn btn-danger">Rechazar</a> ';
                        }
                        //echo "hola $botones_documentacion";
                    }
                    $botones_validacion = '';
//echo $botones_documentacion;
                    if ($unico->validacionok == '') {
                        $botones_validacion = '<a href="?sw=becas_becas_validacion&idenc=' . $id_enc . '&v=1&id=' . $idcategoria . '" class="btn btn-success">Validar</a><br><br> <a href="?sw=becas_validacion&idenc=' . $id_enc . '&v=2&id=' . $idcategoria . '" class="btn btn-danger">Rechazar</a> ';
                    } else {
                        if ($unico->validacionok == 'SI') {
                            $botones_validacion = '<span class="badge badge-success">SI</span>';
                        } else {
                            $botones_validacion = '<span class="badge badge-danger">NO</span>';
                        }
                    }
                    $row = str_replace("{BECA}", utf8_encode($unico->nombre_beca), $row);
                    $row = str_replace("{DOCUMENTACION}", utf8_encode($documentacion), $row);
                    $row = str_replace("{CHEQUEO_DOCS}", utf8_encode($botones_documentacion), $row);
                    $row = str_replace("{VALIDACION_FINAL}", utf8_encode($botones_validacion), $row);
                    $total_html .= $row;
                }
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Becas", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '<a href="?sw=becas_becas" class="btn btn-info">< Volver</a>', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_formacion_continua_validacion($html, $id_empresa, $idcategoria)
            {
                $lista_postulablesv = lista_formacion_continua_validacion_data($idcategoria, $id_empresa);
                //print_r($lista_postulablesv);
                foreach ($lista_postulablesv as $unico) {
                    $row = file_get_contents("views/formacion_continua/row_lista_formacioncontinua.html");
                    $row = str_replace("{ID}", utf8_encode($unico->id), $row);
                    $row = str_replace("{RUT}", utf8_encode($unico->rut), $row);
                    //print_r($unico);echo" <br>";
                    $Datosusuario = TraeDatosUsuario($unico->rut);
                    //print_r($Datosusuario);
                    $row = str_replace("{NOMBRE}", utf8_encode($Datosusuario[0]->nombre_completo), $row);
                    $row = str_replace("{FECHA}", utf8_encode($unico->fecha), $row);


                    $nombre_postulable = FC_NombrePostulable($unico->id_postulable, $id_empresa);
                    $descripcion_postulable = FC_DescripcionPostulable($unico->id_postulable, $id_empresa);

                    $id_enc = Encodear3($unico->id);
                    $botones_validacion = '';
//echo $botones_documentacion;

                    $botones_jefe = '';


                    if ($unico->validacionok == '') {
                        $botones_validacion = '
    <a href="?sw=formacioncontinua_validacion_admin&idenc=' . $id_enc . '&v=SI&id=' . $idcategoria . '" class="btn btn-success">Validaci&oacute;n Admin</a>
        <br><br>
    <a href="?sw=formacioncontinua_validacion_admin&idenc=' . $id_enc . '&v=NO&id=' . $idcategoria . '" class="btn btn-danger">Desistir Admin</a> ';
                    } else {
                        if ($unico->validacionok == 'SI') {
                            $botones_validacion = '<span class="badge badge-success">SI</span>';
                        } else {
                            $botones_validacion = '<span class="badge badge-danger">NO</span>';
                        }
                    }
                    if ($unico->jefeok == 'SI') {
                        $botones_jefe = '<span class="badge badge-success">SI</span>';
                    } elseif ($unico->jefeok == 'NO') {
                        $botones_jefe = '<span class="badge badge-danger">NO</span>';
                    } elseif ($unico->jefeok == 'NO_POR_FECHA') {
                        $botones_jefe = '<span class="badge badge-danger">NO_POR_FECHA</span>';
                    } else {

                        $botones_jefe = '<span class="badge badge-warning">PENDIENTE</span>';
                    }
                    //echo $unico->nombre_postulable;
                    $row = str_replace("{POSTULABLE}", utf8_encode($nombre_postulable . "<br>" . $descripcion_postulable), $row);
                    $row = str_replace("{VALIDACION_JEFE}", utf8_encode($botones_jefe), $row);
                    $row = str_replace("{VALIDACION_FINAL}", utf8_encode($botones_validacion), $row);
                    $total_html .= $row;
                }
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Validación Formación Continua", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '<a href="?sw=formacion_continua" class="btn btn-info">< Volver</a>', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_eventos_lista_inscritos($html, $id_empresa, $id_dimension, $codigo)
            {
                $lista_insc = TraeInscritosEventos($codigo, $id_dimension, $id_empresa);
                //print_r($lista_insc);
                foreach ($lista_insc as $unico) {
                    $row = file_get_contents("views/eventos/row_lista_inscritos_eventos.html");
                    $row = str_replace("{ID}", utf8_encode($unico->id), $row);
                    $row = str_replace("{ID_DIMENSION}", utf8_encode($id_dimension), $row);
                    $row = str_replace("{CODIGO}", utf8_encode($codigo), $row);
                    $row = str_replace("{RUT}", utf8_encode($unico->rut), $row);
                    //print_r($unico);echo" <br>";
                    $Datosusuario = TraeDatosUsuario($unico->rut);
                    //print_r($Datosusuario);
                    $row = str_replace("{NOMBRE}", utf8_encode($Datosusuario[0]->nombre_completo), $row);
                    $row = str_replace("{FECHA}", utf8_encode($unico->fecha), $row);
                    $row = str_replace("{HORA}", utf8_encode($unico->hora), $row);
                    $id_enc = Encodear3($unico->id);
                    $botones_validacion = '';
//echo $botones_documentacion
                    /*;
if($unico->validacionok==''){
    $botones_validacion='<a href="?sw=formacioncontinua_validacion&idenc='.$id_enc.'&v=1&id='.$idcategoria.'" class="btn btn-success">Validar</a><br><br> <a href="?sw=formacioncontinua_validacion&idenc='.$id_enc.'&v=2&id='.$idcategoria.'" class="btn btn-danger">Rechazar</a> ';
} else {
        if($unico->validacionok=='SI'){
    $botones_validacion='<span class="badge badge-success">SI</span>';
    } else {
    $botones_validacion='<span class="badge badge-danger">NO</span>';
    }
}
*/
                    $badge_postulacion = '<span class="badge badge-success">SI</span>';
                    if ($unico->estado == 'OK') {
                        $badge_validacion = '<span class="badge badge-success">SI</span>';
                    } else {
                        $badge_validacion = '<span class="badge badge-danger">NO</span>';
                    }
                    $num_emails_log = BuscaEmailLogEventoRut($unico->rut, $codigo, "Email_invitacion_evento", $id_empresa);
                    //echo $unico->nombre_postulable;
                    $row = str_replace("{POSTULACION}", utf8_encode($badge_postulacion), $row);
                    $row = str_replace("{VALIDACION}", utf8_encode($badge_validacion), $row);
                    $row = str_replace("{INVITACION}", utf8_encode($num_emails_log), $row);
                    $total_html .= $row;
                }
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Inscritos por Evento " . $codigo, $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '<a href="?sw=eventos_gestion&id_dimension=' . $id_dimension . '" class="btn btn-info">< Volver</a>', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }


            function lista_detalle_usuarios_empresas_Ext($html, $id_empresa, $rut_empresa)
            {
                $lista_insc = TraeInscritosExtEmpresaUsuarios($rut_empresa, $id_dimension, $id_empresa);
                //print_r($lista_insc);

                foreach ($lista_insc as $unico) {
                    $row = file_get_contents("views/ext_empresas/row_ext_empresa_inscritos.html");
                    $estado = "No iniciado";
                    if ($unico->capsula1 == 1 and $unico->capsula1 == 2
                        and $unico->capsula1 == 3 and $unico->capsula1 == 4) {
                        $estado = "Finalizado";
                    }
                    if ($unico->capsula1 == 0 and $unico->capsula1 == 0
                        and $unico->capsula1 == 0 and $unico->capsula1 == 0) {
                        $estado = "En Proceso";
                    }


                    $row = str_replace("{RUT}", utf8_encode($unico->rut), $row);
                    $row = str_replace("{NOMBRE}", utf8_encode($unico->nombre), $row);
                    $row = str_replace("{EMAIL}", utf8_encode($unico->email), $row);
                    $row = str_replace("{FECHA}", utf8_encode($unico->rut), $row);
                    $row = str_replace("{ESTADO}", utf8_encode($estado), $row);
                    $row = str_replace("{RUT_EMPRESA}", utf8_encode($unico->rut_ext_empresa), $row);
                    $row = str_replace("{DOMINIO}", utf8_encode($unico->dominio), $row);
                    $row = str_replace("{SINDICATO}", utf8_encode($unico->sindicato), $row);
                    $row = str_replace("{DIVISION}", utf8_encode($unico->division), $row);


                    $id_enc = Encodear3($unico->id);
                    $botones_validacion = '';
//echo $botones_documentacion
                    /*;
if($unico->validacionok==''){
    $botones_validacion='<a href="?sw=formacioncontinua_validacion&idenc='.$id_enc.'&v=1&id='.$idcategoria.'" class="btn btn-success">Validar</a><br><br> <a href="?sw=formacioncontinua_validacion&idenc='.$id_enc.'&v=2&id='.$idcategoria.'" class="btn btn-danger">Rechazar</a> ';
} else {
        if($unico->validacionok=='SI'){
    $botones_validacion='<span class="badge badge-success">SI</span>';
    } else {
    $botones_validacion='<span class="badge badge-danger">NO</span>';
    }
}
*/
                    $badge_postulacion = '<span class="badge badge-success">SI</span>';
                    if ($unico->estado == 'OK') {
                        $badge_validacion = '<span class="badge badge-success">SI</span>';
                    } else {
                        $badge_validacion = '<span class="badge badge-danger">NO</span>';
                    }
                    $num_emails_log = BuscaEmailLogEventoRut($unico->rut, $codigo, "Email_invitacion_evento", $id_empresa);
                    //echo $unico->nombre_postulable;
                    $row = str_replace("{POSTULACION}", utf8_encode($badge_postulacion), $row);
                    $row = str_replace("{VALIDACION}", utf8_encode($badge_validacion), $row);
                    $row = str_replace("{INVITACION}", utf8_encode($num_emails_log), $row);
                    $total_html .= $row;
                }
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Usuarios por Empresa " . $codigo, $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '<a href="?sw=ext_empresas_gestion&id_dimension=' . $id_dimension . '" class="btn btn-info">< Volver</a>', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }


            function lista_talent_profile_vista($html, $id_empresa, $id_cargo, $rut)
            {

//echo "<br>$id_empresa, $id_cargo, $rut";
                $lista_talent_usuarios = lista_talent_vista_rut_data($id_cargo, $id_empresa, $rut);
                //print_r($lista_talent_usuarios);
                $Skills_array = Talent_Skills_Resultados($rut, $id_cargo, $lista_talent_usuarios[0]->nivel_esperado, $id_empresa);
                if ($lista_talent_usuarios[0]->nivel_esperado == 1) {
                    $html = str_replace("{COLOR_BORDE_BASICO}", "talent_basico_border", $html);
                } else {
                    $html = str_replace("{COLOR_BORDE_BASICO}", "", $html);
                }
                if ($lista_talent_usuarios[0]->nivel_esperado == 2) {
                    $html = str_replace("{COLOR_BORDE_MEDIO}", "talent_medio_border", $html);
                } else {
                    $html = str_replace("{COLOR_BORDE_MEDIO}", "", $html);
                }
                if ($lista_talent_usuarios[0]->nivel_esperado == 3) {
                    $html = str_replace("{COLOR_BORDE_EXPERTO}", "talent_experto_border", $html);
                } else {
                    $html = str_replace("{COLOR_BORDE_EXPERTO}", "", $html);
                }
                foreach ($Skills_array as $unico) {
                    //echo "<pre>";    print_r($unico);
                    $array_skills .= "'" . $unico->id_skill . "',";
                    $array_resultados .= "" . $unico->puntos . ",";
                    if ($unico->id_nivel_esperado == 0) {
                        $referencia = 1;
                    }
                    if ($unico->id_nivel_esperado == 1) {
                        $referencia = 6;
                    }
                    if ($unico->id_nivel_esperado == 2) {
                        $referencia = 13;
                    }
                    if ($unico->id_nivel_esperado == 3) {
                        $referencia = 18;
                    }
                    $array_referencia .= "" . $referencia . ",";
                    $array_referenciaB .= 6 * $unico->skill_nivel_esperado_basico . ",";
                    $array_referenciaM .= 6 * $unico->skill_nivel_esperado_medio . ",";
                    $array_referenciaE .= 6 * $unico->skill_nivel_esperado_experto . ",";
                    //progress bar
                    if ($unico->puntos <= 1 and $unico->puntos >= 0) {
                        $estado_bar = "<span class='badge badge_width bg-rojo'>No Existe</span>";
                        $estilo_bar = "progress-bar-danger";
                    }
                    if ($unico->puntos <= 6 and $unico->puntos > 1) {
                        $estado_bar = "<span class='badge badge_width bg-rojo'>Basico</span>";
                        $estilo_bar = "progress-bar-danger";
                    }
                    if ($unico->puntos <= 13 and $unico->puntos > 6) {
                        $estado_bar = "<span class='badge badge_width bg-amarillo'>Medio</span>";
                        $estilo_bar = "progress-bar-warning";
                    }
                    if ($unico->puntos <= 18 and $unico->puntos > 13) {
                        $estado_bar = "<span class='badge badge_width bg-verde'>Experto</span>";
                        $estilo_bar = "progress-bar-success";
                    }
                    $porcentaje_puntos = round(100 * $unico->puntos / 18);
                    if ($lista_talent_usuarios[0]->nivel_esperado == 1) {
                        $porcentaje_esperado = round(100 * 6 * $unico->skill_nivel_esperado_basico / 18);
                    }
                    if ($lista_talent_usuarios[0]->nivel_esperado == 2) {
                        $porcentaje_esperado = round(100 * 6 * $unico->skill_nivel_esperado_medio / 18);
                    }
                    if ($lista_talent_usuarios[0]->nivel_esperado == 3) {
                        $porcentaje_esperado = round(100 * 6 * $unico->skill_nivel_esperado_experto / 18);
                    }
                    $progress_bar .= "
                <tr>
                  <td>" . $unico->id_skill . "</td>
                  <td>
                    <div class='progress progress-sm active'>
                      <div class='progress-bar " . $estilo_bar . " progress-bar-striped' style='width: " . $porcentaje_puntos . "%'>
                       <small>Resultado " . $porcentaje_puntos . "%</small></div>
                    </div>
                    <br>
                    <div class='progress progress-sm active'>
                      <div class='progress-bar progress-bar-info progress-bar-striped' style='width: " . $porcentaje_esperado . "%'>
                      <small>Esperado " . $porcentaje_esperado . "%</small></div>
                    </div>
                  </td>
                  <td>" . $estado_bar . "</td>
                </tr>
                <tr>
                <td colspan='3'><hr></td>
                </tr>";
                }
                // Calculo Ajuste por Cada NIVEL
                $Ajuste_array = Talent_busca_ajuste_por_nivel($rut, $id_cargo, $id_empresa);
                $ajuste_basico = round(100 * $Ajuste_array[0]->cuenta_basico / $Ajuste_array[0]->cuenta_todo);
                $ajuste_medio = round(100 * $Ajuste_array[0]->cuenta_medio / $Ajuste_array[0]->cuenta_todo);
                $ajuste_experto = round(100 * $Ajuste_array[0]->cuenta_experto / $Ajuste_array[0]->cuenta_todo);
                if ($ajuste_basico >= 70) {
                    $estilo_ajuste_basico = "bg-verde";
                    $txt_ajust_basico = "Alto Ajuste";
                }
                if ($ajuste_basico < 70 and $ajuste_basico >= 40) {
                    $estilo_ajuste_basico = "bg-amarillo";
                    $txt_ajust_basico = "Ajuste Medio";
                }
                if ($ajuste_basico < 40) {
                    $estilo_ajuste_basico = "bg-rojo";
                    $txt_ajust_basico = "Bajo Ajuste";
                }
                if ($ajuste_medio >= 70) {
                    $estilo_ajuste_medio = "bg-verde";
                    $txt_ajust_medio = "Alto Ajuste";
                }
                if ($ajuste_medio < 70 and $ajuste_medio >= 40) {
                    $estilo_ajuste_medio = "bg-amarillo";
                    $txt_ajust_medio = "Ajuste Medio";
                }
                if ($ajuste_medio < 40) {
                    $estilo_ajuste_medio = "bg-rojo";
                    $txt_ajust_medio = "Bajo Ajuste";
                }
                if ($ajuste_experto >= 70) {
                    $estilo_ajuste_experto = "bg-verde";
                    $txt_ajust_experto = "Alto Ajuste";
                }
                if ($ajuste_experto < 70 and $ajuste_experto >= 40) {
                    $estilo_ajuste_experto = "bg-amarillo";
                    $txt_ajust_experto = "Ajuste Medio";
                }
                if ($ajuste_experto < 40) {
                    $estilo_ajuste_experto = "bg-rojo";
                    $txt_ajust_experto = "Bajo Ajuste";
                }
                $Datosusuario = TraeDatosUsuario($lista_talent_usuarios[0]->rut);
                $html = str_replace("{NOMBRE}", utf8_encode($Datosusuario[0]->nombre_completo), $html);
                $html = str_replace("{FECHA}", utf8_encode($unico->fecha), $html);
                $html = str_replace("{CARGO}", utf8_encode($Datosusuario[0]->cargo), $html);
                $html = str_replace("{AVATAR}", utf8_encode($Datosusuario[0]->avatar), $html);
                $html = str_replace("{SKILLS}", utf8_encode($array_skills), $html);
                $html = str_replace("{RESULTADOS}", utf8_encode($array_resultados), $html);
                $html = str_replace("{REFERENCIA}", utf8_encode($array_referencia), $html);
                $html = str_replace("{REFERENCIAB}", utf8_encode($array_referenciaB), $html);
                $html = str_replace("{REFERENCIAM}", utf8_encode($array_referenciaM), $html);
                $html = str_replace("{REFERENCIAE}", utf8_encode($array_referenciaE), $html);
                $html = str_replace("{PROGRESS_BAR}", utf8_encode($progress_bar), $html);
                $html = str_replace("{AJUSTE_BASICO}", utf8_encode($ajuste_basico), $html);
                $html = str_replace("{AJUSTE_MEDIO}", utf8_encode($ajuste_medio), $html);
                $html = str_replace("{AJUSTE_EXPERTO}", utf8_encode($ajuste_experto), $html);
                $html = str_replace("{ESTILO_AJUSTE_BASICO}", utf8_encode($estilo_ajuste_basico), $html);
                $html = str_replace("{ESTILO_AJUSTE_MEDIO}", utf8_encode($estilo_ajuste_medio), $html);
                $html = str_replace("{ESTILO_AJUSTE_EXPERTO}", utf8_encode($estilo_ajuste_experto), $html);
                $html = str_replace("{TXT_AJUSTE_BASICO}", utf8_encode($txt_ajust_basico), $html);
                $html = str_replace("{TXT_AJUSTE_MEDIO}", utf8_encode($txt_ajust_medio), $html);
                $html = str_replace("{TXT_AJUSTE_EXPERTO}", utf8_encode($txt_ajust_experto), $html);
                //print_r($array_skills);
                //print_r($array_resultados);
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Vista Perfil por Colaborador", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '<a href="?sw=talent_perfiles" class="btn btn-info">< Volver</a>', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_emb_grupos($html, $id_empresa, $idcategoria)
            {
                $emb_olas = lista_emb_equipo_data($id_empresa);
                $row = file_get_contents("views/embajadores/entorno_emb_equipos.html");
                foreach ($emb_olas as $unico) {
                    $row = file_get_contents("views/embajadores/row_emb_equipos.html");
                    $row = str_replace("{ID}", utf8_encode($unico->id), $row);
                    $row = str_replace("{CODIGO}", utf8_encode($unico->codigo), $row);
                    $row = str_replace("{NOMBRE}", utf8_encode($unico->nombre), $row);
                    $row = str_replace("{DESCRIPCION}", utf8_encode($unico->descripcion), $row);
                    $total_html .= $row;
                }
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Equipos", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_emb_embajadores($html, $id_empresa, $idcategoria)
            {
                $emb_embajadores = lista_emb_embajadores_data($id_empresa);
                $row = file_get_contents("views/embajadores/entorno_emb_inscribir.html");

                $start = microtime(true);
                foreach ($emb_embajadores as $unico) {
                    $Usuario = TraeDatosUsuario($unico->rut);
                    //$Tutor=TraeDatosUsuario($unico->rut_tutor);
                    //$Sponsor=TraeDatosUsuario($unico->rut_sponsor);
                    //$ola=BuscaDatosOla($unico->id_ola, $id_empresa);
                    $row = file_get_contents("views/embajadores/row_emb_inscribir.html");
                    $row = str_replace("{ID}", utf8_encode($unico->id), $row);
                    $row = str_replace("{RUT}", utf8_encode($Usuario[0]->rut), $row);
                    $row = str_replace("{RUT_COMPLETO}", utf8_encode($Usuario[0]->rut), $row);
                    $row = str_replace("{EMAIL_ARROBA}", utf8_encode($unico->email), $row);
                    $row = str_replace("{NOMBRE_COMPLETO}", utf8_encode($Usuario[0]->nombre_completo), $row);
                    $row = str_replace("{ID_OLA}", utf8_encode($unico->id_ola), $row);
                    $row = str_replace("{OLA}", utf8_encode($ola[0]->nombre), $row);
                    $row = str_replace("{ID_GRUPO}", utf8_encode($unico->idgrupo), $row);
                    $row = str_replace("{GRUPO}", utf8_encode($unico->grupo), $row);
                    $row = str_replace("{RUT_TUTOR}", utf8_encode($unico->rut_tutor), $row);
                    $row = str_replace("{NOMBRE_COMPLETO_TUTOR}", utf8_encode($Tutor[0]->nombre_completo_tutor), $row);
                    $row = str_replace("{RUT_SPONSOR}", utf8_encode($unico->rut_sponsor), $row);
                    $row = str_replace("{NOMBRE_COMPLETO_SPONSOR}", utf8_encode($Sponsor[0]->nombre_completo_sponsor), $row);
                    $total_html .= $row;
                }
                $time_elapsed_secs = microtime(true) - $start;
                //echo "tiempo $time_elapsed_secs";

// lista olas
                $emb_olas = lista_emb_olas_data($id_empresa);
                foreach ($emb_olas as $emb_ola) {
                    $listas_olas .= "<option value='" . $emb_ola->codigo . "'>" . utf8_encode($emb_ola->nombre) . "</option>";
                }
                $html = str_replace("{EMB_OLAS}", $listas_olas, $html);
                //$emb_tutores=lista_emb_tutores_data($id_empresa);
                foreach ($emb_tutores as $emb_tutor) {
                    $listas_tutores .= "<option value='" . $emb_tutor->rut . "'>" . utf8_encode($emb_tutor->nombre_completo) . "</option>";
                }
                $html = str_replace("{EMB_TUTORES}", $listas_tutores, $html);
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Usuarios", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_gestion_amonestaciones($html, $id_empresa, $rut_col, $lista)
            {

                $html = str_replace("{ACTUALIZACION_REALIZADA}", $actualizacion_realizada, $html);

                $html = str_replace("{TITULO_TOTAL_LISTA_TODOS}", $txt_temporales, $html);
                $html = str_replace("{TITULO_TOTAL_LISTA_NUEVOS}", $txt_temporalesN, $html);
                $html = str_replace("{TITULO_TOTAL_LISTA_ELIMINADOS}", $txt_temporalesE, $html);

                $html = str_replace("{PROCESAR}", $btn_procesar, $html);


                $html = str_replace("{TOTAL_LISTA_TODOS}", $usuarios_temporales, $html);
                $html = str_replace("{TOTAL_LISTA_NUEVOS}", $usuarios_temporales_nuevos, $html);
                $html = str_replace("{TOTAL_LISTA_ELIMINADOS}", $usuarios_temporales_eliminados, $html);


                $html = str_replace("{TITULO}", "Actualización de Usuarios", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_gestion_usuarios($html, $id_empresa, $temporal_actualizar, $procesar)
            {
                //$emb_embajadores=lista_emb_embajadores_data($id_empresa);
                $totalE_html = "";
                $totalN_html = "";

                if ($temporal_actualizar <> '') {
                    //echo "<br>temporales";

                    $Temporal_todos = BuscaTotalUsuariosTemporales($id_empresa, "TODOS");
                    foreach ($Temporal_todos as $unico) {
                        $usuarios_temporales++;
                    }

                    $Temporal_nuevos = BuscaTotalUsuariosTemporales($id_empresa, "NUEVOS");
                    foreach ($Temporal_nuevos as $unico) {
                        $usuarios_temporales_nuevos++;
                        $row = file_get_contents("views/usuarios_gestion/row_usuarios.html");
                        $row = str_replace("{RUT_COMPLETO}", utf8_encode($unico->rut_completo), $row);
                        $row = str_replace("{NOMBRE_COMPLETO}", utf8_encode($unico->nombre_completo), $row);
                        $row = str_replace("{CARGO}", utf8_encode($unico->cargo), $row);
                        $row = str_replace("{EMAIL}", utf8_encode($unico->email), $row);
                        $totalN_html .= $row;

                    }

                    $Temporal_noencontrados = BuscaTotalUsuariosTemporales($id_empresa, "NOENCONTRADOS");
                    foreach ($Temporal_noencontrados as $unico) {
                        $usuarios_temporales_eliminados++;
                        $rowe = file_get_contents("views/usuarios_gestion/row_usuarios.html");
                        $rowe = str_replace("{RUT_COMPLETO}", utf8_encode($unico->rut_completo), $rowe);
                        $rowe = str_replace("{NOMBRE_COMPLETO}", utf8_encode($unico->nombre_completo), $rowe);
                        $rowe = str_replace("{CARGO}", utf8_encode($unico->cargo), $rowe);
                        $rowe = str_replace("{EMAIL}", utf8_encode($unico->email), $rowe);
                        $totalE_html .= $rowe;

                    }

                } else {
                    //echo "<br>NO&nbsp;temporales";
                }

                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{LISTA_NUEVOS}", $totalN_html, $html);
                $html = str_replace("{LISTA_ELIMINADOS}", $totalE_html, $html);

                if ($usuarios_temporales > 0) {
                    $txt_temporales = "<div class='col-lg-12 col-md-12 alert alert-info'> Usuarios Ingresados en Base Temporal: $usuarios_temporales</div>";
                } else {
                    $txt_temporales = "";
                }
                if ($usuarios_temporales_nuevos > 0) {
                    $txt_temporalesN = "<br><div class='col-lg-12 col-md-12 alert alert-success'> Usuarios Nuevos $usuarios_temporales_nuevos</div> ";
                } else {
                    $txt_temporalesN = "";
                }
                if ($usuarios_temporales_eliminados > 0) {
                    $txt_temporalesE = "<br><div class='col-lg-12 col-md-12 alert alert-danger'>Usuarios a Eliminar $usuarios_temporales_eliminados</div>";
                } else {
                    $txt_temporalesE = "";
                }

                if ($usuarios_temporales > 0) {
                    $btn_procesar = "<center><a href='?sw=actualizacion_usuarios&procesar=1' class='btn btn-info btn-sm'>Procesar Base Actual y Realizar Actualización</a></center>";
                } else {
                    $btn_procesar = "";
                }

                if ($procesar == "1") {
                    $actualizacion_realizada = "<center><div class='alert alert-success'>Actualizacion Realizada</div></center>";

                    //Rellena
                    CopiatblUsuario_Egresados($id_empresa);
                    //exit();

                    truncate_tbl_usuario($id_empresa);
                    BorraDuplicados($tipo, $id_empresa);
                    //lee desde tbl_usuario_temporal
                    usuario_temporal_lee($id_empresa);
                    cron_tbl_cron_sillas_data();
                    fill_contingencia_tbl_cron_sillas_data();


                } else {
                    $actualizacion_realizada = "";
                }
                $html = str_replace("{ACTUALIZACION_REALIZADA}", $actualizacion_realizada, $html);

                $html = str_replace("{TITULO_TOTAL_LISTA_TODOS}", $txt_temporales, $html);
                $html = str_replace("{TITULO_TOTAL_LISTA_NUEVOS}", $txt_temporalesN, $html);
                $html = str_replace("{TITULO_TOTAL_LISTA_ELIMINADOS}", $txt_temporalesE, $html);

                $html = str_replace("{PROCESAR}", $btn_procesar, $html);


                $html = str_replace("{TOTAL_LISTA_TODOS}", $usuarios_temporales, $html);
                $html = str_replace("{TOTAL_LISTA_NUEVOS}", $usuarios_temporales_nuevos, $html);
                $html = str_replace("{TOTAL_LISTA_ELIMINADOS}", $usuarios_temporales_eliminados, $html);


                $html = str_replace("{TITULO}", "Actualización de Usuarios", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_gestion_usuarios_licencias($html, $id_empresa, $temporal_actualizar, $procesar)
            {
                //$emb_embajadores=lista_emb_embajadores_data($id_empresa);
                $totalE_html = "";
                $totalN_html = "";

                if ($temporal_actualizar <> '') {
                    //echo "<br>temporales";

                    $Temporal_todos = BuscaTotalUsuariosTemporales($id_empresa, "TODOS");
                    foreach ($Temporal_todos as $unico) {
                        $usuarios_temporales++;
                    }

                    $Temporal_nuevos = BuscaTotalUsuariosTemporales($id_empresa, "NUEVOS");
                    foreach ($Temporal_nuevos as $unico) {
                        $usuarios_temporales_nuevos++;
                        $row = file_get_contents("views/usuarios_gestion/row_usuarios.html");
                        $row = str_replace("{RUT_COMPLETO}", utf8_encode($unico->rut_completo), $row);
                        $row = str_replace("{NOMBRE_COMPLETO}", utf8_encode($unico->nombre_completo), $row);
                        $row = str_replace("{CARGO}", utf8_encode($unico->cargo), $row);
                        $row = str_replace("{EMAIL}", utf8_encode($unico->email), $row);
                        $totalN_html .= $row;

                    }

                    $Temporal_noencontrados = BuscaTotalUsuariosTemporales($id_empresa, "NOENCONTRADOS");
                    foreach ($Temporal_noencontrados as $unico) {
                        $usuarios_temporales_eliminados++;
                        $rowe = file_get_contents("views/usuarios_gestion/row_usuarios.html");
                        $rowe = str_replace("{RUT_COMPLETO}", utf8_encode($unico->rut_completo), $rowe);
                        $rowe = str_replace("{NOMBRE_COMPLETO}", utf8_encode($unico->nombre_completo), $rowe);
                        $rowe = str_replace("{CARGO}", utf8_encode($unico->cargo), $rowe);
                        $rowe = str_replace("{EMAIL}", utf8_encode($unico->email), $rowe);
                        $totalE_html .= $rowe;

                    }

                } else {
                    //echo "<br>NO&nbsp;temporales";
                }

                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{LISTA_NUEVOS}", $totalN_html, $html);
                $html = str_replace("{LISTA_ELIMINADOS}", $totalE_html, $html);

                if ($usuarios_temporales > 0) {
                    $txt_temporales = "<div class='col-lg-12 col-md-12 alert alert-info'> Usuarios Ingresados en Base Temporal: $usuarios_temporales</div>";
                } else {
                    $txt_temporales = "";
                }
                if ($usuarios_temporales_nuevos > 0) {
                    $txt_temporalesN = "<br><div class='col-lg-12 col-md-12 alert alert-success'> Usuarios Nuevos $usuarios_temporales_nuevos</div> ";
                } else {
                    $txt_temporalesN = "";
                }
                if ($usuarios_temporales_eliminados > 0) {
                    $txt_temporalesE = "<br><div class='col-lg-12 col-md-12 alert alert-danger'>Usuarios a Eliminar $usuarios_temporales_eliminados</div>";
                } else {
                    $txt_temporalesE = "";
                }

                if ($usuarios_temporales > 0) {
                    $btn_procesar = "<center><a href='?sw=actualizacion_usuarios&procesar=1' class='btn btn-info btn-sm'>Procesar Base Actual y Realizar Actualización</a></center>";
                } else {
                    $btn_procesar = "";
                }

                if ($procesar == "1") {
                    $actualizacion_realizada = "<center><div class='alert alert-success'>Actualizacion Realizada</div></center>";
                    truncate_tbl_usuario($id_empresa);
                    BorraDuplicados($tipo, $id_empresa);
                    //lee desde tbl_usuario_temporal
                    usuario_temporal_lee($id_empresa);


                } else {
                    $actualizacion_realizada = "";
                }
                $html = str_replace("{ACTUALIZACION_REALIZADA}", $actualizacion_realizada, $html);

                $html = str_replace("{TITULO_TOTAL_LISTA_TODOS}", $txt_temporales, $html);
                $html = str_replace("{TITULO_TOTAL_LISTA_NUEVOS}", $txt_temporalesN, $html);
                $html = str_replace("{TITULO_TOTAL_LISTA_ELIMINADOS}", $txt_temporalesE, $html);

                $html = str_replace("{PROCESAR}", $btn_procesar, $html);


                $html = str_replace("{TOTAL_LISTA_TODOS}", $usuarios_temporales, $html);
                $html = str_replace("{TOTAL_LISTA_NUEVOS}", $usuarios_temporales_nuevos, $html);
                $html = str_replace("{TOTAL_LISTA_ELIMINADOS}", $usuarios_temporales_eliminados, $html);


                $html = str_replace("{TITULO}", "Actualización de Usuarios", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }


            function lista_gestion_usuarios_metaspivote($html, $id_empresa, $temporal_actualizar, $procesar)
            {
                //$emb_embajadores=lista_emb_embajadores_data($id_empresa);
                $totalE_html = "";
                $totalN_html = "";

                if ($temporal_actualizar <> '') {
                    //echo "<br>temporales";

                    $Temporal_todos = BuscaTotalUsuariosTemporales($id_empresa, "TODOS");
                    foreach ($Temporal_todos as $unico) {
                        $usuarios_temporales++;
                    }

                    $Temporal_nuevos = BuscaTotalUsuariosTemporales($id_empresa, "NUEVOS");
                    foreach ($Temporal_nuevos as $unico) {
                        $usuarios_temporales_nuevos++;
                        $row = file_get_contents("views/usuarios_gestion/row_usuarios.html");
                        $row = str_replace("{RUT_COMPLETO}", utf8_encode($unico->rut_completo), $row);
                        $row = str_replace("{NOMBRE_COMPLETO}", utf8_encode($unico->nombre_completo), $row);
                        $row = str_replace("{CARGO}", utf8_encode($unico->cargo), $row);
                        $row = str_replace("{EMAIL}", utf8_encode($unico->email), $row);
                        $totalN_html .= $row;

                    }

                    $Temporal_noencontrados = BuscaTotalUsuariosTemporales($id_empresa, "NOENCONTRADOS");
                    foreach ($Temporal_noencontrados as $unico) {
                        $usuarios_temporales_eliminados++;
                        $rowe = file_get_contents("views/usuarios_gestion/row_usuarios.html");
                        $rowe = str_replace("{RUT_COMPLETO}", utf8_encode($unico->rut_completo), $rowe);
                        $rowe = str_replace("{NOMBRE_COMPLETO}", utf8_encode($unico->nombre_completo), $rowe);
                        $rowe = str_replace("{CARGO}", utf8_encode($unico->cargo), $rowe);
                        $rowe = str_replace("{EMAIL}", utf8_encode($unico->email), $rowe);
                        $totalE_html .= $rowe;

                    }

                } else {
                    //echo "<br>NO&nbsp;temporales";
                }

                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{LISTA_NUEVOS}", $totalN_html, $html);
                $html = str_replace("{LISTA_ELIMINADOS}", $totalE_html, $html);

                if ($usuarios_temporales > 0) {
                    $txt_temporales = "<div class='col-lg-12 col-md-12 alert alert-info'> Usuarios Ingresados en Base Temporal: $usuarios_temporales</div>";
                } else {
                    $txt_temporales = "";
                }
                if ($usuarios_temporales_nuevos > 0) {
                    $txt_temporalesN = "<br><div class='col-lg-12 col-md-12 alert alert-success'> Usuarios Nuevos $usuarios_temporales_nuevos</div> ";
                } else {
                    $txt_temporalesN = "";
                }
                if ($usuarios_temporales_eliminados > 0) {
                    $txt_temporalesE = "<br><div class='col-lg-12 col-md-12 alert alert-danger'>Usuarios a Eliminar $usuarios_temporales_eliminados</div>";
                } else {
                    $txt_temporalesE = "";
                }

                if ($usuarios_temporales > 0) {
                    $btn_procesar = "<center><a href='?sw=actualizacion_usuarios&procesar=1' class='btn btn-info btn-sm'>Procesar Base Actual y Realizar Actualización</a></center>";
                } else {
                    $btn_procesar = "";
                }

                if ($procesar == "1") {
                    $actualizacion_realizada = "<center><div class='alert alert-success'>Actualizacion Realizada</div></center>";
                    truncate_tbl_usuario($id_empresa);
                    BorraDuplicados($tipo, $id_empresa);
                    //lee desde tbl_usuario_temporal
                    usuario_temporal_lee($id_empresa);


                } else {
                    $actualizacion_realizada = "";
                }
                $html = str_replace("{ACTUALIZACION_REALIZADA}", $actualizacion_realizada, $html);

                $html = str_replace("{TITULO_TOTAL_LISTA_TODOS}", $txt_temporales, $html);
                $html = str_replace("{TITULO_TOTAL_LISTA_NUEVOS}", $txt_temporalesN, $html);
                $html = str_replace("{TITULO_TOTAL_LISTA_ELIMINADOS}", $txt_temporalesE, $html);

                $html = str_replace("{PROCESAR}", $btn_procesar, $html);


                $html = str_replace("{TOTAL_LISTA_TODOS}", $usuarios_temporales, $html);
                $html = str_replace("{TOTAL_LISTA_NUEVOS}", $usuarios_temporales_nuevos, $html);
                $html = str_replace("{TOTAL_LISTA_ELIMINADOS}", $usuarios_temporales_eliminados, $html);


                $html = str_replace("{TITULO}", "Actualización de Usuarios", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_fn_tbl_mc_potencial_relacionados($html, $id_empresa, $temporal_actualizar, $procesar)
            {
                //$emb_embajadores=lista_emb_embajadores_data($id_empresa);
                $totalE_html = "";
                $totalN_html = "";

                if ($temporal_actualizar <> '') {
                    //echo "<br>temporales";

                    $Temporal_todos = BuscaTotalUsuariosTemporales($id_empresa, "TODOS");
                    foreach ($Temporal_todos as $unico) {
                        $usuarios_temporales++;
                    }

                    $Temporal_nuevos = BuscaTotalUsuariosTemporales($id_empresa, "NUEVOS");
                    foreach ($Temporal_nuevos as $unico) {
                        $usuarios_temporales_nuevos++;
                        $row = file_get_contents("views/usuarios_gestion/row_usuarios.html");
                        $row = str_replace("{RUT_COMPLETO}", utf8_encode($unico->rut_completo), $row);
                        $row = str_replace("{NOMBRE_COMPLETO}", utf8_encode($unico->nombre_completo), $row);
                        $row = str_replace("{CARGO}", utf8_encode($unico->cargo), $row);
                        $row = str_replace("{EMAIL}", utf8_encode($unico->email), $row);
                        $totalN_html .= $row;

                    }

                    $Temporal_noencontrados = BuscaTotalUsuariosTemporales($id_empresa, "NOENCONTRADOS");
                    foreach ($Temporal_noencontrados as $unico) {
                        $usuarios_temporales_eliminados++;
                        $rowe = file_get_contents("views/usuarios_gestion/row_usuarios.html");
                        $rowe = str_replace("{RUT_COMPLETO}", utf8_encode($unico->rut_completo), $rowe);
                        $rowe = str_replace("{NOMBRE_COMPLETO}", utf8_encode($unico->nombre_completo), $rowe);
                        $rowe = str_replace("{CARGO}", utf8_encode($unico->cargo), $rowe);
                        $rowe = str_replace("{EMAIL}", utf8_encode($unico->email), $rowe);
                        $totalE_html .= $rowe;

                    }

                } else {
                    //echo "<br>NO&nbsp;temporales";
                }

                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{LISTA_NUEVOS}", $totalN_html, $html);
                $html = str_replace("{LISTA_ELIMINADOS}", $totalE_html, $html);

                if ($usuarios_temporales > 0) {
                    $txt_temporales = "<div class='col-lg-12 col-md-12 alert alert-info'> Usuarios Ingresados en Base Temporal: $usuarios_temporales</div>";
                } else {
                    $txt_temporales = "";
                }
                if ($usuarios_temporales_nuevos > 0) {
                    $txt_temporalesN = "<br><div class='col-lg-12 col-md-12 alert alert-success'> Usuarios Nuevos $usuarios_temporales_nuevos</div> ";
                } else {
                    $txt_temporalesN = "";
                }
                if ($usuarios_temporales_eliminados > 0) {
                    $txt_temporalesE = "<br><div class='col-lg-12 col-md-12 alert alert-danger'>Usuarios a Eliminar $usuarios_temporales_eliminados</div>";
                } else {
                    $txt_temporalesE = "";
                }

                if ($usuarios_temporales > 0) {
                    $btn_procesar = "<center><a href='?sw=actualizacion_usuarios&procesar=1' class='btn btn-info btn-sm'>Procesar Base Actual y Realizar Actualización</a></center>";
                } else {
                    $btn_procesar = "";
                }

                if ($procesar == "1") {
                    $actualizacion_realizada = "<center><div class='alert alert-success'>Actualizacion Realizada</div></center>";
                    truncate_tbl_usuario($id_empresa);
                    BorraDuplicados($tipo, $id_empresa);
                    //lee desde tbl_usuario_temporal
                    usuario_temporal_lee($id_empresa);


                } else {
                    $actualizacion_realizada = "";
                }
                $html = str_replace("{ACTUALIZACION_REALIZADA}", $actualizacion_realizada, $html);

                $html = str_replace("{TITULO_TOTAL_LISTA_TODOS}", $txt_temporales, $html);
                $html = str_replace("{TITULO_TOTAL_LISTA_NUEVOS}", $txt_temporalesN, $html);
                $html = str_replace("{TITULO_TOTAL_LISTA_ELIMINADOS}", $txt_temporalesE, $html);

                $html = str_replace("{PROCESAR}", $btn_procesar, $html);


                $html = str_replace("{TOTAL_LISTA_TODOS}", $usuarios_temporales, $html);
                $html = str_replace("{TOTAL_LISTA_NUEVOS}", $usuarios_temporales_nuevos, $html);
                $html = str_replace("{TOTAL_LISTA_ELIMINADOS}", $usuarios_temporales_eliminados, $html);


                $html = str_replace("{TITULO}", "Actualización de Usuarios", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_fn_tbl_mc_carrera_interna($html, $id_empresa, $temporal_actualizar, $procesar)
            {
                //$emb_embajadores=lista_emb_embajadores_data($id_empresa);
                $totalE_html = "";
                $totalN_html = "";

                if ($temporal_actualizar <> '') {
                    //echo "<br>temporales";

                    $Temporal_todos = BuscaTotalUsuariosTemporales($id_empresa, "TODOS");
                    foreach ($Temporal_todos as $unico) {
                        $usuarios_temporales++;
                    }

                    $Temporal_nuevos = BuscaTotalUsuariosTemporales($id_empresa, "NUEVOS");
                    foreach ($Temporal_nuevos as $unico) {
                        $usuarios_temporales_nuevos++;
                        $row = file_get_contents("views/usuarios_gestion/row_usuarios.html");
                        $row = str_replace("{RUT_COMPLETO}", utf8_encode($unico->rut_completo), $row);
                        $row = str_replace("{NOMBRE_COMPLETO}", utf8_encode($unico->nombre_completo), $row);
                        $row = str_replace("{CARGO}", utf8_encode($unico->cargo), $row);
                        $row = str_replace("{EMAIL}", utf8_encode($unico->email), $row);
                        $totalN_html .= $row;

                    }

                    $Temporal_noencontrados = BuscaTotalUsuariosTemporales($id_empresa, "NOENCONTRADOS");
                    foreach ($Temporal_noencontrados as $unico) {
                        $usuarios_temporales_eliminados++;
                        $rowe = file_get_contents("views/usuarios_gestion/row_usuarios.html");
                        $rowe = str_replace("{RUT_COMPLETO}", utf8_encode($unico->rut_completo), $rowe);
                        $rowe = str_replace("{NOMBRE_COMPLETO}", utf8_encode($unico->nombre_completo), $rowe);
                        $rowe = str_replace("{CARGO}", utf8_encode($unico->cargo), $rowe);
                        $rowe = str_replace("{EMAIL}", utf8_encode($unico->email), $rowe);
                        $totalE_html .= $rowe;

                    }

                } else {
                    //echo "<br>NO&nbsp;temporales";
                }

                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{LISTA_NUEVOS}", $totalN_html, $html);
                $html = str_replace("{LISTA_ELIMINADOS}", $totalE_html, $html);

                if ($usuarios_temporales > 0) {
                    $txt_temporales = "<div class='col-lg-12 col-md-12 alert alert-info'> Usuarios Ingresados en Base Temporal: $usuarios_temporales</div>";
                } else {
                    $txt_temporales = "";
                }
                if ($usuarios_temporales_nuevos > 0) {
                    $txt_temporalesN = "<br><div class='col-lg-12 col-md-12 alert alert-success'> Usuarios Nuevos $usuarios_temporales_nuevos</div> ";
                } else {
                    $txt_temporalesN = "";
                }
                if ($usuarios_temporales_eliminados > 0) {
                    $txt_temporalesE = "<br><div class='col-lg-12 col-md-12 alert alert-danger'>Usuarios a Eliminar $usuarios_temporales_eliminados</div>";
                } else {
                    $txt_temporalesE = "";
                }

                if ($usuarios_temporales > 0) {
                    $btn_procesar = "<center><a href='?sw=actualizacion_usuarios&procesar=1' class='btn btn-info btn-sm'>Procesar Base Actual y Realizar Actualización</a></center>";
                } else {
                    $btn_procesar = "";
                }

                if ($procesar == "1") {
                    $actualizacion_realizada = "<center><div class='alert alert-success'>Actualizacion Realizada</div></center>";
                    truncate_tbl_usuario($id_empresa);
                    BorraDuplicados($tipo, $id_empresa);
                    //lee desde tbl_usuario_temporal
                    usuario_temporal_lee($id_empresa);


                } else {
                    $actualizacion_realizada = "";
                }
                $html = str_replace("{ACTUALIZACION_REALIZADA}", $actualizacion_realizada, $html);

                $html = str_replace("{TITULO_TOTAL_LISTA_TODOS}", $txt_temporales, $html);
                $html = str_replace("{TITULO_TOTAL_LISTA_NUEVOS}", $txt_temporalesN, $html);
                $html = str_replace("{TITULO_TOTAL_LISTA_ELIMINADOS}", $txt_temporalesE, $html);

                $html = str_replace("{PROCESAR}", $btn_procesar, $html);


                $html = str_replace("{TOTAL_LISTA_TODOS}", $usuarios_temporales, $html);
                $html = str_replace("{TOTAL_LISTA_NUEVOS}", $usuarios_temporales_nuevos, $html);
                $html = str_replace("{TOTAL_LISTA_ELIMINADOS}", $usuarios_temporales_eliminados, $html);


                $html = str_replace("{TITULO}", "Actualización de Usuarios", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }


            function lista_fn_tbl_mc_tramo_desempeno($html, $id_empresa, $temporal_actualizar, $procesar)
            {
                //$emb_embajadores=lista_emb_embajadores_data($id_empresa);
                $totalE_html = "";
                $totalN_html = "";

                if ($temporal_actualizar <> '') {
                    //echo "<br>temporales";

                    $Temporal_todos = BuscaTotalUsuariosTemporales($id_empresa, "TODOS");
                    foreach ($Temporal_todos as $unico) {
                        $usuarios_temporales++;
                    }

                    $Temporal_nuevos = BuscaTotalUsuariosTemporales($id_empresa, "NUEVOS");
                    foreach ($Temporal_nuevos as $unico) {
                        $usuarios_temporales_nuevos++;
                        $row = file_get_contents("views/usuarios_gestion/row_usuarios.html");
                        $row = str_replace("{RUT_COMPLETO}", utf8_encode($unico->rut_completo), $row);
                        $row = str_replace("{NOMBRE_COMPLETO}", utf8_encode($unico->nombre_completo), $row);
                        $row = str_replace("{CARGO}", utf8_encode($unico->cargo), $row);
                        $row = str_replace("{EMAIL}", utf8_encode($unico->email), $row);
                        $totalN_html .= $row;

                    }

                    $Temporal_noencontrados = BuscaTotalUsuariosTemporales($id_empresa, "NOENCONTRADOS");
                    foreach ($Temporal_noencontrados as $unico) {
                        $usuarios_temporales_eliminados++;
                        $rowe = file_get_contents("views/usuarios_gestion/row_usuarios.html");
                        $rowe = str_replace("{RUT_COMPLETO}", utf8_encode($unico->rut_completo), $rowe);
                        $rowe = str_replace("{NOMBRE_COMPLETO}", utf8_encode($unico->nombre_completo), $rowe);
                        $rowe = str_replace("{CARGO}", utf8_encode($unico->cargo), $rowe);
                        $rowe = str_replace("{EMAIL}", utf8_encode($unico->email), $rowe);
                        $totalE_html .= $rowe;

                    }

                } else {
                    //echo "<br>NO&nbsp;temporales";
                }

                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{LISTA_NUEVOS}", $totalN_html, $html);
                $html = str_replace("{LISTA_ELIMINADOS}", $totalE_html, $html);

                if ($usuarios_temporales > 0) {
                    $txt_temporales = "<div class='col-lg-12 col-md-12 alert alert-info'> Usuarios Ingresados en Base Temporal: $usuarios_temporales</div>";
                } else {
                    $txt_temporales = "";
                }
                if ($usuarios_temporales_nuevos > 0) {
                    $txt_temporalesN = "<br><div class='col-lg-12 col-md-12 alert alert-success'> Usuarios Nuevos $usuarios_temporales_nuevos</div> ";
                } else {
                    $txt_temporalesN = "";
                }
                if ($usuarios_temporales_eliminados > 0) {
                    $txt_temporalesE = "<br><div class='col-lg-12 col-md-12 alert alert-danger'>Usuarios a Eliminar $usuarios_temporales_eliminados</div>";
                } else {
                    $txt_temporalesE = "";
                }

                if ($usuarios_temporales > 0) {
                    $btn_procesar = "<center><a href='?sw=actualizacion_usuarios&procesar=1' class='btn btn-info btn-sm'>Procesar Base Actual y Realizar Actualización</a></center>";
                } else {
                    $btn_procesar = "";
                }

                if ($procesar == "1") {
                    $actualizacion_realizada = "<center><div class='alert alert-success'>Actualizacion Realizada</div></center>";
                    truncate_tbl_usuario($id_empresa);
                    BorraDuplicados($tipo, $id_empresa);
                    //lee desde tbl_usuario_temporal
                    usuario_temporal_lee($id_empresa);


                } else {
                    $actualizacion_realizada = "";
                }
                $html = str_replace("{ACTUALIZACION_REALIZADA}", $actualizacion_realizada, $html);

                $html = str_replace("{TITULO_TOTAL_LISTA_TODOS}", $txt_temporales, $html);
                $html = str_replace("{TITULO_TOTAL_LISTA_NUEVOS}", $txt_temporalesN, $html);
                $html = str_replace("{TITULO_TOTAL_LISTA_ELIMINADOS}", $txt_temporalesE, $html);

                $html = str_replace("{PROCESAR}", $btn_procesar, $html);


                $html = str_replace("{TOTAL_LISTA_TODOS}", $usuarios_temporales, $html);
                $html = str_replace("{TOTAL_LISTA_NUEVOS}", $usuarios_temporales_nuevos, $html);
                $html = str_replace("{TOTAL_LISTA_ELIMINADOS}", $usuarios_temporales_eliminados, $html);


                $html = str_replace("{TITULO}", "Actualización de Usuarios", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_fn_tbl_mc_bac($html, $id_empresa, $temporal_actualizar, $procesar)
            {
                //$emb_embajadores=lista_emb_embajadores_data($id_empresa);
                $totalE_html = "";
                $totalN_html = "";

                if ($temporal_actualizar <> '') {
                    //echo "<br>temporales";

                    $Temporal_todos = BuscaTotalUsuariosTemporales($id_empresa, "TODOS");
                    foreach ($Temporal_todos as $unico) {
                        $usuarios_temporales++;
                    }

                    $Temporal_nuevos = BuscaTotalUsuariosTemporales($id_empresa, "NUEVOS");
                    foreach ($Temporal_nuevos as $unico) {
                        $usuarios_temporales_nuevos++;
                        $row = file_get_contents("views/usuarios_gestion/row_usuarios.html");
                        $row = str_replace("{RUT_COMPLETO}", utf8_encode($unico->rut_completo), $row);
                        $row = str_replace("{NOMBRE_COMPLETO}", utf8_encode($unico->nombre_completo), $row);
                        $row = str_replace("{CARGO}", utf8_encode($unico->cargo), $row);
                        $row = str_replace("{EMAIL}", utf8_encode($unico->email), $row);
                        $totalN_html .= $row;

                    }

                    $Temporal_noencontrados = BuscaTotalUsuariosTemporales($id_empresa, "NOENCONTRADOS");
                    foreach ($Temporal_noencontrados as $unico) {
                        $usuarios_temporales_eliminados++;
                        $rowe = file_get_contents("views/usuarios_gestion/row_usuarios.html");
                        $rowe = str_replace("{RUT_COMPLETO}", utf8_encode($unico->rut_completo), $rowe);
                        $rowe = str_replace("{NOMBRE_COMPLETO}", utf8_encode($unico->nombre_completo), $rowe);
                        $rowe = str_replace("{CARGO}", utf8_encode($unico->cargo), $rowe);
                        $rowe = str_replace("{EMAIL}", utf8_encode($unico->email), $rowe);
                        $totalE_html .= $rowe;

                    }

                } else {
                    //echo "<br>NO&nbsp;temporales";
                }

                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{LISTA_NUEVOS}", $totalN_html, $html);
                $html = str_replace("{LISTA_ELIMINADOS}", $totalE_html, $html);

                if ($usuarios_temporales > 0) {
                    $txt_temporales = "<div class='col-lg-12 col-md-12 alert alert-info'> Usuarios Ingresados en Base Temporal: $usuarios_temporales</div>";
                } else {
                    $txt_temporales = "";
                }
                if ($usuarios_temporales_nuevos > 0) {
                    $txt_temporalesN = "<br><div class='col-lg-12 col-md-12 alert alert-success'> Usuarios Nuevos $usuarios_temporales_nuevos</div> ";
                } else {
                    $txt_temporalesN = "";
                }
                if ($usuarios_temporales_eliminados > 0) {
                    $txt_temporalesE = "<br><div class='col-lg-12 col-md-12 alert alert-danger'>Usuarios a Eliminar $usuarios_temporales_eliminados</div>";
                } else {
                    $txt_temporalesE = "";
                }

                if ($usuarios_temporales > 0) {
                    $btn_procesar = "<center><a href='?sw=actualizacion_usuarios&procesar=1' class='btn btn-info btn-sm'>Procesar Base Actual y Realizar Actualización</a></center>";
                } else {
                    $btn_procesar = "";
                }

                if ($procesar == "1") {
                    $actualizacion_realizada = "<center><div class='alert alert-success'>Actualizacion Realizada</div></center>";
                    truncate_tbl_usuario($id_empresa);
                    BorraDuplicados($tipo, $id_empresa);
                    //lee desde tbl_usuario_temporal
                    usuario_temporal_lee($id_empresa);


                } else {
                    $actualizacion_realizada = "";
                }
                $html = str_replace("{ACTUALIZACION_REALIZADA}", $actualizacion_realizada, $html);

                $html = str_replace("{TITULO_TOTAL_LISTA_TODOS}", $txt_temporales, $html);
                $html = str_replace("{TITULO_TOTAL_LISTA_NUEVOS}", $txt_temporalesN, $html);
                $html = str_replace("{TITULO_TOTAL_LISTA_ELIMINADOS}", $txt_temporalesE, $html);

                $html = str_replace("{PROCESAR}", $btn_procesar, $html);


                $html = str_replace("{TOTAL_LISTA_TODOS}", $usuarios_temporales, $html);
                $html = str_replace("{TOTAL_LISTA_NUEVOS}", $usuarios_temporales_nuevos, $html);
                $html = str_replace("{TOTAL_LISTA_ELIMINADOS}", $usuarios_temporales_eliminados, $html);


                $html = str_replace("{TITULO}", "Actualización de Usuarios", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_fn_tbl_mc_poliza($html, $id_empresa, $temporal_actualizar, $procesar)
            {
                //$emb_embajadores=lista_emb_embajadores_data($id_empresa);
                $totalE_html = "";
                $totalN_html = "";

                if ($temporal_actualizar <> '') {
                    //echo "<br>temporales";

                    $Temporal_todos = BuscaTotalUsuariosTemporales($id_empresa, "TODOS");
                    foreach ($Temporal_todos as $unico) {
                        $usuarios_temporales++;
                    }

                    $Temporal_nuevos = BuscaTotalUsuariosTemporales($id_empresa, "NUEVOS");
                    foreach ($Temporal_nuevos as $unico) {
                        $usuarios_temporales_nuevos++;
                        $row = file_get_contents("views/usuarios_gestion/row_usuarios.html");
                        $row = str_replace("{RUT_COMPLETO}", utf8_encode($unico->rut_completo), $row);
                        $row = str_replace("{NOMBRE_COMPLETO}", utf8_encode($unico->nombre_completo), $row);
                        $row = str_replace("{CARGO}", utf8_encode($unico->cargo), $row);
                        $row = str_replace("{EMAIL}", utf8_encode($unico->email), $row);
                        $totalN_html .= $row;

                    }

                    $Temporal_noencontrados = BuscaTotalUsuariosTemporales($id_empresa, "NOENCONTRADOS");
                    foreach ($Temporal_noencontrados as $unico) {
                        $usuarios_temporales_eliminados++;
                        $rowe = file_get_contents("views/usuarios_gestion/row_usuarios.html");
                        $rowe = str_replace("{RUT_COMPLETO}", utf8_encode($unico->rut_completo), $rowe);
                        $rowe = str_replace("{NOMBRE_COMPLETO}", utf8_encode($unico->nombre_completo), $rowe);
                        $rowe = str_replace("{CARGO}", utf8_encode($unico->cargo), $rowe);
                        $rowe = str_replace("{EMAIL}", utf8_encode($unico->email), $rowe);
                        $totalE_html .= $rowe;

                    }

                } else {
                    //echo "<br>NO&nbsp;temporales";
                }

                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{LISTA_NUEVOS}", $totalN_html, $html);
                $html = str_replace("{LISTA_ELIMINADOS}", $totalE_html, $html);

                if ($usuarios_temporales > 0) {
                    $txt_temporales = "<div class='col-lg-12 col-md-12 alert alert-info'> Usuarios Ingresados en Base Temporal: $usuarios_temporales</div>";
                } else {
                    $txt_temporales = "";
                }
                if ($usuarios_temporales_nuevos > 0) {
                    $txt_temporalesN = "<br><div class='col-lg-12 col-md-12 alert alert-success'> Usuarios Nuevos $usuarios_temporales_nuevos</div> ";
                } else {
                    $txt_temporalesN = "";
                }
                if ($usuarios_temporales_eliminados > 0) {
                    $txt_temporalesE = "<br><div class='col-lg-12 col-md-12 alert alert-danger'>Usuarios a Eliminar $usuarios_temporales_eliminados</div>";
                } else {
                    $txt_temporalesE = "";
                }

                if ($usuarios_temporales > 0) {
                    $btn_procesar = "<center><a href='?sw=actualizacion_usuarios&procesar=1' class='btn btn-info btn-sm'>Procesar Base Actual y Realizar Actualización</a></center>";
                } else {
                    $btn_procesar = "";
                }

                if ($procesar == "1") {
                    $actualizacion_realizada = "<center><div class='alert alert-success'>Actualizacion Realizada</div></center>";
                    truncate_tbl_usuario($id_empresa);
                    BorraDuplicados($tipo, $id_empresa);
                    //lee desde tbl_usuario_temporal
                    usuario_temporal_lee($id_empresa);


                } else {
                    $actualizacion_realizada = "";
                }
                $html = str_replace("{ACTUALIZACION_REALIZADA}", $actualizacion_realizada, $html);

                $html = str_replace("{TITULO_TOTAL_LISTA_TODOS}", $txt_temporales, $html);
                $html = str_replace("{TITULO_TOTAL_LISTA_NUEVOS}", $txt_temporalesN, $html);
                $html = str_replace("{TITULO_TOTAL_LISTA_ELIMINADOS}", $txt_temporalesE, $html);

                $html = str_replace("{PROCESAR}", $btn_procesar, $html);


                $html = str_replace("{TOTAL_LISTA_TODOS}", $usuarios_temporales, $html);
                $html = str_replace("{TOTAL_LISTA_NUEVOS}", $usuarios_temporales_nuevos, $html);
                $html = str_replace("{TOTAL_LISTA_ELIMINADOS}", $usuarios_temporales_eliminados, $html);


                $html = str_replace("{TITULO}", "Actualización de Usuarios", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_gestion_usuarios_ubicaciones($html, $id_empresa, $temporal_actualizar, $procesar)
            {
                //$emb_embajadores=lista_emb_embajadores_data($id_empresa);
                $totalE_html = "";
                $totalN_html = "";

                if ($temporal_actualizar <> '') {
                    //echo "<br>temporales";

                    $Temporal_todos = BuscaTotalUsuariosTemporales($id_empresa, "TODOS");
                    foreach ($Temporal_todos as $unico) {
                        $usuarios_temporales++;
                    }

                    $Temporal_nuevos = BuscaTotalUsuariosTemporales($id_empresa, "NUEVOS");
                    foreach ($Temporal_nuevos as $unico) {
                        $usuarios_temporales_nuevos++;
                        $row = file_get_contents("views/usuarios_gestion/row_usuarios.html");
                        $row = str_replace("{RUT_COMPLETO}", utf8_encode($unico->rut_completo), $row);
                        $row = str_replace("{NOMBRE_COMPLETO}", utf8_encode($unico->nombre_completo), $row);
                        $row = str_replace("{CARGO}", utf8_encode($unico->cargo), $row);
                        $row = str_replace("{EMAIL}", utf8_encode($unico->email), $row);
                        $totalN_html .= $row;

                    }

                    $Temporal_noencontrados = BuscaTotalUsuariosTemporales($id_empresa, "NOENCONTRADOS");
                    foreach ($Temporal_noencontrados as $unico) {
                        $usuarios_temporales_eliminados++;
                        $rowe = file_get_contents("views/usuarios_gestion/row_usuarios.html");
                        $rowe = str_replace("{RUT_COMPLETO}", utf8_encode($unico->rut_completo), $rowe);
                        $rowe = str_replace("{NOMBRE_COMPLETO}", utf8_encode($unico->nombre_completo), $rowe);
                        $rowe = str_replace("{CARGO}", utf8_encode($unico->cargo), $rowe);
                        $rowe = str_replace("{EMAIL}", utf8_encode($unico->email), $rowe);
                        $totalE_html .= $rowe;

                    }

                } else {
                    //echo "<br>NO&nbsp;temporales";
                }

                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{LISTA_NUEVOS}", $totalN_html, $html);
                $html = str_replace("{LISTA_ELIMINADOS}", $totalE_html, $html);

                if ($usuarios_temporales > 0) {
                    $txt_temporales = "<div class='col-lg-12 col-md-12 alert alert-info'> Usuarios Ingresados en Base Temporal: $usuarios_temporales</div>";
                } else {
                    $txt_temporales = "";
                }
                if ($usuarios_temporales_nuevos > 0) {
                    $txt_temporalesN = "<br><div class='col-lg-12 col-md-12 alert alert-success'> Usuarios Nuevos $usuarios_temporales_nuevos</div> ";
                } else {
                    $txt_temporalesN = "";
                }
                if ($usuarios_temporales_eliminados > 0) {
                    $txt_temporalesE = "<br><div class='col-lg-12 col-md-12 alert alert-danger'>Usuarios a Eliminar $usuarios_temporales_eliminados</div>";
                } else {
                    $txt_temporalesE = "";
                }

                if ($usuarios_temporales > 0) {
                    $btn_procesar = "<center><a href='?sw=actualizacion_usuarios&procesar=1' class='btn btn-info btn-sm'>Procesar Base Actual y Realizar Actualización</a></center>";
                } else {
                    $btn_procesar = "";
                }

                if ($procesar == "1") {
                    $actualizacion_realizada = "<center><div class='alert alert-success'>Actualizacion Realizada</div></center>";
                    truncate_tbl_usuario($id_empresa);
                    BorraDuplicados($tipo, $id_empresa);
                    //lee desde tbl_usuario_temporal
                    usuario_temporal_lee($id_empresa);


                } else {
                    $actualizacion_realizada = "";
                }
                $html = str_replace("{ACTUALIZACION_REALIZADA}", $actualizacion_realizada, $html);

                $html = str_replace("{TITULO_TOTAL_LISTA_TODOS}", $txt_temporales, $html);
                $html = str_replace("{TITULO_TOTAL_LISTA_NUEVOS}", $txt_temporalesN, $html);
                $html = str_replace("{TITULO_TOTAL_LISTA_ELIMINADOS}", $txt_temporalesE, $html);

                $html = str_replace("{PROCESAR}", $btn_procesar, $html);


                $html = str_replace("{TOTAL_LISTA_TODOS}", $usuarios_temporales, $html);
                $html = str_replace("{TOTAL_LISTA_NUEVOS}", $usuarios_temporales_nuevos, $html);
                $html = str_replace("{TOTAL_LISTA_ELIMINADOS}", $usuarios_temporales_eliminados, $html);


                $html = str_replace("{TITULO}", "Actualización de Usuarios", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }


            function lista_gestion_dotacion_dia_21($html, $id_empresa, $temporal_actualizar, $procesar)
            {
                //$emb_embajadores=lista_emb_embajadores_data($id_empresa);
                $totalE_html = "";
                $totalN_html = "";

                if ($temporal_actualizar <> '') {
                    //echo "<br>temporales";

                    $Temporal_todos = BuscaTotalUsuariosTemporales($id_empresa, "TODOS");
                    foreach ($Temporal_todos as $unico) {
                        $usuarios_temporales++;
                    }

                    $Temporal_nuevos = BuscaTotalUsuariosTemporales($id_empresa, "NUEVOS");
                    foreach ($Temporal_nuevos as $unico) {
                        $usuarios_temporales_nuevos++;
                        $row = file_get_contents("views/usuarios_gestion/row_usuarios.html");
                        $row = str_replace("{RUT_COMPLETO}", utf8_encode($unico->rut_completo), $row);
                        $row = str_replace("{NOMBRE_COMPLETO}", utf8_encode($unico->nombre_completo), $row);
                        $row = str_replace("{CARGO}", utf8_encode($unico->cargo), $row);
                        $row = str_replace("{EMAIL}", utf8_encode($unico->email), $row);
                        $totalN_html .= $row;

                    }

                    $Temporal_noencontrados = BuscaTotalUsuariosTemporales($id_empresa, "NOENCONTRADOS");
                    foreach ($Temporal_noencontrados as $unico) {
                        $usuarios_temporales_eliminados++;
                        $rowe = file_get_contents("views/usuarios_gestion/row_usuarios.html");
                        $rowe = str_replace("{RUT_COMPLETO}", utf8_encode($unico->rut_completo), $rowe);
                        $rowe = str_replace("{NOMBRE_COMPLETO}", utf8_encode($unico->nombre_completo), $rowe);
                        $rowe = str_replace("{CARGO}", utf8_encode($unico->cargo), $rowe);
                        $rowe = str_replace("{EMAIL}", utf8_encode($unico->email), $rowe);
                        $totalE_html .= $rowe;

                    }

                } else {
                    //echo "<br>NO&nbsp;temporales";
                }

                $options_regimen = ControlDotacion2021_Options_Select_Regimen_Motivo_data();
                foreach ($options_regimen as $unico2) {
                    $options_regimen_motivo .= "<option value='" . utf8_encode($unico2->regimen_actual) . "-" . utf8_encode($unico2->motivo_actual) . "'>" . utf8_encode($unico2->regimen_actual) . "-" . utf8_encode($unico2->motivo_actual) . "</option>";
                }


                $html = str_replace("{options_regimen_motivo}", $options_regimen_motivo, $html);

                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{LISTA_NUEVOS}", $totalN_html, $html);
                $html = str_replace("{LISTA_ELIMINADOS}", $totalE_html, $html);

                if ($usuarios_temporales > 0) {
                    $txt_temporales = "<div class='col-lg-12 col-md-12 alert alert-info'> Usuarios Ingresados en Base Temporal: $usuarios_temporales</div>";
                } else {
                    $txt_temporales = "";
                }
                if ($usuarios_temporales_nuevos > 0) {
                    $txt_temporalesN = "<br><div class='col-lg-12 col-md-12 alert alert-success'> Usuarios Nuevos $usuarios_temporales_nuevos</div> ";
                } else {
                    $txt_temporalesN = "";
                }
                if ($usuarios_temporales_eliminados > 0) {
                    $txt_temporalesE = "<br><div class='col-lg-12 col-md-12 alert alert-danger'>Usuarios a Eliminar $usuarios_temporales_eliminados</div>";
                } else {
                    $txt_temporalesE = "";
                }

                if ($usuarios_temporales > 0) {
                    $btn_procesar = "<center><a href='?sw=actualizacion_usuarios&procesar=1' class='btn btn-info btn-sm'>Procesar Base Actual y Realizar Actualización</a></center>";
                } else {
                    $btn_procesar = "";
                }

                if ($procesar == "1") {
                    $actualizacion_realizada = "<center><div class='alert alert-success'>Actualizacion Realizada</div></center>";
                    truncate_tbl_usuario($id_empresa);
                    BorraDuplicados($tipo, $id_empresa);
                    //lee desde tbl_usuario_temporal
                    usuario_temporal_lee($id_empresa);


                } else {
                    $actualizacion_realizada = "";
                }
                $html = str_replace("{ACTUALIZACION_REALIZADA}", $actualizacion_realizada, $html);

                $html = str_replace("{TITULO_TOTAL_LISTA_TODOS}", $txt_temporales, $html);
                $html = str_replace("{TITULO_TOTAL_LISTA_NUEVOS}", $txt_temporalesN, $html);
                $html = str_replace("{TITULO_TOTAL_LISTA_ELIMINADOS}", $txt_temporalesE, $html);

                $html = str_replace("{PROCESAR}", $btn_procesar, $html);


                $html = str_replace("{TOTAL_LISTA_TODOS}", $usuarios_temporales, $html);
                $html = str_replace("{TOTAL_LISTA_NUEVOS}", $usuarios_temporales_nuevos, $html);
                $html = str_replace("{TOTAL_LISTA_ELIMINADOS}", $usuarios_temporales_eliminados, $html);


                $html = str_replace("{TITULO}", "Actualización de Usuarios", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }


            function lista_gestion_usuarios_dotacion_opciones($html, $id_empresa, $temporal_actualizar, $procesar)
            {
                //$emb_embajadores=lista_emb_embajadores_data($id_empresa);
                $totalE_html = "";
                $totalN_html = "";

                if ($temporal_actualizar <> '') {
                    //echo "<br>temporales";

                    $Temporal_todos = BuscaTotalUsuariosTemporales($id_empresa, "TODOS");
                    foreach ($Temporal_todos as $unico) {
                        $usuarios_temporales++;
                    }

                    $Temporal_nuevos = BuscaTotalUsuariosTemporales($id_empresa, "NUEVOS");
                    foreach ($Temporal_nuevos as $unico) {
                        $usuarios_temporales_nuevos++;
                        $row = file_get_contents("views/usuarios_gestion/row_usuarios.html");
                        $row = str_replace("{RUT_COMPLETO}", utf8_encode($unico->rut_completo), $row);
                        $row = str_replace("{NOMBRE_COMPLETO}", utf8_encode($unico->nombre_completo), $row);
                        $row = str_replace("{CARGO}", utf8_encode($unico->cargo), $row);
                        $row = str_replace("{EMAIL}", utf8_encode($unico->email), $row);
                        $totalN_html .= $row;

                    }

                    $Temporal_noencontrados = BuscaTotalUsuariosTemporales($id_empresa, "NOENCONTRADOS");
                    foreach ($Temporal_noencontrados as $unico) {
                        $usuarios_temporales_eliminados++;
                        $rowe = file_get_contents("views/usuarios_gestion/row_usuarios.html");
                        $rowe = str_replace("{RUT_COMPLETO}", utf8_encode($unico->rut_completo), $rowe);
                        $rowe = str_replace("{NOMBRE_COMPLETO}", utf8_encode($unico->nombre_completo), $rowe);
                        $rowe = str_replace("{CARGO}", utf8_encode($unico->cargo), $rowe);
                        $rowe = str_replace("{EMAIL}", utf8_encode($unico->email), $rowe);
                        $totalE_html .= $rowe;

                    }

                } else {
                    //echo "<br>NO&nbsp;temporales";
                }

                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{LISTA_NUEVOS}", $totalN_html, $html);
                $html = str_replace("{LISTA_ELIMINADOS}", $totalE_html, $html);

                if ($usuarios_temporales > 0) {
                    $txt_temporales = "<div class='col-lg-12 col-md-12 alert alert-info'> Usuarios Ingresados en Base Temporal: $usuarios_temporales</div>";
                } else {
                    $txt_temporales = "";
                }
                if ($usuarios_temporales_nuevos > 0) {
                    $txt_temporalesN = "<br><div class='col-lg-12 col-md-12 alert alert-success'> Usuarios Nuevos $usuarios_temporales_nuevos</div> ";
                } else {
                    $txt_temporalesN = "";
                }
                if ($usuarios_temporales_eliminados > 0) {
                    $txt_temporalesE = "<br><div class='col-lg-12 col-md-12 alert alert-danger'>Usuarios a Eliminar $usuarios_temporales_eliminados</div>";
                } else {
                    $txt_temporalesE = "";
                }

                if ($usuarios_temporales > 0) {
                    $btn_procesar = "<center><a href='?sw=actualizacion_usuarios&procesar=1' class='btn btn-info btn-sm'>Procesar Base Actual y Realizar Actualización</a></center>";
                } else {
                    $btn_procesar = "";
                }

                if ($procesar == "1") {
                    $actualizacion_realizada = "<center><div class='alert alert-success'>Actualizacion Realizada</div></center>";
                    truncate_tbl_usuario($id_empresa);
                    BorraDuplicados($tipo, $id_empresa);
                    //lee desde tbl_usuario_temporal
                    usuario_temporal_lee($id_empresa);


                } else {
                    $actualizacion_realizada = "";
                }
                $html = str_replace("{ACTUALIZACION_REALIZADA}", $actualizacion_realizada, $html);

                $html = str_replace("{TITULO_TOTAL_LISTA_TODOS}", $txt_temporales, $html);
                $html = str_replace("{TITULO_TOTAL_LISTA_NUEVOS}", $txt_temporalesN, $html);
                $html = str_replace("{TITULO_TOTAL_LISTA_ELIMINADOS}", $txt_temporalesE, $html);

                $html = str_replace("{PROCESAR}", $btn_procesar, $html);


                $html = str_replace("{TOTAL_LISTA_TODOS}", $usuarios_temporales, $html);
                $html = str_replace("{TOTAL_LISTA_NUEVOS}", $usuarios_temporales_nuevos, $html);
                $html = str_replace("{TOTAL_LISTA_ELIMINADOS}", $usuarios_temporales_eliminados, $html);


                $html = str_replace("{TITULO}", "Actualización de Usuarios", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_gestion_usuarios_cd($html, $id_empresa, $temporal_actualizar, $procesar)
            {
                //$emb_embajadores=lista_emb_embajadores_data($id_empresa);
                $totalE_html = "";
                $totalN_html = "";

                if ($temporal_actualizar <> '') {
                    //echo "<br>temporales";

                    $Temporal_todos = BuscaTotalUsuariosTemporales($id_empresa, "TODOS");
                    foreach ($Temporal_todos as $unico) {
                        $usuarios_temporales++;
                    }

                    $Temporal_nuevos = BuscaTotalUsuariosTemporales($id_empresa, "NUEVOS");
                    foreach ($Temporal_nuevos as $unico) {
                        $usuarios_temporales_nuevos++;
                        $row = file_get_contents("views/usuarios_gestion/row_usuarios.html");
                        $row = str_replace("{RUT_COMPLETO}", utf8_encode($unico->rut_completo), $row);
                        $row = str_replace("{NOMBRE_COMPLETO}", utf8_encode($unico->nombre_completo), $row);
                        $row = str_replace("{CARGO}", utf8_encode($unico->cargo), $row);
                        $row = str_replace("{EMAIL}", utf8_encode($unico->email), $row);
                        $totalN_html .= $row;

                    }

                    $Temporal_noencontrados = BuscaTotalUsuariosTemporales($id_empresa, "NOENCONTRADOS");
                    foreach ($Temporal_noencontrados as $unico) {
                        $usuarios_temporales_eliminados++;
                        $rowe = file_get_contents("views/usuarios_gestion/row_usuarios.html");
                        $rowe = str_replace("{RUT_COMPLETO}", utf8_encode($unico->rut_completo), $rowe);
                        $rowe = str_replace("{NOMBRE_COMPLETO}", utf8_encode($unico->nombre_completo), $rowe);
                        $rowe = str_replace("{CARGO}", utf8_encode($unico->cargo), $rowe);
                        $rowe = str_replace("{EMAIL}", utf8_encode($unico->email), $rowe);
                        $totalE_html .= $rowe;

                    }

                } else {
                    //echo "<br>NO&nbsp;temporales";
                }

                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{LISTA_NUEVOS}", $totalN_html, $html);
                $html = str_replace("{LISTA_ELIMINADOS}", $totalE_html, $html);

                if ($usuarios_temporales > 0) {
                    $txt_temporales = "<div class='col-lg-12 col-md-12 alert alert-info'> Usuarios Ingresados en Base Temporal: $usuarios_temporales</div>";
                } else {
                    $txt_temporales = "";
                }
                if ($usuarios_temporales_nuevos > 0) {
                    $txt_temporalesN = "<br><div class='col-lg-12 col-md-12 alert alert-success'> Usuarios Nuevos $usuarios_temporales_nuevos</div> ";
                } else {
                    $txt_temporalesN = "";
                }
                if ($usuarios_temporales_eliminados > 0) {
                    $txt_temporalesE = "<br><div class='col-lg-12 col-md-12 alert alert-danger'>Usuarios a Eliminar $usuarios_temporales_eliminados</div>";
                } else {
                    $txt_temporalesE = "";
                }

                if ($usuarios_temporales > 0) {
                    $btn_procesar = "<center><a href='?sw=actualizacion_usuarios&procesar=1' class='btn btn-info btn-sm'>Procesar Base Actual y Realizar Actualización</a></center>";
                } else {
                    $btn_procesar = "";
                }

                if ($procesar == "1") {
                    $actualizacion_realizada = "<center><div class='alert alert-success'>Actualizacion Realizada</div></center>";
                    truncate_tbl_usuario($id_empresa);
                    BorraDuplicados($tipo, $id_empresa);
                    //lee desde tbl_usuario_temporal
                    usuario_temporal_lee($id_empresa);


                } else {
                    $actualizacion_realizada = "";
                }
                $html = str_replace("{ACTUALIZACION_REALIZADA}", $actualizacion_realizada, $html);

                $html = str_replace("{TITULO_TOTAL_LISTA_TODOS}", $txt_temporales, $html);
                $html = str_replace("{TITULO_TOTAL_LISTA_NUEVOS}", $txt_temporalesN, $html);
                $html = str_replace("{TITULO_TOTAL_LISTA_ELIMINADOS}", $txt_temporalesE, $html);

                $html = str_replace("{PROCESAR}", $btn_procesar, $html);


                $html = str_replace("{TOTAL_LISTA_TODOS}", $usuarios_temporales, $html);
                $html = str_replace("{TOTAL_LISTA_NUEVOS}", $usuarios_temporales_nuevos, $html);
                $html = str_replace("{TOTAL_LISTA_ELIMINADOS}", $usuarios_temporales_eliminados, $html);
                $cuenta_dotacion_2021 = ControlDotacion2021_data();
                $cuenta_dotacion_cero_2021 = ControlDotacion2021_cero_data();


                $html = str_replace("{CONTROL_DOTACION_2021}", $cuenta_dotacion_2021, $html);
                $html = str_replace("{CONTROL_DOTACION_CERO_2021}", $cuenta_dotacion_cero_2021, $html);

                $html = str_replace("{TITULO}", "Actualización de Usuarios", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_gestion_usuarios_hhee($html, $id_empresa, $temporal_actualizar, $procesar)
            {
                //$emb_embajadores=lista_emb_embajadores_data($id_empresa);
                $totalE_html = "";
                $totalN_html = "";

                if ($temporal_actualizar <> '') {
                    //echo "<br>temporales";

                    $Temporal_todos = BuscaTotalUsuariosTemporales($id_empresa, "TODOS");
                    foreach ($Temporal_todos as $unico) {
                        $usuarios_temporales++;
                    }

                    $Temporal_nuevos = BuscaTotalUsuariosTemporales($id_empresa, "NUEVOS");
                    foreach ($Temporal_nuevos as $unico) {
                        $usuarios_temporales_nuevos++;
                        $row = file_get_contents("views/usuarios_gestion/row_usuarios.html");
                        $row = str_replace("{RUT_COMPLETO}", utf8_encode($unico->rut_completo), $row);
                        $row = str_replace("{NOMBRE_COMPLETO}", utf8_encode($unico->nombre_completo), $row);
                        $row = str_replace("{CARGO}", utf8_encode($unico->cargo), $row);
                        $row = str_replace("{EMAIL}", utf8_encode($unico->email), $row);
                        $totalN_html .= $row;

                    }

                    $Temporal_noencontrados = BuscaTotalUsuariosTemporales($id_empresa, "NOENCONTRADOS");
                    foreach ($Temporal_noencontrados as $unico) {
                        $usuarios_temporales_eliminados++;
                        $rowe = file_get_contents("views/usuarios_gestion/row_usuarios.html");
                        $rowe = str_replace("{RUT_COMPLETO}", utf8_encode($unico->rut_completo), $rowe);
                        $rowe = str_replace("{NOMBRE_COMPLETO}", utf8_encode($unico->nombre_completo), $rowe);
                        $rowe = str_replace("{CARGO}", utf8_encode($unico->cargo), $rowe);
                        $rowe = str_replace("{EMAIL}", utf8_encode($unico->email), $rowe);
                        $totalE_html .= $rowe;

                    }

                } else {
                    //echo "<br>NO&nbsp;temporales";
                }

                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{LISTA_NUEVOS}", $totalN_html, $html);
                $html = str_replace("{LISTA_ELIMINADOS}", $totalE_html, $html);

                if ($usuarios_temporales > 0) {
                    $txt_temporales = "<div class='col-lg-12 col-md-12 alert alert-info'> Usuarios Ingresados en Base Temporal: $usuarios_temporales</div>";
                } else {
                    $txt_temporales = "";
                }
                if ($usuarios_temporales_nuevos > 0) {
                    $txt_temporalesN = "<br><div class='col-lg-12 col-md-12 alert alert-success'> Usuarios Nuevos $usuarios_temporales_nuevos</div> ";
                } else {
                    $txt_temporalesN = "";
                }
                if ($usuarios_temporales_eliminados > 0) {
                    $txt_temporalesE = "<br><div class='col-lg-12 col-md-12 alert alert-danger'>Usuarios a Eliminar $usuarios_temporales_eliminados</div>";
                } else {
                    $txt_temporalesE = "";
                }

                if ($usuarios_temporales > 0) {
                    $btn_procesar = "<center><a href='?sw=actualizacion_usuarios&procesar=1' class='btn btn-info btn-sm'>Procesar Base Actual y Realizar Actualización</a></center>";
                } else {
                    $btn_procesar = "";
                }

                if ($procesar == "1") {
                    $actualizacion_realizada = "<center><div class='alert alert-success'>Actualizacion Realizada</div></center>";
                    truncate_tbl_usuario($id_empresa);
                    BorraDuplicados($tipo, $id_empresa);
                    //lee desde tbl_usuario_temporal
                    usuario_temporal_lee($id_empresa);


                } else {
                    $actualizacion_realizada = "";
                }
                $html = str_replace("{ACTUALIZACION_REALIZADA}", $actualizacion_realizada, $html);

                $html = str_replace("{TITULO_TOTAL_LISTA_TODOS}", $txt_temporales, $html);
                $html = str_replace("{TITULO_TOTAL_LISTA_NUEVOS}", $txt_temporalesN, $html);
                $html = str_replace("{TITULO_TOTAL_LISTA_ELIMINADOS}", $txt_temporalesE, $html);

                $html = str_replace("{PROCESAR}", $btn_procesar, $html);


                $html = str_replace("{TOTAL_LISTA_TODOS}", $usuarios_temporales, $html);
                $html = str_replace("{TOTAL_LISTA_NUEVOS}", $usuarios_temporales_nuevos, $html);
                $html = str_replace("{TOTAL_LISTA_ELIMINADOS}", $usuarios_temporales_eliminados, $html);


                $html = str_replace("{TITULO}", "Actualización de Usuarios", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_asignacion($html, $id_empresa, $idcategoria)
            {
                //$emb_embajadores=lista_emb_embajadores_data($id_empresa);
                $row = file_get_contents("views/puntos/entorno_puntos_asignacion.html");
                $lista = lista_asignacion_usuarios_data($id_empresa);
                foreach ($lista as $unico) {
                    $datosusuario = TraeDatosUsuario($unico->rut);

                    $row = file_get_contents("views/puntos/row_puntos_asignacion.html");
                    $row = str_replace("{RUT_COMPLETO}", utf8_encode($datosusuario[0]->rut_completo), $row);
                    $row = str_replace("{NOMBRE_COMPLETO}", utf8_encode($datosusuario[0]->nombre_completo), $row);
                    $row = str_replace("{CARGO}", utf8_encode($datosusuario[0]->cargo), $row);
                    $row = str_replace("{DIVISION}", utf8_encode($datosusuario[0]->division), $row);
                    $row = str_replace("{NUM_EQUIPO}", utf8_encode($datosNumEquipo), $row);
                    $row = str_replace("{RECIBIDOS}", utf8_encode($unico->recibidos), $row);
                    $row = str_replace("{ENTREGADOS}", utf8_encode($unico->entregados), $row);
                    $row = str_replace("{PENDIENTES}", utf8_encode($unico->saldo), $row);

                    $total_html .= $row;

                }

                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Asignación de Puntos a usuarios", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_asignacion_jefe($html, $id_empresa, $idcategoria)
            {
                //$emb_embajadores=lista_emb_embajadores_data($id_empresa);
                $row = file_get_contents("views/puntos/entorno_puntos_asignacion_jefe.html");
                $lista = lista_asignacion_jefaturas_data($id_empresa);
                foreach ($lista as $unico) {
                    $datosusuario = TraeDatosUsuario($unico->rut);
                    $datosNumEquipo = TraeDatosJefeNumEquipo($unico->rut);

                    $row = file_get_contents("views/puntos/row_puntos_asignacion_jefe.html");
                    $row = str_replace("{RUT_COMPLETO}", utf8_encode($datosusuario[0]->rut_completo), $row);
                    $row = str_replace("{NOMBRE_COMPLETO}", utf8_encode($datosusuario[0]->nombre_completo), $row);
                    $row = str_replace("{CARGO}", utf8_encode($datosusuario[0]->cargo), $row);
                    $row = str_replace("{DIVISION}", utf8_encode($datosusuario[0]->division), $row);
                    $row = str_replace("{NUM_EQUIPO}", utf8_encode($datosNumEquipo), $row);
                    $row = str_replace("{RECIBIDOS}", utf8_encode($unico->recibidos), $row);
                    $row = str_replace("{ENTREGADOS}", utf8_encode($unico->entregados), $row);
                    $row = str_replace("{PENDIENTES}", utf8_encode($unico->saldo), $row);

                    $total_html .= $row;

                }

                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Asignación de Puntos a Jefaturas", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }


            function lista_excepcion($html, $id_empresa, $idcategoria)
            {
                //$emb_embajadores=lista_emb_embajadores_data($id_empresa);
                $row = file_get_contents("views/puntos/entorno_excepcion_usuarios.html");
                foreach ($emb_embajadores as $unico) {
                    $row = file_get_contents("views/embajadores/row_emb_inscribir.html");
                    $row = str_replace("{ID}", utf8_encode($unico->id), $row);
                    $row = str_replace("{RUT_COMPLETO}", utf8_encode($unico->rut_completo), $row);
                    $row = str_replace("{NOMBRE_COMPLETO}", utf8_encode($unico->nombre_completo), $row);
                    $row = str_replace("{CARGO}", utf8_encode($unico->cargo), $row);
                    $row = str_replace("{GERENCIA}", utf8_encode($unico->gerencia), $row);
                    $row = str_replace("{GERENCIAR2}", utf8_encode($unico->gerenciaR2), $row);
                    $row = str_replace("{GERENCIAR3}", utf8_encode($unico->gerenciaR3), $row);
                    $row = str_replace("{OLA}", utf8_encode($unico->nombre_ola), $row);
                    $row = str_replace("{OLA}", utf8_encode($unico->nombre_ola), $row);
                    $row = str_replace("{OLA}", utf8_encode($unico->nombre_ola), $row);
                    $row = str_replace("{OLA}", utf8_encode($unico->nombre_ola), $row);
                    $row = str_replace("{RUT_TUTOR}", utf8_encode($unico->rut_tutor), $row);
                    $row = str_replace("{NOMBRE_COMPLETO_TUTOR}", utf8_encode($unico->nombre_completo_tutor), $row);
                    $row = str_replace("{CARGO_TUTOR}", utf8_encode($unico->cargo_tutor), $row);
                    $total_html .= $row;
                }
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Excepciones de Usuarios Items", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_asignacion_notificaciones($html, $id_empresa, $idcategoria)
            {
                //$emb_embajadores=lista_emb_embajadores_data($id_empresa);
                $row = file_get_contents("views/puntos/entorno_puntos_asignacion.html");
                foreach ($emb_embajadores as $unico) {
                    $row = file_get_contents("views/embajadores/row_emb_inscribir.html");
                    $row = str_replace("{ID}", utf8_encode($unico->id), $row);
                    $row = str_replace("{RUT_COMPLETO}", utf8_encode($unico->rut_completo), $row);
                    $row = str_replace("{NOMBRE_COMPLETO}", utf8_encode($unico->nombre_completo), $row);
                    $row = str_replace("{CARGO}", utf8_encode($unico->cargo), $row);
                    $row = str_replace("{GERENCIA}", utf8_encode($unico->gerencia), $row);
                    $row = str_replace("{GERENCIAR2}", utf8_encode($unico->gerenciaR2), $row);
                    $row = str_replace("{GERENCIAR3}", utf8_encode($unico->gerenciaR3), $row);
                    $row = str_replace("{OLA}", utf8_encode($unico->nombre_ola), $row);
                    $row = str_replace("{OLA}", utf8_encode($unico->nombre_ola), $row);
                    $row = str_replace("{OLA}", utf8_encode($unico->nombre_ola), $row);
                    $row = str_replace("{OLA}", utf8_encode($unico->nombre_ola), $row);
                    $row = str_replace("{RUT_TUTOR}", utf8_encode($unico->rut_tutor), $row);
                    $row = str_replace("{NOMBRE_COMPLETO_TUTOR}", utf8_encode($unico->nombre_completo_tutor), $row);
                    $row = str_replace("{CARGO_TUTOR}", utf8_encode($unico->cargo_tutor), $row);
                    $total_html .= $row;
                }
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Asignación de Notificaciones a usuarios", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_emb_tutores($html, $id_empresa, $idcategoria)
            {
                $emb_tutores = lista_emb_tutores_data($id_empresa);
                $row = file_get_contents("views/embajadores/entorno_emb_tutores.html");
                foreach ($emb_tutores as $unico) {
                    $row = file_get_contents("views/embajadores/row_emb_tutores.html");
                    $row = str_replace("{ID}", utf8_encode($unico->id), $row);
                    $row = str_replace("{RUT_COMPLETO}", utf8_encode($unico->rut_completo), $row);
                    $row = str_replace("{NOMBRE_COMPLETO}", utf8_encode($unico->nombre_completo), $row);
                    $row = str_replace("{CARGO}", utf8_encode($unico->cargo), $row);
                    $row = str_replace("{GERENCIA}", utf8_encode($unico->gerencia), $row);
                    $row = str_replace("{GERENCIAR2}", utf8_encode($unico->gerenciaR2), $row);
                    $row = str_replace("{GERENCIAR3}", utf8_encode($unico->gerenciaR3), $row);
// EMBAJADORES ASIGNADOS
                    $listas_emb = "";
                    $emb_embajadores = lista_emb_tutores_data_asignacion($unico->rut, $id_empresa);
                    foreach ($emb_embajadores as $emb_embajador) {
                        $listas_emb .= "" . utf8_encode($emb_embajador->nombre_completo) . "<br>";
                    }
                    $row = str_replace("{EMBAJADORES_ASIGNADOS}", $listas_emb, $row);
                    $total_html .= $row;
                }
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Gestión de Tutores", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_emb_embajadores_avance($html, $id_empresa, $idcategoria)
            {
                // $emb_embajadores=emb_lista_tarea_resultado_avance($id_empresa,"");
                // $row=file_get_contents("views/embajadores/entorno_emb_reportes.html");
                // foreach($emb_embajadores as $unico){
                $row = file_get_contents("views/embajadores/row_emb_reportes.html");
                $row = str_replace("{RUT_EMBAJADOR}", utf8_encode($unico->rut_embajador), $row);
                $row = str_replace("{NOMBRE_EMBAJADOR}", utf8_encode($unico->nombre_embajadores), $row);
                $row = str_replace("{RUT_ASESOR}", utf8_encode($unico->rut_asesor), $row);
                $row = str_replace("{NOMBRE_ASESOR}", utf8_encode($unico->nombre_asesor), $row);
                $row = str_replace("{NOMBRE_ASESOR}", utf8_encode($unico->nombre_asesor), $row);
                $row = str_replace("{GRUPO_INTERES}", utf8_encode($unico->codigo), $row);
                $row = str_replace("{AVANCE}", utf8_encode(round($unico->avance)), $row);
                $total_html .= $row;
                //           }
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Reportes Grupos Cerrados", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_emb_rel_embajadores_tareas($html, $id_empresa, $idcategoria)
            {
                $emb_embajadores = lista_emb_rel_embajadores_tareas_data($id_empresa);
                $row = file_get_contents("views/embajadores/entorno_emb_relemb.html");
                foreach ($emb_embajadores as $unico) {

                    // if($unico->rut=="10365815")   {echo "<br>rut ".$unico->rut;}


                    $array_usuario = TraeDatosUsuario($unico->rut);
                    $row = file_get_contents("views/embajadores/row_emb_emb_tareas.html");
                    $row = str_replace("{ID}", utf8_encode($unico->id), $row);
                    $row = str_replace("{RUT}", utf8_encode($array_usuario[0]->rut), $row);
                    $row = str_replace("{RUT_COMPLETO}", utf8_encode($array_usuario[0]->rut_completo), $row);
                    $row = str_replace("{EMAIL}", utf8_encode($unico->email), $row);

                    $row = str_replace("{NOMBRE_COMPLETO}", utf8_encode($array_usuario[0]->nombre_completo), $row);
                    $row = str_replace("{CARGO}", utf8_encode($array_usuario[0]->cargo), $row);
                    $row = str_replace("{GERENCIA}", utf8_encode($array_usuario[0]->gerencia), $row);
                    $row = str_replace("{GERENCIAR2}", utf8_encode($array_usuario[0]->gerenciaR2), $row);
                    $row = str_replace("{GERENCIAR3}", utf8_encode($array_usuario[0]->gerenciaR3), $row);
                    $row = str_replace("{OLA}", utf8_encode($unico->nombre_ola), $row);
                    $row = str_replace("{ID_OLA}", utf8_encode($unico->codigo), $row);
                    $row = str_replace("{ID_TAREA}", utf8_encode($unico->id_tarea), $row);
                    $row = str_replace("{TAREA}", utf8_encode($unico->nombretarea), $row);
                    $row = str_replace("{FECHA_REGISTRO}", utf8_encode($unico->fecha_registro), $row);
                    $row = str_replace("{COMENTARIOS}", utf8_encode($unico->comentarios), $row);
                    $row = str_replace("{FECHA_VALIDACION}", utf8_encode($unico->fecha_validacion), $row);
                    $row = str_replace("{ESTADO}", utf8_encode($unico->estado), $row);
                    $row = str_replace("{TRABAJASTE}", utf8_encode($unico->trabajaste), $row);
                    $row = str_replace("{LINK}", utf8_encode($unico->link), $row);
                    //busca tareas asignadas
                    $tareas = "";
                    $emb_tareas = lista_rel_emb_tareas_data($unico->rut, $id_empresa);
                    foreach ($emb_tareas as $emb_tarea) {
                        $tareas .= utf8_encode($emb_tarea->nombre_tarea) . "<br>";
                    }
                    $row = str_replace("{TAREAS}", ($tareas), $row);
                    $total_html .= $row;
                }
// lista olas
                $emb_olas = lista_emb_olas_data_solo($id_empresa);
                foreach ($emb_olas as $emb_ola) {
                    $listas_olas .= "<option value='" . $emb_ola->codigo . "'><small>" . utf8_encode($emb_ola->nombre) . "</small></option>";
                }
                $html = str_replace("{EMB_OLAS}", $listas_olas, $html);
// LISTA EMBAJADORES
                $emb_embajadores = lista_emb_embajadores_data_order($id_empresa);
                foreach ($emb_embajadores as $emb_embajador) {
                    $listas_embajadores .= "<option value='" . $emb_embajador->rut . "'><small>" . utf8_encode($emb_embajador->email) . "</small></option>";
                }
                $html = str_replace("{EMB_LISTA_EMBAJADORES}", $listas_embajadores, $html);
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Tareas por Embajadores", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_ejecutivos($html, $id_empresa, $idcategoria)
            {
                $ExpertosPracticas = TraeEjecutivosPorEmpresa2($id_empresa);
                //print_r($ExpertosPracticas);
                //$categorias_options=mp_busca_Categorias($id_empresa);
                //print_r($categorias_options);
                $row = file_get_contents("views/ejecutivos/entorno_expertos.html");
                foreach ($ExpertosPracticas as $ExpertoPractica) {
                    //    print_r($ExpertoPractica);
                    $row = file_get_contents("views/ejecutivos/lista_practicas_edit_expertos.html");
                    $row = str_replace("{ID_EXPERTO}", utf8_encode($ExpertoPractica->id), $row);
                    $row = str_replace("{RUT_EXPERTO}", utf8_encode($ExpertoPractica->rut), $row);
                    $row = str_replace("{RUT}", utf8_encode($ExpertoPractica->codigo), $row);
                    $row = str_replace("{EXPERTO}", utf8_encode($ExpertoPractica->nombre_completo), $row);
                    $row = str_replace("{CARGO}", utf8_encode($ExpertoPractica->cargo), $row);
                    $row = str_replace("{GERENCIA}", utf8_encode($ExpertoPractica->gerencia), $row);
                    $row = str_replace("{GRUPO}", utf8_encode($ExpertoPractica->categoria), $row);
                    $row = str_replace("{IDGRUPO}", utf8_encode($ExpertoPractica->contenido), $row);
                    $row = str_replace("{OPTIONS_CATEGORIAS_MEJORES_PRACTICAS}", utf8_encode($categorias_options), $row);
                    $total_html .= $row;
                }
                $total_html = str_replace("{NIVEL}", "2", $total_html);
                $total_html = str_replace("{SUB_CAT}", "", $total_html);
                $total_html = str_replace("{NSUB}", "", $total_html);
                $html = str_replace("{OPTIONS_CATEGORIAS_MEJORES_PRACTICAS_NUEVO}", utf8_encode($categorias_options), $html);
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Preguntas y Respuestas", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_usuarios_preguntados($html, $id_empresa, $id_objeto, $excel)
            {
                $Usuarios_Preguntados = Preg_lista_usuarios_data($id_empresa, $id_objeto);
                $row = file_get_contents("views/preguntados/entorno_usuarios_preguntados.html");
                foreach ($Usuarios_Preguntados as $Usuarios_Preguntado) {
                    $preg_arregloresultados = Preg_datos_Detalle_usuario($id_empresa, $id_objeto, $Usuarios_Preguntado->rut);
                    //    print_r($preg_arregloresultados);
                    $row = file_get_contents("views/preguntados/lista_practicas_usuarios_preguntados.html");
                    $row = str_replace("{RUT_PREGUNTADOS}", utf8_encode($Usuarios_Preguntado->rut_completo), $row);
                    $row = str_replace("{NOMBRE_PREGUNTADOS}", utf8_encode($Usuarios_Preguntado->nombre_completo), $row);
                    $row = str_replace("{JUGADOS}", utf8_encode($preg_arregloresultados[0]->vecesjugado), $row);
                    $row = str_replace("{GANADOS}", utf8_encode($preg_arregloresultados[0]->total_veces_ganado), $row);
                    $row = str_replace("{PUNTOS}", utf8_encode($preg_arregloresultados[0]->suma_correctas), $row);
                    $total_html .= $row;
                }
                $total_html = str_replace("{NIVEL}", "2", $total_html);
                $total_html = str_replace("{SUB_CAT}", "", $total_html);
                $total_html = str_replace("{NSUB}", "", $total_html);
                $html = str_replace("{OPTIONS_CATEGORIAS_MEJORES_PRACTICAS_NUEVO}", utf8_encode($categorias_options), $html);
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Preguntas y Respuestas", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_preguntas_preguntados($html, $id_empresa, $id_objeto, $excel)
            {
                $Preguntas_Preguntados = Preg_datos_detalle_preguntas($id_empresa, $id_objeto);
                $row = file_get_contents("views/preguntados/entorno_preguntas_preguntados.html");
                foreach ($Preguntas_Preguntados as $Pregunta_Preguntado) {
                    $row = file_get_contents("views/preguntados/lista_practicas_preguntas_preguntados.html");
                    $row = str_replace("{PREGUNTA}", utf8_encode($Pregunta_Preguntado->pregunta), $row);
                    $row = str_replace("{VECES}", utf8_encode($Pregunta_Preguntado->Respondida), $row);
                    $row = str_replace("{CORRECTAS}", utf8_encode($Pregunta_Preguntado->Correcta), $row);
                    $row = str_replace("{PORCENTAJE}", utf8_encode($Pregunta_Preguntado->Porcentaje), $row);
                    $total_html .= $row;
                }
                $total_html = str_replace("{NIVEL}", "2", $total_html);
                $total_html = str_replace("{SUB_CAT}", "", $total_html);
                $total_html = str_replace("{NSUB}", "", $total_html);
                $html = str_replace("{OPTIONS_CATEGORIAS_MEJORES_PRACTICAS_NUEVO}", utf8_encode($categorias_options), $html);
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Preguntas y Respuestas", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_preguntas_preguntados_excel($id_empresa, $id_objeto, $excel)
            {
                $Preguntas_Preguntados = Preg_datos_detalle_preguntas($id_empresa, $id_objeto);
                return ($Preguntas_Preguntados);
            }

            function lista_usuarios_preguntados_excel($id_empresa, $id_objeto, $excel)
            {
                $Usuarios_Preguntados = Preg_lista_usuarios_data($id_empresa, $id_objeto);
                $cuenta = 0;
                foreach ($Usuarios_Preguntados as $Usuarios_Preguntado) {
                    $preg_arregloresultados = Preg_datos_Detalle_usuario($id_empresa, $id_objeto, $Usuarios_Preguntado->rut);
                    $Arreglo_usuario[$cuenta]->rut_completo = $Usuarios_Preguntado->rut_completo;
                    $Arreglo_usuario[$cuenta]->nombre_completo = $Usuarios_Preguntado->nombre_completo;
                    $Arreglo_usuario[$cuenta]->vecesjugado = $preg_arregloresultados[0]->vecesjugado;
                    $Arreglo_usuario[$cuenta]->total_veces_ganado = $preg_arregloresultados[0]->total_veces_ganado;
                    $Arreglo_usuario[$cuenta]->suma_correctas = $preg_arregloresultados[0]->suma_correctas;
                    $cuenta++;
                }
                return $Arreglo_usuario;
            }

            function lista_relatores($html, $id_empresa, $idcategoria)
            {
                $ExpertosPracticas = TraeRelatoresPorEmpresa2($id_empresa);
                $row = file_get_contents("views/relatores/entorno_expertos.html");
                foreach ($ExpertosPracticas as $ExpertoPractica) {
                    $row = file_get_contents("views/relatores/lista_practicas_edit_expertos.html");
                    $row = str_replace("{ID_RELATOR}", utf8_encode($ExpertoPractica->id), $row);
                    $row = str_replace("{ID_USUARIO}", utf8_encode($ExpertoPractica->rut_completo), $row);
                    $row = str_replace("{NOMBRE_RELATOR}", utf8_encode($ExpertoPractica->nombre), $row);
                    $row = str_replace("{EMPRESA_RELATOR}", utf8_encode($ExpertoPractica->empresa), $row);
                    $row = str_replace("{TIPO_RELATOR}", utf8_encode($ExpertoPractica->cargo), $row);
                    $total_html .= $row;
                }
                $total_html = str_replace("{NIVEL}", "2", $total_html);
                $total_html = str_replace("{SUB_CAT}", "", $total_html);
                $total_html = str_replace("{NSUB}", "", $total_html);
                $html = str_replace("{OPTIONS_CATEGORIAS_MEJORES_PRACTICAS_NUEVO}", utf8_encode($categorias_options), $html);
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Preguntas y Respuestas", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_mediciones_row($html, $id_empresa, $idcategoria)
            {
                $ExpertosPracticas = TraeMedicionesEmpresa($id_empresa);
                $row = file_get_contents("views/mediciones/entorno_mediciones_row.html");
                // $listabancopregunta=MedicionListaBancoPreguntas($id_empresa);
                foreach ($ExpertosPracticas as $ExpertoPractica) {
                    //print_r($ExpertoPractica);

                    //$acceso=BuscaPerfilDeRutAdmin($_SESSION["admin_"]);
                    //echo "acceso $acceso";
                    //print_r($ExpertoPractica);

                    if ($ExpertoPractica->invisibleadmin == 1 and $acceso <> "99") {
                        continue;
                    }


                    $row = file_get_contents("views/mediciones/lista_practicas_edit_mediciones.html");
                    $row = str_replace("{ID_MEDICION}", utf8_encode($ExpertoPractica->id), $row);
                    $row = str_replace("{NOMBRE_MEDICION}", utf8_encode($ExpertoPractica->nombre), $row);
                    $row = str_replace("{BANCO_PREGUNTA}", utf8_encode($ExpertoPractica->bancopreguntas), $row);
                    $row = str_replace("{ID_BANCO_PREGUNTA}", utf8_encode($ExpertoPractica->id_encuesta), $row);
                    $row = str_replace("{TIPO_MEDICION}", utf8_encode($ExpertoPractica->tipo_medicion), $row);
                    $row = str_replace("{FECHA1}", utf8_encode($ExpertoPractica->fecha1), $row);
                    $row = str_replace("{FECHA2}", utf8_encode($ExpertoPractica->fecha2), $row);
                    $row = str_replace("{FECHA3}", utf8_encode($ExpertoPractica->fecha3), $row);
                    $num_correos_enviados = MedCuentaEmailsEnviados($ExpertoPractica->id, $id_empresa);
                    $row = str_replace("{NUM_ENVIOS}", utf8_encode($num_correos_enviados), $row);
                    $row = str_replace("{NUM_PREGUNTA}", utf8_encode($ExpertoPractica->cuentapreguntas), $row);
                    $row = str_replace("{NUM_USUARIOS}", utf8_encode($ExpertoPractica->cuentausuarios), $row);
                    $row = str_replace("{NUM_USUARIOS_Respuestas}", utf8_encode($ExpertoPractica->cuentarespuestas), $row);
                    $row = str_replace("{OPTIONS_LISTA_BANCO_PREGUNTAS_MEDICIONES}", utf8_encode($listabancopregunta), $row);
                    $total_html .= $row;
                }
                $total_html = str_replace("{NIVEL}", "2", $total_html);
                $total_html = str_replace("{SUB_CAT}", "", $total_html);
                $total_html = str_replace("{NSUB}", "", $total_html);
                $html = str_replace("{OPTIONS_LISTA_BANCO_PREGUNTAS_MEDICIONES}", utf8_encode($listabancopregunta), $html);
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Preguntas y Respuestas", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_evaluaciones($html, $id_empresa, $idcategoria)
            {
                $ExpertosPracticas = TraeEvaluacionesPorEmpresa($id_empresa);
                $row = file_get_contents("views/evaluaciones/entorno_evaluaciones.html");
                foreach ($ExpertosPracticas as $ExpertoPractica) {
                    $arreglo_cursos = traeCursosPorEvaluaciones($id_empresa, $ExpertoPractica->id);
                    $lista_cursos = "";
                    foreach ($arreglo_cursos as $arreglo_curso) {
                        $lista_cursos .= "(" . $arreglo_curso->id_curso . ") " . utf8_encode($arreglo_curso->nombre) . "<br>";
                    }
                    $row = file_get_contents("views/evaluaciones/lista_practicas_edit_evaluaciones.html");
                    $row = str_replace("{ID_EVALUACION}", utf8_encode($ExpertoPractica->id), $row);
                    $row = str_replace("{NOMBRE_EVALUACION}", utf8_encode($ExpertoPractica->nombre_evaluacion), $row);
                    $row = str_replace("{CURSOS_UTILIZADOS}", $lista_cursos, $row);
                    $row = str_replace("{NUM_PREGUNTAS}", utf8_encode($ExpertoPractica->num_preguntas), $row);
                    $row = str_replace("{TIPO_RELATOR}", utf8_encode($ExpertoPractica->cargo), $row);
                    $total_html .= $row;
                }
                $total_html = str_replace("{NIVEL}", "2", $total_html);
                $total_html = str_replace("{SUB_CAT}", "", $total_html);
                $total_html = str_replace("{NSUB}", "", $total_html);
                $html = str_replace("{OPTIONS_CATEGORIAS_MEJORES_PRACTICAS_NUEVO}", utf8_encode($categorias_options), $html);
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Preguntas y Respuestas", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_mediciones($html, $id_empresa, $idcategoria)
            {
                $ExpertosPracticas = TraeMedicionesPorEmpresa($id_empresa);
                $row = file_get_contents("views/mediciones/entorno_mediciones.html");
                foreach ($ExpertosPracticas as $ExpertoPractica) {
                    $row = file_get_contents("views/mediciones/lista_practicas_edit_evaluaciones.html");
                    $row = str_replace("{ID_EVALUACION}", utf8_encode($ExpertoPractica->id), $row);
                    $row = str_replace("{NOMBRE_EVALUACION}", utf8_encode($ExpertoPractica->nombre), $row);
                    $row = str_replace("{CURSOS_UTILIZADOS}", $lista_cursos, $row);
                    $row = str_replace("{NUM_PREGUNTAS}", utf8_encode($ExpertoPractica->num_preguntas), $row);
                    $row = str_replace("{TIPO_RELATOR}", utf8_encode($ExpertoPractica->cargo), $row);
                    $total_html .= $row;
                }
                $total_html = str_replace("{NIVEL}", "2", $total_html);
                $total_html = str_replace("{SUB_CAT}", "", $total_html);
                $total_html = str_replace("{NSUB}", "", $total_html);
                $html = str_replace("{OPTIONS_CATEGORIAS_MEJORES_PRACTICAS_NUEVO}", utf8_encode($categorias_options), $html);
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Preguntas y Respuestas", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_banco_preguntas_detalle($html, $id_empresa, $idcategoria)
            {
                $ExpertosPracticas = TraeMedicionesPorEmpresa($id_empresa);
                $row = file_get_contents("views/encuestas_creacion_lb/entorno_encuestas.html");
                foreach ($ExpertosPracticas as $ExpertoPractica) {
                    $row = file_get_contents("views/encuestas_creacion_lb/listas_encuestas.html");
                    $row = str_replace("{ID_EVALUACION}", utf8_encode($ExpertoPractica->id), $row);
                    $row = str_replace("{NOMBRE_EVALUACION}", utf8_encode($ExpertoPractica->nombre), $row);
                    $row = str_replace("{CURSOS_UTILIZADOS}", $lista_cursos, $row);
                    $row = str_replace("{NUM_PREGUNTAS}", utf8_encode($ExpertoPractica->num_preguntas), $row);
                    $row = str_replace("{TIPO_RELATOR}", utf8_encode($ExpertoPractica->cargo), $row);
                    $total_html .= $row;
                }
                $total_html = str_replace("{NIVEL}", "2", $total_html);
                $total_html = str_replace("{SUB_CAT}", "", $total_html);
                $total_html = str_replace("{NSUB}", "", $total_html);
                $html = str_replace("{OPTIONS_CATEGORIAS_MEJORES_PRACTICAS_NUEVO}", utf8_encode($categorias_options), $html);
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Preguntas y Respuestas", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function mp_busca_Categorias($id_empresa)
            {
                $categorias_mps = mp_busca_Categorias_data($id_empresa);
                foreach ($categorias_mps as $categoria_mp) {
                    $lista_grupo_interes .= "<option value='" . $categoria_mp->id_categoria . "'>" . $categoria_mp->categoria . "</option>";
                }
                return $lista_grupo_interes;
            }


            function mp_busca_Olas_GruposCerrados($id_empresa)
            {
                $categorias_mps = Com_Busca_olas($id_empresa);
                foreach ($categorias_mps as $categoria_mp) {
                    $lista_grupo_interes .= "<option value='" . $categoria_mp->codigo . "'>" . ($categoria_mp->nombre) . "</option>";
                }
                return $lista_grupo_interes;
            }

            function MedicionListaBancoPreguntas($id_empresa)
            {
                $MedLista_mps = MedicionListaBancoPreguntas_data($id_empresa);
                foreach ($MedLista_mps as $MedLista_mp) {
                    $lista_grupo_interes .= "<option value='" . $MedLista_mp->id . "'>ID: " . $MedLista_mp->id . " - " . $MedLista_mp->nombre . "</option>";
                }
                return $lista_grupo_interes;
            }

            function mp_busca_Estados($id_empresa)
            {
                $estados_mps = mp_busca_Estados_data($id_empresa);
                foreach ($estados_mps as $estado_mp) {
                    $lista_estados .= "<option value='" . $estado_mp->id_estado . "'>" . $estado_mp->estado . "</option>";
                }
                return $lista_estados;
            }

            function buscaTags($id_mp, $id_empresa)
            {
                $tags_mps = buscatag($id_mp, $id_empresa);
                foreach ($tags_mps as $tags_mp) {
                    $tagfull .= $tags_mp->tag . ",";
                }
                //print_r($tagfull);
                return $tagfull;
            }

            function lista_practicas_detallado($html, $id_empresa, $idcategoria, $arreglo_post, $criterio)
            {
                //echo "$html,  $id_empresa, $idcategoria, $arreglo_post, $criterio";
//trae Jefe
                $jefeDNCs = TraeJefesDNCSolicitudesPorEmpresaCriterio($idproceso, $id_empresa, $criterio);
                $row = file_get_contents("views/dnc_solicitudes/entorno_personas.html");
                //print_r($jefeDNCs);
                $criterio_actual = "";
                $contador_criterios = 0;
                $acumulador_por_criterio = 0;
                foreach ($jefeDNCs as $jefeDNC) {
                    if ($criterio_actual <> $jefeDNC->criterio) {
                        $acumulador_por_criterio++;
                        $matriz[$acumulador_por_criterio]["total_por_criterio"]++;
                        $matriz[$acumulador_por_criterio]["criterio"] = $jefeDNC->criterio;
                        $matriz[$acumulador_por_criterio]["solicitudes"] = 0;
                        if ($jefeDNC->numsolicitudes > 0) {
                            $matriz[$acumulador_por_criterio]["solicitudes"]++;
                        }
                        $contador_criterios++;
                        $criterio_actual = $jefeDNC->criterio;
                    } else {
                        $matriz[$acumulador_por_criterio]["total_por_criterio"]++;
                        if ($jefeDNC->numsolicitudes > 0) {
                            $matriz[$acumulador_por_criterio]["solicitudes"]++;
                        }
                    }
                }
                $html_criterio = file_get_contents("views/dnc_solicitudes/entorno_criterios.html");
                for ($i = 1; $i <= $contador_criterios; $i++) {
                    $row_criterios .= file_get_contents("views/dnc_solicitudes/lista_criterios.html");
                    $row_criterios = str_replace("{CRITERIO}", $matriz[$i]["criterio"], $row_criterios);
                    $row_criterios = str_replace("{TOTAL}", $matriz[$i]["total_por_criterio"], $row_criterios);
                    $row_criterios = str_replace("{SOLICITUDES}", $matriz[$i]["solicitudes"], $row_criterios);
                    $row_criterios = str_replace("{PORCENTAJE}", ColocarColoresConPorcentajeProgressBar(FormatearPorcentajes(($matriz[$i]["solicitudes"] * 100) / $matriz[$i]["total_por_criterio"])), $row_criterios);
                }
                $html_criterio = str_replace("{LISTA}", utf8_encode($row_criterios), $html_criterio);
                echo $html_criterio;
            }

            //MODULO dnc solicitudes
            function lista_DNC_solicitudes($html, $id_empresa, $idcategoria)
            {
//trae Jefe
                $jefeDNCs = TraeJefesDNCSolicitudesPorEmpresa($idproceso, $id_empresa);
                $row = file_get_contents("views/dnc_solicitudes/entorno_personas.html");
                //print_r($jefeDNCs);
                foreach ($jefeDNCs as $jefeDNC) {
                    //$categorias=TraeCategorias();
                    $row = file_get_contents("views/dnc_solicitudes/lista_personas.html");
                    if ($jefeDNC->numsolicitudes > 0) {
                        $dnc_estado = "<button type='button' class='btn btn-success btn-sm btn-round'><span class='glyphicon glyphicon-ok'></span></button>";
                    } else {
                        $dnc_estado = "<button type='button' class='btn btn-danger btn-sm btn-round'><span class='glyphicon glyphicon-minus'></span></button>";
                    }
                    $row = str_replace("{ESTADO}", $dnc_estado, $row);
                    $row = str_replace("{NUMSOLICITUDES}", utf8_encode($jefeDNC->numsolicitudes), $row);
                    $row = str_replace("{GERENCIA}", utf8_encode($jefeDNC->gerencia), $row);
                    $row = str_replace("{AREA}", utf8_encode($jefeDNC->area), $row);
                    $row = str_replace("{LIDER}", utf8_encode($jefeDNC->nombre), $row);
                    $row = str_replace("{RUT}", utf8_encode($jefeDNC->rut), $row);
                    $row = str_replace("{CARGO}", utf8_encode($jefeDNC->cargo), $row);
                    $row = str_replace("{EMAIL}", utf8_encode($jefeDNC->email), $row);
                    $total_html .= $row;
                    /*
            if($jefeDNC->numsolicitudes>0){
                $categorias=TraeDNCSolicitudesPorEmpresa($jefeDNC->rut,$idcategoria,$id_empresa);
                foreach($categorias as $Cat){
                print_r($Cat);
                $row=file_get_contents("views/dnc_solicitudes/lista_categorias.html");
                    $row = str_replace("{TEMATICA}",utf8_encode($Cat->tematica_texto),$row);
                    $row = str_replace("{CONTENIDO1}",utf8_encode($Cat->contenido1),$row);
                    $row = str_replace("{CONTENIDO2}",utf8_encode($Cat->contenido2),$row);
                    $row = str_replace("{CONTENIDO3}",utf8_encode($Cat->contenido3),$row);
                    $row = str_replace("{CONTENIDO4}",utf8_encode($Cat->contenido4),$row);
                    $row = str_replace("{CONTENIDO5}",utf8_encode($Cat->contenido5),$row);
                    $row = str_replace("{RESULTADO}",utf8_encode($Cat->descripcion_accion),$row);
                    $row = str_replace("{PRIORIDAD}",utf8_encode($Cat->priorizar_tematica),$row);
                    $row = str_replace("{NOMBREAUTOR}",utf8_encode($Cat->nombre),$row);
                    $row = str_replace("{CARGO}",utf8_encode($Cat->cargo),$row);
                    $row = str_replace("{GERENCIA}",$Cat->gerencia,$row);
                            $total_html.=$row;
                }
            }*/
                }
                $total_html = str_replace("{NIVEL}", "2", $total_html);
                $total_html = str_replace("{SUB_CAT}", "", $total_html);
                $total_html = str_replace("{NSUB}", "", $total_html);
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Preguntas y Respuestas", $html);
                $html = str_replace("{BTN}", "Nueva Pregunta", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Pregunta', $html);
                return ($html);
            }

            function lista_DNC_solicitudes_detallado($html, $id_empresa, $idcategoria, $arreglo_post, $criterio)
            {
                //echo "$html,  $id_empresa, $idcategoria, $arreglo_post, $criterio";
//trae Jefe
                $jefeDNCs = TraeJefesDNCSolicitudesPorEmpresaCriterio($idproceso, $id_empresa, $criterio);
                $row = file_get_contents("views/dnc_solicitudes/entorno_personas.html");
                //print_r($jefeDNCs);
                $criterio_actual = "";
                $contador_criterios = 0;
                $acumulador_por_criterio = 0;
                foreach ($jefeDNCs as $jefeDNC) {
                    if ($criterio_actual <> $jefeDNC->criterio) {
                        $acumulador_por_criterio++;
                        $matriz[$acumulador_por_criterio]["total_por_criterio"]++;
                        $matriz[$acumulador_por_criterio]["criterio"] = $jefeDNC->criterio;
                        $matriz[$acumulador_por_criterio]["solicitudes"] = 0;
                        if ($jefeDNC->numsolicitudes > 0) {
                            $matriz[$acumulador_por_criterio]["solicitudes"]++;
                        }
                        $contador_criterios++;
                        $criterio_actual = $jefeDNC->criterio;
                    } else {
                        $matriz[$acumulador_por_criterio]["total_por_criterio"]++;
                        if ($jefeDNC->numsolicitudes > 0) {
                            $matriz[$acumulador_por_criterio]["solicitudes"]++;
                        }
                    }
                }
                $html_criterio = file_get_contents("views/dnc_solicitudes/entorno_criterios.html");
                for ($i = 1; $i <= $contador_criterios; $i++) {
                    $row_criterios .= file_get_contents("views/dnc_solicitudes/lista_criterios.html");
                    $row_criterios = str_replace("{CRITERIO}", $matriz[$i]["criterio"], $row_criterios);
                    $row_criterios = str_replace("{TOTAL}", $matriz[$i]["total_por_criterio"], $row_criterios);
                    $row_criterios = str_replace("{SOLICITUDES}", $matriz[$i]["solicitudes"], $row_criterios);
                    $row_criterios = str_replace("{PORCENTAJE}", ColocarColoresConPorcentajeProgressBar(FormatearPorcentajes(($matriz[$i]["solicitudes"] * 100) / $matriz[$i]["total_por_criterio"])), $row_criterios);
                }
                $html_criterio = str_replace("{LISTA}", utf8_encode($row_criterios), $html_criterio);
                echo $html_criterio;
            }

            //MODULO BIBLITECA
            function lista_categorias($html, $id_empresa)
            {
                //$categorias=TraeCategorias();
                $categorias = TraeCategoriasPorEmpresa($id_empresa);
                $total_html = "";
                foreach ($categorias as $Cat) {
                    $row = file_get_contents("views/admin/biblioteca/lista_categorias.html");
                    $row = str_replace("{CATEGORIA}", utf8_encode($Cat->categoria), $row);
                    $row = str_replace("{DESCRIPCION}", utf8_encode($Cat->descripcion), $row);
                    $row = str_replace("{DETALLE}", Total_subcategorias($Cat->id), $row);
                    $row = str_replace("{ID}", $Cat->id, $row);
                    $total_html .= $row;
                }
                $total_html = str_replace("{NIVEL}", "2", $total_html);
                $total_html = str_replace("{SUB_CAT}", "", $total_html);
                $total_html = str_replace("{NSUB}", "", $total_html);
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", "Tabla de categorias", $html);
                $html = str_replace("{BTN}", "Nueva Categoria", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fc", $html);
                $html = str_replace("{BTN_VOLVER}", '', $html);
                $html = str_replace("{COLUMNA}", 'Categoria', $html);
                return ($html);
            }

            function lista_subcategorias($html, $id, $ncat)
            {
                $categorias = TraeSubCategorias($id);
                $total_html = "";
                foreach ($categorias as $Cat) {
                    $row = file_get_contents("views/admin/biblioteca/lista_subcategorias.html");
                    $row = str_replace("{CATEGORIA}", utf8_encode($Cat->categoria), $row);
                    $row = str_replace("{DESCRIPCION}", utf8_encode($Cat->descripcion), $row);
                    $row = str_replace("{MUNDO}", utf8_encode($Cat->nombre_mundo), $row);
                    $row = str_replace("{COMUNIDAD}", utf8_encode($Cat->nombre_comunidad), $row);
                    $row = str_replace("{DETALLE}", Total_archivos($Cat->id), $row);
                    $row = str_replace("{DESCARGAS}", Total_archivos($Cat->id), $row);
                    $row = str_replace("{ID}", $Cat->id, $row);
                    $total_html .= $row;
                }
                $total_html = str_replace("{NIVEL}", "3", $total_html);
                $total_html = str_replace("{SUB_CAT}", $id, $total_html);
                $total_html = str_replace("{NSUB}", $ncat, $total_html);
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", $ncat, $html);
                $html = str_replace("{BTN}", "Nueva Subcategoria", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fs&id_cat=" . $id . "&cn=" . $ncat, $html);
                $html = str_replace("{BTN_VOLVER}", '<a href="?sw=admin_biblio&n=1" class="btn btn-info btn-sm pull-left flat" title="button" style="margin-top: 10px;margin-right: 10px;font-size: 14px;"><i class="glyphicon glyphicon-arrow-left"></i>&nbsp; Volver</a>', $html);
                $html = str_replace("{COLUMNA}", 'Subcategoria', $html);
                return ($html);
            }

            function lista_archivos($html, $id, $ncat, $id_sub, $nscat)
            {
                $archivos = TraeArchivos($id);
                $total_html = "";
                foreach ($archivos as $Cat) {
                    $row = file_get_contents("views/admin/biblioteca/lista_archivos.html");
                    $row = str_replace("{NOMBRE}", utf8_encode($Cat->titulo), $row);
                    $row = str_replace("{ARCHIVO}", utf8_encode($Cat->archivo), $row);
                    $row = str_replace("{DESCRIPCION}", utf8_encode($Cat->descripcion), $row);
                    $row = str_replace("{DETALLE}", "Icono :" . $Cat->icono . "<br>Tamaño: " . $Cat->tamano, $row);
                    $row = str_replace("{ID}", $Cat->id, $row);
                    $row = str_replace("{ICONO}", $Cat->icono, $row);
                    $row = str_replace("{NIVEL}", $Cat->id, $row);
                    $row = str_replace("{ID_1}", $id, $row);
                    $row = str_replace("{CANTIDAD}", Total_archivos($Cat->id), $row);
                    $row = str_replace("{MUNDO}", $id, $row);
                    $row = str_replace("{COMUNIDAD}", $id, $row);
                    $row = str_replace("{DESCARGAS}", $Cat->cuenta, $row);
                    $row = str_replace("{CN}", $ncat, $row);
                    $row = str_replace("{NSCAT}", $nscat, $row);
                    $row = str_replace("{IDSUB}", $id_sub, $row);
                    $total_html .= $row;
                }
                $html = str_replace("{LISTA}", $total_html, $html);
                $html = str_replace("{TITULO}", $ncat, $html);
                $html = str_replace("{BTN}", "Subir archivo", $html);
                $html = str_replace("{BTN_A}", "?sw=admin_biblio&n=fa&id=" . $id . "&cn=" . $ncat . "&id_sub=" . $id_sub . "&nsub=" . $nscat . "&id_ar=0", $html);
                $html = str_replace("{BTN_VOLVER}", '<a href="?sw=admin_biblio&n=2&id=' . $id_sub . '&cn=' . $nscat . '" class="btn btn-info btn-sm pull-left flat" title="button" style="margin-top: 10px;margin-right: 10px;font-size: 14px;"><i class="glyphicon glyphicon-arrow-left"></i>&nbsp; Volver</a>', $html);
                $html = str_replace("{COLUMNA}", 'Archivo', $html);
                return ($html);
            }

            function nueva_cat($html, $id_cat)
            {
                if ($id_cat != "") {
                    $Categoria = TraeCategoria($id_cat);
                    $html = str_replace("{ID_CATEGORIA}", $id_cat, $html);
                    $html = str_replace("{CATEGORIA}", utf8_encode($Categoria[0]->categoria), $html);
                    $html = str_replace("{DESCRIPCION}", utf8_encode($Categoria[0]->descripcion), $html);
                    $html = str_replace("{BTN}", "edita_categoria();", $html);
                    $html = str_replace("{TIPO}", "EDITAR CATEGORIA", $html);
                    $html = str_replace("{BTN_VOLVER}", '', $html);
                    return ($html);
                } else {
                    $html = str_replace("{ID_CATEGORIA}", "", $html);
                    $html = str_replace("{CATEGORIA}", "", $html);
                    $html = str_replace("{DESCRIPCION}", "", $html);
                    $html = str_replace("{BTN}", "nueva_categoria();", $html);
                    $html = str_replace("{TIPO}", "NUEVA CATEGORIA", $html);
                    $html = str_replace("{BTN_VOLVER}", '', $html);
                    return ($html);
                }
            }

            function nueva_sub_cat($html, $id_cat, $ncat, $id_subcat)
            {
                $comboCat = TraeCategorias();
                if ($id_subcat != "") {
                    foreach ($comboCat as $Cat) {
                        if ($id_cat == $Cat->id) {
                            $select = "selected";
                        } else {
                            $select = "";
                        }
                        $row = "<option value='" . utf8_encode($Cat->id) . "' " . $select . ">" . utf8_encode($Cat->categoria) . "</option>";
                        $COMBO .= $row;
                    }
                    $html = str_replace("{COMBOCAT}", $COMBO, $html);
                    $Categoria = TraeCategoria($id_subcat);
                    $html = str_replace("{ID_CATEGORIA}", $id_cat, $html);
                    $html = str_replace("{ID_SUBCATEGORIA}", $id_subcat, $html);
                    $html = str_replace("{N_CATEGORIA}", $ncat, $html);
                    $html = str_replace("{IMG}", $Categoria[0]->imagen, $html);
                    $html = str_replace("{SUBCATEGORIA}", $Categoria[0]->categoria, $html);
                    $html = str_replace("{DESCRIPCION}", $Categoria[0]->descripcion, $html);
                    $html = str_replace("{OPTIONS_MUNDOS}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_mundos", $Categoria[0]->id_mundo, "nombre", "id", "order by nombre", $_SESSION["id_empresa"]), $html);
                    $html = str_replace("{OPTIONS_COMUNIDADES}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_comunidades", $Categoria[0]->id_comunidad, "nombre", "id", "order by nombre", $_SESSION["id_empresa"]), $html);
                    $html = str_replace("{BTN}", "edita_sub_categoria()", $html);
                    $html = str_replace("{TIPO}", "EDITAR SUBCATEGORIA", $html);
                    return ($html);
                } else {
                    foreach ($comboCat as $Cat) {
                        if ($id_cat == $Cat->id) {
                            $select = "selected";
                        } else {
                            $select = "";
                        }
                        $row = "<option value='" . utf8_encode($Cat->id) . "' " . $select . ">" . utf8_encode($Cat->categoria) . "</option>";
                        $COMBO .= $row;
                    }
                    $html = str_replace("{COMBOCAT}", $COMBO, $html);
                    $html = str_replace("{ID_CATEGORIA}", $id_cat, $html);
                    $html = str_replace("{ID_SUBCATEGORIA}", $id_subcat, $html);
                    $html = str_replace("{SUBCATEGORIA}", "", $html);
                    $html = str_replace("{DESCRIPCION}", "", $html);
                    $html = str_replace("{BTN}", "nueva_sub_categoria()", $html);
                    $html = str_replace("{TIPO}", "NUEVA SUBCATEGORIA", $html);
                    $html = str_replace("{N_CATEGORIA}", $ncat, $html);
                    $html = str_replace("{OPTIONS_MUNDOS}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_mundos", "", "nombre", "id", "order by nombre", $_SESSION["id_empresa"]), $html);
                    $html = str_replace("{OPTIONS_COMUNIDADES}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_comunidades", "", "nombre", "id", "order by nombre", $_SESSION["id_empresa"]), $html);
                    return ($html);
                }
            }

            function subir_archivo($html, $id_cat, $ncat, $id_subcat, $nsubcat, $id_ar)
            {
                $comboCat = TraeSubCategorias($id_subcat);
                if ($id_ar != "0") {
                    foreach ($comboCat as $Cat) {
                        if ($id_cat == $Cat->id) {
                            $select = "selected";
                        } else {
                            $select = "";
                        }
                        $row = "<option value='" . utf8_encode($Cat->id) . "' " . $select . ">" . utf8_encode($Cat->categoria) . "</option>";
                        $COMBO .= $row;
                    }
                    $html = str_replace("{COMBOCAT}", $COMBO, $html);
                    $Categoria = TraeArchivo($id_ar);
                    $html = str_replace("{ID_CATEGORIA}", $id_cat, $html);
                    $html = str_replace("{ID_AR}", $id_ar, $html);
                    $html = str_replace("{ID_SUBCATEGORIA}", $id_subcat, $html);
                    $html = str_replace("{N_CATEGORIA}", $ncat, $html);
                    $html = str_replace("{IMG}", $Categoria[0]->imagen, $html);
                    $html = str_replace("{NOMBRE}", utf8_encode($Categoria[0]->titulo), $html);
                    $html = str_replace("{DESCRIPCION}", utf8_encode($Categoria[0]->descripcion), $html);
                    $html = str_replace("{BTN}", "editar_archivo();", $html);
                    $html = str_replace("{IDCAT}", $id_cat, $html);
                    $html = str_replace("{NCAT}", $ncat, $html);
                    $html = str_replace("{IDSUB}", $id_subcat, $html);
                    $html = str_replace("{NSUB}", $nsubcat, $html);
                    $html = str_replace("{TIPO}", "EDITAR ARCHIVO", $html);
                    $html = str_replace("{INPUTFILE}", "", $html);
                    return ($html);
                } else {
                    foreach ($comboCat as $Cat) {
                        if ($id_cat == $Cat->id) {
                            $select = "selected";
                        } else {
                            $select = "";
                        }
                        $row = "<option value='" . utf8_encode($Cat->id) . "' " . $select . ">" . utf8_encode($Cat->categoria) . "</option>";
                        $COMBO .= $row;
                    }
                    $html = str_replace("{COMBOCAT}", $COMBO, $html);
                    $html = str_replace("{ID_CATEGORIA}", $id_cat, $html);
                    $html = str_replace("{ID_AR}", "0", $html);
                    $html = str_replace("{NOMBRE}", "", $html);
                    $html = str_replace("{DESCRIPCION}", "", $html);
                    $html = str_replace("{LINK}", "", $html);
                    $html = str_replace("{BTN}", "subirArchivos();", $html);
                    $html = str_replace("{IDCAT}", $id_cat, $html);
                    $html = str_replace("{NCAT}", $ncat, $html);
                    $html = str_replace("{IDSUB}", $id_subcat, $html);
                    $html = str_replace("{NSUB}", $nsubcat, $html);
                    $html = str_replace("{TIPO}", "SUBIR", $html);
                    $html = str_replace("{N_CATEGORIA}", $ncat, $html);
                    $imputFile = '<div class="row">
                                            <div class="form-group col-lg-6 col-md-6 col-sm-12">
                                                <label for="contactName"><span class="required">*</span> Seleccione Archivo</label>
                                                <input type="file" name="archivo" id="archivo" />
                                            </div>
                                        </div>';
                    $html = str_replace("{INPUTFILE}", $imputFile, $html);
                    return ($html);
                }
            }

            function tamano_archivo($peso, $decimales = 2)
            {
                $clase = array(" Bytes", " KB", " MB", " GB", " TB");
                return round($peso / pow(1024, ($i = floor(log($peso, 1024)))), $decimales) . $clase[$i];
            }

            // ++++++++++++++FUNCIONES MODULO CAPACITACION V2+++++++++++++++++
            //MALLAS
            function ListadocMallas($PRINCIPAL, $id_empresa, $tipo_llamada, $id_malla)
            {
                //Traigo el total de empresas que existen en el sistema
                //Traigo el total de empresas que existen en el sistema
                $mallas = TotalMallas2($id_empresa);
                $total_mallas = "";
                $i = 1;
                $n_mallas = Cuenta_Mallas($id_empresa, $id_malla);
                foreach ($mallas as $unico) {
                    if ($tipo_llamada == "imparticiones") {
                        $row = file_get_contents("views/capacitacion/malla/row_listado_malla_imparticion.html");
                    } else {
                        $row = file_get_contents("views/capacitacion/malla/row_listado_malla.html");
                    }
                    $row = str_replace("{NUMERO}", $unico->orden, $row);
                    $i++;
                    $row = str_replace("{TOTALCURSOS}", CuentaCursosMalla($unico->id, $id_empresa), $row);
                    $row = str_replace("{CODIGO_MALLA}", $unico->id, $row);
                    $row = str_replace("{CODIGO_MALLA_ENCODEADO}", Encodear($unico->id), $row);
                    $row = str_replace("{NOMBRE_MALLA}", $unico->nombre, $row);
                    $row = str_replace("{TIPO_MALLA}", $unico->tipo, $row);
                    $row = str_replace("{CORREO_RESPONSABLE}", $unico->correo, $row);
                    $row = str_replace("{BTN_ORDEN}", crear_boton_orden("?sw=listcmallas", $n_mallas, $unico->orden, "tbl_malla", "orden"), $row);
                    $total_mallas .= $row;
                }
                if ($mallas) {
                    $PRINCIPAL = str_replace("{ROW_LISTADO_MALLAS}", utf8_encode($total_mallas), $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function ListadoLMSMallasBK08082016($PRINCIPAL, $id_empresa)
            {
                //$mallas=TotalMallas2($id_empresa);
                $mallas = TraeMallasPorEmpresa($id_empresa);
                $total_mallas = "";
                $i = 1;
                $n_mallas = Cuenta_Mallas($id_empresa);
                foreach ($mallas as $unico) {
                    $row = file_get_contents("views/capacitacion/lms_malla_clas_cursos/row_listado_lms_malla.html");
                    $row = str_replace("{NUMERO}", $unico->orden, $row);
                    $i++;
                    $row = str_replace("{TOTALCURSOS}", CuentaCursosMalla($unico->id, $id_empresa), $row);
                    $row = str_replace("{CODIGO_MALLA}", $unico->id, $row);
                    $row = str_replace("{CODIGO_MALLA_ENCODEADO}", Encodear($unico->id), $row);
                    $row = str_replace("{NOMBRE_MALLA}", $unico->nombre, $row);
                    $row = str_replace("{TIPO_MALLA}", $unico->tipo, $row);
                    $row = str_replace("{CORREO_RESPONSABLE}", $unico->correo, $row);
                    $row = str_replace("{BTN_ORDEN}", crear_boton_orden("?sw=listcmallas", $n_mallas, $unico->orden, "tbl_malla", "orden"), $row);
                    $total_mallas .= $row;
                    $clasificaciones = TotalClasif($id_empresa, $unico->id);
                    $total_clasif = "";
                    $i = 1;
                    //print_r($clasificaciones);
                    foreach ($clasificaciones as $clasunico) {
                        $row = file_get_contents("views/capacitacion/lms_malla_clas_cursos/row_listado_lms_clasificacion.html");
                        $row = str_replace("{NUMERO}", $clasunico->orden_clasificacion, $row);
                        $i++;
                        $row = str_replace("{CODIGO_CLASIFICACION}", $clasunico->id_clasificacion, $row);
                        $row = str_replace("{CODIGO_MALLA_ENCODEADO}", Encodear($clasunico->id_clasificacion), $row);
                        $row = str_replace("{NOMBRE_CLASIFICACION}", $clasunico->nombre, $row);
                        $row = str_replace("{DESCRIPCION_CLASIFICACION}", $clasunico->nombre, $row);
                        $row = str_replace("{IMAGEN_CLASIFICACION}", $clasunico->nombre, $row);
                        $row = str_replace("{OPCIONAL_CLASIFICACION}", $clasunico->nombre, $row);
                        $row = str_replace("{INACTIVO_CLASIFICACION}", $clasunico->nombre, $row);
                        $row = str_replace("{BTN_ORDEN}", crear_boton_orden("?sw=listcmallas", $n_mallas, $clasunico->orden, "tbl_malla", "orden"), $row);
                        $total_clasif .= $row;
                        //echo "hol";
                        $cursos = TotalCurso($id_empresa, $unico->id, $clasunico->id_clasificacion);
                        $total_cursos = "";
                        $i = 1;
                        //print_r($cursos);
                        foreach ($cursos as $cursounico) {
                            $row = file_get_contents("views/capacitacion/lms_malla_clas_cursos/row_listado_lms_curso.html");
                            $row = str_replace("{NUMERO}", $cursounico->orden_clasificacion, $row);
                            $i++;
                            $row = str_replace("{CODIGO_CURSO}", $cursounico->id, $row);
                            $row = str_replace("{CODIGO_CURSO_ENCODEADO}", Encodear($cursounico->id), $row);
                            $row = str_replace("{NOMBRE_CURSO}", $cursounico->nombre, $row);
                            $row = str_replace("{DESCRIPCION_CURSO}", $cursounico->nombre, $row);
                            $row = str_replace("{IMAGEN_CURSO}", $cursounico->nombre, $row);
                            $row = str_replace("{OPCIONAL_CURSO}", $cursounico->nombre, $row);
                            $row = str_replace("{INACTIVO_CURSO}", $cursounico->nombre, $row);
                            $row = str_replace("{TIPO_CURSO}", $cursounico->tipo, $row);
                            $row = str_replace("{MODALIDAD_CLASIFICACION}", $cursounico->modalidad, $row);
                            $row = str_replace("{BTN_ORDEN}", crear_boton_orden("?sw=listcmallas", $n_mallas, $unico->orden, "tbl_malla", "orden"), $row);
                            $total_cursos .= $row;
                        }
                        $PRINCIPAL = str_replace("{ROW_LISTADO_CURSO}", utf8_encode($total_cursos), $PRINCIPAL);
                    }
                    $PRINCIPAL = str_replace("{ROW_LISTADO_CLASIFICACION}", utf8_encode($total_clasif), $PRINCIPAL);
                }
                if ($mallas) {
                    $PRINCIPAL = str_replace("{ROW_LISTADO_MALLAS}", utf8_encode($total_mallas), $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function ListadoLMSClasificaciones($PRINCIPAL, $id_empresa, $id_malla)
            {
                $clasificaciones = TotalClasif($id_empresa, $id_malla);
                $total_clasif = "";
                $i = 1;
                //print_r($clasificaciones);
                foreach ($clasificaciones as $unico) {
                    $row = file_get_contents("views/capacitacion/lms_malla_clas_cursos/row_listado_lms_clasificacion.html");
                    $row = str_replace("{NUMERO}", $unico->orden_clasificacion, $row);
                    $i++;
                    $row = str_replace("{CODIGO_CLASIFICACION}", $unico->id_clasificacion, $row);
                    $row = str_replace("{CODIGO_MALLA_ENCODEADO}", Encodear($unico->id_clasificacion), $row);
                    $row = str_replace("{NOMBRE_CLASIFICACION}", $unico->nombre, $row);
                    $row = str_replace("{DESCRIPCION_CLASIFICACION}", $unico->nombre, $row);
                    $row = str_replace("{IMAGEN_CLASIFICACION}", $unico->nombre, $row);
                    $row = str_replace("{OPCIONAL_CLASIFICACION}", $unico->nombre, $row);
                    $row = str_replace("{INACTIVO_CLASIFICACION}", $unico->nombre, $row);
                    $row = str_replace("{BTN_ORDEN}", crear_boton_orden("?sw=listcmallas", $n_mallas, $unico->orden, "tbl_malla", "orden"), $row);
                    $total_clasif .= $row;
                }
                if ($mallas) {
                    $PRINCIPAL = str_replace("{ROW_LISTADO_CLASIFICACION}", utf8_encode($total_clasif), $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function FormulariocMalla($PRINCIPAL, $id_malla)
            {
                $datos_malla = DatosMalla($id_malla);
                $PRINCIPAL = str_replace("{COD_MALLA}", Encodear(Encodear($datos_malla[0]->id)), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CODIGO_MALLA}", $datos_malla[0]->id, $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOM_MALLA}", utf8_encode($datos_malla[0]->nombre), $PRINCIPAL);
                $PRINCIPAL = str_replace("{DES_MALLA}", utf8_encode($datos_malla[0]->descripcion), $PRINCIPAL);
                $PRINCIPAL = str_replace("{EM_EMPRESA}", $datos_empresa[0]->correo, $PRINCIPAL);
                if ($id_malla) {
                    $PRINCIPAL = str_replace("{VALOR_BOTON}", "Editar", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ACTION}", "?sw=edcmallla", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{TITULO}", "Formulario Edici&oacute;n de Malla", $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{VALOR_BOTON}", "Ingresar", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ACTION}", "?sw=adcmallla", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{TITULO}", "Formulario Ingreso de Malla", $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function ListadoRelacionesMallaCurso($PRINCIPAL, $id_malla, $id_empresa)
            {
                $datos_malla = DatosMalla($id_malla);
                $PRINCIPAL = str_replace("{ID_MALLA_ENCODEADO}", Encodear3($id_malla), $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOMBRE_MALLA}", utf8_encode($datos_malla[0]->nombre), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_CURSOS}", ListadoCursosEmpresaParaSelectMultiple($id_empresa), $PRINCIPAL);
                //Veo si existen relaciones nivel - curso
                $relaciones = RelMallaCurso($id_malla);
                if ($relaciones) {
                    $total_row = "";
                    $i = 1;
                    foreach ($relaciones as $rel) {
                        $row = file_get_contents("views/capacitacion/malla/row_rel_malla_curso.html");
                        $row = str_replace("{NOMBRE_CURSO}", utf8_encode($rel->nombre_curso), $row);
                        $row = str_replace("{N}", $i, $row);
                        $i++;
                        $total_row .= $row;
                    }
                    $PRINCIPAL = str_replace("{LISTADO_REL_MALLA_CURSO}", $total_row, $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{LISTADO_REL_MALLA_CURSO}", '
        <tr class="odd">
            <td colspan="4" class=" sorting_1">No Existen cursos asociados a esta Malla</td>
        </tr>', $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function ListadoCursosEmpresaParaSelectMultiple($id_empresa)
            {
                $total_cursos = TotalCursosEmpresa($id_empresa);
                $total_html = "";
                foreach ($total_cursos as $curso) {
                    $total_html .= "<option value='" . $curso->id . "'>" . $curso->nombre . "</option>";
                }
                return (utf8_encode($total_html));
            }

            function ListadoMallaClasificacionCurso($PRINCIPAL, $id_malla)
            {
                $Clasificaciones = TotalMallaClasificacionCurso(Decodear($id_malla));
                $total_categorias = "";
                $i = 1;
                foreach ($Clasificaciones as $unico) {
                    $row = file_get_contents("views/capacitacion/malla/row_listado_malla_clasificacion_curso.html");
                    $i++;
                    $row = str_replace("{NOMBRE}", $unico->nombre, $row);
                    $row = str_replace("{CODIGO_ID}", $unico->id, $row);
                    $total_categorias .= $row;
                }
                $PRINCIPAL = str_replace("{IDCLASIFICACION}", $id_malla, $PRINCIPAL);
                $PRINCIPAL = str_replace("{ROW_LISTADO_CATEGORIAS}", utf8_encode($total_categorias), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function ListadoMallaClasificacion($PRINCIPAL, $id_malla, $empresa)
            {
                $Clasificaciones = TotalMallaClasificacion(Decodear($id_malla), $empresa);
                $datosMalla = Datos_Malla(Decodear($id_malla));
                $nombremalla = $datosMalla[0]->nombre;
                $n_clasificacion = CuentaTotalMallaClasificacion(Decodear($id_malla), $empresa);
                $total_categorias = "";
                $i = 1;
                foreach ($Clasificaciones as $unico) {
                    $total_cursos = "";
                    $total_orden = "";
                    $Cursos = TotalMallaClasificacionCurso(Decodear($id_malla), $unico->clasificacion, $empresa);
                    $n_cursos = CuentaTotalMallaClasificacionCurso(Decodear($id_malla), $empresa, $unico->clasificacion);
                    $btn = "";
                    foreach ($Cursos as $unico1) {
                        $btn = crear_boton_orden3("?sw=listmallaclasificacion&m=" . $id_malla, $n_cursos, $unico1->orden_curso, "tbl_malla_curso", "orden_curso", Decodear($id_malla), $unico->clasificacion, $unico1->id_curso);
                        $row = $unico1->orden_curso . $btn . " : " . $unico1->id . " - " . $unico1->nombre . "<br>";
                        $total_cursos .= $row;
                    }
                    $row = file_get_contents("views/capacitacion/malla/row_listado_malla_clasificacion.html");
                    $i++;
                    $row = str_replace("{CODIGO_ID}", $unico->clasificacion, $row);
                    $row = str_replace("{ORDEN}", $unico->orden_clasificacion, $row);
                    $row = str_replace("{CURSOS}", $total_cursos, $row);
                    $row = str_replace("{ORDEN_CURSOS}", $total_orden, $row);
                    $row = str_replace("{CODIGO_MALLA_ENCODEADO}", Encodear($unico->id_malla), $row);
                    $row = str_replace("{NOMBRE}", $unico->nombre_clasificacion, $row);
                    $row = str_replace("{COLOR}", $unico->color, $row);
                    $row = str_replace("{BTN_ORDEN}", crear_boton_orden2("?sw=listmallaclasificacion&m=" . $id_malla, $n_clasificacion, $unico->orden_clasificacion, "tbl_malla_curso", "orden_clasificacion", Decodear($id_malla), $unico->clasificacion), $row);
                    $total_categorias .= $row;
                }
                //$Cursos=TotalCursosEmpresa2($empresa);
                $Cursos = TotalCursosEmpresa3($empresa, Decodear($id_malla));
                $total_cursos2 = "";
                $i = 1;
                foreach ($Cursos as $unico2) {
                    $row2 = file_get_contents("views/capacitacion/malla/row_listado_malla_clasificacion_cursos.html");
                    $row2 = str_replace("{CODIGO_CURSO1}", $unico2->id, $row2);
                    $row2 = str_replace("{CURSO1}", $unico2->nombre, $row2);
                    $row2 = str_replace("{ID_MALLA1}", Decodear($id_malla), $row2);
                    $row2 = str_replace("{ID_CLASIFICACION1}", $unico2->id_clasificacion, $row2);
                    $row2 = str_replace("{CLASIFICACION1}", $unico2->clasificacion, $row2);
                    $row2 = str_replace("{PREFIJO}", $_SESSION["prefijo"], $row2);
                    $total_cursos2 .= $row2;
                }
                $PRINCIPAL = str_replace("{ROW_LISTADO_CURSOS}", "Aca3.3" . utf8_encode($total_cursos2), $PRINCIPAL);
                $PRINCIPAL = str_replace("{MALLA}", $nombremalla, $PRINCIPAL);
                $PRINCIPAL = str_replace("{IDEMPRESA}", $empresa, $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_MALLA}", $id_malla, $PRINCIPAL);
                $PRINCIPAL = str_replace("{ROW_LISTADO_CATEGORIAS}", utf8_encode($total_categorias), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function crear_boton_orden2($url, $total, $anterior, $tabla, $campo, $id_malla, $id_clasificacion)
            {
                $btn = "";
                if ($anterior == 1) {
                    $orden = $anterior + 1;
                    $btn = '<a  href="' . $url . '&total=' . $total . '&orden_anterior=' . $anterior . '&orden=' . $orden . '&tabla=' . $tabla . '&campo=' . $campo . '&id_malla=' . $id_malla . '&id_clasificacion=' . $id_clasificacion . '" class="pull-right"><i class="fa fa-fw fa-arrow-down"></i></a>';
                } else if ($total == $anterior) {
                    $orden = $anterior - 1;
                    $btn = '<a  href="' . $url . '&total=' . $total . '&orden_anterior=' . $anterior . '&orden=' . $orden . '&tabla=' . $tabla . '&campo=' . $campo . '&id_malla=' . $id_malla . '&id_clasificacion=' . $id_clasificacion . '" class="pull-right"><i class="fa fa-fw fa-arrow-up"></i></a>';
                } else {
                    $bajar = $anterior - 1;
                    $subir = $anterior + 1;
                    $btn = '<a  href="' . $url . '&total=' . $total . '&orden_anterior=' . $anterior . '&orden=' . $subir . '&tabla=' . $tabla . '&campo=' . $campo . '&id_malla=' . $id_malla . '&id_clasificacion=' . $id_clasificacion . '" class="pull-right"><i class="fa fa-fw fa-arrow-down"></i></a>';
                    $btn .= '<a  href="' . $url . '&total=' . $total . '&orden_anterior=' . $anterior . '&orden=' . $bajar . '&tabla=' . $tabla . '&campo=' . $campo . '&id_malla=' . $id_malla . '&id_clasificacion=' . $id_clasificacion . '" class="pull-right"><i class="fa fa-fw fa-arrow-up"></i></a>';
                }
                return $btn;
            }

            function crear_boton_orden3($url, $total, $anterior, $tabla, $campo, $id_malla, $id_clasificacion)
            {
                $btn = "";
                if ($anterior == 1) {
                    $orden = $anterior + 1;
                    $btn = '<a style="width:40px;" href="' . $url . '&total=' . $total . '&orden_anterior=' . $anterior . '&orden=' . $orden . '&tabla=' . $tabla . '&campo=' . $campo . '&id_malla=' . $id_malla . '&id_clasificacion=' . $id_clasificacion . '" class="pull-left"><i class="fa fa-fw fa-arrow-down"></i></a>';
                } else if ($total == $anterior) {
                    $orden = $anterior - 1;
                    $btn = '<a style="width:40px;" href="' . $url . '&total=' . $total . '&orden_anterior=' . $anterior . '&orden=' . $orden . '&tabla=' . $tabla . '&campo=' . $campo . '&id_malla=' . $id_malla . '&id_clasificacion=' . $id_clasificacion . '" class="pull-left"><i class="fa fa-fw fa-arrow-up"></i></a>';
                } else {
                    $bajar = $anterior - 1;
                    $subir = $anterior + 1;
                    $btn = '<a style="width:20px;" href="' . $url . '&total=' . $total . '&orden_anterior=' . $anterior . '&orden=' . $subir . '&tabla=' . $tabla . '&campo=' . $campo . '&id_malla=' . $id_malla . '&id_clasificacion=' . $id_clasificacion . '" class="pull-left"><i class="fa fa-fw fa-arrow-down"></i></a>';
                    $btn .= '<a style="width:20px;" href="' . $url . '&total=' . $total . '&orden_anterior=' . $anterior . '&orden=' . $bajar . '&tabla=' . $tabla . '&campo=' . $campo . '&id_malla=' . $id_malla . '&id_clasificacion=' . $id_clasificacion . '" class="pull-left"><i class="fa fa-fw fa-arrow-up"></i></a>';
                }
                return $btn;
            }

            function FormularioClasificacion($PRINCIPAL, $id)
            {
                $datos = DatosClasificacion($id);
                $PRINCIPAL = str_replace("{ID_CLASIFICACION}", $datos[0]->id_clasificacion, $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID}", $datos[0]->id, $PRINCIPAL);
                $PRINCIPAL = str_replace("{CLASIFICACION}", utf8_encode($datos[0]->clasificacion), $PRINCIPAL);
                $PRINCIPAL = str_replace("{COLOR}", utf8_encode($datos[0]->color), $PRINCIPAL);
                $PRINCIPAL = str_replace("{COLOR2}", utf8_encode($datos[0]->color2), $PRINCIPAL);
                $PRINCIPAL = str_replace("{IMAGEN}", utf8_encode($datos[0]->imagen), $PRINCIPAL);
                $PRINCIPAL = str_replace("{IMAGEN_BACK}", utf8_encode($datos[0]->imagen_back), $PRINCIPAL);
                if ($id != "") {
                    $PRINCIPAL = str_replace("{VALOR_BOTON}", "Editar", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ACTION}", "?sw=edclasificacion", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{TITULO}", "Formulario Edici&oacute;n de Clasificaci&oacute;n", $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{VALOR_BOTON}", "Ingresar", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ACTION}", "?sw=adclasificacion", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{TITULO}", "Formulario Ingreso de Clasificaci&oacute;n", $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function ListadoClasificacion($PRINCIPAL)
            {
                $Categorias = TotalClasificacion($_SESSION["id_empresa"]);
                $total_categorias = "";
                $i = 1;
                foreach ($Categorias as $unico) {
                    $row = file_get_contents("views/capacitacion/clasificacion/row_listado_clasificacion.html");
                    $i++;
                    $row = str_replace("{CODIGO_ID}", $unico->id, $row);
                    $row = str_replace("{CODIGO_ID_C}", $unico->id_clasificacion, $row);
                    $row = str_replace("{NOMBRE}", $unico->clasificacion, $row);
                    $row = str_replace("{NCURSOS}", CuentaCursosClasificacion($unico->id_clasificacion), $row);
                    $row = str_replace("{COLOR}", $unico->color, $row);
                    $total_categorias .= $row;
                }
                if ($Categorias) {
                    $PRINCIPAL = str_replace("{ROW_LISTADO_CATEGORIAS}", utf8_encode($total_categorias), $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{ROW_LISTADO_CATEGORIAS}", "<tr><td colspan='5'>No existen clasificaciones en la base de datos</td></tr>", $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function FormularioCursoT($PRINCIPAL, $id_curso, $id_empresa)
            {
                $datos_curso = DatosCurso($id_curso);
                if ($datos_curso) {
                    $id_curso = $datos_curso[0]->id;
                } else {
                    $datos_ultimo = Audiencias_PorEmpresaUltima($id_empresa);
                    $prefijo = $datos_ultimo[0]->prefijo;
                    $total = count($datos_ultimo);
                    $total = $total + 1;
                    //verificaqueno esta
                    $id_curso = $prefijo . "_" . $total;
                    $verificanoesta = verficiaidnuevocursonoestas($id_curso, $id_empresa);
                    while ($verificanoesta[0]->cuenta <> 0) {
                        $total = $total + 1;
                        $id_curso_nuevo = $prefijo . "_" . $total;
                        $verificanoesta = verficiaidnuevocursonoestas($id_curso_nuevo, $id_empresa);
                        $id_curso = $id_curso_nuevo;
                    }
                }
                $PRINCIPAL = str_replace("{NOM_CURSO}", utf8_encode($datos_curso[0]->nombre), $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOMBRE_CURSO_SENCE}", utf8_encode($datos_curso[0]->nombre_curso_sence), $PRINCIPAL);
                //$PRINCIPAL = str_replace("{COD_CURSO}",utf8_encode($datos_curso[0]->id),$PRINCIPAL);
                $PRINCIPAL = str_replace("{COD_CURSO}", $id_curso, $PRINCIPAL);
                $PRINCIPAL = str_replace("{DES_CURSO}", utf8_encode($datos_curso[0]->descripcion), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OBJETIVO_CURSO}", utf8_encode($datos_curso[0]->objetivo_curso), $PRINCIPAL);
                $PRINCIPAL = str_replace("{NUMERO_HORAS}", utf8_encode($datos_curso[0]->numero_horas), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_MAXIMA_PARTICIPANTES}", utf8_encode($datos_curso[0]->cantidad_maxima_participantes), $PRINCIPAL);
                $PRINCIPAL = str_replace("{TIPO_CURSO}", utf8_encode($datos_curso[0]->tipo), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CHECKED" . $datos_curso[0]->sence . "}", "checked", $PRINCIPAL);
                $PRINCIPAL = str_replace("{CHECKED" . $datos_curso[0]->cbc . "CBC}", "checked", $PRINCIPAL);
                $PRINCIPAL = str_replace("{PREREQUISITO_CURSO}", utf8_encode($datos_curso[0]->prerequisito), $PRINCIPAL);
                $PRINCIPAL = str_replace("{COD_SENCE}", utf8_encode($datos_curso[0]->cod_sence), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALOR_HORA}", utf8_encode($datos_curso[0]->valor_hora), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALOR_HORA_SENCE}", utf8_encode($datos_curso[0]->valor_hora_sence), $PRINCIPAL);
                $PRINCIPAL = str_replace("{COD_IDENTIFICADOR}", utf8_encode($datos_curso[0]->numero_identificador), $PRINCIPAL);
                $PRINCIPAL = str_replace("{NUMERO_IDENTIFICADOR}", utf8_encode($datos_curso[0]->numero_identificador), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CONTENIDOS_CURSO}", utf8_encode($datos_curso[0]->contenidos_cursos), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_COD_SENCE}", utf8_encode($datos_curso[0]->codigosence), $PRINCIPAL);
                if (utf8_encode($datos_curso[0]->imagen)) {
                    $PRINCIPAL = str_replace("{BLOQUE_IMAGEN}", file_get_contents("views/capacitacion/curso/bloque_imagen_curso.html"), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{URL_IMAGEN}", "../front/img/" . utf8_encode($datos_curso[0]->imagen), $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{BLOQUE_IMAGEN}", "", $PRINCIPAL);
                }
                $PRINCIPAL = str_replace("{SELECTED_" . $datos_curso[0]->sence . "}", "selected='selected'", $PRINCIPAL);
                if ($datos_curso) {
                    $PRINCIPAL = str_replace("{VALOR_BOTON}", "Editar Curso", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ACTION}", "?sw=edcursoT", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{TITULO}", "Formulario Edici&oacute;n de Cursos", $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{VALOR_BOTON}", "Ingresar Curso", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ACTION}", "?sw=adcursoT", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{TITULO}", "Formulario Ingreso de Cursos", $PRINCIPAL);
                }
                $PRINCIPAL = str_replace("{NOMBRE_FORMULARIO}", "FormCurso", $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_MODALIDAD}", OptionsModalidad($datos_curso[0]->modalidad), $PRINCIPAL);
                $clasificacion = TotalClasificacion($id_empresa);
                foreach ($clasificacion as $cla) {
                    if ($cla->id_clasificacion == $datos_curso[0]->clasificacion) {
                        $select = "selected='selected'";
                    } else {
                        $select = "";
                    }
                    $opcionClasificacion .= '<option value=' . $cla->id_clasificacion . ' ' . $select . ' >' . utf8_encode($cla->clasificacion) . '</option>';
                }
                $otecs = TraeOtec($id_empresa);
                foreach ($otecs as $otec) {
                    if ($cla->rut == $datos_curso[0]->rut_otec) {
                        $select2 = "selected";
                    } else {
                        $select2 = "";
                    }
                    $opcionOtect .= '<option value=' . $otec->rut . ' ' . $select2 . ' >' . utf8_encode($otec->nombre) . ' (' . utf8_encode($otec->rut) . ')</option>';
                }
                $PRINCIPAL = str_replace("{OPTIONS_CLASIFICACION}", $opcionClasificacion, $PRINCIPAL);
                $focos = IMPARTCION_Obtienefocos($id_empresa);
                $options_focos = "";
                foreach ($focos as $foc) {
                    if ($foc->codigo_foco == $datos_curso[0]->id_foco) {
                        $options_focos .= "<option value='" . $foc->codigo_foco . "' selected='selected'>" . $foc->descripcion . "</option>";
                    } else {
                        $options_focos .= "<option value='" . $foc->codigo_foco . "'>" . $foc->descripcion . "</option>";
                    }
                }
                $PRINCIPAL = str_replace("{OPTIONS_FOCOS}", utf8_encode($options_focos), $PRINCIPAL);
                //$programas_bbdd=IMPARTCION_ObtieneProgramasBBDD($id_empresa);
                $programas_bbdd = TraeProgramasDadoFocoDeTablaPrograma($id_empresa, $datos_curso[0]->id_foco);
                $options_programas_bbdd = "";
                foreach ($programas_bbdd as $prog_bbdd) {
                    if ($prog_bbdd->id_programa == $datos_curso[0]->id_empresa_programa) {
                        $options_programas_bbdd .= "<option value='" . $prog_bbdd->id_programa . "' selected='selected'>" . $prog_bbdd->nombre_programa . "</option>";
                    } else {
                        $options_programas_bbdd .= "<option value='" . $prog_bbdd->id_programa . "'>" . $prog_bbdd->nombre_programa . "</option>";
                    }
                }
                $PRINCIPAL = str_replace("{OPTIONS_PROGRAMAS_BBDD}", utf8_encode($options_programas_bbdd), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_RUT_OTEC}", $opcionOtect, $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_CURSO_ENCODEADO}", Encodear(Encodear($datos_curso[0]->id)), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_TIPO_CURSO}", OptionsGenericoNombreDadoValores("tbl_curso_tipo", $datos_curso[0]->tipo, "nombre", "id"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{SELSENCE" . trim($datos_curso[0]->sence) . "}", "selected='selected'", $PRINCIPAL);
                $PRINCIPAL = str_replace("{SELCBC" . trim($datos_curso[0]->cbc) . "}", "selected='selected'", $PRINCIPAL);
                if ($datos_curso[0]->sence == "si") {
                    $PRINCIPAL = str_replace("{STYLE_DISPLAY_COD_SENCE}", '', $PRINCIPAL);
                    $PRINCIPAL = str_replace("{STYLE_DISPLAY_NUM_IDEN}", 'style="display:none;"', $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{STYLE_DISPLAY_COD_SENCE}", 'style="display:none;"', $PRINCIPAL);
                    $PRINCIPAL = str_replace("{STYLE_DISPLAY_NUM_IDEN}", '', $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function FormularioCurso2Elearning($PRINCIPAL, $id_curso, $id_empresa)
            {
                $id_empresa = $_SESSION["id_empresa"];
                $datos_curso = DatosCursoDadoId($id_curso, $id_empresa);
                //print_r($datos_curso);
                if ($datos_curso) {
                    $id_curso = $datos_curso[0]->id;
                } else {
                    $datos_ultimo = Audiencias_PorEmpresaUltima($id_empresa);
                    $prefijo = $datos_ultimo[0]->prefijo;
                    $total = count($datos_ultimo);
                    $total = $total + 1;
                    //verificaqueno esta
                    $id_curso = $prefijo . "_" . $total;
                    $verificanoesta = verficiaidnuevocursonoestas($id_curso, $id_empresa);
                    while ($verificanoesta[0]->cuenta <> 0) {
                        $total = $total + 1;
                        $id_curso_nuevo = $prefijo . "_" . $total;
                        $verificanoesta = verficiaidnuevocursonoestas($id_curso_nuevo, $id_empresa);
                        $id_curso = $id_curso_nuevo;
                    }
                }

                //$datos_imparticion=BuscaEjecutivoDadoIdCurso($id_curso, $id_empresa);
                $ejecutivos = TraeEjecutivosPorEmpresa2($id_empresa);
                $options_ejecutivos = "";
                foreach ($ejecutivos as $ejec) {
                    if ($datos_curso[0]->ejecutivocapacitacion == $ejec->rut) {
                        $options_ejecutivos .= '<option value="' . $ejec->rut . '" selected>' . $ejec->nombre_completo . '</option>';
                    } else {
                        $options_ejecutivos .= '<option value="' . $ejec->rut . '" >' . $ejec->nombre_completo . '</option>';
                    }
                }
                $PRINCIPAL = str_replace("{OPTIONS_EJECUTIVOS}", utf8_encode($options_ejecutivos), $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOM_CURSO}", utf8_encode($datos_curso[0]->nombre), $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOMBRE_CURSO_SENCE}", utf8_encode($datos_curso[0]->nombre_curso_sence), $PRINCIPAL);
                //$PRINCIPAL = str_replace("{COD_CURSO}",utf8_encode($datos_curso[0]->id),$PRINCIPAL);
                $PRINCIPAL = str_replace("{COD_CURSO}", $id_curso, $PRINCIPAL);
                $PRINCIPAL = str_replace("{DES_CURSO}", utf8_encode($datos_curso[0]->descripcion), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OBJETIVO_CURSO}", utf8_encode($datos_curso[0]->objetivo_curso), $PRINCIPAL);
                $PRINCIPAL = str_replace("{NUMERO_HORAS}", utf8_encode($datos_curso[0]->numero_horas), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_MAXIMA_PARTICIPANTES}", utf8_encode($datos_curso[0]->cantidad_maxima_participantes), $PRINCIPAL);
                $PRINCIPAL = str_replace("{TIPO_CURSO}", utf8_encode($datos_curso[0]->tipo), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CHECKED" . $datos_curso[0]->sence . "}", "checked", $PRINCIPAL);
                $PRINCIPAL = str_replace("{CHECKED" . $datos_curso[0]->cbc . "CBC}", "checked", $PRINCIPAL);
                $PRINCIPAL = str_replace("{PREREQUISITO_CURSO}", utf8_encode($datos_curso[0]->prerequisito), $PRINCIPAL);
                $PRINCIPAL = str_replace("{COD_SENCE}", utf8_encode($datos_curso[0]->cod_sence), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALOR_HORA}", utf8_encode($datos_curso[0]->valor_hora), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALOR_HORA_SENCE}", utf8_encode($datos_curso[0]->valor_hora_sence), $PRINCIPAL);
                $PRINCIPAL = str_replace("{COD_IDENTIFICADOR}", utf8_encode($datos_curso[0]->numero_identificador), $PRINCIPAL);
                $PRINCIPAL = str_replace("{NUMERO_IDENTIFICADOR}", utf8_encode($datos_curso[0]->numero_identificador), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CONTENIDOS_CURSO}", utf8_encode($datos_curso[0]->contenidos_cursos), $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALUE_COD_SENCE}", utf8_encode($datos_curso[0]->codigosence), $PRINCIPAL);
                if (utf8_encode($datos_curso[0]->imagen)) {
                    $PRINCIPAL = str_replace("{BLOQUE_IMAGEN}", file_get_contents("views/capacitacion/curso/bloque_imagen_curso.html"), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{URL_IMAGEN}", "../front/img/" . utf8_encode($datos_curso[0]->imagen), $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{BLOQUE_IMAGEN}", "", $PRINCIPAL);
                }
                $PRINCIPAL = str_replace("{SELECTED_" . $datos_curso[0]->sence . "}", "selected='selected'", $PRINCIPAL);
                if ($datos_curso) {
                    $PRINCIPAL = str_replace("{VALOR_BOTON}", "Editar Curso", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ACTION}", "?sw=edcurso2", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{TITULO}", "Formulario Edici&oacute;n de Cursos", $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{VALOR_BOTON}", "Ingresar Curso", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ACTION}", "?sw=adcurso2", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{TITULO}", "Formulario Ingreso de Cursos", $PRINCIPAL);
                }
                $PRINCIPAL = str_replace("{NOMBRE_FORMULARIO}", "FormCurso", $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_MODALIDAD}", OptionsModalidad($datos_curso[0]->modalidad), $PRINCIPAL);
                $clasificacion = TotalClasificacion($id_empresa);
                foreach ($clasificacion as $cla) {
                    if ($cla->id_clasificacion == $datos_curso[0]->clasificacion) {
                        $select = "selected='selected'";
                    } else {
                        $select = "";
                    }
                    $opcionClasificacion .= '<option value=' . $cla->id_clasificacion . ' ' . $select . ' >' . utf8_encode($cla->clasificacion) . '</option>';
                }
                $otecs = TraeOtec($id_empresa);
                foreach ($otecs as $otec) {
                    if ($cla->rut == $datos_curso[0]->rut_otec) {
                        $select2 = "selected";
                    } else {
                        $select2 = "";
                    }
                    $opcionOtect .= '<option value=' . $otec->rut . ' ' . $select2 . ' >' . utf8_encode($otec->nombre) . ' (' . utf8_encode($otec->rut) . ')</option>';
                }
                $PRINCIPAL = str_replace("{OPTIONS_CLASIFICACION}", $opcionClasificacion, $PRINCIPAL);
                $focos = IMPARTCION_Obtienefocos($id_empresa);
                $options_focos = "";
                foreach ($focos as $foc) {
                    if ($foc->codigo_foco == $datos_curso[0]->id_foco) {
                        $options_focos .= "<option value='" . $foc->codigo_foco . "' selected='selected'>" . $foc->descripcion . "</option>";
                    } else {
                        $options_focos .= "<option value='" . $foc->codigo_foco . "'>" . $foc->descripcion . "</option>";
                    }
                }
                $PRINCIPAL = str_replace("{OPTIONS_FOCOS}", utf8_encode($options_focos), $PRINCIPAL);
                //$programas_bbdd=IMPARTCION_ObtieneProgramasBBDD($id_empresa);
                $programas_bbdd = TraeProgramasDadoFocoDeTablaProgramaElearning($id_empresa, $datos_curso[0]->id_foco);
                $options_programas_bbdd = "";
                foreach ($programas_bbdd as $prog_bbdd) {
                    if ($prog_bbdd->id_programa == $datos_curso[0]->id_empresa_programa) {
                        $options_programas_bbdd .= "<option value='" . $prog_bbdd->id_programa . "' selected='selected'>" . $prog_bbdd->nombre_programa . "</option>";
                    } else {
                        $options_programas_bbdd .= "<option value='" . $prog_bbdd->id_programa . "'>" . $prog_bbdd->nombre_programa . "</option>";
                    }
                }

                $programas_bbdd_global = TraeProgramasDadoFocoDeTablaProgramaElearningSoloGlobal($id_empresa, $datos_curso[0]->id_foco);
                $options_programas_bbdd_global = "";
                foreach ($programas_bbdd_global as $prog_bbddG) {
                    if ($prog_bbddG->id_programa == $datos_curso[0]->id_programa_global) {
                        $options_programas_bbdd_global .= "<option value='" . $prog_bbddG->id_programa . "' selected='selected'>" . $prog_bbddG->nombre_programa . "</option>";
                    } else {
                        $options_programas_bbdd_global .= "<option value='" . $prog_bbddG->id_programa . "'>" . $prog_bbddG->nombre_programa . "</option>";
                    }
                }


                $PRINCIPAL = str_replace("{OPTIONS_PROGRAMAS_BBDD_GLOBAL}", utf8_encode($options_programas_bbdd_global), $PRINCIPAL);


                $PRINCIPAL = str_replace("{OPTIONS_PROGRAMAS_BBDD_ELEARNING}", utf8_encode($options_programas_bbdd), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_RUT_OTEC}", $opcionOtect, $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_CURSO_ENCODEADO}", Encodear(Encodear($datos_curso[0]->id)), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_TIPO_CURSO}", OptionsGenericoNombreDadoValores("tbl_curso_tipo", $datos_curso[0]->tipo, "nombre", "id"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{SELSENCE" . trim($datos_curso[0]->sence) . "}", "selected='selected'", $PRINCIPAL);
                $PRINCIPAL = str_replace("{SELCBC" . trim($datos_curso[0]->cbc) . "}", "selected='selected'", $PRINCIPAL);
                if ($datos_curso[0]->sence == "si") {
                    $PRINCIPAL = str_replace("{STYLE_DISPLAY_COD_SENCE}", '', $PRINCIPAL);
                    $PRINCIPAL = str_replace("{STYLE_DISPLAY_NUM_IDEN}", 'style="display:none;"', $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{STYLE_DISPLAY_COD_SENCE}", 'style="display:none;"', $PRINCIPAL);
                    $PRINCIPAL = str_replace("{STYLE_DISPLAY_NUM_IDEN}", '', $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function FuncionIngresaInscripcion2($PRINCIPAL, $Empresa, $id_inscripcion, $id_curso)
            {
                $Incripciones = TraeCursosEmpresa($Empresa);
                $rows_ = "";
                $rows1_ = "";
                foreach ($Incripciones as $unico) {
                    $rows_ = file_get_contents("views/inscripcion/row_listado_cursos.html");
                    $rows_ = str_replace("{ID}", $unico->id, $rows_);
                    $rows_ = str_replace("{CLASIFICACION}", $unico->nombre_clasificacion, $rows_);
                    $rows_ = str_replace("{CURSO}", $unico->nombre, $rows_);
                    $rows_ = str_replace("{CODIGO_SENCE}", $unico->numero_identificador, $rows_);
                    $rows_ = str_replace("{RUT_OTEC}", $unico->rut_otec, $rows_);
                    $rows_ = str_replace("{NOMBRE_OTEC}", $unico->nombre_otec, $rows_);
                    if ($unico->id == $id_curso) {
                        $Curso = $unico->nombre;
                        $id_malla = TraeMallaCurso($unico->id, $Empresa);
                        $valor_hora = $unico->valor_hora;
                        $numero_horas = $unico->numero_horas;
                        $valor_hora_sence = $unico->valor_hora_sence;
                    }
                    $rows_ = str_replace("{ID_MALLA}", TraeMallaCurso($unico->id, $Empresa), $rows_);
                    $rows_ = str_replace("{VALORHORACURSO}", $unico->valor_hora, $rows_);
                    $rows_ = str_replace("{NHORAS}", $unico->numero_horas, $rows_);
                    $rows_ = str_replace("{VHORASENCE}", $unico->valor_hora_sence, $rows_);
                    $rows_ = str_replace("{VALORTOTAL}", ($unico->numero_horas) * ($unico->valor_hora), $rows_);
                    $total_html .= $rows_;
                }
                $usuarios = TraeUsuariosCommboIn($Empresa);
                foreach ($usuarios as $unico1) {
                    $option .= '<option value="' . $unico1->rut . '">' . $unico1->rut_completo . ' ' . $unico1->nombre_completo . '</option>';
                }
                $PRINCIPAL = str_replace("{USUARIOS}", utf8_encode($option), $PRINCIPAL);
                $PRINCIPAL = str_replace("{IDEMPRESA}", $Empresa, $PRINCIPAL);
                $PRINCIPAL = str_replace("{ROW_LISTADO_CURSOS}", "aca1.1" . utf8_encode($total_html), $PRINCIPAL);
                $campos = TraeCampos($Empresa);
                $PRINCIPAL = str_replace("{CAMPO1}", str_replace('_', ' ', $campos[0]->campo1), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CAMPO2}", str_replace('_', ' ', $campos[0]->campo2), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CAMPO3}", str_replace('_', ' ', $campos[0]->campo3), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_INSCRIPCION}", $id_inscripcion, $PRINCIPAL);
                $PRINCIPAL = str_replace("{CURSO}", utf8_encode($Curso), $PRINCIPAL);
                $PRINCIPAL = str_replace("{IDCURSO}", $id_curso, $PRINCIPAL);
                $PRINCIPAL = str_replace("{IDMALLA}", $id_malla, $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALORHORACURSO}", $valor_hora, $PRINCIPAL);
                $PRINCIPAL = str_replace("{NUMEROHORAS}", $numero_horas, $PRINCIPAL);
                $PRINCIPAL = str_replace("{VALORHORASENCE}", $valor_hora_sence, $PRINCIPAL);
                $titulo = ("Nueva Inscripción");
                if ($id_inscripcion != "") {
                    $titulo = ("Editar Inscripción");
                    $Datos = Trae_Inscripciones_Curso($id_inscripcion);
                    if ($Datos[0]->abierto_cerrado == "Abierto") {
                        $SA = "selected";
                        $SC = "";
                    } else {
                        $SA = "";
                        $SC = "selected";
                    }
                    $fecha_inicio = $Datos[0]->fecha_inicio;
                    $fecha_termino = $Datos[0]->fecha_termino;
                    $numerodias = $Datos[0]->numero_dias;
                    $modalidad = $Datos[0]->abierto_cerrado;
                    $valorhoracurso = $Datos[0]->valor_hora_curso;
                    $valortotalcurso = $Datos[0]->valor_curso;
                    $direccion = $Datos[0]->direccion;
                    $comuna = $Datos[0]->comuna;
                    $region = $Datos[0]->ciudad;
                    $comentario = $Datos[0]->comentarios;
                    $l1 = $Datos[0]->lunes_d_am;
                    $l2 = $Datos[0]->lunes_h_am;
                    $total_minutos = $total_minutos + calcular_tiempo_trasnc($l2, $l1);
                    $l3 = $Datos[0]->lunes_d_pm;
                    $l4 = $Datos[0]->lunes_h_pm;
                    $total_minutos = $total_minutos + calcular_tiempo_trasnc($l4, $l3);
                    $l5 = $Datos[0]->martes_d_am;
                    $l6 = $Datos[0]->martes_h_am;
                    $total_minutos = $total_minutos + calcular_tiempo_trasnc($l6, $l5);
                    $l7 = $Datos[0]->martes_d_pm;
                    $l8 = $Datos[0]->martes_h_pm;
                    $total_minutos = $total_minutos + calcular_tiempo_trasnc($l8, $l7);
                    $l9 = $Datos[0]->miercoles_d_am;
                    $l10 = $Datos[0]->miercoles_h_am;
                    $total_minutos = $total_minutos + calcular_tiempo_trasnc($l10, $l9);
                    $l11 = $Datos[0]->miercoles_d_pm;
                    $l12 = $Datos[0]->miercoles_h_pm;
                    $total_minutos = $total_minutos + calcular_tiempo_trasnc($l12, $l11);
                    $l13 = $Datos[0]->jueves_d_am;
                    $l14 = $Datos[0]->jueves_h_am;
                    $total_minutos = $total_minutos + calcular_tiempo_trasnc($l14, $l13);
                    $l15 = $Datos[0]->jueves_d_pm;
                    $l16 = $Datos[0]->jueves_h_pm;
                    $total_minutos = $total_minutos + calcular_tiempo_trasnc($l16, $l15);
                    $l17 = $Datos[0]->viernes_d_am;
                    $l18 = $Datos[0]->viernes_h_am;
                    $total_minutos = $total_minutos + calcular_tiempo_trasnc($l18, $l17);
                    $l19 = $Datos[0]->viernes_d_pm;
                    $l20 = $Datos[0]->viernes_h_pm;
                    $total_minutos = $total_minutos + calcular_tiempo_trasnc($l20, $l19);
                    //echo $total_minutos;
                    $campos = TraeCampos($Empresa);
                    $participantes = TraeParticipantesInscripcion($id_inscripcion, $campos[0]->campo1, $campos[0]->campo2, $campos[0]->campo3);
                    $cuenta = 0;
                    foreach ($participantes as $usuario) {
                        $Incripcion2 = Trae_Inscripciones_Cierre($id_inscripcion, $usuario->rut);
                        if ($Incripcion2[0]->id == "") {
                            $Incripcion3 = Trae_Inscripciones_Usuario($id_inscripcion, $usuario->rut);
                            $costoTotal = $Incripcion3[0]->costototal;
                            $costoOtec = $Incripcion3[0]->franquicia;
                            $costoEmpresa = $Incripcion3[0]->costo_empresa;
                            $viatico = $Incripcion3[0]->viatico;
                            $movilizacion = $Incripcion3[0]->movilizacion;
                        } else {
                            $costoTotal = $Incripcion2[0]->costototal;
                            $costoOtec = $Incripcion2[0]->franquicia;
                            $costoEmpresa = $Incripcion2[0]->costo_empresa;
                            $viatico = $Incripcion2[0]->viatico;
                            $movilizacion = $Incripcion2[0]->movilizacion;
                        }
                        if ($usuario->campo3 <> "15" and $usuario->campo3 <> "50" and $usuario->campo3 <> "100") {
                            $alerta_tramo = "<span class='estado_reprobado'>* Tramo Incorrecto</span>";
                        } else {
                            $alerta_tramo = "";
                        }
                        $tablaParticipante .= '<tr style="font-size: 11px;" id="tr_participante_' . $cuenta . '"><td>' . $usuario->rut_completo . '<br>' . utf8_encode($usuario->nombre_completo) . '<input type="hidden" id="rut_' . $cuenta . '" name="rut_' . $cuenta . '" value=' . $usuario->rut . ' >
        <input type="hidden" id="id_tabla_' . $cuenta . '" name="id_tabla_' . $cuenta . '" value=' . $usuario->id_inscripcion . ' >
        </td>
        <td>' . $usuario->campo1 . '</td>
        <td>' . $usuario->campo2 . '</td>
        <!--<td>' . $usuario->campo3 . '</td>-->
        <td><input type="text" value="' . $usuario->campo3 . '" style="width:60px;" maxlength="9" name="tramo_sence_' . $cuenta . '" id="tramo_sence_' . $cuenta . '">
        ' . $alerta_tramo . '</td>
        <td>' . $usuario->empresa_holding . '</td>
        <td><b>' . number_format($costoTotal, 0, ",", ".") . '</b>
        <input type="hidden" name="costoTotal_' . $cuenta . '" value="' . $costoTotal . '" id="costoTotal_' . $cuenta . '" ></td>
        <td><b>' . number_format($costoOtec, 0, ",", ".") . '</b>
        <input type="hidden" name="costoOtec_' . $cuenta . '" value="' . $costoOtec . '" id="costoOtec_' . $cuenta . '" ></td>
        <td><b>' . number_format($costoEmpresa, 0, ",", ".") . '</b>
        <input type="hidden" name="costoEmpresa_' . $cuenta . '" value="' . $costoEmpresa . '" id="costoEmpresa_' . $cuenta . '" ></td>
        <td><input type="text" value="' . $movilizacion . '" style="width:60px;" maxlength="9" name="viatico_' . $cuenta . '" id="viatico_' . $cuenta . '" ></td>
        <td><input type="text" value="' . $viatico . '" style="width:60px;" maxlength="9" name="movilizacion_' . $cuenta . '" id="movilizacion_' . $cuenta . '"></td>
        <td><button type="button" style="width:24px;height:24px;" onclick="borrar_participante(\'' . $cuenta . '\',\'' . $usuario->rut . '\')"class="btn btn-block btn-danger btn-xs">X</button></td>
        </tr>';
                        $cuenta++;
                    }
                    //DATOS Inscripcion
                    $PRINCIPAL = str_replace("{FECHAINICIO}", formatearFechaSmall($fecha_inicio), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{FECHATERMINO}", formatearFechaSmall($fecha_termino), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{NUMEROSDIAS}", $numerodias, $PRINCIPAL);
                    $PRINCIPAL = str_replace("{MODALIDAD}", $modalidad, $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VALORHORAC}", $valorhoracurso, $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VALORTOTALC}", $valortotalcurso, $PRINCIPAL);
                    $PRINCIPAL = str_replace("{DIRECCION}", $direccion, $PRINCIPAL);
                    $PRINCIPAL = str_replace("{COMUNA}", $comuna, $PRINCIPAL);
                    $PRINCIPAL = str_replace("{REGION}", $region, $PRINCIPAL);
                    $PRINCIPAL = str_replace("{SELECT_REGION_" . $region . "}", "selected='selected'", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{COMENTARIO}", $comentario, $PRINCIPAL);
                    $PRINCIPAL = str_replace("{SA}", $SA, $PRINCIPAL);
                    $PRINCIPAL = str_replace("{SC}", $SC, $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L1}", option_hora("07", "13", $l1), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L1H}", $l1, $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L2}", option_hora("07", "13", $l2), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L2H}", $l2, $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L3}", option_hora("12", "21", $l3), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L3H}", $l3, $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L4}", option_hora("12", "21", $l4), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L4H}", $l4, $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L5}", option_hora("07", "13", $l5), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L5H}", $l5, $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L6}", option_hora("07", "13", $l6), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L6H}", $l6, $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L7}", option_hora("12", "21", $l7), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L7H}", $l7, $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L8}", option_hora("12", "21", $l8), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L8H}", $l8, $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L9}", option_hora("07", "13", $l9), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L9H}", $l9, $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L10}", option_hora("07", "13", $l10), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L10H}", $l10, $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L11}", option_hora("12", "21", $l11), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L11H}", $l11, $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L12}", option_hora("12", "21", $l12), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L12H}", $l12, $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L13}", option_hora("07", "13", $l3), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L13H}", $l3, $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L14}", option_hora("07", "13", $l14), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L14H}", $l14, $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L15}", option_hora("12", "21", $l15), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L15H}", $l15, $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L16}", option_hora("12", "21", $l16), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L16H}", $l16, $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L17}", option_hora("07", "13", $l17), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L17H}", $l17, $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L18}", option_hora("07", "13", $l18), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L18H}", $l18, $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L19}", option_hora("12", "21", $l19), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L19H}", $l19, $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L20}", option_hora("12", "21", $l20), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L20H}", $l20, $PRINCIPAL);
                    $PRINCIPAL = str_replace("{TITULOINSCRIPCION}", $titulo, $PRINCIPAL);
                    //HORARIOS}
                    $link = '<a  target="_blank" href="?sw=detinexc&ii=' . ($id_inscripcion) . '&reh=' . ($Empresa) . '" style="height:28px;" class="btn btn-primary" >Exportar Excel OTIC</a>';
                    $PRINCIPAL = str_replace("{LINK_OTEC}", $link, $PRINCIPAL);
                    $PRINCIPAL = str_replace("{TABLA_PARTICIPANTES}", $tablaParticipante, $PRINCIPAL);
                    $PRINCIPAL = str_replace("{LINEAS}", $cuenta, $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{LINK_OTEC}", "", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{LINEAS}", "0", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{TABLA_PARTICIPANTES}", "", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{TITULOINSCRIPCION}", $titulo, $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L1}", option_hora("07", "13", $l1), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L2}", option_hora("07", "13", $l2), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L3}", option_hora("12", "21", $l3), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L4}", option_hora("12", "21", $l4), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L5}", option_hora("07", "13", $l5), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L6}", option_hora("07", "13", $l6), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L7}", option_hora("12", "21", $l7), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L8}", option_hora("12", "21", $l8), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L9}", option_hora("07", "13", $l9), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L10}", option_hora("07", "13", $l10), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L11}", option_hora("12", "21", $l11), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L12}", option_hora("12", "21", $l12), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L13}", option_hora("07", "13", $l3), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L14}", option_hora("07", "13", $l14), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L15}", option_hora("12", "21", $l15), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L16}", option_hora("12", "21", $l16), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L17}", option_hora("07", "13", $l17), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L18}", option_hora("07", "13", $l18), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L19}", option_hora("12", "21", $l19), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{L20}", option_hora("12", "21", $l20), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{FECHAINICIO}", "", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{FECHATERMINO}", "", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{NUMEROSDIAS}", "", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{MODALIDAD}", "", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VALORHORAC}", "", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{VALORTOTALC}", "", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{DIRECCION}", "", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{COMUNA}", "", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{REGION}", "", $PRINCIPAL);
                    $PRINCIPAL = str_replace("{COMENTARIO}", "", $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function inscripcionTabla($Empresa, $id)
            {
                $Incripciones = TraeIncripcionEmpresaID($Empresa, $id);
                $rows_ = "";
                $rows1_ = "";
                foreach ($Incripciones as $unico) {
                    $rows_ = file_get_contents("../views/capacitacion/inscripcion/row_listado_inscripcion_con_acciones_ajax.html");
                    $rows_ = str_replace("{CODIGOINCRIPCION}", $unico->codigo_inscripcion, $rows_);
                    $rows_ = str_replace("{CLASIFICACION}", $unico->clasificacion, $rows_);
                    $rows_ = str_replace("{CURSO}", $unico->nombre, $rows_);
                    $rows_ = str_replace("{ID_CURSO}", $unico->id_curso, $rows_);
                    $rows_ = str_replace("{FECHA_INICIO}", formatearFechaSmall($unico->fecha_inicio), $rows_);
                    $rows_ = str_replace("{FECHA_TERMINO}", formatearFechaSmall($unico->fecha_termino), $rows_);
                    $rows_ = str_replace("{PARTICIPANTES}", Total_Participantes($Empresa, $unico->codigo_inscripcion), $rows_);
                    $rows_ = str_replace("{ICONO_EXPORTAR_REPORTE}", "", $rows_);
                    //Verifico si esta inscripcion tiene o no PAGO OK
                    if ($unico->pago == "si") {
                        $rows_ = str_replace("{CHECKED_PAGO}", 'checked="checked"', $rows_);
                    } else {
                        $rows_ = str_replace("{CHECKED_PAGO}", "", $rows_);
                    }
                    $Incripcion2 = Total_Inscripciones($Empresa, $unico->codigo_inscripcion);
                    $total_html2 = "";
                    $rows1_ = "";
                    $cuenta = "";
                    $total_costo = "";
                    $franquicia = "";
                    $costoempresa = "";
                    $viatico = "";
                    $movilizacion = "";
                    $real = '<span class="label label-success" style="padding-left: 5px;"> Valor Real</span>';
                    if ($Incripcion2[0]->id == "") {
                        $Incripcion2 = Total_Inscripciones_Estimado($Empresa, $unico->codigo_inscripcion);
                        $real = '<span class="label label-warning" style="padding-left: 5px;"> Valor Estimado</span>';
                    }
                    foreach ($Incripcion2 as $unico2) {
                        $cuenta++;
                        $rows1_ = file_get_contents("../views/capacitacion/inscripcion/row_listado_inscripcion_totales.html");
                        $rows1_ = str_replace("{EMPRESAHOLDING}", $unico2->empresa_holding, $rows1_);
                        $rows1_ = str_replace("{COSTOTOTAL}", number_format($unico2->costototal, 0, ",", "."), $rows1_);
                        $rows1_ = str_replace("{FRANQUICIA}", number_format($unico2->franquicia, 0, ",", "."), $rows1_);
                        $rows1_ = str_replace("{COSTOEMPRESA}", number_format($unico2->costo_empresa, 0, ",", "."), $rows1_);
                        $rows1_ = str_replace("{VIATICO}", number_format($unico2->viatico, 0, ",", "."), $rows1_);
                        $rows1_ = str_replace("{MOVILIZACION}", number_format($unico2->movilizacion, 0, ",", "."), $rows1_);
                        $total_costo = $total_costo + ($unico2->costototal);
                        $franquicia = $franquicia + ($unico2->franquicia);
                        $costoempresa = $costoempresa + ($unico2->costo_empresa);
                        $viatico = $viatico + ($unico2->viatico);
                        $movilizacion = $movilizacion + ($unico2->movilizacion);
                        $total_html2 .= $rows1_;
                    }
                    $rows_ = str_replace("{REAL}", $real, $rows_);
                    $cab = '<table class="table table-bordered table-hover"><thead><tr>
                                                <th class="width40 bg_gray">Empresa</th>
                                                <th class="width100 bg_gray">Valor Total</th>
                                                <th class="width140 bg_gray">Franquicia</th>
                                                <th class="width140 bg_gray">Costo Empresa</th>
                                                <th class="width140 bg_gray">Viatico</th>
                                                <th class="width140 bg_gray">Movilizacion</th>
                                            </tr>
                                        </thead>
                                        <tbody>';
                    if ($cuenta > 1) {
                        $tr = ' <tr>
                            <td class="miniSt"><strong>Total</strong</td>
                            <td class="miniSt"><strong>' . number_format($total_costo, 0, ",", ".") . '</strong></td>
                            <td class="miniSt"><strong>' . number_format($franquicia, 0, ",", ".") . '</strong></td>
                            <td class="miniSt"><strong>' . number_format($costoempresa, 0, ",", ".") . '</strong></td>
                            <td class="miniSt"><strong>' . number_format($viatico, 0, ",", ".") . '</strong></td>
                            <td class="miniSt"><strong>' . number_format($movilizacion, 0, ",", ".") . '</strong></td>
                        </tr>';
                        $total_html2 .= $tr;
                    }
                    $rows_ = str_replace("{TABLA}", $cab . $total_html2 . "</tbody></table>", $rows_);
                    $fecha_actual = date("Y-m-d");
                    if ($unico->fecha_inicio > $fecha_actual) {
                        //no iniciado gris
                        $estado = '<i class="fa fa-circle text-default"></i>';
                        $estadonom = "No Iniciado";
                    }
                    if ($unico->fecha_inicio < $fecha_actual && $fecha_actual < $unico->fecha_termino) {
                        //en proceso amarilla
                        $estadonom = "En proceso";
                        $estado = '<i class="fa fa-circle text-warning"></i>';
                    }
                    if ($fecha_actual > $unico->fecha_termino && $cuenta == "") {
                        //terminada roja
                        $estadonom = "Terminada";
                        $estado = '<i class="fa fa-circle text-danger"></i>';
                    }
                    if ($fecha_actual > $unico->fecha_termino && $cuenta != "") {
                        //finalizada verde
                        $estadonom = "Finalizada";
                        $estado = '<i class="fa fa-circle text-success"></i>';
                    }
                    if ($unico->fecha_inicio == "") {
                        //simple celeste
                        $estadonom = "Libre";
                        $estado = '<i class="fa fa-circle text-info"></i>';
                    }
                    $rows_ = str_replace("{ESTADO}", $estado, $rows_);
                    $rows_ = str_replace("{ESTADONOMBRE}", $estadonom, $rows_);
                    $total_html .= $rows_;
                }
                return $total_html;
            }

            function ListaInscripciones($PRINCIPAL, $Empresa, $registros_pagina, $registros_total, $pagina, $desde, $codigo, $fecha1, $fecha2)
            {
                if ($registros_total == "") {
                    $registros_total = CuentaIncripcionEmpresa($Empresa, $fecha1, $fecha2, $codigo);
                }
                if ($registros_pagina == "") {
                    $registros_pagina = 9;
                }
                if ($pagina == "") {
                    $pagina = 1;
                }
                if ($desde == "") {
                    $desde = 0;
                }
                $Incripciones = TraeIncripcionEmpresa($Empresa, $desde, $registros_pagina, $codigo, $fecha1, $fecha2);
                $rows_ = "";
                $rows1_ = "";
                foreach ($Incripciones as $unico) {
                    $rows_ = file_get_contents("views/capacitacion/inscripcion/row_listado_inscripcion.html");
                    $rows_ = str_replace("{CODIGOINCRIPCION}", $unico->codigo_inscripcion, $rows_);
                    $rows_ = str_replace("{ID_INSCRIPCION_ENCODEADO}", Encodear3($unico->codigo_inscripcion), $rows_);
                    $rows_ = str_replace("{ICONO_EXPORTAR_REPORTE}", '<a href="?sw=GR&ii=' . Encodear3($unico->codigo_inscripcion) . '&reh=' . Encodear3($unico2
                            ->empresa) . '" onclick="abrirReporte(this.href);return false"><i class="fa fa-file-text"></i></a>', $rows_);
                    $rows_ = str_replace("{CLASIFICACION}", $unico->clasificacion, $rows_);
                    $rows_ = str_replace("{CURSO}", $unico->nombre, $rows_);
                    $rows_ = str_replace("{ID_CURSO}", $unico->id_curso, $rows_);
                    $rows_ = str_replace("{FECHA_INICIO}", formatearFechaSmall($unico->fecha_inicio), $rows_);
                    $rows_ = str_replace("{FECHA_TERMINO}", formatearFechaSmall($unico->fecha_termino), $rows_);
                    $rows_ = str_replace("{PARTICIPANTES}", Total_Participantes($Empresa, $unico->codigo_inscripcion), $rows_);
                    $Incripcion2 = Total_Inscripciones($Empresa, $unico->codigo_inscripcion);
                    $total_html2 = "";
                    $rows1_ = "";
                    $cuenta = "";
                    $total_costo = "";
                    $franquicia = "";
                    $costoempresa = "";
                    $viatico = "";
                    $movilizacion = "";
                    $REAL = '<span class="label label-success" style="padding-left: 5px;"> Valor Real</span>';
                    if ($Incripcion2[0]->id == "") {
                        $Incripcion2 = Total_Inscripciones_Estimado($Empresa, $unico->codigo_inscripcion);
                        $REAL = '<span class="label label-warning" style="padding-left: 5px;"> Valor Estimado</span>';
                    }
                    foreach ($Incripcion2 as $unico2) {
                        $cuenta++;
                        $rows1_ = file_get_contents("views/capacitacion/inscripcion/row_listado_inscripcion_totales.html");
                        //$rows1_ = str_replace("{EMPRESAHOLDING}",$unico2->empresa_holding,$rows1_);
                        $rows1_ = str_replace("{EMPRESAHOLDING}", $unico2->nombre_empresa_holding, $rows1_);
                        $rows1_ = str_replace("{COSTOTOTAL}", colocarPesos($unico2->costototal), $rows1_);
                        $rows1_ = str_replace("{FRANQUICIA}", colocarPesos($unico2->franquicia), $rows1_);
                        $rows1_ = str_replace("{COSTOEMPRESA}", colocarPesos($unico2->costo_empresa), $rows1_);
                        $rows1_ = str_replace("{VIATICO}", colocarPesos($unico2->viatico), $rows1_);
                        $rows1_ = str_replace("{MOVILIZACION}", colocarPesos($unico2->movilizacion), $rows1_);
                        $total_costo = $total_costo + ($unico2->costototal);
                        $franquicia = $franquicia + ($unico2->franquicia);
                        $costoempresa = $costoempresa + ($unico2->costo_empresa);
                        $viatico = $viatico + ($unico2->viatico);
                        $movilizacion = $movilizacion + ($unico2->movilizacion);
                        $total_html2 .= $rows1_;
                    }
                    $rows_ = str_replace("{REAL}", $REAL, $rows_);
                    $cab = '<table class="table table-bordered table-hover"><thead><tr>
                                                <th class="width40 bg_gray">Empresa</th>
                                                <th class="width100 bg_gray">Valor Total</th>
                                                <th class="width140 bg_gray">Franquicia</th>
                                                <th class="width140 bg_gray">Costo Empresa</th>
                                                <th class="width140 bg_gray">Viatico</th>
                                                <th class="width140 bg_gray">Movilizacion</th>
                                            </tr>
                                        </thead>
                                        <tbody>';
                    if ($cuenta > 1) {
                        $tr = ' <tr>
                            <td class="miniSt"><strong>Total</strong</td>
                            <td class="miniSt"><strong>' . colocarPesos($total_costo) . '</strong></td>
                            <td class="miniSt"><strong>' . colocarPesos($franquicia) . '</strong></td>
                            <td class="miniSt"><strong>' . colocarPesos($costoempresa) . '</strong></td>
                            <td class="miniSt"><strong>' . colocarPesos($viatico) . '</strong></td>
                            <td class="miniSt"><strong>' . colocarPesos($movilizacion) . '</strong></td>
                        </tr>';
                        $total_html2 .= $tr;
                    }
                    $total_costo_empresa = $total_costo_empresa + $costoempresa;
                    $rows_ = str_replace("{TABLA}", $cab . $total_html2 . "</tbody></table>", $rows_);
                    $fecha_actual = date("Y-m-d");
                    //$arreglo_Fecha=explode("-", $fecha_actual);
                    //$fecha_actual=$arreglo_Fecha[2]."-".$arreglo_Fecha[1]."-".$arreglo_Fecha[0];
                    //echo $fecha_actual." ... ";
                    //echo $unico->fecha_inicio."<br>";
                    if ($unico->fecha_inicio > $fecha_actual) {
                        //no iniciado gris
                        $estado = '<i class="fa fa-circle text-default"></i>';
                        $estadonom = "No Iniciado";
                    }
                    //if ($unico->fecha_inicio<$fecha_actual && $fecha_actual<$unico->fecha_termino){
                    if ($unico->fecha_inicio < $fecha_actual && $fecha_actual < $unico->fecha_termino) {
                        //en proceso amarilla
                        $estadonom = "En proceso";
                        $estado = '<i class="fa fa-circle text-warning"></i>';
                    }
                    if ($fecha_actual > $unico->fecha_termino && $cuenta == "") {
                        //terminada roja
                        $estadonom = "Terminada";
                        $estado = '<i class="fa fa-circle text-danger"></i>';
                    }
                    if ($fecha_actual > $unico->fecha_termino && $cuenta != "") {
                        //finalizada verde
                        $estadonom = "Finalizada";
                        $estado = '<i class="fa fa-circle text-success"></i>';
                    }
                    if ($unico->fecha_inicio == "") {
                        //simple celeste
                        $estadonom = "Libre";
                        $estado = '<i class="fa fa-circle text-info"></i>';
                    }
                    $rows_ = str_replace("{ESTADO}", $estado, $rows_);
                    $rows_ = str_replace("{ESTADONOMBRE}", $estadonom, $rows_);
                    $total_html .= $rows_;
                }
                if ($registros_total > 10) {
                    $total_paginas = redondea($registros_total / $registros_pagina);
                    $total_paginas_ = $registros_total / $registros_pagina;
                    //Pagina Anterior
                    $pagina_anterior = $pagina - 1;
                    //Pagina Siguiente
                    $posterior = $pagina + 1;
                    if ($pagina > 1) {
                        //$row.=file_get_contents("views/dnc/row_fichacurso.html");
                        //$row = str_replace("{CURSO}",$unico->curso,$row);
                        //$paginacion.="<a href='?sw=".$env."&p=".($pagina-1)."'><<&nbsp;&nbsp;</a>";
                        $paginacion .= file_get_contents("views/paginacion/1.html");
                        $paginacion = str_replace("{ENV}", "listaInscripciones", $paginacion);
                        $paginacion = str_replace("{PAGINA}", ($pagina - 1), $paginacion);
                        $paginacion = str_replace("{PAGINAINICIAL}", "1", $paginacion);
                        $paginacion = str_replace("{REGISTROS}", round($registros_pagina), $paginacion);
                        $paginacion = str_replace("{DESDEINICIO}", 1, $paginacion);
                        if ($fecha1 != "" && $fecha2 != "") {
                            $paginacion = str_replace("{DESDE}", round($desde) - $registros_pagina . "&fecha1=" . $fecha1 . "&fecha2=" . $fecha2, $paginacion);
                        } else {
                            $paginacion = str_replace("{DESDE}", round($desde) - $registros_pagina, $paginacion);
                        }
                        $paginacion = str_replace("{TOTALREGISTROS}", round($registros_total), $paginacion);
                    }
                    if (($pagina + 10) > $total_paginas) {
                        $resta = $pagina + 10;
                        $valor = ($pagina + 10) - $total_paginas;
                        $pagina1 = $pagina - $valor;
                    } else {
                        $pagina1 = $pagina;
                    }
                    for ($i = $pagina1; $i <= round(($pagina1) + 10); $i++) {
                        if ($pagina == $i) {
                            //$paginacion.="<b><strong><span style='color:#000'>".$i."</span></strong></b>";
                            $paginacion .= file_get_contents("views/paginacion/actual.html");
                            $paginacion = str_replace("{PAGINA}", ($i), $paginacion);
                            $paginacion = str_replace("{ENV}", "listaInscripciones", $paginacion);
                        } else {
                            //$paginacion.="<a href='?sw=".$env."&p=".$i."'>".$i."</a></b>";
                            if ($i > 0) {
                                if ($desde1 == "") {
                                    $desde1 = (($registros_pagina * $i) + 1) - $registros_pagina;
                                }
                                $paginacion .= file_get_contents("views/paginacion/numero.html");
                                $paginacion = str_replace("{PAGINA}", ($i), $paginacion);
                                $paginacion = str_replace("{REGISTROS}", round($registros_pagina), $paginacion);
                                if ($fecha1 != "" && $fecha2 != "") {
                                    $paginacion = str_replace("{DESDE}", $desde1 . "&fecha1=" . $fecha1 . "&fecha2=" . $fecha2, $paginacion);
                                } else {
                                    $paginacion = str_replace("{DESDE}", $desde1, $paginacion);
                                }
                                $paginacion = str_replace("{TOTALREGISTROS}", round($registros_total), $paginacion);
                                $paginacion = str_replace("{ENV}", "listaInscripciones", $paginacion);
                            }
                        }
                        $desde1 = ($registros_pagina * $i) + 1;
                    }
                    if ($pagina < $total_paginas && $total_paginas > 10) {
                        //$paginacion.="<a href='?sw=".$env."&p=".($pagina+1)."'>&nbsp;&nbsp;>></a>";
                        $paginacion .= file_get_contents("views/paginacion/4.html");
                        $paginacion = str_replace("{ENV}", "listaInscripciones", $paginacion);
                        $paginacion = str_replace("{PAGINA}", ($pagina + 1), $paginacion);
                        $paginacion = str_replace("{PAGINAFINAL}", $total_paginas, $paginacion);
                        $paginacion = str_replace("{REGISTROS}", round($registros_pagina), $paginacion);
                        if ($fecha1 != "" && $fecha2 != "") {
                            $paginacion = str_replace("{DESDE}", ($pagina * $registros_pagina) + (1) . "&fecha1=" . $fecha1 . "&fecha2=" . $fecha2, $paginacion);
                        } else {
                            $paginacion = str_replace("{DESDE}", ($pagina * $registros_pagina) + 1, $paginacion);
                        }
                        $paginacion = str_replace("{DESDEFINAL}", (((int)($total_paginas_)) * $registros_pagina) + 1, $paginacion);
                        $paginacion = str_replace("{TOTALREGISTROS}", round($registros_total), $paginacion);
                    }
                } else {
                    $PRINCIPAL = str_replace("{PAGINACION}", "", $PRINCIPAL);
                }
                $PRINCIPAL = str_replace("{REGISTROS" . $registros_pagina . "}", "selected", $PRINCIPAL);
                $PRINCIPAL = str_replace("{PAGINACION}", $paginacion, $PRINCIPAL);
                $PRINCIPAL = str_replace("{RANGO_FECHAS}", "", $PRINCIPAL);
                $PRINCIPAL = str_replace("{BCODIGO}", $codigo, $PRINCIPAL);
                $PRINCIPAL = str_replace("{BFECHA1}", $fecha1, $PRINCIPAL);
                $PRINCIPAL = str_replace("{BFECHA2}", $fecha2, $PRINCIPAL);
                $PRINCIPAL = str_replace("{RESUMEN}", "Hay un total de " . $registros_total . " Inscripciones", $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_EMPRESA}", $Empresa, $PRINCIPAL);
                $PRINCIPAL = str_replace("{ROW_LISTADO}", utf8_encode($total_html), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PRESUPUESO_RESTANTE}", colocarPesos(5000000 - $total_costo_empresa), $PRINCIPAL);
                $PRINCIPAL = str_replace("{TOTAL_COSTO_EMPRESA}", colocarPesos($total_costo_empresa), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function buscar_participante($buscar, $id_empresa)
            {
                $Campos = TraeCampos($id_empresa);
                $Campos1 = $Campos[0]->campo1;
                $Campos2 = $Campos[0]->campo2;
                $Campos3 = $Campos[0]->campo3;
                $total_html = "";
                $i = 1;
                $pi = 0;
                $participantes = TraeParticipanteBuscar($id_empresa, $Campos1, $Campos2, $Campos3, $buscar);
                $ACampo1 = array();
                $ACampo2 = array();
                $ACampo3 = array();
                foreach ($participantes as $unico) {
                    $row = file_get_contents("../views/capacitacion/participantes/row_personas.html");
                    $row = str_replace("{FOTO}", VerificaFotoPersonalDesdeAdmin($unico->rut), $row);
                    $row = str_replace("{RUT}", $unico->rut, $row);
                    $row = str_replace("{NOMBRE}", $unico->nombre, $row);
                    $row = str_replace("{PATERNO}", $unico->apaterno, $row);
                    $row = str_replace("{MATERNO}", $unico->amaterno, $row);
                    $row = str_replace("{CARGO1}", $unico->cargo, $row);
                    $row = str_replace("{EMAIL}", $unico->email, $row);
                    $row = str_replace("{CAMPO1}", $unico->campo1, $row);
                    $row = str_replace("{CAMPO2}", $unico->campo2, $row);
                    $row = str_replace("{CAMPO3}", $unico->campo3, $row);
                    $ACampo1[$pi] = $unico->campo1;
                    $ACampo2[$pi] = $unico->campo2;
                    $ACampo3[$pi] = $unico->campo3;
                    $row = str_replace("{NCAMPO1}", str_replace("_", " ", ucwords($Campos1)), $row);
                    $row = str_replace("{NCAMPO2}", str_replace("_", " ", ucwords($Campos2)), $row);
                    $row = str_replace("{NCAMPO3}", str_replace("_", " ", ucwords($Campos3)), $row);
                    $row = str_replace("{MALLA}", $unico->malla, $row);
                    //obtener numero de cursos
                    $Cursos = TraeCursosInscritosParticipante($id_empresa, $unico->rut);
                    $CuentaC = 0;
                    $S = "";
                    $CuentaA = "";
                    $CuentaR = "";
                    $R = "";
                    foreach ($Cursos as $cur) {
                        $CuentaC++;
                        if ($CuentaC > 1) {
                            $S = "s";
                        }
                        $Consulta = ConsultaCursoCierre($id_empresa, $unico->rut, $cur->id_inscripcion, $cur->id_curso);
                        if (($Consulta[0]->id) != "") {
                            $CuentaR++;
                        }
                        if (($Consulta[0]->estado) == "1") {
                            $CuentaA++;
                        }
                        if ($Consulta == "1" || $Consulta == "0") {
                            $R++;
                        }
                    }
                    //Avance
                    $avance = round((100 * $CuentaA) / $CuentaC);
                    $avanceCursos = round((100 * $CuentaR) / $CuentaC);
                    // if ($avance==100){
                    // $AC="0, 166, 90";
                    // $AC2="#00a65a";
                    // }else{
                    $AC = "60, 141, 188";
                    $AC2 = "#3c8dbc";
                    // }
                    $row = str_replace("{AVANCE}", round((100 * $CuentaA) / $CuentaC), $row);
                    $row = str_replace("{AVANCEC}", $AC, $row);
                    $row = str_replace("{AVANCECURSO}", $avanceCursos, $row);
                    $row = str_replace("{AVANCEC2}", $AC2, $row);
                    $row = str_replace("{S}", $S, $row);
                    $row = str_replace("{REALIZADO}", $R, $row);
                    $row = str_replace("{CURSOS}", $CuentaC, $row);
                    $row = str_replace("{OPCIONES}", "", $row);
                    $total_html .= $row;
                    $pi++;
                }
                return $total_html;
            }

            function inscripcionTabladcurso($id)
            {
                $Curso = TraeCursoID($id);
                $total_html = '<table class="table table-bordered table-hover"><thead ><tr>
                                                <th class="width40 bg_gray" style="font-size:10;font-weight: bold;">COD</th>
                                                <th class="width100 bg_gray" style="font-size:10;font-weight: bold;">CURSO</th>
                                                <th class="width100 bg_gray" style="font-size:10;font-weight: bold;">CLASIFICACION</th>
                                                <th class="width140 bg_gray" style="font-size:10;font-weight: bold;">OTEC</th>
                                                <th class="width140 bg_gray" style="font-size:10;font-weight: bold;">MODALIDAD</th>
                                                <th class="width140 bg_gray" style="font-size:10;font-weight: bold;">TIPO</th>
                                                <th class="width140 bg_gray" style="font-size:10;font-weight: bold;">CBC</th>
                                                <th class="width140 bg_gray" style="font-size:10;font-weight: bold;">SENCE</th>
                                                <th class="width140 bg_gray" style="font-size:10;font-weight: bold;">HORAS</th>
                                                <th class="width140 bg_gray" style="font-size:10;font-weight: bold;">$_HH</th>
                                                <th class="width140 bg_gray" style="font-size:10;font-weight: bold;">$_PART</th>
                                            </tr>
                                        </thead>
                                        <tbody >
                                        <tr>
                                            <td style="font-size:10;">' . $Curso[0]->id . '</td>
                                            <td style="font-size:10;">' . $Curso[0]->nombre . '</td>
                                            <td style="font-size:10;">' . $Curso[0]->nombre_clasificacion . '</td>
                                            <td style="font-size:10;">' . $Curso[0]->nombre_otec . '<br>' . $Curso[0]->rut_otec . '</td>
                                            <td style="font-size:10;">' . $Curso[0]->nombre_modalidad . '</td>
                                            <td style="font-size:10;">' . $Curso[0]->nombre_tipo_curso . '</td>
                                            <td style="font-size:10;">' . $Curso[0]->cbc . '</td>
                                            <td style="font-size:10;">' . $Curso[0]->sence . '<br>' . $Curso[0]->numero_identificador . '</td>
                                            <td style="font-size:10;">' . $Curso[0]->numero_horas . '</td>
                                            <td style="font-size:10;">' . number_format($Curso[0]->valor_hora, 0, ",", ".") . '</td>
                                            <td style="font-size:10;">' . number_format(($Curso[0]->numero_horas * $Curso[0]->valor_hora), 0, ",", ".") . '</td>
                                            </tr>
                                        </tbody>
                                        <tfoot>
                                        </tfoot>
                                    </table>';
                return $total_html;
            }

            function option_hora($desde, $hasta, $hora)
            {
                for ($i = 0; $i < 50; $i += 15) {
                    if ($comienzo == 0) {
                        $minuto = "00";
                        $i = 0;
                        $comienzo = 1;
                    } else {
                        $minuto = $i;
                    }
                    if ($desde . ':' . $minuto == $hora) {
                        $selected = "selected";
                    } else {
                        $selected = "";
                    }
                    $option .= '<option ' . $selected . ' >' . $desde . ':' . $minuto . '</option>';
                    if ($i == "45") {
                        $desde = (int)$desde + 1;
                        if (strlen($desde) == 1) {
                            $desde = "0" . $desde;
                        }
                        if ($hasta > (int)$desde) {
                            $i = 0;
                            $comienzo = 0;
                        } else {
                            if ($desde . ':00' == $hora) {
                                $selected = "selected";
                            } else {
                                $selected = "";
                            }
                            $option .= '<option ' . $selected . ' >' . $desde . ':00</option>';
                        }
                    }
                }
                return $option;
            }

            function ReporteCapacitacionFullxlsx($PRINCIPAL, $id_empresa, $arreglo_post, $criterio, $excel)
            {
                $usuarios = TraigoDatosTablareportesConsolidad_Full($id_empresa);
                $objPHPExcel = new PHPExcel();
                $styleArray = array(
                    'font' => array(
                        'bold' => true,
                        'color' => array('rgb' => '000000'),
                        'size' => 12,
                        'name' => 'Calibri'
                    ));
                // Establecer propiedades
                $objPHPExcel->getProperties()
                    ->setCreator("GO Partners")
                    ->setLastModifiedBy("GO Partners")
                    ->setTitle("Usuarios por Imparticion")
                    ->setSubject("Usuarios por Imparticion")
                    ->setDescription("Plantilla para carga masiva de usuarios")
                    ->setKeywords("Excel Office 2007 openxml php")
                    ->setCategory("Plantilla usuarios");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("A1", "CORRELATIVO IMPARTICION");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("B1", "RUT PARTICIPANTE");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("C1", "NOMBRE COMPLETO");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("D1", "CARGO");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("E1", "UNIDAD (CENCO)");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("F1", "DEPENDENCIA (R3)");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("G1", "FONDO (R2)");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("H1", "GERENCIA (R1)");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("I1", "EMPRESA RUT");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("J1", "JEFE PERS.");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("K1", "JEFE PERS. NOMBRE");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("L1", "REGION");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("M1", "SEXO");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("N1", "FAMILIA DE CARGO");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("O1", "EJECUTIVO RESPONSABLE");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("P1", "FOCO ESTRATEGICO");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("Q1", "PROGRAMA");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("R1", "NOMBRE INTERNO IMPARTICION");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("S1", "NOMBRE SENCE CURSO");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("T1", "TIPO CURSO");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("U1", "ANNO INICIO");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("V1", "MES INICIO");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("W1", "FORMATO    STATUS");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("X1", "ASISTENCIA");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("Y1", "EVAL (NOTA PARTICIP)");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("Z1", "COD SENCE");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("AA1", "FECHA INICIO");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("AB1", "FECHA TERMINO");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("AC1", "ANNO FIN");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("AD1", "MES TERMINO");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("AE1", "HORAS TOTALES");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("AF1", "HORAS SENCE");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("AG1", "HORAS BCI");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("AH1", "LUGAR DE EJECUCION (DIRECCION)");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("AI1", "CATEGORIA LUGAR");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("AJ1", "NOMBRE OTEC RAZON SOCIAL");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("AK1", "RUT OTEC PROVEEDOR");
                $i = 2;
                foreach ($usuarios as $usu) {
//FAMILIA DE CARGO    EJECUTIVO RESPONSABLE    FOCO ESTRATEGICO    PROGRAMA    NOMBRE INTERNO IMPARTICION    NOMBRE SENCE CURSO    TIPO CURSO    ANNO INICIO    MES INICIO    FORMATO STATUS    ASISTENCIA    EVAL (NOTA PARTICIP)    COD SENCE    FECHA INICIO    FECHA TERMINO    ANNO FIN    MES TERMINO    HORAS TOTALES    HORAS SENCE    HORAS BCI    LUGAR DE EJECUCION (DIRECCION)    CATEGORIA LUGAR    NOMBRE OTEC RAZON SOCIAL    RUT OTEC PROVEEDOR
                    $jk++;
//echo "$jk";
                    if ($usu->rut_completo == '') {
                        $objPHPExcel->setActiveSheetIndex(0)->setCellValue("B" . $i, utf8_encode($usu->rut));
                        $objPHPExcel->setActiveSheetIndex(0)->setCellValue("C" . $i, "USUARIO NO VIGENTE");
                    } else {
                        $objPHPExcel->setActiveSheetIndex(0)->setCellValue("B" . $i, utf8_encode($usu->rut_completo));
                        $objPHPExcel->setActiveSheetIndex(0)->setCellValue("C" . $i, utf8_encode($usu->nombre_completo));
                    }
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("A" . $i, utf8_encode($usu->id_inscripcion));
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("B" . $i, utf8_encode($usu->rut_completo));
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("C" . $i, utf8_encode($usu->nombre_completo));
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("D" . $i, utf8_encode($usu->cargo));
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("E" . $i, utf8_encode($usu->c1));
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("F" . $i, utf8_encode($usu->c2));
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("G" . $i, utf8_encode($usu->c3));
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("H" . $i, utf8_encode($usu->c4));
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("I" . $i, "");
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("J" . $i, utf8_encode($usu->Rutjefe));
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("K" . $i, utf8_encode($usu->jefe));
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("L" . $i, "");
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("M" . $i, "");
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("N" . $i, "");
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("O" . $i, $usu->Ejecutivo);
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("P" . $i, utf8_encode($usu->Programa));
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("Q" . $i, utf8_decode($usu->Foco));
                    if ($usu->ModalidadCurso == 2) {
                        //Presencial
                        $fechainicio = $usu->FechaInicioPres;
                        $fechatermino = $usu->FechaTerminoPres;
                        if ($TipoCurso == 2) {
                            $tipo = "Externo";
                        } else {
                            $tipo = "Interno";
                        }
                        $objPHPExcel->setActiveSheetIndex(0)->setCellValue("R" . $i, utf8_encode($usu->NombreCurso));
                        $objPHPExcel->setActiveSheetIndex(0)->setCellValue("S" . $i, "");
                        $AnnoInicio = date('Y', strtotime($usu->FechaInicioPres));
                        $MesInicio = date('m', strtotime($usu->FechaInicioPres));
                        $formatoStatus = "";
                        $asistencia = 10;
                        if ($usu->avanceElearning > 0) {
                            $asistencia = "100%";
                        } else {
                            $asistencia = "0%";
                        }
                        $evaluacion = "";
                        $FechaInicio = $usu->FechaInicioPres;
                        $FechaTermino = $usu->FechaTerminoPres;
                        $AnnoTermino = date('Y', strtotime($usu->FechaTerminoPres));
                        $MesTermino = date('m', strtotime($usu->FechaTerminoPres));
                        $lugar = $usu->LugarEjecucion;
                    } else {
                        //Elearning
                        $objPHPExcel->setActiveSheetIndex(0)->setCellValue("R" . $i, utf8_encode($usu->Programa));
                        $objPHPExcel->setActiveSheetIndex(0)->setCellValue("S" . $i, "");
                        $tipo = "Interno";
                        if ($usu->FechaInicioElearning <> '0000-00-00' and $usu->FechaInicioElearning <> NULL) {
                            $AnnoInicio = date('Y', strtotime($usu->FechaInicioElearning));
                            $MesInicio = date('m', strtotime($usu->FechaInicioElearning));
                        } else {
                            $AnnoInicio = '-';
                            $MesInicio = '-';
                        }
                        $formatoStatus = "";
                        $asistencia = $usu->avanceElearning . "%";
                        $evaluacion = $usu->notaElearning;
                        $FechaInicio = $usu->FechaInicioElearning;
                        $FechaTermino = $usu->FechaTerminoElearning;
                        if ($usu->FechaTerminoElearning <> '0000-00-00' and $usu->FechaTerminoElearning <> NULL) {
                            $AnnoTermino = date('Y', strtotime($usu->FechaTerminoElearning));
                            $MesTermino = date('m', strtotime($usu->FechaTerminoElearning));
                        } else {
                            $AnnoTermino = "-";
                            $MesTermino = "-";
                        }
                        $lugar = "Puesto Trabajo";
                    }
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("T" . $i, $tipo);
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("U" . $i, $AnnoInicio);
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("V" . $i, $MesInicio);
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("W" . $i, $formatoStatus);
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("X" . $i, $asistencia);
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("Y" . $i, $evaluacion);
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("Z" . $i, "");
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("AA" . $i, $FechaInicio);
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("AB" . $i, $FechaTermino);
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("AC" . $i, $AnnoTermino);
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("AD" . $i, $MesTermino);
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("AE" . $i, $usu->HorasCurso);
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("AF" . $i, "");
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("AG" . $i, "");
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("AH" . $i, $lugar);
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("AI" . $i, "");
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("AJ" . $i, "");
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("AK" . $i, "");
                    $i++;
                }
                $sheet = $objPHPExcel->getActiveSheet();
                $cellIterator = $sheet->getRowIterator()->current()->getCellIterator();
                $cellIterator->setIterateOnlyExistingCells(true);
                /** @var PHPExcel_Cell $cell */
                foreach ($cellIterator as $cell) {
                    $sheet->getColumnDimension($cell->getColumn())->setAutoSize(true);
                }
                // Renombrar Hoja
                $objPHPExcel->getActiveSheet()->setTitle('Usuarios');
                // Establecer la hoja activa, para que cuando se abra el documento se muestre primero.
                $objPHPExcel->setActiveSheetIndex(0);
                // Se modifican los encabezados del HTTP para indicar que se envia un archivo de Excel.
                $fechahoy = date("Y-m-d") . "_" . date("H:i:s");
                header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
                header('Content-Disposition: attachment;filename="' . $id_programa . 'ReporteCapacitacionFullxlsx' . $fechahoy . '.xlsx"');
                header('Cache-Control: max-age=0');
                $objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
                $objWriter->save('php://output');
                exit;
            }

            function ReporteCapacitacionFull_xls($id_empresa)
            {
                $Total_Rows_full = Tragotb_DatosdesdeFull();
                foreach ($Total_Rows_full as $Unico) {
                    $rows = file_get_contents("views/reportes/full/row_listado_excel.html");
                    $rows = str_replace("{id_inscripcion}", $Unico->id_inscripcion, $rows);
                    $rows = str_replace("{rut_completo}", $Unico->rut_completo, $rows);
                    $rows = str_replace("{nombre}", $Unico->nombre, $rows);
                    $rows = str_replace("{cargo}", $Unico->cargo, $rows);
                    $rows = str_replace("{c4}", $Unico->c4, $rows);
                    $rows = str_replace("{c3}", $Unico->c3, $rows);
                    $rows = str_replace("{c2}", $Unico->c2, $rows);
                    $rows = str_replace("{c1}", $Unico->c1, $rows);
                    $rows = str_replace("{empresa}", $Unico->empresa, $rows);
                    $rows = str_replace("{rut_jefe}", $Unico->rut_jefe, $rows);
                    $rows = str_replace("{jefe}", $Unico->jefe, $rows);
                    $rows = str_replace("{ejecutivo}", $Unico->ejecutivo, $rows);
                    $rows = str_replace("{foco}", $Unico->foco, $rows);
                    $rows = str_replace("{programa}", $Unico->programa, $rows);
                    $rows = str_replace("{curso}", $Unico->curso, $rows);
                    $rows = str_replace("{tipo_curso}", $Unico->tipo_curso, $rows);
                    $rows = str_replace("{anno_inicio}", $Unico->anno_inicio, $rows);
                    $rows = str_replace("{mes_inicio}", $Unico->mes_inicio, $rows);
                    $rows = str_replace("{fecha_inicio}", $Unico->fecha_inicio, $rows);
                    $rows = str_replace("{anno_termino}", $Unico->anno_termino, $rows);
                    $rows = str_replace("{mes_termino}", $Unico->mes_termino, $rows);
                    $rows = str_replace("{fecha_termino}", $Unico->fecha_termino, $rows);
                    $rows = str_replace("{status}", $Unico->status, $rows);
                    $rows = str_replace("{asistencia}", $Unico->asistencia, $rows);
                    $rows = str_replace("{evaluacion}", $Unico->evaluacion, $rows);
                    $rows = str_replace("{horas}", $Unico->horas, $rows);
                    $rows = str_replace("{lugar}", $Unico->lugar, $rows);
                    $rows = str_replace("{curso_opcional}", $Unico->curso_opcional, $rows);
                    echo $rows;
                }
            }

            function ReporteCapacitacionFull_xlsx($id_empresa)
            {
                require_once 'clases/PHPExcel.php';
                $objPHPExcel = new PHPExcel();
                $styleArray = array(
                    'font' => array(
                        'bold' => true,
                        'color' => array('rgb' => '000000'),
                        'size' => 12,
                        'name' => 'Calibri'
                    ));
// Establecer propiedades
                $objPHPExcel->getProperties()
                    ->setCreator("GO Partners")
                    ->setLastModifiedBy("GO Partners")
                    ->setTitle("Reporte Full")
                    ->setSubject("Reporte Full")
                    ->setDescription("Reporte Full")
                    ->setKeywords("Excel Office 2007 openxml php")
                    ->setCategory("Reporte Full");
                $lastColumn = $objPHPExcel->getActiveSheet()->getHighestColumn();
                $lastColumn2 = $objPHPExcel->getActiveSheet()->getHighestColumn();
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("A1", "CORRELATIVO IMPARTICION");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("B1", "RUT PARTICIPANTE");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("C1", "NOMBRE COMPLETO");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("D1", "CARGO");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("E1", "UNIDAD (CENCO)");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("F1", "DEPENDENCIA (R3)");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("G1", "FONDO (R2)");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("H1", "GERENCIA (R1)");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("I1", "EMPRESA");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("J1", "JEFE PERS.");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("K1", "JEFE PERS. NOMBRE");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("L1", "EJECUTIVO RESPONSABLE");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("M1", "FOCO ESTRATEGICO");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("N1", "PROGRAMA");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("O1", "NOMBRE INTERNO IMPARTICION");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("P1", "TIPO CURSO");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("Q1", "ANNO INICIO");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("R1", "MES INICIO");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("S1", "FECHA INICIO");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("T1", "ANNO FIN");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("U1", "MES TERMINO");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("V1", "FECHA TERMINO");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("W1", "FORMATO STATUS");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("X1", "ASISTENCIA");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("Y1", "EVALUACION");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("Z1", "HORAS TOTALES");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("AA1", "LUGAR DE EJECUCION (DIRECCION)");
                $objPHPExcel->setActiveSheetIndex(0)->setCellValue("AB1", "CURSO OPCIONAL");
                $i = 1;
                $Total_Rows_full = Tragotb_DatosdesdeFull();
                foreach ($Total_Rows_full as $Unico) {
                    $i++;
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("A" . $i, utf8_encode($Unico->id_inscripcion));
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("B" . $i, utf8_encode($Unico->rut_completo));
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("C" . $i, utf8_encode($Unico->nombre));
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("D" . $i, utf8_encode($Unico->cargo));
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("E" . $i, utf8_encode($Unico->c4));
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("F" . $i, utf8_encode($Unico->c3));
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("G" . $i, utf8_encode($Unico->c2));
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("H" . $i, utf8_encode($Unico->c1));
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("I" . $i, utf8_encode($Unico->empresa));
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("J" . $i, utf8_encode($Unico->rut_jefe));
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("K" . $i, utf8_encode($Unico->jefe));
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("L" . $i, utf8_encode($Unico->ejecutivo));
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("M" . $i, utf8_encode($Unico->foco));
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("N" . $i, utf8_encode($Unico->programa));
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("O" . $i, utf8_encode($Unico->curso));
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("P" . $i, utf8_encode($Unico->tipo_curso));
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("Q" . $i, utf8_encode($Unico->anno_inicio));
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("R" . $i, utf8_encode($Unico->mes_inicio));
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("S" . $i, utf8_encode($Unico->fecha_inicio));
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("T" . $i, utf8_encode($Unico->anno_termino));
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("U" . $i, utf8_encode($Unico->mes_termino));
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("V" . $i, utf8_encode($Unico->fecha_termino));
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("W" . $i, utf8_encode($Unico->status));
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("X" . $i, utf8_encode($Unico->asistencia));
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("Y" . $i, utf8_encode($Unico->evaluacion));
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("Z" . $i, utf8_encode($Unico->horas));
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("AA" . $i, utf8_encode($Unico->lugar));
                    $objPHPExcel->setActiveSheetIndex(0)->setCellValue("AB" . $i, utf8_encode($Unico->curso_opcional));
                }
                $sheet = $objPHPExcel->getActiveSheet();
                $cellIterator = $sheet->getRowIterator()->current()->getCellIterator();
                $cellIterator->setIterateOnlyExistingCells(true);
                /** @var PHPExcel_Cell $cell */
                foreach ($cellIterator as $cell) {
                    $sheet->getColumnDimension($cell->getColumn())->setAutoSize(true);
                }
// Renombrar Hoja
                $objPHPExcel->getActiveSheet()->setTitle('Reporte Full');
// Establecer la hoja activa, para que cuando se abra el documento se muestre primero.
                $objPHPExcel->setActiveSheetIndex(0);
// Se modifican los encabezados del HTTP para indicar que se envia un archivo de Excel.
                $fechahoy = date("Y-m-d") . "_" . date("H:i:s");
                header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
                header('Content-Disposition: attachment;filename="Reporte_full_' . $fechahoy . '.xlsx"');
                header('Cache-Control: max-age=0');
                $objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel2007');
                $objWriter->save('php://output');
                exit;
            }


            function Reporte_Full_Filtros($PRINCIPAL, $id_empresa, $arreglo_post, $excel)
            {
                $datos_empresa = DatosEmpresa($id_empresa);
                $campos_subida = REL_MALLA_CURSO_trarCamposSubidaParaReporte($id_empresa);
                $total_vueltas = ceil(count($campos_subida) / 4);
                $html_filtros = "";
                $vuelta = 1;
                $arreglo_post2 = $_POST;

                foreach ($campos_subida as $campo) {
                    if ($vuelta == 1) {
                        $html_filtros .= "<div class=''>";
                    }
                    $html_filtros .= file_get_contents("views/reportes/capacitacion/filtros_dinamicos.html");
                    $html_filtros = str_replace("{NOMBRECAMPOAMOSTRAR}", ($campo->nombrecampoamostrar), $html_filtros);
                    $html_filtros = str_replace("{ID}", ($campo->id), $html_filtros);
                    $html_filtros = str_replace("{CAMPO}", ($campo->campo), $html_filtros);
                    $valores_option = TraigoValoresDadoCampoPorEmpreas($campo->campo, $id_empresa, $arreglo_post2);
                    $options = "";
                    foreach ($valores_option as $valor) {
                        if ($_POST[$campo->campo]) {
                            for ($contador_valores = 0; $contador_valores < count($_POST[$campo->campo]); $contador_valores++) {
                                if (utf8_decode($_POST[$campo->campo][$contador_valores]) == $valor->valor) {
                                    $selected = "selected='selected'";
                                    break;
                                } else {
                                    $selected = "";
                                }
                            }
                        }
                        $options .= "<option $selected  value='" . $valor->valor . "'>" . $valor->valor . "</option>";
                        $selected = "";
                    }
                    $html_filtros = str_replace("{OPTIONS}", ($options), $html_filtros);
                    if ($vuelta == 4) {
                        $html_filtros .= "</div>";
                        $vuelta = 1;
                    } else {
                        $vuelta++;
                    }
                }

                $focos = TraeFocosPorEmpresa($id_empresa);
                $options_focos = "";
                foreach ($focos as $foc) {
                    if ($arreglo_post["foco"] == $foc->codigo_foco) {
                        $options_focos .= '<option value="' . $foc->codigo_foco . '" selected>' . $foc->descripcion . '</option>';
                    } else {
                        $options_focos .= '<option value="' . $foc->codigo_foco . '">' . $foc->descripcion . '</option>';
                    }
                }

                $PRINCIPAL = str_replace("{OPTIONS_FOCOS}", utf8_encode($options_focos), $PRINCIPAL);


                //Programas Globales
                $programas_globales = TraeProgramasGlobales($id_empresa);
                foreach ($programas_globales as $prog_g) {
                    $options_progamas_globales .= "<option value='" . $prog_g->id_programa . "'>" . $prog_g->nombre_programa . "</option>";
                }
                $PRINCIPAL = str_replace("{OPTIONS_PROGRAMAS_GLOBAL}", utf8_encode($options_progamas_globales), $PRINCIPAL);


                //Programas Elearning
                $programas_elearning = TraeProgramasElearning($id_empresa);
                foreach ($programas_elearning as $prog_e) {
                    $options_progamas_elearning .= "<option value='" . $prog_e->id_programa . "'>" . $prog_e->nombre_programa . "</option>";
                }
                $PRINCIPAL = str_replace("{OPTIONS_PROGRAMAS_BBDD}", utf8_encode($options_progamas_elearning), $PRINCIPAL);

                //Mallas
                $mallas = TraeMallasReportesFull($id_empresa);
                foreach ($mallas as $mall) {
                    $options_mallas .= "<option value='" . $mall->id . "'>" . $mall->nombre . "</option>";
                }
                $PRINCIPAL = str_replace("{MALLAS}", utf8_encode($options_mallas), $PRINCIPAL);

                //cursos
                $cursos = TraeCursosReportesFull($id_empresa);
                foreach ($cursos as $cur) {
                    $options_cursos .= "<option value='" . $cur->id . "'>" . $cur->nombre . "</option>";
                    $options_cursos_id .= "<option value='" . $cur->id . "'>" . $cur->id . "</option>";
                }
                $PRINCIPAL = str_replace("{CURSOS}", utf8_encode($options_cursos), $PRINCIPAL);

                $id_cursos = TraeCursosReportesFullAsc($id_empresa);
                foreach ($id_cursos as $cur) {
                    $options_cursos_id3 .= "<option value='" . $cur->id . "'>" . $cur->id . "</option>";
                }

                $PRINCIPAL = str_replace("{ID_CURSOS}", utf8_encode($options_cursos_id3), $PRINCIPAL);

                //Imparticiones
                $imparticiones = TraeImparticionesReportesFull($id_empresa);
                foreach ($imparticiones as $imp) {
                    $options_imparticiones .= "<option value='" . $imp->codigo_inscripcion . "'>" . $imp->codigo_inscripcion . "</option>";
                }
                $PRINCIPAL = str_replace("{IMPARTICIONES}", utf8_encode($options_imparticiones), $PRINCIPAL);

                $fecha_ultima = buscaUltimaFechaFull();
                $PRINCIPAL = str_replace("{FECHA_ACTUALIZACION_REPORTE}", ($fecha_ultima), $PRINCIPAL);

                $PRINCIPAL = str_replace("{FILTROS_DINAMICOS}", utf8_encode($html_filtros), $PRINCIPAL);

                //	REPORTES AUTOMATICOS
                $ReportesAutomaticosFN = ReportesAutomaticosFN($id_empresa);
                $PRINCIPAL = str_replace("{ROW_REPORTES_AUTOMATICOS_ULTIMOS_8}", $ReportesAutomaticosFN, $PRINCIPAL);

                $programa_array = Reportes_Express_Programa($id_empresa);
                foreach ($programa_array as $unico) {
                    $row_programas_array .= "<option value='" . $unico->id_programa . "'>" . utf8_encode($unico->programa) . "</option>";
                }

                $PRINCIPAL = str_replace("{ROW_PROGRAMAS_ARRAY}", $row_programas_array, $PRINCIPAL);


                echo $PRINCIPAL;
            }

            function Reporte_Full_Filtros_v2($PRINCIPAL, $id_empresa, $arreglo_post, $excel)
            {
                $datos_empresa = DatosEmpresa($id_empresa);
                $campos_subida = REL_MALLA_CURSO_trarCamposSubidaParaReporte($id_empresa);
                $total_vueltas = ceil(count($campos_subida) / 4);
                $html_filtros = "";
                $vuelta = 1;
                $arreglo_post2 = $_POST;

                foreach ($campos_subida as $campo) {
                    if ($vuelta == 1) {
                        $html_filtros .= "<div class=''>";
                    }
                    $html_filtros .= file_get_contents("views/reportes/capacitacion/filtros_dinamicos.html");
                    $html_filtros = str_replace("{NOMBRECAMPOAMOSTRAR}", ($campo->nombrecampoamostrar), $html_filtros);
                    $html_filtros = str_replace("{ID}", ($campo->id), $html_filtros);
                    $html_filtros = str_replace("{CAMPO}", ($campo->campo), $html_filtros);
                    $valores_option = TraigoValoresDadoCampoPorEmpreas($campo->campo, $id_empresa, $arreglo_post2);
                    $options = "";
                    foreach ($valores_option as $valor) {
                        if ($_POST[$campo->campo]) {
                            for ($contador_valores = 0; $contador_valores < count($_POST[$campo->campo]); $contador_valores++) {
                                if (utf8_decode($_POST[$campo->campo][$contador_valores]) == $valor->valor) {
                                    $selected = "selected='selected'";
                                    break;
                                } else {
                                    $selected = "";
                                }
                            }
                        }
                        $options .= "<option $selected  value='" . $valor->valor . "'>" . $valor->valor . "</option>";
                        $selected = "";
                    }
                    $html_filtros = str_replace("{OPTIONS}", ($options), $html_filtros);
                    if ($vuelta == 4) {
                        $html_filtros .= "</div>";
                        $vuelta = 1;
                    } else {
                        $vuelta++;
                    }
                }

                $focos = TraeFocosPorEmpresa($id_empresa);
                $options_focos = "";
                foreach ($focos as $foc) {
                    if ($arreglo_post["foco"] == $foc->codigo_foco) {
                        $options_focos .= '<option value="' . $foc->codigo_foco . '" selected>' . $foc->descripcion . '</option>';
                    } else {
                        $options_focos .= '<option value="' . $foc->codigo_foco . '">' . $foc->descripcion . '</option>';
                    }
                }

                $PRINCIPAL = str_replace("{OPTIONS_FOCOS}", utf8_encode($options_focos), $PRINCIPAL);


                //Programas Globales
                $programas_globales = TraeProgramasGlobales($id_empresa);
                foreach ($programas_globales as $prog_g) {
                    $options_progamas_globales .= "<option value='" . $prog_g->id_programa . "'>" . $prog_g->nombre_programa . "</option>";
                }
                $PRINCIPAL = str_replace("{OPTIONS_PROGRAMAS_GLOBAL}", utf8_encode($options_progamas_globales), $PRINCIPAL);


                //Programas Elearning
                $programas_elearning = TraeProgramasElearning($id_empresa);
                foreach ($programas_elearning as $prog_e) {
                    $options_progamas_elearning .= "<option value='" . $prog_e->id_programa . "'>" . $prog_e->nombre_programa . "</option>";
                }
                $PRINCIPAL = str_replace("{OPTIONS_PROGRAMAS_BBDD}", utf8_encode($options_progamas_elearning), $PRINCIPAL);

                //Mallas
                $mallas = TraeMallasReportesFull($id_empresa);
                foreach ($mallas as $mall) {
                    $options_mallas .= "<option value='" . $mall->id . "'>" . $mall->nombre . "</option>";
                }
                $PRINCIPAL = str_replace("{MALLAS}", utf8_encode($options_mallas), $PRINCIPAL);

                //cursos
                $cursos = TraeCursosReportesFull($id_empresa);
                foreach ($cursos as $cur) {
                    $options_cursos .= "<option value='" . $cur->id . "'>" . $cur->nombre . "</option>";
                    $options_cursos_id .= "<option value='" . $cur->id . "'>" . $cur->id . "</option>";
                }
                $PRINCIPAL = str_replace("{CURSOS}", utf8_encode($options_cursos), $PRINCIPAL);

                $id_cursos = TraeCursosReportesFullAsc($id_empresa);
                foreach ($id_cursos as $cur) {
                    $options_cursos_id3 .= "<option value='" . $cur->id . "'>" . $cur->id . "</option>";
                }

                $PRINCIPAL = str_replace("{ID_CURSOS}", utf8_encode($options_cursos_id3), $PRINCIPAL);

                //Imparticiones
                $imparticiones = TraeImparticionesReportesFull($id_empresa);
                foreach ($imparticiones as $imp) {
                    $options_imparticiones .= "<option value='" . $imp->codigo_inscripcion . "'>" . $imp->codigo_inscripcion . "</option>";
                }
                $PRINCIPAL = str_replace("{IMPARTICIONES}", utf8_encode($options_imparticiones), $PRINCIPAL);

                $fecha_ultima = buscaUltimaFechaFull();
                $PRINCIPAL = str_replace("{FECHA_ACTUALIZACION_REPORTE}", ($fecha_ultima), $PRINCIPAL);

                $PRINCIPAL = str_replace("{FILTROS_DINAMICOS}", utf8_encode($html_filtros), $PRINCIPAL);

                //	REPORTES AUTOMATICOS
                $ReportesAutomaticosFN = ReportesAutomaticosFN($id_empresa);
                $PRINCIPAL = str_replace("{ROW_REPORTES_AUTOMATICOS_ULTIMOS_8}", $ReportesAutomaticosFN, $PRINCIPAL);

                $programa_array = Reportes_Express_Programa($id_empresa);
                foreach ($programa_array as $unico) {
                    $row_programas_array .= "<option value='" . $unico->id_programa . "'>" . utf8_encode($unico->programa) . "</option>";
                }

                $PRINCIPAL = str_replace("{ROW_PROGRAMAS_ARRAY}", $row_programas_array, $PRINCIPAL);


                echo $PRINCIPAL;
            }


            function ReporteCapacitacion($PRINCIPAL, $id_empresa, $arreglo_post, $criterio, $excel, $tipo_reporte_general)
            {
//echo "<br><br>ReporteCapacitacion<br>excel $excel";
//print_r($arreglo_post);
                $datos_empresa = DatosEmpresa($id_empresa);
                $campos_subida = REL_MALLA_CURSO_trarCamposSubidaParaReporte($id_empresa);
                $total_vueltas = ceil(count($campos_subida) / 4);
                $html_filtros = "";
                $vuelta = 1;
                $arreglo_post2 = $_POST;
                foreach ($campos_subida as $campo) {
                    if ($vuelta == 1) {
                        $html_filtros .= "<div class=''>";
                    }
                    $html_filtros .= file_get_contents("views/reportes/capacitacion/filtros_dinamicos.html");
                    $html_filtros = str_replace("{NOMBRECAMPOAMOSTRAR}", ($campo->nombrecampoamostrar), $html_filtros);
                    $html_filtros = str_replace("{ID}", ($campo->id), $html_filtros);
                    $html_filtros = str_replace("{CAMPO}", ($campo->campo), $html_filtros);
                    $valores_option = TraigoValoresDadoCampoPorEmpreas($campo->campo, $id_empresa, $arreglo_post2);
                    $options = "";
                    foreach ($valores_option as $valor) {
                        if ($_POST[$campo->campo]) {
                            for ($contador_valores = 0; $contador_valores < count($_POST[$campo->campo]); $contador_valores++) {
                                if (utf8_decode($_POST[$campo->campo][$contador_valores]) == $valor->valor) {
                                    $selected = "selected='selected'";
                                    break;
                                } else {
                                    $selected = "";
                                }
                            }
                        }
                        $options .= "<option $selected  value='" . $valor->valor . "'>" . $valor->valor . "</option>";
                        $selected = "";
                    }
                    $html_filtros = str_replace("{OPTIONS}", ($options), $html_filtros);
                    if ($vuelta == 4) {
                        $html_filtros .= "</div>";
                        $vuelta = 1;
                    } else {
                        $vuelta++;
                    }
                }
                $PRINCIPAL = str_replace("{FILTROS_DINAMICOS}", utf8_encode($html_filtros), $PRINCIPAL);
//$mallas=TraeMallasEmpresa($id_empresa);
                $mallas = REL_MALLA_CURSO_TraeMallasDadoFoco($id_empresa, $arreglo_post);
                foreach ($mallas as $malla) {
                    if ($arreglo_post["malla"] == $malla->id_malla) {
                        $option_mallas .= '<option selected value="' . $malla->id_malla . '">' . $malla->nombre . ' (' . $malla->id_malla . ')</option>';
                    } else {
                        $option_mallas .= '<option value="' . $malla->id_malla . '">' . $malla->nombre . ' (' . $malla->id_malla . ')</option>';
                    }
                }
                //$cursos=TraeCursos("0",$id_empresa);
                //$cursos=TraeCursos($arreglo_post["malla"],$id_empresa,$arreglo_post["clasificacion"]);
                //$cursos=REL_MALLA_CURSO_TraeCursosDadoFoco($id_empresa, $arreglo_post);
                $cursos = REL_MALLA_CURSO_TraeCursosDadoFoco($id_empresa, $arreglo_post);
                //echo count($cursos);//exit();
                $option_cursos = "";
                //echo "aca";
                foreach ($cursos as $curso) {
                    /*if($arreglo_post["cursos"]==$curso->id_curso){
            $option_cursos.='<option value="'.$curso->id_curso.'" selected>'.$curso->nombre.' ('.$curso->id_curso.')</option>';
        }else{
            $option_cursos.='<option value="'.$curso->id_curso.'">'.$curso->nombre.' ('.$curso->id_curso.')</option>';
        }*/
                    if (count($_POST["cursos"]) > 0) {
                        for ($contador_valores = 0; $contador_valores < count($_POST["cursos"]); $contador_valores++) {
                            if ($_POST["cursos"][$contador_valores] == $curso->id_curso) {
                                $selected = "selected='selected'";
                                break;
                            } else {
                                $selected = "";
                                //$selected="selected='selected'";
                                //$selected="selected='selected'";
                            }
                        }
                    }
                    $option_cursos .= '<option ' . $selected . ' value="' . $curso->id_curso . '">' . $curso->nombre . ' (' . $curso->id_curso . ')</option>';
                    //$options.="<option $selected  value='".$valor->valor."'>".$valor->valor."</option>";
                    $selected = "";
                }
//Imparticiones
                //Traigo las imparticiones desde tbl_inscripcion_curso
                //if(count($_POST["cursos"])==1)
                $imparticiones = TraeImparticionesPorCurso($_POST["cursos"][0], $id_empresa);
                foreach ($imparticiones as $impa) {
                    if ($arreglo_post["imparticion"] == $impa->codigo_inscripcion) {
                        $option_imparticiones .= '<option value="' . $impa->codigo_inscripcion . '" selected>' . $impa->codigo_inscripcion . '  (' . $impa->participantes . ')</option>';
                    } else {
                        $option_imparticiones .= '<option value="' . $impa->codigo_inscripcion . '">' . $impa->codigo_inscripcion . '  (' . $impa->participantes . ') </option>';
                    }
                }
                //Clasificaciones Filtro
                $clasificaciones = TraeClasificaciones($arreglo_post["malla"], $id_empresa);
                $options_clasificaciones = "";
                foreach ($clasificaciones as $clasif) {
                    if ($arreglo_post["clasificacion"] == $clasif->id_clasificacion) {
                        $option_clasificaciones .= '<option value="' . $clasif->id_clasificacion . '" selected>' . $clasif->clasificacion . ' (' . $clasif->id_clasificacion . ')</option>';
                    } else {
                        $option_clasificaciones .= '<option value="' . $clasif->id_clasificacion . '">' . $clasif->clasificacion . ' (' . $clasif->id_clasificacion . ')</option>';
                    }
                }
                //FOCOS Filtro
                $focos = TraeFocosPorEmpresa($id_empresa);
                $options_focos = "";
                foreach ($focos as $foc) {
                    if ($arreglo_post["foco"] == $foc->codigo_foco) {
                        $options_focos .= '<option value="' . $foc->codigo_foco . '" selected>' . $foc->descripcion . '</option>';
                    } else {
                        $options_focos .= '<option value="' . $foc->codigo_foco . '">' . $foc->descripcion . '</option>';
                    }
                }
                //ejecutivos Filtros
                $ejecutivos = TraeEjecutivosPorEmpresa($id_empresa);
                $options_ejecutivos = "";
                foreach ($ejecutivos as $ejec) {
                    if ($datos_imparticion[0]->ejecutivo == $ejec->ejecutivo) {
                        $options_ejecutivos .= '<option value="' . $ejec->ejecutivo . '" selected>' . $ejec->nombre_completo . '</option>';
                    } else {
                        $options_ejecutivos .= '<option value="' . $ejec->ejecutivo . '" >' . $ejec->nombre_completo . '</option>';
                    }
                }
                //Objetos Filtro
                $objetos = TraeObjetosCursosPorEmpresa($_POST["cursos"][0], $id_empresa);
                $options_objetos = "";
                foreach ($objetos as $obj) {
                    if ($arreglo_post["objetos"] == $obj->id) {
                        $options_objetos .= '<option value="' . $obj->id . '" selected>' . $obj->titulo . '- (' . $obj->id . ')</option>';
                    } else {
                        $options_objetos .= '<option value="' . $obj->id . '">' . $obj->titulo . ' - (' . $obj->id . ')</option>';
                    }
                }
                //PROGRAMAS BBDD Filtro
                $programasBBDD = TraeProgramasBBDDPorEmpresa($id_empresa);
                $options_programasBBDD = "";
                foreach ($programasBBDD as $progbbdd) {
                    if ($progbbdd->tipo == 'ELEARNING') {
                        $tipoprograma = " (Elearning)";
                    } else {
                        $tipoprograma = "";
                    }
                    if ($arreglo_post["programabbdd"] == $progbbdd->id_programa) {
                        $options_programasBBDD .= '<option value="' . $progbbdd->id_programa . '" selected>' . $progbbdd->nombre_programa . '' . $tipoprograma . '</option>';
                    } else {
                        $options_programasBBDD .= '<option value="' . $progbbdd->id_programa . '">' . $progbbdd->nombre_programa . '' . $tipoprograma . '</option>';
                    }
                }
                $c1BBDD = TraedatosDadoCampo($id_empresa, $datos_empresa[0]->campo1);
                $options_c1 = "";
                foreach ($c1BBDD as $c1) {
                    if ($arreglo_post["c1"] == $c1->valor) {
                        $options_c1 .= '<option value="' . $c1->valor . '" selected>' . $c1->valor . '</option>';
                    } else {
                        $options_c1 .= '<option value="' . $c1->valor . '">' . $c1->valor . '</option>';
                    }
                }
                $c2BBDD = TraedatosDadoCampo($id_empresa, $datos_empresa[0]->campo2);
                $options_c2 = "";
                foreach ($c2BBDD as $c2) {
                    if ($arreglo_post["c2"] == $c2->valor) {
                        $options_c2 .= '<option value="' . $c2->valor . '" selected>' . $c2->valor . '</option>';
                    } else {
                        $options_c2 .= '<option value="' . $c2->valor . '">' . $c2->valor . '</option>';
                    }
                }
                $c2BBDD = TraedatosDadoCampo($id_empresa, $datos_empresa[0]->campo3);
                $options_c3 = "";
                foreach ($c3BBDD as $c3) {
                    if ($arreglo_post["c3"] == $c3->valor) {
                        $options_c3 .= '<option value="' . $c3->valor . '" selected>' . $c3->valor . '</option>';
                    } else {
                        $options_c3 .= '<option value="' . $c3->valor . '">' . $c3->valor . '</option>';
                    }
                }
                $PRINCIPAL = str_replace("{IMPARTICIONES}", utf8_encode($option_imparticiones), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_C1}", utf8_encode($options_c1), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_C2}", utf8_encode($options_c2), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_C3}", utf8_encode($options_c3), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_PROGRAMAS_BBDD}", utf8_encode($options_programasBBDD), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_FOCOS}", utf8_encode($options_focos), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_EJECUTIVOS}", utf8_encode($options_ejecutivos), $PRINCIPAL);
                $PRINCIPAL = str_replace("{MALLAS}", utf8_encode($option_mallas), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CURSOS}", utf8_encode($option_cursos), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CLASIFICACIONES}", utf8_encode($option_clasificaciones), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OBJETOS}", utf8_encode($options_objetos), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_EMPRSA}", $id_empresa, $PRINCIPAL);
                $fechaactualizacion = LmsBuscaFechaReporte($id_empresa);
                $PRINCIPAL = str_replace("{FECHA_ACTUALIZACION_REPORTE}", $fechaactualizacion, $PRINCIPAL);
                //Traigo el listado de usuarios
                $i = 0;
                $acumulador_porcentajes_avance_malla = 0;
                $acumulador_visitas = 0;
                //$usuarios=UsuariosPorEmpresaCapacitacion($id_empresa, $arreglo_post);
                //traigo los datos desde la tabla de reportes
                if ($excel or $arreglo_post) {
                    $usuarios = TraigoDatosTablareportesConsolidad($id_empresa, $arreglo_post, "", $excel);
                }
                if ($excel) {
                    foreach ($usuarios as $usu) {
                        //Por cada usuario obtengo la malla
                        //echo $usu->rut_completo;
                        //echo $excel;exit;
                        $i++;
                        if ($excel == 1) {
                            if ($id_empresa == '61') {
                                //$rows=file_get_contents("views/reportes/capacitacion/61_row_avance_capacitacion_excel.html");
                                if ($tipo_reporte_general == "solo_fin") {
                                    if ($usu->avance == 100) {
                                        $rows = file_get_contents("views/reportes/capacitacion/61_row_avance_capacitacion_excel_consolidado_curso.html");
                                    } else {
                                        continue;
                                    }
                                } else if ($tipo_reporte_general == "solo_proceso") {
                                    if ($usu->avance > 0 and $usu->avance < 100) {
                                        $rows = file_get_contents("views/reportes/capacitacion/61_row_avance_capacitacion_excel_consolidado_curso.html");
                                    } else {
                                        continue;
                                    }
                                } else if ($tipo_reporte_general == "solo_no_iniciado") {
                                    if ($usu->avance === "0" or $usu->avance == "" or $usu->avance === "0") {
                                        $rows = file_get_contents("views/reportes/capacitacion/61_row_avance_capacitacion_excel_consolidado_curso.html");
                                    } else {
                                        continue;
                                    }
                                } else {
                                    $rows = file_get_contents("views/reportes/capacitacion/61_row_avance_capacitacion_excel_consolidado_curso.html");
                                }
                            } elseif ($id_empresa == '62') {
                                $rows = file_get_contents("views/reportes/capacitacion/62_row_avance_capacitacion_excel.html");
                            } else {
                                $rows = file_get_contents("views/reportes/capacitacion/row_avance_capacitacion_excel.html");
                            }
                        } elseif ($excel == 2 or $excel == 3) {
                            if ($id_empresa == '61') {
                                $rows = file_get_contents("views/reportes/capacitacion/61_row_avance_capacitacion_excel_detalle_curso.html");
                            } elseif ($id_empresa == '62') {
                                $rows = file_get_contents("views/reportes/capacitacion/62_row_avance_capacitacion_excel_detalle_curso.html");
                            } else {
                                $rows = file_get_contents("views/reportes/capacitacion/row_avance_capacitacion_excel_detalle_curso.html");
                            }
                        } else {
                            //echo "sin excel";
                            $rows .= file_get_contents("views/reportes/capacitacion/row_avance_capacitacion.html");
                        }
                        $rows = str_replace("{NUM}", $i, $rows);
                        //$rows = str_replace("{FOTO}",ColocaImagenVerificaAvatar($usu->rut, "admin"),$rows);
                        $rows = str_replace("{RUT_COMPLETO_EVALUADO}", $usu->rut_completo, $rows);
                        $rows = str_replace("{NOMBRE_COMPLETO}", $usu->nombre, $rows);
                        $rows = str_replace("{CARGO}", $usu->cargo, $rows);
                        $rows = str_replace("{EMAIL}", $usu->email, $rows);
                        $rows = str_replace("{CAMPO1}", $usu->c1, $rows);
                        $rows = str_replace("{CAMPO2}", $usu->c2, $rows);
                        $rows = str_replace("{CAMPO3}", $usu->c3, $rows);
                        $rows = str_replace("{CAMPO4}", $usu->c4, $rows);
                        if ($usu->rut_lider) {
                            $datos_lider = DatosTablaUsuario($usu->rut_lider);
                            $rows = str_replace("{NOMBRE_LIDER}", $datos_lider[0]->nombre_completo, $rows);
                        } else {
                            $rows = str_replace("{NOMBRE_LIDER}", "", $rows);
                        }
                        if ($usu->rut_jefe_de_lider) {
                            $datos_jefe_de_lider = DatosTablaUsuario($usu->rut_jefe_de_lider);
                            $rows = str_replace("{NOMBRE_JEFE_LIDER}", $datos_jefe_de_lider[0]->nombre_completo, $rows);
                        } else {
                            $rows = str_replace("{NOMBRE_JEFE_LIDER}", "", $rows);
                        }
                        if ($excel == 3) {
                            if ($usu->fecha_objeto_finalizado <> '') {
                                $avance = '100%';
                            } else {
                                $avance = '0%';
                            }
                            $rows = str_replace("{NUM_CURSOS}", "1", $rows);
                            $rows = str_replace("{CURSO}", $usu->tituloobjeto, $rows);
                            $rows = str_replace("{NUMERO_AVANCE}", ($avance), $rows);
                            $rows = str_replace("{PUNTOS}", $usu->puntos, $rows);
                            $rows = str_replace("{MALLA}", $usu->nombremalla, $rows);
                            $rows = str_replace("{ID_MALLA}", $usu->id_malla, $rows);
                            $rows = str_replace("{RESULTADO}", $usu->notaobjeto, $rows);
                            $rows = str_replace("{MEDALLAS}", $usu->medallas, $rows);
                            $rows = str_replace("{FECHA_LOGIN}", $usu->fecha_objeto_finalizado, $rows);
                            $rows = str_replace("{FECHA_FINAL}", $usu->fecha_objeto_finalizado, $rows);
                            $rows = str_replace("{HORATERMINO}", "", $rows);
                            $rows = str_replace("{INTENTOS}", "", $rows);
                            $rows = str_replace("{APROBADO}", "", $rows);
                            $rows = str_replace("{FECHAINSCRIPCION}", "", $rows);
                            $rows = str_replace("{ESTADO}", "", $rows);
                        } else {
                            $rows = str_replace("{NUM_CURSOS}", $usu->total_cursos, $rows);
                            $rows = str_replace("{CURSO}", $usu->nombre_curso, $rows);
                            $rows = str_replace("{NUMERO_AVANCE}", ColocarColoresConPorcentajeProgressBar($usu->avance), $rows);
                            $rows = str_replace("{PUNTOS}", $usu->suma_puntos, $rows);
                            $rows = str_replace("{MALLA}", $usu->nombremalla, $rows);
                            $rows = str_replace("{ID_MALLA}", $usu->id_malla, $rows);
                            $rows = str_replace("{RESULTADO}", $usu->resultado, $rows);
                            $rows = str_replace("{MEDALLAS}", $usu->suma_medallas, $rows);
                            $rows = str_replace("{FECHA_LOGIN}", $usu->FechaLogIn, $rows);
                            $rows = str_replace("{FECHA_FINAL}", $usu->FechaFin, $rows);
                        }
                        $rows = str_replace("{NUM_CURSOS}", $usu->total_cursos, $rows);
                        $rows = str_replace("{CURSO}", $usu->nombre_curso, $rows);
                        $rows = str_replace("{NUMERO_AVANCE}", ColocarColoresConPorcentajeProgressBar($usu->avance), $rows);
                        $rows = str_replace("{PUNTOS}", $usu->suma_puntos, $rows);
                        $rows = str_replace("{MALLA}", $usu->nombremalla, $rows);
                        $rows = str_replace("{ID_MALLA}", $usu->id_malla, $rows);
                        $rows = str_replace("{RESULTADO}", $usu->resultado, $rows);
                        $rows = str_replace("{MEDALLAS}", $usu->suma_medallas, $rows);
                        $rows = str_replace("{FECHA_LOGIN}", $usu->FechaLogIn, $rows);
                        $rows = str_replace("{FECHA_FINAL}", $usu->FechaFin, $rows);
                        $rows = str_replace("{FECHA_ANTIGUEDAD}", $usu->fecha_antiguedad, $rows);
                        if ($excel == 2) {
                            $rows = str_replace("{HORATERMINO}", $usu->hora_termino, $rows);
                            $rows = str_replace("{INTENTOS}", $usu->intentos, $rows);
                            $rows = str_replace("{ESTADO}", $usu->estado, $rows);
                        }
                        if ($usu->avance > 0 and $usu->avance < 100) {
                            $usu->estado = "EN_PROCESO";
                        }
                        if ($id_empresa == 521) {
                            //PARA WOM
                            if ($usu->avance === 0 or !$usu->avance) {
                                $rows = str_replace("{ESTADO}", "Pendiente", $rows);
                            } else if ($usu->avance > 0 and $usu->avance < 100) {
                                $rows = str_replace("{ESTADO}", "En Proceso", $rows);
                            } else if ($usu->avance >= 100) {
                                if ($usu->resultado >= 80) {
                                    $rows = str_replace("{ESTADO}", "Aprobado", $rows);
                                } else {
                                    $rows = str_replace("{ESTADO}", "Reprobado", $rows);
                                }
                            }
                        } else {
                            if ($excel == 1) {
                                if ($usu->avance == '100') {
                                    if ($usu->nota_aprobacion > 0) {
                                        if ($usu->resultado >= $usu->nota_aprobacion and $usu->nota_aprobacion > 0) {
                                            $rows = str_replace("{ESTADO}", "APROBADO", $rows);
                                        } else {
                                            $rows = str_replace("{ESTADO}", "REPROBADO", $rows);
                                        }
                                    } else {
                                        $rows = str_replace("{ESTADO}", "APROBADO", $rows);
                                    }
                                } else if ($usu->avance < '100' and $usu->avance > '0') {
                                    $rows = str_replace("{ESTADO}", "EN PROCESO", $rows);
                                } else {
                                    $rows = str_replace("{ESTADO}", "NO INICIADO", $rows);
                                }
                            } else {
                                $rows = str_replace("{ESTADO}", $usu->estado, $rows);
                            }
                        }
                        $rows = str_replace("{ESTADO}", $usu->estado, $rows);
                        $porcentaje_aprobacion = round((100 * $usu->total_aprobados / $usu->total_cursos), 1);
                        $porcentaje_aprobacion = number_format($porcentaje_aprobacion, 1, ',', ' ');
                        //echo "rut ".$usu->rut." $porcentaje_aprobacion=round(100*".$usu->total_aprobados."/".$usu->total_cursos.");";
                        $rows = str_replace("{PORCENTAJE_APROBACION}", $porcentaje_aprobacion, $rows);
                        if ($excel == 2) {
                            $rows = str_replace("{FECHAINSCRIPCION}", $usu->fecha_inscripcion, $rows);
                        }
                        $hoy = date("Y-m-d");
                        $avance_esperado = Lms_avanceEsperado($usu->FechaLogIn, $hoy, $usu->id_malla, $id_empresa);
                        if ($usu->avance < $avance_esperado) {
                            $estado = "NoIniciado";
                        }
                        if ($usu->avance >= $avance_esperado and $usu->avance > 0) {
                            $estado = "ATiempo";
                        }
                        if ($usu->avance < $avance_esperado and $usu->avance > 0) {
                            $estado = "Retrasado";
                        }
                        $rows = str_replace("{AVANCE_ESPERADO}", $avance_esperado . "%", $rows);
                        $rows = str_replace("{AVANCE_ESTADO}", $estado, $rows);
                        //echo "<br>".$usu->rut." ".$usu->fecha_antiguedad;
                        $acumulador_porcentajes_avance_malla = $acumulador_porcentajes_avance_malla + $datos_calculos_malla[1];
                        //echo "acumulador_porcentajes_avance_malla $acumulador_porcentajes_avance_malla=$acumulador_porcentajes_avance_malla+".$datos_calculos_malla[1]."";
                        $acumulador_visitas = $acumulador_visitas + $datos_calculos_malla[2][8];
                        if ($datos_calculos_malla[1] == 100) {
                            $acumula_finalizados++;
                        }
                        if ($datos_calculos_malla[1] == 0) {
                            $acumula_no_iniciados++;
                        }
                        if ($datos_calculos_malla[1] > 0 and $datos_calculos_malla[1] < 100) {
                            $acumula_en_proceso++;
                        }
                        if ($excel == 1 or $excel == 2 or $excel == 3) {
                            echo($rows);
                        }
                    }
                }
                if ($excel == 1) {
                    exit;
                }
                //echo "$i $acumula_finalizados $acumula_en_proceso $acumula_no_iniciados $acumula_ingresos";
                $acumula_ingresos = $acumula_en_proceso + $acumula_finalizados;
                $PRINCIPAL = str_replace("{LISTADO_USUARIOS}", $rows, $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS}", $i, $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_TOTAL}", number_format($acumulador_porcentajes_avance_malla / $i, 0, ",", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_ACCESOS}", $acumulador_visitas, $PRINCIPAL);
                //Bloque Total de Porcentaje Total
                //$PRINCIPAL = str_replace("{GRAFICO_PORCENTAJE_TOTAL}",file_get_contents("views/graficos/grafico_circulo.html"),$PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE}", number_format(100 * $acumula_finalizados / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_FINALIZADOS}", number_format($acumula_finalizados, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_FINALIZADOS}", number_format(100 * $acumula_finalizados / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_PROCESO}", number_format($acumula_en_proceso, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_PROCESO}", number_format(100 * $acumula_en_proceso / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_NOINICIADO}", number_format($acumula_no_iniciados, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_NOINICIADO}", number_format(100 * $acumula_no_iniciados / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_INGRESADOS}", number_format($acumula_ingresos, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_INGRESADOS}", number_format(100 * $acumula_ingresos / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{TEXTO}", "Avance", $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOMBRE_GRAFICO}", "Avance", $PRINCIPAL);
                //Bloque Total de ACESOS
                //$PRINCIPAL = str_replace("{GRAFICO_CANTIDAD_ACCESOS}",file_get_contents("views/graficos/grafico_circulo.html"),$PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE}", number_format(100 * $acumula_finalizados / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{TEXTO}", "Accesos", $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOMBRE_GRAFICO}", "Accesos", $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function ReporteSGDSeguimiento($PRINCIPAL, $id_empresa, $arreglo_post, $criterio, $excel)
            {
                //echo "$id_empresa, $arreglo_post, $criterio, $excel";
                $PRINCIPAL = str_replace("{ID_EMPRSA}", $id_empresa, $PRINCIPAL);
                //Traigo el listado de usuarios
                $i = 0;
                $acumulador_porcentajes_avance_malla = 0;
                $acumulador_visitas = 0;
                if ($excel or $arreglo_post) {
                    $usuarios = sgd_relaciones_proceso($id_empresa, $arreglo_post);
                }
                if ($excel) {
                    foreach ($usuarios as $usu) {
                        //echo $usu->rut;
                        $estado = "";
                        if ($usu->EstadoCuenta > 0) {
                            $estado = "Finalizado";
                        }
                        $i++;
                        if ($excel == 1) {
                            //$rows.=file_get_contents("views/reportes/capacitacion/row_avance_capacitacion_excel.html");
                            $rows = file_get_contents("views/sgd/row_avance_sgd_excel.html");
                        } else {
                            $rows .= file_get_contents("views/sgd/row_avance_sgd.html");
                        }
                        $rows = str_replace("{RUT_EVALUADO}", $usu->RutEvaluado, $rows);
                        $rows = str_replace("{EVALUADO}", $usu->Evaluado, $rows);
                        $rows = str_replace("{GERENCIA_EVALUADO}", $usu->gerencia_evaluado, $rows);
                        $rows = str_replace("{LOCAL_EVALUADO}", $usu->local_evaluado, $rows);
                        $rows = str_replace("{ZONAL_EVALUADO}", $usu->zonal_evaluado, $rows);
                        $rows = str_replace("{GERENTE_RF_EVALUADO}", $usu->gerente_rf_evaluado, $rows);
                        $rows = str_replace("{RUT_EVALUADOR}", $usu->RutEvaluador, $rows);
                        $rows = str_replace("{EVALUADOR}", $usu->Evaluador, $rows);
                        $rows = str_replace("{TIPO}", $usu->Tipo, $rows);
                        $rows = str_replace("{ESTADOCUENTA}", $estado, $rows);
                        $acumulador_porcentajes_avance_malla = $acumulador_porcentajes_avance_malla + $datos_calculos_malla[1];
                        //echo "acumulador_porcentajes_avance_malla $acumulador_porcentajes_avance_malla=$acumulador_porcentajes_avance_malla+".$datos_calculos_malla[1]."";
                        $acumulador_visitas = $acumulador_visitas + $datos_calculos_malla[2][8];
                        if ($datos_calculos_malla[1] == 100) {
                            $acumula_finalizados++;
                        }
                        if ($datos_calculos_malla[1] == 0) {
                            $acumula_no_iniciados++;
                        }
                        if ($datos_calculos_malla[1] > 0 and $datos_calculos_malla[1] < 100) {
                            $acumula_en_proceso++;
                        }
                        if ($excel == 1) {
                            echo($rows);
                        }
                    }
                }
                if ($excel == 1) {
                    exit;
                }
                //echo "$i $acumula_finalizados $acumula_en_proceso $acumula_no_iniciados $acumula_ingresos";
                $acumula_ingresos = $acumula_en_proceso + $acumula_finalizados;
                $PRINCIPAL = str_replace("{LISTADO_USUARIOS}", $rows, $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS}", $i, $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_TOTAL}", number_format($acumulador_porcentajes_avance_malla / $i, 0, ",", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_ACCESOS}", $acumulador_visitas, $PRINCIPAL);
                //Bloque Total de Porcentaje Total
                //$PRINCIPAL = str_replace("{GRAFICO_PORCENTAJE_TOTAL}",file_get_contents("views/graficos/grafico_circulo.html"),$PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE}", number_format(100 * $acumula_finalizados / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_FINALIZADOS}", number_format($acumula_finalizados, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_FINALIZADOS}", number_format(100 * $acumula_finalizados / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_PROCESO}", number_format($acumula_en_proceso, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_PROCESO}", number_format(100 * $acumula_en_proceso / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_NOINICIADO}", number_format($acumula_no_iniciados, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_NOINICIADO}", number_format(100 * $acumula_no_iniciados / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_INGRESADOS}", number_format($acumula_ingresos, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_INGRESADOS}", number_format(100 * $acumula_ingresos / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{TEXTO}", "Avance", $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOMBRE_GRAFICO}", "Avance", $PRINCIPAL);
                //Bloque Total de ACESOS
                //$PRINCIPAL = str_replace("{GRAFICO_CANTIDAD_ACCESOS}",file_get_contents("views/graficos/grafico_circulo.html"),$PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE}", number_format(100 * $acumula_finalizados / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{TEXTO}", "Accesos", $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOMBRE_GRAFICO}", "Accesos", $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function DNCListadoSolicitudesDetalle($PRINCIPAL, $id_empresa, $excel)
            {
                //Traigo el total de empresas que existen en el sistema
                $Campos = TraeCampos($id_empresa);
                $Campos1 = $Campos[0]->campo1;
                $Campos2 = $Campos[0]->campo2;
                $Campos3 = $Campos[0]->campo3;
                $total_html = "";
                $i = 1;
                $pi = 0;
                // echo "holq";
                $sugerencias = TraeUsuariosDncSolicitudesTodos($id_empresa);
                $ACampo1 = array();
                $ACampo2 = array();
                $ACampo3 = array();
                if ($excel == 1) {
                    $row_html = file_get_contents("views/dnc_solicitudes/" . $id_empresa . "_row_personas_excel.html");
                } else {
                    $row_html = file_get_contents("views/dnc_solicitudes/" . $id_empresa . "_row_personas.html");
                }
                foreach ($sugerencias as $sugerencia) {
                    $row = $row_html;
                    $row = str_replace("{GERENCIA}", $sugerencia->gerencia, $row);
                    $row = str_replace("{AREA}", $sugerencia->area, $row);
                    $row = str_replace("{RUT}", $sugerencia->rut_jefe, $row);
                    $row = str_replace("{LIDER}", $sugerencia->nombre_lider, $row);
                    $row = str_replace("{TEMATICA}", $sugerencia->tematica_texto, $row);
                    $row = str_replace("{PRIORIDAD}", $sugerencia->priorizar_tematica, $row);
                    $row = str_replace("{CONTENIDO1}", $sugerencia->contenido1, $row);
                    $row = str_replace("{CONTENIDO2}", $sugerencia->contenido2, $row);
                    $row = str_replace("{CONTENIDO3}", $sugerencia->contenido3, $row);
                    $row = str_replace("{CONTENIDO4}", $sugerencia->contenido4, $row);
                    $row = str_replace("{CONTENIDO5}", $sugerencia->contenido5, $row);
                    $row = str_replace("{RESULTADOS}", $sugerencia->descripcion_accion, $row);
                    $row = str_replace("{PARTICIPANTES}", $sugerencia->numparticipantes, $row);
                    //echo "<br>$sugerencia->tematica_texto";
                    $part_rut = "";
                    $part_nombre = "";
                    $part_prioridad = "";
                    $detalle_participantes = "";
                    $sugerenciasParticipantes = TraeUsuariosDncSolicitudesTodoParticipantes($sugerencia->id, $id_empresa, $sugerencia->rut_jefe);
                    foreach ($sugerenciasParticipantes as $sugerenciasParticipante) {
                        //echo "<br>...PART ";
                        $part_rut = $sugerenciasParticipante->rut;
                        $part_nombre = $sugerenciasParticipante->nombre;
                        $part_prioridad = $sugerenciasParticipante->prioridad;
                        $detalle_participantes .= "<td>$part_rut</td><td>$part_nombre</td><td>$part_prioridad</td>";
                        //o "<br>$part_rut</td><td>$part_nombre</td><td>$part_prioridad";
                    }
                    $row = str_replace("{DETALLE_PARTICIPANTES}", $detalle_participantes, $row);
                    $total_html .= $row;
                    $pi++;
                }
                //NOMBRE CAMPO TABLA
                $PRINCIPAL = str_replace("{CAMPO1}", $Campos1, $PRINCIPAL);
                $PRINCIPAL = str_replace("{CAMPO2}", $Campos2, $PRINCIPAL);
                $PRINCIPAL = str_replace("{CAMPO3}", $Campos3, $PRINCIPAL);
                //OPCIONS DE SELECT
                $PRINCIPAL = str_replace("{CAMPO1OP}", utf8_encode($OPCION1), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CAMPO2OP}", utf8_encode($OPCION2), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CAMPO3OP}", utf8_encode($OPCION3), $PRINCIPAL);
                //NOMBRE FORMATEADO
                $PRINCIPAL = str_replace("{NCAMPO1}", str_replace("_", " ", ucwords($Campos1)), $PRINCIPAL);
                $PRINCIPAL = str_replace("{NCAMPO2}", str_replace("_", " ", ucwords($Campos2)), $PRINCIPAL);
                $PRINCIPAL = str_replace("{NCAMPO3}", str_replace("_", " ", ucwords($Campos3)), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ROW_LISTADO_USUARIOS}", utf8_encode($total_html), $PRINCIPAL);
                return ($PRINCIPAL);
                exit;
                //Traigo el total de empresas que existen en el sistema
                //Con la variable tipo usuario, veo si es para el listado de usuarios, o para el listado de envio de correos.
                if ($arreglo_post["n_registros"]) {
                    $usuarios_por_pagina = $arreglo_post["n_registros"];
                } else {
                    $usuarios_por_pagina = 20;
                }
                if (!$pagina) {
                    $pagina = 1;
                }
                if ($tipo_listado == "correos") {
                    $entorno_para_paginacion = "listusuco";
                } else {
                    $entorno_para_paginacion = "listusu";
                }
                //$usuarios=TotalUsuarios($arreglo_post, $_SESSION["id_empresa"], $pagina, $usuarios_por_pagina);
                //$usuarios=SelectParaPaginacionUsuario("tbl_usuario", $_SESSION["id_empresa"], $usuarios_por_pagina);
                $PRINCIPAL = str_replace("{FILTROS_SUPERIORES}", file_get_contents("views/filtros/barra_superior_usuarios.html"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ENVIRONMENT}", $entorno_para_paginacion, $PRINCIPAL);
                $usuarios = DatosParaListadoPaginado("tbl_usuario", $_SESSION["id_empresa"], $usuarios_por_pagina, $pagina, $arreglo_post);
                $PRINCIPAL = str_replace("{PAGINACION}", ArmaPaginacionGenerico($pagina, $entorno_para_paginacion, "tbl_usuario", $usuarios_por_pagina, $arreglo_post, $_SESSION["id_empresa"]), $PRINCIPAL);
                $total_empresas = "";
                if ($tipo_listado == "correos") {
                    $html_row = file_get_contents("views/basepersonas/row_personas_envio_correos.html");
                } else if ($tipo_listado == "usuarios") {
                    if ($_SESSION["id_empresa"] == 28) {
                        $html_row = file_get_contents("views/basepersonas/row_personas_chilquinta.html");
                    } else {
                        $html_row = file_get_contents("views/basepersonas/row_personas.html");
                    }
                }
                $i = 1;
                foreach ($usuarios as $unico) {
                    $row = $html_row;
                    if ($pagina == 1) {
                        $row = str_replace("{N}", $i, $row);
                    } else {
                        $row = str_replace("{N}", $i + (($pagina - 1) * $usuarios_por_pagina), $row);
                    }
                    $i++;
                    /*$vecesenviadoemail=vecesenviado($unico->rut, $proceso, $empresa);
            foreach($vecesenviadoemail as $vecesenviadoemailunico){
                    $row = str_replace("{VECESENVIADO}",$vecesenviadoemailunico->cuenta,$row);
                }
        $datos_si_Es_jefe=count(ColaboradoresDadoJefe($unico->rut));
        */
                    $row = str_replace("{LIDER}", $datos_si_Es_jefe, $row);
                    $row = str_replace("{NOMBRE_USUARIO}", $unico->nombre . " " . $unico->apaterno . " " . $unico->amaterno, $row);
                    $row = str_replace("{APATERNO}", $unico->apaterno, $row);
                    $row = str_replace("{AMATERNO}", $unico->amaterno, $row);
                    $row = str_replace("{NOMBRE}", $unico->nombre, $row);
                    $row = str_replace("{NOMBRE_COMPLETO}", $unico->nombre_completo, $row);
                    $row = str_replace("{CLAVE}", $unico->clave, $row);
                    if ($unico->cambiado == "0") {
                        $cambio = "(Sin cambios)";
                    } else {
                        $cambio = "(Actualizada)";
                    }
                    $row = str_replace("{CAMBIO}", $cambio, $row);
                    $row = str_replace("{RUT}", $unico->rut_completo, $row);
                    $row = str_replace("{RUT_ENCODEADO}", Encodear3($unico->rut), $row);
                    $row = str_replace("{GERENCIA}", $unico->gerencia, $row);
                    $row = str_replace("{CENTROCOSTO}", $unico->centro_costo, $row);
                    $row = str_replace("{CARGO}", $unico->cargo, $row);
                    $row = str_replace("{EMPRESA_HOLDING}", $unico->nombre_empresa_holding_, $row);
                    $row = str_replace("{EMAIL}", $unico->email, $row);
                    $row = str_replace("{PERFIL}", $unico->perfil_evaluacion, $row);
                    $row = str_replace("{TRAMO}", $unico->tramo_sence . "%", $row);
                    //$row = str_replace("{PERFIL_EVALUACION}",OptionsGenericoNombreDadoValoresPorEmpresa("tbl_sgd_perfiles_ponderaciones", $unico->perfil_evaluacion,  "descripcion", "perfil", "order by descripcion asc", $_SESSION["id_empresa"]),$row);
                    $row = str_replace("{PERFIL_EVALUACION}", $unico->perfil_evaluacion_descripcion, $row);
                    $row = str_replace("{OPTIONS_TIPOS_CORREOS}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_correos", "", "asunto", "id", "order by asunto", $_SESSION["id_empresa"]), $row);
                    $PRINCIPAL = str_replace("{OPTIONS_GERENCIAS}", OptionsGenericoPorEmpresa("gerencia", "tbl_usuario", $arreglo_post["gerencia"], $_SESSION["id_empresa"]), $PRINCIPAL);
                    $total_empresas .= $row;
                }
                $PRINCIPAL = str_replace("{ROW_LISTADO_USUARIOS}", utf8_encode($total_empresas), $PRINCIPAL);
                //$PRINCIPAL = str_replace("{PAGINACION}",ArmaPaginacionUsuarios($pagina, "listusu", "tbl_usuario"),$PRINCIPAL);
                //PAGINACION
                return ($PRINCIPAL);
            }

            function ReporteInscripcionCursos($PRINCIPAL, $id_empresa, $arreglo_post, $criterio, $excel)
            {
//echo "$id_empresa, $arreglo_post, $criterio, $excel";
                /*ROD reporte general*/
                $mallas = TraeMallasEmpresa($id_empresa);
                foreach ($mallas as $malla) {
                    if ($arreglo_post["malla"] == $malla->id) {
                        $option_mallas .= '<option selected value="' . $malla->id . '">' . $malla->nombre . '</option>';
                    } else {
                        $option_mallas .= '<option value="' . $malla->id . '">' . $malla->nombre . '</option>';
                    }
                }
                if (!$arreglo_post["malla"]) {
                    $cursos = TraeCursos_con_InscripcionMod5("-1", $id_empresa);
                } else {
                    $cursos = TraeCursos_con_InscripcionMod5($arreglo_post["malla"], $id_empresa);
                }
                $option_cursos = "";
                foreach ($cursos as $curso) {
                    if ($arreglo_post["curso"] == $curso->id) {
                        $option_cursos .= '<option value="' . $curso->id . '" selected>' . $curso->nombre . '</option>';
                    } else {
                        $option_cursos .= '<option value="' . $curso->id . '">' . '(' . $curso->id . ') ' . $curso->nombre . '</option>';
                    }
                }
                $ejecutivos = TraeEjecutivosCursoEmpresa($id_empresa);
                foreach ($ejecutivos as $ejecutivo) {
                    if ($arreglo_post["ejecutivo"] == $ejecutivo->nombre) {
                        $option_ejecutivos .= '<option selected value="' . $ejecutivo->nombre . '">' . $ejecutivo->nombre . '</option>';
                    } else {
                        $option_ejecutivos .= '<option value="' . $ejecutivo->nombre . '">' . $ejecutivo->nombre . '</option>';
                    }
                }
                $PRINCIPAL = str_replace("{MALLAS}", utf8_encode($option_mallas), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CURSOS}", utf8_encode($option_cursos), $PRINCIPAL);
                $PRINCIPAL = str_replace("{EJECUTIVOS}", utf8_encode($option_ejecutivos), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_EMPRSA}", $id_empresa, $PRINCIPAL);
                //Traigo el listado de usuarios
                $i = 0;
                $acumulador_porcentajes_avance_malla = 0;
                $acumulador_visitas = 0;
                if (count($arreglo_post) > 0) {
                    if ($criterio) {
                        $PRINCIPAL = str_replace("{CRITERIO}", $criterio, $PRINCIPAL);
                        $valores_por_criterio = TraigoValoresDadoCampoPorEmpreas($criterio, $id_empresa);
                        foreach ($valores_por_criterio as $valores) {
                            $i++;
                            $usuarios = UsuariosPorEmpresaCapacitacion($id_empresa, $arreglo_post, $criterio, utf8_encode($valores->valor));
                            if (count($usuarios) == 0) {
                                continue;
                            }
                            $rows .= file_get_contents("views/reportes/enc_satisfaccion/row_avance_capacitacion_por_criterio.html");
                            $arreglo_objetos = Lms_Busca_Objetos_Enc_sat($arreglo_post, $id_empresa);
                            $rows = Lms_reporte_MuestraInformeEnc($rows, $id_empresa, $arreglo_objetos, $criterio, $valores->valor);
                            $rows = str_replace("{NUM}", $i, $rows);
                            $rows = str_replace("{NOMBRE}", utf8_encode($valores->valor), $rows);
                            $rows = str_replace("{NUM_USUARIOS}", count($usuarios), $rows);
                            $acumulador_visitas = 0;
                            $acumulador_porcentajes_avance_malla = 0;
                            $acumulador_puntos = 0;
                            $acumulador_medallas = 0;
                            $acumulador_resultados = 0;
                            $contador_usuarios_con_resultados = 0;
                            //$rows = str_replace("{NUMERO_ACCESOS}",$acumulador_visitas,$rows);
                            $rows = str_replace("{NUMERO_ACCESOS}", ColocarColoresConPorcentajeProgressBar(number_format(($acumulador_visitas * 100) / count($usuarios), 0, ",", ".")), $rows);
                            $rows = str_replace("{NUMERO_AVANCE}", ColocarColoresConPorcentajeProgressBar(number_format($acumulador_porcentajes_avance_malla / count($usuarios), 0, ",", ".")), $rows);
                            $rows = str_replace("{PUNTOS}", round($acumulador_puntos / count($usuarios)), $rows);
                            $rows = str_replace("{MEDALLAS}", round($acumulador_medallas / count($usuarios)), $rows);
                            //per capita
                            if ($arreglo_post["malla"] <> '0' && $arreglo_post["curso"] <> '0') {
                                $rows = str_replace("{RESULTADO}", round(number_format($acumulador_resultados / $contador_usuarios_con_resultados, 2, ",", ".")), $rows);
                            } else if ($arreglo_post["malla"] <> '0' && $arreglo_post["curso"] == '0') {
                                $rows = str_replace("{RESULTADO}", round(number_format($acumulador_resultados / $contador_usuarios_con_resultados, 2, ",", ".")), $rows);
                            } else {
                                $rows = str_replace("{RESULTADO}", "-", $rows);
                            }
                        }
                    } else {
                        //echo "3";
                        $usuarios = UsuariosPorEmpresaCapacitacion($id_empresa, $arreglo_post);
                        $arreglo_objetos = Lms_Busca_Objetos_Enc_sat($arreglo_post, $id_empresa);
                        //echo "3";
                        //print_r($arreglo_post);
                        //print_r($arreglo_encuestas);
                        $datos_calculos_malla = Lms_reporte_MuestraInformeEnc($PRINCIPAL, $id_empresa, $arreglo_objetos, "", "");
                        if ($excel == 1) {
                            $PRINCIPAL = Lms_reporte_MuestraInformeEncParticipantesInscripcionExcel($PRINCIPAL, $id_empresa, $arreglo_objetos, $arreglo_post, "");
                        }
                        $PRINCIPAL = Lms_reporte_MuestraListaCursosInscripcionEnc($PRINCIPAL, $id_empresa, $arreglo_post, "", "");
                        $PRINCIPAL = Lms_reporte_MuestraInformeEncParticipantesInscripcion($PRINCIPAL, $id_empresa, $arreglo_objetos, $arreglo_post, "");
                    }
                }
                //echo "$i $acumula_finalizados $acumula_en_proceso $acumula_no_iniciados $acumula_ingresos";
                $acumula_ingresos = $acumula_en_proceso + $acumula_finalizados;
                $PRINCIPAL = str_replace("{LISTADO_USUARIOS}", $rows, $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS}", $i, $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_TOTAL}", number_format($acumulador_porcentajes_avance_malla / $i, 0, ",", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_ACCESOS}", $acumulador_visitas, $PRINCIPAL);
                //Bloque Total de Porcentaje Total
                //$PRINCIPAL = str_replace("{BLOQUE_ENCUESTA_SATISFACCION}",Lms_reporte_MuestraInformeEnc($PRINCIPAL, $id_empresa, $arreglo_objetos),$PRINCIPAL);
                $PRINCIPAL = str_replace("{LISTADO_DIMENSIONES}", number_format($acumulador_porcentajes_avance_malla / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_FINALIZADOS}", number_format($acumula_finalizados, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_FINALIZADOS}", number_format(100 * $acumula_finalizados / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_PROCESO}", number_format($acumula_en_proceso, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_PROCESO}", number_format(100 * $acumula_en_proceso / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_NOINICIADO}", number_format($acumula_no_iniciados, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_NOINICIADO}", number_format(100 * $acumula_no_iniciados / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_INGRESADOS}", number_format($acumula_ingresos, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_INGRESADOS}", number_format(100 * $acumula_ingresos / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{TEXTO}", "Avance", $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOMBRE_GRAFICO}", "Avance", $PRINCIPAL);
                //Bloque Total de ACESOS
                $PRINCIPAL = str_replace("{GRAFICO_CANTIDAD_ACCESOS}", file_get_contents("views/graficos/grafico_circulo.html"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE}", number_format($acumulador_visitas * 100 / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{TEXTO}", "Accesos", $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOMBRE_GRAFICO}", "Accesos", $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function ReporteEncuestaSatisfaccion($PRINCIPAL, $id_empresa, $arreglo_post, $criterio, $excel)
            {
                /*ROD reporte general*/
                $mallas = TraeMallasEmpresa($id_empresa);
                foreach ($mallas as $malla) {
                    if ($arreglo_post["malla"] == $malla->id) {
                        $option_mallas .= '<option selected value="' . $malla->id . '">' . $malla->nombre . '</option>';
                    } else {
                        $option_mallas .= '<option value="' . $malla->id . '">' . $malla->nombre . '</option>';
                    }
                }
                if (!$arreglo_post["malla"]) {
                    $cursos = TraeCursos_con_Enc_sat("-1", $id_empresa);
                } else {
                    $cursos = TraeCursos_con_Enc_sat($arreglo_post["malla"], $id_empresa);
                }
                $option_cursos = "";
                foreach ($cursos as $curso) {
                    if ($arreglo_post["curso"] == $curso->id) {
                        $option_cursos .= '<option value="' . $curso->id . '" selected>' . $curso->nombre . ' - ' . $curso->id . '</option>';
                    } else {
                        $option_cursos .= '<option value="' . $curso->id . '">' . $curso->nombre . ' - ' . $curso->id . '</option>';
                    }
                }
                $cursos_presenciales = TraeCursos_con_Enc_sat_Presencial($id_empresa);
                foreach ($cursos_presenciales as $curso) {
                    if ($arreglo_post["curso"] == $curso->id_curso) {
                        $option_cursos .= '<option value="' . $curso->id_curso . '" selected>' . $curso->nombre_curso . ' - ' . $curso->id_curso . ' </option>';
                    } else {
                        $option_cursos .= '<option value="' . $curso->id_curso . '" >' . $curso->nombre_curso . ' - ' . $curso->id_curso . ' </option>';
                    }
                }
                $ejecutivos = TraeEjecutivosCursoEmpresa($id_empresa);
                foreach ($ejecutivos as $ejecutivo) {
                    if ($arreglo_post["ejecutivo"] == $ejecutivo->nombre) {
                        $option_ejecutivos .= '<option selected value="' . $ejecutivo->nombre . '">' . $ejecutivo->nombre . '</option>';
                    } else {
                        $option_ejecutivos .= '<option value="' . $ejecutivo->nombre . '">' . $ejecutivo->nombre . '</option>';
                    }
                }
//FOCOS Filtro
                $focos = TraeFocosPorEmpresa($id_empresa);
                $options_focos = "";
                foreach ($focos as $foc) {
                    if ($arreglo_post["foco"] == $foc->codigo_foco) {
                        $options_focos .= '<option value="' . $foc->codigo_foco . '" selected>' . $foc->descripcion . '</option>';
                    } else {
                        $options_focos .= '<option value="' . $foc->codigo_foco . '">' . $foc->descripcion . '</option>';
                    }
                }
                //PROGRAMAS BBDD Filtro
                $programasBBDD = TraeProgramasBBDDPorEmpresa($id_empresa);
                $options_programasBBDD = "";
                foreach ($programasBBDD as $progbbdd) {
                    if ($arreglo_post["programabbdd"] == $progbbdd->id_programa) {
                        $options_programasBBDD .= '<option value="' . $progbbdd->id_programa . '" selected>' . $progbbdd->nombre_programa . '</option>';
                    } else {
                        $options_programasBBDD .= '<option value="' . $progbbdd->id_programa . '">' . $progbbdd->nombre_programa . '</option>';
                    }
                }
                $c1BBDD = TraedatosDadoCampo($id_empresa, $datos_empresa[0]->campo1);
                $options_c1 = "";
                foreach ($c1BBDD as $c1) {
                    if ($arreglo_post["c1"] == $c1->valor) {
                        $options_c1 .= '<option value="' . $c1->valor . '" selected>' . $c1->valor . '</option>';
                    } else {
                        $options_c1 .= '<option value="' . $c1->valor . '">' . $c1->valor . '</option>';
                    }
                }
                $c2BBDD = TraedatosDadoCampo($id_empresa, $datos_empresa[0]->campo2);
                $options_c2 = "";
                foreach ($c2BBDD as $c2) {
                    if ($arreglo_post["c2"] == $c2->valor) {
                        $options_c2 .= '<option value="' . $c2->valor . '" selected>' . $c2->valor . '</option>';
                    } else {
                        $options_c2 .= '<option value="' . $c2->valor . '">' . $c2->valor . '</option>';
                    }
                }
                $c2BBDD = TraedatosDadoCampo($id_empresa, $datos_empresa[0]->campo3);
                $options_c3 = "";
                foreach ($c3BBDD as $c3) {
                    if ($arreglo_post["c3"] == $c3->valor) {
                        $options_c3 .= '<option value="' . $c3->valor . '" selected>' . $c3->valor . '</option>';
                    } else {
                        $options_c3 .= '<option value="' . $c3->valor . '">' . $c3->valor . '</option>';
                    }
                }
                $imparticiones = TraeImparticionEmpresa($id_empresa);
                $options_imparticiones = "";
                foreach ($imparticiones as $imp) {
                    if ($imp->codigo_inscripcion == $arreglo_post["imparticion"]) {
                        $options_imparticiones .= "<option value='" . $imp->codigo_inscripcion . "' selected>" . $imp->codigo_inscripcion . " - " . $imp->fecha_inicio . "</option>";
                    } else {
                        $options_imparticiones .= "<option value='" . $imp->codigo_inscripcion . "' >" . $imp->codigo_inscripcion . " - " . $imp->fecha_inicio . "</option>";
                    }
                }
                $PRINCIPAL = str_replace("{OPTIONS_IMPARTICIONES}", utf8_encode($options_imparticiones), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_C1}", utf8_encode($options_c1), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_C2}", utf8_encode($options_c2), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_C3}", utf8_encode($options_c3), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_PROGRAMAS_BBDD}", utf8_encode($options_programasBBDD), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_FOCOS}", utf8_encode($options_focos), $PRINCIPAL);
                $PRINCIPAL = str_replace("{MALLAS}", utf8_encode($option_mallas), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CURSOS}", utf8_encode($option_cursos), $PRINCIPAL);
                $PRINCIPAL = str_replace("{EJECUTIVOS}", utf8_encode($option_ejecutivos), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_EMPRSA}", $id_empresa, $PRINCIPAL);
                //Traigo el listado de usuarios
                $i = 0;
                $acumulador_porcentajes_avance_malla = 0;
                $acumulador_visitas = 0;
                //print_r($arreglo_post);
                if (count($arreglo_post) > 0) {
                    if ($criterio) {
                        $PRINCIPAL = str_replace("{CRITERIO}", $criterio, $PRINCIPAL);
                        $valores_por_criterio = TraigoValoresDadoCampoPorEmpreas($criterio, $id_empresa);
                        //echo "5";
                        foreach ($valores_por_criterio as $valores) {
                            $i++;
                            $usuarios = UsuariosPorEmpresaCapacitacion($id_empresa, $arreglo_post, $criterio, utf8_encode($valores->valor));
                            if (count($usuarios) == 0) {
                                continue;
                            }
                            $rows .= file_get_contents("views/reportes/enc_satisfaccion/row_avance_capacitacion_por_criterio.html");
                            $arreglo_objetos = Lms_Busca_Objetos_Enc_sat($arreglo_post, $id_empresa);
                            $rows = Lms_reporte_MuestraInformeEnc($rows, $id_empresa, $arreglo_objetos, $criterio, $valores->valor);
                            $rows = str_replace("{NUM}", $i, $rows);
                            $rows = str_replace("{NOMBRE}", utf8_encode($valores->valor), $rows);
                            $rows = str_replace("{NUM_USUARIOS}", count($usuarios), $rows);
                            $acumulador_visitas = 0;
                            $acumulador_porcentajes_avance_malla = 0;
                            $acumulador_puntos = 0;
                            $acumulador_medallas = 0;
                            $acumulador_resultados = 0;
                            $contador_usuarios_con_resultados = 0;
                            //$rows = str_replace("{NUMERO_ACCESOS}",$acumulador_visitas,$rows);
                            $rows = str_replace("{NUMERO_ACCESOS}", ColocarColoresConPorcentajeProgressBar(number_format(($acumulador_visitas * 100) / count($usuarios), 0, ",", ".")), $rows);
                            $rows = str_replace("{NUMERO_AVANCE}", ColocarColoresConPorcentajeProgressBar(number_format($acumulador_porcentajes_avance_malla / count($usuarios), 0, ",", ".")), $rows);
                            $rows = str_replace("{PUNTOS}", round($acumulador_puntos / count($usuarios)), $rows);
                            $rows = str_replace("{MEDALLAS}", round($acumulador_medallas / count($usuarios)), $rows);
                            //per capita
                            if ($arreglo_post["malla"] <> '0' && $arreglo_post["curso"] <> '0') {
                                $rows = str_replace("{RESULTADO}", round(number_format($acumulador_resultados / $contador_usuarios_con_resultados, 2, ",", ".")), $rows);
                            } else if ($arreglo_post["malla"] <> '0' && $arreglo_post["curso"] == '0') {
                                $rows = str_replace("{RESULTADO}", round(number_format($acumulador_resultados / $contador_usuarios_con_resultados, 2, ",", ".")), $rows);
                            } else {
                                $rows = str_replace("{RESULTADO}", "-", $rows);
                            }
                        }
                    } else {
                        //echo "3 excel $excel";
                        $usuarios = UsuariosPorEmpresaCapacitacion($id_empresa, $arreglo_post);
                        //$arreglo_objetos=Lms_Busca_Objetos_Enc_sat($arreglo_post, $id_empresa);
                        $arreglo_objetos = Lms_Busca_Objetos_Enc_sat_Imparticion($arreglo_post, $id_empresa);
                        //echo "3";
                        //print_r($arreglo_post);
                        //print_r($arreglo_encuestas);
                        $datos_calculos_malla = Lms_reporte_MuestraInformeEnc($PRINCIPAL, $id_empresa, $arreglo_objetos, "", "");
                        if ($excel == 1) {
                            //Rut, respuesta
                            $PRINCIPAL = Lms_reporte_MuestraInformeEncParticipantesDetalle($PRINCIPAL, $id_empresa, $arreglo_objetos, "", "", $excel);
                        } else {
                            //$PRINCIPAL=Lms_reporte_MuestraListaCursosEnc($PRINCIPAL, $id_empresa, $arreglo_post,  $excel);
                            $PRINCIPAL = Lms_reporte_MuestraListaImparticionesEnc($PRINCIPAL, $id_empresa, $arreglo_post, $excel);
                            $PRINCIPAL = Lms_reporte_MuestraInformeDimEnc($PRINCIPAL, $id_empresa, $arreglo_objetos, "", "", $excel);
                            $PRINCIPAL = Lms_reporte_MuestraInformeDimEncNota($PRINCIPAL, $id_empresa, $arreglo_objetos, "", "", $excel);
                            $PRINCIPAL = Lms_reporte_MuestraInformeEncPregunta($PRINCIPAL, $id_empresa, $arreglo_objetos, "", "", $excel);
                            $PRINCIPAL = Lms_reporte_MuestraInformeEncPreguntaNota($PRINCIPAL, $id_empresa, $arreglo_objetos, "", "", $excel);
                            $PRINCIPAL = Lms_reporte_MuestraInformeEncLiterales($PRINCIPAL, $id_empresa, $arreglo_objetos, "", "", $excel);
                            $PRINCIPAL = Lms_reporte_Opiniones_Imparticion($PRINCIPAL, $id_empresa, $arreglo_objetos, $criterio, $valor, $excel);
                            $PRINCIPAL = Lms_reporte_Fotos_Imparticion($PRINCIPAL, $id_empresa, $arreglo_objetos, $criterio, $valor, $excel);
                            $PRINCIPAL = Lms_reporte_PreguntasRelator_Imparticion($PRINCIPAL, $id_empresa, $arreglo_objetos, $criterio, $valor, $excel);
                            //$PRINCIPAL=Lms_reporte_MuestraInformeEncParticipantes($PRINCIPAL, $id_empresa, $arreglo_objetos, $arreglo_post, "", $excel);
                            $PRINCIPAL = Lms_reporte_MuestraInformeEncParticipantes($PRINCIPAL, $id_empresa, $arreglo_objetos, $arreglo_post, "", $excel);
                        }
                    }
                }
                //echo "$i $acumula_finalizados $acumula_en_proceso $acumula_no_iniciados $acumula_ingresos";
                $acumula_ingresos = $acumula_en_proceso + $acumula_finalizados;
                $PRINCIPAL = str_replace("{LISTADO_USUARIOS}", $rows, $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS}", $i, $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_TOTAL}", number_format($acumulador_porcentajes_avance_malla / $i, 0, ",", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_ACCESOS}", $acumulador_visitas, $PRINCIPAL);
                //Bloque Total de Porcentaje Total
                //$PRINCIPAL = str_replace("{BLOQUE_ENCUESTA_SATISFACCION}",Lms_reporte_MuestraInformeEnc($PRINCIPAL, $id_empresa, $arreglo_objetos),$PRINCIPAL);
                $PRINCIPAL = str_replace("{LISTADO_DIMENSIONES}", number_format($acumulador_porcentajes_avance_malla / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_FINALIZADOS}", number_format($acumula_finalizados, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_FINALIZADOS}", number_format(100 * $acumula_finalizados / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_PROCESO}", number_format($acumula_en_proceso, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_PROCESO}", number_format(100 * $acumula_en_proceso / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_NOINICIADO}", number_format($acumula_no_iniciados, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_NOINICIADO}", number_format(100 * $acumula_no_iniciados / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_INGRESADOS}", number_format($acumula_ingresos, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_INGRESADOS}", number_format(100 * $acumula_ingresos / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{TEXTO}", "Avance", $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOMBRE_GRAFICO}", "Avance", $PRINCIPAL);
                //Bloque Total de ACESOS
                $PRINCIPAL = str_replace("{GRAFICO_CANTIDAD_ACCESOS}", file_get_contents("views/graficos/grafico_circulo.html"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE}", number_format($acumulador_visitas * 100 / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{TEXTO}", "Accesos", $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOMBRE_GRAFICO}", "Accesos", $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function clima_calculadatosfinales($id_empresa, $arreglo_post, $campo, $dato, $campo2, $dato2, $campo3, $dato3, $campo4, $dato4, $campo5, $dato5, $campo6, $dato6, $campo7, $dato7)
            {
//echo "<br>clima_calculadatosfinales $campo, $dato, campo2 $campo2, dato2 $dato2, campo3 $campo3, dato3 $dato3, campo4 $campo4, dato4 $dato4, campo5 $campo5, dato5 $dato5, campo6 $campo6, dato6 $dato6, campo7 $campo7, dato7 $dato7";
                $arreglo_usuarios = clima_total_usuarios_completos($id_empresa, $arreglo_post, $campo, $dato, $campo2, $dato2, $campo3, $dato3, $campo4, $dato4, $campo5, $dato5, $campo6, $dato6, $campo7, $dato7);
                $cuentausuario = 0;
                foreach ($arreglo_usuarios as $arreglo_usuario) {
                    if ($arreglo_usuario->cuenta >= 60) {
                        $cuentausuariocompleto++;
                    }
                    $cuentausuario++;
                    //echo     $cuentausuario;
                }
                //busca polo positivo y negativo
                $arreglo_resultados = clima_calculadatosfinales_data($id_empresa, $arreglo_post, $campo, $dato, $campo2, $dato2, $campo3, $dato3, $campo4, $dato4, $campo5, $dato5, $campo6, $dato6, $campo7, $dato7);
                //print_r($arreglo_resultados);
                foreach ($arreglo_resultados as $arreglo_resultado) {
                    if ($arreglo_resultado->total >= 60) {
                        $positivo = $arreglo_resultado->positivo + $positivo;
                        $neutro = $arreglo_resultado->neutro + $neutro;
                        $negativo = $arreglo_resultado->negativo + $negativo;
                    }
                }
                //echo "<br>$cuentausuario,$cuentausuariocompleto,$positivo,$neutro,$negativo,$positivo2,$neutro2,$negativo2";
                $res_usuario = array($cuentausuario, $cuentausuariocompleto, $positivo, $neutro, $negativo);
                return $res_usuario;
            }

            function clima_calculadatosfinales_dim($id_empresa, $campo, $dato, $tipodim)
            {
//echo "<br>clima_calculadatosfinales $campo, $dato, campo2 $campo2, dato2 $dato2, campo3 $campo3, dato3 $dato3, campo4 $campo4, dato4 $dato4, campo5 $campo5, dato5 $dato5, campo6 $campo6, dato6 $dato6, campo7 $campo7, dato7 $dato7";
                $arreglo_usuarios = clima_total_usuarios_completos($id_empresa, $arreglo_post, $campo, $dato, $campo2, $dato2, $campo3, $dato3, $campo4, $dato4, $campo5, $dato5, $campo6, $dato6, $campo7, $dato7);
                $cuentausuario = 0;
                foreach ($arreglo_usuarios as $arreglo_usuario) {
                    if ($arreglo_usuario->cuenta >= 60) {
                        $cuentausuariocompleto++;
                    }
                    $cuentausuario++;
                }
                //busca polo positivo y negativo
                $arreglo_resultados = clima_calculadatosfinales_data_dim($id_empresa, $campo, $dato, $tipodim);
                //print_r($arreglo_resultados);
                foreach ($arreglo_resultados as $arreglo_resultado) {
                    if ($arreglo_resultado->total >= 60) {
                        $positivo = $arreglo_resultado->positivo + $positivo;
                        $neutro = $arreglo_resultado->neutro + $neutro;
                        $negativo = $arreglo_resultado->negativo + $negativo;
                    }
                }
                //echo "<br>$cuentausuario,$cuentausuariocompleto,$positivo,$neutro,$negativo,$positivo2,$neutro2,$negativo2";
                $res_usuario = array($cuentausuario, $cuentausuariocompleto, $positivo, $neutro, $negativo);
                return $res_usuario;
            }

            function ReporteClima($PRINCIPAL, $id_empresa, $arreglo_post, $criterio, $excel)
            {
                $PRINCIPAL = str_replace("{ID_EMPRSA}", $id_empresa, $PRINCIPAL);
                $campos_generales = TraeClimaCamposGenerales($id_empresa);
                foreach ($campos_generales as $campo_general) {
                    if ($arreglo_post["clima_campo_general"] == $campo_general->campo) {
                        $option_campos_generales .= '<option selected value="' . $campo_general->campo . '">' . $campo_general->nombre_campo . '</option>';
                    } else {
                        $option_campos_generales .= '<option value="' . $campo_general->campo . '">' . $campo_general->nombre_campo . '</option>';
                    }
                }
                $indicadores_generales = TraeClimaIndicadoresGenerales($id_empresa);
                foreach ($indicadores_generales as $indicador_general) {
                    if ($arreglo_post["clima_indicador_general"] == $indicador_general->id_indicador) {
                        $option_indicadores_generales .= '<option selected value="' . $indicador_general->id_indicador . '">' . $indicador_general->indicador . '</option>';
                    } else {
                        $option_indicadores_generales .= '<option value="' . $indicador_general->id_indicador . '">' . $indicador_general->indicador . '</option>';
                    }
                }
                $PRINCIPAL = str_replace("{OPTIONS_CAMPOS_AGRUPADOS_CLIMA}", utf8_encode($option_campos_generales), $PRINCIPAL);
                $PRINCIPAL = str_replace("{OPTIONS_INDICADORES_AGRUPADOS_CLIMA}", utf8_encode($option_indicadores_generales), $PRINCIPAL);
                $clima_campo_general = $arreglo_post["clima_campo_general"];
                $clima_indicador_general = $arreglo_post["clima_indicador_general"];
//echo "<br><br><br>clima_campo_general $clima_campo_general";
                $campo = $arreglo_post["filtro"];
                $campodatoespecifico = $arreglo_post["filtro2"];
                $campodatoespecifico3 = $arreglo_post["filtro3"];
// version dashboard
                if ($clima_campo_general <> '') {
                    $ArrayCampoGeneral = BuscaDataCampoGeneral($clima_campo_general, $clima_indicador_general, $id_empresa);
                    //print_r($ArrayCampoGeneral);
                    $ik = 1;
                    $arreglo_neto[$ik]["dato"] = $ArrayCampoGeneral[0]->nombre_campo;
                    $arreglo_neto[$ik]["neto"] = $ArrayCampoGeneral[0]->neutro;
                    $arreglo_neto[$ik]["positivo"] = $ArrayCampoGeneral[0]->positivo - $ArrayCampoGeneral[0]->neutro;
                    $arreglo_neto[$ik]["positivoreal"] = $ArrayCampoGeneral[0]->positivo;
                    $arreglo_neto[$ik]["negativo"] = (-1) * $ArrayCampoGeneral[0]->negativo;
                    $arreglo_neto[$ik]["total_usuario_completos"] = "";
                    $arreglo_neto = subval_sort($arreglo_neto, 'neto');
                    $arreglo_datos_grafico = "";
                    for ($j = 1; $j <= $ik; $j++) {
                        $arreglo_datos_grafico .= "['" . utf8_encode($arreglo_neto[$j - 1]["dato"]) . "', " . $arreglo_neto[$j - 1]["neto"] . "]";
                        if ($j < $ik) {
                            $arreglo_datos_grafico .= ", ";
                        }
                    }
                    for ($j = 1; $j <= $ik; $j++) {
                        $arreglo_datos_grafico_CAMPOS .= "'" . utf8_encode($arreglo_neto[$j - 1]["dato"]) . "'";
                        $arreglo_datos_grafico_NETO .= "" . utf8_encode($arreglo_neto[$j - 1]["neto"]) . "";
                        $arreglo_datos_grafico_POS .= "" . utf8_encode($arreglo_neto[$j - 1]["positivo"]) . "";
                        $arreglo_datos_grafico_NEG .= "" . utf8_encode($arreglo_neto[$j - 1]["negativo"]) . "";
                        if ($j < $ik) {
                        }
                        $arreglo_row_tabla .= "<tr><td>" . utf8_encode($arreglo_neto[$j - 1]['dato']) . "</td>
        <td>" . $arreglo_neto[$j - 1]['positivoreal'] . "</td>
        <td>" . $arreglo_neto[$j - 1]['negativo'] . "</td>
        <td>" . $arreglo_neto[$j - 1]['neto'] . "</td></tr>";
                    }
                    $campo_texto = "Clima $campos_generales";
                    $altodato = $ik * 250;
                    $alto = $altodato . "px";
                    $ArrayCampoDimensiones = BuscaDataCampoPorDimension($clima_campo_general, $clima_indicador_general, $id_empresa);
                    foreach ($ArrayCampoDimensiones as $ArrayCampoDimension) {
                        $nombre_dim = utf8_encode($ArrayCampoDimension->indicador);
                        $neutro = $ArrayCampoDimension->neutro;
                        $positivo = $ArrayCampoDimension->positivo;
                        $negativo = $ArrayCampoDimension->negativo;
                        $arreglo_dim_nombre .= "'" . $nombre_dim . "',";
                        $arreglo_dim_neutro .= $neutro . ",";
                        $arreglo_dim_positivo .= $positivo . ",";
                        $arreglo_dim_negativo .= "-" . $negativo . ",";
                    }
                }
                $campo = $ArrayCampoDimension->nombre_campo;
                $PRINCIPAL = str_replace("{BLOQUE_GRAFICO_GENERAL}", file_get_contents("views/reportes/clima/" . $id_empresa . "_grafico_clima_general_columna.html"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ARREGLO_DATOS}", $arreglo_datos_grafico, $PRINCIPAL);
                $PRINCIPAL = str_replace("{ARREGLO_DATOS_CAMPOS}", $arreglo_datos_grafico_CAMPOS, $PRINCIPAL);
                $PRINCIPAL = str_replace("{ARREGLO_DATOS_NETO}", $arreglo_datos_grafico_NETO, $PRINCIPAL);
                $PRINCIPAL = str_replace("{ARREGLO_DATOS_POS}", $arreglo_datos_grafico_POS, $PRINCIPAL);
                $PRINCIPAL = str_replace("{ARREGLO_DATOS_NEG}", $arreglo_datos_grafico_NEG, $PRINCIPAL);
                $PRINCIPAL = str_replace("{ROWSDATOSTABLA}", $arreglo_row_tabla, $PRINCIPAL);
                $PRINCIPAL = str_replace("{FILTRO}", $campo, $PRINCIPAL);
                $PRINCIPAL = str_replace("{BLOQUE_GRAFICO_DIMENSIONES}", file_get_contents("views/reportes/clima/" . $id_empresa . "_grafico_clima_dimension.html"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{DIMENSION_NOMBRE}", $arreglo_dim_nombre, $PRINCIPAL);
                $PRINCIPAL = str_replace("{DIMENSION_POSITIVO}", $arreglo_dim_positivo, $PRINCIPAL);
                $PRINCIPAL = str_replace("{DIMENSION_NEGATIVO}", $arreglo_dim_negativo, $PRINCIPAL);
                $PRINCIPAL = str_replace("{DIMENSION_NEUTRO}", $arreglo_dim_neutro, $PRINCIPAL);
                $PRINCIPAL = str_replace("{FILTRO_DIMENSION}", $campo, $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function subval_sort($a, $subkey)
            {
                foreach ($a as $k => $v) {
                    $b[$k] = strtolower($v[$subkey]);
                }
                arsort($b);
                foreach ($b as $key => $val) {
                    $c[] = $a[$key];
                }
                return $c;
            }

            function ReporteClimaDim($PRINCIPAL, $id_empresa, $arreglo_post, $campo, $dato, $tipodim, $excel)
            {
                //echo "$campo, $dato, $tipodim";
                $PRINCIPAL = str_replace("{ID_EMPRSA}", $id_empresa, $PRINCIPAL);
                $ik = 0;
                $arreglo_usuarios_finales = clima_filtrorut_data_dim($id_empresa, $campo, $dato);
                //echo count($arreglo_usuarios_finales);
                //echo "<pre>";
                //print_r($arreglo_usuarios_finales);
                if ($tipodim == "driver") {
                    $filtrodim = "driver";
                    $arreglodimensiones = array("Personas", "Organizacion", "Job / Tarea", "Trabajo");
                }
                if ($tipodim == "dimension") {
                    $filtrodim = "dimension";
                    $arreglodimensiones = array("Balance vida y trabajo", "Beneficios", "Comunicacion", "Condiciones de trabajo", "Desarrollo", "Equipo de trabajo",
                        "Jefatura / Liderazgo", "Objetivos", "Organizacion", "Orgullo", "Valores");
                }
                if ($tipodim == "felicidad") {
                    $filtrodim = "felicidad";
                    //$arreglodimensiones=array("Ambiente agradable","Aprendizaje","Buena organizacion para trabajar","Confianza","Equilibrio vida trabajo","Equipos bien dirigidos"
                    //,"Felicidad","Influencia en toma de decisiones","Libertad para ser uno mismo","Organizacion abierta","Organizacion bien gestionada","Pago justo"
                    //,"Percepcion de avance de Carrera","Relacion con el jefe","Relaciones de apoyo","Relaciones de equipo","Retroalimentacion Constructiva"
                    //,"Seguridad y Salud en el trabajo","Tiene la confianza del jefe","Uso de fortalezas");
                    $arreglodimensiones = array("Felicidad");
                }
                if ($tipodim == "seguridad") {
                    $filtrodim = "felicidad";
                    //$arreglodimensiones=array("Ambiente agradable","Aprendizaje","Buena organizacion para trabajar","Confianza","Equilibrio vida trabajo","Equipos bien dirigidos"
                    //,"Felicidad","Influencia en toma de decisiones","Libertad para ser uno mismo","Organizacion abierta","Organizacion bien gestionada","Pago justo"
                    //,"Percepcion de avance de Carrera","Relacion con el jefe","Relaciones de apoyo","Relaciones de equipo","Retroalimentacion Constructiva"
                    //,"Seguridad y Salud en el trabajo","Tiene la confianza del jefe","Uso de fortalezas");
                    $arreglodimensiones = array("Seguridad");
                }
                if ($tipodim == "comunicaciones") {
                    $filtrodim = "idpregunta";
                    $arreglodimensiones = array("18", "33", "48", "4", "19");
                }
                if ($tipodim == "medioambiente") {
                    $filtrodim = "idpregunta";
                    $arreglodimensiones = array("15");
                }
                $total_positivo = 0;
                $total_negativo = 0;
                $total_neutro = 0;
                $cuentausuarioscompletos = 0;
                for ($i = 0; $i < count($arreglodimensiones); $i++) {
                    $total_positivo = 0;
                    $total_negativo = 0;
                    $total_neutro = 0;
                    $cuentausuarioscompletos = 0;
                    foreach ($arreglo_usuarios_finales as $arreglo_usuario_final) {
                        //echo "<br>RUT".$arreglo_usuario_final->rut;
                        $arreglo_datos_finales = clima_calculadatosfinales_data_dim($id_empresa, $campo, $dato, $arreglo_usuario_final->rut, $filtrodim, $arreglodimensiones[$i]);
                        $total_positivo = $arreglo_datos_finales[0]->positivo + $total_positivo;
                        $total_negativo = $arreglo_datos_finales[0]->negativo + $total_negativo;
                        $total_neutro = $arreglo_datos_finales[0]->neutro + $total_neutro;
                        $cuentausuarioscompletos++;
                    }
                    $total_respuestas = $total_positivo + $total_neutro + $total_negativo;
                    if ($total_respuestas > 0) {
                        $positivo_porcentaje = round(100 * $total_positivo / $total_respuestas);
                        if ($positivo_porcentaje > 0 and $positivo_porcentaje < 100) {
                            $positivo_porcentaje = round(100 * $total_positivo / $total_respuestas, 1) + 0.7;
                        } else {
                            $positivo_porcentaje = round(100 * $total_positivo / $total_respuestas, 1);
                        }
                        $negativo_porcentaje = round(100 * $total_negativo / $total_respuestas, 1);
                        $negativo_porcentajetxt = -$negativo_porcentaje;
                    }
                    $neto = $positivo_porcentaje - $negativo_porcentaje;
                    $positivo_porcentajetxt = $positivo_porcentaje - $neto;
                    $total_respuestas_dimension[$i]["dimension"] = $arreglodimensiones[$i];
                    $total_respuestas_dimension[$i]["total_positivo"] = $positivo_porcentajetxt;
                    $total_respuestas_dimension[$i]["total_negativo"] = $negativo_porcentajetxt;
                    $total_respuestas_dimension[$i]["total_neutro"] = $total_neutro;
                    $total_respuestas_dimension[$i]["total_neto"] = $neto;
                    $total_respuestas_dimension[$i]["positivoreal"] = $positivo_porcentaje;
                    $total_respuestas_dimension[$i]["total_usuario_completos"] = $cuentausuarioscompletos;
                    //echo "<br>i $i".$arreglodimensiones[$i]." , positivo $total_positivo, negativo $total_negativo, neutro $total_neutro";
                }
                //print_r($total_respuestas_dimension);
                $total_respuestas_dimension = subval_sort($total_respuestas_dimension, 'total_neto');
                for ($j = 1; $j <= $i; $j++) {
                    $arreglo_datos_grafico_CAMPOS .= "'" . utf8_encode($total_respuestas_dimension[$j - 1]["dimension"]) . "'";
                    $arreglo_datos_grafico_NETO .= "" . utf8_encode($total_respuestas_dimension[$j - 1]["total_neto"]) . "";
                    $arreglo_datos_grafico_POS .= "" . utf8_encode($total_respuestas_dimension[$j - 1]["total_positivo"]) . "";
                    $arreglo_datos_grafico_NEG .= "" . utf8_encode($total_respuestas_dimension[$j - 1]["total_negativo"]) . "";
                    if ($j < $i) {
                        $arreglo_datos_grafico_CAMPOS .= ", ";
                        $arreglo_datos_grafico_NETO .= ", ";
                        $arreglo_datos_grafico_POS .= ", ";
                        $arreglo_datos_grafico_NEG .= ", ";
                    }
                    $arreglo_row_tabla .= "<tr><td>" . utf8_encode($total_respuestas_dimension[$j - 1]['dimension']) . "</td>
        <td>" . $total_respuestas_dimension[$j - 1]['positivoreal'] . "</td>
        <td>" . $total_respuestas_dimension[$j - 1]['total_negativo'] . "</td>
        <td>" . $total_respuestas_dimension[$j - 1]['total_neto'] . "</td></tr>";
                }
                $arreglo_datos_grafico = "";
                if ($i <= 3) {
                    $altodato = $ik * 250;
                    $alto = $altodato . "px";
                }
                if ($ik > 3) {
                    $altodato = $ik * 150;
                    $alto = $altodato . "px";
                }
                $PRINCIPAL = str_replace("{BLOQUE_GRAFICO_GENERAL}", file_get_contents("views/reportes/clima/grafico_clima_general.html"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ARREGLO_DATOS}", $arreglo_datos_grafico, $PRINCIPAL);
                $PRINCIPAL = str_replace("{ROWSDATOSTABLA}", $arreglo_row_tabla, $PRINCIPAL);
                $PRINCIPAL = str_replace("{ARREGLO_DATOS_CAMPOS}", $arreglo_datos_grafico_CAMPOS, $PRINCIPAL);
                $PRINCIPAL = str_replace("{ARREGLO_DATOS_NETO}", $arreglo_datos_grafico_NETO, $PRINCIPAL);
                $PRINCIPAL = str_replace("{ARREGLO_DATOS_POS}", $arreglo_datos_grafico_POS, $PRINCIPAL);
                $PRINCIPAL = str_replace("{ARREGLO_DATOS_NEG}", $arreglo_datos_grafico_NEG, $PRINCIPAL);
                $PRINCIPAL = str_replace("{ENE}", $cuentausuarioscompletos, $PRINCIPAL);
                if ($campo == "nombre_empresa_holding") {
                    $campotext1 = "Division";
                }
                if ($campo == "servicio") {
                    $campotext1 = "Empresa";
                }
                if ($campo == "gerencia") {
                    $campotext1 = "Gerencia";
                }
                if ($campo == "subgerencia") {
                    $campotext1 = "Subgerencia";
                }
                if ($campo == "area") {
                    $campotext1 = "Area";
                }
                if ($campo == "cargo") {
                    $campotext1 = "Cargo";
                }
                if ($campo == "antiguedad") {
                    $campotext1 = "Antiguedad";
                }
                if ($campo == "genero") {
                    $campotext1 = "Genero";
                }
                if ($campo == "comunidad") {
                    $campotext1 = "Lugar de Pago";
                }
                if ($campo == "tipo_servicio") {
                    $campotext1 = "Zona Operacional";
                }
                if ($campo == "regional") {
                    $campotext1 = "SubArea";
                }
                if ($campo == "vicepresidencia") {
                    $campotext1 = "Familia Cargo 1";
                }
                if ($campo == "gerenciaR2") {
                    $campotext1 = "Familia Cargo 2";
                }
                if ($campo == "gerenciaR3") {
                    $campotext1 = "Familia Cargo 3";
                }
                if ($campo == "operador") {
                    $campotext1 = "Familia Cargo 4";
                }
                if ($campo == "organica") {
                    $campotext1 = "Familia Cargo 5";
                }
                if ($dato2 == "nombre_empresa_holding") {
                    $campotext2 = "Division";
                }
                if ($dato2 == "servicio") {
                    $campotext2 = "Empresa";
                }
                if ($dato2 == "gerencia") {
                    $campotext2 = "Gerencia";
                }
                if ($dato3 == "servicio") {
                    $campotext2 = "Empresa";
                }
                if ($dato3 == "gerencia") {
                    $campotext2 = "Gerencia";
                }
                if ($dato4 == "servicio") {
                    $campotext2 = "Empresa";
                }
                if ($dato4 == "gerencia") {
                    $campotext2 = "Gerencia";
                }
                if ($filtrodim == "felicidad") {
                    $filtrodim == "Felicidad, Seguridad";
                }
                $campo_texto = "Resultado por $filtrodim, $campotext1, $dato";
                $PRINCIPAL = str_replace("{CAMPO}", $campo_texto, $PRINCIPAL);
                $PRINCIPAL = str_replace("{ALTO}", $alto, $PRINCIPAL);
                $PRINCIPAL = str_replace("{LISTADO_DIMENSIONES}", number_format($acumulador_porcentajes_avance_malla / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_FINALIZADOS}", number_format($acumula_finalizados, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_FINALIZADOS}", number_format(100 * $acumula_finalizados / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_PROCESO}", number_format($acumula_en_proceso, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_PROCESO}", number_format(100 * $acumula_en_proceso / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_NOINICIADO}", number_format($acumula_no_iniciados, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_NOINICIADO}", number_format(100 * $acumula_no_iniciados / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_INGRESADOS}", number_format($acumula_ingresos, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_INGRESADOS}", number_format(100 * $acumula_ingresos / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{TEXTO}", "Avance", $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOMBRE_GRAFICO}", "Avance", $PRINCIPAL);
                //Bloque Total de ACESOS
                $PRINCIPAL = str_replace("{PORCENTAJE}", number_format($acumulador_visitas * 100 / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{TEXTO}", "Accesos", $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOMBRE_GRAFICO}", "Accesos", $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function ReporteEncuestaEvidencias($PRINCIPAL, $id_empresa, $arreglo_post, $criterio, $excel)
            {
//echo "$id_empresa, $arreglo_post, $criterio, $excel";
//print_r($arreglo_post);
                /*ROD reporte general*/
                $mallas = TraeMallasEmpresa($id_empresa);
                foreach ($mallas as $malla) {
                    if ($arreglo_post["malla"] == $malla->id) {
                        $option_mallas .= '<option selected value="' . $malla->id . '">' . $malla->nombre . '</option>';
                    } else {
                        $option_mallas .= '<option value="' . $malla->id . '">' . $malla->nombre . '</option>';
                    }
                }
                if (!$arreglo_post["malla"]) {
                    $cursos = TraeCursos_con_Enc_sat("-1", $id_empresa);
                } else {
                    $cursos = TraeCursos_con_Enc_sat($arreglo_post["malla"], $id_empresa);
                }
                $option_cursos = "";
                foreach ($cursos as $curso) {
                    if ($arreglo_post["curso"] == $curso->id) {
                        $option_cursos .= '<option value="' . $curso->id . '" selected>' . $curso->nombre . '</option>';
                    } else {
                        $option_cursos .= '<option value="' . $curso->id . '">' . $curso->nombre . '</option>';
                    }
                }
                $jefes = TraeJefeCursoEmpresa($id_empresa);
                foreach ($jefes as $jefe) {
                    if ($arreglo_post["jefe"] == $jefe->nombre) {
                        $option_ejecutivos .= '<option selected value="' . $jefe->nombre . '">' . $jefe->nombre . '</option>';
                    } else {
                        $option_ejecutivos .= '<option value="' . $jefe->nombre . '">' . $jefe->nombre . '</option>';
                    }
                }
                $PRINCIPAL = str_replace("{MALLAS}", utf8_encode($option_mallas), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CURSOS}", utf8_encode($option_cursos), $PRINCIPAL);
                $PRINCIPAL = str_replace("{EJECUTIVOS}", utf8_encode($option_ejecutivos), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_EMPRSA}", $id_empresa, $PRINCIPAL);
                //Traigo el listado de usuarios
                $i = 0;
                $acumulador_porcentajes_avance_malla = 0;
                $acumulador_visitas = 0;
                if (count($arreglo_post) > 0) {
                    if ($criterio) {
                        $PRINCIPAL = str_replace("{CRITERIO}", $criterio, $PRINCIPAL);
                        $valores_por_criterio = TraigoValoresDadoCampoPorEmpreas($criterio, $id_empresa);
                        foreach ($valores_por_criterio as $valores) {
                            $i++;
                            $usuarios = UsuariosPorEmpresaCapacitacion($id_empresa, $arreglo_post, $criterio, utf8_encode($valores->valor));
                            if (count($usuarios) == 0) {
                                continue;
                            }
                            //print_r($valores);
                            //echo $valores->valor;
                            $rows .= file_get_contents("views/reportes/enc_satisfaccion/row_avance_capacitacion_por_criterio.html");
                            $arreglo_objetos = Lms_Busca_Objetos_Enc_Evidencias($arreglo_post, $id_empresa);
                            $rows = Lms_reporte_MuestraInformeEnc($rows, $id_empresa, $arreglo_objetos, $criterio, $valores->valor);
                            $rows = str_replace("{NUM}", $i, $rows);
                            $rows = str_replace("{NOMBRE}", utf8_encode($valores->valor), $rows);
                            $rows = str_replace("{NUM_USUARIOS}", count($usuarios), $rows);
                            $acumulador_visitas = 0;
                            $acumulador_porcentajes_avance_malla = 0;
                            $acumulador_puntos = 0;
                            $acumulador_medallas = 0;
                            $acumulador_resultados = 0;
                            $contador_usuarios_con_resultados = 0;
                            //$rows = str_replace("{NUMERO_ACCESOS}",$acumulador_visitas,$rows);
                            $rows = str_replace("{NUMERO_ACCESOS}", ColocarColoresConPorcentajeProgressBar(number_format(($acumulador_visitas * 100) / count($usuarios), 0, ",", ".")), $rows);
                            $rows = str_replace("{NUMERO_AVANCE}", ColocarColoresConPorcentajeProgressBar(number_format($acumulador_porcentajes_avance_malla / count($usuarios), 0, ",", ".")), $rows);
                            $rows = str_replace("{PUNTOS}", round($acumulador_puntos / count($usuarios)), $rows);
                            $rows = str_replace("{MEDALLAS}", round($acumulador_medallas / count($usuarios)), $rows);
                            //per capita
                            if ($arreglo_post["malla"] <> '0' && $arreglo_post["curso"] <> '0') {
                                $rows = str_replace("{RESULTADO}", round(number_format($acumulador_resultados / $contador_usuarios_con_resultados, 2, ",", ".")), $rows);
                            } else if ($arreglo_post["malla"] <> '0' && $arreglo_post["curso"] == '0') {
                                $rows = str_replace("{RESULTADO}", round(number_format($acumulador_resultados / $contador_usuarios_con_resultados, 2, ",", ".")), $rows);
                            } else {
                                $rows = str_replace("{RESULTADO}", "-", $rows);
                            }
                        }
                    } else {
                        $usuarios = UsuariosPorEmpresaCapacitacion($id_empresa, $arreglo_post);
                        $arreglo_objetos = Lms_Busca_Objetos_Enc_Evidencias($arreglo_post, $id_empresa);
                        //print_r($arreglo_post);
                        //print_r($arreglo_objetos);
                        //$datos_calculos_malla=Lms_reporte_MuestraInformeEnc($PRINCIPAL, $id_empresa, $arreglo_objetos, "", "");
                        if ($excel == 1) {
                            exit;
                        }
                        $PRINCIPAL = Lms_reporte_MuestraListaCursosEncEvidencia($PRINCIPAL, $id_empresa, $arreglo_post, "", "");
                        $PRINCIPAL = Lms_reporte_MuestraInformeEncEvidencias($PRINCIPAL, $id_empresa, $arreglo_objetos, $arreglo_post, "");
                        //$PRINCIPAL=Lms_reporte_MuestraInformeEncPromedio($PRINCIPAL, $id_empresa, $arreglo_objetos, "", "");
                    }
                }
                //echo "$i $acumula_finalizados $acumula_en_proceso $acumula_no_iniciados $acumula_ingresos";
                $acumula_ingresos = $acumula_en_proceso + $acumula_finalizados;
                $PRINCIPAL = str_replace("{LISTADO_USUARIOS}", $rows, $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS}", $i, $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_TOTAL}", number_format($acumulador_porcentajes_avance_malla / $i, 0, ",", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_ACCESOS}", $acumulador_visitas, $PRINCIPAL);
                //Bloque Total de Porcentaje Total
                //$PRINCIPAL = str_replace("{BLOQUE_ENCUESTA_SATISFACCION}",Lms_reporte_MuestraInformeEnc($PRINCIPAL, $id_empresa, $arreglo_objetos),$PRINCIPAL);
                $PRINCIPAL = str_replace("{LISTADO_DIMENSIONES}", number_format($acumulador_porcentajes_avance_malla / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_FINALIZADOS}", number_format($acumula_finalizados, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_FINALIZADOS}", number_format(100 * $acumula_finalizados / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_PROCESO}", number_format($acumula_en_proceso, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_PROCESO}", number_format(100 * $acumula_en_proceso / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_NOINICIADO}", number_format($acumula_no_iniciados, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_NOINICIADO}", number_format(100 * $acumula_no_iniciados / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_INGRESADOS}", number_format($acumula_ingresos, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_INGRESADOS}", number_format(100 * $acumula_ingresos / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{TEXTO}", "Avance", $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOMBRE_GRAFICO}", "Avance", $PRINCIPAL);
                //Bloque Total de ACESOS
                $PRINCIPAL = str_replace("{GRAFICO_CANTIDAD_ACCESOS}", file_get_contents("views/graficos/grafico_circulo.html"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE}", number_format($acumulador_visitas * 100 / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{TEXTO}", "Accesos", $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOMBRE_GRAFICO}", "Accesos", $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function ReporteEncuestaEvidenciasJefe($PRINCIPAL, $id_empresa, $arreglo_post, $criterio, $excel)
            {
//echo "$id_empresa, $arreglo_post, $criterio, $excel";
                /*ROD reporte general*/
                $mallas = TraeMallasEmpresa($id_empresa);
                foreach ($mallas as $malla) {
                    if ($arreglo_post["malla"] == $malla->id) {
                        $option_mallas .= '<option selected value="' . $malla->id . '">' . $malla->nombre . '</option>';
                    } else {
                        $option_mallas .= '<option value="' . $malla->id . '">' . $malla->nombre . '</option>';
                    }
                }
                if (!$arreglo_post["malla"]) {
                    $cursos = TraeCursos_con_Enc_satjEFE("-1", $id_empresa);
                } else {
                    $cursos = TraeCursos_con_Enc_satjEFE($arreglo_post["malla"], $id_empresa);
                }
                $option_cursos = "";
                foreach ($cursos as $curso) {
                    if ($arreglo_post["curso"] == $curso->id) {
                        $option_cursos .= '<option value="' . $curso->id . '" selected>' . $curso->nombre . '</option>';
                    } else {
                        $option_cursos .= '<option value="' . $curso->id . '">' . $curso->nombre . '</option>';
                    }
                }
                $ejecutivos = TraeEjecutivosCursoEmpresa($id_empresa);
                foreach ($ejecutivos as $ejecutivo) {
                    if ($arreglo_post["ejecutivo"] == $ejecutivo->nombre) {
                        $option_ejecutivos .= '<option selected value="' . $ejecutivo->nombre . '">' . $ejecutivo->nombre . '</option>';
                    } else {
                        $option_ejecutivos .= '<option value="' . $ejecutivo->nombre . '">' . $ejecutivo->nombre . '</option>';
                    }
                }
                $PRINCIPAL = str_replace("{MALLAS}", utf8_encode($option_mallas), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CURSOS}", utf8_encode($option_cursos), $PRINCIPAL);
                $PRINCIPAL = str_replace("{EJECUTIVOS}", utf8_encode($option_ejecutivos), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_EMPRSA}", $id_empresa, $PRINCIPAL);
                //Traigo el listado de usuarios
                $i = 0;
                $acumulador_porcentajes_avance_malla = 0;
                $acumulador_visitas = 0;
                if (count($arreglo_post) > 0) {
                    if ($criterio) {
                        $PRINCIPAL = str_replace("{CRITERIO}", $criterio, $PRINCIPAL);
                        $valores_por_criterio = TraigoValoresDadoCampoPorEmpreas($criterio, $id_empresa);
                        foreach ($valores_por_criterio as $valores) {
                            $i++;
                            $usuarios = UsuariosPorEmpresaCapacitacion($id_empresa, $arreglo_post, $criterio, utf8_encode($valores->valor));
                            if (count($usuarios) == 0) {
                                continue;
                            }
                            //print_r($valores);
                            //echo $valores->valor;
                            $rows .= file_get_contents("views/reportes/enc_satisfaccion/row_avance_capacitacion_por_criterio.html");
                            $arreglo_objetos = Lms_Busca_Objetos_Enc_Evidencias($arreglo_post, $id_empresa);
                            $rows = Lms_reporte_MuestraInformeEnc($rows, $id_empresa, $arreglo_objetos, $criterio, $valores->valor);
                            $rows = str_replace("{NUM}", $i, $rows);
                            $rows = str_replace("{NOMBRE}", utf8_encode($valores->valor), $rows);
                            $rows = str_replace("{NUM_USUARIOS}", count($usuarios), $rows);
                            $acumulador_visitas = 0;
                            $acumulador_porcentajes_avance_malla = 0;
                            $acumulador_puntos = 0;
                            $acumulador_medallas = 0;
                            $acumulador_resultados = 0;
                            $contador_usuarios_con_resultados = 0;
                            //$rows = str_replace("{NUMERO_ACCESOS}",$acumulador_visitas,$rows);
                            $rows = str_replace("{NUMERO_ACCESOS}", ColocarColoresConPorcentajeProgressBar(number_format(($acumulador_visitas * 100) / count($usuarios), 0, ",", ".")), $rows);
                            $rows = str_replace("{NUMERO_AVANCE}", ColocarColoresConPorcentajeProgressBar(number_format($acumulador_porcentajes_avance_malla / count($usuarios), 0, ",", ".")), $rows);
                            $rows = str_replace("{PUNTOS}", round($acumulador_puntos / count($usuarios)), $rows);
                            $rows = str_replace("{MEDALLAS}", round($acumulador_medallas / count($usuarios)), $rows);
                            //per capita
                            if ($arreglo_post["malla"] <> '0' && $arreglo_post["curso"] <> '0') {
                                $rows = str_replace("{RESULTADO}", round(number_format($acumulador_resultados / $contador_usuarios_con_resultados, 2, ",", ".")), $rows);
                            } else if ($arreglo_post["malla"] <> '0' && $arreglo_post["curso"] == '0') {
                                $rows = str_replace("{RESULTADO}", round(number_format($acumulador_resultados / $contador_usuarios_con_resultados, 2, ",", ".")), $rows);
                            } else {
                                $rows = str_replace("{RESULTADO}", "-", $rows);
                            }
                        }
                    } else {
                        $usuarios = UsuariosPorEmpresaCapacitacion($id_empresa, $arreglo_post);
                        $arreglo_objetos = Lms_Busca_Objetos_Enc_EvidenciasJefe($arreglo_post, $id_empresa);
                        //print_r($arreglo_post);
                        //print_r($arreglo_objetos);
                        //$datos_calculos_malla=Lms_reporte_MuestraInformeEnc($PRINCIPAL, $id_empresa, $arreglo_objetos, "", "");
                        if ($excel == 1) {
                            exit;
                        }
                        $PRINCIPAL = Lms_reporte_MuestraListaCursosEncJefe($PRINCIPAL, $id_empresa, $arreglo_post, "", "");
                        $PRINCIPAL = Lms_reporte_MuestraInformeEncEvidenciasJefe($PRINCIPAL, $id_empresa, $arreglo_objetos, "", "");
                        //$PRINCIPAL=Lms_reporte_MuestraInformeEncPromedio($PRINCIPAL, $id_empresa, $arreglo_objetos, "", "");
                    }
                }
                //echo "$i $acumula_finalizados $acumula_en_proceso $acumula_no_iniciados $acumula_ingresos";
                $acumula_ingresos = $acumula_en_proceso + $acumula_finalizados;
                $PRINCIPAL = str_replace("{LISTADO_USUARIOS}", $rows, $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS}", $i, $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_TOTAL}", number_format($acumulador_porcentajes_avance_malla / $i, 0, ",", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_ACCESOS}", $acumulador_visitas, $PRINCIPAL);
                //Bloque Total de Porcentaje Total
                //$PRINCIPAL = str_replace("{BLOQUE_ENCUESTA_SATISFACCION}",Lms_reporte_MuestraInformeEnc($PRINCIPAL, $id_empresa, $arreglo_objetos),$PRINCIPAL);
                $PRINCIPAL = str_replace("{LISTADO_DIMENSIONES}", number_format($acumulador_porcentajes_avance_malla / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_FINALIZADOS}", number_format($acumula_finalizados, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_FINALIZADOS}", number_format(100 * $acumula_finalizados / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_PROCESO}", number_format($acumula_en_proceso, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_PROCESO}", number_format(100 * $acumula_en_proceso / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_NOINICIADO}", number_format($acumula_no_iniciados, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_NOINICIADO}", number_format(100 * $acumula_no_iniciados / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CANTIDAD_USUARIOS_INGRESADOS}", number_format($acumula_ingresos, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE_USUARIOS_INGRESADOS}", number_format(100 * $acumula_ingresos / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{TEXTO}", "Avance", $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOMBRE_GRAFICO}", "Avance", $PRINCIPAL);
                //Bloque Total de ACESOS
                $PRINCIPAL = str_replace("{GRAFICO_CANTIDAD_ACCESOS}", file_get_contents("views/graficos/grafico_circulo.html"), $PRINCIPAL);
                $PRINCIPAL = str_replace("{PORCENTAJE}", number_format($acumulador_visitas * 100 / $i, 0, ".", "."), $PRINCIPAL);
                $PRINCIPAL = str_replace("{TEXTO}", "Accesos", $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOMBRE_GRAFICO}", "Accesos", $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function Lms_reporte_MuestraListaCursosEncJefe($PRINCIPAL, $id_empresa, $arreglo_post)
            {
                $id_malla = $arreglo_post[malla];
                $id_curso = $arreglo_post[curso];
                $ejecutivo = $arreglo_post[ejecutivo];
                $fechas = $arreglo_post[fechas];
                $fechasString = explode(" - ", $fechas);
                $fechaInicio = $fechasString[0]; // porción1
                $fechaTermino = $fechasString[1]; // porción2
                $ListaCursos = lms_lista_curso_filtrosJefe($id_malla, $id_curso, $ejecutivo, $fechaInicio, $fechaTermino, $id_empresa);
                $enc_template = busca_enc_satis_template_admin($id_empresa);
                $html .= file_get_contents("views/reportes/enc_evidencias_jefe/entorno_cursos_listado.html");
                foreach ($ListaCursos as $ListaCurso) {
                    $row .= file_get_contents("views/reportes/enc_evidencias_jefe/row_cursos_listado.html");
                    $row = str_replace("{ID_CURSO}", ($ListaCurso->id), $row);
                    $row = str_replace("{NOMBRE_CURSO}", ($ListaCurso->nombre), $row);
                    $row = str_replace("{EJECUTIVO}", ($ListaCurso->ejecutivocapacitacion), $row);
                    $row = str_replace("{FEC_INICIO}", ($ListaCurso->fecha_inicio), $row);
                    $row = str_replace("{FEC_TERMINO}", ($ListaCurso->fecha_finalizacion), $row);
                    $row = str_replace("{PART}", ($ListaCurso->participantes), $row);
                    $row = str_replace("{PART_PARTICIPANTES}", ($ListaCurso->participantes), $row);
                    $row = str_replace("{PART_RELATOR}", ($ListaCurso->participantes_relator), $row);
                    $preguntas_por_dimension = ENC_TraigoPreguntaDadaDimenion($dimen->iddimension);
                }
                $html = str_replace("{ROW_LISTADO}", ($row), $html);
                $PRINCIPAL = str_replace("{BLOQUE_FILTROS_CURSOS}", utf8_encode($html), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function Lms_reporte_MuestraListaCursosEncEvidencia($PRINCIPAL, $id_empresa, $arreglo_post)
            {
                $id_malla = $arreglo_post[malla];
                $id_curso = $arreglo_post[curso];
                $ejecutivo = $arreglo_post[ejecutivo];
                $jefe = $arreglo_post[jefe];
                $fechas = $arreglo_post[fechas];
                $fechasString = explode(" - ", $fechas);
                $fechaInicio = $fechasString[0]; // porción1
                $fechaTermino = $fechasString[1]; // porción2
                $ListaCursos = lms_lista_curso_filtros_evidencias($id_malla, $id_curso, $ejecutivo, $jefe, $fechaInicio, $fechaTermino, $id_empresa);
                $enc_template = busca_enc_satis_template_admin($id_empresa);
                $html .= file_get_contents("views/reportes/enc_satisfaccion/entorno_cursos_listado.html");
                foreach ($ListaCursos as $ListaCurso) {
                    $row .= file_get_contents("views/reportes/enc_satisfaccion/row_cursos_listado.html");
                    $row = str_replace("{ID_CURSO}", ($ListaCurso->id), $row);
                    $row = str_replace("{NOMBRE_CURSO}", ($ListaCurso->nombre_curso), $row);
                    $row = str_replace("{EJECUTIVO}", ($ListaCurso->jefe), $row);
                    $row = str_replace("{FEC_INICIO}", ($ListaCurso->fecha), $row);
                    $row = str_replace("{FEC_TERMINO}", ($ListaCurso->fecha_finalizacion), $row);
                    $row = str_replace("{PART}", ($ListaCurso->participantes), $row);
                    $row = str_replace("{PART_PARTICIPANTES}", ($ListaCurso->participantes), $row);
                    $row = str_replace("{PART_RELATOR}", ($ListaCurso->participantes_relator), $row);
                    $preguntas_por_dimension = ENC_TraigoPreguntaDadaDimenion($dimen->iddimension);
                }
                $html = str_replace("{ROW_LISTADO}", ($row), $html);
                $PRINCIPAL = str_replace("{BLOQUE_FILTROS_CURSOS}", utf8_encode($html), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function Lms_reporte_MuestraListaCursosEnc($PRINCIPAL, $id_empresa, $arreglo_post, $excel)
            {
//echo "$id_empresa, $arreglo_post, $excel"; exit();
                $id_malla = $arreglo_post[malla];
                $id_curso = $arreglo_post[curso];
                $ejecutivo = $arreglo_post[ejecutivo];
                $jefe = $arreglo_post[jefe];
                $fechas = $arreglo_post[fechas];
                $fechasString = explode(" - ", $fechas);
                $fechaInicio = $fechasString[0]; // porción1
                $fechaTermino = $fechasString[1]; // porción2
                //$ListaCursos=lms_lista_curso_filtros($id_malla, $id_curso, $ejecutivo, $jefe, $fechaInicio, $fechaTermino, $id_empresa);
                //$ListaCursos=lms_lista_Imparticiones_filtros_($id_malla, $id_curso, $ejecutivo, $jefe, $fechaInicio, $fechaTermino, $id_empresa);
                $ListaCursos = lms_lista_Imparticiones_filtros_($id_empresa, $arreglo_post);
                $enc_template = busca_enc_satis_template_admin($id_empresa);
                if ($excel == 1) {
                    $html .= file_get_contents("views/reportes/enc_satisfaccion/entorno_cursos_listado_excel.html");
                } else {
                    $html .= file_get_contents("views/reportes/enc_satisfaccion/entorno_cursos_listado.html");
                }
                foreach ($ListaCursos as $ListaCurso) {
                    if ($excel == 1) {
                        $row .= file_get_contents("views/reportes/enc_satisfaccion/row_cursos_listado_excel.html");
                    } else {
                        $row .= file_get_contents("views/reportes/enc_satisfaccion/row_cursos_listado.html");
                    }
                    $row = str_replace("{ID_CURSO}", ($ListaCurso->codigo_inscripcion), $row);
                    $row = str_replace("{NOMBRE_CURSO}", ($ListaCurso->nombre_curso), $row);
                    $row = str_replace("{EJECUTIVO}", ($ListaCurso->ejecutivo), $row);
                    $row = str_replace("{FEC_INICIO}", ($ListaCurso->fecha_inicio), $row);
                    $row = str_replace("{FEC_TERMINO}", ($ListaCurso->fecha_termino), $row);
                    $row = str_replace("{PART}", ($ListaCurso->participantes), $row);
                    $row = str_replace("{PART_PARTICIPANTES}", ($ListaCurso->participantes_participantes), $row);
                    $row = str_replace("{PART_RELATOR}", ($ListaCurso->participantes_relator), $row);
                    $preguntas_por_dimension = ENC_TraigoPreguntaDadaDimenion($dimen->iddimension);
                }
                $html = str_replace("{ROW_LISTADO}", ($row), $html);
                if ($excel == 1) {
                    $PRINCIPAL = utf8_encode($html);
                } else {
                    $PRINCIPAL = str_replace("{BLOQUE_FILTROS_CURSOS}", utf8_encode($html), $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function Lms_reporte_MuestraListaCursosInscripcionEnc($PRINCIPAL, $id_empresa, $arreglo_post)
            {
                $id_malla = $arreglo_post[malla];
                $id_curso = $arreglo_post[curso];
                $ejecutivo = $arreglo_post[ejecutivo];
                $fechas = $arreglo_post[fechas];
                $fechasString = explode(" - ", $fechas);
                $fechaInicio = $fechasString[0]; // porción1
                $fechaTermino = $fechasString[1]; // porción2
                $ListaCursosInscripciones = lms_lista_curso_filtros_inscripcion($id_malla, $id_curso, $ejecutivo, $fechaInicio, $fechaTermino, $id_empresa);
                //arreglo de encuestas
                $enc_template = busca_enc_satis_template_admin($id_empresa);
                $html .= file_get_contents("views/reportes/inscripcionpresencial/entorno_cursos_listado.html");
                //print_r($ListaCursosInscripciones);
                foreach ($ListaCursosInscripciones as $ListaCursoInscripcion) {
                    $row .= file_get_contents("views/reportes/inscripcionpresencial/row_cursos_listado.html");
                    $row = str_replace("{ID_CURSO}", ($ListaCursoInscripcion->codigo_inscripcion), $row);
                    $row = str_replace("{NOMBRE_CURSO}", ($ListaCursoInscripcion->nombrecurso), $row);
                    $row = str_replace("{FEC_INICIO}", ($ListaCursoInscripcion->fecha_inicio), $row);
                    $row = str_replace("{FEC_TERMINO}", ($ListaCursoInscripcion->fecha_termino), $row);
                    $row = str_replace("{CUPOS}", ($ListaCursoInscripcion->cupos), $row);
                    $row = str_replace("{INSCRITOS}", ($ListaCursoInscripcion->inscritos), $row);
                    $row = str_replace("{LISTAESPERA}", ($ListaCursoInscripcion->listaespera), $row);
                    //Por cada dimension traigo las preguntas
                    $preguntas_por_dimension = ENC_TraigoPreguntaDadaDimenion($dimen->iddimension);
                }
                $html = str_replace("{ROW_LISTADO}", ($row), $html);
                $PRINCIPAL = str_replace("{BLOQUE_FILTROS_CURSOS_INSCRIPCION}", utf8_encode($html), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function Lms_reporte_MuestraInformeEnc($PRINCIPAL, $id_empresa, $arreglo_objetos, $criterio, $valor, $excel)
            {
                //arreglo de encuestas
                $id_imparticion = $arreglo_objetos[0]->codigo_inscripcion;
                $enc_template = busca_enc_satis_template_admin($id_empresa);
                $primer_arreglo_objeto = $arreglo_objetos[0]->id;
                $id_encuesta = Lms_busca_encuesta_dada_objeto($primer_arreglo_objeto, $id_empresa);
                $dimensiones_por_encuesta = ENC_TraigoDimensionesPorEncuesta($id_empresa, $id_encuesta[0]->id_encuesta);
                $id_curso = $arreglo_objetos[0]->id_curso;
                //print_r($id_encuesta);
                //print_r($dimensiones_por_encuesta);
                $cuenta_encuestas = ENC_CuentaParticipantesPorEncuesta($id_empresa, $arreglo_objetos[0]->id, $id_encuesta[0]->id_encuesta);
                $cuenta_respuestas = count($cuenta_encuestas);
                foreach ($dimensiones_por_encuesta as $dimen) {
                    $cuentaOpciones = CuentaOpcionesEncSat($id_empresa, $dimen->iddimension);
                }
                if ($excel == 1) {
                    $html .= file_get_contents("views/reportes/enc_satisfaccion/informe_entorno_enc_informe_excel_" . $cuentaOpciones[0]->cuenta . ".html");
                } else {
                    $html .= file_get_contents("views/reportes/enc_satisfaccion/informe_entorno_enc_informe.html");
                }
                $arreglo_post_objeto = $arreglo_objetos;
                $array_para_enviar_via_url_objetos = serialize($arreglo_post_objeto);
                $array_para_enviar_via_url_objetos = urlencode($array_para_enviar_via_url_objetos);
                $html = str_replace("{ARREGLO_OBJETO}", $array_para_enviar_via_url_objetos, $html);
                $html = str_replace("{VALOR}", $valor, $html);
                $acumulador_notas = 0;
                $acumulador_1 = 0;
                $acumulador_2 = 0;
                $acamulador_3 = 0;
                $acumulador_4 = 0;
                $acumulador_5 = 0;
                $acumulador_6 = 0;
                $acumulador_7 = 0;
                $acumulador_cuenta = 0;
                foreach ($dimensiones_por_encuesta as $dimen) {
                    //$num_opciones_encuestas=num_opc_encues_dim()
                    $cuentaOpciones = CuentaOpcionesEncSat($id_empresa, $dimen->iddimension);
                    //echo "<br>".$cuentaOpciones[0]->cuenta;
                    if ($excel == 1) {
                        $htmlTi = file_get_contents("views/reportes/enc_satisfaccion/informe_titulo_" . $cuentaOpciones[0]->cuenta . "dim_excel.html");
                    } else {
                        $htmlTi = file_get_contents("views/reportes/enc_satisfaccion/informe_titulo_" . $cuentaOpciones[0]->cuenta . "dim.html");
                    }
                    if ($excel == 1) {
                        $template_row = file_get_contents("views/reportes/enc_satisfaccion/informe_row_dimension_" . $cuentaOpciones[0]->cuenta . "dim_excel.html");
                    } else {
                        $template_row = file_get_contents("views/reportes/enc_satisfaccion/informe_row_dimension_" . $cuentaOpciones[0]->cuenta . "dim.html");
                    }
                    $row .= $template_row;
                    if ($excel == 1) {
                    } else {
                        $row = str_replace("{GRAFICO}", file_get_contents("views/reportes/enc_satisfaccion/informe_enc_grafico_" . $enc_template[0]->template_admin . ".html"), $row);
                    }
                    $row = str_replace("{CODIGO_GRAFICO}", ($dimen->iddimension), $row);
                    $row = str_replace("{NOMBRE_DIMENSION}", ($dimen->dimension), $row);
                    //Por cada dimension traigo las preguntas
                    $preguntas_por_dimension = ENC_TraigoPreguntaDadaDimenion($dimen->iddimension);
                    $acumulador_cuenta1 = 0;
                    $acumulador_cuenta2 = 0;
                    $acumulador_cuenta3 = 0;
                    $acumulador_cuenta4 = 0;
                    $acumulador_cuenta5 = 0;
                    $acumulador_cuenta6 = 0;
                    $acumulador_cuenta7 = 0;
                    $acumulador_cuenta = 0;
                    //busca rangos
                    //print_r($preguntas_por_dimension);
                    foreach ($preguntas_por_dimension as $preg) {
                        $promedio_por_preg = ENC_CuentaDeRespuestasPorPregunta_7opciones_CriterioCH($id_empresa, $id_encuesta[0]->id_encuesta, $preg->idpregunta, $arreglo_objetos, $criterio);
                        //print_r($promedio_por_preg);
                        //exit();
                        $acumulador_notas = $acumulador_notas + $promedio_por_preg[0]->promedio_pregunta;
                        ++$numpreg;
                        $acumulador_cuenta1 = $promedio_por_preg[0]->cuenta1 + $acumulador_cuenta1;
                        $acumulador_cuenta2 = $promedio_por_preg[0]->cuenta2 + $acumulador_cuenta2;
                        $acumulador_cuenta3 = $promedio_por_preg[0]->cuenta3 + $acumulador_cuenta3;
                        $acumulador_cuenta4 = $promedio_por_preg[0]->cuenta4 + $acumulador_cuenta4;
                        $acumulador_cuenta5 = $promedio_por_preg[0]->cuenta5 + $acumulador_cuenta5;
                        $acumulador_cuenta6 = $promedio_por_preg[0]->cuenta6 + $acumulador_cuenta6;
                        $acumulador_cuenta7 = $promedio_por_preg[0]->cuenta7 + $acumulador_cuenta7;
                    }
                    $acumulador_cuenta = $acumulador_cuenta1 + $acumulador_cuenta2 + $acumulador_cuenta3 + $acumulador_cuenta4 + $acumulador_cuenta5 + $acumulador_cuenta6 + $acumulador_cuenta7;
                    $promedio_enc_sat[0] = round(100 * $acumulador_cuenta1 / $acumulador_cuenta, 1);
                    $promedio_enc_sat[1] = round(100 * $acumulador_cuenta2 / $acumulador_cuenta, 1);
                    $promedio_enc_sat[2] = round(100 * $acumulador_cuenta3 / $acumulador_cuenta, 1);
                    $promedio_enc_sat[3] = round(100 * $acumulador_cuenta4 / $acumulador_cuenta, 1);
                    $promedio_enc_sat[4] = round(100 * $acumulador_cuenta5 / $acumulador_cuenta, 1);
                    $promedio_enc_sat[5] = round(100 * $acumulador_cuenta6 / $acumulador_cuenta, 1);
                    $promedio_enc_sat[6] = round(100 * $acumulador_cuenta7 / $acumulador_cuenta, 1);
                    $row = str_replace("{CUENTA1}", nunComas1Dec(($promedio_enc_sat[0])), $row);
                    $row = str_replace("{CUENTA2}", nunComas1Dec(($promedio_enc_sat[1])), $row);
                    $row = str_replace("{CUENTA3}", nunComas1Dec(($promedio_enc_sat[2])), $row);
                    $row = str_replace("{CUENTA4}", nunComas1Dec(($promedio_enc_sat[3])), $row);
                    $row = str_replace("{CUENTA5}", nunComas1Dec(($promedio_enc_sat[4])), $row);
                    $row = str_replace("{CUENTA6}", nunComas1Dec(($promedio_enc_sat[5])), $row);
                    $row = str_replace("{CUENTA7}", nunComas1Dec(($promedio_enc_sat[6])), $row);
                    $promedio = $promedio_enc_sat[0] * 1 + $promedio_enc_sat[1] * 2 + $promedio_enc_sat[2] * 3 + $promedio_enc_sat[3] * 4 + $promedio_enc_sat[4] * 5 + $promedio_enc_sat[5] * 6 + $promedio_enc_sat[6] * 7;
                    $acumulador_promedio = $promedio + $acumulador_promedio;
                    $contador_promedio++;
                    $row = str_replace("{PROMEDIO}", nunComas1Dec(round(($promedio / 100), 1)), $row);
                    $row = str_replace("{CUENTAR}", round($promedio_enc_sat[0] + $promedio_enc_sat[1] + $promedio_enc_sat[2] + $promedio_enc_sat[3] + $promedio_enc_sat[4], 1), $row);
                    $row = str_replace("{CUENTAV}", round($promedio_enc_sat[5] + $promedio_enc_sat[6] + $promedio_enc_sat[7], 1), $row);
                }
// Busca Usuario
                $html = str_replace("{PROMEDIO_FINAL}", nunComas1Dec(round(($acumulador_promedio / $contador_promedio / 100), 1)), $html);
                $html = str_replace("{TITULO_DIMENSIONES}", ($htmlTI), $html);
                $html = str_replace("{LISTADO_DIMENSIONES}", ($row), $html);
                $html = str_replace("{SOBRETITULO}", $cuenta_respuestas, $html);
                $datos_decurso = Datos_curso($id_curso);
                $datos_imparticion = DatosInscripcionImparticionesV2($id_imparticion, $id_empresa);
                $html = str_replace("{NOMBRECURSO}", $datos_imparticion[0]->nombre_curso, $html);
                $html = str_replace("{CODIGOIMPARTICION}", $datos_imparticion[0]->codigo_inscripcion, $html);
                $html = str_replace("{FECHAIMPARTICION}", $datos_imparticion[0]->fecha_inicio, $html);
                $html = str_replace("{FECHAIMPARTICION}", $datos_imparticion[0]->fecha_termino, $html);
                if ($excel == 1) {
                    $PRINCIPAL = utf8_encode($html);
                } else {
                    $PRINCIPAL = str_replace("{BLOQUE_ENCUESTA_SATISFACCION}", utf8_encode($html), $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function Lms_reporte_MuestraInformeDimEnc($PRINCIPAL, $id_empresa, $arreglo_objetos, $criterio, $valor, $excel, $arreglo_post)
            {
                //arreglo de encuestas
                $enc_template = busca_enc_satis_template_admin($id_empresa);
                $primer_arreglo_objeto = $arreglo_objetos[0]->id;
                $id_encuesta = Lms_busca_encuesta_dada_objeto($primer_arreglo_objeto, $id_empresa);
                $dimensiones_por_encuesta = ENC_TraigoDimensionesPorEncuesta($id_empresa, $id_encuesta[0]->id_encuesta);
                $id_curso = $arreglo_objetos[0]->id_curso;
                //print_r($id_encuesta);
                //print_r($dimensiones_por_encuesta);
                $cuenta_encuestas = ENC_CuentaParticipantesPorEncuesta($id_empresa, $arreglo_objetos[0]->id, $id_encuesta[0]->id_encuesta, $arreglo_post, $arreglo_objetos);
                $cuenta_respuestas = count($cuenta_encuestas);
                //echo "cuenta_respuestas $cuenta_respuestas";
                //print_r($cuenta_encuestas);
                if ($excel == 1) {
                    $html .= file_get_contents("views/reportes/enc_satisfaccion/informe_entorno_enc_informe_excel.html");
                } else {
                    $html .= file_get_contents("views/reportes/enc_satisfaccion/informe_entorno_enc_informe_columnas_superiores.html");
                }
                $arreglo_post_objeto = $arreglo_objetos;
                $array_para_enviar_via_url_objetos = serialize($arreglo_post_objeto);
                $array_para_enviar_via_url_objetos = urlencode($array_para_enviar_via_url_objetos);
                $html = str_replace("{ARREGLO_OBJETO}", $array_para_enviar_via_url_objetos, $html);
                $html = str_replace("{VALOR}", $valor, $html);
                $acumulador_notas = 0;
                $acumulador_1 = 0;
                $acumulador_2 = 0;
                $acamulador_3 = 0;
                $acumulador_4 = 0;
                $acumulador_5 = 0;
                $acumulador_6 = 0;
                $acumulador_7 = 0;
                foreach ($dimensiones_por_encuesta as $dimen) {
                    //$num_opciones_encuestas=num_opc_encues_dim()
                    $cuentaOpciones = CuentaOpcionesEncSat($id_empresa, $dimen->iddimension);
                    //echo "<br>".$cuentaOpciones[0]->cuenta;
                    if ($excel == 1) {
                        $htmlTi = file_get_contents("views/reportes/enc_satisfaccion/informe_titulo_" . $cuentaOpciones[0]->cuenta . "dim_excel.html");
                    } else {
                        $htmlTi = file_get_contents("views/reportes/enc_satisfaccion/informe_titulo_" . $cuentaOpciones[0]->cuenta . "dim.html");
                    }
                    if ($excel == 1) {
                        $template_row = file_get_contents("views/reportes/enc_satisfaccion/informe_row_dimension_" . $cuentaOpciones[0]->cuenta . "dim_excel.html");
                    } else {
                        $template_row = file_get_contents("views/reportes/enc_satisfaccion/informe_row_dimension_" . $cuentaOpciones[0]->cuenta . "dim.html");
                    }
                    $row .= $template_row;
                    if ($excel == 1) {
                    } else {
                        $row = str_replace("{GRAFICO}", file_get_contents("views/reportes/enc_satisfaccion/informe_enc_grafico_" . $enc_template[0]->template_admin . ".html"), $row);
                    }
                    $row = str_replace("{CODIGO_GRAFICO}", ($dimen->iddimension), $row);
                    $row = str_replace("{NOMBRE_DIMENSION}", ($dimen->dimension), $row);
                    //Por cada dimension traigo las preguntas
                    $preguntas_por_dimension = ENC_TraigoPreguntaDadaDimenion($dimen->iddimension);
//echo "<br> <br> iddimension ".$dimen->iddimension." ".$dimen->dimension;
                    $acumulador_cuenta1 = 0;
                    $acumulador_cuenta2 = 0;
                    $acumulador_cuenta3 = 0;
                    $acumulador_cuenta4 = 0;
                    $acumulador_cuenta5 = 0;
                    $acumulador_cuenta6 = 0;
                    $acumulador_cuenta7 = 0;
                    $acumulador_cuenta = 0;
                    //busca rangos
                    //print_r($preguntas_por_dimension);
                    foreach ($preguntas_por_dimension as $preg) {
                        $promedio_por_preg = ENC_CuentaDeRespuestasPorPregunta_7opciones_CriterioCH($id_empresa, $id_encuesta[0]->id_encuesta, $preg->idpregunta, $arreglo_objetos, $criterio);
                        //print_r($promedio_por_preg);
                        //exit();
                        $acumulador_notas = $acumulador_notas + $promedio_por_preg[0]->promedio_pregunta;
                        ++$numpreg;
                        $acumulador_cuenta1 = $promedio_por_preg[0]->cuenta1 + $acumulador_cuenta1;
                        $acumulador_cuenta2 = $promedio_por_preg[0]->cuenta2 + $acumulador_cuenta2;
                        $acumulador_cuenta3 = $promedio_por_preg[0]->cuenta3 + $acumulador_cuenta3;
                        $acumulador_cuenta4 = $promedio_por_preg[0]->cuenta4 + $acumulador_cuenta4;
                        $acumulador_cuenta5 = $promedio_por_preg[0]->cuenta5 + $acumulador_cuenta5;
                        $acumulador_cuenta6 = $promedio_por_preg[0]->cuenta6 + $acumulador_cuenta6;
                        $acumulador_cuenta7 = $promedio_por_preg[0]->cuenta7 + $acumulador_cuenta7;
                    }
                    $acumulador_cuenta = $acumulador_cuenta1 + $acumulador_cuenta2 + $acumulador_cuenta3 + $acumulador_cuenta4 + $acumulador_cuenta5 + $acumulador_cuenta6 + $acumulador_cuenta7;
                    //$acumulador_cuenta=1;
                    //echo "<br>$acumulador_cuenta1 /$acumulador_cuenta";
                    //echo "<br>$acumulador_cuenta7 /$acumulador_cuenta";
                    $promedio_enc_sat[0] = round(100 * $acumulador_cuenta1 / $acumulador_cuenta, 1);
                    $promedio_enc_sat[1] = round(100 * $acumulador_cuenta2 / $acumulador_cuenta, 1);
                    $promedio_enc_sat[2] = round(100 * $acumulador_cuenta3 / $acumulador_cuenta, 1);
                    $promedio_enc_sat[3] = round(100 * $acumulador_cuenta4 / $acumulador_cuenta, 1);
                    $promedio_enc_sat[4] = round(100 * $acumulador_cuenta5 / $acumulador_cuenta, 1);
                    $promedio_enc_sat[5] = round(100 * $acumulador_cuenta6 / $acumulador_cuenta, 1);
                    $promedio_enc_sat[6] = round(100 * $acumulador_cuenta7 / $acumulador_cuenta, 1);
                    $row = str_replace("{CUENTA1}", ($promedio_enc_sat[0]), $row);
                    $row = str_replace("{CUENTA2}", ($promedio_enc_sat[1]), $row);
                    $row = str_replace("{CUENTA3}", ($promedio_enc_sat[2]), $row);
                    $row = str_replace("{CUENTA4}", ($promedio_enc_sat[3]), $row);
                    $row = str_replace("{CUENTA5}", ($promedio_enc_sat[4]), $row);
                    $row = str_replace("{CUENTA6}", ($promedio_enc_sat[5]), $row);
                    $row = str_replace("{CUENTA7}", ($promedio_enc_sat[6]), $row);
                    $promedio = $promedio_enc_sat[0] * 1 + $promedio_enc_sat[1] * 2 + $promedio_enc_sat[2] * 3 + $promedio_enc_sat[3] * 4 + $promedio_enc_sat[4] * 5 + $promedio_enc_sat[5] * 6 + $promedio_enc_sat[6] * 7;
                    $row = str_replace("{PROMEDIO}", ($promedio / 100), $row);
                    $row = str_replace("{CUENTAR}", round($promedio_enc_sat[0] + $promedio_enc_sat[1] + $promedio_enc_sat[2] + $promedio_enc_sat[3] + $promedio_enc_sat[4], 2), $row);
                    $row = str_replace("{CUENTAV}", round($promedio_enc_sat[5] + $promedio_enc_sat[6] + $promedio_enc_sat[7], 2), $row);
                }
                $html = str_replace("{TITULO_DIMENSIONES}", ($htmlTI), $html);
                $html = str_replace("{LISTADO_DIMENSIONES}", ($row), $html);
                $html = str_replace("{SOBRETITULO}", $cuenta_respuestas, $html);
                $datos_decurso = Datos_curso($id_curso);
                $html = str_replace("{NOMBRECURSO}", $datos_decurso[0]->nombre, $html);
                $html = str_replace("{CODIGOIMPARTICION}", $datos_decurso[0]->id, $html);
                $html = str_replace("{FECHAIMPARTICION}", $datos_decurso[0]->fecha_inicio, $html);
                if ($excel == 1) {
                    $PRINCIPAL = utf8_encode($html);
                } else {
                    $PRINCIPAL = str_replace("{BLOQUE_ENCUESTA_SATISFACCION}", utf8_encode($html), $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function Lms_reporte_MuestraInformeDimEncNota($PRINCIPAL, $id_empresa, $arreglo_objetos, $criterio, $valor, $excel, $arreglo_post)
            {
                //arreglo de encuestas
                $enc_template = busca_enc_satis_template_admin($id_empresa);
                $primer_arreglo_objeto = $arreglo_objetos[0]->id;
                $id_encuesta = Lms_busca_encuesta_dada_objeto($primer_arreglo_objeto, $id_empresa);
                $dimensiones_por_encuesta = ENC_TraigoDimensionesPorEncuesta($id_empresa, $id_encuesta[0]->id_encuesta);
                $id_curso = $arreglo_objetos[0]->id_curso;
                //echo "<br>";
                //print_r($id_encuesta);
                //echo "<br>";
                //print_r($dimensiones_por_encuesta);
                $cuenta_encuestas = ENC_CuentaParticipantesPorEncuesta($id_empresa, $arreglo_objetos[0]->id, $id_encuesta[0]->id_encuesta, $arreglo_post, $arreglo_objetos);
                $cuenta_respuestas = count($cuenta_encuestas);
                //echo "cuenta_respuestas $cuenta_respuestas";
                if ($excel == 1) {
                    $html .= file_get_contents("views/reportes/enc_satisfaccion/informe_entorno_enc_informe_excel.html");
                } else {
                    $html .= file_get_contents("views/reportes/enc_satisfaccion/informe_entorno_enc_informe.html");
                }
                $arreglo_post_objeto = $arreglo_objetos;
                $array_para_enviar_via_url_objetos = serialize($arreglo_post_objeto);
                $array_para_enviar_via_url_objetos = urlencode($array_para_enviar_via_url_objetos);
                $html = str_replace("{ARREGLO_OBJETO}", $array_para_enviar_via_url_objetos, $html);
                $html = str_replace("{VALOR}", $valor, $html);
                $acumulador_notas = 0;
                $acumulador_1 = 0;
                $acumulador_2 = 0;
                $acamulador_3 = 0;
                $acumulador_4 = 0;
                $acumulador_5 = 0;
                $acumulador_6 = 0;
                $acumulador_7 = 0;
                foreach ($dimensiones_por_encuesta as $dimen) {
                    //$num_opciones_encuestas=num_opc_encues_dim()
                    $cuentaOpciones = CuentaOpcionesEncSat($id_empresa, $dimen->iddimension);
                    //echo "<br>".$cuentaOpciones[0]->cuenta;
                    if ($excel == 1) {
                    } else {
                        $row = str_replace("{GRAFICO}", file_get_contents("views/reportes/enc_satisfaccion/informe_enc_grafico_" . $enc_template[0]->template_admin . ".html"), $row);
                    }
                    $row = str_replace("{CODIGO_GRAFICO}", ($dimen->iddimension), $row);
                    $row = str_replace("{NOMBRE_DIMENSION}", ($dimen->dimension), $row);
                    //Por cada dimension traigo las preguntas
                    $preguntas_por_dimension = ENC_TraigoPreguntaDadaDimenion($dimen->iddimension);
                    $acumulador_cuenta1 = 0;
                    $acumulador_cuenta2 = 0;
                    $acumulador_cuenta3 = 0;
                    $acumulador_cuenta4 = 0;
                    $acumulador_cuenta5 = 0;
                    $acumulador_cuenta6 = 0;
                    $acumulador_cuenta7 = 0;
                    $acumulador_cuenta = 0;
                    //busca rangos
                    //print_r($preguntas_por_dimension);
                    foreach ($preguntas_por_dimension as $preg) {
                        $promedio_por_preg = ENC_CuentaDeRespuestasPorPregunta_7opciones_CriterioCH($id_empresa, $id_encuesta[0]->id_encuesta, $preg->idpregunta, $arreglo_objetos, $criterio);
                        //print_r($promedio_por_preg);
                        //exit();
                        $acumulador_notas = $acumulador_notas + $promedio_por_preg[0]->promedio_pregunta;
                        ++$numpreg;
                        $acumulador_cuenta1 = $promedio_por_preg[0]->cuenta1 + $acumulador_cuenta1;
                        $acumulador_cuenta2 = $promedio_por_preg[0]->cuenta2 + $acumulador_cuenta2;
                        $acumulador_cuenta3 = $promedio_por_preg[0]->cuenta3 + $acumulador_cuenta3;
                        $acumulador_cuenta4 = $promedio_por_preg[0]->cuenta4 + $acumulador_cuenta4;
                        $acumulador_cuenta5 = $promedio_por_preg[0]->cuenta5 + $acumulador_cuenta5;
                        $acumulador_cuenta6 = $promedio_por_preg[0]->cuenta6 + $acumulador_cuenta6;
                        $acumulador_cuenta7 = $promedio_por_preg[0]->cuenta7 + $acumulador_cuenta7;
                    }
                    $acumulador_cuenta = $acumulador_cuenta1 + $acumulador_cuenta2 + $acumulador_cuenta3 + $acumulador_cuenta4 + $acumulador_cuenta5 + $acumulador_cuenta6 + $acumulador_cuenta7;
                    //echo "<br>$acumulador_cuenta1 /$acumulador_cuenta";
                    //echo "<br>$acumulador_cuenta7 /$acumulador_cuenta";
                    $promedio_enc_sat[0] = round(100 * $acumulador_cuenta1 / $acumulador_cuenta, 1);
                    $promedio_enc_sat[1] = round(100 * $acumulador_cuenta2 / $acumulador_cuenta, 1);
                    $promedio_enc_sat[2] = round(100 * $acumulador_cuenta3 / $acumulador_cuenta, 1);
                    $promedio_enc_sat[3] = round(100 * $acumulador_cuenta4 / $acumulador_cuenta, 1);
                    $promedio_enc_sat[4] = round(100 * $acumulador_cuenta5 / $acumulador_cuenta, 1);
                    $promedio_enc_sat[5] = round(100 * $acumulador_cuenta6 / $acumulador_cuenta, 1);
                    $promedio_enc_sat[6] = round(100 * $acumulador_cuenta7 / $acumulador_cuenta, 1);
                    $row = str_replace("{CUENTA1}", ($promedio_enc_sat[0]), $row);
                    $row = str_replace("{CUENTA2}", ($promedio_enc_sat[1]), $row);
                    $row = str_replace("{CUENTA3}", ($promedio_enc_sat[2]), $row);
                    $row = str_replace("{CUENTA4}", ($promedio_enc_sat[3]), $row);
                    $row = str_replace("{CUENTA5}", ($promedio_enc_sat[4]), $row);
                    $row = str_replace("{CUENTA6}", ($promedio_enc_sat[5]), $row);
                    $row = str_replace("{CUENTA7}", ($promedio_enc_sat[6]), $row);
                    //NOTA
                    $nota = round(($promedio_enc_sat[0] * 1 + $promedio_enc_sat[1] * 2 + $promedio_enc_sat[2] * 3 + $promedio_enc_sat[3] * 4 + $promedio_enc_sat[4] * 5 + $promedio_enc_sat[5] * 6 + $promedio_enc_sat[6] * 7) / 100, 1);
                    $cuentaOpciones = CuentaOpcionesEncSat($id_empresa, $dimen->iddimension);
                    if ($excel == 1) {
                        $template_row = file_get_contents("views/reportes/enc_satisfaccion/informe_row_dimension_nota_excel.html");
                    } else {
                        $template_row = file_get_contents("views/reportes/enc_satisfaccion/informe_row_dimension_nota.html");
                    }
                    $row .= $template_row;
                    $row = str_replace("{PROMEDIO}", ($nota), $row);
                    $acumulador_notas = $acumulador_notas + $nota;
                    $contador_nota++;
                    $row = str_replace("{NOMBRE_DIMENSION}", ($dimen->dimension), $row);
                    $row = str_replace("{CUENTAR}", round($promedio_enc_sat[0] + $promedio_enc_sat[1] + $promedio_enc_sat[2] + $promedio_enc_sat[3] + $promedio_enc_sat[4], 2), $row);
                    $row = str_replace("{CUENTAV}", round($promedio_enc_sat[5] + $promedio_enc_sat[6] + $promedio_enc_sat[7], 2), $row);
                }
                $html = str_replace("{TITULO_DIMENSIONES}", ($htmlTI), $html);
                $html = str_replace("{PROMEDIO_NOTAS}", round(($acumulador_notas / $contador_nota), 1), $html);
                $PRINCIPAL = str_replace("{PROMEDIO_NOTAS_VISTA_IMPARTICION}", round(($acumulador_notas / $contador_nota), 1), $PRINCIPAL);
                $html = str_replace("{LISTADO_DIMENSIONES}", ($row), $html);
                $html = str_replace("{SOBRETITULO}", $cuenta_respuestas, $html);
                $datos_decurso = Datos_curso($id_curso);
                $html = str_replace("{NOMBRECURSO}", $datos_decurso[0]->nombre, $html);
                $html = str_replace("{CODIGOIMPARTICION}", $datos_decurso[0]->id, $html);
                $html = str_replace("{FECHAIMPARTICION}", $datos_decurso[0]->fecha_inicio, $html);
                if ($excel == 1) {
                    $PRINCIPAL = utf8_encode($html);
                } else {
                    $PRINCIPAL = str_replace("{BLOQUE_ENCUESTA_SATISFACCION_NOTA}", utf8_encode($html), $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function Lms_reporte_MuestraInformeDimEncNotaDadoInscripcion($id_inscripcion, $id_empresa, $rows)
            {
                $arreglo_inicial_enc_sat = BuscadatosEncuestaSat($id_empresa, $id_inscripcion);
                $dimensiones_por_encuesta = ENCSat_TraigoDimensionesPorEncuesta($id_empresa, $arreglo_inicial_enc_sat[0]->id_encuesta);
                $cuenta_encuestas = ENCSat_CuentaParticipantesPorEncuesta($id_empresa, $id_inscripcion);
                $cuenta_respuestas = count($cuenta_encuestas);
                foreach ($dimensiones_por_encuesta as $dimen) {
                    $cuentaOpciones = CuentaOpcionesEncSat($id_empresa, $dimen->iddimension);
                    //echo "<br>cuenta opciones<br>";
                    //e//cho "<br>".$dimen->iddimension;
                    //print_r($cuentaOpciones);
                    //echo "<br>";
                    $preguntas_por_dimension = ENC_TraigoPreguntaDadaDimenion($dimen->iddimension);
                    //echo "<br>...dim $dimen->iddimension";
                    $Arreglo_respuestasDim = ENCSat_CuentaDeRespuestasPorDimension($id_empresa, $id_inscripcion, $dimen->iddimension);
//int_r($Arreglo_respuestasDim);
                    $nota = $Arreglo_respuestasDim[0]->Datonota;
                    $porcentaje = $Arreglo_respuestasDim[0]->Datoporcentaje;
                    $nombre_dimension = $Arreglo_respuestasDim[0]->Dimension;
//echo "$nombre_dimension: $nota<br>";
                    if ($nota <> "0" and $nota <> "") {
                        $dimension .= "$nombre_dimension: $nota<br>";
                    }
                    if ($nota <> "0" and $nota <> "") {
                        $sumNota = $nota + $sumNota;
                        $sumPorcentaje = $porcentaje + $sumPorcentaje;
                        $cuenta++;
                        //echo "<br>$nombre_dimension: $nota sumNota $cuenta";
                        $arregloDim[$cuenta] = $nota;
                    }
                }
                $nota_fnal = round($sumNota / $cuenta, 1);
                $porcentaje_fnal = round($sumPorcentaje / $cuenta);
//echo "<br><br>nota final ".$nota_fnal." $sumNota /$cuenta porcejtanej final ".$porcentaje_fnal;
                for ($i = 1; $i <= 10; $i++) {
                    $rows = str_replace("{DIM" . $i . "}", $arregloDim[$i], $rows);
                }
//vista por Inscrito
                $cuenta_encuestas_usuarios_detalle = ENCSat_CuentaParticipantesPorEncuestaRut($id_empresa, $id_inscripcion);
                $detalle_usuario .= "<br><tr></tr><tr><td>Detalle por Colaborador</td>";
                $detalle_usuario .= "<td>RUT</td>";
                $detalle_usuario .= "<td>NOMBRE</td>";
                $detalle_usuario .= "<td>CARGO</td>";
                $detalle_usuario .= "<td>GERENCIA</td>";
                $detalle_usuario .= "<td>DIMENSION</td>";
                $detalle_usuario .= "<td>PREGUNTA</td>";
                $detalle_usuario .= "<td>RESPUESTA</td>";
                foreach ($cuenta_encuestas_usuarios_detalle as $cuenta_encuesta_usuario_detalle) {
                    //echo "<br>";
                    //print_r($cuenta_encuesta_usuario_detalle);
                    $detalle_usuario .= "<br><tr>";
                    $detalle_usuario .= "<td>" . $cuenta_encuesta_usuario_detalle->rut_completo . "</td>";
                    $detalle_usuario .= "<td>" . $cuenta_encuesta_usuario_detalle->nombre_completo . "</td>";
                    $detalle_usuario .= "<td>" . $cuenta_encuesta_usuario_detalle->cargo . "</td>";
                    $detalle_usuario .= "<td>" . $cuenta_encuesta_usuario_detalle->gerencia . "</td>";
                    $detalle_usuario .= "<td>" . $cuenta_encuesta_usuario_detalle->dimension . " " . $cuenta_encuesta_usuario_detalle->relator . "</td>";
                    $detalle_usuario .= "<td>" . $cuenta_encuesta_usuario_detalle->pregunta . "</td>";
                    $detalle_usuario .= "<td>" . $cuenta_encuesta_usuario_detalle->respuesta . "</td>";
                    // $linea_usuario.="nombre_completo";
                }
                $rows = str_replace("{DIMENSIONES}", $dimension, $rows);
                $rows = str_replace("{RESPUESTASUSUARIO}", $detalle_usuario, $rows);
                $rows = str_replace("{LITERALES}", $detalle_usuario, $rows);
                $rows = str_replace("{PROMEDIO_NOTAS_VISTA_IMPARTICION}", ROUND($nota_fnal, 1), $rows);
                return ($rows);
            }

            function Lms_reporte_MuestraInformeEncPregunta($PRINCIPAL, $id_empresa, $arreglo_objetos, $criterio, $valor, $excel, $relator, $id_encuesta_relator, $arreglo_post)
            {
                $enc_template = busca_enc_satis_template_admin($id_empresa);
                $primer_arreglo_objeto = $arreglo_objetos[0]->id;
                $id_encuesta = Lms_busca_encuesta_dada_objeto($primer_arreglo_objeto, $id_empresa);
                $dimensiones_por_encuesta = ENC_TraigoDimensionesPorEncuesta($id_empresa, $id_encuesta[0]->id_encuesta);
                $id_curso = $arreglo_objetos[0]->id_curso;
                //print_r($id_encuesta);
                //print_r($dimensiones_por_encuesta);
                $cuenta_encuestas = ENC_CuentaParticipantesPorEncuesta($id_empresa, $arreglo_objetos[0]->id, $id_encuesta[0]->id_encuesta, $arreglo_post, $arreglo_objetos);
                $cuenta_respuestas = count($cuenta_encuestas);
                //echo "cuenta_respuestas $cuenta_respuestas";
                //print_r($cuenta_encuestas);
                if ($excel == 1) {
                    $html .= file_get_contents("views/reportes/enc_satisfaccion/informe_entorno_enc_informe_preg_excel.html");
                } else {
                    $html .= file_get_contents("views/reportes/enc_satisfaccion/informe_entorno_enc_informe_preg.html");
                }
                $arreglo_post_objeto = $arreglo_objetos;
                $array_para_enviar_via_url_objetos = serialize($arreglo_post_objeto);
                $array_para_enviar_via_url_objetos = urlencode($array_para_enviar_via_url_objetos);
                $html = str_replace("{ARREGLO_OBJETO}", $array_para_enviar_via_url_objetos, $html);
                $html = str_replace("{VALOR}", $valor, $html);
                //print_r($dimensiones_por_encuesta);
                foreach ($dimensiones_por_encuesta as $dimen) {
                    $cuentaOpciones = CuentaOpcionesEncSat($id_empresa, $dimen->iddimension);
                    $preguntas_por_dimension = ENC_TraigoPreguntaDadaDimenion($dimen->iddimension);
                    if ($excel == 1) {
                        //$htmlTi=file_get_contents("views/reportes/enc_satisfaccion/informe_titulo_".$cuentaOpciones[0]->cuenta."dim_excel.html");
                    } else {
                        //$htmlTi=file_get_contents("views/reportes/enc_satisfaccion/informe_titulo_".$cuentaOpciones[0]->cuenta."dim.html");
                    }
                    $acumulador_cuenta1 = 0;
                    $acumulador_cuenta2 = 0;
                    $acumulador_cuenta3 = 0;
                    $acumulador_cuenta4 = 0;
                    $acumulador_cuenta5 = 0;
                    $acumulador_cuenta6 = 0;
                    $acumulador_cuenta7 = 0;
                    $acumulador_cuenta = 0;
                    //busca rangos
                    //print_r($preguntas_por_dimension);
                    foreach ($preguntas_por_dimension as $preg) {
                        $promedio_por_preg = ENC_CuentaDeRespuestasPorPregunta_7opciones_CriterioCH($id_empresa, $id_encuesta[0]->id_encuesta, $preg->idpregunta, $arreglo_objetos, $criterio);
                        //print_r($promedio_por_preg);
                        //exit();
                        $acumulador_notas = $acumulador_notas + $promedio_por_preg[0]->promedio_pregunta;
                        ++$numpreg;
                        $acumulador_cuenta1 = $promedio_por_preg[0]->cuenta1;
                        $acumulador_cuenta2 = $promedio_por_preg[0]->cuenta2;
                        $acumulador_cuenta3 = $promedio_por_preg[0]->cuenta3;
                        $acumulador_cuenta4 = $promedio_por_preg[0]->cuenta4;
                        $acumulador_cuenta5 = $promedio_por_preg[0]->cuenta5;
                        $acumulador_cuenta6 = $promedio_por_preg[0]->cuenta6;
                        $acumulador_cuenta7 = $promedio_por_preg[0]->cuenta7;
                        $acumulador_cuenta = $promedio_por_preg[0]->cuentaPreg;
                        //    echo "<br>$acumulador_cuenta7 $acumulador_cuenta";
                        //PORCENTAJE
                        $promedio_enc_sat[0] = round(100 * $acumulador_cuenta1 / $acumulador_cuenta, 1);
                        $promedio_enc_sat[1] = round(100 * $acumulador_cuenta2 / $acumulador_cuenta, 1);
                        $promedio_enc_sat[2] = round(100 * $acumulador_cuenta3 / $acumulador_cuenta, 1);
                        $promedio_enc_sat[3] = round(100 * $acumulador_cuenta4 / $acumulador_cuenta, 1);
                        $promedio_enc_sat[4] = round(100 * $acumulador_cuenta5 / $acumulador_cuenta, 1);
                        $promedio_enc_sat[5] = round(100 * $acumulador_cuenta6 / $acumulador_cuenta, 1);
                        $promedio_enc_sat[6] = round(100 * $acumulador_cuenta7 / $acumulador_cuenta, 1);
                        //NOTA
                        $nota = round(($promedio_enc_sat[0] * 1 + $promedio_enc_sat[1] * 2 + $promedio_enc_sat[2] * 3 + $promedio_enc_sat[3] * 4 + $promedio_enc_sat[4] * 5 + $promedio_enc_sat[5] * 6 + $promedio_enc_sat[6] * 7) / 100, 1);
                        $cuentaOpciones = CuentaOpcionesEncSat($id_empresa, $dimen->iddimension);
                        if ($excel == 1) {
                            $template_row = file_get_contents("views/reportes/enc_satisfaccion/informe_row_pregunta_" . $cuentaOpciones[0]->cuenta . "dim_excel.html");
                        } else {
                            $template_row = file_get_contents("views/reportes/enc_satisfaccion/informe_row_pregunta_" . $cuentaOpciones[0]->cuenta . "dim.html");
                        }
                        $row .= $template_row;
                        if ($excel == 1) {
                        } else {
                            $row = str_replace("{GRAFICO}", file_get_contents("views/reportes/enc_satisfaccion/informe_enc_grafico_" . $enc_template[0]->template_admin . ".html"), $row);
                        }
                        $row = str_replace("{CODIGO_GRAFICO}", ($preg->iddimension), $row);
                        $row = str_replace("{NOMBRE_PREGUNTA}", ($preg->pregunta), $row);
                        //Por cada dimension traigo las preguntas
                        $row = str_replace("{CUENTA1}", ($promedio_enc_sat[0]), $row);
                        $row = str_replace("{CUENTA2}", ($promedio_enc_sat[1]), $row);
                        $row = str_replace("{CUENTA3}", ($promedio_enc_sat[2]), $row);
                        $row = str_replace("{CUENTA4}", ($promedio_enc_sat[3]), $row);
                        $row = str_replace("{CUENTA5}", ($promedio_enc_sat[4]), $row);
                        $row = str_replace("{CUENTA6}", ($promedio_enc_sat[5]), $row);
                        $row = str_replace("{CUENTA7}", ($promedio_enc_sat[6]), $row);
                        $row = str_replace("{PROMEDIO}", ($nota), $row);
                    }
                    $promedio = $promedio_enc_sat[0] * 1 + $promedio_enc_sat[1] * 2 + $promedio_enc_sat[2] * 3 + $promedio_enc_sat[3] * 4 + $promedio_enc_sat[4] * 5 + $promedio_enc_sat[5] * 6 + $promedio_enc_sat[6] * 7;
                    $row = str_replace("{PROMEDIO}", ($promedio / 100), $row);
                    $row = str_replace("{CUENTAR}", round($promedio_enc_sat[0] + $promedio_enc_sat[1] + $promedio_enc_sat[2] + $promedio_enc_sat[3] + $promedio_enc_sat[4], 2), $row);
                    $row = str_replace("{CUENTAV}", round($promedio_enc_sat[5] + $promedio_enc_sat[6] + $promedio_enc_sat[7], 2), $row);
                }
                $html = str_replace("{TITULO_PREGUNTAS}", ($htmlTi), $html);
                $html = str_replace("{LISTADO_PREGUNTAS}", ($row), $html);
                $html = str_replace("{SOBRETITULO}", $cuenta_respuestas, $html);
                $datos_decurso = Datos_curso($id_curso);
                $html = str_replace("{NOMBRECURSO}", $datos_decurso[0]->nombre, $html);
                $html = str_replace("{CODIGOIMPARTICION}", $datos_decurso[0]->id, $html);
                $html = str_replace("{FECHAIMPARTICION}", $datos_decurso[0]->fecha_inicio, $html);
                if ($excel == 1) {
                    $PRINCIPAL = utf8_encode($html);
                } else {
                    $PRINCIPAL = str_replace("{BLOQUE_ENCUESTA_SATISFACCION_PREGUNTA}", utf8_encode($html), $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function Lms_reporte_MuestraInformeEncPreguntaNota($PRINCIPAL, $id_empresa, $arreglo_objetos, $criterio, $valor, $excel, $arreglo_post)
            {
                //echo "aca";
                //print_r($excel);
                $enc_template = busca_enc_satis_template_admin($id_empresa);
                $primer_arreglo_objeto = $arreglo_objetos[0]->id;
                $id_encuesta = Lms_busca_encuesta_dada_objeto($primer_arreglo_objeto, $id_empresa);
                $dimensiones_por_encuesta = ENC_TraigoDimensionesPorEncuesta($id_empresa, $id_encuesta[0]->id_encuesta);
                $id_curso = $arreglo_objetos[0]->id_curso;
                //print_r($id_encuesta);
                //print_r($dimensiones_por_encuesta);
                $cuenta_encuestas = ENC_CuentaParticipantesPorEncuesta($id_empresa, $arreglo_objetos[0]->id, $id_encuesta[0]->id_encuesta, $arreglo_post, $arreglo_objetos);
                $cuenta_respuestas = count($cuenta_encuestas);
                //echo "cuenta_respuestas $cuenta_respuestas";
                //print_r($cuenta_encuestas);
                if ($excel == 1) {
                    $html .= file_get_contents("views/reportes/enc_satisfaccion/informe_entorno_enc_informe_preg_excel.html");
                } else {
                    $html .= file_get_contents("views/reportes/enc_satisfaccion/informe_entorno_enc_informe_preg.html");
                }
                $arreglo_post_objeto = $arreglo_objetos;
                $array_para_enviar_via_url_objetos = serialize($arreglo_post_objeto);
                $array_para_enviar_via_url_objetos = urlencode($array_para_enviar_via_url_objetos);
                $html = str_replace("{ARREGLO_OBJETO}", $array_para_enviar_via_url_objetos, $html);
                $html = str_replace("{VALOR}", $valor, $html);
                //print_r($dimensiones_por_encuesta);
                foreach ($dimensiones_por_encuesta as $dimen) {
                    $cuentaOpciones = CuentaOpcionesEncSat($id_empresa, $dimen->iddimension);
                    $preguntas_por_dimension = ENC_TraigoPreguntaDadaDimenion($dimen->iddimension);
                    $acumulador_cuenta1 = 0;
                    $acumulador_cuenta2 = 0;
                    $acumulador_cuenta3 = 0;
                    $acumulador_cuenta4 = 0;
                    $acumulador_cuenta5 = 0;
                    $acumulador_cuenta6 = 0;
                    $acumulador_cuenta7 = 0;
                    $acumulador_cuenta = 0;
                    //busca rangos
                    //print_r($preguntas_por_dimension);
                    foreach ($preguntas_por_dimension as $preg) {
                        $promedio_por_preg = ENC_CuentaDeRespuestasPorPregunta_7opciones_CriterioCH($id_empresa, $id_encuesta[0]->id_encuesta, $preg->idpregunta, $arreglo_objetos, $criterio);
                        //print_r($promedio_por_preg);
                        //exit();
                        $acumulador_notas = $acumulador_notas + $promedio_por_preg[0]->promedio_pregunta;
                        ++$numpreg;
                        $acumulador_cuenta1 = $promedio_por_preg[0]->cuenta1;
                        $acumulador_cuenta2 = $promedio_por_preg[0]->cuenta2;
                        $acumulador_cuenta3 = $promedio_por_preg[0]->cuenta3;
                        $acumulador_cuenta4 = $promedio_por_preg[0]->cuenta4;
                        $acumulador_cuenta5 = $promedio_por_preg[0]->cuenta5;
                        $acumulador_cuenta6 = $promedio_por_preg[0]->cuenta6;
                        $acumulador_cuenta7 = $promedio_por_preg[0]->cuenta7;
                        $acumulador_cuenta = $promedio_por_preg[0]->cuentaPreg;
                        //    echo "<br>$acumulador_cuenta7 $acumulador_cuenta";
                        //PORCENTAJE
                        $promedio_enc_sat[0] = round(100 * $acumulador_cuenta1 / $acumulador_cuenta, 1);
                        $promedio_enc_sat[1] = round(100 * $acumulador_cuenta2 / $acumulador_cuenta, 1);
                        $promedio_enc_sat[2] = round(100 * $acumulador_cuenta3 / $acumulador_cuenta, 1);
                        $promedio_enc_sat[3] = round(100 * $acumulador_cuenta4 / $acumulador_cuenta, 1);
                        $promedio_enc_sat[4] = round(100 * $acumulador_cuenta5 / $acumulador_cuenta, 1);
                        $promedio_enc_sat[5] = round(100 * $acumulador_cuenta6 / $acumulador_cuenta, 1);
                        $promedio_enc_sat[6] = round(100 * $acumulador_cuenta7 / $acumulador_cuenta, 1);
                        //NOTA
                        $nota = round(($promedio_enc_sat[0] * 1 + $promedio_enc_sat[1] * 2 + $promedio_enc_sat[2] * 3 + $promedio_enc_sat[3] * 4 + $promedio_enc_sat[4] * 5 + $promedio_enc_sat[5] * 6 + $promedio_enc_sat[6] * 7) / 100, 1);
                        $cuentaOpciones = CuentaOpcionesEncSat($id_empresa, $dimen->iddimension);
                        if ($excel == 1) {
                            $template_row = file_get_contents("views/reportes/enc_satisfaccion/informe_row_pregunta_nota_excel.html");
                        } else {
                            $template_row = file_get_contents("views/reportes/enc_satisfaccion/informe_row_pregunta_nota.html");
                        }
                        $row .= $template_row;
                        if ($excel == 1) {
                        } else {
                            $row = str_replace("{GRAFICO}", file_get_contents("views/reportes/enc_satisfaccion/informe_enc_grafico_" . $enc_template[0]->template_admin . ".html"), $row);
                        }
                        $row = str_replace("{CODIGO_GRAFICO}", ($preg->iddimension), $row);
                        $row = str_replace("{NOMBRE_PREGUNTA}", ($preg->pregunta), $row);
                        //Por cada dimension traigo las preguntas
                        $row = str_replace("{CUENTA1}", ($promedio_enc_sat[0]), $row);
                        $row = str_replace("{CUENTA2}", ($promedio_enc_sat[1]), $row);
                        $row = str_replace("{CUENTA3}", ($promedio_enc_sat[2]), $row);
                        $row = str_replace("{CUENTA4}", ($promedio_enc_sat[3]), $row);
                        $row = str_replace("{CUENTA5}", ($promedio_enc_sat[4]), $row);
                        $row = str_replace("{CUENTA6}", ($promedio_enc_sat[5]), $row);
                        $row = str_replace("{CUENTA7}", ($promedio_enc_sat[6]), $row);
                        $row = str_replace("{PROMEDIO}", ($nota), $row);
                    }
                    $promedio = $promedio_enc_sat[0] * 1 + $promedio_enc_sat[1] * 2 + $promedio_enc_sat[2] * 3 + $promedio_enc_sat[3] * 4 + $promedio_enc_sat[4] * 5 + $promedio_enc_sat[5] * 6 + $promedio_enc_sat[6] * 7;
                    $row = str_replace("{CUENTAR}", round($promedio_enc_sat[0] + $promedio_enc_sat[1] + $promedio_enc_sat[2] + $promedio_enc_sat[3] + $promedio_enc_sat[4], 2), $row);
                    $row = str_replace("{CUENTAV}", round($promedio_enc_sat[5] + $promedio_enc_sat[6] + $promedio_enc_sat[7], 2), $row);
                }
                $html = str_replace("{TITULO_PREGUNTAS}", ($htmlTi), $html);
                $html = str_replace("{LISTADO_PREGUNTAS}", ($row), $html);
                $html = str_replace("{SOBRETITULO}", $cuenta_respuestas, $html);
                $datos_decurso = Datos_curso($id_curso);
                $html = str_replace("{NOMBRECURSO}", $datos_decurso[0]->nombre, $html);
                $html = str_replace("{CODIGOIMPARTICION}", $datos_decurso[0]->id, $html);
                $html = str_replace("{FECHAIMPARTICION}", $datos_decurso[0]->fecha_inicio, $html);
                if ($excel == 1) {
                    $PRINCIPAL = utf8_encode($html);
                } else {
                    $PRINCIPAL = str_replace("{BLOQUE_ENCUESTA_SATISFACCION_PREGUNTA_NOTA}", utf8_encode($html), $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function Lms_reporte_MuestraInformeEncPromedio($PRINCIPAL, $id_empresa, $arreglo_objetos, $criterio, $valor, $excel)
            {
                $enc_template = busca_enc_satis_template_admin($id_empresa);
                $primer_arreglo_objeto = $arreglo_objetos[0]->id;
                $id_encuesta = Lms_busca_encuesta_dada_objeto($primer_arreglo_objeto, $id_empresa);
                $dimensiones_por_encuesta = ENC_TraigoDimensionesPorEncuesta($id_empresa, $id_encuesta[0]->id_encuesta);
                $cuenta_encuestas = ENC_CuentaParticipantesPorEncuesta($id_empresa, $arreglo_objetos[0]->id, $id_encuesta[0]->id_encuesta);
                $cuenta_respuestas = count($cuenta_encuestas);
                $html .= file_get_contents("views/reportes/enc_satisfaccion/informe_entorno_enc_informe_prom.html");
                echo $enc_template[0]->template_admin;
                foreach ($dimensiones_por_encuesta as $dimen) {
                    $row .= file_get_contents("views/reportes/enc_satisfaccion/informe_row_dimension_" . $enc_template[0]->template_admin . "_prom.html");
                    $row = str_replace("{GRAFICO}", file_get_contents("views/reportes/enc_satisfaccion/informe_enc_grafico_" . $enc_template[0]->template_admin . "_prom.html"), $row);
                    $row = str_replace("{CODIGO_GRAFICO}", ($dimen->iddimension), $row);
                    $row = str_replace("{NOMBRE_DIMENSION}", ($dimen->dimension), $row);
                    $preguntas_por_dimension = ENC_TraigoPreguntaDadaDimenion($dimen->iddimension);
                    foreach ($preguntas_por_dimension as $preg) {
                        $promedio_por_preg = ENC_CuentaDeRespuestasPorPregunta_7opciones_Promedio($id_empresa, $id_encuesta[0]->id_encuesta, $preg->idpregunta, $arreglo_objetos, $criterio);
                    }
                    $row = str_replace("{PROMEDIO}", round($promedio_por_preg[0]->promedio, 1), $row);
                }
                $html = str_replace("{LISTADO_DIMENSIONES}", ($row), $html);
                $html = str_replace("{SOBRETITULO}", $cuenta_respuestas, $html);
                $PRINCIPAL = str_replace("{BLOQUE_ENCUESTA_SATISFACCION_PROMEDIO}", utf8_encode($html), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function Lms_reporte_MuestraInformeEncLiterales($PRINCIPAL, $id_empresa, $arreglo_objetos, $criterio, $valor, $excel)
            {
                $enc_template = busca_enc_satis_template_admin($id_empresa);
                $primer_arreglo_objeto = $arreglo_objetos[0]->id;
                $id_encuesta = Lms_busca_encuesta_dada_objeto($primer_arreglo_objeto, $id_empresa);
                $datos_empresa = DatosEmpresa($id_empresa);
                $literales_por_encuestas = ENC_TraigoLiteralesPorEncuesta($id_empresa, $arreglo_objetos[0]->id, $id_encuesta[0]->id_encuesta, $datos_empresa);
                if ($excel == 1) {
                    $html .= file_get_contents("views/reportes/enc_satisfaccion/informe_entorno_enc_informe_literales_excel.html");
                    $row_html = file_get_contents("views/reportes/enc_satisfaccion/informe_row_literal_excel.html");
                    $html = str_replace("{C1}", $datos_empresa[0]->campo1, $html);
                    $html = str_replace("{C2}", $datos_empresa[0]->campo2, $html);
                    $html = str_replace("{C3}", $datos_empresa[0]->campo3, $html);
                } else {
                    $html .= file_get_contents("views/reportes/enc_satisfaccion/informe_entorno_enc_informe_literales.html");
                    $row_html = file_get_contents("views/reportes/enc_satisfaccion/informe_row_literal.html");
                    $arreglo_post_objeto = $arreglo_objetos;
                    $array_para_enviar_via_url_objetos = serialize($arreglo_post_objeto);
                    $array_para_enviar_via_url_objetos = urlencode($array_para_enviar_via_url_objetos);
                    $html = str_replace("{ARREGLO_OBJETO}", $array_para_enviar_via_url_objetos, $html);
                    $html = str_replace("{VALOR}", $valor, $html);
                }
                foreach ($literales_por_encuestas as $literal_por_encuesta) {
                    //$row.=file_get_contents("views/reportes/enc_satisfaccion/informe_row_literal.html");
                    $row .= $row_html;
                    $row = str_replace("{LITERAL_TXT}", utf8_encode($literal_por_encuesta->comentario), $row);
                    $row = str_replace("{NOMBRE}", ($literal_por_encuesta->nombre_completo), $row);
                    $row = str_replace("{RUT}", ($literal_por_encuesta->rut_completo), $row);
                    $row = str_replace("{CARGO}", ($literal_por_encuesta->cargo), $row);
                    $row = str_replace("{VALOR_C1}", ($literal_por_encuesta->valor_c1), $row);
                    $row = str_replace("{VALOR_C2}", ($literal_por_encuesta->valor_c2), $row);
                    $row = str_replace("{VALOR_C3}", ($literal_por_encuesta->valor_c3), $row);
                }
                $html = str_replace("{LISTADO_LITERALES}", ($row), $html);
                $html = str_replace("{SOBRETITULO}", $cuenta_respuestas, $html);
                if ($excel == 1) {
                    $PRINCIPAL = utf8_encode($html);
                } else {
                    $PRINCIPAL = str_replace("{BLOQUE_ENCUESTA_SATISFACCION_LITERALES}", ($html), $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function Lms_reporte_Opiniones_Imparticion($PRINCIPAL, $id_empresa, $arreglo_objetos, $criterio, $valor, $excel)
            {
                //print_r($arreglo_objetos);
                $id_curso = $arreglo_objetos[0]->codigo_inscripcion;
                $enc_template = busca_enc_satis_template_admin($id_empresa);
                $primer_arreglo_objeto = $arreglo_objetos[0]->id;
                $id_encuesta = Lms_busca_encuesta_dada_objeto($primer_arreglo_objeto, $id_empresa);
                $opiniones_por_encuestas = ENC_TraigoOpinionesPorEncuesta($id_empresa, $id_curso);
                $html .= file_get_contents("views/reportes/enc_satisfaccion/informe_entorno_enc_informe_opiniones.html");
                foreach ($opiniones_por_encuestas as $opinion) {
                    $row .= file_get_contents("views/reportes/enc_satisfaccion/informe_row_opiniones.html");
                    $row = str_replace("{OPINION}", ($opinion->comentario), $row);
                    $row = str_replace("{NOMBRE}", ($opinion->nombre), $row);
                    $row = str_replace("{CARGO}", ($opinion->cargo), $row);
                    $row = str_replace("{GERENCIA}", ($opinion->gerencia), $row);
                    $row = str_replace("{NUMEGUSTA}", ($opinion->nummegusta), $row);
                }
                $html = str_replace("{LISTADO_OPINIONES}", ($row), $html);
                $html = str_replace("{SOBRETITULO}", $cuenta_respuestas, $html);
                $PRINCIPAL = str_replace("{BLOQUE_ENCUESTA_OPINIONES}", utf8_encode($html), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function Lms_reporte_Fotos_Imparticion($PRINCIPAL, $id_empresa, $arreglo_objetos, $criterio, $valor, $excel)
            {
                $enc_template = busca_enc_satis_template_admin($id_empresa);
                $primer_arreglo_objeto = $arreglo_objetos[0]->id;
                $id_curso = $arreglo_objetos[0]->codigo_inscripcion;
                $id_encuesta = Lms_busca_encuesta_dada_objeto($primer_arreglo_objeto, $id_empresa);
                $fotos_por_encuestas = ENC_TraigoFotosPorEncuesta($id_empresa, $id_curso, $id_encuesta[0]->id_encuesta);
                $html .= file_get_contents("views/reportes/enc_satisfaccion/informe_entorno_enc_informe_fotos.html");
                foreach ($fotos_por_encuestas as $foto_por_encuesta) {
                    //print_r($foto_por_encuesta);
                    $row .= file_get_contents("views/reportes/enc_satisfaccion/informe_row_fotos.html");
                    $row = str_replace("{FOTO}", ($foto_por_encuesta->archivo), $row);
                    $row = str_replace("{NOMBRE}", ($foto_por_encuesta->nombre), $row);
                    $row = str_replace("{CARGO}", ($foto_por_encuesta->cargo), $row);
                    $row = str_replace("{GERENCIA}", ($foto_por_encuesta->gerencia), $row);
                    $row = str_replace("{NUMEGUSTA}", ($foto_por_encuesta->nummegusta), $row);
                }
                $html = str_replace("{LISTADO_FOTOS}", ($row), $html);
                $html = str_replace("{SOBRETITULO}", $cuenta_respuestas, $html);
                $PRINCIPAL = str_replace("{BLOQUE_ENCUESTA_FOTOS}", utf8_encode($html), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function Lms_reporte_PreguntasRelator_Imparticion($PRINCIPAL, $id_empresa, $arreglo_objetos, $criterio, $valor, $excel)
            {
                $enc_template = busca_enc_satis_template_admin($id_empresa);
                $primer_arreglo_objeto = $arreglo_objetos[0]->id;
                $id_curso = $arreglo_objetos[0]->codigo_inscripcion;
                $id_encuesta = Lms_busca_encuesta_dada_objeto($primer_arreglo_objeto, $id_empresa);
                $preguntas_por_encuestas = ENC_TraigoPreguntasPorEncuesta($id_empresa, $id_curso, $id_encuesta[0]->id_encuesta);
                $html .= file_get_contents("views/reportes/enc_satisfaccion/informe_entorno_enc_informe_preguntasrespuestas.html");
                foreach ($preguntas_por_encuestas as $pregunta_por_encuesta) {
                    //    print_r($pregunta_por_encuesta);
                    $row .= file_get_contents("views/reportes/enc_satisfaccion/informe_row_preguntarespuesta.html");
                    $row = str_replace("{PREGUNTA}", ($pregunta_por_encuesta->mensaje), $row);
                    $row = str_replace("{NOMBRE}", ($pregunta_por_encuesta->nombre), $row);
                    $row = str_replace("{CARGO}", ($pregunta_por_encuesta->cargo), $row);
                    $row = str_replace("{GERENCIA}", ($pregunta_por_encuesta->gerencia), $row);
                    $row = str_replace("{NUMEGUSTA}", ($pregunta_por_encuesta->nummegusta), $row);
                }
                $html = str_replace("{LISTADO_PREGUNTAS}", ($row), $html);
                $html = str_replace("{SOBRETITULO}", $cuenta_respuestas, $html);
                $PRINCIPAL = str_replace("{BLOQUE_ENCUESTA_PREGUNTARESPUESTA}", utf8_encode($html), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function Lms_reporte_MuestraInformeEncParticipantes($PRINCIPAL, $id_empresa, $arreglo_objetos, $arreglo_post, $valor, $excel)
            {
                //print_r($arreglo_objetos);
                //echo "<br>----<br>";
                $enc_template = busca_enc_satis_template_admin($id_empresa);
                //print_r($arreglo_post);
                //print_r($arreglo_objetos);
                //$id_curso=$arreglo_objetos[0]->id_curso;
                //$id_encuesta=Lms_busca_encuesta_dada_objeto($arreglo_objetos,$id_empresa);
                $participantes_encuesta = ENC_TraigoEncuestasFinalizadas($id_empresa, $arreglo_objetos);
                //$participantes_encuesta=ENC_TraigoEncuestasFinalizadasArregloPost($id_empresa, $arreglo_objetos);
                if ($excel == 1) {
                    $html .= file_get_contents("views/reportes/enc_satisfaccion/" . $id_empresa . "_informe_entorno_enc_informe_participantes_excel.html");
                } else {
                    $html .= file_get_contents("views/reportes/enc_satisfaccion/" . $id_empresa . "_informe_entorno_enc_informe_participantes.html");
                }
                $arreglo_post_objeto = $arreglo_objetos;
                $array_para_enviar_via_url_objetos = serialize($arreglo_post_objeto);
                $array_para_enviar_via_url_objetos = urlencode($array_para_enviar_via_url_objetos);
                $html = str_replace("{ARREGLO_OBJETO}", $array_para_enviar_via_url_objetos, $html);
                $array_para_enviar_via_url_post = serialize($arreglo_post);
                $array_para_enviar_via_url_post = urlencode($array_para_enviar_via_url_post);
                $html = str_replace("{ARREGLO_POST}", $array_para_enviar_via_url_post, $html);
                $html = str_replace("{VALOR}", $valor, $html);
                if ($excel == 1) {
                    $template_row = file_get_contents("views/reportes/enc_satisfaccion/" . $id_empresa . "_informe_row_dimension_participantes_excel.html");
                } else {
                    $template_row = file_get_contents("views/reportes/enc_satisfaccion/" . $id_empresa . "_informe_row_dimension_participantes.html");
                }
                foreach ($participantes_encuesta as $participante_encuesta) {
                    $row .= $template_row;
                    $verificaEncsatFinalizada = VerificaEncSatFinalizada($participante_encuesta->rut, $participante_encuesta->id_inscripcion, $id_empresa);
                    //    print_r($verificaEncsatFinalizada);
                    $verifica_CantidadCheckinVsSesionesImparticion = verifica_CantidadCheckinVsSesionesImparticion($participante_encuesta->rut, $participante_encuesta->id_inscripcion, $id_empresa);
                    //print_r($verifica_CantidadCheckinVsSesionesImparticion);
                    if ($verifica_CantidadCheckinVsSesionesImparticion[0]->sesiones > 0) {
                        $sesion = $verifica_CantidadCheckinVsSesionesImparticion[0]->sesiones;
                    } else {
                        $sesion = 1;
                    }
                    $checks = $verifica_CantidadCheckinVsSesionesImparticion[0]->cuentaCheck;
                    $datos_cierre = $existe_en_cierre = VerificaEnTablaCierreCursoEmpresRutInscripcion($participante_encuesta->id_curso, $participante_encuesta->rut, $id_empresa, $participante_encuesta->id_inscripcion);
                    //asistencia
                    //$asistencia=round(100*$checks/$sesion,1);
                    $asistencia = $datos_cierre[0]->porcentaje_asistencia;
                    if ($asistencia > 100) {
                        $asistencia = 100;
                    }
                    if ($asistencia == 100) {
                        $asistencia_estado = "Asistente";
                    } else if ($asistencia < 100 && $asistencia > 0) {
                        $asistencia_estado = "Asistencia Incompleta";
                    } else {
                        $asistencia_estado = "Inasistente";
                    }
                    $boton_envio_notificaciones = '<a href="?sw=listaEncuestasSatisfaccion&amp;idinscripcion=17414&amp;sendemail=1&amp;rut_individual=' . $participante_encuesta->rut . '" target="_blank" class="btn btn-warning btn-sm">Enviar Link de Encuesta</a>';
                    if ($verificaEncsatFinalizada[0]->id > 0) {
                        $enc_estado = '<span class="mt-action-dot progress-bar-success"></span>';
                        $row = str_replace("{ESTADO_TEXTO}", "Si", $row);
                        $row = str_replace("{BOTON_ENCUESTA}", "", $row);
                    } else {
                        $enc_estado = '<span class="mt-action-dot progress-bar-danger"></span>';
                        $row = str_replace("{ESTADO_TEXTO}", "No", $row);
                        $row = str_replace("{BOTON_ENCUESTA}", $boton_envio_notificaciones, $row);
                    }
                    /*if($checks>0){
                if($asistencia>=100){
                    $asistencia_estado="Asistencia";
                } else {
                    $asistencia_estado="Asistencia Incompleta";
                }
            }    else {
                    $asistencia_estado="Inasistente";
            }*/
                    $row = str_replace("{RUT_USUARIO_ENCODEADO}", Encodear3($participante_encuesta->rut), $row);
                    $row = str_replace("{ID_INSCRIPCION_ENCODEADA}", Encodear3($participante_encuesta->id_inscripcion), $row);
                    $datos_objeto_encuesta = DatosObjetoEncuestaPorImparticion($participante_encuesta->id_inscripcion);
                    $row = str_replace("{ID_OBJETO_ENCODEADO}", Encodear3($datos_objeto_encuesta[0]->id), $row);
                    $row = str_replace("{ID_ENCUESTA_ENCODEADA}", Encodear3($datos_objeto_encuesta[0]->id_encuesta), $row);
                    $row = str_replace("{RUT}", ($participante_encuesta->rut_completo), $row);
                    $row = str_replace("{RUT_SIN_DV}", ($participante_encuesta->rut), $row);
                    $row = str_replace("{NOMBRE}", ($participante_encuesta->nombre), $row);
                    $row = str_replace("{CARGO}", ($participante_encuesta->cargo), $row);
                    $row = str_replace("{C1}", ($participante_encuesta->c1), $row);
                    $row = str_replace("{C2}", ($participante_encuesta->c2), $row);
                    $row = str_replace("{C3}", ($participante_encuesta->c3), $row);
                    $row = str_replace("{ID_IMPARTICION}", ($participante_encuesta->id_inscripcion), $row);
                    $row = str_replace("{ESTADO}", ($enc_estado), $row);
                    if ($participante_encuesta->nota_cierre) {
                        $row = str_replace("{NOTA}", ($participante_encuesta->nota_cierre), $row);
                    } else {
                        $row = str_replace("{NOTA}", "-", $row);
                    }
                    $row = str_replace("{ESTADO_NOTA}", $participante_encuesta->estado_descripcion, $row);
                    if ($asistencia <> '') {
                        $asistencia = nunComas1Dec($asistencia) . "%";
                    }
                    $row = str_replace("{MEGUSTA}", ($participante_encuesta->gerencia), $row);
                    $row = str_replace("{INTERACCIONES}", ($participante_encuesta->gerencia), $row);
                    $row = str_replace("{PORCENTAJE_ASISTENCIA}", ($asistencia), $row);
                    $row = str_replace("{ESTADO_ASISTENCIA}", ($asistencia_estado), $row);
                    $url = $url_front . "/front/?sw=homeEncuesta&i={ID_OBJETO_ENCODEADO}&ienc={ID_ENCUESTA_ENCODEADA}&tt=2&idc=&ii={ID_INSCRIPCION_ENCODEADA}&r={RUT_USUARIO_ENCODEADO}&hl=1";
                    $url = str_replace("{ID_OBJETO_ENCODEADO}", Encodear3($datos_objeto_encuesta[0]->id), $url);
                    $url = str_replace("{ID_ENCUESTA_ENCODEADA}", Encodear3($datos_objeto_encuesta[0]->id_encuesta), $url);
                    $url = str_replace("{ID_INSCRIPCION_ENCODEADA}", Encodear3($participante_encuesta->id_inscripcion), $url);
                    $url = str_replace("{RUT_USUARIO_ENCODEADO}", Encodear3($participante_encuesta->rut), $url);
                    $row = str_replace("{URL_LINK}", $url, $row);
                    $num_envios_emails = check_usuario_envio_emails($participante_encuesta->rut, "Encuesta Satisfaccion", $participante_encuesta->id_inscripcion);
                    if ($num_envios_emails[0]->cuenta) {
                        $txtenvio_emails = "Emails enviados: " . $num_envios_emails[0]->cuenta;
                    } else {
                        $txtenvio_emails = "";
                    }
                    $row = str_replace("{ENVIOS_EMAILS}", $txtenvio_emails . "", $row);
                    // boton envio email
                    //Por cada dimension traigo las preguntas
                    $preguntas_por_dimension = ENC_TraigoPreguntaDadaDimenion($dimen->iddimension);
                    foreach ($preguntas_por_dimension as $preg) {
                        $promedio_por_preg = ENC_CuentaDeRespuestasPorPregunta_7opciones_Promedio($id_empresa, $id_encuesta[0]->id_encuesta, $preg->idpregunta, $arreglo_objetos, $criterio);
                    }
                    $row = str_replace("{LISTADO_PARTICIPANTES_ENC}", round($promedio_por_preg[0]->promedio, 1), $row);
                }
                $html = str_replace("{LISTADO_PARTICIPANTES_ENC}", ($row), $html);
                $html = str_replace("{SOBRETITULO}", $valor, $html);
                $datosImparticion = DatosInscripcionImparticionesV2($arreglo_objetos[0]->codigo_inscripcion, $id_empresa);
                $html = str_replace("{NOMBRECURSO}", $datosImparticion[0]->nombre_curso, $html);
                $html = str_replace("{CODIGOIMPARTICION}", $datosImparticion[0]->codigo_inscripcion, $html);
                $html = str_replace("{FECHAIMPARTICION}", $datosImparticion[0]->fecha_inicio, $html);
                $datos_empresa = DatosEmpresa($id_empresa);
                $html = str_replace("{C1}", $datos_empresa[0]->campo1, $html);
                $html = str_replace("{C2}", $datos_empresa[0]->campo2, $html);
                $html = str_replace("{C3}", $datos_empresa[0]->campo3, $html);
                if ($excel == 1) {
                    $PRINCIPAL = utf8_encode($html);
                } else {
                    $PRINCIPAL = str_replace("{BLOQUE_ENCUESTA_SATISFACCION_PARTICIPANTES}", utf8_encode($html), $PRINCIPAL);
                }
                return ($PRINCIPAL);
            }

            function Lms_reporte_MuestraInformeEncParticipantesDetalle($PRINCIPAL, $id_empresa, $arreglo_objetos, $arreglo_post, $valor)
            {
                //ECHO "HOLA";
                //arreglo de encuestas
                $enc_template = busca_enc_satis_template_admin($id_empresa);
                //print_r($arreglo_post);
                //print_r($arreglo_objetos);
                $id_curso = $arreglo_objetos[0]->id_curso;
                $primer_arreglo_objeto = $arreglo_objetos[0]->id;
                $id_encuesta = Lms_busca_encuesta_dada_objeto($primer_arreglo_objeto, $id_empresa);
                $participantes_encuesta = ENC_TraigoEncuestasFinalizadasDetalle($id_empresa, $primer_arreglo_objeto, $id_encuesta[0]->id_encuesta, $id_curso);
                //echo $encuesta->id_encuesta;
                //echo "id_curso $id_curso, objeto $primer_arreglo_objeto, id_encuesta ".$id_encuesta[0]->id_encuesta;
                //print_r($participantes_encuesta);
                $html .= file_get_contents("views/reportes/enc_satisfaccion/informe_entorno_enc_informe_participantes_detalle.html");
                foreach ($participantes_encuesta as $participante_encuesta) {
                    $row .= file_get_contents("views/reportes/enc_satisfaccion/informe_row_dimension_participantes_detalle.html");
                    $row = str_replace("{RUT}", ($participante_encuesta->rut_completo), $row);
                    $row = str_replace("{NOMBRE}", ($participante_encuesta->nombre), $row);
                    $row = str_replace("{CARGO}", ($participante_encuesta->cargo), $row);
                    $row = str_replace("{EMAIL}", ($participante_encuesta->email), $row);
                    $row = str_replace("{GERENCIA}", ($participante_encuesta->gerencia), $row);
                    $row = str_replace("{ESTADO}", ($enc_estado), $row);
                    $row = str_replace("{MEGUSTA}", ($participante_encuesta->gerencia), $row);
                    $row = str_replace("{INTERACCIONES}", ($participante_encuesta->gerencia), $row);
                    $row = str_replace("{IDCURSO}", ($participante_encuesta->idcurso), $row);
                    $row = str_replace("{CURSO}", ($participante_encuesta->curso), $row);
                    $row = str_replace("{PREGUNTA}", ($participante_encuesta->pregunta), $row);
                    $row = str_replace("{RESPUESTA}", ($participante_encuesta->respuesta), $row);
                    $row = str_replace("{FECHA}", ($participante_encuesta->fecha), $row);
                    //Por cada dimension traigo las preguntas
                    $preguntas_por_dimension = ENC_TraigoPreguntaDadaDimenion($dimen->iddimension);
                    foreach ($preguntas_por_dimension as $preg) {
                        $promedio_por_preg = ENC_CuentaDeRespuestasPorPregunta_7opciones_Promedio($id_empresa, $id_encuesta[0]->id_encuesta, $preg->idpregunta, $arreglo_objetos, $criterio);
                    }
                    $row = str_replace("{LISTADO_PARTICIPANTES_ENC}", round($promedio_por_preg[0]->promedio, 1), $row);
                }
                $html = str_replace("{LISTADO_PARTICIPANTES_ENC}", ($row), $html);
                $html = str_replace("{SOBRETITULO}", $valor, $html);
                $PRINCIPAL = str_replace("{BLOQUE_ENCUESTA_SATISFACCION_PARTICIPANTES_DETALLE}", utf8_encode($html), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function Lms_reporte_MuestraInformeEncParticipantesInscripcion($PRINCIPAL, $id_empresa, $arreglo_objetos, $arreglo_post, $valor)
            {
                //echo "hola chau";
                //arreglo de encuestas
                $enc_template = busca_enc_satis_template_admin($id_empresa);
                //print_r($arreglo_post);
                //print_r($arreglo_objetos);
                $id_curso = $arreglo_objetos[0]->id_curso;
                $id_curso = $arreglo_post[curso];
//    echo "id_curso $id_curso";
                $primer_arreglo_objeto = $arreglo_objetos[0]->id;
                $id_encuesta = Lms_busca_encuesta_dada_objeto($primer_arreglo_objeto, $id_empresa);
                $participantes_encuesta = ENC_TraigoParticipantesInscritos($id_empresa, $primer_arreglo_objeto, $id_encuesta[0]->id_encuesta, $id_curso);
                //echo $encuesta->id_encuesta;
                //print_r($participantes_encuesta);
                $html .= file_get_contents("views/reportes/inscripcionpresencial/informe_entorno_enc_informe_participantes.html");
                foreach ($participantes_encuesta as $participante_encuesta) {
                    $row .= file_get_contents("views/reportes/inscripcionpresencial/informe_row_dimension_participantes.html");
                    if ($participante_encuesta->estadoinscripcion == 'INSCRITO') {
                        $enc_estado = '<span class="mt-action-dot progress-bar-success"></span>';
                        $enc_estadotxt = 'INSCRITO';
                    } elseif ($participante_encuesta->estadoinscripcion == 'LISTAESPERA') {
                        $enc_estado = '<span class="mt-action-dot progress-bar-gray"></span>';
                        $enc_estadotxt = 'LISTA_ESPERA';
                    } elseif ($participante_encuesta->estadoinscripcion == 'LISTAESPERA') {
                        $enc_estado = '<span class="mt-action-dot progress-bar-gray"></span>';
                        $enc_estadotxt = 'LISTA_ESPERA';
                    } elseif ($participante_encuesta->estadoinscripcion == 'RECHAZADO') {
                        $enc_estado = '<span class="mt-action-dot progress-bar-danger"></span>';
                        $enc_estadotxt = 'RECHAZADO';
                    } elseif ($participante_encuesta->estadoinscripcion == 'PENDIENTE') {
                        $enc_estado = '<span class="mt-action-dot progress-bar-gray"></span>';
                        $enc_estadotxt = 'PENDIENTE';
                    } else {
                        $enc_estado = '<span class="mt-action-dot progress-bar-warning"></span>';
                        $enc_estadotxt = 'PRE_INSCRITO';
                    }
                    $fecha = fechaCastellano($participante_encuesta->fecha);
                    $hora = $participante_encuesta->hora;
                    $fecha_completa = "$fecha $hora";
//echo  $fecha_completa;
                    $row = str_replace("{COD}", ($participante_encuesta->id_inscripcion), $row);
                    $row = str_replace("{CURSO}", ($participante_encuesta->rut_completo), $row);
                    $row = str_replace("{RUT}", ($participante_encuesta->rut_completo), $row);
                    $row = str_replace("{FECHA}", ($fecha_completa), $row);
                    $row = str_replace("{NOMBRE}", ($participante_encuesta->nombre), $row);
                    $row = str_replace("{CARGO}", ($participante_encuesta->cargo), $row);
                    $row = str_replace("{GERENCIA}", ($participante_encuesta->gerencia), $row);
                    $row = str_replace("{ESTADO}", ($enc_estado), $row);
                    $row = str_replace("{ESTADOTXT}", ($enc_estadotxt), $row);
                    //Por cada dimension traigo las preguntas
                    $preguntas_por_dimension = ENC_TraigoPreguntaDadaDimenion($dimen->iddimension);
                    foreach ($preguntas_por_dimension as $preg) {
                        $promedio_por_preg = ENC_CuentaDeRespuestasPorPregunta_7opciones_Promedio($id_empresa, $id_encuesta[0]->id_encuesta, $preg->idpregunta, $arreglo_objetos, $criterio);
                    }
                    $row = str_replace("{LISTADO_PARTICIPANTES_ENC}", round($promedio_por_preg[0]->promedio, 1), $row);
                }
                $html = str_replace("{LISTADO_PARTICIPANTES_ENC}", ($row), $html);
                $html = str_replace("{SOBRETITULO}", $valor, $html);
                $PRINCIPAL = str_replace("{BLOQUE_ENCUESTA_SATISFACCION_PARTICIPANTES}", utf8_encode($html), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function Lms_reporte_MuestraInformeEncParticipantesInscripcionExcel($PRINCIPAL, $id_empresa, $arreglo_objetos, $arreglo_post, $valor)
            {
                $enc_template = busca_enc_satis_template_admin($id_empresa);
                //print_r($arreglo_post);
                //print_r($arreglo_post);
                //print_r($arreglo_objetos);
                $id_curso = $arreglo_post[curso];
                //echo "id_curso $id_curso";
                //$id_curso=$arreglo_post[curso];
                $datos_cursos = Datos_curso($id_curso);
                //print_r($datos_cursos);
//    echo "id_curso $id_curso";
                $primer_arreglo_objeto = $arreglo_objetos[0]->id;
                $id_encuesta = Lms_busca_encuesta_dada_objeto($primer_arreglo_objeto, $id_empresa);
                $participantes_encuesta = ENC_TraigoParticipantesInscritos($id_empresa, $primer_arreglo_objeto, $id_encuesta[0]->id_encuesta, $id_curso);
                //echo $encuesta->id_encuesta;
                //print_r($participantes_encuesta);
                $html .= file_get_contents("views/reportes/inscripcionpresencial/informe_entorno_enc_informe_participantes_excel.html");
                foreach ($participantes_encuesta as $participante_encuesta) {
                    $row .= file_get_contents("views/reportes/inscripcionpresencial/informe_row_dimension_participantes_excel.html");
                    if ($participante_encuesta->estadoinscripcion == 'INSCRITO') {
                        $enc_estado = '<span class="mt-action-dot progress-bar-success"></span>';
                        $enc_estadotxt = 'INSCRITO';
                    } elseif ($participante_encuesta->estadoinscripcion == 'LISTAESPERA') {
                        $enc_estado = '<span class="mt-action-dot progress-bar-gray"></span>';
                        $enc_estadotxt = 'LISTA_ESPERA';
                    } elseif ($participante_encuesta->estadoinscripcion == 'LISTAESPERA') {
                        $enc_estado = '<span class="mt-action-dot progress-bar-gray"></span>';
                        $enc_estadotxt = 'LISTA_ESPERA';
                    } elseif ($participante_encuesta->estadoinscripcion == 'RECHAZADO') {
                        $enc_estado = '<span class="mt-action-dot progress-bar-danger"></span>';
                        $enc_estadotxt = 'RECHAZADO';
                    } elseif ($participante_encuesta->estadoinscripcion == 'PENDIENTE') {
                        $enc_estado = '<span class="mt-action-dot progress-bar-gray"></span>';
                        $enc_estadotxt = 'PENDIENTE';
                    } else {
                        $enc_estado = '<span class="mt-action-dot progress-bar-warning"></span>';
                        $enc_estadotxt = 'PRE_INSCRITO';
                    }
                    $fecha = fechaCastellano($participante_encuesta->fecha);
                    $hora = $participante_encuesta->hora;
                    //$fecha_completa="$fecha $hora";
//echo  $fecha_completa;
                    $row = str_replace("{COD}", ($participante_encuesta->id_inscripcion), $row);
                    $row = str_replace("{NOMBRECURSO}", ($participante_encuesta->nombrecurso), $row);
                    $row = str_replace("{FECHAINICIO}", ($participante_encuesta->fecha_inicio), $row);
                    $row = str_replace("{FECHATERMINO}", ($participante_encuesta->fecha_termino), $row);
                    $row = str_replace("{RUT}", ($participante_encuesta->rut_completo), $row);
                    $row = str_replace("{FECHA}", ($fecha), $row);
                    $row = str_replace("{HORA}", ($hora), $row);
                    $row = str_replace("{NOMBRE}", ($participante_encuesta->nombre), $row);
                    $row = str_replace("{CARGO}", ($participante_encuesta->cargo), $row);
                    $row = str_replace("{GERENCIA}", ($participante_encuesta->gerencia), $row);
                    $row = str_replace("{EMAIL}", ($participante_encuesta->email), $row);
                    $row = str_replace("{JEFATURA}", ($participante_encuesta->nombre_jefe), $row);
                    $row = str_replace("{EMAIL_JEFATURA}", ($participante_encuesta->email_jefe), $row);
                    $row = str_replace("{ESTADO}", ($enc_estado), $row);
                    $row = str_replace("{ESTADOTXT}", ($enc_estadotxt), $row);
                    //Por cada dimension traigo las preguntas
                    $preguntas_por_dimension = ENC_TraigoPreguntaDadaDimenion($dimen->iddimension);
                    foreach ($preguntas_por_dimension as $preg) {
                        $promedio_por_preg = ENC_CuentaDeRespuestasPorPregunta_7opciones_Promedio($id_empresa, $id_encuesta[0]->id_encuesta, $preg->idpregunta, $arreglo_objetos, $criterio);
                    }
                    $row = str_replace("{LISTADO_PARTICIPANTES_ENC}", round($promedio_por_preg[0]->promedio, 1), $row);
                }
                $html = str_replace("{LISTADO_PARTICIPANTES_ENC}", ($row), $html);
                $html = str_replace("{SOBRETITULO}", $valor, $html);
                $PRINCIPAL = str_replace("{BLOQUE_ENCUESTA_SATISFACCION_PARTICIPANTES}", utf8_encode($html), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function fechaCastellano2($fecha)
            {
                $fecha = substr($fecha, 0, 10);
                $numeroDia = date('d', strtotime($fecha));
                $dia = date('l', strtotime($fecha));
                $mes = date('F', strtotime($fecha));
                $anio = date('Y', strtotime($fecha));
                $dias_ES = array("Lunes", "Martes", "Miércoles", "Jueves", "Viernes", "Sábado", "Domingo");
                $dias_EN = array("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday");
                $nombredia = str_replace($dias_EN, $dias_ES, $dia);
                $meses_ES = array("Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre");
                $meses_EN = array("January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December");
                $nombreMes = str_replace($meses_EN, $meses_ES, $mes);
                return $numeroDia . " de " . $nombreMes . " de " . $anio;
            }

            function Lms_reporte_MuestraInformeEncEvidencias($PRINCIPAL, $id_empresa, $arreglo_objetos, $arreglo_post, $valor)
            {
                //arreglo de encuestas
                $enc_template = busca_enc_satis_template_admin($id_empresa);
                $primer_arreglo_objeto = $arreglo_objetos[0]->id;
                //print_r($arreglo_post);
                $malla = $arreglo_post[malla];
                $curso = $arreglo_post[curso];
                $jefe = $arreglo_post[jefe];
                //echo "<br>$malla $curso $jefe";
                //exit();
                $id_encuesta = Lms_busca_encuesta_evidencia_dada_objeto($primer_arreglo_objeto, $id_empresa);
                ////print_r($id_encuesta);
                //echo "<br>id encuesta  ". $id_encuesta[0]->id_encuesta;
                //dada la id de la encuestra, traigo las dimesiones
                $dimensiones_por_encuesta = ENC_EVI_TraigoDimensionesPorEncuesta($id_empresa, $id_encuesta[0]->id_encuesta);
                $html .= file_get_contents("views/reportes/enc_evidencias/informe_entorno_enc_informe.html");
                foreach ($dimensiones_por_encuesta as $dimen) {
                    //Por cada dimension traigo las preguntas
                    $preguntas_por_dimension = ENC_EVI_TraigoPreguntaDadaDimenion($dimen->iddimension);
                    //busca rangos
                    //print_r($preguntas_por_dimension);
                    foreach ($preguntas_por_dimension as $preg) {
                        //echo $enc_template[0]->template_admin;
                        $row .= file_get_contents("views/reportes/enc_evidencias/informe_row_dimension_" . $enc_template[0]->template_admin . ".html");
                        $row = str_replace("{GRAFICO}", file_get_contents("views/reportes/enc_evidencias/informe_enc_grafico_" . $enc_template[0]->template_admin . ".html"), $row);
                        $row = str_replace("{CODIGO_GRAFICO}", ($preg->idpregunta), $row);
                        $row = str_replace("{NOMBRE_PREGUNTA}", ($preg->pregunta), $row);
                        $promedio_por_preg = ENC_EVI_CuentaDeRespuestasPorPregunta_7opciones_CriterioJefe($id_empresa, $id_encuesta[0]->id_encuesta, $preg->idpregunta, $arreglo_objetos, $criterio, $malla, $curso, $jefe);
                        //print_r($promedio_por_preg);
                        //exit();
                        $acumulador_notas = $acumulador_notas + $promedio_por_preg[0]->promedio_pregunta;
                        $acumulador_cuentaD1 = $promedio_por_preg[0]->cuentaD1;
                        $acumulador_cuentaD2 = $promedio_por_preg[0]->cuentaD2;
                        $acumulador_cuentaD3 = $promedio_por_preg[0]->cuentaD3;
                        $acumulador_cuentaD4 = $promedio_por_preg[0]->cuentaD4;
                        $acumulador_cuentaD5 = $promedio_por_preg[0]->cuentaD5;
                        $acumulador_cuentaD6 = $promedio_por_preg[0]->cuentaD6;
                        $acumulador_cuentaD7 = $promedio_por_preg[0]->cuentaD7;
                        $acumulador_cuentaD = $promedio_por_preg[0]->cuentaD1 + $promedio_por_preg[0]->cuentaD2 + $promedio_por_preg[0]->cuentaD3 + $promedio_por_preg[0]->cuentaD4 + $promedio_por_preg[0]->cuentaD5 + $promedio_por_preg[0]->cuentaD6 + $promedio_por_preg[0]->cuentaD7;
                        $acumulador_cuentaC1 = $promedio_por_preg[0]->cuentaC1;
                        $acumulador_cuentaC2 = $promedio_por_preg[0]->cuentaC2;
                        $acumulador_cuentaC3 = $promedio_por_preg[0]->cuentaC3;
                        $acumulador_cuentaC4 = $promedio_por_preg[0]->cuentaC4;
                        $acumulador_cuentaC5 = $promedio_por_preg[0]->cuentaC5;
                        $acumulador_cuentaC6 = $promedio_por_preg[0]->cuentaC6;
                        $acumulador_cuentaC7 = $promedio_por_preg[0]->cuentaC7;
                        $acumulador_cuentaC = $promedio_por_preg[0]->cuentaC1 + $promedio_por_preg[0]->cuentaC2 + $promedio_por_preg[0]->cuentaC3 + $promedio_por_preg[0]->cuentaC4 + $promedio_por_preg[0]->cuentaC5 + $promedio_por_preg[0]->cuentaC6 + $promedio_por_preg[0]->cuentaC7;
                        $acumulador_cuentaJ1 = $promedio_por_preg[0]->cuentaJ1;
                        $acumulador_cuentaJ2 = $promedio_por_preg[0]->cuentaJ2;
                        $acumulador_cuentaJ3 = $promedio_por_preg[0]->cuentaJ3;
                        $acumulador_cuentaJ4 = $promedio_por_preg[0]->cuentaJ4;
                        $acumulador_cuentaJ5 = $promedio_por_preg[0]->cuentaJ5;
                        $acumulador_cuentaJ6 = $promedio_por_preg[0]->cuentaJ6;
                        $acumulador_cuentaJ7 = $promedio_por_preg[0]->cuentaJ7;
                        $acumulador_cuentaJ = $promedio_por_preg[0]->cuentaJ1 + $promedio_por_preg[0]->cuentaJ2 + $promedio_por_preg[0]->cuentaJ3 + $promedio_por_preg[0]->cuentaJ4 + $promedio_por_preg[0]->cuentaJ5 + $promedio_por_preg[0]->cuentaJ6 + $promedio_por_preg[0]->cuentaJ7;
                        $acumulador_cuentaE1 = $promedio_por_preg[0]->cuentaE1;
                        $acumulador_cuentaE2 = $promedio_por_preg[0]->cuentaE2;
                        $acumulador_cuentaE3 = $promedio_por_preg[0]->cuentaE3;
                        $acumulador_cuentaE4 = $promedio_por_preg[0]->cuentaE4;
                        $acumulador_cuentaE5 = $promedio_por_preg[0]->cuentaE5;
                        $acumulador_cuentaE6 = $promedio_por_preg[0]->cuentaE6;
                        $acumulador_cuentaE7 = $promedio_por_preg[0]->cuentaE7;
                        $acumulador_cuentaE = $promedio_por_preg[0]->cuentaE;
                        $promedio_enc_D[0] = round(100 * $acumulador_cuentaD1 / $acumulador_cuentaD, 1);
                        $promedio_enc_D[1] = round(100 * $acumulador_cuentaD2 / $acumulador_cuentaD, 1);
                        $promedio_enc_D[2] = round(100 * $acumulador_cuentaD3 / $acumulador_cuentaD, 1);
                        $promedio_enc_D[3] = round(100 * $acumulador_cuentaD4 / $acumulador_cuentaD, 1);
                        $promedio_enc_D[4] = round(100 * $acumulador_cuentaD5 / $acumulador_cuentaD, 1);
                        $promedio_enc_D[5] = round(100 * $acumulador_cuentaD6 / $acumulador_cuentaD, 1);
                        $promedio_enc_D[6] = round(100 * $acumulador_cuentaD7 / $acumulador_cuentaD, 1);
                        $promedio_enc_C[0] = round(100 * $acumulador_cuentaC1 / $acumulador_cuentaC, 1);
                        $promedio_enc_C[1] = round(100 * $acumulador_cuentaC2 / $acumulador_cuentaC, 1);
                        $promedio_enc_C[2] = round(100 * $acumulador_cuentaC3 / $acumulador_cuentaC, 1);
                        $promedio_enc_C[3] = round(100 * $acumulador_cuentaC4 / $acumulador_cuentaC, 1);
                        $promedio_enc_C[4] = round(100 * $acumulador_cuentaC5 / $acumulador_cuentaC, 1);
                        $promedio_enc_C[5] = round(100 * $acumulador_cuentaC6 / $acumulador_cuentaC, 1);
                        $promedio_enc_C[6] = round(100 * $acumulador_cuentaC7 / $acumulador_cuentaC, 1);
                        $promedio_enc_J[0] = round(100 * $acumulador_cuentaJ1 / $acumulador_cuentaJ, 1);
                        $promedio_enc_J[1] = round(100 * $acumulador_cuentaJ2 / $acumulador_cuentaJ, 1);
                        $promedio_enc_J[2] = round(100 * $acumulador_cuentaJ3 / $acumulador_cuentaJ, 1);
                        $promedio_enc_J[3] = round(100 * $acumulador_cuentaJ4 / $acumulador_cuentaJ, 1);
                        $promedio_enc_J[4] = round(100 * $acumulador_cuentaJ5 / $acumulador_cuentaJ, 1);
                        $promedio_enc_J[5] = round(100 * $acumulador_cuentaJ6 / $acumulador_cuentaJ, 1);
                        $promedio_enc_J[6] = round(100 * $acumulador_cuentaJ7 / $acumulador_cuentaJ, 1);
                        $row = str_replace("{POLONEGATIVOD}", ($promedio_enc_D[0] + $promedio_enc_D[1]) / 2, $row);
                        $row = str_replace("{POLOPOSITIVOD}", ($promedio_enc_D[3] + $promedio_enc_D[4]) / 2, $row);
                        $row = str_replace("{GRISPOLONEGATIVOD}", 50 - ($promedio_enc_D[0] + $promedio_enc_D[1]) / 2, $row);
                        $row = str_replace("{GRISPOLOPOSITIVOD}", 50 - ($promedio_enc_D[3] + $promedio_enc_D[4]) / 2, $row);
                        $row = str_replace("{POLONEGATIVONND}", ($promedio_enc_D[0] + $promedio_enc_D[1]), $row);
                        $row = str_replace("{POLOPOSITIVONND}", ($promedio_enc_D[3] + $promedio_enc_D[4]), $row);
                        $row = str_replace("{CUENTAD1}", ($promedio_enc_D[0]), $row);
                        $row = str_replace("{CUENTAD2}", ($promedio_enc_D[1]), $row);
                        $row = str_replace("{CUENTAD3}", ($promedio_enc_D[2]), $row);
                        $row = str_replace("{CUENTAD4}", ($promedio_enc_D[3]), $row);
                        $row = str_replace("{CUENTAD5}", ($promedio_enc_D[4]), $row);
                        $row = str_replace("{CUENTAD6}", ($promedio_enc_D[5]), $row);
                        $row = str_replace("{CUENTAD7}", ($promedio_enc_D[6]), $row);
                        $row = str_replace("{POLONEGATIVOC}", ($promedio_enc_C[0] + $promedio_enc_C[1]) / 2, $row);
                        $row = str_replace("{POLOPOSITIVOC}", ($promedio_enc_C[3] + $promedio_enc_C[4]) / 2, $row);
                        $row = str_replace("{GRISPOLONEGATIVOC}", 50 - ($promedio_enc_C[0] + $promedio_enc_C[1]) / 2, $row);
                        $row = str_replace("{GRISPOLOPOSITIVOC}", 50 - ($promedio_enc_C[3] + $promedio_enc_C[4]) / 2, $row);
                        $row = str_replace("{POLONEGATIVOJ}", ($promedio_enc_J[0] + $promedio_enc_J[1]) / 2, $row);
                        $row = str_replace("{POLOPOSITIVOJ}", ($promedio_enc_J[3] + $promedio_enc_J[4]) / 2, $row);
                        $row = str_replace("{GRISPOLONEGATIVOJ}", 50 - ($promedio_enc_J[0] + $promedio_enc_J[1]) / 2, $row);
                        $row = str_replace("{GRISPOLOPOSITIVOJ}", 50 - ($promedio_enc_J[3] + $promedio_enc_J[4]) / 2, $row);
                        $row = str_replace("{POLONEGATIVONNC}", ($promedio_enc_C[0] + $promedio_enc_C[1]), $row);
                        $row = str_replace("{POLOPOSITIVONNC}", ($promedio_enc_C[3] + $promedio_enc_C[4]), $row);
                        $row = str_replace("{CUENTAC1}", ($promedio_enc_C[0]), $row);
                        $row = str_replace("{CUENTAC2}", ($promedio_enc_C[1]), $row);
                        $row = str_replace("{CUENTAC3}", ($promedio_enc_C[2]), $row);
                        $row = str_replace("{CUENTAC4}", ($promedio_enc_C[3]), $row);
                        $row = str_replace("{CUENTAC5}", ($promedio_enc_C[4]), $row);
                        $row = str_replace("{CUENTAC6}", ($promedio_enc_C[5]), $row);
                        $row = str_replace("{CUENTAC7}", ($promedio_enc_C[6]), $row);
                        $row = str_replace("{CUENTAJ1}", ($promedio_enc_J[0]), $row);
                        $row = str_replace("{CUENTAJ2}", ($promedio_enc_J[1]), $row);
                        $row = str_replace("{CUENTAJ3}", ($promedio_enc_J[2]), $row);
                        $row = str_replace("{CUENTAJ4}", ($promedio_enc_J[3]), $row);
                        $row = str_replace("{CUENTAJ5}", ($promedio_enc_J[4]), $row);
                        $row = str_replace("{CUENTAJ6}", ($promedio_enc_J[5]), $row);
                        $row = str_replace("{CUENTAJ7}", ($promedio_enc_J[6]), $row);
                    }
                }
                $html = str_replace("{LISTADO_DIMENSIONES}", ($row), $html);
                $html = str_replace("{SOBRETITULO}", $valor, $html);
                $PRINCIPAL = str_replace("{BLOQUE_ENCUESTA_EVIDENCIAS_POR_PREGUNTA}", utf8_encode($html), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function Lms_reporte_MuestraInformeEncEvidenciasJefe($PRINCIPAL, $id_empresa, $arreglo_objetos, $criterio, $valor)
            {
                //print_r($arreglo_objetos);
                //arreglo de encuestas
                $enc_template = busca_enc_satis_template_admin($id_empresa);
                $primer_arreglo_objeto = $arreglo_objetos[0]->id;
                //print_r($objeto_unico);
                //echo "<br>$primer_arreglo_objeto";
                //exit();
                $id_encuesta = Lms_busca_encuesta_evidencia_dada_objeto($primer_arreglo_objeto, $id_empresa);
                ////print_r($id_encuesta);
                //echo "<br>id encuesta  ". $id_encuesta[0]->id_encuesta;
                //dada la id de la encuestra, traigo las dimesiones
                $dimensiones_por_encuesta = ENC_EVI_TraigoDimensionesPorEncuesta($id_empresa, $id_encuesta[0]->id_encuesta);
                $html .= file_get_contents("views/reportes/enc_evidencias_jefe/informe_entorno_enc_informe.html");
                foreach ($dimensiones_por_encuesta as $dimen) {
                    //Por cada dimension traigo las preguntas
                    $preguntas_por_dimension = ENC_EVI_TraigoPreguntaDadaDimenion($dimen->iddimension);
                    //busca rangos
                    //print_r($preguntas_por_dimension);
                    foreach ($preguntas_por_dimension as $preg) {
                        //    ECHO $enc_template[0]->template_admin;
                        $row .= file_get_contents("views/reportes/enc_evidencias_jefe/informe_row_dimension_" . $enc_template[0]->template_admin . ".html");
                        $row = str_replace("{GRAFICO}", file_get_contents("views/reportes/enc_evidencias_jefe/informe_enc_grafico_" . $enc_template[0]->template_admin . ".html"), $row);
                        $row = str_replace("{CODIGO_GRAFICO}", ($preg->idpregunta), $row);
                        $row = str_replace("{NOMBRE_PREGUNTA}", ($preg->pregunta), $row);
                        $promedio_por_preg = ENC_EVI_CuentaDeRespuestasPorPregunta_7opciones_CriterioJefe($id_empresa, $id_encuesta[0]->id_encuesta, $preg->idpregunta, $arreglo_objetos, $criterio);
                        //print_r($promedio_por_preg);
                        //exit();
                        $acumulador_notas = $acumulador_notas + $promedio_por_preg[0]->promedio_pregunta;
                        $acumulador_cuentaD1 = $promedio_por_preg[0]->cuentaD1;
                        $acumulador_cuentaD2 = $promedio_por_preg[0]->cuentaD2;
                        $acumulador_cuentaD3 = $promedio_por_preg[0]->cuentaD3;
                        $acumulador_cuentaD4 = $promedio_por_preg[0]->cuentaD4;
                        $acumulador_cuentaD5 = $promedio_por_preg[0]->cuentaD5;
                        $acumulador_cuentaD6 = $promedio_por_preg[0]->cuentaD6;
                        $acumulador_cuentaD7 = $promedio_por_preg[0]->cuentaD7;
                        $acumulador_cuentaD = $promedio_por_preg[0]->cuentaD1 + $promedio_por_preg[0]->cuentaD2 + $promedio_por_preg[0]->cuentaD3 + $promedio_por_preg[0]->cuentaD4 + $promedio_por_preg[0]->cuentaD5 + $promedio_por_preg[0]->cuentaD6 + $promedio_por_preg[0]->cuentaD7;
                        $acumulador_cuentaC1 = $promedio_por_preg[0]->cuentaC1;
                        $acumulador_cuentaC2 = $promedio_por_preg[0]->cuentaC2;
                        $acumulador_cuentaC3 = $promedio_por_preg[0]->cuentaC3;
                        $acumulador_cuentaC4 = $promedio_por_preg[0]->cuentaC4;
                        $acumulador_cuentaC5 = $promedio_por_preg[0]->cuentaC5;
                        $acumulador_cuentaC6 = $promedio_por_preg[0]->cuentaC6;
                        $acumulador_cuentaC7 = $promedio_por_preg[0]->cuentaC7;
                        $acumulador_cuentaC = $promedio_por_preg[0]->cuentaC1 + $promedio_por_preg[0]->cuentaC2 + $promedio_por_preg[0]->cuentaC3 + $promedio_por_preg[0]->cuentaC4 + $promedio_por_preg[0]->cuentaC5 + $promedio_por_preg[0]->cuentaC6 + $promedio_por_preg[0]->cuentaC7;
                        $acumulador_cuentaJ1 = $promedio_por_preg[0]->cuentaJ1;
                        $acumulador_cuentaJ2 = $promedio_por_preg[0]->cuentaJ2;
                        $acumulador_cuentaJ3 = $promedio_por_preg[0]->cuentaJ3;
                        $acumulador_cuentaJ4 = $promedio_por_preg[0]->cuentaJ4;
                        $acumulador_cuentaJ5 = $promedio_por_preg[0]->cuentaJ5;
                        $acumulador_cuentaJ6 = $promedio_por_preg[0]->cuentaJ6;
                        $acumulador_cuentaJ7 = $promedio_por_preg[0]->cuentaJ7;
                        $acumulador_cuentaJ = $promedio_por_preg[0]->cuentaJ;
                        $acumulador_cuentaE1 = $promedio_por_preg[0]->cuentaE1;
                        $acumulador_cuentaE2 = $promedio_por_preg[0]->cuentaE2;
                        $acumulador_cuentaE3 = $promedio_por_preg[0]->cuentaE3;
                        $acumulador_cuentaE4 = $promedio_por_preg[0]->cuentaE4;
                        $acumulador_cuentaE5 = $promedio_por_preg[0]->cuentaE5;
                        $acumulador_cuentaE6 = $promedio_por_preg[0]->cuentaE6;
                        $acumulador_cuentaE7 = $promedio_por_preg[0]->cuentaE7;
                        $acumulador_cuentaE = $promedio_por_preg[0]->cuentaE;
                        $promedio_enc_D[0] = round(100 * $acumulador_cuentaD1 / $acumulador_cuentaD, 1);
                        $promedio_enc_D[1] = round(100 * $acumulador_cuentaD2 / $acumulador_cuentaD, 1);
                        $promedio_enc_D[2] = round(100 * $acumulador_cuentaD3 / $acumulador_cuentaD, 1);
                        $promedio_enc_D[3] = round(100 * $acumulador_cuentaD4 / $acumulador_cuentaD, 1);
                        $promedio_enc_D[4] = round(100 * $acumulador_cuentaD5 / $acumulador_cuentaD, 1);
                        $promedio_enc_D[5] = round(100 * $acumulador_cuentaD6 / $acumulador_cuentaD, 1);
                        $promedio_enc_D[6] = round(100 * $acumulador_cuentaD7 / $acumulador_cuentaD, 1);
                        $promedio_enc_C[0] = round(100 * $acumulador_cuentaC1 / $acumulador_cuentaC, 1);
                        $promedio_enc_C[1] = round(100 * $acumulador_cuentaC2 / $acumulador_cuentaC, 1);
                        $promedio_enc_C[2] = round(100 * $acumulador_cuentaC3 / $acumulador_cuentaC, 1);
                        $promedio_enc_C[3] = round(100 * $acumulador_cuentaC4 / $acumulador_cuentaC, 1);
                        $promedio_enc_C[4] = round(100 * $acumulador_cuentaC5 / $acumulador_cuentaC, 1);
                        $promedio_enc_C[5] = round(100 * $acumulador_cuentaC6 / $acumulador_cuentaC, 1);
                        $promedio_enc_C[6] = round(100 * $acumulador_cuentaC7 / $acumulador_cuentaC, 1);
                        $promedio_enc_J[0] = round(100 * $acumulador_cuentaJ1 / $acumulador_cuentaJ, 1);
                        $promedio_enc_J[1] = round(100 * $acumulador_cuentaJ2 / $acumulador_cuentaJ, 1);
                        $promedio_enc_J[2] = round(100 * $acumulador_cuentaJ3 / $acumulador_cuentaJ, 1);
                        $promedio_enc_J[3] = round(100 * $acumulador_cuentaJ4 / $acumulador_cuentaJ, 1);
                        $promedio_enc_J[4] = round(100 * $acumulador_cuentaJ5 / $acumulador_cuentaJ, 1);
                        $promedio_enc_J[5] = round(100 * $acumulador_cuentaJ6 / $acumulador_cuentaJ, 1);
                        $promedio_enc_J[6] = round(100 * $acumulador_cuentaJ7 / $acumulador_cuentaJ, 1);
                        $row = str_replace("{POLONEGATIVOJ}", ($promedio_enc_J[0] + $promedio_enc_J[1]) / 2, $row);
                        $row = str_replace("{POLOPOSITIVOJ}", ($promedio_enc_J[3] + $promedio_enc_J[4]) / 2, $row);
                        $row = str_replace("{GRISPOLONEGATIVOJ}", 50 - ($promedio_enc_J[0] + $promedio_enc_J[1]) / 2, $row);
                        $row = str_replace("{GRISPOLOPOSITIVOJ}", 50 - ($promedio_enc_J[3] + $promedio_enc_J[4]) / 2, $row);
                        $row = str_replace("{POLONEGATIVONNJ}", ($promedio_enc_J[0] + $promedio_enc_J[1]), $row);
                        $row = str_replace("{POLOPOSITIVONNJ}", ($promedio_enc_J[3] + $promedio_enc_J[4]), $row);
                        $row = str_replace("{CUENTAJ1}", ($promedio_enc_J[0]), $row);
                        $row = str_replace("{CUENTAJ2}", ($promedio_enc_J[1]), $row);
                        $row = str_replace("{CUENTAJ3}", ($promedio_enc_J[2]), $row);
                        $row = str_replace("{CUENTAJ4}", ($promedio_enc_J[3]), $row);
                        $row = str_replace("{CUENTAJ5}", ($promedio_enc_J[4]), $row);
                        $row = str_replace("{CUENTAJ6}", ($promedio_enc_J[5]), $row);
                        $row = str_replace("{CUENTAJ7}", ($promedio_enc_J[6]), $row);
                        $row = str_replace("{PROMJ1}", ($promedio_enc_J[0]), $row);
                        $row = str_replace("{PROMJ2}", ($promedio_enc_J[1]), $row);
                        $row = str_replace("{PROMJ3}", ($promedio_enc_J[2]), $row);
                        $row = str_replace("{PROMJ4}", ($promedio_enc_J[3]), $row);
                        $row = str_replace("{PROMJ5}", ($promedio_enc_J[4]), $row);
                    }
                }
                $html = str_replace("{LISTADO_DIMENSIONES}", ($row), $html);
                $html = str_replace("{SOBRETITULO}", $valor, $html);
                $PRINCIPAL = str_replace("{BLOQUE_ENCUESTA_EVIDENCIAS_POR_PREGUNTA}", utf8_encode($html), $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function jListarObjetosAgregados($PRINCIPAL, $exito)
            {
                //echo "funcion";
                $body = "";
                $alert = "";
                $result = listarObjetosBiblioteca();
                if ($exito == 1) {
                    $alert = '<div class="alert alert-success alert-dismissible" role="alert">
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <strong>Exito!</strong>
                </div>';
                } else if ($exito == 2) {
                    $alert = '<div class="alert alert-danger alert-dismissible" role="alert">
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <strong>Error!</strong>
                </div>';
                }
                if (count($result) > 0) {
                    foreach ($result as $row) {
                        //echo $row->titulo;
                        $body .= "<tr>";
                        $body .= "<td>" . $row->titulo . "</td>";
                        $body .= "<td>" . $row->descripcion . "</td>";
                        $body .= "<td><a style='cursor:pointer' id='descargarObjeto' name='descargarObjeto' onclick='descargarObjeto(\"" . $row->rutaObjeto . "\")'>" . $row->rutaObjeto . "</a></td>";
                        $body .= "<td>" . date('d-m-Y H:i:s', strtotime($row->fecha_creacion)) . "</td>";
                        $body .= "<td>" . date('d-m-Y H:i:s', strtotime($row->fecha_modificacion)) . "</td>";
                        $body .= "<td align='center'><a href='?sw=editBibliObj|" . $row->idObjeto . "' class='btn btn-success btn-sm'><i class='glyphicon glyphicon-pencil'></i></a></td>";
                        $body .= "<td align='center'><a class='btn btn-danger btn-sm' onclick='validarDeleteObj(" . $row->idObjeto . ")'><i class='glyphicon glyphicon-trash'></i></a></td>";
                        $body .= "</tr>";
                    }
                } else {
                    $body .= "<tr><td colspan='7'>No hay objetos agregados</td></tr>";
                }
                $js = "<script type='text/javascript'>
                function validarDeleteObj(id){
                    if(confirm('¿Esta Usted seguro de eliminar este objeto?')){
                        $.ajax({
                                url: 'jhonatan_funciones_post.php',
                                type: 'post',
                                data: {'accion': 3, 'idObjeto': id},
                                success: function(response){
                                    //alert(response);
                                    if(response == 1){
                                        window.location.href = '?sw=adminBibliObj|s';
                                    }else{
                                        window.location.href = '?sw=adminBibliObj|n';
                                    }
                                }
                        });
                    }
                }
                function descargarObjeto(ruta){
                        window.open(ruta);
                }
            </script>";
                $PRINCIPAL = str_replace("{MENSAJE}", $alert, $PRINCIPAL);
                $PRINCIPAL = str_replace("{LISTADO_BIBLIOTECA_OBJETOS}", $body, $PRINCIPAL);
                $PRINCIPAL = str_replace("{LBO_JS}", $js, $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function jAgregarObjetoBiblioteca($PRINCIPAL)
            {
                $content = "<form role='form' action='./jhonatan_funciones_post.php' method='POST' enctype='multipart/form-data' id='formSubirObjeto' name='formSubirObjeto'>
                    <input type='hidden' id='accion' name='accion' value='1'/>
                    <div class='form-group hide' id='divAlert'>
                        <div class='alert alert-danger alert-dismissible role='alert'>
                            <button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button>
                            <strong>Todos los campos son obligatorios !
                        </div>
                    </div>
                    <div class='form-group' id='divTitulo'>
                        <label for='titulo'>TITULO</label>
                        <input type='text' class='form-control' id='titulo' name='titulo' placeholder='Ingresa un Titulo'>
                    </div>
                    <div class='form-group' id='divDescripcion'>
                        <label for='descripcion'>DESCRIPCI&OacuteN</label>
                        <input type='text' class='form-control' id='descripcion' name='descripcion' placeholder='Ingresa una Descripcion'>
                    </div>
                    <div class='form-group' id='divArchivo'>
                        <label for='archivo'>ADJUNTAR OBJETO</label>
                        <input type='file' id='archivo' name='archivo' class='form-control'>
                    </div>
                    <div class='form-group col-xs-offset-7'>
                        <button type='button' class='btn btn-default' onclick='validarFormObjetos()'>Subir Archivo</button>
                    </div>
                </form>";
                $content .= "<script type='text/javascript'>
                    function validarFormObjetos(){
                        if($('#titulo').val().length > 0 && $('#descripcion').val().length > 0 && $('#archivo').val().length > 0){
                            $('#formSubirObjeto').submit();
                        }else{
                            $('#divAlert').removeClass('hide');
                        }
                    }
                </script>";
                $PRINCIPAL = str_replace("{CONTENIDO}", $content, $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function jEditarObjetoBiblioteca($PRINCIPAL, $id, $nuevoTitulo, $nuevaDescripcion, $urlObjeto)
            {
                $PRINCIPAL = str_replace("{LISTADO_BIBLIOTECA_OBJETOS}", $body, $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function jBuscarObjetoBiblioteca($PRINCIPAL, $id)
            {
                $obj = buscarObjetoBiblioteca($id);
                foreach ($obj as $row) {
                    $content = "<form role='form' action='./jhonatan_funciones_post.php' method='POST' id='formEditObjeto' name='formEditObjeto'>
                        <input type='hidden' id='accion' name='accion' value='2'/>
                        <input type='hidden' id='idObjeto' name='idObjeto' value='" . $row->idObjeto . "'/>
                        <div class='form-group hide' id='divAlert'>
                            <div class='alert alert-danger alert-dismissible role='alert'>
                                <button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button>
                                <strong>Todos los campos son obligatorios !
                            </div>
                        </div>
                        <div class='form-group' id='divTitulo'>
                            <label for='titulo'>TITULO</label>
                            <input type='text' class='form-control' id='nuevoTitulo' name='nuevoTitulo' placeholder='Ingresa un Titulo' value='" . $row->titulo . "'>
                        </div>
                        <div class='form-group' id='divDescripcion'>
                            <label for='descripcion'>DESCRIPCI&OacuteN</label>
                            <input type='text' class='form-control' id='nuevaDescripcion' name='nuevaDescripcion' placeholder='Ingresa una Descripcion' value='" . $row->descripcion . "'>
                        </div>
                        <div class='form-group' id='divArchivo'>
                            <label for='archivo'>RUTA DEL OBJETO</label>
                            <input type='text' id='archivo' name='archivo' class='form-control' value='" . $row->rutaObjeto . "' disabled>
                        </div>
                        <div class='form-group col-xs-offset-7'>
                            <button type='button' class='btn btn-default' onclick='validarFormObjetos()'>Guardar Cambios</button>
                        </div>
                    </form>";
                }
                $content .= "<script type='text/javascript'>
                    function validarFormObjetos(){
                        if($('#nuevoTitulo').val().length > 0 && $('#nuevaDescripcion').val().length > 0 && $('#archivo').val().length > 0){
                            $('#formEditObjeto').submit();
                        }else{
                            $('#divAlert').removeClass('hide');
                        }
                    }
                </script>";
                $PRINCIPAL = str_replace("{CONTENIDO}", $content, $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function jValidarEmpresaSubidaUsuarios($idEmpresa)
            {
                $result = consultaEmpresaSubidaUsuarios($idEmpresa);
                //print_r($result);exit;
                //if(count($result) > 0){
                if ($result[0]->total > 0) {
                    return true;
                } else {
                    return false;
                }
            }

            function jListarCamposEmpresaSubidaUsuarios($response, $idEmpresa)
            {
                /*
        1 = Devuelve el nombre de los campos a mostrar ordenados y separados por Obligatorios y Opcionales.
        2 = Devuelve el nombre de los campos a mostrar en un arreglo.
        3 = Devuelve el nombre de los campos en la BD en un arreglo.
    */
                $result = listarEmpresaSubidaUsuarios($idEmpresa);
                $arr = array();
                $i = 0;
                if ($response == 3) {
                    foreach ($result as $row) {
                        $arr[$i] = $row->campo;
                        $i++;
                    }
                    return $arr;
                } else if ($response == 2) {
                    foreach ($result as $row) {
                        $arr[$i] = $row->nombrecampoamostrar;
                        $i++;
                    }
                    return $arr;
                } else {
                    $obligatorios = "";
                    $opcionales = "";
                    foreach ($result as $row) {
                        if ($row->obligatorio == 1) {
                            $obligatorios .= "," . $row->nombrecampoamostrar;
                        } else {
                            $opcionales .= "," . $row->nombrecampoamostrar;
                        }
                    }
                    $arr = $obligatorios . "|" . $opcionales;
                    return $arr;
                }
            }

            function jCampoVisualCambioCampoTabla($idEmpresa, $campoVisual)
            {
                $nombreCampoTabla = "";
                $result = buscarRegistroNombreCampo($idEmpresa, $campoVisual);
                foreach ($result as $row) {
                    $nombreCampoTabla = $row->campo;
                }
                return $nombreCampoTabla;
            }

            function jValidarObligatorioCampo($idEmpresa, $campoVisual)
            {
                $obligatorio = 0;
                $result = buscarRegistroNombreCampo($idEmpresa, $campoVisual);
                foreach ($result as $row) {
                    $obligatorio = $row->obligatorio;
                }
                return $obligatorio;
            }

            function jListarEvaluaciones($PRINCIPAL)
            {
                $idEmpresa = $_SESSION["id_empresa"];
                $result = listarRegistrosTablaGlobalFiltro("tbl_evaluaciones", "id_empresa", $idEmpresa, "");
                $tableRows = "";
                if (count($result) == 0) {
                    $tableRows .= "<tr><td colspan = '4'>No existen registros de evaluaciones</td></tr>";
                } else if (count($result) > 0) {
                    foreach ($result as $row) {
                        $listPreguntas = listarRegistrosTablaGlobalFiltro("tbl_evaluaciones_preguntas", "evaluacion", $row->id, "");
                        $tableRows .= "<tr>";
                        $tableRows .= "<td>" . $row->id . "</td>";
                        $tableRows .= "<td>" . htmlspecialchars_decode(utf8_decode($row->nombre_evaluacion)) . "</td>";
                        $tableRows .= "<td>" . $row->descripcion . "</td>";
                        $tableRows .= "<td>" . count($listPreguntas) . "</td>";
                        $tableRows .= "<td align='center'><a title='Ver Evaluacion' href='?sw=viewEval&idEval=" . $row->id . "' class='btn btn-success btn-sm'><i class='glyphicon glyphicon-eye-open'></i></a></td>";
                        $tableRows .= "</tr>";
                    }
                }
                $js = "    <script type = 'text/javascript'>
            </script>";
                $PRINCIPAL = str_replace("{LISTADO_EVALUACIONES}", $tableRows, $PRINCIPAL);
                $PRINCIPAL = str_replace("{LIST_EVAL_JS}", $js, $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function jListarPreguntas($PRINCIPAL, $idEval, $programa)
            {
                $preguntas = listarRegistrosTablaGlobalFiltro("tbl_evaluaciones_preguntas", "evaluacion", $idEval, "orden asc");
                $tableRows = "";
                if (count($preguntas) == 0) {
                    $tableRows .= "<tr><td colspan = '3'>No existen registros de preguntas para esta evaluaci&oacuten</td></tr>";
                } else if (count($preguntas) > 0) {
                    foreach ($preguntas as $row1) {
                        $alternativas = listarRegistrosTablaGlobalFiltro("tbl_evaluaciones_alternativas", "id_grupo_alternativas", $row1->id_grupo_alternativas, "");
                        $totalAlternativas = count($alternativas);
                        $tableRows .= "<tr>";
                        $tableRows .= "<td rowspan='" . ($totalAlternativas + 1) . "'  class='lms_preg_num_eval'>" . $row1->orden . "</td>";
                        //$tableRows .= "<td class='lms_preg_texto_eval'>".(utf8_encode($row1->pregunta))."</td>";
                        if ($row1->tipo == 2) {
                            $tableRows .= "<td class='lms_preg_texto_eval'>" . (utf8_encode($row1->pregunta)) . "<br><img src='../front/" . $row1->url_archivo . "'><br></td>";
                        } else {
                            $tableRows .= "<td class='lms_preg_texto_eval'>" . (utf8_encode($row1->pregunta)) . "<br></td>";
                        }
                        $tableRows .= "
            <td rowspan='" . ($totalAlternativas + 1) . "' class='lms_preg_alternativas_eval' style='width: 100px;'>
                <a href='?sw=editPreg&idEval=$idEval&idGrup=" . $row1->id_grupo_alternativas . "' title='Editar Pregunta' class='btn btn-success btn-sm'><i class='glyphicon glyphicon-edit'></i></a>
                <a onclick = \"if (! confirm('Continue?')) return false;\"  href='?sw=dltPreg&idEval=$idEval&idPreg=" . $row1->id . "' title='Eliminar Pregunta' class='btn btn-danger btn-sm'><i class='glyphicon glyphicon-remove'></i></a>
                </td>";
                        $tableRows .= "</tr>";
                        foreach ($alternativas as $row2) {
                            $tableRows .= "<tr>";
                            if ($row2->correcta == 1) {
                                $tableRows .= "<td class='lms_preg_alternativa_correcta_eval'><i class='fa fa-check-circle' aria-hidden='true'></i> " . (utf8_encode($row2->alternativa)) . "</p></td>";
                            } else {
                                $tableRows .= "<td class='lms_preg_alternativas_eval'> " . (utf8_encode($row2->alternativa)) . "</td>";
                            }
                            $tableRows .= "</tr>";
                        }
                    }
                }
                $js = "    <script type = 'text/javascript'>
            </script>";
                $nombre_ev = nombreEvaL($idEval);
                $PRINCIPAL = str_replace("{ID_EVAL}", $idEval, $PRINCIPAL);
                $PRINCIPAL = str_replace("{PROGRAMA}", $programa, $PRINCIPAL);
                $PRINCIPAL = str_replace("{LISTADO_PREGUNTAS}", $tableRows, $PRINCIPAL);
                $PRINCIPAL = str_replace("{EVALUACION}", utf8_encode($nombre_ev[0]->nombre_evaluacion), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CURSO}", $tableRows, $PRINCIPAL);
                $PRINCIPAL = str_replace("{LIST_PREG_JS}", $js, $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function jListarPreguntasBK($PRINCIPAL, $idEval, $programa)
            {
                $preguntas = listarRegistrosTablaGlobalFiltro("tbl_enc_elearning", "id", $idEval, "orden asc");
                $tableRows = "";
                if (count($preguntas) == 0) {
                    $tableRows .= "<tr><td colspan = '4'>No existen registros de preguntas para esta evaluaci&oacuten</td></tr>";
                } else if (count($preguntas) > 0) {
                    foreach ($preguntas as $row1) {
                        $alternativas = listarRegistrosTablaGlobalFiltro("tbl_evaluaciones_alternativas", "id_grupo_alternativas", $row1->id_grupo_alternativas, "");
                        $totalAlternativas = count($alternativas);
                        $tableRows .= "<tr>";
                        $tableRows .= "<td rowspan='" . ($totalAlternativas + 1) . "'  class='lms_preg_num_eval'>" . $row1->orden . "</td>";
                        //$tableRows .= "<td class='lms_preg_texto_eval'>".(utf8_encode($row1->pregunta))."</td>";
                        if ($row1->tipo == 2) {
                            $tableRows .= "<td class='lms_preg_texto_eval'>" . (utf8_encode($row1->pregunta)) . "<br><img src='../front/" . $row1->url_archivo . "'></td>";
                        } else {
                            $tableRows .= "<td class='lms_preg_texto_eval'>" . (utf8_encode($row1->pregunta)) . "</td>";
                        }
                        $tableRows .= "
            <td rowspan='" . ($totalAlternativas + 1) . "' class='lms_preg_alternativas_eval'>
                <a href='?sw=editPreg&idEval=$idEval&idGrup=" . $row1->id_grupo_alternativas . "' title='Editar Pregunta' class='btn btn-success btn-sm'><i class='glyphicon glyphicon-edit'></i></a>
                <a onclick = \"if (! confirm('Continue?')) return false;\"  href='?sw=dltPreg&idEval=$idEval&idPreg=" . $row1->id . "' title='Eliminar Pregunta' class='btn btn-danger btn-sm'><i class='glyphicon glyphicon-remove'></i></a>
                </td>";
                        $tableRows .= "</tr>";
                        foreach ($alternativas as $row2) {
                            $tableRows .= "<tr>";
                            if ($row2->correcta == 1) {
                                $tableRows .= "<td class='lms_preg_alternativa_correcta_eval'><i class='fa fa-check-circle' aria-hidden='true'></i> " . (utf8_encode($row2->alternativa)) . "</p></td>";
                            } else {
                                $tableRows .= "<td class='lms_preg_alternativas_eval'> " . (utf8_encode($row2->alternativa)) . "</td>";
                            }
                            $tableRows .= "</tr>";
                        }
                    }
                }
                $js = "    <script type = 'text/javascript'>
            </script>";
                $nombre_ev = nombreEvaL($idEval);
                $PRINCIPAL = str_replace("{ID_EVAL}", $idEval, $PRINCIPAL);
                $PRINCIPAL = str_replace("{PROGRAMA}", $programa, $PRINCIPAL);
                $PRINCIPAL = str_replace("{LISTADO_PREGUNTAS}", $tableRows, $PRINCIPAL);
                $PRINCIPAL = str_replace("{EVALUACION}", utf8_encode($nombre_ev[0]->nombre_evaluacion), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CURSO}", $tableRows, $PRINCIPAL);
                $PRINCIPAL = str_replace("{LIST_PREG_JS}", $js, $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function jListarPreguntasMedicion($PRINCIPAL, $idEval, $programa)
            {
                $preguntas = listarRegistrosTablaGlobalFiltro("tbl_enc_elearning_preg", "id_encuesta", $idEval, "id asc");
                $tableRows = "";
                //print_r($preguntas);
                if (count($preguntas) == 0) {
                    $tableRows .= "<tr><td colspan = '4'>No existen registros de preguntas para esta evaluaci&oacuten</td></tr>";
                } else if (count($preguntas) > 0) {
                    foreach ($preguntas as $row1) {
                        $alternativas = listarRegistrosTablaGlobalFiltro("tbl_evaluaciones_alternativas", "id_grupo_alternativas", $row1->id_grupo_alternativas, "");
                        $totalAlternativas = count($alternativas);
                        $tableRows .= "<tr>";
                        $tableRows .= "<td rowspan='" . ($totalAlternativas + 1) . "'  class='lms_preg_num_eval'>" . $row1->id_pregunta . "</td>";
                        $tableRows .= "<td class='lms_preg_texto_eval'>" . (utf8_encode($row1->pregunta)) . "</td>";
                        $tableRows .= "<td class='lms_preg_texto_eval'>" . (utf8_encode($row1->tipo)) . "</td>";
                        $tableRows .= "
            <td rowspan='" . ($totalAlternativas + 1) . "' class='lms_preg_alternativas_eval'>
                <a href='?sw=editPreg&idEval=$idEval&idGrup=" . $row1->id_grupo_alternativas . "' title='Editar Pregunta' class='btn btn-success btn-sm'><i class='glyphicon glyphicon-edit'></i></a>
                <a onclick = \"if (! confirm('Continue?')) return false;\"  href='?sw=dltPreg&idEval=$idEval&idPreg=" . $row1->id . "' title='Eliminar Pregunta' class='btn btn-danger btn-sm'><i class='glyphicon glyphicon-remove'></i></a>
             </td>";
                        $tableRows .= "</tr>";
                        foreach ($alternativas as $row2) {
                            $tableRows .= "<tr>";
                            if ($row2->correcta == 1) {
                                $tableRows .= "<td class='lms_preg_alternativa_correcta_eval'><i class='fa fa-check-circle' aria-hidden='true'></i> " . (utf8_encode($row2->alternativa)) . "</p></td>";
                            } else {
                                $tableRows .= "<td class='lms_preg_alternativas_eval'> " . (utf8_encode($row2->alternativa)) . "</td>";
                            }
                            $tableRows .= "</tr>";
                        }
                    }
                }
                $js = " <script type = 'text/javascript'>
            </script>";
                $nombre_ev = nombreEvaL($idEval);
                $PRINCIPAL = str_replace("{ID_EVAL}", $idEval, $PRINCIPAL);
                $PRINCIPAL = str_replace("{PROGRAMA}", $programa, $PRINCIPAL);
                $PRINCIPAL = str_replace("{LISTADO_PREGUNTAS}", $tableRows, $PRINCIPAL);
                $PRINCIPAL = str_replace("{EVALUACION}", utf8_encode($nombre_ev[0]->nombre_evaluacion), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CURSO}", $tableRows, $PRINCIPAL);
                $PRINCIPAL = str_replace("{LIST_PREG_JS}", $js, $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function ListarPreguntasEncuestas_LB($PRINCIPAL, $idEval, $programa)
            {

                $secciones = listarSecciones_Encuestas_LB($idEval);
                if (count($secciones) == 0) {
                    $tableRows .= "<tr><td colspan = '4'>No existen secciones para esta encuesta</td></tr>";
                } else if (count($secciones) > 0) {
                    foreach ($secciones as $unico) {
                        $tableRows .= " <thead><tr>";
                        $tableRows .= "<th colspan='3'      class='EncLB_TH' >" . utf8_encode($unico->nombre) . "<br><small>" . utf8_encode($unico->descripcion) . "</small></th>";
                        $tableRows .= "<th                  class='EncLB_TH'><div class='pull-right'><a href='?sw=addSecEnc&idEval=" . $idEval . "&idSec=" . $unico->id_seccion . "' class='btn btn-link'><span class='blanco'><small>Editar</small></span></a></div></th>";
                        $tableRows .= "</tr></thead><tbody> ";


                        $preguntas = listarPreguntas_Encuestas_LB($unico->id_seccion, $idEval);
                        if (count($preguntas) == 0) {
                            $tableRows .= "<tr><td colspan = '4'>No existen preguntas para esta seccion</td></tr>";
                        } else if (count($preguntas) > 0) {
                            foreach ($preguntas as $row1) {
                                $tableRows .= "<tr>";
                                $tableRows .= "<td class='EncLB_TD_sm'>" . $row1->id_pregunta . "</td>";
                                $tableRows .= "<td class='EncLB_TD_sm'>" . (utf8_encode($row1->tipo)) . "</td>";
                                $tableRows .= "<td class='EncLB_TD' style='width=40%' width=50%>" . (utf8_encode($row1->pregunta)) . "</td>";
                                $tableRows .= "<td class='EncLB_TD'><div class='pull-right'><a href='?sw=addPregEnc&idEval=" . $idEval . "&idPreg=" . $row1->id_pregunta . "' class='btn btn-link'><span class='negro'><small>Editar</small></span></a></div></td>";
                                $tableRows .= "</tr>";
                            }
                        }


                        $tableRows .= "<tr>";
                        $tableRows .= "<td colspan='3' class='lms_preg_num_eval'></td>";
                        $tableRows .= "<td class=''><a href='?sw=addPregEnc&idEval=" . $idEval . "&idSecc=" . $unico->id_seccion . "'  class='btn btn-success btn-xs pull-right flat' style='margin-top: 10px;margin-right: 10px;font-size: 14px;'>Agregar Preguntas</a></td>";
                        $tableRows .= "</tr></tbody>  ";

                    }

                }

                $js = " <script type = 'text/javascript'>
            </script>";
                $nombre_ev = utf8_encode(nombreEncuestaLB($idEval));
                $PRINCIPAL = str_replace("{ID_ENCUESTA}", $idEval, $PRINCIPAL);
                $PRINCIPAL = str_replace("{NOMBRE_ENCUESTA}", $nombre_ev, $PRINCIPAL);
                $PRINCIPAL = str_replace("{PROGRAMA}", $programa, $PRINCIPAL);
                $PRINCIPAL = str_replace("{LISTADO_PREGUNTAS}", $tableRows, $PRINCIPAL);
                $PRINCIPAL = str_replace("{EVALUACION}", utf8_encode($nombre_ev[0]->nombre_evaluacion), $PRINCIPAL);
                $PRINCIPAL = str_replace("{CURSO}", $tableRows, $PRINCIPAL);
                $PRINCIPAL = str_replace("{LIST_PREG_JS}", $js, $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function SubirPreguntasMasivo($PRINCIPAL, $idEval, $programa)
            {
                $idEmpresa = $_SESSION["id_empresa"];
                $totalPreg = count(listarRegistrosTablaGlobalFiltro("tbl_evaluaciones_preguntas", "evaluacion", $idEval, ""));
                $evaluacion = BuscarEvaluacion($idEval);
                foreach ($evaluacion as $row) {
                    $PRINCIPAL = str_replace("{EVALUACION}", utf8_encode($row->nombre_evaluacion), $PRINCIPAL);
                    $PRINCIPAL = str_replace("{ID_EVAL}", $row->id, $PRINCIPAL);
                }
                $PRINCIPAL = str_replace("{PROGRAMA}", $programa, $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_EMPRESA}", $idEmpresa, $PRINCIPAL);
                $PRINCIPAL = str_replace("{DISPLAYFORM1}", "display:none;", $PRINCIPAL);
                $PRINCIPAL = str_replace("{DISPLAYFORM2}", "inline", $PRINCIPAL);
                $PRINCIPAL = str_replace("{ENTORNO_PREVIA}", "", $PRINCIPAL);
                $PRINCIPAL = str_replace("{TITULO2}", "Formulario de subida", $PRINCIPAL);
                $PRINCIPAL = str_replace("{TOTAL_PREG}", $totalPreg, $PRINCIPAL);
                $PRINCIPAL = str_replace("{TOT_ACTUALIZAR}", "0", $PRINCIPAL);
                $PRINCIPAL = str_replace("{TOT_INSERTAR}", "0", $PRINCIPAL);
                $PRINCIPAL = str_replace("{TOT_ELIMINAR}", "0", $PRINCIPAL);
                $PRINCIPAL = str_replace("{TOT_DESVINCULAR}", "0", $PRINCIPAL);
                $PRINCIPAL = str_replace("{TOT_ERRORES}", "0", $PRINCIPAL);
                $PRINCIPAL = str_replace("{ERRORES}", "", $PRINCIPAL);
                $PRINCIPAL = str_replace("{DISPLAYERROR}", "display:none;", $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function ExistePregunta($idEval, $idPreg)
            {
                $arrNames = array("evaluacion", "id");
                $arrValues = array($idEval, $idPreg);
                $result = buscarRegistroTablaGlobalFiltros("tbl_evaluaciones_preguntas", $arrNames, $arrValues);
                //var_dump($result);
                if (count($result) > 0) {
                    return true;
                } else {
                    return false;
                }
            }

            function InsertarPreguntasAlternativasTmp($valuesPreg, $valuesAlter, $accion, $idEval, $idEmpresa)
            {
//echo "<br>";echo "<br>Preg<br> ";
//print_r($valuesPreg);  sleep(1);
//echo "<br>";echo "<br>Altermnativas <br> ";
//print_r($valuesAlter);
                //var_dump($valuesPreg);
                //Pregunta//id-id_evaluacion-id_grupo_alternativas-id_empresa-orden-tipo-pregunta-accion
                //Alternativa//id-id_grupo_alternativas-id_empresa-orden-correcta-alternativa-accion
                $nuevoIdGrupoAlter = 0;
                $totalAlter = 0;
                $totalNuevasAlter = 0;
                $arrValuesPreg = explode("|", $valuesPreg);
                // echo "<br><br>";
                //print_r($arrValuesPreg);
                //sleep(1);
                // echo "<br><br>";

                if ($arrValuesPreg[3] == "" || $arrValuesPreg[3] == " ") {
                    $arrValuesPreg[3] = 0;
                }
                if ($arrValuesPreg[1] == 0) {
                    $result = buscarMaxValueTablaGlobal("id_grupo_alternativas", "id", "tbl_evaluaciones_preguntas_tmp");
                    foreach ($result as $row) {
                        $nuevoIdGrupoAlter = $row->id + 1;
                    }
                } else {
                    $nuevoIdGrupoAlter = $arrValuesPreg[4];
                }
                $registroPreg = $arrValuesPreg[3] . ",$idEval,$nuevoIdGrupoAlter,$idEmpresa," . $arrValuesPreg[5] . ",1,'" . ($arrValuesPreg[0]) . "',
    '" . $accion . "','" . ($arrValuesPreg[1]) . "','" . ($arrValuesPreg[2]) . "'";
                $arrValuesAlter = explode("|", $valuesAlter);
//print_r($arrValuesAlter);
                if ($arrValuesAlter[1] == "" || $arrValuesAlter[1] == " ") {
                    $separador = "";
                    for ($i = 0; $i < count($arrValuesAlter); $i++) {
                        $valoresIdsAlter[$i] .= $separador . "0";
                        $separador = "_";
                    }
                } else {
                    $valoresIdsAlter = explode("_", $arrValuesAlter[1]);
                    for ($i = 2; $i < count($arrValuesAlter); $i++) {
                        if (strlen($arrValuesAlter[$i]) > 0) {
                            $totalAlter++;
                        }
                    }
                    $totalAlterNuevas = $totalAlter - count($valoresIdsAlter);
                    for ($j = 0; $j < $totalAlterNuevas; $j++) {
                        array_push($valoresIdsAlter, "0");
                    }
                }
//echo "<br><br>";var_dump($valoresIdsAlter);
                $registroAlter = "{ID},$nuevoIdGrupoAlter,$idEmpresa,{ORDEN},{CORRECTA}";
                $arrRegistrosAlter = array();
                for ($x = 1; $x < count($arrValuesAlter); $x++) {
                    if ($arrValuesAlter[$x] == "" || $arrValuesAlter[$x] == " ") {
                        break;
                    } else {
                        $arrRegistrosAlter[$x - 1] = $registroAlter . ",'" . ($arrValuesAlter[$x]) . "','{ACCION}'";
                        $arrRegistrosAlter[$x - 1] = str_replace("{ORDEN}", $x - 1, $arrRegistrosAlter[$x - 1]);
                        if ($valoresIdsAlter[$x - 1] == 0) {
                            $arrRegistrosAlter[$x - 1] = str_replace("{ID}", 0, $arrRegistrosAlter[$x - 1]);
                            $arrRegistrosAlter[$x - 1] = str_replace("{ACCION}", "INSERTAR", $arrRegistrosAlter[$x - 1]);
                        } else {
                            $arrRegistrosAlter[$x - 1] = str_replace("{ID}", $valoresIdsAlter[$x - 1], $arrRegistrosAlter[$x - 1]);
                            $arrRegistrosAlter[$x - 1] = str_replace("{ACCION}", "ACTUALIZAR", $arrRegistrosAlter[$x - 1]);
                        }
                    }
                }
                //print_r($arrRegistrosAlter);
                $result = insertarPreguntaAlternativaTmp($registroPreg, $arrRegistrosAlter, $arrValuesAlter[0]);
                return $result;
            }

            function ListarPreguntasMasivoPreview($idEmpresa, $idEval)
            {
                $table = "<div class='box-body table-responsive'>";
                $table .= "<table id='example2' class='table table-bordered table-hover sortable'>";
                $table .= "<thead>";
                $table .= "<tr>";
                $table .= "<th>ACCI&OacuteN</th>";
                $table .= "<th>ORDEN</th>";
                $table .= "<th>PREGUNTA</th>";
                $table .= "<th>NUM ALTERNATIVAS</th>";
                $table .= "</tr>";
                $table .= "</thead>";
                $table .= "<tbody>";
                $arrNames = array("id_evaluacion", "id_empresa");
                $arrValues = array($idEval, $idEmpresa);
                $preguntas = listarRegistrosTablaGlobalFiltros("tbl_evaluaciones_preguntas_tmp", $arrNames, $arrValues, "orden asc");
                foreach ($preguntas as $row1) {
                    $table .= "<tr>";
                    $table .= "<td>" . $row1->accion . "</td>";
                    $table .= "<td>" . $row1->orden . "</td>";
                    $table .= "<td>" . (($row1->pregunta)) . "</td>";
                    $arrNames = array("id_grupo_alternativas", "id_empresa");
                    $arrValues = array($row1->id_grupo_alternativas, $idEmpresa);
                    $alternativas = listarRegistrosTablaGlobalFiltros("tbl_evaluaciones_alternativas_tmp", $arrNames, $arrValues, "");
                    $table .= "<td>" . count($alternativas) . "</td>";
                    $table .= "</tr>";
                }
                $table .= "</tbody>";
                $table .= "</table>";
                $table .= "</div>";
                return $table;
            }

            function EliminarDatosPreguntasAlternativasTmp()
            {
                truncarTablaGlobal("tbl_evaluaciones_preguntas_tmp");
                truncarTablaGlobal("tbl_evaluaciones_alternativas_tmp");
            }

            function BuscarEvaluacion($idEval)
            {
                return buscarRegistroTablaGlobalFiltro("tbl_evaluaciones", "id", $idEval);
            }

            function BuscarMaxIdGrupoAlternativa()
            {
                $idMaximo = 0;
                $result = buscarMaxValueTablaGlobal("id_grupo_alternativas", "id", "tbl_evaluaciones_alternativas");
                foreach ($result as $row) {
                    $idMaximo = $row->id_grupo_alternativas;
                }
                return $idMaximo;
            }

            function EditarPreguntaAlternativas($PRINCIPAL, $idEval, $idGrupo)
            {
                $arrNames = array("evaluacion", "id_grupo_alternativas");
                $arrValues = array($idEval, $idGrupo);
                $pregunta = buscarRegistroTablaGlobalFiltros("tbl_evaluaciones_preguntas", $arrNames, $arrValues);
                $alternativas = buscarRegistroTablaGlobalFiltro("tbl_evaluaciones_alternativas", "id_grupo_alternativas", $idGrupo);
                $PRINCIPAL = str_replace("{TITULO}", "Editar Pregunta", $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_EVAL}", $idEval, $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_GRUPO}", $idGrupo, $PRINCIPAL);
                $body = "";
                foreach ($pregunta as $row) {
                    $pregunta = str_replace('"', "", $row->pregunta);
                    $PRINCIPAL = str_replace("{PREGUNTA}", (utf8_encode($pregunta)), $PRINCIPAL);
                }
                $numCorrecta = 0;
                foreach ($alternativas as $row) {
                    $correcta = "";
                    if ($row->correcta == 1) {
                        $correcta = "checked";
                        $numCorrecta = $row->orden;
                    }
                    $body .= "<div class='form-group col-md-12'>";
                    $body .= "<label style='font-weight:bold'>Alternativa " . $row->orden . "</label>";
                    $body .= "<div class='input-group'>";
                    $body .= "<span class='input-group-addon'><input onchange='cambiarCorrecta(this)' type='radio' name=correcta[] value='" . $row->orden . "' $correcta></span>";
                    $body .= "<input type='text' class='form-control' name='alternativa_" . $row->orden . "' value='" . (utf8_encode($row->alternativa)) . "' />";
                    $body .= "</div>";
                    $body .= "<input type='hidden'  value='" . $row->id . "'  name='idAlter_" . $row->orden . "'/>";
                    $body .= "</div>";
                }
                $body .= "<input type='hidden'  value='$numCorrecta'  name='alternativaCorrecta' id='alternativaCorrecta'/>";
                $PRINCIPAL = str_replace("{TOT_ALTER}", count($alternativas), $PRINCIPAL);
                $PRINCIPAL = str_replace("{ALTERNATIVAS}", $body, $PRINCIPAL);
                $PRINCIPAL = str_replace("{BOTON}", "Guardar Cambios", $PRINCIPAL);
                return ($PRINCIPAL);
            }

            function CruzarPreguntasAlternativasTmpConOriginal($idEmpresa, $idEval)
            {
                $arrNames = array("id_empresa", "id_evaluacion");
                $arrValues = array($idEmpresa, $idEval);
                $preguntasTmp = listarRegistrosTablaGlobalFiltros("tbl_evaluaciones_preguntas_tmp", $arrNames, $arrValues, "");
                //print_r($preguntasTmp);exit;
                //traigo las preguntas que ahora en la base estan ingresadas por la evaluacion
                $preguntas_base = ListadoDePreguntasDadaEvaluacion($idEval);
                //Por cada pregunta, veo si estan en la tabla temporal, si no esta, la elimino.
                foreach ($preguntas_base as $preg_orig) {
                    //Verifico si esta en la tabla de temporales, si no está, la elimino de la base
                    $esta_pregunta_en_tmp = VerificoPreguntaEnTablaPReguntasTmp($preg_orig->id);
                    if (!$esta_pregunta_en_tmp) {
                        EliminoPreguntayalternativasDadoIdPregunta($preg_orig->id, $preg_orig->id_grupo_alternativas);
                        //echo "deberia haber borrado la la pregunta ".$preg_orig->id;exit;
                    }
                    //Con el id grupo alternativa, traigo todas las alternativas de la tabla de alternativas
                    $alternativas = TraigoAernativasDadoIdGrupoAlternativaV2($preg_orig->id_grupo_alternativas);
                    foreach ($alternativas as $alt_unico) {
                        //Verifico si esta alternativa esta en la tabla de alternativas temporales, si no esta la borro
                        $estaAltEnTmp = VerificoSiAlterativaEstEnTmp($alt_unico->id);
                        if (!$estaAltEnTmp) {
                            EliminoAlternativasDadoIdPregunta($alt_unico->id);
                        }
                    }
                }
                //echo count($preguntas_base);
                //exit;
                $alternativasTmp = listarRegistrosTablaGlobalFiltro("tbl_evaluaciones_alternativas_tmp", "id_empresa", $idEmpresa, "");
                //var_dump($alternativasTmp);
                foreach ($preguntasTmp as $row1) {
                    if ($row1->id == 0) {
                        insertarRegistroTablaGlobal("tbl_evaluaciones_preguntas", "id,evaluacion,id_grupo_alternativas,orden,tipo,pregunta, refuerzo1, refuerzo2", "null," . $row1->id_evaluacion . "," . $row1->id_grupo_alternativas . "," . $row1->orden . "," . $row1->tipo . ",'" . utf8_encode($row1->pregunta) . "','" . utf8_encode($row1->refuerzo1) . "','" . utf8_encode($row1->refuerzo2) . "'");
                    } else {
                        actualizarRegistroTablaGlobalFiltro("tbl_evaluaciones_preguntas", "orden=" . $row1->orden . ",
            tipo=1,
            refuerzo1='" . $row1->refuerzo1 . "',
            id_grupo_alternativas='" . $row1->id_grupo_alternativas . "',
            refuerzo2='" . $row1->refuerzo2 . "' ,
            pregunta='" . utf8_encode($row1->pregunta) . "'", "id", $row1->id);
                    }
                    foreach ($alternativasTmp as $row2) {
                        if ($row2->id == 0 && $row2->id_grupo_alternativas == $row1->id_grupo_alternativas) {
                            insertarRegistroTablaGlobal("tbl_evaluaciones_alternativas", "id,id_grupo_alternativas,orden,correcta,alternativa", "null," . $row2->id_grupo_alternativas . "," . $row2->orden . "," . $row2->correcta . ",'" . utf8_encode($row2->alternativa) . "'");
                        } else if ($row2->id > 0 && $row2->id_grupo_alternativas == $row1->id_grupo_alternativas) {
                            actualizarRegistroTablaGlobalFiltro("tbl_evaluaciones_alternativas", "orden=" . $row2->orden . ",correcta=" . $row2->correcta . ",alternativa='" . utf8_encode($row2->alternativa) . "'", "id", $row2->id);
                        }
                    }
                }
            }

            function InsertarRegistroParaCalculoTablaPreguntasTmp()
            {
                $maxGrupoAlterId = 0;
                //$result = buscarMaxValueTablaGlobal("id_grupo_alternativas","id","tbl_evaluaciones_preguntas");
                $result = buscarMaxValueTablaGlobal("id_grupo_alternativas", "id", "tbl_evaluaciones_alternativas");
                foreach ($result as $row) {
                    $maxGrupoAlterId = $row->id;
                }
                insertarRegistroTablaGlobal("tbl_evaluaciones_preguntas_tmp", "id_grupo_alternativas", $maxGrupoAlterId);
            }

            function ContarRegistrosTablaGlobalFiltro($tableName, $filterName, $filterValue)
            {
                $total = listarRegistrosTablaGlobalFiltro($tableName, $filterName, $filterValue, "");
                return count($total);
            }

            function GAMIFICACIONResultadosPorSoloCursoPuntos($rut, $id_curso, $id_empresa)
            {
                $puntos_por_curso = GAMIFICACION_NotaPorSoloCursoPuntosUsuarioEmpresa($rut, $id_curso, $id_empresa);
                $puntos = $puntos_por_curso[0]->puntos;
                return ($puntos);
            }

            function limpiarSimbolosExtranos($s)
            {
//Quitando Caracteres Especiales
                $s = str_replace('"', '', $s);
                $s = str_replace(':', '', $s);
                $s = str_replace('.', '', $s);
                $s = str_replace(',', '', $s);
                $s = str_replace(';', '', $s);
                $s = str_replace(' ', '', $s);
                $s = str_replace('  ', '', $s);
                return $s;
            }

            function limpiarSimbolosExtranosSinPuntos($s)
            {
//Quitando Caracteres Especiales
                $s = str_replace('"', '', $s);
                $s = str_replace(':', '', $s);
                $s = str_replace(',', '', $s);
                $s = str_replace(';', '', $s);
                $s = str_replace('  ', '', $s);
                return $s;
            }

/****
 * Inicio Modulo Finanzas
***/
/**
* @return Array
*/
function GetFacturas()
{
    $result = array("draw" => 0, "recordsTotal" => 0, "recordsFiltered" => 0, "data" => []);
    $facturas = Lista_Facturas();
    foreach ($facturas as $key => $row){
        $facturas[$key]->factur_tipdocid = Encodear3($row->factur_tipdocid);
        $facturas[$key]->factur_servid = Encodear3($row->factur_servid);
        $facturas[$key]->factur_cui = Encodear3($row->factur_cui);
        $facturas[$key]->factur_respgastEncodeado = Encodear3($row->factur_respgast);
    }
    $cantidad = count($facturas);
    $result['recordsTotal'] = $cantidad;
    $result['recordsFiltered'] = $cantidad;
    $result['data'] = [];
    if($cantidad>0){
        $result['data'] = $facturas;
    }
    return $result;
}

function GetReembolsos()
{
    $result = array("draw" => 0, "recordsTotal" => 0, "recordsFiltered" => 0, "data" => []);
    $reembolsos = Lista_Reembolsos();
    foreach ($reembolsos as $key => $row){
        $reembolsos[$key]->reembo_tipdocid = Encodear3($row->reembo_tipdocid);
        $reembolsos[$key]->reembo_servid = Encodear3($row->reembo_servid);
        $reembolsos[$key]->reembo_cui = Encodear3($row->reembo_cui);
        $reembolsos[$key]->reembo_respgastEncodeado = Encodear3($row->reembo_respgast);
    }
    $cantidad = count($reembolsos);
    $result['recordsTotal'] = $cantidad;
    $result['recordsFiltered'] = $cantidad;
    $result['data'] = [];
    if($cantidad>0){
        $result['data'] = $reembolsos;
    }
    return $result;
}
function ListarTiposDocumentosFinanza($cat){
    $optionsTipos = "";
    $tipos = ListarTiposDocumentosFinanzaData($cat);
    foreach ($tipos as $row){
        $idEncodeado = Encodear3($row->tipdoc_id);
        $documento = utf8_encode(strtoupper($row->tipdoc_dsc));
        $optionsTipos .="<option value='{$idEncodeado}'>{$documento}</option>";
    }
    return $optionsTipos;
}
function ListarServiciosFinanza(){
    $optionsServicios = "";
    $servicios = ListarServiciosFinanzaData();
    foreach ($servicios as $row){
        $idEncodeado = Encodear3($row->servic_id);
        $servicio = utf8_encode(strtoupper($row->servic_dsc));
        $optionsServicios .="<option value='{$idEncodeado}'>{$servicio}</option>";
    }
    return $optionsServicios;
}
function ListarCuentasFinanza(){
    $optionsCuentas = "";
    $servicios = ListarCuentasFinanzaData();
    foreach ($servicios as $row){
        $idEncodeado = $row->cuenta_num;
        $cuenta = utf8_encode(strtoupper($row->cuenta_dsc));
        $optionsCuentas .="<option value='{$idEncodeado}'>{$cuenta}</option>";
    }
    return $optionsCuentas;
}
function ListarProyectosFinanza(){
    $optionsProyectos = "";
    $servicios = ListarProyectosFinanzaData();
    foreach ($servicios as $row){
        $idEncodeado = Encodear3($row->id);
        $cuenta = $row->cuenta;
        $proyecto = utf8_encode(strtoupper($row->nombre_programa));
        $optionsProyectos .="<option class='optionProyecto optionProyecto{$cuenta}' value='{$proyecto}'>{$proyecto}</option>";
    }
    return $optionsProyectos;
}
function ListarCUIFinanza(){
    $optionsCui = "";
    $servicios = ListarCUIFinanzaData();
    foreach ($servicios as $row){
        $idEncodeado = Encodear3($row->cui_codigo);
        $cui = utf8_encode(strtoupper($row->cui_desc));
        $optionsCui .="<option value='{$idEncodeado}'>{$cui}</option>";
    }
    return $optionsCui;
}
function ListResponsables(){
    $responsables = "";
    $consulResp = ListResponsablesData();
    foreach ($consulResp as $row){
        if(!isset($responsables[$row->respon_tipresid])){
            $responsables[$row->respon_tipresid] = [];
        }
        $responsables[$row->respon_tipresid][$row->respon_id]['rut']=$row->respon_rutresp;
        $responsables[$row->respon_tipresid][$row->respon_id]['nombre']=$row->nombre_completo;
        $responsables[$row->respon_tipresid][$row->respon_id]['sla']=$row->tipres_sla_factura;
        $responsables[$row->respon_tipresid][$row->respon_id]['slareem']=$row->tipres_sla_reembolso;
    }
    return $responsables;
}
function saveDatosGeneralesFactura($factur_numdoc, $factur_tipdocid, $factur_proveerut,
                                  $factur_servid, $factur_servotro, $factur_montoto, $factur_montonet, $factur_impuest,
                                  $factur_fecemision, $factur_ota, $factur_numota, $factur_cuenta,
                                  $factur_proyecto, $factur_curso, $factur_otanombre, $factur_cui,
                                  $factur_respgast, $factur_observacion, $factur_mes, $factur_anual,$factur_status,$factura_proveenom,$rut_created,$factur_cuenta_nombre){

    $result = array("code"=>1, "mensage"=>"Actualizado");
    //Se validan los datos recibidos antes de ser guardados

    //Se verifica el numero de documento proporcionado no se repita
    $consulNumDocFac = facturaFinanzaByNumdoc($factur_numdoc);
    if(count($consulNumDocFac)==0){
        //Se ubica el id del proveedor segun el rut suministrado
        $consulOtec=DatosOtecDadoRut($factur_proveerut);
        $factur_proveeid=$consulOtec[0]->id;

        //Se ubica el id de la cuenta segun el numero suministrado
        $factur_cuentaid=0;

        //Se ubica el id del proyecto segun el nombre suministrado
        $consulProyecto=DatosProgramaByNombre($factur_proyecto);
        $factur_proyectid=$consulProyecto[0]->id;

        $factur_tipdocid = Decodear3($factur_tipdocid);
        $factur_servid = Decodear3($factur_servid);
        $factur_cui = Decodear3($factur_cui);
        $factur_respgast = Decodear3($factur_respgast);
        if($factur_ota!="on"){
            $factur_ota=0;
        } else {
            $factur_ota=1;
        }
        return saveDatosGeneralesFacturaData($factur_numdoc, $factur_tipdocid, $factur_proveeid, $factur_proveerut,
                                      $factur_servid, $factur_servotro, $factur_montoto, $factur_montonet, $factur_impuest,
                                      $factur_fecemision, $factur_ota, $factur_numota, $factur_cuentaid, $factur_cuenta,
                                      $factur_proyectid, $factur_proyecto, $factur_curso, $factur_otanombre, $factur_cui,
                                      $factur_respgast, $factur_observacion, $factur_mes, $factur_anual,$factur_status,$factura_proveenom,$rut_created,$factur_cuenta_nombre);
    } else {
        $result = array("code"=>0, "mensage"=>"Número de documento ya existe");
    }
    return $result;
}
function saveDatosGeneralesReembolso($reembo_numdoc, $reembo_tipdocid,$reembo_tipdocOtro, $reembo_proveerut,
                                  $reembo_servid, $reembo_servotro, $reembo_montoto,
                                  $reembo_fecemision, $reembo_ota, $reembo_numota, $reembo_cuenta,
                                  $reembo_proyecto, $reembo_curso, $reembo_otanombre, $reembo_cui,
                                  $reembo_respgast, $reembo_observacion, $reembo_mes, $reembo_anual,$reembo_status,$reemboa_proveenom,$rut_created,$reembo_cuenta_nombre){

    $result = array("code"=>1, "mensage"=>"Actualizado");
    //Se validan los datos recibidos antes de ser guardados

    //Se verifica el numero de documento proporcionado no se repita
    $consulNumDocReemb= reembolsoFinanzaByNumdoc($reembo_numdoc);
    if(count($consulNumDocReemb)==0){
        //Se ubica el id del proveedor segun el rut suministrado
        $reembo_proveeid=$reembo_proveerut;

        //Se ubica el id de la cuenta segun el numero suministrado
        $reembo_cuentaid=0;

        //Se ubica el id del proyecto segun el nombre suministrado
        $consulProyecto=DatosProgramaByNombre($reembo_proyecto);
        $reembo_proyectid=$consulProyecto[0]->id;

        $reembo_tipdocid = Decodear3($reembo_tipdocid);
        $reembo_servid = Decodear3($reembo_servid);
        $reembo_cui = Decodear3($reembo_cui);
        $reembo_respgast = Decodear3($reembo_respgast);
        if($reembo_ota!="on"){
            $reembo_ota=0;
        } else {
            $reembo_ota=1;
        }
        return saveDatosGeneralesReembolsoData($reembo_numdoc, $reembo_tipdocid,$reembo_tipdocOtro, $reembo_proveeid, $reembo_proveerut,
                                      $reembo_servid, $reembo_servotro, $reembo_montoto,
                                      $reembo_fecemision, $reembo_ota, $reembo_numota, $reembo_cuentaid, $reembo_cuenta,
                                      $reembo_proyectid, $reembo_proyecto, $reembo_curso, $reembo_otanombre, $reembo_cui,
                                      $reembo_respgast, $reembo_observacion, $reembo_mes, $reembo_anual,$reembo_status,$reemboa_proveenom,$rut_created,$reembo_cuenta_nombre);
    } else {
        $result = array("code"=>0, "mensage"=>"Número de documento ya existe");
    }
    return $result;
}

function updateDatosGeneralesFactura($id,$factur_numdoc, $factur_tipdocid, $factur_proveerut,
                                      $factur_servid, $factur_servotro, $factur_montoto, $factur_montonet, $factur_impuest,
                                      $factur_fecemision, $factur_ota, $factur_numota, $factur_cuenta,
                                      $factur_proyecto, $factur_curso, $factur_otanombre, $factur_cui,
                                      $factur_respgast, $factur_observacion, $factur_mes, $factur_anual,$factur_status,$factura_proveenom,$factur_cuenta_nombre){

    //Se validan los datos recibidos antes de ser guardados
    //Se ubica el id del proveedor segun el rut suministrado
    $consulOtec=DatosOtecDadoRut($factur_proveerut);
    $factur_proveeid=$consulOtec[0]->id;

    //Se ubica el id de la cuenta segun el numero suministrado
    $factur_cuentaid=0;

    //Se ubica el id del proyecto segun el nombre suministrado
    $consulProyecto=DatosProgramaByNombre($factur_proyecto);
    $factur_proyectid=$consulProyecto[0]->id;
    if($factur_ota!="on"){
        $factur_ota=0;
    } else {
        $factur_ota=1;
    }
    $factur_tipdocid = Decodear3($factur_tipdocid);
    $factur_servid = Decodear3($factur_servid);
    $factur_cui = Decodear3($factur_cui);
    $factur_respgast = Decodear3($factur_respgast);
    return updateDatosGeneralesFacturaData($id,$factur_numdoc, $factur_tipdocid, $factur_proveeid, $factur_proveerut,
                                  $factur_servid, $factur_servotro, $factur_montoto, $factur_montonet, $factur_impuest,
                                  $factur_fecemision, $factur_ota, $factur_numota, $factur_cuentaid, $factur_cuenta,
                                  $factur_proyectid, $factur_proyecto, $factur_curso, $factur_otanombre, $factur_cui,
                                  $factur_respgast, $factur_observacion, $factur_mes, $factur_anual,$factur_status,$factura_proveenom,$factur_cuenta_nombre);
}
function updateDatosGeneralesReembolso($id,$reembo_numdoc, $reembo_tipdocid,$reembo_tipdocOtro, $reembo_proveerut,
                                      $reembo_servid, $reembo_servotro, $reembo_montoto, $reembo_montonet, $reembo_impuest,
                                      $reembo_fecemision, $reembo_ota, $reembo_numota, $reembo_cuenta,
                                      $reembo_proyecto, $reembo_curso, $reembo_otanombre, $reembo_cui,
                                      $reembo_respgast, $reembo_observacion, $reembo_mes, $reembo_anual,$reembo_status,$reemboa_proveenom,$reembo_cuenta_nombre){

    //Se validan los datos recibidos antes de ser guardados
    $reembo_proveeid=$reembo_proveerut;

    //Se ubica el id de la cuenta segun el numero suministrado
    $reembo_cuentaid=0;

    //Se ubica el id del proyecto segun el nombre suministrado
    $consulProyecto=DatosProgramaByNombre($reembo_proyecto);
    $reembo_proyectid=$consulProyecto[0]->id;
    if($reembo_ota!="on"){
        $reembo_ota=0;
    } else {
        $reembo_ota=1;
    }
    $reembo_tipdocid = Decodear3($reembo_tipdocid);
    $reembo_servid = Decodear3($reembo_servid);
    $reembo_cui = Decodear3($reembo_cui);
    $reembo_respgast= Decodear3($reembo_respgast);
    return updateDatosGeneralesReembolsoData($id,$reembo_numdoc, $reembo_tipdocid,$reembo_tipdocOtro, $reembo_proveeid, $reembo_proveerut,
                                  $reembo_servid, $reembo_servotro, $reembo_montoto, $reembo_montonet, $reembo_impuest,
                                  $reembo_fecemision, $reembo_ota, $reembo_numota, $reembo_cuentaid, $reembo_cuenta,
                                  $reembo_proyectid, $reembo_proyecto, $reembo_curso, $reembo_otanombre, $reembo_cui,
                                  $reembo_respgast, $reembo_observacion, $reembo_mes, $reembo_anual,$reembo_status,$reemboa_proveenom,$reembo_cuenta_nombre);
}
function getRespById($idFac){
    $responsables = [];
    $consulRespById = getRespByIdData($idFac);
    foreach($consulRespById as $row){
        $responsables[$row->facres_tiprespid]=array("resprut"=>Encodear3($row->facres_rut),"respnom"=>$row->facres_nomcom,"tipo"=> $row->tipres_desc,"recep"=>$row->facres_fecrecep, "envio"=>$row->facres_fecenv, "sla"=>$row->facres_sla);
    }
    return $responsables;
}
function getRespReemboById($idResp){
    $responsables = [];
    $consulRespById = getRespReemboByIdData($idResp);
    foreach($consulRespById as $row){
        $responsables[$row->reemres_tiprespid]=array("resprut"=>Encodear3($row->reemres_rut),"respnom"=>$row->reemres_nomcom,"tipo"=> $row->tipres_desc, "recep"=>$row->reemres_fecrecep, "envio"=>$row->reemres_fecenv, "sla"=>$row->reemres_sla);
    }
    return $responsables;
}
function getDocumentoById($idFac){
    $documentos = getDocumentoByIdData($idFac);
    return $documentos;
}
function getDocumentoReemboById($idRem){
    $documentos = getDocumentoReemboByIdData($idRem);
    return $documentos;
}