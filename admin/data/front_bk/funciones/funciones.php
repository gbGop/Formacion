<?php

function VerificaExtensionFiles($file){
    //ECHO "<BR>VerificaExtensionFiles $file<BR>";
    //print_r($_FILES);
    //print_r($file);
    $file=trim($file);
    $file = strval($file);
    //ECHO "<BR>str file $file";
    //echo "<br>gettyp ".gettype($file);


    //echo "A";
    //echo "<script>alert('verifica');</script>";
    //echo "<br>file $file";
   // echo "<br>gettyp ".gettype($file);

    $arreglo_archivo = explode(".", $file);
    //echo "B";
    //exit();
    $extension_archivo = $arreglo_archivo[1];
    //echo "<br>cuenta ".count($arreglo_archivo);		print_r($arreglo_archivo);	echo "<br>ex $extension_archivo";

    if(count($arreglo_archivo)<>2){
        echo "<script>alert('Formato de Archivo Incompatible'); location.href='?sw=home_landing_2020';</script>";exit();
    }

    if($extension_archivo=="pdf" or $extension_archivo=="PDF" or $extension_archivo=="ppt" or $extension_archivo=="PPT"
        or $extension_archivo=="pptx" or $extension_archivo=="PPTX" or $extension_archivo=="doc" or $extension_archivo=="DOC"
        or $extension_archivo=="docx" or $extension_archivo=="DOCX" or $extension_archivo=="xls" or $extension_archivo=="XLS"
        or $extension_archivo=="xlsx" or $extension_archivo=="XLSX" or $extension_archivo=="jpg" or $extension_archivo=="JPG"
        or $extension_archivo=="jpeg" or $extension_archivo=="JPEG" or $extension_archivo=="zip" or $extension_archivo=="ZIP"
        or $extension_archivo=="gif" or $extension_archivo=="GIF" or $extension_archivo=="png" or $extension_archivo=="PNG")	{
        //echo "<br>archivo valido";
    } else {
        echo "<br>archivo invalido";	 echo "    <script>alert('Formato de Archivo Incompatible'); 			location.href='?sw=home_landing_2020';    </script>";exit();
    }


    /*FUNCION LIMPIA CABECERA*/
    $fileDir = $_FILES['archivo']['tmp_name'];
    if($fileDir!=""){
        $file = fopen($fileDir, "r");
        //Output lines until EOF is reached
        $palabras = array('/JS', '/JavaScript', '/Action', '/js', '/javascript', '/action');
        $encontrada=false;
        while(! feof($file)) {
            $line = fgets($file);
            foreach($palabras as $palabra) {
                if (strpos($line, $palabra) !== false) {
                    $encontrada = true;
                    break;
                }
            }
        }
    }

    if($encontrada){
        echo "<script>alert('Formato de Archivo Incompatible'); location.href='?sw=home_landing_2020';</script>";exit();
    }

}


function VerificaExtensionFiles2($file){
    //ECHO "<BR>VerificaExtensionFiles $file<BR>";
    //print_r($_FILES);
    //print_r($file);
    $file=trim($file);
    $file = strval($file);
    //ECHO "<BR>str file $file";
    //echo "<br>gettyp ".gettype($file);


    //echo "A";
    //echo "<script>alert('verifica');</script>";
    //echo "<br>file $file";
    // echo "<br>gettyp ".gettype($file);

    $arreglo_archivo = explode(".", $file);
    //echo "B";
    //exit();
    $extension_archivo = $arreglo_archivo[1];
    //echo "<br>cuenta ".count($arreglo_archivo);		print_r($arreglo_archivo);	echo "<br>ex $extension_archivo";

    if(count($arreglo_archivo)<>2){
        echo "<script>alert('Formato de Archivo Incompatible'); location.href='?sw=home_landing_2020';</script>";exit();
    }

    if($extension_archivo=="pdf" or $extension_archivo=="PDF" or $extension_archivo=="ppt" or $extension_archivo=="PPT"
        or $extension_archivo=="pptx" or $extension_archivo=="PPTX" or $extension_archivo=="doc" or $extension_archivo=="DOC"
        or $extension_archivo=="docx" or $extension_archivo=="DOCX" or $extension_archivo=="xls" or $extension_archivo=="XLS"
        or $extension_archivo=="xlsx" or $extension_archivo=="XLSX" or $extension_archivo=="jpg" or $extension_archivo=="JPG"
        or $extension_archivo=="jpeg" or $extension_archivo=="JPEG" or $extension_archivo=="zip" or $extension_archivo=="ZIP"
        or $extension_archivo=="gif" or $extension_archivo=="GIF" or $extension_archivo=="png" or $extension_archivo=="PNG")	{
        //echo "<br>archivo valido";
    } else {
        echo "<br>archivo invalido";	 echo "    <script>alert('Formato de Archivo Incompatible'); 			location.href='?sw=home_landing_2020';    </script>";exit();
    }


    /*FUNCION LIMPIA CABECERA*/
    $fileDir = $_FILES['archivo2']['tmp_name'];
    if($fileDir!=""){
        $file = fopen($fileDir, "r");
        //Output lines until EOF is reached
        $palabras = array('/JS', '/JavaScript', '/Action', '/js', '/javascript', '/action');
        $encontrada=false;
        while(! feof($file)) {
            $line = fgets($file);
            foreach($palabras as $palabra) {
                if (strpos($line, $palabra) !== false) {
                    $encontrada = true;
                    break;
                }
            }
        }
    }

    if($encontrada){
        echo "<script>alert('Formato de Archivo Incompatible'); location.href='?sw=home_landing_2020';</script>";exit();
    }

}
function InsertaRegistroFinalizadoObjetoAjax($rut, $id_curso, $id_objeto, $simulador){
	if($simulador){
		InsertaObjetoFinalizadoCierreTBL($rut, $id_objeto, $id_curso, "78");
	}
}
function Tickets_SubirArchivos2Tickets($FILES, $extension_doc, $prefijo, $ruta, $numero, $nombre_file)
{
	

		//ini_set('display_errors', 1);ini_set('display_startup_errors', 1);error_reporting(E_ALL);
    //$ruta_con_archivo=$ruta."/".$prefijo."_BK.".$extension_archivo;
    $ruta_con_archivo = $ruta . "/" . $prefijo . "." . $extension_doc;
    copy($FILES["archivo2"]['tmp_name'], $ruta_con_archivo);
    $nombre_imagen_video = $prefijo . "." . $extension_doc;
    //RedimensionarImagenSlider($ruta_con_archivo, $nombre_imagen_slider);
    //Devuelvol un arreglo, con datos del archivo subido
    $arreglo[0]          = $ruta_con_archivo; //Ruta Completa
    $arreglo[1]          = $prefijo . "." . $extension_doc; //Nombre del Archivo
    $arreglo[2]          = $ruta . "/" . $prefijo; //Ruta del Objeto sin el index
   // print_r($arreglo);
    //exit;
    if($extension_doc==""){
    	$arreglo[1]="";
    }
    
    return ($arreglo);
}
function colocarResultadosUsuariosFullTextiografiasoloClick_Colaboracion_2021($PRINCIPAL, $q, $id_empresa)
{
    $listado = BuscaUsuarioDadoFullTexto($q,$id_empresa);

    //print_r($listado);
    foreach ($listado as $unico) {
        //echo "<br><br>rut ".$unico->rut;
        $array_Reco_Gracias = BuscaDatosReconocimientoAgradecimientos($unico->rut, $id_empresa);
        //print_r($array_Reco_Gracias);
        if ($array_Reco_Gracias[0]->num_gracias > 0) {
            $num_gracias = $array_Reco_Gracias[0]->num_gracias;
        } else {
            $num_gracias = 0;
        }
        if ($array_Reco_Gracias[0]->num_reconocimientos > 0) {
            $num_reconocimientos = $array_Reco_Gracias[0]->num_reconocimientos;
        } else {
            $num_reconocimientos = 0;
        }
        //echo "<br>views/mi_equipo_lider/".$id_empresa."_row_ultimos_ingresos_soloclick.html";
        $row_ULTIMOS .= file_get_contents("views/reconoce_vota/" . $id_empresa . "_row_soloclick_reco_colaboracion_2021.html");
        $row_ULTIMOS = str_replace("{MEDALLAS}", $medallas, $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{NOMBRE}", $unico->nombre . " " . $unico->apaterno . " " . $unico->amaterno, $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{NOMBRE_CORTO}", $unico->nombre  , $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{CARGO}", $unico->cargo, $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{GERENCIA}", $unico->gerencia, $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{RUT}", Encodear5($unico->rut), $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{NUM_RECONOCIMIENTOS}", $num_reconocimientos, $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{NUM_GRACIAS}", $num_gracias, $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{URL_PERSONA}", utf8_decode(VerificaFotoPersonal($unico->rut)), $row_ULTIMOS);
        $cuenta_colaborador++;
    }

    $PRINCIPAL = str_replace("{BLOQUE_COLABORADORES_COLABORADOR_21}", utf8_encode($row_ULTIMOS), $PRINCIPAL);
    return ($PRINCIPAL);
}
function colocarResultadosUsuariosFullTextiografiasoloClick_2020($PRINCIPAL, $q, $id_empresa)
{
    $listado = BuscaUsuarioDadoFullTexto($q,$id_empresa);

    //print_r($listado);
    foreach ($listado as $unico) {
        //echo "<br><br>rut ".$unico->rut;
        $array_Reco_Gracias = BuscaDatosReconocimientoAgradecimientos($unico->rut, $id_empresa);
        //print_r($array_Reco_Gracias);
        if ($array_Reco_Gracias[0]->num_gracias > 0) {
            $num_gracias = $array_Reco_Gracias[0]->num_gracias;
        } else {
            $num_gracias = 0;
        }
        if ($array_Reco_Gracias[0]->num_reconocimientos > 0) {
            $num_reconocimientos = $array_Reco_Gracias[0]->num_reconocimientos;
        } else {
            $num_reconocimientos = 0;
        }
        //echo "<br>views/mi_equipo_lider/".$id_empresa."_row_ultimos_ingresos_soloclick.html";
        $row_ULTIMOS .= file_get_contents("views/personas/" . $id_empresa . "_row_ultimos_ingresos_soloclick_2020.html");
        $row_ULTIMOS = str_replace("{MEDALLAS}", $medallas, $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{NOMBRE}", $unico->nombre . " " . $unico->apaterno . " " . $unico->amaterno, $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{NOMBRE_CORTO}", $unico->nombre  , $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{CARGO}", $unico->cargo, $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{GERENCIA}", $unico->gerencia, $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{RUT}", Encodear5($unico->rut), $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{NUM_RECONOCIMIENTOS}", $num_reconocimientos, $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{NUM_GRACIAS}", $num_gracias, $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{URL_PERSONA}", utf8_decode(VerificaFotoPersonal($unico->rut)), $row_ULTIMOS);
        $cuenta_colaborador++;
    }

    $PRINCIPAL = str_replace("{BLOQUE_ULTIMOS_BIOGRAFIA_COLABORADORES_PERFIL}", utf8_encode($row_ULTIMOS), $PRINCIPAL);
    return ($PRINCIPAL);
}
function com_mp_biblioteca_fn($PRINCIPAL, $id_empresa, $rut, $ord_by, $filt_by, $filt_cat, $vp, $tag, $rut_enviado, $tipo_consulta, $amb, $start_limit, $id_subcategoria, $id_categoria, $template, $filtro){
		$rut = $_SESSION["user_"];
		$id_empresa = $_SESSION["id_empresa"];
	
				$perfiles_Biblio_2020		=		Biblioteca_Perfiles_2020($rut);
				if($perfiles_Biblio_2020<>""){
					$filtro	= " and perfil='$perfiles_Biblio_2020' ";
				}
		//print_r($perfiles_Biblio_2020);
	
    $Biblio_Cat = Biblio_2019_Vista_Categorias_2020_Filtro_Biblio_data($id_empresa, $rut, $id_dimension, $filtro);
		//echo "<br>BiblioCat<br>";    print_r($Biblio_Cat);    echo "<br>";
 
    $row_categoria="";
    $num_archivos_cat=0;
    $num_archivos_subcat=0;
    
    foreach($Biblio_Cat as $unico) {
        $row_categoria.= file_get_contents("views/biblioteca_2019/" . $id_empresa . "_biblioteca_2019_row_categorias.html");
        $row_categoria = str_replace("{BIBLIOTECA_2019_NOMBRE_CATEGORIA}", utf8_encode($unico->categoria), $row_categoria);
        $row_categoria = str_replace("{BIBLIOTECA_2019_ID_CATEGORIA}", utf8_encode($unico->id), $row_categoria);
        	$Biblio_SubCat = Biblio_2019_Vista_SubCategorias_data($id_empresa, $rut, $unico->id);
        	/*echo "<br>BiblioSubCat<br>";        	print_r($Biblio_SubCat);        	echo "<br>";*/
        		$row_archivos="";
        	  $row_subcategoria="";
        	  $num_archivos_cat=0;
        		foreach($Biblio_SubCat as $unico2) {
        		$row_subcategoria.= file_get_contents("views/biblioteca_2019/" . $id_empresa . "_biblioteca_2019_row_subcategorias.html");
        		$row_subcategoria = str_replace("{BIBLIOTECA_2019_NOMBRE_SUBCATEGORIA}", utf8_encode($unico2->categoria), $row_subcategoria);
        		$row_subcategoria = str_replace("{BIBLIOTECA_2019_ID_SUBCATEGORIA}", utf8_encode($unico2->id), $row_subcategoria);
        			$Biblio_Archivos = Biblio_2019_Vista_Archivos_data($id_empresa, $rut, $unico2->id);
        			/*echo "<br>BiblioArchivos<br>";        			print_r($Biblio_Archivos);        			echo "<br>";*/
        			
        	
        				$row_archivos="";
        				$num_archivos_subcat=0;
	        			foreach($Biblio_Archivos as $unico3) {
	        				$row_archivos.= file_get_contents("views/biblioteca_2019/" . $id_empresa . "_biblioteca_2019_row_archivos.html");
	        				$row_archivos = str_replace("{BIBLIOTECA_2019_URL_ARCHIVO}", 				"?sw=com_mp_biblioteca_vista&id_archivo=".Encodear3($unico3->id)."&urlenc=".($unico3->archivo)."", $row_archivos);
	        				$row_archivos = str_replace("{BIBLIOTECA_2019_NOMBRE_ARCHIVO}", ($unico3->titulo), $row_archivos);
	        				$row_archivos = str_replace("{VISITAS}", ($unico3->descargado), $row_archivos);
	        				$row_archivos = str_replace("{FECHA_SUBIDA}", ($unico3->fecha), $row_archivos);
	        				$row_archivos = str_replace("{DESCRIPCION_ARCHIVO}", ($unico3->descripcion), $row_archivos);
									$num_archivos_subcat++;
	        				$num_archivos_cat++;
	        			}
	        			
	        					//echo "<br>unico2->categoria ".$unico2->categoria." num sub catt ".$num_archivos_subcat;
	        			
	        			
        		$row_subcategoria = str_replace("{NUM_SUBCAT_ARCHIVOS_BIBLIO_2019}", 		($num_archivos_subcat), $row_subcategoria);
        		$row_subcategoria = str_replace("{BIBLIOTECA_2019_LISTA_SUBCATEGORIAS}", utf8_encode($row_archivos), $row_subcategoria);
        	}
        	
        	
        $row_categoria = str_replace("{NUM_ARCHIVOS_BIBLIO_2019}", ($num_archivos_cat), $row_categoria);
        $row_categoria = str_replace("{BIBLIOTECA_2019_LISTA_SUBCATEGORIAS}", $row_subcategoria, $row_categoria);
    }

    //echo  "$row_lsita";
    $PRINCIPAL = str_replace("{BIBLIOTECA_2019}", $row_categoria, $PRINCIPAL);
    return ($PRINCIPAL);		
}
function ObtieneNotaFinalCompetencias()
{
	
}
function colocarUltimosIngresosBiografiasoloClick_2020($PRINCIPAL, $id_empresa)
{
    $listado = BuscaUltimosIngresosBiografiasoloClick($id_empresa);
    foreach ($listado as $unico) {
        //echo "<br><br>rut ".$unico->rut;
        $array_Reco_Gracias = BuscaDatosReconocimientoAgradecimientos($unico->rut, $id_empresa);
        //print_r($array_Reco_Gracias);
        if ($array_Reco_Gracias[0]->num_gracias > 0) {
            $num_gracias = $array_Reco_Gracias[0]->num_gracias;
        } else {
            $num_gracias = 0;
        }
        if ($array_Reco_Gracias[0]->num_reconocimientos > 0) {
            $num_reconocimientos = $array_Reco_Gracias[0]->num_reconocimientos;
        } else {
            $num_reconocimientos = 0;
        }
        //echo "<br>views/mi_equipo_lider/".$id_empresa."_row_ultimos_ingresos_soloclick.html";
        $row_ULTIMOS .= file_get_contents("views/personas/" . $id_empresa . "_row_ultimos_ingresos_soloclick_2020.html");
        $row_ULTIMOS = str_replace("{MEDALLAS}", $medallas, $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{NOMBRE}", $unico->nombre . " " . $unico->apaterno . " " . $unico->amaterno, $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{CARGO}", $unico->cargo, $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{GERENCIA}", $unico->gerencia, $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{RUT}", Encodear5($unico->rut), $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{NUM_RECONOCIMIENTOS}", $num_reconocimientos, $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{NUM_GRACIAS}", $num_gracias, $row_ULTIMOS);
        $row_ULTIMOS = str_replace("{URL_PERSONA}", utf8_decode(VerificaFotoPersonal($unico->rut)), $row_ULTIMOS);
        $cuenta_colaborador++;
    }
    $PRINCIPAL = str_replace("{BLOQUE_ULTIMOS_BIOGRAFIA_COLABORADORES_PERFIL}", utf8_encode($row_ULTIMOS), $PRINCIPAL);
    return ($PRINCIPAL);
}
function FormatearPorcentajes($valor)
{
    $valor = number_format($valor, 0, ",", ".");
    return ($valor);
}
function ColocaAvanceCursoPorPuntosDeObjetos($html, $id_curso, $rut, $id_empresa)
{
   /* $datos_puntos = TienePuntosConsolidadosPorCurso($rut, $id_empresa, $id_curso);
    $grafico      = file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_grafico_avance_curso_por_objeto.html");
    $html         = str_replace("{GRAFICO_AVANCE_CURSO_POR_OBJETOS}", $grafico, $html);
    $html         = str_replace("{TOTAL_PUNTOS_POR_OBJETOS}", $datos_puntos[0]->puntos_maximo, $html);
    $html         = str_replace("{NOMBRE_CURSO}", utf8_encode($datos_puntos[0]->nombre_curso), $html);
    $html         = str_replace("{ID_CURSO}", $id_curso, $html);
    $html         = str_replace("{BRECHA_COMPLETADOS_VS_NOCOMPLETADOS}", $datos_puntos[0]->puntos_maximo - $datos_puntos[0]->suma_puntos_por_curso, $html);

    $html         = str_replace("{TOTAL_COMPLETADOS}", $datos_puntos[0]->suma_puntos_por_curso, $html);
    $arreglo[0]   = $html;
    $arreglo[1]   = $datos_puntos[0]->suma_puntos_por_curso;
    return ($arreglo);*/
}
function Becas_2020_Busca_Universidades($PRINCIPAL, $id_empresa)
{
    //obtengo los menus nivel 1 dado el id de la empresa
    $Instituciones = Becas_2020_Busca_Universidades_data($id_empresa);

		$arr_mis_postulaciones 	= Becas_busca_MisPostulaciones($_SESSION["user_"], $id_empresa);
		$institucion_seleccionada=$arr_mis_postulaciones[0]->otracasa;
            foreach ($Instituciones as $unico) {
            	
            	$seleccionada="";
            	if($institucion_seleccionada==$unico->institucion){
            		$seleccionada= " selected ";
            	}
            	
                $row .= file_get_contents("views/becas/78_option_instituciones.html");
                $row = str_replace("{NOMBRE_INSTITUCION}", $unico->institucion, $row);
                $row = str_replace("{SELECTED}", $seleccionada, $row);
                
                $seleccionada="";
                
                
            }

      

    $PRINCIPAL = str_replace("{BECAS_ROW_INSTITUCION}", ($row), $PRINCIPAL);
    return ($PRINCIPAL);
}
function FechaExcel($fecha_excel){
		$unix_date = ($fecha_excel - 25569) * 86400;
		$fecha_excel = 25569 + ($unix_date / 86400);
		$unix_date = ($fecha_excel - 25569) * 86400;
		$fecha= date("Y-m-d", $unix_date);	
		$fecha_real=date('Y-m-d', strtotime($fecha. ' + 1 day'));
		return 	$fecha_real;
}
function FechaSp($fecha){
	
	$newDate = date("d-m-Y", strtotime($fecha));
	return $newDate;
	
}
function BibliotecaSearchFullTexto($PRINCIPAL, $id_empresa, $q)
{
    $rut_sesion       = $_SESSION["user_"];
		$resultados = BibliotecaSearchFullTexto_data($q,$id_empresa);
		//print_r($resultados);
    foreach ($resultados as $cat) {
        $row .= file_get_contents("views/biblioteca/" . $id_empresa . "_row_resultados.html");
        $row              = str_replace("{NOMBRE_ARCHIVO_BIBLIOTECA_FULL}",       $cat->titulo, $row);
        $row              = str_replace("{DESCARGA_ARCHIVO_BIBLIOTECA_FULL}",   $cat->archivo, $row);
				$row              = str_replace("{CATEGORIA}",   $cat->categoria, $row);
        $row              = str_replace("{SUBCATEGORIA}",       $cat->subcategoria, $row);
        $row              = str_replace("{VISITAS}",       $cat->descargado, $row);
    }
    
    //print_r($row);
    
    $PRINCIPAL = str_replace("{BIBLIO_RESULTADOS}", utf8_encode($row), $PRINCIPAL);
    $PRINCIPAL = str_replace("{BUSQUEDA}", ($q), $PRINCIPAL);

    return ($PRINCIPAL);
}
function Curso_full_por_malla($PRINCIPAL, $rut, $id_malla, $id_empresa){
	
	/*echo "<br>function Curso_full_por_malla($rut, $id_malla, $id_empresa)";*/
	
	$array_Prog_Curso	=	Curso_Full_por_malla_data($rut, $id_malla, $id_empresa);
	/*echo "<br>";
	print_r($array_Prog_Curso);
	echo "<br>";*/
	//PROGRAMA // DESCRIPCION
	$row_programa.=file_get_contents("views/mis_cursos/".$id_empresa."_row_programa.html");	
	$row_programa = str_replace("{PROGRAMA_NOMBRE}", 			utf8_encode($array_Prog_Curso[0]->Programa_Nombre),$row_programa); 
	$row_programa = str_replace("{PROGRAMA_DESCRIPCION}", utf8_encode($array_Prog_Curso[0]->Programa_Descripcion),$row_programa); 
	$row_programa = str_replace("{PROGRAMA_IMAGEN}", 			utf8_encode($array_Prog_Curso[0]->Programa_Imagen),$row_programa); 


	//CURSO
	 foreach ($array_Prog_Curso as $unico){
 			/*echo "<br><br>"; 		print_r($unico); 	echo "<br><br>";*/
 			$row_cursos.=file_get_contents("views/mis_cursos/".$id_empresa."_row_curso.html");	
 			if($unico->Curso_Avance>0){$avance=$unico->Curso_Avance;} else {$avance=0;}
 			
 			$suma_avance	=	$avance + $suma_avance;
 			$cuenta_cursos++;
 			
			$row_cursos = str_replace("{CURSO_NOMBRE}", 			utf8_encode($unico->Curso_Nombre),$row_cursos); 
			$row_cursos = str_replace("{CURSO_DESCRIPCION}", 	utf8_encode($unico->Curso_Descripcion),$row_cursos); 
			$row_cursos = str_replace("{CURSO_PROGRESS_BAR}", utf8_encode($avance),$row_cursos); 
			$row_cursos = str_replace("{CURSO_ESTADO}", 			utf8_encode($unico->Curso_Estado),$row_cursos); 
			$row_cursos = str_replace("{CURSO_NOTA}", 				utf8_encode($unico->Curso_Nota),$row_cursos); 
			$row_cursos = str_replace("{ID_CURSO}", 					utf8_encode($unico->id_curso),$row_cursos); 
			$row_cursos = str_replace("{CURSO_IMAGEN}", 			utf8_encode($unico->Curso_Imagen),$row_cursos); 
			
 			$array_Objetos=Curso_Full_Objetos_por_Curso_Data($rut, $unico->id_curso, $id_empresa);
 			$row_objetos="";
 			foreach ($array_Objetos as $unico2){
 				/*echo "<br><br>Curso_Full_Objetos_por_Curso_Data<br>"; 				echo "<br>"; 				print_r($unico2); 				echo "<br>";*/
 				$row_objetos.=file_get_contents("views/mis_cursos/".$id_empresa."_row_objeto.html");	
 				$icono_objeto				=	$unico2->tipo_objeto;
 				if($unico2->tipo_objeto=="3"){
 					$icono_objeto	=	"<i class='fas fa-play-circle' style='color: #ccc;font-size: 20px;'></i>";
 					$tipo_objeto	= "Video";
 				} 
 				elseif($unico2->tipo_objeto=="5"){
 					$icono_objeto	= "<i class='fas fa-file'  style='color: #337ab7;font-size: 20px;'></i>";
 					$tipo_objeto	= "Evaluaci&oacute;n";
 				}
 				$objeto_finalizado	=	$unico2->objeto_finalizado;
 				$objeto_nota				=	$unico2->nota;
 				if($objeto_finalizado>0){
 					$objeto_avance="100";
 					$icono_objeto	= "<i class='fas fa-check-circle'  style='color: #337ab7;font-size: 20px;'></i>";
 				} else {
 					$objeto_avance="0";
 				}
 				
				$row_objetos = str_replace("{OBJETO_ICONO}", 					utf8_encode($icono_objeto),$row_objetos); 
				$row_objetos = str_replace("{OBJETO_TIPO}", 					utf8_encode($tipo_objeto),$row_objetos); 
				$row_objetos = str_replace("{OBJETO_NOMBRE}", 				utf8_encode($unico2->titulo),$row_objetos); 
				$row_objetos = str_replace("{OBJETO_PROGRESS_BAR}", 	utf8_encode($objeto_avance),$row_objetos); 
				$row_objetos = str_replace("{OBJETO_ESTADO}", 				utf8_encode($unico2->Curso_Nombre),$row_objetos); 
				$row_objetos = str_replace("{OBJETO_ID_ENC}", 				Encodear3($unico2->id),$row_objetos); 
 			}
			$row_cursos = str_replace("{OBJETOS_ROWS}", $row_objetos,$row_cursos); 
 	}
 	
 		$avance_programa=round($suma_avance/$cuenta_cursos);
 		$row_programa = str_replace("{PROGRAMA_PROGRESS_BAR}", 			utf8_encode($avance_programa),$row_programa); 
 		if($avance_programa>="100"){
 			$programa_estado	=	"<div class='badge badge-success'><span class='blanco'>Curso Realizado</span></div>"; 			
 		} elseif($avance_programa>"0" and $avance_programa<"100"){
 			$programa_estado	=	"<div class='badge badge-warning'><span class='blanco'>En Proceso</span></div>"; 			
 		} else {
 			$programa_estado	=	"<div class='badge badge-danger'><span class='blanco'>No Iniciado</span></div>";
 		}
 		
		$row_programa = str_replace("{PROGRAMA_ESTADO}", 			utf8_encode($programa_estado),$row_programa); 
	

 		$row_programa = str_replace("{CURSOS_ROWS}", $row_cursos,$row_programa); 
    $PRINCIPAL = str_replace("{ROWS_PROGRAMAS}",$row_programa,$PRINCIPAL);
	
		//MODULOS
		return($PRINCIPAL);
	
}

function substrwords($text, $maxchar, $end='...') {
    if (strlen($text) > $maxchar || $text == '') {
        $words = preg_split('/\s/', $text);      
        $output = '';
        $i      = 0;
        while (1) {
            $length = strlen($output)+strlen($words[$i]);
            if ($length > $maxchar) {
                break;
            } 
            else {
                $output .= " " . $words[$i];
                ++$i;
            }
        }
        $output .= $end;
    } 
    else {
        $output = $text;
    }
    return $output;
}
function dashboard_lista_mis_cluster_encuestas($PRINCIPAL, $rut, $id_empresa){

 $array_mis_cluster=Dashboard_Encuestas_Mis_Cluster($rut, $id_empresa);
	//print_r($array_mis_cluster);
 
 foreach ($array_mis_cluster as $unico){
 	//print_r($unico);
	$row.=file_get_contents("views/dashboard_encuestas/".$id_empresa."_mis_cluster_encuestas_ver_resultados.html");	
	$boton_ver_resultados="<center><a href='?sw=dashboard_home&id_cluster=".Encodear3($unico->id_cluster)."' class='btn btn-info'>Ver Encuestas</a></center>";
	
	$row = str_replace("{NOMBRE}", utf8_encode($unico->nombre),$row); 
	$row = str_replace("{ID_ENCUESTA_ENC}", Encodear3($unico->id_encuesta),$row); 
	$row = str_replace("{NUM_ENCUESTAS}", ($unico->num_encuestas),$row); 
	
	
	$row = str_replace("{BOTON_VER_RESULTADOS}", $boton_ver_resultados,$row); 
	 
 }
    $PRINCIPAL = str_replace("{LISTA_MIS_ENCUESTAS}",$row,$PRINCIPAL);

    return($PRINCIPAL);	
}
function dashboard_lista_mis_encuestas($PRINCIPAL, $id_cluster, $rut, $id_empresa){

 $array_mis_encuestas=Dashboard_Encuestas_Mis_Encuestas_Cluster($rut, $id_cluster, $id_empresa);
 
 //echo "<br>dashboard_lista_mis_encuestas"; print_r($array_mis_encuestas);
 
 foreach ($array_mis_encuestas as $unico){
 	//print_r($unico);
	$row.=file_get_contents("views/dashboard_encuestas/".$id_empresa."_mis_encuestas_ver_resultados.html");	
	
	$boton_ver_resultados="<center><a href='?sw=dashboard_encuesta&id_enc=".Encodear3($unico->id_medicion)."&id_cluster=".Encodear3($id_cluster)."' class='btn btn-info'>Ver Detalle</a></center>";
	
	$row = str_replace("{NOMBRE}", 								utf8_encode($unico->nombre),$row); 
	$row = str_replace("{ID_ENCUESTA_ENC}", 			Encodear3($unico->id_medicion),$row); 
	$row = str_replace("{NUM_RESPUESTAS}", 				($unico->num_respuestas),$row); 
	$row = str_replace("{PROMEDIO_RESPUESTAS}", 	round($unico->prom_respuestas,2),$row); 
	$row = str_replace("{ESCALA}", 								($unico->escala),$row); 

	$row = str_replace("{BOTON_VER_RESULTADOS}", 	$boton_ver_resultados,$row); 
	 
 }
    $PRINCIPAL = str_replace("{LISTA_MIS_ENCUESTAS}",$row,$PRINCIPAL);

    return($PRINCIPAL);	
}
function dashboard_grafico($PRINCIPAL, $id_empresa, $id_encuesta, $filtro_division, $filtro_region, $filtro_jefatura){
	//echo "<br>dashboard grafico $id_empresa, $id_encuesta, $filtro_division, $filtro_region, $filtro_jefatura";
    $Preguntas=Dashboard_Trae_Preguntas_Grafico($id_encuesta, $id_empresa);
    //print_r($Preguntas);
    foreach ($Preguntas as $unico){
		$cuenta_respuestas_no_vacias=Dashboard_Encuestas_BuscaRespuestasPorCadaPregunta_NoVacias($unico->id_pregunta, $id_encuesta, $id_empresa, $filtro_division, $filtro_region, $filtro_jefatura);
		//echo "<br>Cuenta Respuestas No Vacias ID Preg ".$unico->id_pregunta." cuenta respuestas ".($cuenta_respuestas_no_vacias);
		$row_G ="";
		if($cuenta_respuestas_no_vacias>0){
			$row.=file_get_contents("views/dashboard_encuestas/".$id_empresa."_row_pregunta_bar.html");	
			//echo "encuestas ".$unico->id_encuesta." id_pregunta ".$unico->id_pregunta;
			$row = str_replace("{PREGUNTA}", utf8_encode($unico->pregunta),$row);
			$array_respuestas=Dashboard_Encuestas_BuscaRespuestasPorCadaPregunta($unico->id_pregunta, $id_encuesta, $id_empresa, $filtro_division, $filtro_region, $filtro_jefatura);
			//echo "<pre>";print_r($array_respuestas);echo "</pre>";
		
			$array_DATA_X_Y="";	
			$array_DATA_X_Y_BAR="";	$cuenta_respuestas=0;
			
			//NIV1_5
			if($array_respuestas[0]->tipo=="NIV1_5"){
				$cuenta_respuestas++;
			}
				//echo "count(".count($array_respuestas)." respuesta ".$cuenta_respuestas;
				if($array_respuestas[0]->tipo=="NIV1_5"){
							foreach ($array_respuestas as $unico_2){
								$arreglo[$unico_2->respuesta]=$unico_2->cuenta_respuesta;
							}			
						for ($i = 1; $i <= 5; $i++){		
								
								$cuenta_respuestas	=	$arreglo[$i];
								if($cuenta_respuestas==""){$cuenta_respuestas=0;}		
								$porcentaje=0;
								if($cuenta_respuestas>0){
									$porcentaje=round(100*$cuenta_respuestas/$cuenta_respuestas_no_vacias);
								}				
							$array_DATA_X_Y.="	{ name: '".$i."',y:".$cuenta_respuestas.",  sliced: true, selected: true},";
							$array_DATA_X_Y_BAR.="{name: '".$i."',data: [".$porcentaje."]},";
						}						
				}	
				
			//NIV1_4
			if($array_respuestas[0]->tipo=="NIV1_4"){
				$cuenta_respuestas++;
			}
				//echo "count(".count($array_respuestas)." respuesta ".$cuenta_respuestas;
				if($array_respuestas[0]->tipo=="NIV1_4"){
							foreach ($array_respuestas as $unico_2){
								$arreglo[$unico_2->respuesta]=$unico_2->cuenta_respuesta;
							}			
						for ($i = 1; $i <= 5; $i++){		
								
								$cuenta_respuestas	=	$arreglo[$i];
								if($cuenta_respuestas==""){$cuenta_respuestas=0;}		
								$porcentaje=0;
								if($cuenta_respuestas>0){
									$porcentaje=round(100*$cuenta_respuestas/$cuenta_respuestas_no_vacias);
								}				
							$array_DATA_X_Y.="	{ name: '".$i."',y:".$cuenta_respuestas.",  sliced: true, selected: true},";
							$array_DATA_X_Y_BAR.="{name: '".$i."',data: [".$porcentaje."]},";
						}						
				}				$row_G .= file_get_contents("views/dashboard_encuestas/".$id_empresa."_row_grafico_bar.html");
				
				
			$row_G .= file_get_contents("views/dashboard_encuestas/".$id_empresa."_row_grafico.html");
			$row_G = str_replace("{ID_GRAFICO}", ($id_encuesta.$unico->id_pregunta), $row_G);
			$row_G = str_replace("{ROW_GRAFICOS_DATA_X_Y}", ($array_DATA_X_Y), $row_G);

			$row_G = str_replace("{ROW_GRAFICOS_DATA_X_Y_BAR}", ($array_DATA_X_Y_BAR), $row_G);
			$row_G = str_replace("{PREGUNTA_GRAFICOS_BAR}", utf8_encode($unico->pregunta), $row_G);

			$row = str_replace("{GRAFICO}", $row_G,$row);
			//echo "... muestra graficos...";
					} else {					
     	$row.=file_get_contents("views/dashboard_encuestas/".$id_empresa."_row_pregunta_sin_respuesta.html");	
    	//echo "encuestas ".$unico->id_encuesta." id_pregunta ".$unico->id_pregunta;
    	$row = str_replace("{PREGUNTA}", utf8_encode($unico->pregunta),$row);
						    	$row = str_replace("{GRAFICO}", "",$row);
					}
    }
    $PRINCIPAL = str_replace("{LISTA_PREGUTAS_ENVUESTAS}",$row,$PRINCIPAL);

    return($PRINCIPAL);
}
function Encriptar($valor) {
    $salt_text = "+YrpMRqf+*dD6Fr6G+HFsX-nkJ3jY3+kf%Ks26+sBMD6wcy8+UYy&K7*deJSBd*dkLUsr_!FyQffV4gDLXFtZ5hKzf@8Zpfm4e-CSB25PCNVbFmdhf!t%B!wyzs8aV&sP-GRc!Y4+?9z489-$yRzwJ!+S#CDzff4=!ak$SjQNENJPaBf7EYss_*f2_aqQ?stEfPPY!6pfwW#LJ*n25DTuY-mLBzsn#W8zKzXBgZdNBHf!maYdmLbQhtcb5&7wSMS";
    $salt = hash('sha256', $salt_text);
    $hash_text = $salt. $valor;
    $hash = hash('sha256', $hash_text);
    return $hash;
}
function Encriptar_2($valor, $rut) {
    $salt_text = "+YrpMRqf+*dD6Fr6G+HFsX-nkJ3jY3+kf%Ks26+sBMD6wcy8+UYy&K7*deJSBd*dkLUsr_!FyQffV4gDLXFtZ5hKzf@8Zpfm4e-CSB25PCNVbFmdhf!t%B!wyzs8aV&sP-GRc!Y4+?9z489-$yRzwJ!+S#CDzff4=!ak$SjQNENJPaBf7EYss_*f2_aqQ?stEfPPY!6pfwW#LJ*n25DTuY-mLBzsn#W8zKzXBgZdNBHf!maYdmLbQhtcb5&7wSMS";
    $salt = hash('sha256', $salt_text);
    $hash_text = $salt. $valor;
    $hash = hash('sha256', $hash_text);

    $salt_text_rut = "+YrpMRqf+*dD6Fr6G+HFsX-nkJ3jY3+kf%Ks26+sBMD6wcy8+UYy&K7*deJSBd*dkLUsr_!FyQffV4gDLXFtZ5hKzf@8Zpfm4e-CSB25PCNVbFmdhf!t%B!wyzs8aV&sP-GRc!Y4+?9z489-$yRzwJ!+S#CDzff4=!ak$SjQNENJPaBf7EYss_*f2_aqQ?stEfPPY!6pfwW#LJ*n25DTuY-mLBzsn#W8zKzXBgZdNBHf!maYdmLbQhtcb5&7wSMS";
    $salt_rut = hash('sha256', $salt_text_rut);
    $hash_text_rut = $salt_rut. $rut;
    $hash_rut = hash('sha256', $hash_text_rut);	
		
    return hash('sha256',$hash.$hash_rut.$hash_rut);
}
function CategoriasEstilosBancoChileV2($nota){
	  //echo "nota $nota";
	if($nota>=1 and $nota<=3){    //echo "a";
				$criterio="Bajo lo esperado";
				$criterio_con_estilo='<span class="badge badge-danger_txt"><span class="">Bajo lo esperado</span></span>';
				$estilo_circulo="badge-danger-border_txt ";
				$casilla_box_desempeno=1;
				$letra_box_desempeno="B";
			}else if($nota>=3 and $nota<3.5){  //echo "b";
				$criterio="Puede mejorar";
				$criterio_con_estilo='<span class="badge badge-danger_txt"><span class="">Puede mejorar</span></span>';
				$estilo_circulo="badge-danger-border_txt ";
				$casilla_box_desempeno=1;
				$letra_box_desempeno="B";
				
			}else if($nota>=3.5 and $nota<4.5){ //echo "c";
				$criterio="Cumple";
				$criterio_con_estilo='<span class="badge badge-success_txt"><span class="">Cumple</span></span>';
				$estilo_circulo="badge-success_bordertxt";
				$casilla_box_desempeno=2;
				$letra_box_desempeno="M";
				
			}else if($nota>=4.5 and $nota<4.8){   //echo "d";
				$criterio="Cumplimiento destacado";
				$criterio_con_estilo='<span class="badge badge-info_txt"><span class="">Cumplimiento destacado</span></span>';
				$estilo_circulo="badge-info_bordertxt";
				$casilla_box_desempeno=3;
				$letra_box_desempeno="A";

				
			}else if($nota>=4.8 and $nota<=6){   // echo "e";
					$criterio="Cumplimiento con excelencia";
					$criterio_con_estilo='<span class="badge badge-primary_txt"><span class="">Cumplimiento con excelencia</span></span>';
					$estilo_circulo="badge-primary_bordertxt";
					$casilla_box_desempeno=3;
					$letra_box_desempeno="A";
				
				
			}
			$arreglo[0]=$criterio;
			$arreglo[1]=$criterio_con_estilo;
			$arreglo[2]=$estilo_circulo;
			$arreglo[3]=$casilla_box_desempeno;
			$arreglo[4]=$letra_box_desempeno;
			return($arreglo);
			
			
}
function RestarHoras($horaini,$horafin)
{
    $f1 = new DateTime($horaini);
    $f2 = new DateTime($horafin);
    $d = $f1->diff($f2);
    return $d->format('%H:%I:%S');
}
function TiempoASegundos($hora){
	
	list($horas, $minutos, $segundos) = explode(':', $hora);
$hora_en_segundos = ($horas * 3600 ) + ($minutos * 60 ) + $segundos;
return($hora_en_segundos);  
}




function Notificaciones_Usuario_Encuesta_IdEncuesta($rut,$id_medicion, $id_encuesta, $id_empresa){

   $array_res= Not_buscaRespuestas($rut, $id_medicion, $id_encuesta, $id_empresa);
   //echo "array_res $array_res";
	if($array_res==0){$deberealizarencuesta=1;} else {$deberealizarencuesta=0;}
   return   $deberealizarencuesta;
}




function VerificaArregloSQLInjectionV2($arreglo)
{
    $total_arreglo = count($arreglo);

    foreach ($arreglo as $clave => $valor) {

       if (strtoupper(trim($valor)) == "") {
            continue;
        }
     
        $valor = str_replace("'", "", $valor);
        $valor = str_replace('"', "", $valor);
        $valor = str_replace("+'", "", $valor);
        $valor = str_replace('--', "", $valor);
        $valor = str_replace('--', "", $valor);
        $valor = str_replace('--', "", $valor);
        $valor = str_replace('&', "", $valor);
        $valor = str_replace('.php', "", $valor);
        $valor = str_replace('.js', "", $valor);
        $valor = str_replace('.vbs', "", $valor);
        $valor = str_replace('%', "", $valor);
        $valor = str_replace('&', "", $valor);
        $valor = str_replace('&amp;', "", $valor);
        $valor = str_replace('&#38;', "", $valor);
        $valor = str_replace('<', "", $valor);
        $valor = str_replace('&lt;', "", $valor);
        $valor = str_replace('&#60;', "", $valor);
        $valor = str_replace('>', "", $valor);
        $valor = str_replace('&gt;', "", $valor);
        $valor = str_replace('&#62;', "", $valor);
        $valor = str_replace('&quot;', "", $valor);
        $valor = str_replace('&#34;', "", $valor);
        $valor = str_replace('&#39;', "", $valor);
        $valor = str_replace('script', "", $valor);
        $valor = str_replace('select', "", $valor);
        $valor = str_replace('tables', "", $valor);
        $valor = str_replace('union', "", $valor);
        $valor = str_replace('information_schema', "", $valor);
        //$valor = str_replace('', "", $valor);
        $valor = str_replace('delete', "", $valor);
        $valor = str_replace('update', "", $valor);
        $valor = str_replace('show', "", $valor);
        $valor = str_replace('|', "", $valor);
        $arreglo[$clave]= $valor;
    }
    return ($arreglo);
}
function VerificaArregloSQLInjectionV3($valor)
{


        $valor = str_replace("'", "", $valor);
        $valor = str_replace('"', "", $valor);
        $valor = str_replace("+'", "", $valor);
        $valor = str_replace('--', "", $valor);
        $valor = str_replace('--', "", $valor);
        $valor = str_replace('--', "", $valor);
        $valor = str_replace('&', "", $valor);
        $valor = str_replace('.php', "", $valor);
        $valor = str_replace('.js', "", $valor);
        $valor = str_replace('.vbs', "", $valor);
        $valor = str_replace('%', "", $valor);
        $valor = str_replace('&', "", $valor);
        $valor = str_replace('&amp;', "", $valor);
        $valor = str_replace('&#38;', "", $valor);
        $valor = str_replace('<', "", $valor);
        $valor = str_replace('&lt;', "", $valor);
        $valor = str_replace('&#60;', "", $valor);
        $valor = str_replace('>', "", $valor);
        $valor = str_replace('&gt;', "", $valor);
        $valor = str_replace('&#62;', "", $valor);
        $valor = str_replace('&quot;', "", $valor);
        $valor = str_replace('&#34;', "", $valor);
        $valor = str_replace('&#39;', "", $valor);
        $valor = str_replace('script', "", $valor);
        $valor = str_replace('select', "", $valor);
        $valor = str_replace('tables', "", $valor);
        $valor = str_replace('union', "", $valor);
        $valor = str_replace('information_schema', "", $valor);
        //$valor = str_replace('', "", $valor);
        $valor = str_replace('delete', "", $valor);
        $valor = str_replace('update', "", $valor);
        $valor = str_replace('show', "", $valor);
        $valor = str_replace('|', "", $valor);

    return ($valor);
}
function VerificaArregloSQLInjectionDecodear($arreglo)
{
    $total_arreglo = is_array($arreglo) ? count($arreglo) : 0;

    /*
    if($_SESSION["user_"]=="12345"){
        echo "<br>FN VerificaArregloSQLInjectionDecodear<br>";
        print_r($arreglo);
        echo "<br>total_arreglo $total_arreglo";
        echo "<h1>Arreglo <br>$arreglo</h1>";
    }
    */
				
        $arreglo = str_replace('"', "", $arreglo);
        $arreglo = str_replace("+'", "", $arreglo);
        $arreglo = str_replace('--', "", $arreglo);
        $arreglo = str_replace('--', "", $arreglo);
        $arreglo = str_replace('--', "", $arreglo);
        $arreglo = str_replace('&', "", $arreglo);
        $arreglo = str_replace('.php', "", $arreglo);
        $arreglo = str_replace('.js', "", $arreglo);
        $arreglo = str_replace('.vbs', "", $arreglo);
        $arreglo = str_replace('%', "", $arreglo);
        $arreglo = str_replace('&', "", $arreglo);
        $arreglo = str_replace('&amp;', "", $arreglo);
        $arreglo = str_replace('&#38;', "", $arreglo);
       
        $arreglo = str_replace('&lt;', "", $arreglo);
        $arreglo = str_replace('&#60;', "", $arreglo);
       
        $arreglo = str_replace('&gt;', "", $arreglo);
        $arreglo = str_replace('&#62;', "", $arreglo);
        $arreglo = str_replace('&quot;', "", $arreglo);
        $arreglo = str_replace('&#34;', "", $arreglo);
        $arreglo = str_replace('&#39;', "", $arreglo);
        $arreglo = str_replace('select', "", $arreglo);
        $arreglo = str_replace('tables', "", $arreglo);
        $arreglo = str_replace('union', "", $arreglo);
        
        $arreglo = str_replace('information_schema', "", $arreglo);
        
        //$arreglo = str_replace('from', "", $arreglo);
        $arreglo = str_replace('delete', "", $arreglo);
        $arreglo = str_replace('update', "", $arreglo);
        $arreglo = str_replace('show', "", $arreglo);
        $arreglo = str_replace('|', "", $arreglo);
        $arreglo = str_replace('user()', "", $arreglo);

/*
if($_SESSION["user_"]=="12345"){
	echo "<br>FN VerificaArregloSQLInjectionDecodear<br>";
	print_r($arreglo);
	echo "<br>total_arreglo $total_arreglo";
	echo "<h1>Arreglo <br>$arreglo</h1>";
}
*/

        
    
    return ($arreglo);
}

function VerificaArregloSQLInjectionLight($arreglo)
{
    $total_arreglo = count($arreglo);

    foreach ($arreglo as $clave => $valor) {

        if (strtoupper(trim($valor)) == "") {
            continue;
        }
        $valor = str_replace('--', "", $valor);
        $valor = str_replace('.php', "", $valor);
        $valor = str_replace('.js', "", $valor);
        $valor = str_replace('.vbs', "", $valor);
        $valor = str_replace('&#38;', "", $valor);
        $valor = str_replace('&lt;', "", $valor);
        $valor = str_replace('&#60;', "", $valor);
        $valor = str_replace('&gt;', "", $valor);
        $valor = str_replace('&#62;', "", $valor);
        $valor = str_replace('&quot;', "", $valor);
        $valor = str_replace('&#34;', "", $valor);
        $valor = str_replace('&#39;', "", $valor);
        $valor = str_replace('select', "", $valor);
        $valor = str_replace('delete', "", $valor);
        $valor = str_replace('update', "", $valor);
        $valor = str_replace('show', "", $valor);
        $valor = str_replace('|', "", $valor);
        $arreglo[$clave]= $valor;
    }
    return ($arreglo);
}

function MisCuiReco2019($PRINCIPAL, $rut, $id_empresa){
	

    $array_lista_mis_cui = MisCuiReco2019_data($rut, $id_empresa);
    foreach($array_lista_mis_cui as $unico) {
    //echo "<br>hola ".$unico->id_beneficios;
				$a_repartir	=MisCuiReco2019_a_repartir_data($unico->cui, $id_empresa);
				$repartidos	=MisCuiReco2019_a_repartidos_data($unico->cui, $id_empresa);
				$saldo_a_repartir=$a_repartir-$repartidos;
        $row_lsita.= file_get_contents("views/reconoce_vota/" . $id_empresa . "_row_mis_cui_2019.html");
        $row_lsita = str_replace("{ID_CUI}", $unico->cui, $row_lsita);	
        $row_lsita = str_replace("{NOMBRE_CUI}", $unico->unidad_glosa, $row_lsita);	
        $row_lsita = str_replace("{PUNTOS_A_REPARTIR_CUI}", $saldo_a_repartir, $row_lsita);	
        $row_lsita = str_replace("{PUNTOS_A_REPARTIDOS_CUI}", $repartidos, $row_lsita);
		
    }
    //echo  "$row_lsita";
    $PRINCIPAL = str_replace("{LISTA_CUI_RECO_2019_JEFES}", $row_lsita, $PRINCIPAL);

    return ($PRINCIPAL);	
	
	
} 

function Incentivos_Mis_Incentivos($PRINCIPAL, $id_empresa, $rut, $ord_by, $filt_by, $filt_cat){
	//mi audiencia
	
	//print_r($mis_id_audiencias);//echo "<br>mi_id_audiencia $mi_id_audiencia";
	
	if(count($mis_id_audiencias)=="0"){
	//	$row_encurso="<center>[ No tienes incentivos cargados ]</center>";
	}
	
	
	 		$usu	=	DatosUsuario_($rut, $id_empresa);
//echo "fecha cargo ".$usu[0]->fecha_antiguedad;
	$mis_id_audiencias=Incentivos_BuscaMiAudiencia($rut, $id_empresa, $usu[0]->fecha_antiguedad);
	
	foreach($mis_id_audiencias as $id_audiencia){ 
		$array_lista_mis_incentivos = Incentivos_Mis_Incentivos_data($id_audiencia->id_audiencia, $id_empresa);
		//echo "<br>AB ".$id_audiencia->id_audiencia;
		foreach($array_lista_mis_incentivos as $unico) {
		
				$fecha_hoy=date("Y-m-d");
				
				//echo "<br>Fe Termino ".$unico->fecha_termino." - ".$usu[0]->fecha_antiguedad<>"" or $usu[0]->fecha_antiguedad;
				
				if($usu[0]->fecha_antiguedad<>"" or $usu[0]->fecha_antiguedad<>"0000-00-00"){
					if($unico->fecha_termino<$usu[0]->fecha_antiguedad){
						continue;
					}
					
				}
				if($fecha_hoy>=$unico->fecha_inicio and $fecha_hoy<=$unico->fecha_termino){
						$tipo="en_curso";
						//echo "<br>FILENAME ".$unico->filename_enc_documento;
						
						$earlier 	= new DateTime($fecha_hoy);
						$later 		= new DateTime($unico->fecha_termino);
						$diff = $later->diff($earlier)->format("%a");
						$restan_quedan = "Restan <span class='badge badge-info'><span class='blanco'>$diff</span></span> días para que finalice el período";
						$row_encurso.= file_get_contents("views/incentivos/" . $id_empresa . "_row_incentivo.html");
						$row_encurso = str_replace("{ID}", 		utf8_encode($unico->id), $row_encurso);	
						$row_encurso = str_replace("{NOMBRE_PUBLICACION}", 		utf8_encode($unico->nombre), $row_encurso);	
						$row_encurso = str_replace("{DESCRIPCION_PUBLICACION}", 	utf8_encode($unico->descripcion), $row_encurso);		
						$row_encurso = str_replace("{NOMBRE_AUDIENCIA}", 	utf8_encode($unico->nombre_audiencia), $row_encurso);	
						$row_encurso = str_replace("{RESTAN_QUEDAN}", 	$restan_quedan, $row_encurso);
						$row_encurso = str_replace("{FECHA_INICIO_CASTELLANO}", 	fechaCastellano($unico->fecha_inicio), $row_encurso);	
						$row_encurso = str_replace("{FECHA_TERMINO_CASTELLANO}", 	fechaCastellano($unico->fecha_termino), $row_encurso);
						$row_encurso = str_replace("{URL}", "https://www.masconectadosbch.cl/admin/docs/".$unico->filename_enc_documento, $row_encurso);
				} elseif($fecha_hoy<$unico->fecha_inicio and $fecha_hoy<$unico->fecha_termino){
						$tipo="proximo";
						$earlier 	= new DateTime($unico->fecha_inicio);
						$later 		= new DateTime($fecha_hoy);
						//echo "earlier ".$earlier.", later  ".$later." "; 
						
						/*print_r($earlier);
						echo "<br>";
						print_r($later);
						echo "<br>";*/
						
						$diff = $later->diff($earlier)->format("%a");
						$restan_quedan	=	"Quedan <span class='badge badge-info'><span class='blanco'>$diff</span></span> días para el inicio de período";
						$row_proximos.= file_get_contents("views/incentivos/" . $id_empresa . "_row_incentivo.html");
						$row_proximos = str_replace("{ID}", 		utf8_encode($unico->id), $row_proximos);	
						$row_proximos = str_replace("{NOMBRE_PUBLICACION}", 		utf8_encode($unico->nombre), $row_proximos);	
						$row_proximos = str_replace("{DESCRIPCION_PUBLICACION}", 	utf8_encode($unico->descripcion), $row_proximos);		
						$row_proximos = str_replace("{NOMBRE_AUDIENCIA}", 	utf8_encode($unico->nombre_audiencia), $row_proximos);	
						$row_proximos = str_replace("{RESTAN_QUEDAN}", 	$restan_quedan, $row_proximos);
						$row_proximos = str_replace("{FECHA_INICIO_CASTELLANO}", 	fechaCastellano($unico->fecha_inicio), $row_proximos);	
						$row_proximos = str_replace("{FECHA_TERMINO_CASTELLANO}", 	fechaCastellano($unico->fecha_termino), $row_proximos);
						$row_proximos = str_replace("{URL}", "https://www.masconectadosbch.cl/admin/docs/".$unico->filename_enc_documento, $row_proximos);
				} else{
						$tipo="historico";
						$restan_quedan	=	"";
						$row_historicos.= file_get_contents("views/incentivos/" . $id_empresa . "_row_incentivo.html");
						$row_historicos = str_replace("{ID}", 		utf8_encode($unico->id), $row_historicos);	
						$row_historicos = str_replace("{NOMBRE_PUBLICACION}", 		utf8_encode($unico->nombre), $row_historicos);	
						$row_historicos = str_replace("{DESCRIPCION_PUBLICACION}", 	utf8_encode($unico->descripcion), $row_historicos);		
						$row_historicos = str_replace("{NOMBRE_AUDIENCIA}", 	utf8_encode($unico->nombre_audiencia), $row_historicos);	
						$row_historicos = str_replace("{RESTAN_QUEDAN}", 	$restan_quedan, $row_historicos);
						$row_historicos = str_replace("{FECHA_INICIO_CASTELLANO}", 	fechaCastellano($unico->fecha_inicio), $row_historicos);	
						$row_historicos = str_replace("{FECHA_TERMINO_CASTELLANO}", 	fechaCastellano($unico->fecha_termino), $row_historicos);
						$row_historicos = str_replace("{URL}", "https://www.masconectadosbch.cl/admin/docs/".$unico->filename_enc_documento, $row_historicos);
				}
			}
		}
		
    $PRINCIPAL = str_replace("{EN_CURSO}", 		$row_encurso, 		$PRINCIPAL);
    $PRINCIPAL = str_replace("{PROXIMOS}", 		$row_proximos, 		$PRINCIPAL);
    $PRINCIPAL = str_replace("{HISTORICOS}", 	$row_historicos, 	$PRINCIPAL);
	
		//documentos complementarios
		
$mis_id_audiencias_=Incentivos_BuscaMiAudiencia($rut, $id_empresa);
	//print_r($mis_id_audiencias);//echo "<br>mi_id_audiencia $mi_id_audiencia";
	
	if(count($mis_id_audiencias)=="0"){
		$row_encurso="<center>[ No tienes incentivos cargados ]</center>";
	}
	
	foreach($mis_id_audiencias as $id_audiencia){ 
		$array_lista_mis_documentos= Incentivos_Mis_Incentivos_Documentos_Complementarios_data($id_audiencia->id_audiencia, $id_empresa);
		//echo "<br>AB ".$id_audiencia->id_audiencia;
		foreach($array_lista_mis_documentos as $unico) {
		
		//echo "<br>unico ".$unico->nombre_documento;
				$fecha_hoy=date("Y-m-d");
				
					
						$row_documentos.= file_get_contents("views/incentivos/" . $id_empresa . "_row_documento.html");
						$row_documentos = str_replace("{ID}", 		utf8_encode($unico->id), $row_documentos);	
						$row_documentos = str_replace("{NOMBRE_DOCUMENTO}", 		utf8_encode($unico->nombre_documento), $row_documentos);	
						$row_documentos = str_replace("{DESCRIPCION_PUBLICACION}", 	utf8_encode($unico->descripcion), $row_documentos);		
						$row_documentos = str_replace("{NOMBRE_AUDIENCIA}", 	utf8_encode($unico->nombre_audiencia), $row_documentos);	
						$row_documentos = str_replace("{RESTAN_QUEDAN}", 	$restan_quedan, $row_documentos);
						$row_documentos = str_replace("{FECHA_INICIO_CASTELLANO}", 	fechaCastellano($unico->fecha_inicio), $row_documentos);	
						$row_documentos = str_replace("{FECHA_TERMINO_CASTELLANO}", 	fechaCastellano($unico->fecha_termino), $row_documentos);
						
						$row_documentos = str_replace("{URL}", "https://www.masconectadosbch.cl/admin/docs/".$unico->filename_enc_documento, $row_documentos);
				
			}
		}		
		
	 	$PRINCIPAL = str_replace("{DOCUMENTOS_COMPLEMENTARIOS}", 	$row_documentos, 	$PRINCIPAL);
    return ($PRINCIPAL);		
	
}


function Incentivos_Mis_Incentivos_Mi_equipo($PRINCIPAL, $id_empresa, $rut_j, $ord_by, $filt_by, $filt_cat){
	
   

$array_equipo=ListaEsJefetblUsuario($rut_j, $id_empresa);
//print_r($array_equipo);

 foreach ($array_equipo as $usu){  
 //echo "<br>usu ".$usu->rut;
	//print_r($mis_id_audiencias);//echo "<br>mi_id_audiencia $mi_id_audiencia";

		$row_equipo.= file_get_contents("views/incentivos/" . $id_empresa . "_row_vista_equipo.html");
		$row_equipo = str_replace("{FOTO_USUARIO}", 					VerificaFotoPersonal($usu->rut), $row_equipo);	
		$row_equipo = str_replace("{NOMBRE_USUARIO}", 				($usu->nombre_completo), $row_equipo);	
		$row_equipo = str_replace("{CARGO_USUARIO}", 					($usu->cargo), $row_equipo);	

		$cuenta_equipo_es_jefe=rutesjefe($usu->rut, $id_empresa);
			//echo "<br>".$usu->rut;
			//echo ". cuenta_equipo_es_jefe $cuenta_equipo_es_jefe";
			//print_r($cuenta_equipo_es_jefe);
			//echo "<br>cuenta ".$cuenta_equipo_es_jefe[0]->cuenta;
		if($cuenta_equipo_es_jefe[0]->cuenta>"0"){
			//echo "A"; 
			$rut_enc=Encodear3($usu->rut);
			$btn_esjefe="<CENTER><a href='?sw=home_mis_incentivos_equipo&rut_j=".$rut_enc."' class='btn btn-info btn-sm'><span class='blanco'><i class='fas fa-angle-right'></i> Ver Equipo (".$cuenta_equipo_es_jefe[0]->cuenta.")</span></a></CENTER>";
		} else {
			//echo "B";
			$btn_esjefe="";
		}
		$row_equipo = str_replace("{VER_EQUIPO}", 		($btn_esjefe), $row_equipo);	

	$mis_id_audiencias=Incentivos_BuscaMiAudiencia($usu->rut, $id_empresa);
	
$Usua=DatosUsuario_($usu->rut, $id_empresa);
	
	$row_encurso="";
	
	//echo "<br>rut ".$usu->rut." cuenta audiencia ".count($mis_id_audiencias);
	//print_r($mis_id_audiencias);
	if(count($mis_id_audiencias)=="0"){
		$row_encurso="<center>[ No tiene incentivos cargados ]</center>";
	}
	foreach($mis_id_audiencias as $id_audiencia){ 
		$array_lista_mis_incentivos = Incentivos_Mis_Incentivos_data($id_audiencia->id_audiencia, $id_empresa);
		//echo "<br>Audiencia  ".$usu->rut." audiencia ".$id_audiencia->id_audiencia;
		//echo "<br>doc<br>";
		
		//print_r($array_lista_mis_incentivos);
		foreach($array_lista_mis_incentivos as $unico) {

		//echo "<br>Por cada audiencia ".$id_audiencia->id_audiencia;
		
					if($Usua[0]->fecha_antiguedad<>"" or $Usua[0]->fecha_antiguedad<>"0000-00-00"){
					if($unico->fecha_termino<$Usua[0]->fecha_antiguedad){
						continue;
					}
					
				}
				$fecha_hoy=date("Y-m-d");
				if($fecha_hoy>=$unico->fecha_inicio and $fecha_hoy<=$unico->fecha_termino){
						$tipo="EN CURSO";
						
					//echo "... En curso Publicacion ".$unico->nombre;	
						$earlier 	= new DateTime($fecha_hoy);
						$later 		= new DateTime($unico->fecha_termino);
						$diff = $later->diff($earlier)->format("%a");
						
						$Usua=DatosUsuario_($usu->rut, $id_empresa);

						
						$restan_quedan	=	"Restan $diff días para que finalice el período";
						$row_encurso.= file_get_contents("views/incentivos/" . $id_empresa . "_row_incentivo_mi_equipo.html");
						$row_encurso = str_replace("{ID}", 		$usu->rut.utf8_encode($unico->id), $row_encurso);	
						$row_encurso = str_replace("{TIPO_PUBLICACION}", 		"<span class='badge badge-info'><span class='blanco'>".$tipo."</span></span>", $row_encurso);	
						$row_encurso = str_replace("{NOMBRE_PUBLICACION}", 		utf8_encode($unico->nombre), $row_encurso);	
						$row_encurso = str_replace("{NOMBRE_PUBLICACION}", 		utf8_encode($unico->nombre), $row_encurso);	
						$row_encurso = str_replace("{DESCRIPCION_PUBLICACION}", 	utf8_encode($unico->descripcion), $row_encurso);		
						$row_encurso = str_replace("{NOMBRE_AUDIENCIA}", 	utf8_encode($unico->nombre_audiencia), $row_encurso);	
						$row_encurso = str_replace("{RESTAN_QUEDAN}", 	$restan_quedan, $row_encurso);
						$row_encurso = str_replace("{FECHA_INICIO_CASTELLANO}", 	fechaCastellano($unico->fecha_inicio), $row_encurso);	
						$row_encurso = str_replace("{FECHA_TERMINO_CASTELLANO}", 	fechaCastellano($unico->fecha_termino), $row_encurso);
						$row_encurso = str_replace("{URL}", "https://www.masconectadosbch.cl/admin/docs/".$unico->filename_enc_documento, $row_encurso);

				} elseif($fecha_hoy<$unico->fecha_inicio and $fecha_hoy<$unico->fecha_termino){
 
						$tipo="PROXIMO";
						$earlier 	= new DateTime($unico->fecha_inicio);
						$later 		= new DateTime($fecha_hoy);
						//echo "earlier ".$earlier.", later  ".$later." "; 						/*print_r($earlier);						echo "<br>";						print_r($later);						echo "<br>";*/					
						$diff = $later->diff($earlier)->format("%a");
						$restan_quedan	=	"Quedan <span class='badge badge-info'><span class='blanco'>$diff</span></span> días para el inicio de período";
						$row_proximos.= file_get_contents("views/incentivos/" . $id_empresa . "_row_incentivo.html");
						$row_proximos = str_replace("{ID}", 		$usu->rut.utf8_encode($unico->id), $row_proximos);
						$row_proximos = str_replace("{TIPO_PUBLICACION}", 		"<span class='badge badge-warning'><span class='blanco'>".$tipo."</span></span>", $row_proximos);							
						$row_proximos = str_replace("{NOMBRE_PUBLICACION}", 		utf8_encode($unico->nombre), $row_proximos);	
						$row_proximos = str_replace("{DESCRIPCION_PUBLICACION}", 	utf8_encode($unico->descripcion), $row_proximos);		
						$row_proximos = str_replace("{NOMBRE_AUDIENCIA}", 	utf8_encode($unico->nombre_audiencia), $row_proximos);	
						$row_proximos = str_replace("{RESTAN_QUEDAN}", 	$restan_quedan, $row_proximos);
						$row_proximos = str_replace("{FECHA_INICIO_CASTELLANO}", 	fechaCastellano($unico->fecha_inicio), $row_proximos);	
						$row_proximos = str_replace("{FECHA_TERMINO_CASTELLANO}", 	fechaCastellano($unico->fecha_termino), $row_proximos);
						$row_proximos = str_replace("{URL}", "https://masconectadosbch.cl/front/docs/".$unico->filename_enc_documento, $row_proximos);
				} else{
						$tipo="HISTORICO";
						$restan_quedan	=	"";
						$row_historicos.= file_get_contents("views/incentivos/" . $id_empresa . "_row_incentivo.html");
						$row_historicos = str_replace("{TIPO_PUBLICACION}", 		"<span class='badge badge-warning'><span class='blanco'>".$tipo."</span></span>", $row_historicos);	
						
						$row_historicos = str_replace("{ID}", 		$usu->rut.utf8_encode($unico->id), $row_historicos);	
						$row_historicos = str_replace("{NOMBRE_PUBLICACION}", 		utf8_encode($unico->nombre), $row_historicos);	
						$row_historicos = str_replace("{DESCRIPCION_PUBLICACION}", 	utf8_encode($unico->descripcion), $row_historicos);		
						$row_historicos = str_replace("{NOMBRE_AUDIENCIA}", 	utf8_encode($unico->nombre_audiencia), $row_historicos);	
						$row_historicos = str_replace("{RESTAN_QUEDAN}", 	$restan_quedan, $row_historicos);
						$row_historicos = str_replace("{FECHA_INICIO_CASTELLANO}", 	fechaCastellano($unico->fecha_inicio), $row_historicos);	
						$row_historicos = str_replace("{FECHA_TERMINO_CASTELLANO}", 	fechaCastellano($unico->fecha_termino), $row_historicos);
						$row_historicos = str_replace("{URL}", "https://masconectadosbch.cl/front/docs/".$unico->filename_enc_documento, $row_historicos);
				}
			}
		}
		
	$row_equipo = str_replace("{URL_DOCUMENTOS_EN_CURSO}", 		$row_encurso, $row_equipo);	



 }


    $PRINCIPAL = str_replace("{VISTA_EQUIPO_EN_CURSO}", 		$row_equipo, 		$PRINCIPAL);



 
    return ($PRINCIPAL);		
	
}


function Ben_benlistaPorDimension($PRINCIPAL, $id_empresa, $rut, $id_dimension)
{

    $array_lista_ben_dim = Ben_benlistaPorDimension_data($id_empresa, $rut, $id_dimension);
    foreach($array_lista_ben_dim as $unico) {
    //echo "<br>hola ".$unico->id_beneficios;
	
	

	
	
        $row_lsita.= file_get_contents("views/beneficios/" . $id_empresa . "_row_lista_beneficios.html");

        $row_lsita = str_replace("{ID_DIMENSION}", $unico->id_dimension, $row_lsita);
        $row_lsita = str_replace("{ID_ITEM}", $unico->id_beneficios, $row_lsita);
        $row_lsita = str_replace("{ID_ITEM_IMAGEN}", $unico->imagen, $row_lsita);
        $row_lsita = str_replace("{NOMBRE_ITEM}", $unico->nombre, $row_lsita);
        $row_lsita = str_replace("{DESCRIPCION_ITEM}", $unico->descripcion, $row_lsita);
    }
    //echo  "$row_lsita";
    $PRINCIPAL = str_replace("{ROW_LISTA_VISTA_BENEFICIOS_POR_DIMENSION}", $row_lsita, $PRINCIPAL);

    return ($PRINCIPAL);
}

function LMS_MiEquipoVista($PRINCIPAL, $id_empresa, $rut, $id_curso, $id_programa, $id_foco)
{

    //echo "<br> LMS_MiEquipoVista $id_empresa, $rut, $id_curso, $id_programa, $id_foco";
    $array_miequipo_all = LMS_MiEquipoVista_Data($id_empresa, $rut, $id_curso, $id_programa, $id_foco);




    $avance = 0;
    $aprobacion = 0;
    foreach($array_miequipo_all as $unico) {
        $cuenta_rank++;
        $datos_usuarios = TraeDatosBiografiayUsuario($unico->rut, $id_empresa);
        $avance = $unico->avance;
        $aprobacion = round(100 * $unico->num_aprobados / $unico->total_cursos);
        $row.= file_get_contents("views/mi_equipo_vista/" . $id_empresa . "_row_index.html");
        $row = str_replace("{RANKING}", $cuenta_rank, $row);
        $row = str_replace("{NOMBRE_PERSONA}", ($datos_usuarios[0]->nombre_completo) , $row);
        $row = str_replace("{FOTO_PERSONA}", VerificaFotoPersonal($unico->rut) , $row);
        $row = str_replace("{CARGO}", utf8_encode($datos_usuarios[0]->cargo) , $row);
        $row = str_replace("{GERENCIA}", utf8_encode($datos_usuarios[0]->c1) , $row);
        $row = str_replace("{PUNTOS}", $unico->puntos, $row);
        $row = str_replace("{BADGES}", $unico->badges, $row);

        //vista de cursos ordenados por programa
        $array_cursos_all = LMS_MiEquiposVista_Cursos_Data($id_empresa, $unico->rut, $id_curso, $id_programa, $id_foco);

    //print_r($array_cursos_all);
        $row_cursos=""; $cuenta_cursos=0;  $suma_cursos=0;
  foreach($array_cursos_all as $unico2) {
    if($unico2->AvancePromedio>=100)
        {$icono="<span class=''>    <span class='' style='color:#399847'> <i class='fas fa-check-square'></i>       </span>   </span> ";} else {
         $icono="<span class=''>    <span class='' style='color:#bbb'>    <i class='fas fa-exclamation-circle'></i> </span>   </span> ";
        }


                    $row_cursos.= file_get_contents("views/mi_equipo_vista/" . $id_empresa . "_row_cursos.html");
                    $row_cursos = str_replace("{NOMBRE_CURSO}", utf8_encode($unico2->nombre_curso) , $row_cursos);
                    $row_cursos = str_replace("{NOMBRE_PROGRAMA}", ($unico2->nombre_programa), $row_cursos);
                    $row_cursos = str_replace("{ESTADO}", $unico2->estado, $row_cursos);
                    $row_cursos = str_replace("{AVANCE}", $unico2->AvancePromedio, $row_cursos);
                    $row_cursos = str_replace("{ICONO}", $icono, $row_cursos);
                $cuenta_cursos++;
                $suma_cursos=$unico2->AvancePromedio+    $suma_cursos;

            }
            $promedio_avance=round($suma_cursos/$cuenta_cursos);
        $row = str_replace("{AVANCE}", $promedio_avance, $row);

        $row = str_replace("{LISTA_CURSOS_MI_EQUIPO_VISTA}", $row_cursos, $row);

    }

    $PRINCIPAL = str_replace("{LISTA_COLABORADORES_RANKING}", $row, $PRINCIPAL);


    return ($PRINCIPAL);
}

function LMS_MiEquipoVista_cursos_disponibles($PRINCIPAL, $id_empresa, $rut, $id_curso, $id_programa, $id_foco)
{

    //echo "<br> LMS_MiEquipoVista $id_empresa, $rut, $id_curso, $id_programa, $id_foco";
    $array_cursos_all = LMS_MiEquipoVista_Cursos_disponibles_Data($id_empresa, $rut, $id_curso, $id_programa, $id_foco);



    $avance = 0;
    $aprobacion = 0;
    foreach($array_cursos_all as $unico) {
        $cuenta_rank++;

        $row.= file_get_contents("views/dnc_miequipo/" . $id_empresa . "_row_cursos_disponibles.html");
        $row = str_replace("{RANKING}", $cuenta_rank, $row);
        $row = str_replace("{NOMBRE_CURSO_DISPONIBLE}", ($unico->nombre) , $row);
        $row = str_replace("{DESCRIPCION_CURSO_DISPONIBLE}", $unico->descripcion, $row);





    }

    $PRINCIPAL = str_replace("{LISTA_CURSOS_DISPONIBLES}", $row, $PRINCIPAL);


    return ($PRINCIPAL);
}

function LMS_DNC_MiCurso($PRINCIPAL, $id_empresa, $rut, $id_curso, $id_programa, $id_foco)
{

    //echo "<br> LMS_DNC_MiCurso $id_empresa, $rut, $id_curso, $id_programa, $id_foco";
    $array_miscursos_all = LMS_DNC_MiCurso_Data($id_empresa, $rut, $id_curso, $id_programa, $id_foco);
    $avance = 0;
    $aprobacion = 0;

    foreach($array_miscursos_all as $unico) {
        $row.= file_get_contents("views/dnc_miequipo/" . $id_empresa . "_row_cursos_dnc.html");
        $row = str_replace("{NOMBRE_CURSO_DNC}", utf8_encode($unico->curso), $row);
        $row = str_replace("{DESCRIPCION_CURSO_DNC}", ($unico->descripcion) , $row);
        $row = str_replace("{LINKTEMARIO}", utf8_encode($unico->linktemario) , $row);
        $row = str_replace("{ID_CURSO_DNC}", utf8_encode($unico->id_curso) , $row);
    }

    $PRINCIPAL = str_replace("{LISTA_CURSOS_DNC}", $row, $PRINCIPAL);


    return ($PRINCIPAL);
}

function LMS_DNC_MiEquipoVista($PRINCIPAL, $id_empresa, $rut, $id_curso, $id_programa, $id_foco)
{

    //echo "<br> LMS_MiEquipoVista $id_empresa, $rut, $id_curso, $id_programa, $id_foco";
    $array_miequipo_all = LMS_DNC_MiEquipoVista_Data($id_empresa, $rut, $id_curso, $id_programa, $id_foco);




    $avance = 0;
    $aprobacion = 0;
    foreach($array_miequipo_all as $unico) {
        $cuenta_rank++;
        $datos_usuarios = TraeDatosBiografiayUsuario($unico->rut, $id_empresa);
        $avance = $unico->avance;
        $aprobacion = round(100 * $unico->num_aprobados / $unico->total_cursos);
        $row.= file_get_contents("views/dnc_miequipo/" . $id_empresa . "_row_index.html");
        $row = str_replace("{RANKING}", $cuenta_rank, $row);
        $row = str_replace("{NOMBRE_PERSONA}", ($datos_usuarios[0]->nombre_completo) , $row);
        $row = str_replace("{FOTO_PERSONA}", VerificaFotoPersonal($unico->rut) , $row);
        $row = str_replace("{CARGO}", utf8_encode($datos_usuarios[0]->cargo) , $row);
        $row = str_replace("{GERENCIA}", utf8_encode($datos_usuarios[0]->c1) , $row);
        $row = str_replace("{PUNTOS}", $unico->puntos, $row);
        $row = str_replace("{RUT_COL_ENC}", Encodear3($unico->rut), $row);

        $row = str_replace("{BADGES}", $unico->badges, $row);

        //vista de cursos ordenados por programa
        $array_cursos_all = LMS_MiEquiposVista_Cursos_Data($id_empresa, $unico->rut, $id_curso, $id_programa, $id_foco);

    //print_r($array_cursos_all);
        $row_cursos=""; $cuenta_cursos=0;  $suma_cursos=0;
  foreach($array_cursos_all as $unico2) {
    if($unico2->AvancePromedio>=100)
        {$icono="<span class=''>    <span class='' style='color:#399847'> <i class='fas fa-check-square'></i>       </span>   </span> ";} else {
         $icono="<span class=''>    <span class='' style='color:#bbb'>    <i class='fas fa-exclamation-circle'></i> </span>   </span> ";
        }


                    $row_cursos.= file_get_contents("views/mi_equipo_vista/" . $id_empresa . "_row_cursos.html");
                    $row_cursos = str_replace("{NOMBRE_CURSO}", utf8_encode($unico2->nombre_curso) , $row_cursos);
                    $row_cursos = str_replace("{NOMBRE_PROGRAMA}", ($unico2->nombre_programa), $row_cursos);
                    $row_cursos = str_replace("{ESTADO}", $unico2->estado, $row_cursos);
                    $row_cursos = str_replace("{AVANCE}", $unico2->AvancePromedio, $row_cursos);
                    $row_cursos = str_replace("{ICONO}", $icono, $row_cursos);
                $cuenta_cursos++;
                $suma_cursos=$unico2->AvancePromedio+    $suma_cursos;

            }
            $promedio_avance=round($suma_cursos/$cuenta_cursos);
        $row = str_replace("{AVANCE}", $promedio_avance, $row);

        $row = str_replace("{LISTA_CURSOS_MI_EQUIPO_VISTA}", $row_cursos, $row);

    }

    $PRINCIPAL = str_replace("{LISTA_COLABORADORES_RANKING}", $row, $PRINCIPAL);


    return ($PRINCIPAL);
}

function VistaRanking($PRINCIPAL, $id_empresa, $tipoc1c2c3c4, $id_programa, $id_foco, $orden, $jefe, $groupby)
{ // echo "<br />VistaRanking id empresa $id_empresa, tipo filtro $tipoc1c2c3c4, id programa $id_programa, orden $orden, jefe $jefe, groupby $groupby";
    // if($orden=="avance"){echo "orden por avance";}
    // if($orden=="puntos"){echo "orden por puntos";}
    // echo "<br />orden $orden";
    // echo "<br />id_programa $id_programa";
    // if($id_programa==""){echo "<br />filtro programas TODOS";} else {echo "<br />programa $id_programa";}
    // if($id_foco==""){echo "<br />filtro id foco TODOS";} else {echo "<br />id foco $id_foco";}
    // echo "<br />hola";
    if ($orden == "avance" and $tipoc1c2c3c4 == "") {
        $array_Rank_all = Ranking_desafios_avance_Data("", $id_programa, $id_foco, $id_empresa, $rut, $groupby);
        // echo "<pre>"; print_r($array_Rank_all);
    }
    if ($orden == "puntos" and $tipoc1c2c3c4 == "") {
        $array_Rank_all = Ranking_desafios_puntos_Data("", $id_programa, $id_foco, $id_empresa, $rut, $groupby);
        // echo "<pre>"; print_r($array_Rank_all);
    }
    if ($orden == "puntos" and $tipoc1c2c3c4 == "tipo_cargo") {
        $array_Rank_all = Ranking_desafios_puntos_Data("", "tipo_cargo", $id_programa, $id_empresa, $rut, $groupby);
        // echo "<pre>"; print_r($array_Rank_all);
    }
    if ($orden == "avance" and ($tipoc1c2c3c4 == "c1" or $tipoc1c2c3c4 == "c2" or $tipoc1c2c3c4 == "c3" or $tipoc1c2c3c4 == "c4")) {
        $array_Rank_all = Ranking_desafios_avance_C1C2C3C4_Data("", $id_programa, $id_foco, $id_empresa, $rut, $groupby);
        // echo "<pre>"; print_r($array_Rank_all);
    }
    if ($orden == "avance" and ($tipoc1c2c3c4 == "c1" or $tipoc1c2c3c4 == "c2" or $tipoc1c2c3c4 == "c3" or $tipoc1c2c3c4 == "c4")) {
        $array_Rank_all = Ranking_desafios_avance_C1C2C3C4_Data("", $id_programa, $id_foco, $id_empresa, $rut, $groupby);
        // echo "<pre>"; print_r($array_Rank_all);
    }
    //echo "<br>orden $orden tipoc1c2c3c4 $tipoc1c2c3c4";

    $avance = 0;
    $aprobacion = 0;
    foreach($array_Rank_all as $unico) {
        $cuenta_rank++;
        $datos_usuarios = TraeDatosBiografiayUsuario($unico->rut, $id_empresa);
        $avance = $unico->avance;
        $aprobacion = round(100 * $unico->num_aprobados / $unico->total_cursos);

        if ($orden == "avance" and $tipoc1c2c3c4 == "") {
            $row.= file_get_contents("views/ranking/" . $id_empresa . "_ranking_vistas_personas_avance.html");
        }
        if ($orden == "puntos" and $tipoc1c2c3c4 == "") {
            $row.= file_get_contents("views/ranking/" . $id_empresa . "_ranking_vistas_personas.html");
        }
        if ($orden == "puntos" and $tipoc1c2c3c4 == "tipo_cargo") {
            $row.= file_get_contents("views/ranking/" . $id_empresa . "_ranking_vistas_personas.html");
        }
        if ($orden == "avance" and ($tipoc1c2c3c4 == "c1" or $tipoc1c2c3c4 == "c2" or $tipoc1c2c3c4 == "c3" or $tipoc1c2c3c4 == "c4")) {
            $row.= file_get_contents("views/ranking/" . $id_empresa . "_ranking_vistas_gerencias.html");
        }
        $row = str_replace("{RANKING}", $cuenta_rank, $row);
        $row = str_replace("{NOMBRE_PERSONA}", utf8_encode($datos_usuarios[0]->nombre_completo) , $row);
        $row = str_replace("{FOTO_PERSONA}", VerificaFotoPersonal($unico->rut) , $row);
        $row = str_replace("{CARGO}", ($datos_usuarios[0]->cargo) , $row);
        $row = str_replace("{GERENCIA}", ($datos_usuarios[0]->gerencia) , $row);
        $row = str_replace("{GERENCIA_C1C2C3C4}", ($unico->gerencia) , $row);
        $row = str_replace("{PUNTOS}", $unico->total_puntos, $row);
        $row = str_replace("{BADGES}", $unico->total_medallas, $row);
                $SaldoPuntosLG=premios_buscadatos($unico->rut, $id_empresa);
        $row = str_replace("{PUNTOS_CANJE_USUARIO}", $SaldoPuntosLG[0]->puntossaldo, $row);

        $row = str_replace("{AVANCE}", $unico->avance, $row);
    }
    if ($orden == "avance") {
        if ($tipoc1c2c3c4 == "") {
            $PRINCIPAL = str_replace("{RANKING_REAL_INDIVIDUAL_AVANCE_TOTAL}", $row, $PRINCIPAL);
        }
        if ($tipoc1c2c3c4 == "c1") {
            $PRINCIPAL = str_replace("{RANKING_C1_REAL_INDIVIDUAL_AVANCE_TOTAL}", $row, $PRINCIPAL);
        }
        if ($tipoc1c2c3c4 == "c2") {
            $PRINCIPAL = str_replace("{RANKING_C2_REAL_INDIVIDUAL_AVANCE_TOTAL}", $row, $PRINCIPAL);
        }
        if ($tipoc1c2c3c4 == "c3") {
            $PRINCIPAL = str_replace("{RANKING_C3_REAL_INDIVIDUAL_AVANCE_TOTAL}", $row, $PRINCIPAL);
        }
        if ($tipoc1c2c3c4 == "c4") {
            $PRINCIPAL = str_replace("{RANKING_C4_REAL_INDIVIDUAL_AVANCE_TOTAL}", $row, $PRINCIPAL);
        }
    }
    if ($orden == "puntos") {
        if ($tipoc1c2c3c4 == "") {
            $PRINCIPAL = str_replace("{RANKING_REAL_INDIVIDUAL_PUNTOS_TOTAL}", $row, $PRINCIPAL);
        }
        if ($tipoc1c2c3c4 == "tipo_cargo") {
            $PRINCIPAL = str_replace("{RANKING_REAL_INDIVIDUAL_PUNTOS_TIPO_CARGO_TOTAL}", $row, $PRINCIPAL);
        }
        if ($tipoc1c2c3c4 == "c1") {
            $PRINCIPAL = str_replace("{RANKING_C1_REAL_INDIVIDUAL_PUNTOS_TOTAL}", $row, $PRINCIPAL);
        }
        if ($tipoc1c2c3c4 == "c2") {
            $PRINCIPAL = str_replace("{RANKING_C2_REAL_INDIVIDUAL_PUNTOS_TOTAL}", $row, $PRINCIPAL);
        }
        if ($tipoc1c2c3c4 == "c3") {
            $PRINCIPAL = str_replace("{RANKING_C3_REAL_INDIVIDUAL_PUNTOS_TOTAL}", $row, $PRINCIPAL);
        }
        if ($tipoc1c2c3c4 == "c4") {
            $PRINCIPAL = str_replace("{RANKING_C4_REAL_INDIVIDUAL_PUNTOS_TOTAL}", $row, $PRINCIPAL);
        }
    }
    return ($PRINCIPAL);
}

function validateDate($date, $format = 'Y-m-d')
{
	if (DateTime::createFromFormat('Y-m-d', $date) !== FALSE) {
	    // it's a date
	    return("SI");
	}
}
function FechaaNombredia($date){

//Convert the date string into a unix timestamp.
$unixTimestamp = strtotime($date);
//Get the day of the week using PHP's date function.
$dayOfWeek = date("l", $unixTimestamp);
//Print out the day that our date fell on.
//echo $date . ' fell on a ' . $dayOfWeek;


if($dayOfWeek=="Sunday")    {$dia="DO";}
if($dayOfWeek=="Monday")    {$dia="LU";}
if($dayOfWeek=="Tuesday")    {$dia="MA";}
if($dayOfWeek=="Wednesday")    {$dia="MI";}
if($dayOfWeek=="Thursday")    {$dia="JU";}
if($dayOfWeek=="Friday")    {$dia="VI";}
if($dayOfWeek=="Saturday")    {$dia="SA";}


        return $dia;

}



function lms_medicion_por_jefe($rut, $id_empresa)
{
    $listaMediciones = Lista_mediciones_jefe_data($rut, $id_empresa);
    foreach ($listaMediciones as $listaMedicion) {

        if($listaMedicion->fecha1<>''){
            $bloque_archivos .= file_get_contents("views/medicion/" . $id_empresa . "_medicion_por_usuario.html");
            $bloque_archivos = str_replace("{FECHA}", utf8_encode($listaMedicion->fecha1), $bloque_archivos);
            if($listaMedicion->Porcentaje>=1){
                $link="";
                $icon="<span class='comp_verde_circle'><i class='icon-check icons'></i></span>";
                } else {
                $link="<a href='?sw=medicion_preguntas&rutcol=".$listaMedicion->rut."&idm=".$listaMedicion->id_medicion."&fecha=".$listaMedicion->fecha1."' > ";
            $icon="<span class='comp_rojo_circle'><i class='far fa-times-circle'></i></span>";    }
            $bloque_archivos = str_replace("{LINK}", $link, $bloque_archivos);
            $bloque_archivos = str_replace("{LINKFIN}", "</a>", $bloque_archivos);
            $bloque_archivos = str_replace("{ICON}", $icon, $bloque_archivos);
        }
        if($listaMedicion->fecha2<>''){
            $bloque_archivos = str_replace("{FECHA}", utf8_encode($listaMedicion->fecha2), $bloque_archivos);
            $bloque_archivos .= file_get_contents("views/medicion/" . $id_empresa . "_medicion_por_usuario.html");
            if($listaMedicion->Porcentaje>=1){
                $link="";
                $icon="<span class='comp_verde_circle'><i class='icon-check icons'></i></span>";

                } else {
                $link="<a href='?sw=medicion_preguntas&rutcol=".$listaMedicion->rut."&idm=".$listaMedicion->id_medicion."&fecha=".$listaMedicion->fecha1."' > ";
            $icon="<span class='comp_rojo_circle'><i class='far fa-times-circle'></i></span>";
                }
            $bloque_archivos = str_replace("{LINK}", $link, $bloque_archivos);
            $bloque_archivos = str_replace("{LINKFIN}", "</a>", $bloque_archivos);
            $bloque_archivos = str_replace("{ICON}", $icon, $bloque_archivos);
        }
        if($listaMedicion->fecha3<>''){
            $bloque_archivos .= file_get_contents("views/medicion/" . $id_empresa . "_medicion_por_usuario.html");
            $bloque_archivos = str_replace("{FECHA}", utf8_encode($listaMedicion->fecha3), $bloque_archivos);
            if($listaMedicion->Porcentaje>=1){
                $link="";
                $icon="<span class='comp_verde_circle'><i class='icon-check icons'></i></span>";

                } else {
                $link="<a href='?sw=medicion_preguntas&rutcol=".$listaMedicion->rut."&idm=".$listaMedicion->id_medicion."&fecha=".$listaMedicion->fecha1."' > ";
            $icon="<span class='comp_rojo_circle'><i class='far fa-times-circle'></i></span>";
                }
            $bloque_archivos = str_replace("{LINK}", $link, $bloque_archivos);
            $bloque_archivos = str_replace("{LINKFIN}", "</a>", $bloque_archivos);
            $bloque_archivos = str_replace("{ICON}", $icon, $bloque_archivos);
        }
        if($listaMedicion->fecha1==''){
            $bloque_archivos .= file_get_contents("views/medicion/" . $id_empresa . "_medicion_por_usuario.html");
            $bloque_archivos = str_replace("{FECHA}", "", $bloque_archivos);
            if($listaMedicion->Porcentaje>=1){
                $link="";
                $icon="<div class='comp_verde_circle'><i class='icon-check icons'></i></div>";
                } else {
                $link="<a href='?sw=medicion_preguntas&rutcol=".$listaMedicion->rut."&idm=".$listaMedicion->id_medicion."&fecha=".$listaMedicion->fecha1."' > ";
                $icon="<div class='comp_rojo_circle'><i class='far fa-times-circle'></i></div>";
                }
            $bloque_archivos = str_replace("{LINK}", $link, $bloque_archivos);
            $bloque_archivos = str_replace("{LINKFIN}", "</a>", $bloque_archivos);
            $bloque_archivos = str_replace("{ICON}", $icon, $bloque_archivos);
        }

        $bloque_archivos = str_replace("{TITULO_MEDICION}", utf8_encode($listaMedicion->medicion), $bloque_archivos);
        $bloque_archivos = str_replace("{FOTO_PERSONA}", VerificaFotoPersonal($listaMedicion->rut), $bloque_archivos);
        $bloque_archivos = str_replace("{NOMBRE}", utf8_encode($listaMedicion->nombre), $bloque_archivos);
        $bloque_archivos = str_replace("{CARGO}", utf8_encode($listaMedicion->cargo), $bloque_archivos);
        $bloque_archivos = str_replace("{GERENCIA}", utf8_encode($listaMedicion->gerencia), $bloque_archivos);
        $cuenta_mediciones++;
        $bloque_archivos = str_replace("{ID_ENCUESTA}", utf8_encode($listaMedicion->id_encuesta), $bloque_archivos);
        $bloque_archivos = str_replace("{ID_MEDICION}", utf8_encode($listaMedicion->id_medicion), $bloque_archivos);
        $bloque_archivos = str_replace("{RUT}", utf8_encode($rut), $bloque_archivos);
        $bloque_archivos = str_replace("{RUT_COLABORADOR}", utf8_encode($listaMedicion->rut), $bloque_archivos);
        $estado          = ValidaEstadoMedicion($rut, $id_empresa, $listaMedicion->id_encuesta, $listaMedicion->id_medicion, $listaMedicion->rut);
        $bloque_archivos = str_replace("{ESTADO}", $estado, $bloque_archivos);
    }
    $arreglo[0] = $bloque_archivos;
    $arreglo[1] = $cuenta_mediciones;
    return $arreglo;
}


function lms_medicion_encuestas_por_estado($rut, $estado_sent, $id_empresa)
{
    $listaMediciones = Lista_mediciones_encuestas_data($rut, $id_empresa);

        //echo "<br>Mediciones, filtrado por $estado<br>";
        //print_r($listaMediciones);
    foreach ($listaMediciones as $listaMedicion) {

        $hoy=date("Y-m-d");
        $estado          = ValidaEstadoMedicionIndividual($rut, $id_empresa, $listaMedicion->id_encuesta, $listaMedicion->id_medicion);

        //echo "<br>Estado $estado";
        //echo "<br> Col ".$listaMedicion->rut." $rut     $hoy, f1 ".$listaMedicion->fecha1." estadof1 $estado_f1   f2 ".$listaMedicion->fecha2." estadof2 $estado_f2  f3 ".$listaMedicion->fecha3." estadof3 $estado_f3 ";
        $bloque_archivos ="";

                        if($estado_sent==$estado and $estado_sent=="FINALIZADO"){
                                //echo "<br>finalizado_2";



                                    $bloque_archivos .= file_get_contents("views/medicion/" . $id_empresa . "_medicion_por_encuestas_finalizados.html");
                                    $bloque_archivos = str_replace("{FECHA}", utf8_encode($listaMedicion->fecha1), $bloque_archivos);
                                    $icon="<span class='comp_verde_circle'><i class='icon-check icons'></i></span>";
                                    $link="";
                                    $bloque_archivos = str_replace("{LINK}", $link, $bloque_archivos);
                                    $bloque_archivos = str_replace("{LINKFIN}", "</a>", $bloque_archivos);
                                    $bloque_archivos = str_replace("{ICON}", $icon, $bloque_archivos);
                                $bloque_archivos = str_replace("{TITULO_MEDICION}", utf8_encode($listaMedicion->medicion), $bloque_archivos);
                                $bloque_archivos = str_replace("{FOTO_PERSONA}", VerificaFotoPersonal($listaMedicion->rut), $bloque_archivos);
                                $bloque_archivos = str_replace("{NOMBRE}", utf8_encode($listaMedicion->nombre), $bloque_archivos);
                                $bloque_archivos = str_replace("{CARGO}", utf8_encode($listaMedicion->cargo), $bloque_archivos);
                                $bloque_archivos = str_replace("{GERENCIA}", utf8_encode($listaMedicion->gerencia), $bloque_archivos);
                                $cuenta_mediciones++;
                                $bloque_archivos = str_replace("{ID_ENCUESTA}", utf8_encode($listaMedicion->id_encuesta), $bloque_archivos);
                                $bloque_archivos = str_replace("{ID_MEDICION}", utf8_encode($listaMedicion->id_medicion), $bloque_archivos);
                                $bloque_archivos = str_replace("{RUT}", utf8_encode($rut), $bloque_archivos);
                                $bloque_archivos = str_replace("{RUT_COLABORADOR}", utf8_encode($listaMedicion->rut), $bloque_archivos);
                                $bloque_archivos = str_replace("{ESTADO}", $estado, $bloque_archivos);


                        }


                        if($estado_sent==$estado and $estado_sent=="PENDIENTE"){

                                //echo "<br>pendiente_2";
                                    $bloque_archivos .= file_get_contents("views/medicion/" . $id_empresa . "_medicion_por_encuestas.html");
                                    $bloque_archivos = str_replace("{FECHA}", utf8_encode($listaMedicion->fecha1), $bloque_archivos);

                                        $link="<a href='?sw=medicion_encuestas_preguntas&idm=".$listaMedicion->id_medicion."' > ";
                                        $icon="<span class='comp_amarillo_circle'><i class='fas fa-exclamation-circle'></i></span>";

                                    $bloque_archivos = str_replace("{LINK}", $link, $bloque_archivos);
                                    $bloque_archivos = str_replace("{LINKFIN}", "</a>", $bloque_archivos);
                                    $bloque_archivos = str_replace("{ICON}", $icon, $bloque_archivos);
                                $bloque_archivos = str_replace("{TITULO_MEDICION}", utf8_encode($listaMedicion->medicion), $bloque_archivos);
                                $bloque_archivos = str_replace("{FOTO_PERSONA}", VerificaFotoPersonal($listaMedicion->rut), $bloque_archivos);
                                $bloque_archivos = str_replace("{NOMBRE}", utf8_encode($listaMedicion->nombre), $bloque_archivos);
                                $bloque_archivos = str_replace("{CARGO}", utf8_encode($listaMedicion->cargo), $bloque_archivos);
                                $bloque_archivos = str_replace("{GERENCIA}", utf8_encode($listaMedicion->gerencia), $bloque_archivos);
                                $cuenta_mediciones++;
                                $bloque_archivos = str_replace("{ID_ENCUESTA}", utf8_encode($listaMedicion->id_encuesta), $bloque_archivos);
                                $bloque_archivos = str_replace("{ID_MEDICION}", utf8_encode($listaMedicion->id_medicion), $bloque_archivos);
                                $bloque_archivos = str_replace("{RUT}", utf8_encode($rut), $bloque_archivos);
                                $bloque_archivos = str_replace("{RUT_COLABORADOR}", utf8_encode($listaMedicion->rut), $bloque_archivos);
                                $bloque_archivos = str_replace("{ESTADO}", $estado, $bloque_archivos);

                        }
    }
    $arreglo[0] = $bloque_archivos;
    $arreglo[1] = $cuenta_mediciones;
    return $arreglo;
}

function lms_medicion_encuestas_lb_por_estado($rut, $estado_sent, $id_empresa)
{
    $listaMediciones = Lista_mediciones_encuestas_lb_data($rut, $id_empresa);

    //echo "<br>Mediciones, filtrado por $estado<br>";
    //print_r($listaMediciones);
    foreach ($listaMediciones as $listaMedicion) {

        $hoy=date("Y-m-d");
        $estado          = ValidaEstadoMedicionIndividual($rut, $id_empresa, $listaMedicion->id_encuesta, $listaMedicion->id);
        //print_r($estado);
        //echo "<br>Estado $estado, estado sent $estado_sent";
        //echo "<br> Col ".$listaMedicion->rut." $rut     $hoy, f1 ".$listaMedicion->fecha1." estadof1 $estado_f1   f2 ".$listaMedicion->fecha2." estadof2 $estado_f2  f3 ".$listaMedicion->fecha3." estadof3 $estado_f3 ";
        $bloque_archivos ="";

                        if($estado_sent==$estado and $estado_sent=="FINALIZADO"){
                                //echo "<br>finalizado_2";



                        $bloque_archivos .= file_get_contents("views/medicion/" . $id_empresa . "_medicion_por_encuestas_finalizados.html");
                        $bloque_archivos = str_replace("{FECHA}", utf8_encode($listaMedicion->fecha1), $bloque_archivos);
                        $icon="<span class='comp_verde_circle'><i class='icon-check icons'></i></span>";
                                $link="<a href='?sw=medicion_encuestas_preguntas_lb&idm=".$listaMedicion->id."' > ";
                        $bloque_archivos = str_replace("{LINK}", $link, $bloque_archivos);
                        $bloque_archivos = str_replace("{LINKFIN}", "</a>", $bloque_archivos);
                        $bloque_archivos = str_replace("{ICON}", $icon, $bloque_archivos);

                        $bloque_archivos = str_replace("{TITULO_MEDICION}", utf8_encode($listaMedicion->medicion), $bloque_archivos);
                        $bloque_archivos = str_replace("{FOTO_PERSONA}", VerificaFotoPersonal($listaMedicion->rut), $bloque_archivos);
                        $bloque_archivos = str_replace("{NOMBRE}", utf8_encode($listaMedicion->nombre), $bloque_archivos);
                        $bloque_archivos = str_replace("{CARGO}", utf8_encode($listaMedicion->cargo), $bloque_archivos);
                        $bloque_archivos = str_replace("{GERENCIA}", utf8_encode($listaMedicion->gerencia), $bloque_archivos);
                        $cuenta_mediciones++;
                        $bloque_archivos = str_replace("{ID_ENCUESTA}", utf8_encode($listaMedicion->id_encuesta), $bloque_archivos);
                        $bloque_archivos = str_replace("{ID_MEDICION}", utf8_encode($listaMedicion->id_medicion), $bloque_archivos);
                        $bloque_archivos = str_replace("{RUT}", utf8_encode($rut), $bloque_archivos);
                        $bloque_archivos = str_replace("{RUT_COLABORADOR}", utf8_encode($listaMedicion->rut), $bloque_archivos);
                        $bloque_archivos = str_replace("{ESTADO}", $estado, $bloque_archivos);


                        }


                        if($estado_sent==$estado and $estado_sent=="PENDIENTE"){

                        //echo "<br>pendiente_2";
                        $bloque_archivos .= file_get_contents("views/medicion/" . $id_empresa . "_medicion_por_encuestas.html");
                        $bloque_archivos = str_replace("{FECHA}", utf8_encode($listaMedicion->fecha1), $bloque_archivos);

                                $link="<a href='?sw=medicion_encuestas_preguntas_lb&idm=".$listaMedicion->id."' > ";
                                $icon="<span class='comp_amarillo_circle'><i class='fas fa-exclamation-circle'></i></span>";

                        $bloque_archivos = str_replace("{LINK}", $link, $bloque_archivos);
                        $bloque_archivos = str_replace("{LINKFIN}", "</a>", $bloque_archivos);
                        $bloque_archivos = str_replace("{ICON}", $icon, $bloque_archivos);
                        $bloque_archivos = str_replace("{TITULO_MEDICION}", utf8_encode($listaMedicion->medicion), $bloque_archivos);
                        $bloque_archivos = str_replace("{FOTO_PERSONA}", VerificaFotoPersonal($listaMedicion->rut), $bloque_archivos);
                        $bloque_archivos = str_replace("{NOMBRE}", utf8_encode($listaMedicion->nombre), $bloque_archivos);
                        $bloque_archivos = str_replace("{CARGO}", utf8_encode($listaMedicion->cargo), $bloque_archivos);
                        $bloque_archivos = str_replace("{GERENCIA}", utf8_encode($listaMedicion->gerencia), $bloque_archivos);
                        $cuenta_mediciones++;
                        $bloque_archivos = str_replace("{ID_ENCUESTA}", utf8_encode($listaMedicion->id_encuesta), $bloque_archivos);
                        $bloque_archivos = str_replace("{ID_MEDICION}", utf8_encode($listaMedicion->id_medicion), $bloque_archivos);
                        $bloque_archivos = str_replace("{RUT}", utf8_encode($rut), $bloque_archivos);
                        $bloque_archivos = str_replace("{RUT_COLABORADOR}", utf8_encode($listaMedicion->rut), $bloque_archivos);
                        $bloque_archivos = str_replace("{ESTADO}", $estado, $bloque_archivos);

                        }
    }
    $arreglo[0] = $bloque_archivos;
    $arreglo[1] = $cuenta_mediciones;
    return $arreglo;
}

function lms_medicion_encuestas_clima_por_estado($rut, $estado_sent, $id_empresa)
{
    $listaMediciones = Lista_mediciones_encuestas_data($rut, $id_empresa);

        //echo "<br>Mediciones, filtrado por $estado<br>";
        //print_r($listaMediciones);
    foreach ($listaMediciones as $listaMedicion) {

        $hoy=date("Y-m-d");
        $estado          = ValidaEstadoMedicionIndividual($rut, $id_empresa, $listaMedicion->id_encuesta, $listaMedicion->id_medicion);

        //echo "<br>Estado $estado";
        //echo "<br> Col ".$listaMedicion->rut." $rut     $hoy, f1 ".$listaMedicion->fecha1." estadof1 $estado_f1   f2 ".$listaMedicion->fecha2." estadof2 $estado_f2  f3 ".$listaMedicion->fecha3." estadof3 $estado_f3 ";
        $bloque_archivos ="";

                        if($estado_sent==$estado and $estado_sent=="FINALIZADO"){
                                //echo "<br>finalizado_2";



                                    $bloque_archivos .= file_get_contents("views/medicion/" . $id_empresa . "_medicion_por_encuestas_clima_finalizados.html");
                                    $bloque_archivos = str_replace("{FECHA}", utf8_encode($listaMedicion->fecha1), $bloque_archivos);
                                    $icon="<span class='comp_verde_circle'><i class='icon-check icons'></i></span>";
                                    $link="";
                                    $bloque_archivos = str_replace("{LINK}", $link, $bloque_archivos);
                                    $bloque_archivos = str_replace("{LINKFIN}", "</a>", $bloque_archivos);
                                    $bloque_archivos = str_replace("{ICON}", $icon, $bloque_archivos);
                                $bloque_archivos = str_replace("{TITULO_MEDICION}", utf8_encode($listaMedicion->medicion), $bloque_archivos);
                                $bloque_archivos = str_replace("{FOTO_PERSONA}", VerificaFotoPersonal($listaMedicion->rut), $bloque_archivos);
                                $bloque_archivos = str_replace("{NOMBRE}", utf8_encode($listaMedicion->nombre), $bloque_archivos);
                                $bloque_archivos = str_replace("{CARGO}", utf8_encode($listaMedicion->cargo), $bloque_archivos);
                                $bloque_archivos = str_replace("{GERENCIA}", utf8_encode($listaMedicion->gerencia), $bloque_archivos);
                                $cuenta_mediciones++;
                                $bloque_archivos = str_replace("{ID_ENCUESTA}", utf8_encode($listaMedicion->id_encuesta), $bloque_archivos);
                                $bloque_archivos = str_replace("{ID_MEDICION}", utf8_encode($listaMedicion->id_medicion), $bloque_archivos);
                                $bloque_archivos = str_replace("{RUT}", utf8_encode($rut), $bloque_archivos);
                                $bloque_archivos = str_replace("{RUT_COLABORADOR}", utf8_encode($listaMedicion->rut), $bloque_archivos);
                                $bloque_archivos = str_replace("{ESTADO}", $estado, $bloque_archivos);


                        }


                        if($estado_sent==$estado and $estado_sent=="PENDIENTE"){

                                //echo "<br>pendiente_2";
                                    $bloque_archivos .= file_get_contents("views/medicion/" . $id_empresa . "_medicion_por_encuestas_clima.html");
                                    $bloque_archivos = str_replace("{FECHA}", utf8_encode($listaMedicion->fecha1), $bloque_archivos);

                                        $link="<a href='?sw=medicion_encuestas_preguntas&idm=".$listaMedicion->id_medicion."&tipo=clima' > ";
                                        $icon="<span class='comp_amarillo_circle'><i class='fas fa-exclamation-circle'></i></span>";

                                    $bloque_archivos = str_replace("{LINK}", $link, $bloque_archivos);
                                    $bloque_archivos = str_replace("{LINKFIN}", "</a>", $bloque_archivos);
                                    $bloque_archivos = str_replace("{ICON}", $icon, $bloque_archivos);
                                $bloque_archivos = str_replace("{TITULO_MEDICION}", utf8_encode($listaMedicion->medicion), $bloque_archivos);
                                $bloque_archivos = str_replace("{FOTO_PERSONA}", VerificaFotoPersonal($listaMedicion->rut), $bloque_archivos);
                                $bloque_archivos = str_replace("{NOMBRE}", utf8_encode($listaMedicion->nombre), $bloque_archivos);
                                $bloque_archivos = str_replace("{CARGO}", utf8_encode($listaMedicion->cargo), $bloque_archivos);
                                $bloque_archivos = str_replace("{GERENCIA}", utf8_encode($listaMedicion->gerencia), $bloque_archivos);
                                $cuenta_mediciones++;
                                $bloque_archivos = str_replace("{ID_ENCUESTA}", utf8_encode($listaMedicion->id_encuesta), $bloque_archivos);
                                $bloque_archivos = str_replace("{ID_MEDICION}", utf8_encode($listaMedicion->id_medicion), $bloque_archivos);
                                $bloque_archivos = str_replace("{RUT}", utf8_encode($rut), $bloque_archivos);
                                $bloque_archivos = str_replace("{RUT_COLABORADOR}", utf8_encode($listaMedicion->rut), $bloque_archivos);
                                $bloque_archivos = str_replace("{ESTADO}", $estado, $bloque_archivos);

                        }
    }
    $arreglo[0] = $bloque_archivos;
    $arreglo[1] = $cuenta_mediciones;
    return $arreglo;
}


function Entorno_Medicion_Encuesta($rut, $idm, $fecha, $id_empresa)
{
    //echo "Entorno_Medicion_Encuesta($rut,$rut, $idm, $fecha, $id_empresa)";

        $bloque_archivos = str_replace("{TITULO_MEDICION}", utf8_encode($listaMedicion->medicion), $bloque_archivos);
        $bloque_archivos = str_replace("{FOTO_PERSONA}", VerificaFotoPersonal($listaMedicion->rut), $bloque_archivos);
        $bloque_archivos = str_replace("{NOMBRE}", utf8_encode($listaMedicion->nombre), $bloque_archivos);
        $bloque_archivos = str_replace("{CARGO}", utf8_encode($listaMedicion->cargo), $bloque_archivos);
        $bloque_archivos = str_replace("{GERENCIA}", utf8_encode($listaMedicion->gerencia), $bloque_archivos);
        $cuenta_mediciones++;
        $bloque_archivos = str_replace("{ID_ENCUESTA}", utf8_encode($listaMedicion->id_encuesta), $bloque_archivos);
        $bloque_archivos = str_replace("{ID_MEDICION}", utf8_encode($listaMedicion->id_medicion), $bloque_archivos);
        $bloque_archivos = str_replace("{RUT}", utf8_encode($rut), $bloque_archivos);
        $bloque_archivos = str_replace("{RUT_COLABORADOR}", utf8_encode($listaMedicion->rut), $bloque_archivos);
        $bloque_archivos = ColocaPreguntasMedicionColaboradores($bloque_archivos, $id_empresa, $rut,$rutcol, $idm, $fecha);
        $estado          = ValidaEstadoMedicion($rut, $id_empresa, $listaMedicion->id_encuesta, $listaMedicion->id_medicion, $listaMedicion->rut);
        $bloque_archivos = str_replace("{ESTADO}", $estado, $bloque_archivos);

    //print_r($bloque_archivos);


    return ($bloque_archivos);
}



function lms_medicion_por_jefe_pregunta($rut,$rutcol, $idm, $fecha, $id_empresa)
{

        //echo "$rut,$rutcol, $idm, $fecha, $id_empresa";
        ///echo "<br>function lms_medicion_por_jefe_pregunta($rut, $rutcol, $idm, $fecha, $id_empresa)";
        $bloque_archivos = str_replace("{FOTO_PERSONA}", VerificaFotoPersonal($listaMedicion->rut), $bloque_archivos);
        $bloque_archivos = str_replace("{NOMBRE}", utf8_encode($listaMedicion->nombre), $bloque_archivos);
        $bloque_archivos = str_replace("{CARGO}", utf8_encode($listaMedicion->cargo), $bloque_archivos);
        $bloque_archivos = str_replace("{GERENCIA}", utf8_encode($listaMedicion->gerencia), $bloque_archivos);
        $cuenta_mediciones++;
        $bloque_archivos = str_replace("{ID_ENCUESTA}", utf8_encode($listaMedicion->id_encuesta), $bloque_archivos);
        $bloque_archivos = str_replace("{ID_MEDICION}", utf8_encode($listaMedicion->id_medicion), $bloque_archivos);
        $bloque_archivos = str_replace("{RUT}", utf8_encode($rut), $bloque_archivos);
        $bloque_archivos = str_replace("{RUT_COLABORADOR}", utf8_encode($listaMedicion->rut), $bloque_archivos);
        $bloque_archivos = ColocaPreguntasMedicionColaboradores($bloque_archivos, $id_empresa, $rut,$rutcol, $idm, $fecha);
        $estado          = ValidaEstadoMedicion($rut, $id_empresa, $listaMedicion->id_encuesta, $listaMedicion->id_medicion, $listaMedicion->rut);
        $bloque_archivos = str_replace("{ESTADO}", $estado, $bloque_archivos);

    //print_r($bloque_archivos);


    return ($bloque_archivos);
}

function lms_medicion_por_pregunta_lb($rut,$rutcol, $idm, $fecha, $id_empresa)
{

       // echo "$rut,$rutcol, $idm, $fecha, $id_empresa";
        //echo "<br>function lms_medicion_por_jefe_pregunta($rut, $rutcol, $idm, $fecha, $id_empresa)";
        $bloque_archivos = str_replace("{FOTO_PERSONA}", VerificaFotoPersonal($listaMedicion->rut), $bloque_archivos);
        $bloque_archivos = str_replace("{NOMBRE}", utf8_encode($listaMedicion->nombre), $bloque_archivos);
        $bloque_archivos = str_replace("{CARGO}", utf8_encode($listaMedicion->cargo), $bloque_archivos);
        $bloque_archivos = str_replace("{GERENCIA}", utf8_encode($listaMedicion->gerencia), $bloque_archivos);
        $cuenta_mediciones++;
        $bloque_archivos = str_replace("{ID_ENCUESTA}", utf8_encode($listaMedicion->id_encuesta), $bloque_archivos);
        $bloque_archivos = str_replace("{ID_MEDICION}", utf8_encode($listaMedicion->id_medicion), $bloque_archivos);
        $bloque_archivos = str_replace("{RUT}", utf8_encode($rut), $bloque_archivos);
        $bloque_archivos = str_replace("{RUT_COLABORADOR}", utf8_encode($listaMedicion->rut), $bloque_archivos);
        $bloque_archivos = ColocaPreguntasMedicionColaboradoresLibre($bloque_archivos, $id_empresa, $rut, $idm, $fecha,"");


        $estado          = ValidaEstadoMedicion($rut, $id_empresa, $listaMedicion->id_encuesta, $listaMedicion->id_medicion, $listaMedicion->rut);
        $bloque_archivos = str_replace("{ESTADO}", $estado, $bloque_archivos);

    //print_r($bloque_archivos);


    return ($bloque_archivos);
}

function lms_medicion_por_pregunta_lb_opcion($opcion, $rut,$rutcol, $idm, $fecha, $id_empresa)
{

        //echo "opcion $opcion $rut,$rutcol, $idm, $fecha, $id_empresa";
        //echo "<br>function lms_medicion_por_jefe_pregunta($rut, $rutcol, $idm, $fecha, $id_empresa)";
        $bloque_archivos = str_replace("{FOTO_PERSONA}", VerificaFotoPersonal($listaMedicion->rut), $bloque_archivos);
        $bloque_archivos = str_replace("{NOMBRE}", utf8_encode($listaMedicion->nombre), $bloque_archivos);
        $bloque_archivos = str_replace("{CARGO}", utf8_encode($listaMedicion->cargo), $bloque_archivos);
        $bloque_archivos = str_replace("{GERENCIA}", utf8_encode($listaMedicion->gerencia), $bloque_archivos);
        $cuenta_mediciones++;
        $bloque_archivos = str_replace("{ID_ENCUESTA}", utf8_encode($listaMedicion->id_encuesta), $bloque_archivos);
        $bloque_archivos = str_replace("{ID_MEDICION}", utf8_encode($listaMedicion->id_medicion), $bloque_archivos);
        $bloque_archivos = str_replace("{RUT}", utf8_encode($rut), $bloque_archivos);
        $bloque_archivos = str_replace("{RUT_COLABORADOR}", utf8_encode($listaMedicion->rut), $bloque_archivos);
        $bloque_archivos = ColocaPreguntasMedicionColaboradoresLibre($bloque_archivos, $id_empresa, $rut, $idm, $fecha, $opcion);


        $estado          = ValidaEstadoMedicion($rut, $id_empresa, $listaMedicion->id_encuesta, $listaMedicion->id_medicion, $listaMedicion->rut);
        $bloque_archivos = str_replace("{ESTADO}", $estado, $bloque_archivos);

    //print_r($bloque_archivos);


    return ($bloque_archivos);
}



function ColocaPreguntasMedicionColaboradoresReplace($PRINCIPAL, $id_empresa, $rut, $id_encuesta, $id_medicion, $rut_colaborador, $replace)
{
    $preguntas = PreguntasMedicion($id_empresa, $id_encuesta, $id_medicion, $rut, $rut_colaborador);
    //echo "<br><br> $id_encuesta, $id_medicion<br>";print_r($preguntas);
    //echo "rut $rut_colaborador";
    //echo "<br>---$rut" .$id_encuesta ." ". $preg->id_pregunta;
    $row       = "";
    foreach ($preguntas as $preg) {
        if ($preg->respuesta) {
            $row .= file_get_contents("views/medicion/" . $id_empresa . "_preguntas_medicion_lectura.html");
        } else {
            $row .= file_get_contents("views/medicion/" . $id_empresa . "_preguntas_medicion.html");
        }
           
           
           if($preg->obligatorio=="1"){
           	$required=" required ";
           } else {
           	$required="  ";
           }
           
           
           //echo "required $required";
         if ($preg->tipo == "NIV1_4") {
                  $alternativas="";
                  //$alternativas= file_get_contents("views/medicion/" . $id_empresa . "_preguntas_niv1_7.html");
         if ($preg->respuesta) {

         $alternativas .= "<center> <input id='".$id_encuesta . $preg->id_pregunta."' name='".$id_encuesta . $preg->id_pregunta."' type='number'
            class='rating' max='4' data-step='1' data-stars='4' data-size='md' data-glyphicon='false'
            data-rating-class='fontawesome-icon' data-symbol='&#xe73b;'  value='".$preg->respuesta."'   ></center>";
            } else {


                 $alternativas .= "<center> <input id='".$id_encuesta . $preg->id_pregunta."' name='".$id_encuesta . $preg->id_pregunta."' type='number'
            class='rating' max='4' data-step='1' data-stars='4' data-size='md' data-glyphicon='false'
            data-rating-class='fontawesome-icon' data-symbol='&#xe73b;'  ></center>";
            }


         }

					if ($preg->tipo == "SELMUL") {
						   //echo "-> hola SELMUL";
					                         $alternativas=""; $option="";
					                  //$alternativas= file_get_contents("views/medicion/" . $id_empresa . "_preguntas_niv1_7.html");
					            if ($preg->respuesta) {

					     $option.="<option value=''></option> ";
					if($preg->alt1<>'')   {if($preg->alt1==$preg->respuesta){$check1=" selected ";} $option.="<option value='".($preg->alt1)."' $check1>".($preg->alt1)."</option> ";}
					if($preg->alt2<>'')   {if($preg->alt2==$preg->respuesta){$check2=" selected ";} $option.="<option value='".($preg->alt2)."' $check2>".($preg->alt2)."</option> ";}
					if($preg->alt3<>'')   {if($preg->alt3==$preg->respuesta){$check3=" selected ";} $option.="<option value='".($preg->alt3)."' $check3>".($preg->alt3)."</option> ";}
					if($preg->alt4<>'')   {if($preg->alt4==$preg->respuesta){$check4=" selected ";} $option.="<option value='".($preg->alt4)."' $check4>".($preg->alt4)."</option> ";}
					if($preg->alt5<>'')   {if($preg->alt5==$preg->respuesta){$check5=" selected ";} $option.="<option value='".($preg->alt5)."' $check5>".($preg->alt5)."</option> ";}
					if($preg->alt6<>'')   {if($preg->alt6==$preg->respuesta){$check6=" selected ";} $option.="<option value='".($preg->alt6)."' $check6>".($preg->alt6)."</option> ";}
					if($preg->alt7<>'')   {if($preg->alt7==$preg->respuesta){$check7=" selected ";} $option.="<option value='".($preg->alt7)."' $check7>".($preg->alt7)."</option> ";}
					if($preg->alt8<>'')   {if($preg->alt8==$preg->respuesta){$check8=" selected ";} $option.="<option value='".($preg->alt8)."' $check8>".($preg->alt8)."</option> ";}
					if($preg->alt9<>'')   {if($preg->alt9==$preg->respuesta){$check9=" selected ";} $option.="<option value='".($preg->alt9)."' $check9>".($preg->alt9)."</option> ";}
					if($preg->alt10<>'')  {if($preg->alt10==$preg->respuesta){$check10=" selected ";} $option.="<option value='".($preg->alt10)."' $check10>".($preg->alt10)."</option> ";}
					if($preg->alt11<>'')   {if($preg->alt11==$preg->respuesta){$check11=" selected ";} $option.="<option value='".($preg->alt11)."' $check11>".($preg->alt11)."</option> ";}
					if($preg->alt12<>'')   {if($preg->alt12==$preg->respuesta){$check12=" selected ";} $option.="<option value='".($preg->alt12)."' $check12>".($preg->alt12)."</option> ";}
					if($preg->alt13<>'')   {if($preg->alt13==$preg->respuesta){$check13=" selected ";} $option.="<option value='".($preg->alt13)."' $check13>".($preg->alt13)."</option> ";}
					if($preg->alt14<>'')   {if($preg->alt14==$preg->respuesta){$check14=" selected ";} $option.="<option value='".($preg->alt14)."' $check14>".($preg->alt14)."</option> ";}
					if($preg->alt15<>'')   {if($preg->alt15==$preg->respuesta){$check15=" selected ";} $option.="<option value='".($preg->alt15)."' $check15>".($preg->alt15)."</option> ";}
					if($preg->alt16<>'')   {if($preg->alt16==$preg->respuesta){$check16=" selected ";} $option.="<option value='".($preg->alt16)."' $check16>".($preg->alt16)."</option> ";}
					if($preg->alt17<>'')   {if($preg->alt17==$preg->respuesta){$check17=" selected ";} $option.="<option value='".($preg->alt17)."' $check17>".($preg->alt17)."</option> ";}
					if($preg->alt18<>'')   {if($preg->alt18==$preg->respuesta){$check18=" selected ";} $option.="<option value='".($preg->alt18)."' $check18>".($preg->alt18)."</option> ";}
					if($preg->alt19<>'')   {if($preg->alt19==$preg->respuesta){$check19=" selected ";} $option.="<option value='".($preg->alt19)."' $check19>".($preg->alt19)."</option> ";}

					$alternativas .= "<center>


					 <select id='".$id_encuesta . $preg->id_pregunta."' name='".$id_encuesta . $preg->id_pregunta."' class='form form-control' ".$required.">
					    ".$option."
					</select>  </center>";



					            } else {

					    //echo  "<br>preg selmul ".$preg->alt1;
					    $option.="<option value=''></option> ";
					if($preg->alt1<>'')   {$option.="<option value='".($preg->alt1)."'>".($preg->alt1)."</option> ";}
					if($preg->alt2<>'')   {$option.="<option value='".($preg->alt2)."'>".($preg->alt2)."</option> ";}
					if($preg->alt3<>'')   {$option.="<option value='".($preg->alt3)."'>".($preg->alt3)."</option> ";}
					if($preg->alt4<>'')   {$option.="<option value='".($preg->alt4)."'>".($preg->alt4)."</option> ";}
					if($preg->alt5<>'')   {$option.="<option value='".($preg->alt5)."'>".($preg->alt5)."</option> ";}
					if($preg->alt6<>'')   {$option.="<option value='".($preg->alt6)."'>".($preg->alt6)."</option> ";}
					if($preg->alt7<>'')   {$option.="<option value='".($preg->alt7)."'>".($preg->alt7)."</option> ";}
					if($preg->alt8<>'')   {$option.="<option value='".($preg->alt8)."'>".($preg->alt8)."</option> ";}
					if($preg->alt9<>'')   {$option.="<option value='".($preg->alt9)."'>".($preg->alt9)."</option> ";}
					if($preg->alt10<>'')   {$option.="<option value='".($preg->alt10)."'>".($preg->alt10)."</option> ";}
					if($preg->alt11<>'')   {$option.="<option value='".($preg->alt11)."'>".($preg->alt11)."</option> ";}
					if($preg->alt12<>'')   {$option.="<option value='".($preg->alt12)."'>".($preg->alt12)."</option> ";}
					if($preg->alt13<>'')   {$option.="<option value='".($preg->alt13)."'>".($preg->alt13)."</option> ";}
					if($preg->alt14<>'')   {$option.="<option value='".($preg->alt14)."'>".($preg->alt14)."</option> ";}
					if($preg->alt15<>'')   {$option.="<option value='".($preg->alt15)."'>".($preg->alt15)."</option> ";}
					if($preg->alt16<>'')   {$option.="<option value='".($preg->alt16)."'>".($preg->alt16)."</option> ";}
					if($preg->alt17<>'')   {$option.="<option value='".($preg->alt17)."'>".($preg->alt17)."</option> ";}
					if($preg->alt18<>'')   {$option.="<option value='".($preg->alt18)."'>".($preg->alt18)."</option> ";}
					if($preg->alt19<>'')   {$option.="<option value='".($preg->alt19)."'>".($preg->alt19)."</option> ";}



					$alternativas .= "<center>


					 <select  id='".$id_encuesta . $preg->id_pregunta."' name='".$id_encuesta . $preg->id_pregunta."' class='form form-control' ".$required.">
					   ".$option."
					</select>  </center>";            
					}

						}
					         
					         
										if ($preg->tipo == "SELMUL_REAL") {   //echo "-> hola SELMUL";
										                         $alternativas=""; $option="";
										                  //$alternativas= file_get_contents("views/medicion/" . $id_empresa . "_preguntas_niv1_7.html");
										            if ($preg->respuesta) {

										    $option.=" ";
										if($preg->alt1<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_1' value='".($preg->alt1)."'> ".($preg->alt1)."<br> ";}
										if($preg->alt2<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_2' value='".($preg->alt2)."'> ".($preg->alt2)."<br>  ";}
										if($preg->alt3<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_3' value='".($preg->alt3)."'> ".($preg->alt3)."<br>  ";}
										if($preg->alt4<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_4' value='".($preg->alt4)."'> ".($preg->alt4)."<br>  ";}
										if($preg->alt5<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_5' value='".($preg->alt5)."'> ".($preg->alt5)."<br>  ";}
										if($preg->alt6<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_6' value='".($preg->al16)."'> ".($preg->alt6)."<br> ";}
										if($preg->alt7<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_7' value='".($preg->alt7)."'> ".($preg->alt7)."<br> ";}
										if($preg->alt8<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_8' value='".($preg->alt8)."'> ".($preg->alt8)."<br> ";}
										if($preg->alt9<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_9' value='".($preg->alt9)."'> ".($preg->alt9)."<br> ";}
										if($preg->alt10<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_10' value='".($preg->alt10)."'> ".($preg->alt10)."<br> ";}
										if($preg->alt11<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_11' value='".($preg->alt11)."'> ".($preg->alt11)."<br>  ";}
										if($preg->alt12<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_12' value='".($preg->alt12)."'> ".($preg->alt12)."<br>  ";}
										if($preg->alt13<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_13' value='".($preg->alt13)."'> ".($preg->alt13)."<br>  ";}
										if($preg->alt14<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_14' value='".($preg->alt14)."'> ".($preg->alt14)."<br> ";}
										if($preg->alt15<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_15' value='".($preg->alt15)."'> ".($preg->alt15)."<br>  ";}
										if($preg->alt16<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_16' value='".($preg->alt16)."'> ".($preg->alt16)."<br>  ";}
										if($preg->alt17<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_17' value='".($preg->alt17)."'> ".($preg->alt17)."<br>  ";}
										if($preg->alt18<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_18' value='".($preg->alt18)."'> ".($preg->alt18)."<br>  ";}
										if($preg->alt19<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_19' value='".($preg->alt19)."'> ".($preg->alt19)."<br>  ";}


										$alternativas .= "
										   ".$option."
										";  



										            } else {

										    //echo  "<br>preg selmul ".$preg->alt1;
										    $option.=" ";
										if($preg->alt1<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_1' value='".($preg->alt1)."'> ".($preg->alt1)."<br> ";}
										if($preg->alt2<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_2' value='".($preg->alt2)."'> ".($preg->alt2)."<br>  ";}
										if($preg->alt3<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_3' value='".($preg->alt3)."'> ".($preg->alt3)."<br>  ";}
										if($preg->alt4<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_4' value='".($preg->alt4)."'> ".($preg->alt4)."<br>  ";}
										if($preg->alt5<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_5' value='".($preg->alt5)."'> ".($preg->alt5)."<br>  ";}
										if($preg->alt6<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_6' value='".($preg->al16)."'> ".($preg->alt6)."<br> ";}
										if($preg->alt7<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_7' value='".($preg->alt7)."'> ".($preg->alt7)."<br> ";}
										if($preg->alt8<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_8' value='".($preg->alt8)."'> ".($preg->alt8)."<br> ";}
										if($preg->alt9<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_9' value='".($preg->alt9)."'> ".($preg->alt9)."<br> ";}
										if($preg->alt10<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_10' value='".($preg->alt10)."'> ".($preg->alt10)."<br> ";}
										if($preg->alt11<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_11' value='".($preg->alt11)."'> ".($preg->alt11)."<br>  ";}
										if($preg->alt12<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_12' value='".($preg->alt12)."'> ".($preg->alt12)."<br>  ";}
										if($preg->alt13<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_13' value='".($preg->alt13)."'> ".($preg->alt13)."<br>  ";}
										if($preg->alt14<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_14' value='".($preg->alt14)."'> ".($preg->alt14)."<br> ";}
										if($preg->alt15<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_15' value='".($preg->alt15)."'> ".($preg->alt15)."<br>  ";}
										if($preg->alt16<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_16' value='".($preg->alt16)."'> ".($preg->alt16)."<br>  ";}
										if($preg->alt17<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_17' value='".($preg->alt17)."'> ".($preg->alt17)."<br>  ";}
										if($preg->alt18<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_18' value='".($preg->alt18)."'> ".($preg->alt18)."<br>  ";}
										if($preg->alt19<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_19' value='".($preg->alt19)."'> ".($preg->alt19)."<br>  ";}



										$alternativas .= "
										   ".$option."
										";            
												}

											}         
					         


					         if ($preg->tipo == "NIV1_7_DOBLE") {
					                  $alternativas="";
					                  //$alternativas= file_get_contents("views/medicion/" . $id_empresa . "_preguntas_niv1_7.html");
					            if ($preg->respuesta) {

					         $alternativas .= "
							 <div class='row'>
							 <div class='col-lg-6'><center> <span style='font-weight: 400;font-size: 12px;
					    color: #444;'>".$preg->alt1."</span><input id='".$id_encuesta . $preg->id_pregunta."' name='".$id_encuesta . $preg->id_pregunta."' type='number'
					            class='rating' max='7' data-step='1' data-stars='7' data-size='md' data-glyphicon='false'
					            data-rating-class='fontawesome-icon' data-symbol='&#xe73b;'  value='".$preg->respuesta."'   ></center>
								</div>
							 ";
								
								
					         $alternativas .= "
							 
							 
							 <div class='col-lg-6'><center>  <span style='font-weight: 400;font-size: 12px;
					    color: #444;'>".$preg->alt2."</span><input id='".$id_encuesta . $preg->id_pregunta."_2' name='".$id_encuesta . $preg->id_pregunta."_2' type='number'
					            class='rating' max='7' data-step='1' data-stars='7' data-size='md' data-glyphicon='false'
					            data-rating-class='fontawesome-icon' data-symbol='&#xe73b;'  value='".$preg->respuesta."'   ></center>
								</div>
							 </div>";	
							 
					            } else {


					                 $alternativas .= "
									 
							<div class='row'>
									 <div class='col-lg-6'><center>
									 <span style='font-weight: 400;font-size: 12px;
					    color: #444;'>".$preg->alt1."</span>
									 <input id='".$id_encuesta . $preg->id_pregunta."' name='".$id_encuesta . $preg->id_pregunta."' type='number'
					            class='rating' max='7' data-step='1' data-stars='7' data-size='md' data-glyphicon='false'
					            data-rating-class='fontawesome-icon' data-symbol='&#xe73b;'  ></center>
							</div>
							";
								
					                 $alternativas .= "
							    
									 
								<div class='col-lg-6'><center>
								 <span style='font-weight: 400;font-size: 12px;
					    color: #444;'>".$preg->alt2."</span>
							<input id='".$id_encuesta . $preg->id_pregunta."_2' name='".$id_encuesta . $preg->id_pregunta."_2' type='number'
					            class='rating' max='7' data-step='1' data-stars='7' data-size='md' data-glyphicon='false'
					            data-rating-class='fontawesome-icon' data-symbol='&#xe73b;'  ></center></div>
							</div>";			
					            }


					         }

					        if ($preg->tipo == "CHECKBOX_EQUIPO") {
					            $alternativas = "";
								
								$array_equipo=BuscamiEquipo($rut, $id_empresa);
					  $alternativas .= "<div class='row'>";
					  foreach ($array_equipo as $unico)
							{
								$usuario_tiene_gente_a_cargo=BuscamiEquipo($unico->rut, $id_empresa);
								if(count($usuario_tiene_gente_a_cargo)<1) continue;
					  
					                $alternativas .= "
									<div class='col-lg-4'>
					                        <left>
					                            <input type='checkbox' name='checkbox_equipo[]' value='" . $unico->rut. "' >" . $unico->nombre_completo . "
											</left>
					                </div>
									";
								}
					            $alternativas .= "</div>";
					        }


					        if ($preg->tipo == "NIV1_3") {
					            $alternativas = "<table width='100%'><tr>";
					            for ($i = 1; $i <= 3; $i++) {
					                if ($preg->respuesta == $i) {
					                    $checked = " checked ";
					                } else {
					                    $checked = "  ";
					                }
					                $alternativas .= "<td width='33%'>
					                        <center>
					                            <input type='radio' name='" . $id_encuesta . $preg->id_pregunta . "' value='" . $i . "' " . $checked . ">
					                            <br>" . $i . "</center>
					                            </td>";
					            }
					            $alternativas .= "</tr></table>";
					        }


					        if ($preg->tipo == "NIV1_5_NoAplica") {
					            $alternativas = "<table width='100%'><tr>";
					            for ($i = 1; $i <= 5; $i++) {
					                if ($preg->respuesta == $i) {
					                    $checked = " checked ";
					                } else {
					                    $checked = "  ";
					                }
					                $alternativas .= "<td width='16%'>
					                        <center>
					                            <input type='radio' name='" . $id_encuesta . $preg->id_pregunta . "' value='" . $i . "' " . $checked . ">
					                            <br>" . $i . "</center>
					                            </td>";
					            }
					            $alternativas .= "<td width='16%'>
					                        <center>
					                            <input type='radio' name='" . $id_encuesta . $preg->id_pregunta . "' value='NA' " . $checked . ">
					                            <br>No Aplica</center>
					                            </td>
					            
					            
					            
					            </tr></table>";
					        }

					        if ($preg->tipo == "NIV1_5") {
					            $alternativas = "<table width='100%'><tr>";
					            for ($i = 1; $i <= 5; $i++) {
					                if ($preg->respuesta == $i) {
					                    $checked = " checked ";
					                } else {
					                    $checked = "  ";
					                }
					                $alternativas .= "<td width='20%'>
					                        <center>
					                            <input type='radio' name='" . $id_encuesta . $preg->id_pregunta . "' value='" . $i . "' " . $checked . ">
					                            <br>" . $i . "</center>
					                            </td>";
					            }
					            $alternativas .= "</tr></table>";
					        }


					        if ($preg->tipo == "NIV1_7") {
					            $alternativas = "<table width='100%'><tr>";
					            for ($i = 1; $i <= 7; $i++) {
					                if ($preg->respuesta == $i) {
					                    $checked = " checked ";
					                } else {
					                    $checked = "  ";
					                }
					                $alternativas .= "<td width='14%'>
					                        <center>
					                            <input type='radio' name='" . $id_encuesta . $preg->id_pregunta . "' value='" . $i . "' ".$checked." ".$required.">
					                            <br>" . $i . "</center>
					                            </td>";
					            }
					            $alternativas .= "</tr></table>";
					        }


					        if ($preg->tipo == "NIV1_10") {
					            $alternativas = "<table width='100%'><tr>";
					            for ($i = 1; $i <= 10; $i++) {
					                if ($preg->respuesta == $i) {
					                    $checked = " checked ";
					                } else {
					                    $checked = "  ";
					                }
					                $alternativas .= "<td width='10%'>
					                        <center>
					                            <input type='radio' name='" . $id_encuesta . $preg->id_pregunta . "' value='" . $i . "' " . $checked . ">
					                            <br>" . $i . "</center>
					                            </td>";
					            }
					            $alternativas .= "</tr></table>";
					        }
							
							        if ($preg->tipo == "NIV1_7_radio") {
					            $alternativas = "<table width='100%'><tr>";
					            for ($i = 1; $i <= 7; $i++) {
					                if ($preg->respuesta == $i) {
					                    $checked = " checked ";
					                } else {
					                    $checked = "  ";
					                }
					                $alternativas .= "<td width='10%'>
					                        <center>
					                            <input type='radio' name='" . $id_encuesta . $preg->id_pregunta . "' value='" . $i . "' " . $checked . " required>
					                            <br>" . $i . "</center>
					                            </td>";
					            }
					            $alternativas .= "</tr></table>";
					        }
							
					        //echo $preg->tipo;
					        if ($preg->tipo == "SI_NO") {
					            if ($preg->respuesta == "SI") {
					                $checkedSI = " checked ";
					            } else {
					                $checkedSI = "  ";
					            }
					            if ($preg->respuesta == "NO") {
					                $checkedNO = " checked ";
					            } else {
					                $checkedNO = "  ";
					            }
					            $alternativas = "<table width='100%' border=0><tr>";
					            $alternativas .= "<td width='50%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
					                    value='NO' " . $checkedNO . " required><br>
					                    <span class='badge badge-danger'><span class='blanco'>NO</span></span></center><br></td>";
					            $alternativas .= "<td width='50%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
					                    value='SI' " . $checkedSI . " required><br>
					                    <span class='badge badge-info' style='background-color: #8BB851;'><span class='blanco'>SI</span></span></center><br></td>";
					            $alternativas .= "</tr></table>";
					        }

					        if ($preg->tipo == "SECCION") {
							$alternativas = "";	
								
							}

							
					        if ($preg->tipo == "SI_NO_OPCION") {
					            if ($preg->respuesta == "SI") {
					                $checkedSI = " checked ";
									} else {
					                $checkedSI = "  ";
					            }
					            if ($preg->respuesta == "NO") {
					                $checkedNO = " checked ";
					            } else {
					                $checkedNO = "  ";
					            }
					            $alternativas = "<table width='100%' border=0><tr>";
					            $alternativas .= "<td width='50%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
					                    value='NO' " . $checkedNO . " required><br>
					                    <span class='badge badge-danger'><span class='blanco'>NO</span></span></center><br></td>";
					            $alternativas .= "<td width='50%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
					                    value='SI' " . $checkedSI . " required onclick='javascript:showDiv();'><br>
					                    <span class='badge badge-info'><span class='blanco'>SI</span></span></center><br></td>";
					            $alternativas .= "</tr></table>";
					        }		
							
							
							
					        if ($preg->tipo == "LIK_1_5") {
					            if ($preg->respuesta == "1") {
					                $checkedUno = " checked ";
					            } else {
					                $checkedUno = "  ";
					            }
					            if ($preg->respuesta == "2") {
					                $checkedDos = " checked ";
					            } else {
					                $checkedDos = "  ";
					            }
					            if ($preg->respuesta == "3") {
					                $checkedTres = " checked ";
					            } else {
					                $checkedTres = "  ";
					            }
					            if ($preg->respuesta == "4") {
					                $checkedCuatro = " checked ";
					            } else {
					                $checkedCuatro = "  ";
					            }
					            if ($preg->respuesta == "5") {
					                $checkedCinco = " checked ";
					            } else {
					                $checkedCinco = "  ";
					            }
					            $alternativas = "<table width='100%'><tr>";
					            $alternativas .= "<td width='20%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
					                    value='1' " . $checkedUno . " required><br><img src='img/med_sad.png' width='32px'><br>
					                    <span class='badge badge-danger'><span class='blanco'>Totalmente en Desacuerdo</span></span></center><br></td>";
					            $alternativas .= "<td width='20%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
					                    value='2' " . $checkedDos . " required><br><img src='img/med_sad.png' width='32px'><br>
					                    <span class='badge badge-danger'><span class='blanco'>En Desacuerdo</span></span></center><br></td>";
					            $alternativas .= "<td width='20%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
					                    value='3' " . $checkedTres . " required><br><img src='img/med_confused.png' width='32px'>  <br>
					                    <span class='badge badge-info'><span class='blanco'>Ni de Acuerdo ni en Desacuerdo</span></span></center><br></td>";
					            $alternativas .= "<td width='20%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
					                    value='4' " . $checkedCuatro . " required><br><img src='img/med_happy.png' width='32px'> <br>
					                    <span class='badge badge-info'><span class='blanco'>De Acuerdo</span></span></center><br></td>";
					            $alternativas .= "<td width='20%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
					                    value='5' " . $checkedCinco . " required><br><img src='img/med_happy.png' width='32px'> <br>
					                    <span class='badge badge-success'><span class='blanco'>Totalmente  de Acuerdo</span></span></center><br></td>";
					            $alternativas .= "</tr></table>";
					        }
					if ($preg->tipo == "LIK_1_4") {
					            if ($preg->respuesta == "1") {
					                $checkedUno = " checked ";
					            } else {
					                $checkedUno = "  ";
					            }
					            if ($preg->respuesta == "2") {
					                $checkedDos = " checked ";
					            } else {
					                $checkedDos = "  ";
					            }
					            if ($preg->respuesta == "3") {
					                $checkedTres = " checked ";
					            } else {
					                $checkedTres = "  ";
					            }
					            if ($preg->respuesta == "4") {
					                $checkedCuatro = " checked ";
					            } else {
					                $checkedCuatro = "  ";
					            }
					            if ($preg->respuesta == "5") {
					                $checkedCinco = " checked ";
					            } else {
					                $checkedCinco = "  ";
					            }
					            $alternativas = "<table width='100%'><tr>";
					            $alternativas .= "<td width='25%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
					                    value='Totalmente de acuerdo' " . $checkedCuatro . " required><br>
					                    <span class='badge badge-info'><span class='blanco'>Totalmente de acuerdo
					</span></span></center><br></td>";
					            $alternativas .= "<td width='25%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
					                    value='De acuerdo' " . $checkedTres . " required><br>
					                    <span class='badge badge-info'><span class='blanco'>De acuerdo
					</span></span></center><br></td>";
					            $alternativas .= "<td width='25%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
					                    value='En desacuerdo' " . $checkedDos . " required><br>

					                    <span class='badge badge-danger'><span class='blanco'>En desacuerdo
					</span></span></center><br></td>";
					            $alternativas .= "<td width='25%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
					                    value='Totalmente en desacuerdo' " . $checkedUno . " required><br>
					                    <span class='badge badge-danger'><span class='blanco'>Totalmente en desacuerdo
					</span></span></center><br></td>";
					            $alternativas .= "</tr></table>";
					        }

					if ($preg->tipo == "LIK_1_4_VAR") {
					            if ($preg->respuesta == "1") {
					                $checkedUno = " checked ";
					            } else {
					                $checkedUno = "  ";
					            }
					            if ($preg->respuesta == "2") {
					                $checkedDos = " checked ";
					            } else {
					                $checkedDos = "  ";
					            }
					            if ($preg->respuesta == "3") {
					                $checkedTres = " checked ";
					            } else {
					                $checkedTres = "  ";
					            }
					            if ($preg->respuesta == "4") {
					                $checkedCuatro = " checked ";
					            } else {
					                $checkedCuatro = "  ";
					            }
					            if ($preg->respuesta == "5") {
					                $checkedCinco = " checked ";
					            } else {
					                $checkedCinco = "  ";
					            }
					            $alternativas = "<table width='100%'><tr>";
					            $alternativas .= "<td width='20%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
					                    value='Totalmente de acuerdo' " . $checkedCuatro . " required><br>

					                    <span class='badge badge-info'><span class='blanco'>Totalmente de acuerdo
					</span></span></center><br></td>";
					            $alternativas .= "<td width='20%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
					                    value='De acuerdo' " . $checkedTres . " required><br>

					                    <span class='badge badge-info'><span class='blanco'>De acuerdo
					</span></span></center><br></td>";
					            $alternativas .= "<td width='20%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
					                    value='En desacuerdo' " . $checkedDos . " required><br>

					                    <span class='badge badge-danger'><span class='blanco'>En desacuerdo
					</span></span></center><br></td>";
					            $alternativas .= "<td width='20%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
					                    value='Totalmente en desacuerdo' " . $checkedUno . " required><br>

					                    <span class='badge badge-danger'><span class='blanco'>Totalmente en desacuerdo
					</span></span></center><br></td>";
					            $alternativas .= "<td width='20%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
					                    value='No he recibido capacitaciones' " . $checkedUno . " required><br>

					                    <span class='badge badge-danger'><span class='blanco'>No aplica
					</span></span></center><br></td>";            $alternativas .= "</tr></table>";
					        }

					              if ($preg->tipo == "TEXT") {    //echo "-> hola txt";
					                         $alternativas="";
					                  //$alternativas= file_get_contents("views/medicion/" . $id_empresa . "_preguntas_niv1_7.html");
					            if ($preg->respuesta) {

					$alternativas .= "<center> <input id='".$id_encuesta . $preg->id_pregunta."' name='".$id_encuesta . $preg->id_pregunta."' value='".utf8_encode($preg->respuesta)."' type='text' class='form form-control' ".$required."  ></center>";

					            } else {


					$alternativas .= "<center> <input id='".$id_encuesta . $preg->id_pregunta."' name='".$id_encuesta . $preg->id_pregunta."' type='text'  class='form form-control' ".$required." ></center>";
					            }

					         }
					         if ($preg->tipo == "TITLE") {    //echo "-> hola txt";
					                         $alternativas="";
					                  //$alternativas= file_get_contents("views/medicion/" . $id_empresa . "_preguntas_niv1_7.html");

					         }

					         if ($preg->tipo == "TEXTAREA_HIDE") {    //echo "-> hola txt";
					                         $alternativas="";
					                  //$alternativas= file_get_contents("views/medicion/" . $id_empresa . "_preguntas_niv1_7.html");
									  if ($preg->respuesta) {

					$alternativas .= "
					<div  style='display:none' id='tow' name='tow' class='tow'>
					<div class='alert alert-info' role='alert'>
					    <strong>Explica brevemente qu&eacute; reconoce La Selecci&oacute;n del Chile: </strong>
					</div>


					<center> <textarea id='".$id_encuesta . $preg->id_pregunta."' rows='4' name='".$id_encuesta . $preg->id_pregunta."'  class='form form-control tow' ".$required."  style='display:none'  >".utf8_encode($preg->respuesta)."</textarea></center>

					</div>
					";

					            } else {


					$alternativas .= "
					<div  style='display:none' id='tow' name='tow' class='tow'>
					<div class='alert alert-info' role='alert'>
					    <strong>Explica brevemente qu&eacute; reconoce La Selecci&oacute;n del Chile: </strong>
					</div>


					<center> <textarea id='".$id_encuesta . $preg->id_pregunta."' rows='4' name='".$id_encuesta . $preg->id_pregunta."'  class='form form-control tow' ".$required."  ></textarea></center>

					</div>
					";
					            }

					         }		 
							 
							 
							 
					         if ($preg->tipo == "TEXTAREA") {    //echo "-> hola txt";
					                         $alternativas="";
					                  //$alternativas= file_get_contents("views/medicion/" . $id_empresa . "_preguntas_niv1_7.html");
					            if ($preg->respuesta) {

					$alternativas .= "<center> <textarea id='".$id_encuesta . $preg->id_pregunta."' rows='4' name='".$id_encuesta . $preg->id_pregunta."'  class='form form-control' ".$required."  >".utf8_encode($preg->respuesta)."</textarea></center>";

					            } else {


					$alternativas .= "<center> <textarea id='".$id_encuesta . $preg->id_pregunta."' rows='4' name='".$id_encuesta . $preg->id_pregunta."'  class='form form-control' ".$required."  ></textarea></center>";
					            }

					         }

					    if ($preg->tipo == "LIK1_4") {

					    //echo "hola";
					        if ($preg->respuesta == "1") {
					                $checkedUno = " checked ";
					            } else {
					                $checkedUno = "  ";
					            }
					            if ($preg->respuesta == "2") {
					                $checkedDos = " checked ";
					            } else {
					                $checkedDos = "  ";
					            }
					            if ($preg->respuesta == "3") {
					                $checkedTres = " checked ";
					            } else {
					                $checkedTres = "  ";
					            }
					            if ($preg->respuesta == "4") {
					                $checkedCuatro = " checked ";
					            } else {
					                $checkedCuatro = "  ";
					            }
					            if ($preg->respuesta == "5") {
					                $checkedCinco = " checked ";
					            } else {
					                $checkedCinco = "  ";
					            }
					            $alternativas = "<table width='100%'><tr>";
					            $alternativas .= "<td width='20%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
					                    value='1' " . $checkedUno . " required><br><img src='img/med_sad.png' width='32px'><br>
					                    <span class='badge badge-danger'><span class='blanco'>Muy en desacuerdo</span></span></center><br><br></td>";
					            $alternativas .= "<td width='20%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
					                    value='2' " . $checkedDos . " required><br><img src='img/med_sad.png' width='32px'><br>
					                    <span class='badge badge-danger'><span class='blanco'>Desacuerdo</span></span></center><br><br></td>";
					            $alternativas .= "<td width='20%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
					                    value='3' " . $checkedTres . " required><br><img src='img/med_happy.png' width='32px'>  <br>
					                    <span class='badge badge-info'><span class='blanco'>De acuerdo</span></span></center><br><br></td>";
					            $alternativas .= "<td width='20%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
					                    value='4' " . $checkedCuatro . " required><br><img src='img/med_happy.png' width='32px'> <br>
					                    <span class='badge badge-info'><span class='blanco'>Muy de acuerdo</span></span></center><br><br></td>";
					            $alternativas .= "</tr></table>";
					        }


					//echo "<br><br>pregunta ".$preg->pregunta." tipo ".$preg->tipo." dimension ".$preg->dimension;

					if ($preg->tipo == "SECC_DIM_TXT") {

						$pregunta="
						<div class='badge badge-info'><span class='blanco'><i class='fas fa-caret-right'></i> ".($preg->dimension)."</span></div>
						<br><br>
						<div class='alert alert-warning' role='alert'>".($preg->pregunta)."<strong></div>";
						 
					}


					elseif ($preg->tipo == "SECC_DIM") {
					//ECHO "SEC DIM";
						$pregunta="
						<div class='badge badge-info'><span class='blanco'><i class='fas fa-caret-right'></i> ".($preg->dimension)."</span></div><br>
						";
						//ECHO "pregunta $pregunta";
					$alternativas="";	 
					} 

					elseif ($preg->tipo == "SECC_TXT") {

						$pregunta="
						<div class='alert alert-warning' role='alert'><i class='fas fa-caret-right'></i> ".($preg->pregunta)."<strong></div>";
					$alternativas="";
						 
					} 

					elseif ($preg->tipo == "SECC_DIM_2") {

						$pregunta="
						<div class='alert alert-primary' role='alert'><i class='fas fa-caret-right'></i> ".($preg->dimension)."<strong></div>";
					$alternativas="";
						 
					} 

					 else {
						 
						$pregunta="<div class='alert alert-info' role='alert'>	<strong>".($preg->pregunta)."</strong></div>";

					}

					        $row = str_replace("{ID_PREGUNTA}", $preg->id_pregunta, $row);
					        $row = str_replace("{PREGUNTA}", ($pregunta), $row);
					        $row = str_replace("{ALTERNATIVAS}", $alternativas, $row);
					        $row = str_replace("{RUT}", $rut, $row);
					        $row = str_replace("{RUT_COLABORADOR}", $rut_colaborador, $row);
					        $row = str_replace("{ID_PREGUNTA}", $preg->id_pregunta, $row);
							
					    }
    if ($replace <> '') {
        $PRINCIPAL = str_replace($replace, utf8_encode($row), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{ROW_PREGUNTAS}", utf8_encode($row), $PRINCIPAL);
    }
    return ($PRINCIPAL);
}

function ColocaPreguntasMedicionColaboradoresReplaceProsci($PRINCIPAL, $id_empresa, $rut, $id_encuesta, $id_medicion, $rut_colaborador, $replace, $id_proyecto)
{
    $preguntas = PreguntasMedicionProsci($id_empresa, $id_encuesta, $id_medicion, $rut, $rut_colaborador,$id_proyecto);
    //echo "<br><br> $id_encuesta, $id_medicion<br>";print_r($preguntas);
    //echo "rut $rut_colaborador";
    //echo "<br>---$rut" .$id_encuesta ." ". $preg->id_pregunta;
    $row       = "";
    foreach ($preguntas as $preg) {
        if ($preg->respuesta) {
            $row .= file_get_contents("views/medicion/" . $id_empresa . "_preguntas_medicion_lectura.html");
        } else {
            $row .= file_get_contents("views/medicion/" . $id_empresa . "_preguntas_medicion.html");
        }
           
         if ($preg->tipo == "NIV1_4") {
                  $alternativas="";
                  //$alternativas= file_get_contents("views/medicion/" . $id_empresa . "_preguntas_niv1_7.html");
         if ($preg->respuesta and $preg->id_foco=="$id_proyecto") {

         $alternativas .= "<center> <input id='".$id_encuesta . $preg->id_pregunta."' name='".$id_encuesta . $preg->id_pregunta."' type='number'
            class='rating' max='4' data-step='1' data-stars='4' data-size='md' data-glyphicon='false'
            data-rating-class='fontawesome-icon' data-symbol='&#xe73b;'  value='".$preg->respuesta."'   ></center>";
            } else {


                 $alternativas .= "<center> <input id='".$id_encuesta . $preg->id_pregunta."' name='".$id_encuesta . $preg->id_pregunta."' type='number'
            class='rating' max='4' data-step='1' data-stars='4' data-size='md' data-glyphicon='false'
            data-rating-class='fontawesome-icon' data-symbol='&#xe73b;'  ></center>";
            }


         }

							if ($preg->tipo == "SELMUL") {   //echo "-> hola SELMUL";
							                         $alternativas=""; $option="";
							                  //$alternativas= file_get_contents("views/medicion/" . $id_empresa . "_preguntas_niv1_7.html");
							            if ($preg->respuesta and $preg->id_foco=="$id_proyecto") {

							     $option.="<option value=''></option> ";
							if($preg->alt1<>'')   {if($preg->alt1==$preg->respuesta){$check1=" selected ";} $option.="<option value='".($preg->alt1)."' $check1>".($preg->alt1)."</option> ";}
							if($preg->alt2<>'')   {if($preg->alt2==$preg->respuesta){$check2=" selected ";} $option.="<option value='".($preg->alt2)."' $check2>".($preg->alt2)."</option> ";}
							if($preg->alt3<>'')   {if($preg->alt3==$preg->respuesta){$check3=" selected ";} $option.="<option value='".($preg->alt3)."' $check3>".($preg->alt3)."</option> ";}
							if($preg->alt4<>'')   {if($preg->alt4==$preg->respuesta){$check4=" selected ";} $option.="<option value='".($preg->alt4)."' $check4>".($preg->alt4)."</option> ";}
							if($preg->alt5<>'')   {if($preg->alt5==$preg->respuesta){$check5=" selected ";} $option.="<option value='".($preg->alt5)."' $check5>".($preg->alt5)."</option> ";}
							if($preg->alt6<>'')   {if($preg->alt6==$preg->respuesta){$check6=" selected ";} $option.="<option value='".($preg->alt6)."' $check6>".($preg->alt6)."</option> ";}
							if($preg->alt7<>'')   {if($preg->alt7==$preg->respuesta){$check7=" selected ";} $option.="<option value='".($preg->alt7)."' $check7>".($preg->alt7)."</option> ";}
							if($preg->alt8<>'')   {if($preg->alt8==$preg->respuesta){$check8=" selected ";} $option.="<option value='".($preg->alt8)."' $check8>".($preg->alt8)."</option> ";}
							if($preg->alt9<>'')   {if($preg->alt9==$preg->respuesta){$check9=" selected ";} $option.="<option value='".($preg->alt9)."' $check9>".($preg->alt9)."</option> ";}
							if($preg->alt10<>'')  {if($preg->alt10==$preg->respuesta){$check10=" selected ";} $option.="<option value='".($preg->alt10)."' $check10>".($preg->alt10)."</option> ";}
							if($preg->alt11<>'')   {if($preg->alt11==$preg->respuesta){$check11=" selected ";} $option.="<option value='".($preg->alt11)."' $check11>".($preg->alt11)."</option> ";}
							if($preg->alt12<>'')   {if($preg->alt12==$preg->respuesta){$check12=" selected ";} $option.="<option value='".($preg->alt12)."' $check12>".($preg->alt12)."</option> ";}
							if($preg->alt13<>'')   {if($preg->alt13==$preg->respuesta){$check13=" selected ";} $option.="<option value='".($preg->alt13)."' $check13>".($preg->alt13)."</option> ";}
							if($preg->alt14<>'')   {if($preg->alt14==$preg->respuesta){$check14=" selected ";} $option.="<option value='".($preg->alt14)."' $check14>".($preg->alt14)."</option> ";}
							if($preg->alt15<>'')   {if($preg->alt15==$preg->respuesta){$check15=" selected ";} $option.="<option value='".($preg->alt15)."' $check15>".($preg->alt15)."</option> ";}
							if($preg->alt16<>'')   {if($preg->alt16==$preg->respuesta){$check16=" selected ";} $option.="<option value='".($preg->alt16)."' $check16>".($preg->alt16)."</option> ";}
							if($preg->alt17<>'')   {if($preg->alt17==$preg->respuesta){$check17=" selected ";} $option.="<option value='".($preg->alt17)."' $check17>".($preg->alt17)."</option> ";}
							if($preg->alt18<>'')   {if($preg->alt18==$preg->respuesta){$check18=" selected ";} $option.="<option value='".($preg->alt18)."' $check18>".($preg->alt18)."</option> ";}
							if($preg->alt19<>'')   {if($preg->alt19==$preg->respuesta){$check19=" selected ";} $option.="<option value='".($preg->alt19)."' $check19>".($preg->alt19)."</option> ";}

							$alternativas .= "<center>


							 <select id='".$id_encuesta . $preg->id_pregunta."' name='".$id_encuesta . $preg->id_pregunta."' class='form form-control' ".$required.">
							    ".$option."
							</select>  </center>";



							            } else {

							    //echo  "<br>preg selmul ".$preg->alt1;
							    $option.="<option value=''></option> ";
							if($preg->alt1<>'')   {$option.="<option value='".($preg->alt1)."'>".($preg->alt1)."</option> ";}
							if($preg->alt2<>'')   {$option.="<option value='".($preg->alt2)."'>".($preg->alt2)."</option> ";}
							if($preg->alt3<>'')   {$option.="<option value='".($preg->alt3)."'>".($preg->alt3)."</option> ";}
							if($preg->alt4<>'')   {$option.="<option value='".($preg->alt4)."'>".($preg->alt4)."</option> ";}
							if($preg->alt5<>'')   {$option.="<option value='".($preg->alt5)."'>".($preg->alt5)."</option> ";}
							if($preg->alt6<>'')   {$option.="<option value='".($preg->alt6)."'>".($preg->alt6)."</option> ";}
							if($preg->alt7<>'')   {$option.="<option value='".($preg->alt7)."'>".($preg->alt7)."</option> ";}
							if($preg->alt8<>'')   {$option.="<option value='".($preg->alt8)."'>".($preg->alt8)."</option> ";}
							if($preg->alt9<>'')   {$option.="<option value='".($preg->alt9)."'>".($preg->alt9)."</option> ";}
							if($preg->alt10<>'')   {$option.="<option value='".($preg->alt10)."'>".($preg->alt10)."</option> ";}
							if($preg->alt11<>'')   {$option.="<option value='".($preg->alt11)."'>".($preg->alt11)."</option> ";}
							if($preg->alt12<>'')   {$option.="<option value='".($preg->alt12)."'>".($preg->alt12)."</option> ";}
							if($preg->alt13<>'')   {$option.="<option value='".($preg->alt13)."'>".($preg->alt13)."</option> ";}
							if($preg->alt14<>'')   {$option.="<option value='".($preg->alt14)."'>".($preg->alt14)."</option> ";}
							if($preg->alt15<>'')   {$option.="<option value='".($preg->alt15)."'>".($preg->alt15)."</option> ";}
							if($preg->alt16<>'')   {$option.="<option value='".($preg->alt16)."'>".($preg->alt16)."</option> ";}
							if($preg->alt17<>'')   {$option.="<option value='".($preg->alt17)."'>".($preg->alt17)."</option> ";}
							if($preg->alt18<>'')   {$option.="<option value='".($preg->alt18)."'>".($preg->alt18)."</option> ";}
							if($preg->alt19<>'')   {$option.="<option value='".($preg->alt19)."'>".($preg->alt19)."</option> ";}



							$alternativas .= "<center>


							 <select  id='".$id_encuesta . $preg->id_pregunta."' name='".$id_encuesta . $preg->id_pregunta."' class='form form-control' ".$required.">
							   ".$option."
							</select>  </center>";            }

								}
							         
							         
							if ($preg->tipo == "SELMUL_REAL") {   //echo "-> hola SELMUL";
							                         $alternativas=""; $option="";
							                  //$alternativas= file_get_contents("views/medicion/" . $id_empresa . "_preguntas_niv1_7.html");
							            if ($preg->respuesta and $preg->id_foco=="$id_proyecto") {

							    $option.=" ";
							if($preg->alt1<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_1' value='".($preg->alt1)."'> ".($preg->alt1)."<br> ";}
							if($preg->alt2<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_2' value='".($preg->alt2)."'> ".($preg->alt2)."<br>  ";}
							if($preg->alt3<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_3' value='".($preg->alt3)."'> ".($preg->alt3)."<br>  ";}
							if($preg->alt4<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_4' value='".($preg->alt4)."'> ".($preg->alt4)."<br>  ";}
							if($preg->alt5<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_5' value='".($preg->alt5)."'> ".($preg->alt5)."<br>  ";}
							if($preg->alt6<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_6' value='".($preg->al16)."'> ".($preg->alt6)."<br> ";}
							if($preg->alt7<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_7' value='".($preg->alt7)."'> ".($preg->alt7)."<br> ";}
							if($preg->alt8<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_8' value='".($preg->alt8)."'> ".($preg->alt8)."<br> ";}
							if($preg->alt9<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_9' value='".($preg->alt9)."'> ".($preg->alt9)."<br> ";}
							if($preg->alt10<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_10' value='".($preg->alt10)."'> ".($preg->alt10)."<br> ";}
							if($preg->alt11<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_11' value='".($preg->alt11)."'> ".($preg->alt11)."<br>  ";}
							if($preg->alt12<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_12' value='".($preg->alt12)."'> ".($preg->alt12)."<br>  ";}
							if($preg->alt13<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_13' value='".($preg->alt13)."'> ".($preg->alt13)."<br>  ";}
							if($preg->alt14<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_14' value='".($preg->alt14)."'> ".($preg->alt14)."<br> ";}
							if($preg->alt15<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_15' value='".($preg->alt15)."'> ".($preg->alt15)."<br>  ";}
							if($preg->alt16<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_16' value='".($preg->alt16)."'> ".($preg->alt16)."<br>  ";}
							if($preg->alt17<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_17' value='".($preg->alt17)."'> ".($preg->alt17)."<br>  ";}
							if($preg->alt18<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_18' value='".($preg->alt18)."'> ".($preg->alt18)."<br>  ";}
							if($preg->alt19<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_19' value='".($preg->alt19)."'> ".($preg->alt19)."<br>  ";}


							$alternativas .= "
							   ".$option."
							";  



							            } else {

							    //echo  "<br>preg selmul ".$preg->alt1;
							    $option.=" ";
							if($preg->alt1<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_1' value='".($preg->alt1)."'> ".($preg->alt1)."<br> ";}
							if($preg->alt2<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_2' value='".($preg->alt2)."'> ".($preg->alt2)."<br>  ";}
							if($preg->alt3<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_3' value='".($preg->alt3)."'> ".($preg->alt3)."<br>  ";}
							if($preg->alt4<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_4' value='".($preg->alt4)."'> ".($preg->alt4)."<br>  ";}
							if($preg->alt5<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_5' value='".($preg->alt5)."'> ".($preg->alt5)."<br>  ";}
							if($preg->alt6<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_6' value='".($preg->al16)."'> ".($preg->alt6)."<br> ";}
							if($preg->alt7<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_7' value='".($preg->alt7)."'> ".($preg->alt7)."<br> ";}
							if($preg->alt8<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_8' value='".($preg->alt8)."'> ".($preg->alt8)."<br> ";}
							if($preg->alt9<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_9' value='".($preg->alt9)."'> ".($preg->alt9)."<br> ";}
							if($preg->alt10<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_10' value='".($preg->alt10)."'> ".($preg->alt10)."<br> ";}
							if($preg->alt11<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_11' value='".($preg->alt11)."'> ".($preg->alt11)."<br>  ";}
							if($preg->alt12<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_12' value='".($preg->alt12)."'> ".($preg->alt12)."<br>  ";}
							if($preg->alt13<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_13' value='".($preg->alt13)."'> ".($preg->alt13)."<br>  ";}
							if($preg->alt14<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_14' value='".($preg->alt14)."'> ".($preg->alt14)."<br> ";}
							if($preg->alt15<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_15' value='".($preg->alt15)."'> ".($preg->alt15)."<br>  ";}
							if($preg->alt16<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_16' value='".($preg->alt16)."'> ".($preg->alt16)."<br>  ";}
							if($preg->alt17<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_17' value='".($preg->alt17)."'> ".($preg->alt17)."<br>  ";}
							if($preg->alt18<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_18' value='".($preg->alt18)."'> ".($preg->alt18)."<br>  ";}
							if($preg->alt19<>'')   {$option.="<input type='checkbox' name='".$id_encuesta . $preg->id_pregunta."_19' value='".($preg->alt19)."'> ".($preg->alt19)."<br>  ";}



							$alternativas .= "
							   ".$option."
							";            
									}

								}         
         
         if ($preg->tipo == "NIV1_7") {
                  $alternativas="";
                  //$alternativas= file_get_contents("views/medicion/" . $id_empresa . "_preguntas_niv1_7.html");
            if ($preg->respuesta and $preg->id_foco=="$id_proyecto") {

         $alternativas .= "<center> <input id='".$id_encuesta . $preg->id_pregunta."' name='".$id_encuesta . $preg->id_pregunta."' type='number'
            class='rating' max='7' data-step='1' data-stars='7' data-size='md' data-glyphicon='false'
            data-rating-class='fontawesome-icon' data-symbol='&#xe73b;'  value='".$preg->respuesta."'   ></center>";
            } else {


                 $alternativas .= "<center> <input id='".$id_encuesta . $preg->id_pregunta."' name='".$id_encuesta . $preg->id_pregunta."' type='number'
            class='rating' max='7' data-step='1' data-stars='7' data-size='md' data-glyphicon='false'
            data-rating-class='fontawesome-icon' data-symbol='&#xe73b;'  ></center>";
            }


         }


         if ($preg->tipo == "NIV1_7_DOBLE") {
                  $alternativas="";
                  //$alternativas= file_get_contents("views/medicion/" . $id_empresa . "_preguntas_niv1_7.html");
            if ($preg->respuesta and $preg->id_foco=="$id_proyecto") {

         $alternativas .= "
		 <div class='row'>
		 <div class='col-lg-6'><center> <span style='font-weight: 400;font-size: 12px;
    color: #444;'>".$preg->alt1."</span><input id='".$id_encuesta . $preg->id_pregunta."' name='".$id_encuesta . $preg->id_pregunta."' type='number'
            class='rating' max='7' data-step='1' data-stars='7' data-size='md' data-glyphicon='false'
            data-rating-class='fontawesome-icon' data-symbol='&#xe73b;'  value='".$preg->respuesta."'   ></center>
			</div>
		 ";
			
			
         $alternativas .= "
		 
		 
		 <div class='col-lg-6'><center>  <span style='font-weight: 400;font-size: 12px;
    color: #444;'>".$preg->alt2."</span><input id='".$id_encuesta . $preg->id_pregunta."_2' name='".$id_encuesta . $preg->id_pregunta."_2' type='number'
            class='rating' max='7' data-step='1' data-stars='7' data-size='md' data-glyphicon='false'
            data-rating-class='fontawesome-icon' data-symbol='&#xe73b;'  value='".$preg->respuesta."'   ></center>
			</div>
		 </div>";	
		 
            } else {


                 $alternativas .= "
				 
		<div class='row'>
				 <div class='col-lg-6'><center>
				 <span style='font-weight: 400;font-size: 12px;
    color: #444;'>".$preg->alt1."</span>
				 <input id='".$id_encuesta . $preg->id_pregunta."' name='".$id_encuesta . $preg->id_pregunta."' type='number'
            class='rating' max='7' data-step='1' data-stars='7' data-size='md' data-glyphicon='false'
            data-rating-class='fontawesome-icon' data-symbol='&#xe73b;'  ></center>
		</div>
		";
			
                 $alternativas .= "
		    
				 
			<div class='col-lg-6'><center>
			 <span style='font-weight: 400;font-size: 12px;
    color: #444;'>".$preg->alt2."</span>
		<input id='".$id_encuesta . $preg->id_pregunta."_2' name='".$id_encuesta . $preg->id_pregunta."_2' type='number'
            class='rating' max='7' data-step='1' data-stars='7' data-size='md' data-glyphicon='false'
            data-rating-class='fontawesome-icon' data-symbol='&#xe73b;'  ></center></div>
		</div>";			
            }


         }

        if ($preg->tipo == "CHECKBOX_EQUIPO") {
            $alternativas = "";
			
			$array_equipo=BuscamiEquipo($rut, $id_empresa);
  $alternativas .= "<div class='row'>";
  foreach ($array_equipo as $unico)
		{
			$usuario_tiene_gente_a_cargo=BuscamiEquipo($unico->rut, $id_empresa);
			if(count($usuario_tiene_gente_a_cargo)<1) continue;
  
                $alternativas .= "
				<div class='col-lg-4'>
                        <left>
                            <input type='checkbox' name='checkbox_equipo[]' value='" . $unico->rut. "' >" . $unico->nombre_completo . "
						</left>
                </div>
				";
			}
            $alternativas .= "</div>";
        }


        if ($preg->tipo == "NIV1_3") {
            $alternativas = "<table width='100%'><tr>";
            for ($i = 1; $i <= 3; $i++) {
                if ($preg->respuesta == $i and $preg->id_foco=="$id_proyecto") {
                    $checked = " checked ";
                } else {
                    $checked = "  ";
                }
                $alternativas .= "<td width='33%'>
                        <center>
                            <input type='radio' name='" . $id_encuesta . $preg->id_pregunta . "' value='" . $i . "' " . $checked . ">
                            <br>" . $i . "</center>
                            </td>";
            }
            $alternativas .= "</tr></table>";
        }

        if ($preg->tipo == "NIV1_3_IAE") {
            $alternativas = "<table width='100%'><tr>";
            for ($i = 1; $i <= 3; $i++) {
                if ($preg->respuesta == $i and $preg->id_foco=="$id_proyecto") {
                    $checked = " checked ";
                } else {
                    $checked = "  ";
                }
                
                if($i=="1"){$txt_i="Inadecuado";}
                if($i=="2"){$txt_i="Adecuado";}
                if($i=="3"){$txt_i="Excepcional";}
                
                
                $alternativas .= "<td width='33%'>
                        <center>
                            <input type='radio' name='" . $id_encuesta . $preg->id_pregunta . "' value='" . $i . "' " . $checked . ">
                            <br>" . $txt_i . "</center>
                            </td>";
            }
            $alternativas .= "</tr></table>";
        }


        if ($preg->tipo == "NIV1_5_NoAplica") {
            $alternativas = "<table width='100%'><tr>";
            for ($i = 1; $i <= 5; $i++) {
                if ($preg->respuesta == $i and $preg->id_foco=="$id_proyecto") {
                    $checked = " checked ";
                } else {
                    $checked = "  ";
                }
                $alternativas .= "<td width='16%'>
                        <center>
                            <input type='radio' name='" . $id_encuesta . $preg->id_pregunta . "' value='" . $i . "' " . $checked . ">
                            <br>" . $i . "</center>
                            </td>";
            }
            $alternativas .= "<td width='16%'>
                        <center>
                            <input type='radio' name='" . $id_encuesta . $preg->id_pregunta . "' value='NA' " . $checked . ">
                            <br>No Aplica</center>
                            </td>
            
            
            
            </tr></table>";
        }

        if ($preg->tipo == "NIV1_5") {
            $alternativas = "<table width='100%'><tr>";
            for ($i = 1; $i <= 5; $i++) {
                if ($preg->respuesta == $i and $preg->id_foco=="$id_proyecto") {
                    $checked = " checked ";
                } else {
                    $checked = "  ";
                }
                $alternativas .= "<td width='20%'>
                        <center>
                            <input type='radio' name='" . $id_encuesta . $preg->id_pregunta . "' value='" . $i . "' " . $checked . ">
                            <br>" . $i . "</center>
                            </td>";
            }
            $alternativas .= "</tr></table>";
        }


  if ($preg->tipo == "NIV1_7_RADIO") {
            $alternativas = "<table width='100%'><tr>";
            for ($i = 1; $i <= 7; $i++) {
                if ($preg->respuesta == $i and $preg->id_foco=="$id_proyecto") {
                    $checked = " checked ";
                } else {
                    $checked = "  ";
                }
                $alternativas .= "<td width='14%'>
                        <center>
                            <input type='radio' name='" . $id_encuesta . $preg->id_pregunta . "' value='" . $i . "' " . $checked . " required>
                            <br>" . $i . "</center>
                            </td>";
            }
            $alternativas .= "</tr></table>";
        }

        if ($preg->tipo == "NIV1_10") {
            $alternativas = "<table width='100%'><tr>";
            for ($i = 1; $i <= 10; $i++) {
                if ($preg->respuesta == $i and $preg->id_foco=="$id_proyecto") {
                    $checked = " checked ";
                } else {
                    $checked = "  ";
                }
                $alternativas .= "<td width='10%'>
                        <center>
                            <input type='radio' name='" . $id_encuesta . $preg->id_pregunta . "' value='" . $i . "' " . $checked . ">
                            <br>" . $i . "</center>
                            </td>";
            }
            $alternativas .= "</tr></table>";
        }
		
		        if ($preg->tipo == "NIV1_7_radio") {
            $alternativas = "<table width='100%'><tr>";
            for ($i = 1; $i <= 7; $i++) {
                if ($preg->respuesta == $i and $preg->id_foco=="$id_proyecto") {
                    $checked = " checked ";
                } else {
                    $checked = "  ";
                }
                $alternativas .= "<td width='10%'>
                        <center>
                            <input type='radio' name='" . $id_encuesta . $preg->id_pregunta . "' value='" . $i . "' " . $checked . " required>
                            <br>" . $i . "</center>
                            </td>";
            }
            $alternativas .= "</tr></table>";
        }
		
        //echo $preg->tipo;
        if ($preg->tipo == "SI_NO") {
            if ($preg->respuesta == "SI" and $preg->id_foco=="$id_proyecto") {
                $checkedSI = " checked ";
            } else {
                $checkedSI = "  ";
            }
            if ($preg->respuesta == "NO" and $preg->id_foco=="$id_proyecto") {
                $checkedNO = " checked ";
            } else {
                $checkedNO = "  ";
            }
            $alternativas = "<table width='100%' border=0><tr>";
            $alternativas .= "<td width='50%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
                    value='NO' " . $checkedNO . " required><br>
                    <span class='badge badge-danger'><span class='blanco'>NO</span></span></center><br></td>";
            $alternativas .= "<td width='50%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
                    value='SI' " . $checkedSI . " required><br>
                    <span class='badge badge-info' style='background-color: #8BB851;'><span class='blanco'>SI</span></span></center><br></td>";
            $alternativas .= "</tr></table>";
        }

        if ($preg->tipo == "SECCION") {
		$alternativas = "";	
			
		}

		
        if ($preg->tipo == "SI_NO_OPCION") {
            if ($preg->respuesta == "SI" and $preg->id_foco=="$id_proyecto") {
                $checkedSI = " checked ";
				} else {
                $checkedSI = "  ";
            }
            if ($preg->respuesta == "NO" and $preg->id_foco=="$id_proyecto") {
                $checkedNO = " checked ";
            } else {
                $checkedNO = "  ";
            }
            $alternativas = "<table width='100%' border=0><tr>";
            $alternativas .= "<td width='50%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
                    value='NO' " . $checkedNO . " required><br>
                    <span class='badge badge-danger'><span class='blanco'>NO</span></span></center><br></td>";
            $alternativas .= "<td width='50%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
                    value='SI' " . $checkedSI . " required onclick='javascript:showDiv();'><br>
                    <span class='badge badge-info'><span class='blanco'>SI</span></span></center><br></td>";
            $alternativas .= "</tr></table>";
        }		
		
		
		
        if ($preg->tipo == "LIK_1_5") {
            if ($preg->respuesta == "1" and $preg->id_foco=="$id_proyecto") {
                $checkedUno = " checked ";
            } else {
                $checkedUno = "  ";
            }
            if ($preg->respuesta == "2" and $preg->id_foco=="$id_proyecto") {
                $checkedDos = " checked ";
            } else {
                $checkedDos = "  ";
            }
            if ($preg->respuesta == "3" and $preg->id_foco=="$id_proyecto") {
                $checkedTres = " checked ";
            } else {
                $checkedTres = "  ";
            }
            if ($preg->respuesta == "4" and $preg->id_foco=="$id_proyecto") {
                $checkedCuatro = " checked ";
            } else {
                $checkedCuatro = "  ";
            }
            if ($preg->respuesta == "5" and $preg->id_foco=="$id_proyecto") {
                $checkedCinco = " checked ";
            } else {
                $checkedCinco = "  ";
            }
            $alternativas = "<table width='100%'><tr>";
            $alternativas .= "<td width='20%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
                    value='1' " . $checkedUno . " required><br><img src='img/med_sad.png' width='32px'><br>
                    <span class='badge badge-danger'><span class='blanco'>Totalmente en Desacuerdo</span></span></center><br></td>";
            $alternativas .= "<td width='20%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
                    value='2' " . $checkedDos . " required><br><img src='img/med_sad.png' width='32px'><br>
                    <span class='badge badge-danger'><span class='blanco'>En Desacuerdo</span></span></center><br></td>";
            $alternativas .= "<td width='20%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
                    value='3' " . $checkedTres . " required><br><img src='img/med_confused.png' width='32px'>  <br>
                    <span class='badge badge-info'><span class='blanco'>Ni de Acuerdo ni en Desacuerdo</span></span></center><br></td>";
            $alternativas .= "<td width='20%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
                    value='4' " . $checkedCuatro . " required><br><img src='img/med_happy.png' width='32px'> <br>
                    <span class='badge badge-info'><span class='blanco'>De Acuerdo</span></span></center><br></td>";
            $alternativas .= "<td width='20%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
                    value='5' " . $checkedCinco . " required><br><img src='img/med_happy.png' width='32px'> <br>
                    <span class='badge badge-success'><span class='blanco'>Totalmente  de Acuerdo</span></span></center><br></td>";
            $alternativas .= "</tr></table>";
        }
					if ($preg->tipo == "LIK_1_4") {
            if ($preg->respuesta == "1" and $preg->id_foco=="$id_proyecto") {
                $checkedUno = " checked ";
            } else {
                $checkedUno = "  ";
            }
            if ($preg->respuesta == "2" and $preg->id_foco=="$id_proyecto") {
                $checkedDos = " checked ";
            } else {
                $checkedDos = "  ";
            }
            if ($preg->respuesta == "3" and $preg->id_foco=="$id_proyecto") {
                $checkedTres = " checked ";
            } else {
                $checkedTres = "  ";
            }
            if ($preg->respuesta == "4" and $preg->id_foco=="$id_proyecto") {
                $checkedCuatro = " checked ";
            } else {
                $checkedCuatro = "  ";
            }
            if ($preg->respuesta == "5" and $preg->id_foco=="$id_proyecto") {
                $checkedCinco = " checked ";
            } else {
                $checkedCinco = "  ";
            }
            $alternativas = "<table width='100%'><tr>";
            $alternativas .= "<td width='25%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
                    value='Totalmente de acuerdo' " . $checkedCuatro . " required><br>
                    <span class='badge badge-info'><span class='blanco'>Totalmente de acuerdo
</span></span></center><br></td>";
            $alternativas .= "<td width='25%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
                    value='De acuerdo' " . $checkedTres . " required><br>
                    <span class='badge badge-info'><span class='blanco'>De acuerdo
							</span></span></center><br></td>";
            $alternativas .= "<td width='25%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
                    value='En desacuerdo' " . $checkedDos . " required><br>

                    <span class='badge badge-danger'><span class='blanco'>En desacuerdo
							</span></span></center><br></td>";
            $alternativas .= "<td width='25%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
                    value='Totalmente en desacuerdo' " . $checkedUno . " required><br>
                    <span class='badge badge-danger'><span class='blanco'>Totalmente en desacuerdo
					</span></span></center><br></td>";
            $alternativas .= "</tr></table>";
        }

						if ($preg->tipo == "LIK_1_4_VAR") {
						            if ($preg->respuesta == "1" and $preg->id_foco=="$id_proyecto") {
						                $checkedUno = " checked ";
						            } else {
						                $checkedUno = "  ";
						            }
						            if ($preg->respuesta == "2" and $preg->id_foco=="$id_proyecto") {
						                $checkedDos = " checked ";
						            } else {
						                $checkedDos = "  ";
						            }
						            if ($preg->respuesta == "3" and $preg->id_foco=="$id_proyecto") {
						                $checkedTres = " checked ";
						            } else {
						                $checkedTres = "  ";
						            }
						            if ($preg->respuesta == "4" and $preg->id_foco=="$id_proyecto") {
						                $checkedCuatro = " checked ";
						            } else {
						                $checkedCuatro = "  ";
						            }
						            if ($preg->respuesta == "5" and $preg->id_foco=="$id_proyecto") {
						                $checkedCinco = " checked ";
						            } else {
						                $checkedCinco = "  ";
						            }
						            $alternativas = "<table width='100%'><tr>";
						            $alternativas .= "<td width='20%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
						                    value='Totalmente de acuerdo' " . $checkedCuatro . " required><br>

						                    <span class='badge badge-info'><span class='blanco'>Totalmente de acuerdo
						</span></span></center><br></td>";
						            $alternativas .= "<td width='20%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
						                    value='De acuerdo' " . $checkedTres . " required><br>

						                    <span class='badge badge-info'><span class='blanco'>De acuerdo
						</span></span></center><br></td>";
						            $alternativas .= "<td width='20%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
						                    value='En desacuerdo' " . $checkedDos . " required><br>

						                    <span class='badge badge-danger'><span class='blanco'>En desacuerdo
						</span></span></center><br></td>";
						            $alternativas .= "<td width='20%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
						                    value='Totalmente en desacuerdo' " . $checkedUno . " required><br>

						                    <span class='badge badge-danger'><span class='blanco'>Totalmente en desacuerdo
						</span></span></center><br></td>";
						            $alternativas .= "<td width='20%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
						                    value='No he recibido capacitaciones' " . $checkedUno . " required><br>

						                    <span class='badge badge-danger'><span class='blanco'>No aplica
						</span></span></center><br></td>";            $alternativas .= "</tr></table>";
						        }

              if ($preg->tipo == "TEXT") {    //echo "-> hola txt";
                         $alternativas="";
                  //$alternativas= file_get_contents("views/medicion/" . $id_empresa . "_preguntas_niv1_7.html");
            if ($preg->respuesta) {

$alternativas .= "<center> <input id='".$id_encuesta . $preg->id_pregunta."' name='".$id_encuesta . $preg->id_pregunta."' value='".utf8_encode($preg->respuesta)."' type='text' class='form form-control' ".$required."  ></center>";

            } else {


$alternativas .= "<center> <input id='".$id_encuesta . $preg->id_pregunta."' name='".$id_encuesta . $preg->id_pregunta."' type='text'  class='form form-control' ".$required." ></center>";
            }

         }
         if ($preg->tipo == "TITLE") {    //echo "-> hola txt";
                         $alternativas="";
                  //$alternativas= file_get_contents("views/medicion/" . $id_empresa . "_preguntas_niv1_7.html");

         }

         if ($preg->tipo == "TEXTAREA_HIDE") {    //echo "-> hola txt";
                         $alternativas="";
                  //$alternativas= file_get_contents("views/medicion/" . $id_empresa . "_preguntas_niv1_7.html");
				  if ($preg->respuesta) {

$alternativas .= "
<div  style='display:none' id='tow' name='tow' class='tow'>
<div class='alert alert-info' role='alert'>
    <strong>Explica brevemente qu&eacute; reconoce La Selecci&oacute;n del Chile: </strong>
</div>


<center> <textarea id='".$id_encuesta . $preg->id_pregunta."' rows='4' name='".$id_encuesta . $preg->id_pregunta."'  class='form form-control tow' ".$required."  style='display:none'  >".utf8_encode($preg->respuesta)."</textarea></center>

</div>
";

            } else {


$alternativas .= "
<div  style='display:none' id='tow' name='tow' class='tow'>
<div class='alert alert-info' role='alert'>
    <strong>Explica brevemente qu&eacute; reconoce La Selecci&oacute;n del Chile: </strong>
</div>


<center> <textarea id='".$id_encuesta . $preg->id_pregunta."' rows='4' name='".$id_encuesta . $preg->id_pregunta."'  class='form form-control tow' ".$required."  ></textarea></center>

</div>
";
            }

         }		 
		 
		 
		 
         if ($preg->tipo == "TEXTAREA") {    //echo "-> hola txt";
                         $alternativas="";
                  //$alternativas= file_get_contents("views/medicion/" . $id_empresa . "_preguntas_niv1_7.html");
            if ($preg->respuesta and $preg->id_foco=="$id_proyecto") {

$alternativas .= "<center> <textarea id='".$id_encuesta . $preg->id_pregunta."' rows='4' name='".$id_encuesta . $preg->id_pregunta."'  class='form form-control' ".$required."  >".($preg->respuesta)."</textarea></center>";

            } else {


$alternativas .= "<center> <textarea id='".$id_encuesta . $preg->id_pregunta."' rows='4' name='".$id_encuesta . $preg->id_pregunta."'  class='form form-control' ".$required."  ></textarea></center>";
            }

         }

    if ($preg->tipo == "LIK1_4") {

    //echo "hola";
        if ($preg->respuesta == "1") {
                $checkedUno = " checked ";
            } else {
                $checkedUno = "  ";
            }
            if ($preg->respuesta == "2") {
                $checkedDos = " checked ";
            } else {
                $checkedDos = "  ";
            }
            if ($preg->respuesta == "3") {
                $checkedTres = " checked ";
            } else {
                $checkedTres = "  ";
            }
            if ($preg->respuesta == "4") {
                $checkedCuatro = " checked ";
            } else {
                $checkedCuatro = "  ";
            }
            if ($preg->respuesta == "5") {
                $checkedCinco = " checked ";
            } else {
                $checkedCinco = "  ";
            }
            $alternativas = "<table width='100%'><tr>";
            $alternativas .= "<td width='20%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
                    value='1' " . $checkedUno . " required><br><img src='img/med_sad.png' width='32px'><br>
                    <span class='badge badge-danger'><span class='blanco'>Muy en desacuerdo</span></span></center><br><br></td>";
            $alternativas .= "<td width='20%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
                    value='2' " . $checkedDos . " required><br><img src='img/med_sad.png' width='32px'><br>
                    <span class='badge badge-danger'><span class='blanco'>Desacuerdo</span></span></center><br><br></td>";
            $alternativas .= "<td width='20%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
                    value='3' " . $checkedTres . " required><br><img src='img/med_happy.png' width='32px'>  <br>
                    <span class='badge badge-info'><span class='blanco'>De acuerdo</span></span></center><br><br></td>";
            $alternativas .= "<td width='20%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
                    value='4' " . $checkedCuatro . " required><br><img src='img/med_happy.png' width='32px'> <br>
                    <span class='badge badge-info'><span class='blanco'>Muy de acuerdo</span></span></center><br><br></td>";
            $alternativas .= "</tr></table>";
        }


//echo "<br><br>pregunta ".$preg->pregunta." tipo ".$preg->tipo." dimension ".$preg->dimension;

if ($preg->tipo == "SECC_DIM_TXT") {

	$pregunta="
	<div class='badge badge-info'><span class='blanco'><i class='fas fa-caret-right'></i> ".($preg->dimension)."</span></div>
	<br><br>
	<div class='alert alert-warning' role='alert'>".($preg->pregunta)."<strong></div>";
	 
}


elseif ($preg->tipo == "SECC_DIM") {
//ECHO "SEC DIM";
	$pregunta="
	<div class='badge badge-info'><span class='blanco'><i class='fas fa-caret-right'></i> ".($preg->dimension)."</span></div><br>
	";
	//ECHO "pregunta $pregunta";
$alternativas="";	 
} 

elseif ($preg->tipo == "SECC_TXT") {

	$pregunta="
	<div class='alert alert-warning' role='alert'><i class='fas fa-caret-right'></i> ".($preg->pregunta)."<strong></div>";
$alternativas="";
	 
} 

elseif ($preg->tipo == "SECC_DIM_2") {

	$pregunta="
	<div class='alert alert-primary' role='alert'><i class='fas fa-caret-right'></i> ".($preg->dimension)."<strong></div>";
$alternativas="";
	 
} 

 else {
	 
	$pregunta="<div class='alert alert-info' role='alert'>	<strong>".($preg->pregunta)."</strong></div>";

}

        $row = str_replace("{ID_PREGUNTA}", $preg->id_pregunta, $row);
        $row = str_replace("{PREGUNTA}", ($pregunta), $row);
        $row = str_replace("{ALTERNATIVAS}", $alternativas, $row);
        $row = str_replace("{RUT}", $rut, $row);
        $row = str_replace("{RUT_COLABORADOR}", $rut_colaborador, $row);
        $row = str_replace("{ID_PREGUNTA}", $preg->id_pregunta, $row);
		
    }
    if ($replace <> '') {
        $PRINCIPAL = str_replace($replace, utf8_encode($row), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{ROW_PREGUNTAS}", utf8_encode($row), $PRINCIPAL);
    }
    return ($PRINCIPAL);
}


function ColocaPreguntasMedicionColaboradores($PRINCIPAL, $id_empresa, $rut, $rutcol, $idm, $fecha)
{
    //echo "<br>function ColocaPreguntasMedicionColaboradores  $id_empresa, $rut, $rutcol, $idm, $fecha";

    $id_encuesta_array=MedBuscaIdEncuestraMed($idm, $id_empresa);
    $id_medicion=$idm;
    //print_r($id_encuesta_array);
    //echo "<br><br>$id_medicion, $rutcol";

    $id_encuesta=$id_encuesta_array[0]->id_encuesta;

    $preguntas = PreguntasMedicionColaboradoresFecha($id_empresa, $id_encuesta_array[0]->id_encuesta, $id_medicion, $rut, $rutcol, $fecha);

    $rut_colaborador=$rutcol;
    //echo "<br><br>ColocaPreguntasMedicionColaboradores $id_empresa, ".$id_encuesta_array[0]->id_encuesta.", $id_medicion, $rut, $rutcol, $fecha";// echo "<br>";
    $row       = "";
    foreach ($preguntas as $preg) {

          //echo "<br> RUT COLABORADOR  $rut_colaborador ID ENCUESTA $id_encuesta ID PREGUNTA ".$preg->id_pregunta." ";

        if ($preg->respuesta) {
            $row .= file_get_contents("views/medicion/" . $id_empresa . "_preguntas_medicion.html");
        } else {
            $row .= file_get_contents("views/medicion/" . $id_empresa . "_preguntas_medicion.html");
        }
        //echo "views/medicion/" . $id_empresa . "_preguntas_medicion.html";

            //echo "<br>".$preg->tipo." ".$preg->id_pregunta."";

         if ($preg->tipo == "NIV1_7") {

         //echo "hola";
                  $alternativas="";
                  //$alternativas= file_get_contents("views/medicion/" . $id_empresa . "_preguntas_niv1_7.html");
            if ($preg->respuesta) {

         $alternativas .= "<center> <input id='".$rut .$id_encuesta . $preg->id_pregunta."' name='".$rut .$id_encuesta . $preg->id_pregunta."'
            type='number' class='rating' max='7' data-step='1' data-stars='7' data-size='md' data-glyphicon='false'
            data-rating-class='fontawesome-icon' data-symbol='&#xe73b;' value='".$preg->respuesta."'   ></center>";
            } else {


                 $alternativas .= "<center> <input id='".$rut .$id_encuesta . $preg->id_pregunta."' name='".$rut .$id_encuesta . $preg->id_pregunta."'
                 type='number' class='rating' max='7' data-step='1' data-stars='7' data-size='md' data-glyphicon='false'
            data-rating-class='fontawesome-icon' data-symbol='&#xe73b;'  ></center>";
            }


         }
            if ($preg->tipo == "SELMUL") {   //echo "-> hola SELMUL";
                         $alternativas=""; $option="";
                  //$alternativas= file_get_contents("views/medicion/" . $id_empresa . "_preguntas_niv1_7.html");
            if ($preg->respuesta) {

     $option.="<option value=''></option> ";
if($preg->alt1<>'')   {if($preg->alt1==$preg->respuesta){$check1=" selected ";} $option.="<option value='".utf8_encode($preg->alt1)."' $check1>".utf8_encode($preg->alt1)."</option> ";}
if($preg->alt2<>'')   {if($preg->alt2==$preg->respuesta){$check2=" selected ";} $option.="<option value='".utf8_encode($preg->alt2)."' $check2>".utf8_encode($preg->alt2)."</option> ";}
if($preg->alt3<>'')   {if($preg->alt3==$preg->respuesta){$check3=" selected ";} $option.="<option value='".utf8_encode($preg->alt3)."' $check3>".utf8_encode($preg->alt3)."</option> ";}
if($preg->alt4<>'')   {if($preg->alt4==$preg->respuesta){$check4=" selected ";} $option.="<option value='".utf8_encode($preg->alt4)."' $check4>".utf8_encode($preg->alt4)."</option> ";}
if($preg->alt5<>'')   {if($preg->alt5==$preg->respuesta){$check5=" selected ";} $option.="<option value='".utf8_encode($preg->alt5)."' $check5>".utf8_encode($preg->alt5)."</option> ";}
if($preg->alt6<>'')   {if($preg->alt6==$preg->respuesta){$check6=" selected ";} $option.="<option value='".utf8_encode($preg->alt6)."' $check6>".utf8_encode($preg->alt6)."</option> ";}
if($preg->alt7<>'')   {if($preg->alt7==$preg->respuesta){$check7=" selected ";} $option.="<option value='".utf8_encode($preg->alt7)."' $check7>".utf8_encode($preg->alt7)."</option> ";}
if($preg->alt8<>'')   {if($preg->alt8==$preg->respuesta){$check8=" selected ";} $option.="<option value='".utf8_encode($preg->alt8)."' $check8>".utf8_encode($preg->alt8)."</option> ";}
if($preg->alt9<>'')   {if($preg->alt9==$preg->respuesta){$check9=" selected ";} $option.="<option value='".utf8_encode($preg->alt9)."' $check9>".utf8_encode($preg->alt9)."</option> ";}
if($preg->alt10<>'')  {if($preg->alt10==$preg->respuesta){$check10=" selected ";} $option.="<option value='".utf8_encode($preg->alt10)."' $check10>".utf8_encode($preg->alt10)."</option> ";}
if($preg->alt11<>'')   {if($preg->alt11==$preg->respuesta){$check11=" selected ";} $option.="<option value='".utf8_encode($preg->alt11)."' $check11>".utf8_encode($preg->alt11)."</option> ";}
if($preg->alt12<>'')   {if($preg->alt12==$preg->respuesta){$check12=" selected ";} $option.="<option value='".utf8_encode($preg->alt12)."' $check12>".utf8_encode($preg->alt12)."</option> ";}
if($preg->alt13<>'')   {if($preg->alt13==$preg->respuesta){$check13=" selected ";} $option.="<option value='".utf8_encode($preg->alt13)."' $check13>".utf8_encode($preg->alt13)."</option> ";}
if($preg->alt14<>'')   {if($preg->alt14==$preg->respuesta){$check14=" selected ";} $option.="<option value='".utf8_encode($preg->alt14)."' $check14>".utf8_encode($preg->alt14)."</option> ";}
if($preg->alt15<>'')   {if($preg->alt15==$preg->respuesta){$check15=" selected ";} $option.="<option value='".utf8_encode($preg->alt15)."' $check15>".utf8_encode($preg->alt15)."</option> ";}
if($preg->alt16<>'')   {if($preg->alt16==$preg->respuesta){$check16=" selected ";} $option.="<option value='".utf8_encode($preg->alt16)."' $check16>".utf8_encode($preg->alt16)."</option> ";}
if($preg->alt17<>'')   {if($preg->alt17==$preg->respuesta){$check17=" selected ";} $option.="<option value='".utf8_encode($preg->alt17)."' $check17>".utf8_encode($preg->alt17)."</option> ";}
if($preg->alt18<>'')   {if($preg->alt18==$preg->respuesta){$check18=" selected ";} $option.="<option value='".utf8_encode($preg->alt18)."' $check18>".utf8_encode($preg->alt18)."</option> ";}
if($preg->alt19<>'')   {if($preg->alt19==$preg->respuesta){$check19=" selected ";} $option.="<option value='".utf8_encode($preg->alt19)."' $check19>".utf8_encode($preg->alt19)."</option> ";}

$alternativas .= "<center>


 <select id='".$id_encuesta . $preg->id_pregunta."' name='".$id_encuesta . $preg->id_pregunta."' class='form form-control' ".$required.">
    ".$option."
</select>  </center>";



            } else {

    //echo  "<br>preg selmul ".$preg->alt1;
    $option.="<option value=''></option> ";
if($preg->alt1<>'')   {$option.="<option value='".utf8_encode($preg->alt1)."'>".utf8_encode($preg->alt1)."</option> ";}
if($preg->alt2<>'')   {$option.="<option value='".utf8_encode($preg->alt2)."'>".utf8_encode($preg->alt2)."</option> ";}
if($preg->alt3<>'')   {$option.="<option value='".utf8_encode($preg->alt3)."'>".utf8_encode($preg->alt3)."</option> ";}
if($preg->alt4<>'')   {$option.="<option value='".utf8_encode($preg->alt4)."'>".utf8_encode($preg->alt4)."</option> ";}
if($preg->alt5<>'')   {$option.="<option value='".utf8_encode($preg->alt5)."'>".utf8_encode($preg->alt5)."</option> ";}
if($preg->alt6<>'')   {$option.="<option value='".utf8_encode($preg->alt6)."'>".utf8_encode($preg->alt6)."</option> ";}
if($preg->alt7<>'')   {$option.="<option value='".utf8_encode($preg->alt7)."'>".utf8_encode($preg->alt7)."</option> ";}
if($preg->alt8<>'')   {$option.="<option value='".utf8_encode($preg->alt8)."'>".utf8_encode($preg->alt8)."</option> ";}
if($preg->alt9<>'')   {$option.="<option value='".utf8_encode($preg->alt9)."'>".utf8_encode($preg->alt9)."</option> ";}
if($preg->alt10<>'')   {$option.="<option value='".utf8_encode($preg->alt10)."'>".utf8_encode($preg->alt10)."</option> ";}
if($preg->alt11<>'')   {$option.="<option value='".utf8_encode($preg->alt11)."'>".utf8_encode($preg->alt11)."</option> ";}
if($preg->alt12<>'')   {$option.="<option value='".utf8_encode($preg->alt12)."'>".utf8_encode($preg->alt12)."</option> ";}
if($preg->alt13<>'')   {$option.="<option value='".utf8_encode($preg->alt13)."'>".utf8_encode($preg->alt13)."</option> ";}
if($preg->alt14<>'')   {$option.="<option value='".utf8_encode($preg->alt14)."'>".utf8_encode($preg->alt14)."</option> ";}
if($preg->alt15<>'')   {$option.="<option value='".utf8_encode($preg->alt15)."'>".utf8_encode($preg->alt15)."</option> ";}
if($preg->alt16<>'')   {$option.="<option value='".utf8_encode($preg->alt16)."'>".utf8_encode($preg->alt16)."</option> ";}
if($preg->alt17<>'')   {$option.="<option value='".utf8_encode($preg->alt17)."'>".utf8_encode($preg->alt17)."</option> ";}
if($preg->alt18<>'')   {$option.="<option value='".utf8_encode($preg->alt18)."'>".utf8_encode($preg->alt18)."</option> ";}
if($preg->alt19<>'')   {$option.="<option value='".utf8_encode($preg->alt19)."'>".utf8_encode($preg->alt19)."</option> ";}



$alternativas .= "<center>


 <select  id='".$id_encuesta . $preg->id_pregunta."' name='".$id_encuesta . $preg->id_pregunta."' class='form form-control' ".$required.">
   ".$option."
</select>  </center>";            }

         }
         if ($preg->tipo == "NIV1_4") {

         //echo "hola";
                  $alternativas="";
                  //$alternativas= file_get_contents("views/medicion/" . $id_empresa . "_preguntas_niv1_7.html");
            if ($preg->respuesta) {

         $alternativas .= "<center> <input id='".$rut .$id_encuesta . $preg->id_pregunta."' name='".$rut .$id_encuesta . $preg->id_pregunta."'
            type='number' class='rating' max='4' data-step='1' data-stars='4' data-size='md' data-glyphicon='false'
            data-rating-class='fontawesome-icon' data-symbol='&#xe73b;' value='".$preg->respuesta."'   ></center>";
            } else {


                 $alternativas .= "<center> <input id='".$rut .$id_encuesta . $preg->id_pregunta."' name='".$rut .$id_encuesta . $preg->id_pregunta."'
                 type='number' class='rating' max='4' data-step='1' data-stars='4' data-size='md' data-glyphicon='false'
            data-rating-class='fontawesome-icon' data-symbol='&#xe73b;'  ></center>";
            }


         }
        if ($preg->tipo == "NIV1_10") {
            $alternativas="";
                            $alternativas = "<table width='100%'><tr>";
                            for ($i = 1; $i <= 10; $i++) {
                                if ($preg->respuesta == $i) {
                                    $checked = " checked ";
                                } else {
                                    $checked = "  ";
                                }

                            //echo "<br> NIV1_10 RUT COLABORADOR  $rut_colaborador ID ENCUESTA $id_encuesta ID PREGUNTA ".$preg->id_pregunta." ";

                                $alternativas .= "<td width='10%'>
                                        <center>
                                            <input type='radio' name='" . $rut_colaborador . $id_encuesta . $preg->id_pregunta . "' value='" . $i . "' " . $checked . ">
                                            <br>" . $i . "</center>
                                            </td>";
                            }
                            $alternativas .= "</tr></table>";
        }


        if ($preg->tipo == "SI_NO") {     $alternativas="";
                                //echo "<br>SI NO";
                                    if ($preg->respuesta == "SI") {
                                        $checkedSI = " checked ";
                                    } else {
                                        $checkedSI = "  ";
                                    }
                                    if ($preg->respuesta == "NO") {
                                        $checkedNO = " checked ";
                                    } else {
                                        $checkedNO = "  ";
                                    }
                                    $alternativas = "<table width='100%' border=0><tr>";
                                    $alternativas .= "<td width='50%'><center><input type='radio' name='" . $rut_colaborador . $id_encuesta . $preg->id_pregunta . "'
                                            value='NO' " . $checkedNO . " required><br>
                                            <span class='badge badge-danger'><span class='blanco'>NO</span></span></center><br></td>";
                                    $alternativas .= "<td width='50%'><center><input type='radio' name='" . $rut_colaborador . $id_encuesta . $preg->id_pregunta . "'
                                            value='SI' " . $checkedSI . " required><br>
                                            <span class='badge badge-info'><span class='blanco'>SI</span></span></center><br></td>";
                                    $alternativas .= "</tr></table>";
        }

        //echo $preg->tipo;

        if ($preg->tipo == "LIK_1_5") {      $alternativas="";

                                //echo "<br>LI5 594";
                                if ($preg->respuesta == "1") {
                                    $checkedUno = " checked ";
                                } else {
                                    $checkedUno = "  ";
                                }
                                if ($preg->respuesta == "2") {
                                    $checkedDos = " checked ";
                                } else {
                                    $checkedDos = "  ";
                                }
                                if ($preg->respuesta == "3") {
                                    $checkedTres = " checked ";
                                } else {
                                    $checkedTres = "  ";
                                }
                                if ($preg->respuesta == "4") {
                                    $checkedCuatro = " checked ";
                                } else {
                                    $checkedCuatro = "  ";
                                }
                                if ($preg->respuesta == "5") {
                                    $checkedCinco = " checked ";
                                } else {
                                    $checkedCinco = "  ";
                                }

                                //echo "hola";

                                $alternativas = "<table width='100%'><tr>";
                                $alternativas .= "<td width='20%'><center><input type='radio' name='" . $rut_colaborador . $id_encuesta . $preg->id_pregunta . "'
                                        value='1' " . $checkedUno . " required><br><img src='img/med_sad.png' width='32px'><br>
                                        <span class='badge badge-danger'><span class='blanco'>Totalmente en Desacuerdo</span></span></center><br></td>";
                                $alternativas .= "<td width='20%'><center><input type='radio' name='" . $rut_colaborador . $id_encuesta . $preg->id_pregunta . "'
                                        value='2' " . $checkedDos . " required><br><img src='img/med_sad.png' width='32px'><br>
                                        <span class='badge badge-danger'><span class='blanco'>En Desacuerdo</span></span></center><br></td>";
                                $alternativas .= "<td width='20%'><center><input type='radio' name='" . $rut_colaborador . $id_encuesta . $preg->id_pregunta . "'
                                        value='3' " . $checkedTres . " required><br><img src='img/med_confused.png' width='32px'>  <br>
                                        <span class='badge badge-info'><span class='blanco'>Ni de Acuerdo ni en Desacuerdo</span></span></center><br></td>";
                                $alternativas .= "<td width='20%'><center><input type='radio' name='" . $rut_colaborador . $id_encuesta . $preg->id_pregunta . "'
                                        value='4' " . $checkedCuatro . " required><br><img src='img/med_happy.png' width='32px'> <br>
                                        <span class='badge badge-info'><span class='blanco'>De Acuerdo</span></span></center><br></td>";
                                $alternativas .= "<td width='20%'><center><input type='radio' name='" . $rut_colaborador . $id_encuesta . $preg->id_pregunta . "'
                                        value='5' " . $checkedCinco . " required><br><img src='img/med_happy.png' width='32px'> <br>
                                        <span class='badge badge-success'><span class='blanco'>Totalmente  de Acuerdo</span></span></center><br></td>";
                                $alternativas .= "</tr></table>";

                                //echo "$alternativas";
        }


        if ($preg->tipo == "LIK1_4") {       $alternativas="";

                                //echo "<br>LI5 594";
                                if ($preg->respuesta == "1") {
                                    $checkedUno = " checked ";
                                } else {
                                    $checkedUno = "  ";
                                }
                                if ($preg->respuesta == "2") {
                                    $checkedDos = " checked ";
                                } else {
                                    $checkedDos = "  ";
                                }
                                if ($preg->respuesta == "3") {
                                    $checkedTres = " checked ";
                                } else {
                                    $checkedTres = "  ";
                                }
                                if ($preg->respuesta == "4") {
                                    $checkedCuatro = " checked ";
                                } else {
                                    $checkedCuatro = "  ";
                                }
                                if ($preg->respuesta == "5") {
                                    $checkedCinco = " checked ";
                                } else {
                                    $checkedCinco = "  ";
                                }

                                //echo "hola";

                                $alternativas = "<table width='100%'><tr>";
                                $alternativas .= "<td width='20%'><center><input type='radio' name='" . $rut_colaborador . $id_encuesta . $preg->id_pregunta . "'
                                        value='1' " . $checkedUno . " required><br><img src='img/med_sad.png' width='32px'><br>
                                        <span class='badge badge-danger'><span class='blanco'>Muy en desacuerdo</span></span></center><br></td>";
                                $alternativas .= "<td width='20%'><center><input type='radio' name='" . $rut_colaborador . $id_encuesta . $preg->id_pregunta . "'
                                        value='2' " . $checkedDos . " required><br><img src='img/med_confused.png' width='32px'><br>
                                        <span class='badge badge-warning'><span class='blanco'>Desacuerdo</span></span></center><br></td>";
                                $alternativas .= "<td width='20%'><center><input type='radio' name='" . $rut_colaborador . $id_encuesta . $preg->id_pregunta . "'
                                        value='3' " . $checkedTres . " required><br><img src='img/med_happy.png' width='32px'>  <br>
                                        <span class='badge badge-info'><span class='blanco'>De acuerdo</span></span></center><br></td>";
                                $alternativas .= "<td width='20%'><center><input type='radio' name='" . $rut_colaborador . $id_encuesta . $preg->id_pregunta . "'
                                        value='4' " . $checkedCuatro . " required><br><img src='img/med_happy.png' width='32px'> <br>
                                        <span class='badge badge-success'><span class='blanco'>Muy de acuerdo</span></span></center><br></td>";

                                $alternativas .= "</tr></table>";

                                //echo "$alternativas";
        }


        //echo "<br>row ".$row;
              // echo "<br><br>";echo "$alternativas";

        $row = str_replace("{PREGUNTA}", utf8_encode($preg->pregunta), $row);
        $row = str_replace("{ALTERNATIVAS}", $alternativas, $row);
        $row = str_replace("{RUT}", $rut, $row);
        $row = str_replace("{RUT_COLABORADOR}", $rut_colaborador, $row);
        $row = str_replace("{ID_PREGUNTA}", $preg->id_pregunta, $row);
    }

        $PRINCIPAL = str_replace("{ROW_PREGUNTAS}", utf8_encode($row), $PRINCIPAL);


    $row_datatable       = "";
    foreach ($preguntas as $preg) {

            //echo "<pre>";        print_r($preg);
        if ($preg->respuesta) {
            $row_datatable .= file_get_contents("views/medicion/" . $id_empresa . "_preguntas_medicion_datatables.html");
        } else {
           $row_datatable .= file_get_contents("views/medicion/" . $id_empresa . "_preguntas_medicion_datatables.html");
        }


        if ($preg->tipo == "NIV1_7") {

         //echo "hola";
                  $alternativas="";
                  //$alternativas= file_get_contents("views/medicion/" . $id_empresa . "_preguntas_niv1_7.html");
            if ($preg->respuesta) {

         $alternativas .= "<center> <input id='".$rut .$id_encuesta . $preg->id_pregunta."' name='".$rut .$id_encuesta . $preg->id_pregunta."'
            type='number' class='rating' max='7' data-step='1' data-stars='7' data-size='md' data-glyphicon='false'
            data-rating-class='fontawesome-icon' data-symbol='&#xe73b;' value='".$preg->respuesta."'   ></center>";
            } else {


                 $alternativas .= "<center> <input id='".$rut .$id_encuesta . $preg->id_pregunta."' name='".$rut .$id_encuesta . $preg->id_pregunta."'
                 type='number' class='rating' max='7' data-step='1' data-stars='7' data-size='md' data-glyphicon='false'
            data-rating-class='fontawesome-icon' data-symbol='&#xe73b;'  ></center>";
            }


         }
            if ($preg->tipo == "SELMUL") {   //echo "-> hola SELMUL";
                         $alternativas=""; $option="";
                  //$alternativas= file_get_contents("views/medicion/" . $id_empresa . "_preguntas_niv1_7.html");
            if ($preg->respuesta) {

     $option.="<option value=''></option> ";
if($preg->alt1<>'')   {if($preg->alt1==$preg->respuesta){$check1=" selected ";} $option.="<option value='".utf8_encode($preg->alt1)."' $check1>".utf8_encode($preg->alt1)."</option> ";}
if($preg->alt2<>'')   {if($preg->alt2==$preg->respuesta){$check2=" selected ";} $option.="<option value='".utf8_encode($preg->alt2)."' $check2>".utf8_encode($preg->alt2)."</option> ";}
if($preg->alt3<>'')   {if($preg->alt3==$preg->respuesta){$check3=" selected ";} $option.="<option value='".utf8_encode($preg->alt3)."' $check3>".utf8_encode($preg->alt3)."</option> ";}
if($preg->alt4<>'')   {if($preg->alt4==$preg->respuesta){$check4=" selected ";} $option.="<option value='".utf8_encode($preg->alt4)."' $check4>".utf8_encode($preg->alt4)."</option> ";}
if($preg->alt5<>'')   {if($preg->alt5==$preg->respuesta){$check5=" selected ";} $option.="<option value='".utf8_encode($preg->alt5)."' $check5>".utf8_encode($preg->alt5)."</option> ";}
if($preg->alt6<>'')   {if($preg->alt6==$preg->respuesta){$check6=" selected ";} $option.="<option value='".utf8_encode($preg->alt6)."' $check6>".utf8_encode($preg->alt6)."</option> ";}
if($preg->alt7<>'')   {if($preg->alt7==$preg->respuesta){$check7=" selected ";} $option.="<option value='".utf8_encode($preg->alt7)."' $check7>".utf8_encode($preg->alt7)."</option> ";}
if($preg->alt8<>'')   {if($preg->alt8==$preg->respuesta){$check8=" selected ";} $option.="<option value='".utf8_encode($preg->alt8)."' $check8>".utf8_encode($preg->alt8)."</option> ";}
if($preg->alt9<>'')   {if($preg->alt9==$preg->respuesta){$check9=" selected ";} $option.="<option value='".utf8_encode($preg->alt9)."' $check9>".utf8_encode($preg->alt9)."</option> ";}
if($preg->alt10<>'')  {if($preg->alt10==$preg->respuesta){$check10=" selected ";} $option.="<option value='".utf8_encode($preg->alt10)."' $check10>".utf8_encode($preg->alt10)."</option> ";}
if($preg->alt11<>'')   {if($preg->alt11==$preg->respuesta){$check11=" selected ";} $option.="<option value='".utf8_encode($preg->alt11)."' $check11>".utf8_encode($preg->alt11)."</option> ";}
if($preg->alt12<>'')   {if($preg->alt12==$preg->respuesta){$check12=" selected ";} $option.="<option value='".utf8_encode($preg->alt12)."' $check12>".utf8_encode($preg->alt12)."</option> ";}
if($preg->alt13<>'')   {if($preg->alt13==$preg->respuesta){$check13=" selected ";} $option.="<option value='".utf8_encode($preg->alt13)."' $check13>".utf8_encode($preg->alt13)."</option> ";}
if($preg->alt14<>'')   {if($preg->alt14==$preg->respuesta){$check14=" selected ";} $option.="<option value='".utf8_encode($preg->alt14)."' $check14>".utf8_encode($preg->alt14)."</option> ";}
if($preg->alt15<>'')   {if($preg->alt15==$preg->respuesta){$check15=" selected ";} $option.="<option value='".utf8_encode($preg->alt15)."' $check15>".utf8_encode($preg->alt15)."</option> ";}
if($preg->alt16<>'')   {if($preg->alt16==$preg->respuesta){$check16=" selected ";} $option.="<option value='".utf8_encode($preg->alt16)."' $check16>".utf8_encode($preg->alt16)."</option> ";}
if($preg->alt17<>'')   {if($preg->alt17==$preg->respuesta){$check17=" selected ";} $option.="<option value='".utf8_encode($preg->alt17)."' $check17>".utf8_encode($preg->alt17)."</option> ";}
if($preg->alt18<>'')   {if($preg->alt18==$preg->respuesta){$check18=" selected ";} $option.="<option value='".utf8_encode($preg->alt18)."' $check18>".utf8_encode($preg->alt18)."</option> ";}
if($preg->alt19<>'')   {if($preg->alt19==$preg->respuesta){$check19=" selected ";} $option.="<option value='".utf8_encode($preg->alt19)."' $check19>".utf8_encode($preg->alt19)."</option> ";}

$alternativas .= "<center>


 <select id='".$id_encuesta . $preg->id_pregunta."' name='".$id_encuesta . $preg->id_pregunta."' class='form form-control' ".$required.">
    ".$option."
</select>  </center>";



            } else {

    //echo  "<br>preg selmul ".$preg->alt1;
    $option.="<option value=''></option> ";
if($preg->alt1<>'')   {$option.="<option value='".utf8_encode($preg->alt1)."'>".utf8_encode($preg->alt1)."</option> ";}
if($preg->alt2<>'')   {$option.="<option value='".utf8_encode($preg->alt2)."'>".utf8_encode($preg->alt2)."</option> ";}
if($preg->alt3<>'')   {$option.="<option value='".utf8_encode($preg->alt3)."'>".utf8_encode($preg->alt3)."</option> ";}
if($preg->alt4<>'')   {$option.="<option value='".utf8_encode($preg->alt4)."'>".utf8_encode($preg->alt4)."</option> ";}
if($preg->alt5<>'')   {$option.="<option value='".utf8_encode($preg->alt5)."'>".utf8_encode($preg->alt5)."</option> ";}
if($preg->alt6<>'')   {$option.="<option value='".utf8_encode($preg->alt6)."'>".utf8_encode($preg->alt6)."</option> ";}
if($preg->alt7<>'')   {$option.="<option value='".utf8_encode($preg->alt7)."'>".utf8_encode($preg->alt7)."</option> ";}
if($preg->alt8<>'')   {$option.="<option value='".utf8_encode($preg->alt8)."'>".utf8_encode($preg->alt8)."</option> ";}
if($preg->alt9<>'')   {$option.="<option value='".utf8_encode($preg->alt9)."'>".utf8_encode($preg->alt9)."</option> ";}
if($preg->alt10<>'')   {$option.="<option value='".utf8_encode($preg->alt10)."'>".utf8_encode($preg->alt10)."</option> ";}
if($preg->alt11<>'')   {$option.="<option value='".utf8_encode($preg->alt11)."'>".utf8_encode($preg->alt11)."</option> ";}
if($preg->alt12<>'')   {$option.="<option value='".utf8_encode($preg->alt12)."'>".utf8_encode($preg->alt12)."</option> ";}
if($preg->alt13<>'')   {$option.="<option value='".utf8_encode($preg->alt13)."'>".utf8_encode($preg->alt13)."</option> ";}
if($preg->alt14<>'')   {$option.="<option value='".utf8_encode($preg->alt14)."'>".utf8_encode($preg->alt14)."</option> ";}
if($preg->alt15<>'')   {$option.="<option value='".utf8_encode($preg->alt15)."'>".utf8_encode($preg->alt15)."</option> ";}
if($preg->alt16<>'')   {$option.="<option value='".utf8_encode($preg->alt16)."'>".utf8_encode($preg->alt16)."</option> ";}
if($preg->alt17<>'')   {$option.="<option value='".utf8_encode($preg->alt17)."'>".utf8_encode($preg->alt17)."</option> ";}
if($preg->alt18<>'')   {$option.="<option value='".utf8_encode($preg->alt18)."'>".utf8_encode($preg->alt18)."</option> ";}
if($preg->alt19<>'')   {$option.="<option value='".utf8_encode($preg->alt19)."'>".utf8_encode($preg->alt19)."</option> ";}



$alternativas .= "<center>


 <select  id='".$id_encuesta . $preg->id_pregunta."' name='".$id_encuesta . $preg->id_pregunta."' class='form form-control' ".$required.">
   ".$option."
</select>  </center>";            }

         }
 if ($preg->tipo == "NIV1_4") {

         //echo "hola";
                  $alternativas="";
                  //$alternativas= file_get_contents("views/medicion/" . $id_empresa . "_preguntas_niv1_7.html");
            if ($preg->respuesta) {

         $alternativas .= "<center> <input id='".$rut .$id_encuesta . $preg->id_pregunta."' name='".$rut .$id_encuesta . $preg->id_pregunta."'
            type='number' class='rating' max='4' data-step='1' data-stars='7' data-size='md' data-glyphicon='false'
            data-rating-class='fontawesome-icon' data-symbol='&#xe73b;' value='".$preg->respuesta."'   ></center>";
            } else {


                 $alternativas .= "<center> <input id='".$rut .$id_encuesta . $preg->id_pregunta."' name='".$rut .$id_encuesta . $preg->id_pregunta."'
                 type='number' class='rating' max='4' data-step='1' data-stars='7' data-size='md' data-glyphicon='false'
            data-rating-class='fontawesome-icon' data-symbol='&#xe73b;'  ></center>";
            }


         }
        if ($preg->tipo == "NIV1_10") {
            $alternativas="";
                            $alternativas = "<table width='100%'><tr>";
                            for ($i = 1; $i <= 10; $i++) {
                                if ($preg->respuesta == $i) {
                                    $checked = " checked ";
                                } else {
                                    $checked = "  ";
                                }

                        //echo "<br> NIV1_10 RUT COLABORADOR  $rut_colaborador ID ENCUESTA $id_encuesta ID PREGUNTA ".$preg->id_pregunta." ";

                                $alternativas .= "<td width='10%'>
                                        <center>
                                            <input type='radio' name='" . $rut_colaborador . $id_encuesta . $preg->id_pregunta . "' value='" . $i . "' " . $checked . " required>
                                            <br>" . $i . "</center>
                                            </td>";
                            }
                            $alternativas .= "</tr></table>";
        }


        if ($preg->tipo == "SI_NO") {     $alternativas="";
                                //echo "<br>SI NO";
                                    if ($preg->respuesta == "SI") {
                                        $checkedSI = " checked ";
                                    } else {
                                        $checkedSI = "  ";
                                    }
                                    if ($preg->respuesta == "NO") {
                                        $checkedNO = " checked ";
                                    } else {
                                        $checkedNO = "  ";
                                    }
                                    $alternativas = "<table width='100%' border=0><tr>";
                                    $alternativas .= "<td width='50%'><center><input type='radio' name='" . $rut_colaborador . $id_encuesta . $preg->id_pregunta . "'
                                            value='NO' " . $checkedNO . " required><br>
                                            <span class='badge badge-danger'><span class='blanco'>NO</span></span></center><br></td>";
                                    $alternativas .= "<td width='50%'><center><input type='radio' name='" . $rut_colaborador . $id_encuesta . $preg->id_pregunta . "'
                                            value='SI' " . $checkedSI . " required><br>
                                            <span class='badge badge-info'><span class='blanco'>SI</span></span></center><br></td>";
                                    $alternativas .= "</tr></table>";
        }

        //echo $preg->tipo;

        if ($preg->tipo == "LIK_1_5") {      $alternativas="";

                                //echo "<br>LI5 594";
                                if ($preg->respuesta == "1") {
                                    $checkedUno = " checked ";
                                } else {
                                    $checkedUno = "  ";
                                }
                                if ($preg->respuesta == "2") {
                                    $checkedDos = " checked ";
                                } else {
                                    $checkedDos = "  ";
                                }
                                if ($preg->respuesta == "3") {
                                    $checkedTres = " checked ";
                                } else {
                                    $checkedTres = "  ";
                                }
                                if ($preg->respuesta == "4") {
                                    $checkedCuatro = " checked ";
                                } else {
                                    $checkedCuatro = "  ";
                                }
                                if ($preg->respuesta == "5") {
                                    $checkedCinco = " checked ";
                                } else {
                                    $checkedCinco = "  ";
                                }

                                //echo "hola";

                                $alternativas = "<table width='100%'><tr>";
                                $alternativas .= "<td width='20%'><center><input type='radio' name='" . $rut_colaborador . $id_encuesta . $preg->id_pregunta . "'
                                        value='1' " . $checkedUno . " required><br><img src='img/med_sad.png' width='32px'><br>
                                        <span class='badge badge-danger'><span class='blanco'>Totalmente en Desacuerdo</span></span></center><br></td>";
                                $alternativas .= "<td width='20%'><center><input type='radio' name='" . $rut_colaborador . $id_encuesta . $preg->id_pregunta . "'
                                        value='2' " . $checkedDos . " required><br><img src='img/med_sad.png' width='32px'><br>
                                        <span class='badge badge-danger'><span class='blanco'>En Desacuerdo</span></span></center><br></td>";
                                $alternativas .= "<td width='20%'><center><input type='radio' name='" . $rut_colaborador . $id_encuesta . $preg->id_pregunta . "'
                                        value='3' " . $checkedTres . " required><br><img src='img/med_confused.png' width='32px'>  <br>
                                        <span class='badge badge-info'><span class='blanco'>Ni de Acuerdo ni en Desacuerdo</span></span></center><br></td>";
                                $alternativas .= "<td width='20%'><center><input type='radio' name='" . $rut_colaborador . $id_encuesta . $preg->id_pregunta . "'
                                        value='4' " . $checkedCuatro . " required><br><img src='img/med_happy.png' width='32px'> <br>
                                        <span class='badge badge-info'><span class='blanco'>De Acuerdo</span></span></center><br></td>";
                                $alternativas .= "<td width='20%'><center><input type='radio' name='" . $rut_colaborador . $id_encuesta . $preg->id_pregunta . "'
                                        value='5' " . $checkedCinco . " required><br><img src='img/med_happy.png' width='32px'> <br>
                                        <span class='badge badge-success'><span class='blanco'>Totalmente  de Acuerdo</span></span></center><br></td>";
                                $alternativas .= "</tr></table>";

                                //echo "$alternativas";
        }

        if ($preg->tipo == "LIK1_4") {

                                if ($preg->respuesta == "1") {$checkedUno = " checked ";
                                } else {$checkedUno = "  ";    }
                                if ($preg->respuesta == "2") {$checkedDos = " checked ";
                                } else {$checkedDos = "  ";    }
                                if ($preg->respuesta == "3") {$checkedTres = " checked ";
                                } else {$checkedTres = "  ";}
                                if ($preg->respuesta == "4") {$checkedCuatro = " checked ";
                                } else {$checkedCuatro = "  ";}
                                if ($preg->respuesta == "5") {$checkedCinco = " checked ";
                                } else {$checkedCinco = "  ";}

                                $alternativas = "";
                                $alternativas .= "<div class='col-xs-3'><center>
                                <input type='radio' name='" . $rut_colaborador . $id_encuesta . $preg->id_pregunta . "'
                                        value='1' " . $checkedUno . " required><br><img src='img/med_sad.png' width='32px'><br>
                                        <span class='badge badge-danger'><span class='blanco'>Muy en desacuerdo</span></span></center></div>";

                                $alternativas .= "<div class='col-xs-3'><center><input type='radio' name='" . $rut_colaborador . $id_encuesta . $preg->id_pregunta . "'
                                        value='2' " . $checkedDos . " required><br><img src='img/med_confused.png' width='32px'><br>
                                        <span class='badge badge-warning'><span class='blanco'>Desacuerdo</span></span></center></div>";

                                $alternativas .= "<div class='col-xs-3'><center><input type='radio' name='" . $rut_colaborador . $id_encuesta . $preg->id_pregunta . "'
                                        value='3' " . $checkedTres . " required><br><img src='img/med_happy.png' width='32px'><br>
                                        <span class='badge badge-info'><span class='blanco'>De acuerdo</span></span></center></div>";

                                $alternativas .= "<div class='col-xs-3'><center><input type='radio' name='" . $rut_colaborador . $id_encuesta . $preg->id_pregunta . "'
                                        value='4' " . $checkedCuatro . " required><br><img src='img/med_happy.png' width='32px'> <br>
                                        <span class='badge badge-success'><span class='blanco'>Muy de acuerdo</span></span></center></div>";
                                $alternativas .= "";

        }

        $row_datatable = str_replace("{PREGUNTA}", utf8_encode($preg->pregunta), $row_datatable);
        $row_datatable = str_replace("{ALTERNATIVAS}", $alternativas, $row_datatable);
        $row_datatable = str_replace("{RUT}", $rut, $row_datatable);
        $row_datatable = str_replace("{RUT_COLABORADOR}", $rut_colaborador, $row_datatable);
        $row_datatable = str_replace("{ID_PREGUNTA}", $preg->id_pregunta, $row_datatable);
    }

         $PRINCIPAL = str_replace("{ROW_PREGUNTAS_DATATABLE}", utf8_encode($row_datatable), $PRINCIPAL);

        //print_r($row_datatable);

    return ($row_datatable);
}

function ColocaPreguntasMedicionColaboradoresLibre($PRINCIPAL, $id_empresa, $rut, $idm, $fecha, $opcion)
{
   // echo "<br>function ColocaPreguntasMedicionColaboradores  $id_empresa, $rut, $idm, $fecha, opcion $opcion";

    $id_encuesta_array=MedBuscaIdEncuestraMed($idm, $id_empresa);
    $id_medicion=$idm;
    //print_r($id_encuesta_array);

    $id_encuesta=$id_encuesta_array[0]->id_encuesta;

        //echo "<br><br>$id_medicion, $rutcol";
        //echo "<br><br>id_medicion $id_medicion,nrut $rut, id_encuesta $id_encuesta";
    if($opcion<>''){
    $preguntas = PreguntasMedicionColaboradoresLibreOpcion($id_empresa, $id_encuesta_array[0]->id_encuesta, $id_medicion, $rut, $opcion);

    }   else {
    $preguntas = PreguntasMedicionColaboradoresLibre($id_empresa, $id_encuesta_array[0]->id_encuesta, $id_medicion, $rut);
    }
    //print_r($preguntas);

    //echo "<br><br>ColocaPreguntasMedicionColaboradores $id_empresa, ".$id_encuesta_array[0]->id_encuesta.", $id_medicion, $rut, $rutcol, $fecha";// echo "<br>";
    $row       = "";
    foreach ($preguntas as $preg) {

          //echo "<br> RUT COLABORADOR  $rut_colaborador ID ENCUESTA $id_encuesta ID PREGUNTA ".$preg->id_pregunta." ";



        if ($preg->respuesta) {
            $row .= file_get_contents("views/medicion/" . $id_empresa . "_preguntas_medicion.html");
        } else {
            $row .= file_get_contents("views/medicion/" . $id_empresa . "_preguntas_medicion.html");
        }
        //echo "views/medicion/" . $id_empresa . "_preguntas_medicion.html";

         //echo "<br>".$preg->tipo."<br>".$preg->id_pregunta."";
         //echo "<BR>".$preg->id_pregunta." hola preg tipo ".$preg->tipo;
         if ($preg->tipo == "TEXT") {    //echo "-> hola txt";
                         $alternativas="";
                  //$alternativas= file_get_contents("views/medicion/" . $id_empresa . "_preguntas_niv1_7.html");
            if ($preg->respuesta) {

$alternativas .= "<center> <input id='".$id_encuesta . $preg->id_pregunta."' name='".$id_encuesta . $preg->id_pregunta."' value='".utf8_encode($preg->respuesta)."' type='text' class='form form-control' required  ></center>";

            } else {


$alternativas .= "<center> <input id='".$id_encuesta . $preg->id_pregunta."' name='".$id_encuesta . $preg->id_pregunta."' type='text'  class='form form-control' required ></center>";
            }

         }

         if ($preg->tipo == "TEXT2") {    //echo "-> hola txt";
                         $alternativas="";
                  //$alternativas= file_get_contents("views/medicion/" . $id_empresa . "_preguntas_niv1_7.html");
            if ($preg->respuesta) {

$alternativas .= "<center> <input id='".$id_encuesta . $preg->id_pregunta."' name='".$id_encuesta . $preg->id_pregunta."' value='".utf8_encode($preg->respuesta)."' type='text' class='form form-control' required  ></center>";

            } else {


$alternativas .= "<center> <input id='".$id_encuesta . $preg->id_pregunta."' name='".$id_encuesta . $preg->id_pregunta."' type='text'  class='form form-control' required ></center>";
            }

         }

        if ($preg->tipo == "NUMBER") {    //echo "-> hola txt";
                         $alternativas="";
                  //$alternativas= file_get_contents("views/medicion/" . $id_empresa . "_preguntas_niv1_7.html");
            if ($preg->respuesta) {

$alternativas .= "<center> <input id='".$id_encuesta . $preg->id_pregunta."' name='".$id_encuesta . $preg->id_pregunta."' value='".utf8_encode($preg->respuesta)."' type='number' class='form form-control' required  ></center>";

            } else {


$alternativas .= "<center> <input id='".$id_encuesta . $preg->id_pregunta."' name='".$id_encuesta . $preg->id_pregunta."' type='number'  class='form form-control' required ></center>";
            }

         }

         if ($preg->tipo == "TEXTAREA") {    //echo "-> hola txt";
                         $alternativas="";
                  //$alternativas= file_get_contents("views/medicion/" . $id_empresa . "_preguntas_niv1_7.html");
            if ($preg->respuesta) {

$alternativas .= "<center> <textarea id='".$id_encuesta . $preg->id_pregunta."' rows='4' name='".$id_encuesta . $preg->id_pregunta."'  class='form form-control' required  >".utf8_encode($preg->respuesta)."</textarea></center>";

            } else {


$alternativas .= "<center> <textarea id='".$id_encuesta . $preg->id_pregunta."' rows='4' name='".$id_encuesta . $preg->id_pregunta."'  class='form form-control' required  ></textarea></center>";
            }

         }

         if ($preg->tipo == "SELMUL") {   //echo "-> hola SELMUL";
                         $alternativas=""; $option="";
                  //$alternativas= file_get_contents("views/medicion/" . $id_empresa . "_preguntas_niv1_7.html");
            if ($preg->respuesta) {

     $option.="<option value=''></option> ";
if($preg->alt1<>'')   {if($preg->alt1==$preg->respuesta){$check1=" selected ";} $option.="<option value='".utf8_encode($preg->alt1)."' $check1>".utf8_encode($preg->alt1)."</option> ";}
if($preg->alt2<>'')   {if($preg->alt2==$preg->respuesta){$check2=" selected ";} $option.="<option value='".utf8_encode($preg->alt2)."' $check2>".utf8_encode($preg->alt2)."</option> ";}
if($preg->alt3<>'')   {if($preg->alt3==$preg->respuesta){$check3=" selected ";} $option.="<option value='".utf8_encode($preg->alt3)."' $check3>".utf8_encode($preg->alt3)."</option> ";}
if($preg->alt4<>'')   {if($preg->alt4==$preg->respuesta){$check4=" selected ";} $option.="<option value='".utf8_encode($preg->alt4)."' $check4>".utf8_encode($preg->alt4)."</option> ";}
if($preg->alt5<>'')   {if($preg->alt5==$preg->respuesta){$check5=" selected ";} $option.="<option value='".utf8_encode($preg->alt5)."' $check5>".utf8_encode($preg->alt5)."</option> ";}
if($preg->alt6<>'')   {if($preg->alt6==$preg->respuesta){$check6=" selected ";} $option.="<option value='".utf8_encode($preg->alt6)."' $check6>".utf8_encode($preg->alt6)."</option> ";}
if($preg->alt7<>'')   {if($preg->alt7==$preg->respuesta){$check7=" selected ";} $option.="<option value='".utf8_encode($preg->alt7)."' $check7>".utf8_encode($preg->alt7)."</option> ";}
if($preg->alt8<>'')   {if($preg->alt8==$preg->respuesta){$check8=" selected ";} $option.="<option value='".utf8_encode($preg->alt8)."' $check8>".utf8_encode($preg->alt8)."</option> ";}
if($preg->alt9<>'')   {if($preg->alt9==$preg->respuesta){$check9=" selected ";} $option.="<option value='".utf8_encode($preg->alt9)."' $check9>".utf8_encode($preg->alt9)."</option> ";}
if($preg->alt10<>'')  {if($preg->alt10==$preg->respuesta){$check10=" selected ";} $option.="<option value='".utf8_encode($preg->alt10)."' $check10>".utf8_encode($preg->alt10)."</option> ";}
if($preg->alt11<>'')   {if($preg->alt11==$preg->respuesta){$check11=" selected ";} $option.="<option value='".utf8_encode($preg->alt11)."' $check11>".utf8_encode($preg->alt11)."</option> ";}
if($preg->alt12<>'')   {if($preg->alt12==$preg->respuesta){$check12=" selected ";} $option.="<option value='".utf8_encode($preg->alt12)."' $check12>".utf8_encode($preg->alt12)."</option> ";}
if($preg->alt13<>'')   {if($preg->alt13==$preg->respuesta){$check13=" selected ";} $option.="<option value='".utf8_encode($preg->alt13)."' $check13>".utf8_encode($preg->alt13)."</option> ";}
if($preg->alt14<>'')   {if($preg->alt14==$preg->respuesta){$check14=" selected ";} $option.="<option value='".utf8_encode($preg->alt14)."' $check14>".utf8_encode($preg->alt14)."</option> ";}
if($preg->alt15<>'')   {if($preg->alt15==$preg->respuesta){$check15=" selected ";} $option.="<option value='".utf8_encode($preg->alt15)."' $check15>".utf8_encode($preg->alt15)."</option> ";}
if($preg->alt16<>'')   {if($preg->alt16==$preg->respuesta){$check16=" selected ";} $option.="<option value='".utf8_encode($preg->alt16)."' $check16>".utf8_encode($preg->alt16)."</option> ";}
if($preg->alt17<>'')   {if($preg->alt17==$preg->respuesta){$check17=" selected ";} $option.="<option value='".utf8_encode($preg->alt17)."' $check17>".utf8_encode($preg->alt17)."</option> ";}
if($preg->alt18<>'')   {if($preg->alt18==$preg->respuesta){$check18=" selected ";} $option.="<option value='".utf8_encode($preg->alt18)."' $check18>".utf8_encode($preg->alt18)."</option> ";}
if($preg->alt19<>'')   {if($preg->alt19==$preg->respuesta){$check19=" selected ";} $option.="<option value='".utf8_encode($preg->alt19)."' $check19>".utf8_encode($preg->alt19)."</option> ";}

$alternativas .= "<center>


 <select id='".$id_encuesta . $preg->id_pregunta."' name='".$id_encuesta . $preg->id_pregunta."' class='form form-control' required>
    ".$option."
</select>  </center>";



            } else {

    //echo  "<br>preg selmul ".$preg->alt1;
    $option.="<option value=''></option> ";
if($preg->alt1<>'')   {$option.="<option value='".utf8_encode($preg->alt1)."'>".utf8_encode($preg->alt1)."</option> ";}
if($preg->alt2<>'')   {$option.="<option value='".utf8_encode($preg->alt2)."'>".utf8_encode($preg->alt2)."</option> ";}
if($preg->alt3<>'')   {$option.="<option value='".utf8_encode($preg->alt3)."'>".utf8_encode($preg->alt3)."</option> ";}
if($preg->alt4<>'')   {$option.="<option value='".utf8_encode($preg->alt4)."'>".utf8_encode($preg->alt4)."</option> ";}
if($preg->alt5<>'')   {$option.="<option value='".utf8_encode($preg->alt5)."'>".utf8_encode($preg->alt5)."</option> ";}
if($preg->alt6<>'')   {$option.="<option value='".utf8_encode($preg->alt6)."'>".utf8_encode($preg->alt6)."</option> ";}
if($preg->alt7<>'')   {$option.="<option value='".utf8_encode($preg->alt7)."'>".utf8_encode($preg->alt7)."</option> ";}
if($preg->alt8<>'')   {$option.="<option value='".utf8_encode($preg->alt8)."'>".utf8_encode($preg->alt8)."</option> ";}
if($preg->alt9<>'')   {$option.="<option value='".utf8_encode($preg->alt9)."'>".utf8_encode($preg->alt9)."</option> ";}
if($preg->alt10<>'')   {$option.="<option value='".utf8_encode($preg->alt10)."'>".utf8_encode($preg->alt10)."</option> ";}
if($preg->alt11<>'')   {$option.="<option value='".utf8_encode($preg->alt11)."'>".utf8_encode($preg->alt11)."</option> ";}
if($preg->alt12<>'')   {$option.="<option value='".utf8_encode($preg->alt12)."'>".utf8_encode($preg->alt12)."</option> ";}
if($preg->alt13<>'')   {$option.="<option value='".utf8_encode($preg->alt13)."'>".utf8_encode($preg->alt13)."</option> ";}
if($preg->alt14<>'')   {$option.="<option value='".utf8_encode($preg->alt14)."'>".utf8_encode($preg->alt14)."</option> ";}
if($preg->alt15<>'')   {$option.="<option value='".utf8_encode($preg->alt15)."'>".utf8_encode($preg->alt15)."</option> ";}
if($preg->alt16<>'')   {$option.="<option value='".utf8_encode($preg->alt16)."'>".utf8_encode($preg->alt16)."</option> ";}
if($preg->alt17<>'')   {$option.="<option value='".utf8_encode($preg->alt17)."'>".utf8_encode($preg->alt17)."</option> ";}
if($preg->alt18<>'')   {$option.="<option value='".utf8_encode($preg->alt18)."'>".utf8_encode($preg->alt18)."</option> ";}
if($preg->alt19<>'')   {$option.="<option value='".utf8_encode($preg->alt19)."'>".utf8_encode($preg->alt19)."</option> ";}



$alternativas .= "<center>


 <select  id='".$id_encuesta . $preg->id_pregunta."' name='".$id_encuesta . $preg->id_pregunta."' class='form form-control' required>
   ".$option."
</select>  </center>";            }

         }




       if ($preg->tipo == "SELMUL+OTRA") {   //echo "-> hola SELMUL";
                         $alternativas=""; $option="";
                  //$alternativas= file_get_contents("views/medicion/" . $id_empresa . "_preguntas_niv1_7.html");
            if ($preg->respuesta) {

     $option.="<option value=''></option> ";
if($preg->alt1<>'')   {if($preg->alt1==$preg->respuesta){$check1=" selected ";} $option.="<option value='".utf8_encode($preg->alt1)."' $check1>".utf8_encode($preg->alt1)."</option> ";}
if($preg->alt2<>'')   {if($preg->alt2==$preg->respuesta){$check2=" selected ";} $option.="<option value='".utf8_encode($preg->alt2)."' $check2>".utf8_encode($preg->alt2)."</option> ";}
if($preg->alt3<>'')   {if($preg->alt3==$preg->respuesta){$check3=" selected ";} $option.="<option value='".utf8_encode($preg->alt3)."' $check3>".utf8_encode($preg->alt3)."</option> ";}
if($preg->alt4<>'')   {if($preg->alt4==$preg->respuesta){$check4=" selected ";} $option.="<option value='".utf8_encode($preg->alt4)."' $check4>".utf8_encode($preg->alt4)."</option> ";}
if($preg->alt5<>'')   {if($preg->alt5==$preg->respuesta){$check5=" selected ";} $option.="<option value='".utf8_encode($preg->alt5)."' $check5>".utf8_encode($preg->alt5)."</option> ";}
if($preg->alt6<>'')   {if($preg->alt6==$preg->respuesta){$check6=" selected ";} $option.="<option value='".utf8_encode($preg->alt6)."' $check6>".utf8_encode($preg->alt6)."</option> ";}
if($preg->alt7<>'')   {if($preg->alt7==$preg->respuesta){$check7=" selected ";} $option.="<option value='".utf8_encode($preg->alt7)."' $check7>".utf8_encode($preg->alt7)."</option> ";}
if($preg->alt8<>'')   {if($preg->alt8==$preg->respuesta){$check8=" selected ";} $option.="<option value='".utf8_encode($preg->alt8)."' $check8>".utf8_encode($preg->alt8)."</option> ";}
if($preg->alt9<>'')   {if($preg->alt9==$preg->respuesta){$check9=" selected ";} $option.="<option value='".utf8_encode($preg->alt9)."' $check9>".utf8_encode($preg->alt9)."</option> ";}
if($preg->alt10<>'')  {if($preg->alt10==$preg->respuesta){$check10=" selected ";} $option.="<option value='".utf8_encode($preg->alt10)."' $check10>".utf8_encode($preg->alt10)."</option> ";}
if($preg->alt11<>'')   {if($preg->alt11==$preg->respuesta){$check11=" selected ";} $option.="<option value='".utf8_encode($preg->alt11)."' $check11>".utf8_encode($preg->alt11)."</option> ";}
if($preg->alt12<>'')   {if($preg->alt12==$preg->respuesta){$check12=" selected ";} $option.="<option value='".utf8_encode($preg->alt12)."' $check12>".utf8_encode($preg->alt12)."</option> ";}
if($preg->alt13<>'')   {if($preg->alt13==$preg->respuesta){$check13=" selected ";} $option.="<option value='".utf8_encode($preg->alt13)."' $check13>".utf8_encode($preg->alt13)."</option> ";}
if($preg->alt14<>'')   {if($preg->alt14==$preg->respuesta){$check14=" selected ";} $option.="<option value='".utf8_encode($preg->alt14)."' $check14>".utf8_encode($preg->alt14)."</option> ";}
if($preg->alt15<>'')   {if($preg->alt15==$preg->respuesta){$check15=" selected ";} $option.="<option value='".utf8_encode($preg->alt15)."' $check15>".utf8_encode($preg->alt15)."</option> ";}
if($preg->alt16<>'')   {if($preg->alt16==$preg->respuesta){$check16=" selected ";} $option.="<option value='".utf8_encode($preg->alt16)."' $check16>".utf8_encode($preg->alt16)."</option> ";}
if($preg->alt17<>'')   {if($preg->alt17==$preg->respuesta){$check17=" selected ";} $option.="<option value='".utf8_encode($preg->alt17)."' $check17>".utf8_encode($preg->alt17)."</option> ";}
if($preg->alt18<>'')   {if($preg->alt18==$preg->respuesta){$check18=" selected ";} $option.="<option value='".utf8_encode($preg->alt18)."' $check18>".utf8_encode($preg->alt18)."</option> ";}
if($preg->alt19<>'')   {if($preg->alt19==$preg->respuesta){$check19=" selected ";} $option.="<option value='".utf8_encode($preg->alt19)."' $check19>".utf8_encode($preg->alt19)."</option> ";}
      $option.="<option value='Otra'>Otra</option> ";
$alternativas .= "<center>


 <select id='".$id_encuesta . $preg->id_pregunta."' name='".$id_encuesta . $preg->id_pregunta."' class='form form-control' required>
    ".$option."
</select>
    <small><div style='text-align: left;'>Escriba aquí tu opción</div></small><br><input type='text' id='".$id_encuesta . $preg->id_pregunta."_otra' name='".$id_encuesta . $preg->id_pregunta."_otra' value=''  class='form form-control' />

 </center>";



            } else {

    //echo  "<br>preg selmul ".$preg->alt1;
    $option.="<option value=''></option> ";
if($preg->alt1<>'')   {$option.="<option value='".utf8_encode($preg->alt1)."'>".utf8_encode($preg->alt1)."</option> ";}
if($preg->alt2<>'')   {$option.="<option value='".utf8_encode($preg->alt2)."'>".utf8_encode($preg->alt2)."</option> ";}
if($preg->alt3<>'')   {$option.="<option value='".utf8_encode($preg->alt3)."'>".utf8_encode($preg->alt3)."</option> ";}
if($preg->alt4<>'')   {$option.="<option value='".utf8_encode($preg->alt4)."'>".utf8_encode($preg->alt4)."</option> ";}
if($preg->alt5<>'')   {$option.="<option value='".utf8_encode($preg->alt5)."'>".utf8_encode($preg->alt5)."</option> ";}
if($preg->alt6<>'')   {$option.="<option value='".utf8_encode($preg->alt6)."'>".utf8_encode($preg->alt6)."</option> ";}
if($preg->alt7<>'')   {$option.="<option value='".utf8_encode($preg->alt7)."'>".utf8_encode($preg->alt7)."</option> ";}
if($preg->alt8<>'')   {$option.="<option value='".utf8_encode($preg->alt8)."'>".utf8_encode($preg->alt8)."</option> ";}
if($preg->alt9<>'')   {$option.="<option value='".utf8_encode($preg->alt9)."'>".utf8_encode($preg->alt9)."</option> ";}
if($preg->alt10<>'')   {$option.="<option value='".utf8_encode($preg->alt10)."'>".utf8_encode($preg->alt10)."</option> ";}
if($preg->alt11<>'')   {$option.="<option value='".utf8_encode($preg->alt11)."'>".utf8_encode($preg->alt11)."</option> ";}
if($preg->alt12<>'')   {$option.="<option value='".utf8_encode($preg->alt12)."'>".utf8_encode($preg->alt12)."</option> ";}
if($preg->alt13<>'')   {$option.="<option value='".utf8_encode($preg->alt13)."'>".utf8_encode($preg->alt13)."</option> ";}
if($preg->alt14<>'')   {$option.="<option value='".utf8_encode($preg->alt14)."'>".utf8_encode($preg->alt14)."</option> ";}
if($preg->alt15<>'')   {$option.="<option value='".utf8_encode($preg->alt15)."'>".utf8_encode($preg->alt15)."</option> ";}
if($preg->alt16<>'')   {$option.="<option value='".utf8_encode($preg->alt16)."'>".utf8_encode($preg->alt16)."</option> ";}
if($preg->alt17<>'')   {$option.="<option value='".utf8_encode($preg->alt17)."'>".utf8_encode($preg->alt17)."</option> ";}
if($preg->alt18<>'')   {$option.="<option value='".utf8_encode($preg->alt18)."'>".utf8_encode($preg->alt18)."</option> ";}
if($preg->alt19<>'')   {$option.="<option value='".utf8_encode($preg->alt19)."'>".utf8_encode($preg->alt19)."</option> ";}


           $option.="<option value='Otra'>Otra</option> ";
$alternativas.="
<script>function MuestraOtra_".$preg->id_pregunta."(valor){
if(valor=='Otra'){
        document.getElementById('otra_".$preg->id_pregunta."').style.display = 'block';

}else{
    document.getElementById('otra_".$preg->id_pregunta."').style.display = 'none';
}


}</script>
";
$alternativas .= "<center>


 <select  id='".$id_encuesta . $preg->id_pregunta."' name='".$id_encuesta . $preg->id_pregunta."' onchange=\"MuestraOtra_".$preg->id_pregunta."(this.value);\" class='form form-control' required>
   ".$option."
</select>
    <span id='otra_".$preg->id_pregunta."' style='display:none;'>
    <small><div style='text-align: left;'>Escriba aquí tu opción</div></small><br><input type='text' id='".$id_encuesta . $preg->id_pregunta."_otra' name='".$id_encuesta . $preg->id_pregunta."_otra' value=''  class='form form-control' />
    </span>
 </center>";            }

         }
         if ($preg->tipo == "NIV1_7") {

         //echo "hola";
                  $alternativas="";
                  //$alternativas= file_get_contents("views/medicion/" . $id_empresa . "_preguntas_niv1_7.html");
            if ($preg->respuesta) {

         $alternativas .= "<center> <input id='".$id_encuesta . $preg->id_pregunta."' name='".$id_encuesta . $preg->id_pregunta."'
            type='number' class='rating' max='7' data-step='1' data-stars='7' data-size='md' data-glyphicon='false'
            data-rating-class='fontawesome-icon' data-symbol='&#xe73b;' value='".$preg->respuesta."'   ></center>";
            } else {


                 $alternativas .= "<center> <input id='".$id_encuesta . $preg->id_pregunta."' name='".$id_encuesta . $preg->id_pregunta."'
                 type='number' class='rating' max='7' data-step='1' data-stars='7' data-size='md' data-glyphicon='false'
            data-rating-class='fontawesome-icon' data-symbol='&#xe73b;'  ></center>";
            }

             //echo "<br><br>$alternativas";
         }
            if ($preg->tipo == "SELMUL") {   //echo "-> hola SELMUL";
                         $alternativas=""; $option="";
                  //$alternativas= file_get_contents("views/medicion/" . $id_empresa . "_preguntas_niv1_7.html");
            if ($preg->respuesta) {

     $option.="<option value=''></option> ";
if($preg->alt1<>'')   {if($preg->alt1==$preg->respuesta){$check1=" selected ";} $option.="<option value='".utf8_encode($preg->alt1)."' $check1>".utf8_encode($preg->alt1)."</option> ";}
if($preg->alt2<>'')   {if($preg->alt2==$preg->respuesta){$check2=" selected ";} $option.="<option value='".utf8_encode($preg->alt2)."' $check2>".utf8_encode($preg->alt2)."</option> ";}
if($preg->alt3<>'')   {if($preg->alt3==$preg->respuesta){$check3=" selected ";} $option.="<option value='".utf8_encode($preg->alt3)."' $check3>".utf8_encode($preg->alt3)."</option> ";}
if($preg->alt4<>'')   {if($preg->alt4==$preg->respuesta){$check4=" selected ";} $option.="<option value='".utf8_encode($preg->alt4)."' $check4>".utf8_encode($preg->alt4)."</option> ";}
if($preg->alt5<>'')   {if($preg->alt5==$preg->respuesta){$check5=" selected ";} $option.="<option value='".utf8_encode($preg->alt5)."' $check5>".utf8_encode($preg->alt5)."</option> ";}
if($preg->alt6<>'')   {if($preg->alt6==$preg->respuesta){$check6=" selected ";} $option.="<option value='".utf8_encode($preg->alt6)."' $check6>".utf8_encode($preg->alt6)."</option> ";}
if($preg->alt7<>'')   {if($preg->alt7==$preg->respuesta){$check7=" selected ";} $option.="<option value='".utf8_encode($preg->alt7)."' $check7>".utf8_encode($preg->alt7)."</option> ";}
if($preg->alt8<>'')   {if($preg->alt8==$preg->respuesta){$check8=" selected ";} $option.="<option value='".utf8_encode($preg->alt8)."' $check8>".utf8_encode($preg->alt8)."</option> ";}
if($preg->alt9<>'')   {if($preg->alt9==$preg->respuesta){$check9=" selected ";} $option.="<option value='".utf8_encode($preg->alt9)."' $check9>".utf8_encode($preg->alt9)."</option> ";}
if($preg->alt10<>'')  {if($preg->alt10==$preg->respuesta){$check10=" selected ";} $option.="<option value='".utf8_encode($preg->alt10)."' $check10>".utf8_encode($preg->alt10)."</option> ";}
if($preg->alt11<>'')   {if($preg->alt11==$preg->respuesta){$check11=" selected ";} $option.="<option value='".utf8_encode($preg->alt11)."' $check11>".utf8_encode($preg->alt11)."</option> ";}
if($preg->alt12<>'')   {if($preg->alt12==$preg->respuesta){$check12=" selected ";} $option.="<option value='".utf8_encode($preg->alt12)."' $check12>".utf8_encode($preg->alt12)."</option> ";}
if($preg->alt13<>'')   {if($preg->alt13==$preg->respuesta){$check13=" selected ";} $option.="<option value='".utf8_encode($preg->alt13)."' $check13>".utf8_encode($preg->alt13)."</option> ";}
if($preg->alt14<>'')   {if($preg->alt14==$preg->respuesta){$check14=" selected ";} $option.="<option value='".utf8_encode($preg->alt14)."' $check14>".utf8_encode($preg->alt14)."</option> ";}
if($preg->alt15<>'')   {if($preg->alt15==$preg->respuesta){$check15=" selected ";} $option.="<option value='".utf8_encode($preg->alt15)."' $check15>".utf8_encode($preg->alt15)."</option> ";}
if($preg->alt16<>'')   {if($preg->alt16==$preg->respuesta){$check16=" selected ";} $option.="<option value='".utf8_encode($preg->alt16)."' $check16>".utf8_encode($preg->alt16)."</option> ";}
if($preg->alt17<>'')   {if($preg->alt17==$preg->respuesta){$check17=" selected ";} $option.="<option value='".utf8_encode($preg->alt17)."' $check17>".utf8_encode($preg->alt17)."</option> ";}
if($preg->alt18<>'')   {if($preg->alt18==$preg->respuesta){$check18=" selected ";} $option.="<option value='".utf8_encode($preg->alt18)."' $check18>".utf8_encode($preg->alt18)."</option> ";}
if($preg->alt19<>'')   {if($preg->alt19==$preg->respuesta){$check19=" selected ";} $option.="<option value='".utf8_encode($preg->alt19)."' $check19>".utf8_encode($preg->alt19)."</option> ";}

$alternativas .= "<center>


 <select id='".$id_encuesta . $preg->id_pregunta."' name='".$id_encuesta . $preg->id_pregunta."' class='form form-control' ".$required.">
    ".$option."
</select>  </center>";



            } else {

    //echo  "<br>preg selmul ".$preg->alt1;
    $option.="<option value=''></option> ";
if($preg->alt1<>'')   {$option.="<option value='".utf8_encode($preg->alt1)."'>".utf8_encode($preg->alt1)."</option> ";}
if($preg->alt2<>'')   {$option.="<option value='".utf8_encode($preg->alt2)."'>".utf8_encode($preg->alt2)."</option> ";}
if($preg->alt3<>'')   {$option.="<option value='".utf8_encode($preg->alt3)."'>".utf8_encode($preg->alt3)."</option> ";}
if($preg->alt4<>'')   {$option.="<option value='".utf8_encode($preg->alt4)."'>".utf8_encode($preg->alt4)."</option> ";}
if($preg->alt5<>'')   {$option.="<option value='".utf8_encode($preg->alt5)."'>".utf8_encode($preg->alt5)."</option> ";}
if($preg->alt6<>'')   {$option.="<option value='".utf8_encode($preg->alt6)."'>".utf8_encode($preg->alt6)."</option> ";}
if($preg->alt7<>'')   {$option.="<option value='".utf8_encode($preg->alt7)."'>".utf8_encode($preg->alt7)."</option> ";}
if($preg->alt8<>'')   {$option.="<option value='".utf8_encode($preg->alt8)."'>".utf8_encode($preg->alt8)."</option> ";}
if($preg->alt9<>'')   {$option.="<option value='".utf8_encode($preg->alt9)."'>".utf8_encode($preg->alt9)."</option> ";}
if($preg->alt10<>'')   {$option.="<option value='".utf8_encode($preg->alt10)."'>".utf8_encode($preg->alt10)."</option> ";}
if($preg->alt11<>'')   {$option.="<option value='".utf8_encode($preg->alt11)."'>".utf8_encode($preg->alt11)."</option> ";}
if($preg->alt12<>'')   {$option.="<option value='".utf8_encode($preg->alt12)."'>".utf8_encode($preg->alt12)."</option> ";}
if($preg->alt13<>'')   {$option.="<option value='".utf8_encode($preg->alt13)."'>".utf8_encode($preg->alt13)."</option> ";}
if($preg->alt14<>'')   {$option.="<option value='".utf8_encode($preg->alt14)."'>".utf8_encode($preg->alt14)."</option> ";}
if($preg->alt15<>'')   {$option.="<option value='".utf8_encode($preg->alt15)."'>".utf8_encode($preg->alt15)."</option> ";}
if($preg->alt16<>'')   {$option.="<option value='".utf8_encode($preg->alt16)."'>".utf8_encode($preg->alt16)."</option> ";}
if($preg->alt17<>'')   {$option.="<option value='".utf8_encode($preg->alt17)."'>".utf8_encode($preg->alt17)."</option> ";}
if($preg->alt18<>'')   {$option.="<option value='".utf8_encode($preg->alt18)."'>".utf8_encode($preg->alt18)."</option> ";}
if($preg->alt19<>'')   {$option.="<option value='".utf8_encode($preg->alt19)."'>".utf8_encode($preg->alt19)."</option> ";}



$alternativas .= "<center>


 <select  id='".$id_encuesta . $preg->id_pregunta."' name='".$id_encuesta . $preg->id_pregunta."' class='form form-control' ".$required.">
   ".$option."
</select>  </center>";            }

         }
         if ($preg->tipo == "NIV1_4") {

         //echo "hola";
                  $alternativas="";
                  //$alternativas= file_get_contents("views/medicion/" . $id_empresa . "_preguntas_niv1_7.html");
            if ($preg->respuesta) {

         $alternativas .= "<center> <input id='".$id_encuesta . $preg->id_pregunta."' name='".$id_encuesta . $preg->id_pregunta."'
            type='number' class='rating' max='4' data-step='1' data-stars='7' data-size='md' data-glyphicon='false'
            data-rating-class='fontawesome-icon' data-symbol='&#xe73b;' value='".$preg->respuesta."'   ></center>";
            } else {


                 $alternativas .= "<center> <input id='".$id_encuesta . $preg->id_pregunta."' name='".$id_encuesta . $preg->id_pregunta."'
                 type='number' class='rating' max='4' data-step='1' data-stars='7' data-size='md' data-glyphicon='false'
            data-rating-class='fontawesome-icon' data-symbol='&#xe73b;'  ></center>";
            }

             //echo "<br><br>$alternativas";
         }
        if ($preg->tipo == "NIV1_10") {
            $alternativas="";
                            $alternativas = "<table width='100%'><tr>";
                            for ($i = 1; $i <= 10; $i++) {
                                if ($preg->respuesta == $i) {
                                    $checked = " checked ";
                                } else {
                                    $checked = "  ";
                                }

                            //echo "<br> NIV1_10 RUT COLABORADOR  $rut_colaborador ID ENCUESTA $id_encuesta ID PREGUNTA ".$preg->id_pregunta." ";

                                $alternativas .= "<td width='10%'>
                                        <center>
                                            <input type='radio' name='" . $id_encuesta . $preg->id_pregunta . "' value='" . $i . "' " . $checked . ">
                                            <br>" . $i . "</center>
                                            </td>";
                            }
                            $alternativas .= "</tr></table>";
        }


        if ($preg->tipo == "SI_NO") {     $alternativas="";
                                //echo "<br>SI NO";
                                    if ($preg->respuesta == "SI") {
                                        $checkedSI = " checked ";
                                    } else {
                                        $checkedSI = "  ";
                                    }
                                    if ($preg->respuesta == "NO") {
                                        $checkedNO = " checked ";
                                    } else {
                                        $checkedNO = "  ";
                                    }
                                    $alternativas = "<table width='100%' border=0><tr>";
                                    $alternativas .= "<td width='50%'><center><input type='radio' name='" . $id_encuesta . $preg->id_pregunta . "'
                                            value='NO' " . $checkedNO . " required><br>
                                            <span class='badge badge-danger'><span class='blanco'>NO</span></span></center><br></td>";
                                    $alternativas .= "<td width='50%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
                                            value='SI' " . $checkedSI . " required><br>
                                            <span class='badge badge-info'><span class='blanco'>SI</span></span></center><br></td>";
                                    $alternativas .= "</tr></table>";
        }

        if ($preg->tipo == "SI_NO_BOTON") {
            $alternativas="";
                                //echo "<br>SI NO";
                                    if ($preg->respuesta == "SI") {
                                        $checkedSI = " checked ";
                                    } else {
                                        $checkedSI = "  ";
                                    }
                                    if ($preg->respuesta == "NO") {
                                        $checkedNO = " checked ";
                                    } else {
                                        $checkedNO = "  ";
                                    }
                                    $alternativas = "<table width='100%' border=0><tr>";
                                    $alternativas .= "<td width='50%'><center><input type='radio' name='" . $id_encuesta . $preg->id_pregunta . "'
                                            value='NO' " . $checkedNO . " onclick=\"myFunctionOpcion2('".$preg->id_pregunta."')\" required><br>
                                            <span class='badge badge-danger'><span class='blanco'>NO</span></span></center><br></td>";
                                    $alternativas .= "<td width='50%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
                                            value='SI' " . $checkedSI . " onclick=\"myFunctionOpcion1('".$preg->id_pregunta."')\" required><br>
                                            <span class='badge badge-info'><span class='blanco'>SI</span></span></center><br></td>";
                                    $alternativas .= "</tr></table>";





        }

        //echo $preg->tipo;

        if ($preg->tipo == "LIK_1_5") {      $alternativas="";

                                //echo "<br>LI5 594";
                                if ($preg->respuesta == "1") {
                                    $checkedUno = " checked ";
                                } else {
                                    $checkedUno = "  ";
                                }
                                if ($preg->respuesta == "2") {
                                    $checkedDos = " checked ";
                                } else {
                                    $checkedDos = "  ";
                                }
                                if ($preg->respuesta == "3") {
                                    $checkedTres = " checked ";
                                } else {
                                    $checkedTres = "  ";
                                }
                                if ($preg->respuesta == "4") {
                                    $checkedCuatro = " checked ";
                                } else {
                                    $checkedCuatro = "  ";
                                }
                                if ($preg->respuesta == "5") {
                                    $checkedCinco = " checked ";
                                } else {
                                    $checkedCinco = "  ";
                                }

                                //echo "hola";

                                $alternativas = "<table width='100%'><tr>";
                                $alternativas .= "<td width='20%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
                                        value='1' " . $checkedUno . " required><br><img src='img/med_sad.png' width='32px'><br>
                                        <span class='badge badge-danger'><span class='blanco'>Totalmente en Desacuerdo</span></span></center><br></td>";
                                $alternativas .= "<td width='20%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
                                        value='2' " . $checkedDos . " required><br><img src='img/med_sad.png' width='32px'><br>
                                        <span class='badge badge-danger'><span class='blanco'>En Desacuerdo</span></span></center><br></td>";
                                $alternativas .= "<td width='20%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
                                        value='3' " . $checkedTres . " required><br><img src='img/med_confused.png' width='32px'>  <br>
                                        <span class='badge badge-info'><span class='blanco'>Ni de Acuerdo ni en Desacuerdo</span></span></center><br></td>";
                                $alternativas .= "<td width='20%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
                                        value='4' " . $checkedCuatro . " required><br><img src='img/med_happy.png' width='32px'> <br>
                                        <span class='badge badge-info'><span class='blanco'>De Acuerdo</span></span></center><br></td>";
                                $alternativas .= "<td width='20%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
                                        value='5' " . $checkedCinco . " required><br><img src='img/med_happy.png' width='32px'> <br>
                                        <span class='badge badge-success'><span class='blanco'>Totalmente  de Acuerdo</span></span></center><br></td>";
                                $alternativas .= "</tr></table>";

                                //echo "$alternativas";
        }


        if ($preg->tipo == "LIK1_4") {       $alternativas="";

                                //echo "<br>LI5 594";
                                if ($preg->respuesta == "1") {
                                    $checkedUno = " checked ";
                                } else {
                                    $checkedUno = "  ";
                                }
                                if ($preg->respuesta == "2") {
                                    $checkedDos = " checked ";
                                } else {
                                    $checkedDos = "  ";
                                }
                                if ($preg->respuesta == "3") {
                                    $checkedTres = " checked ";
                                } else {
                                    $checkedTres = "  ";
                                }
                                if ($preg->respuesta == "4") {
                                    $checkedCuatro = " checked ";
                                } else {
                                    $checkedCuatro = "  ";
                                }
                                if ($preg->respuesta == "5") {
                                    $checkedCinco = " checked ";
                                } else {
                                    $checkedCinco = "  ";
                                }

                                //echo "hola";

                                $alternativas = "<table width='100%'><tr>";
                                $alternativas .= "<td width='20%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
                                        value='1' " . $checkedUno . " required><br><img src='img/med_sad.png' width='32px'><br>
                                        <span class='badge badge-danger'><span class='blanco'>Muy en desacuerdo</span></span></center><br></td>";
                                $alternativas .= "<td width='20%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
                                        value='2' " . $checkedDos . " required><br><img src='img/med_confused.png' width='32px'><br>
                                        <span class='badge badge-warning'><span class='blanco'>Desacuerdo</span></span></center><br></td>";
                                $alternativas .= "<td width='20%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
                                        value='3' " . $checkedTres . " required><br><img src='img/med_happy.png' width='32px'>  <br>
                                        <span class='badge badge-info'><span class='blanco'>De acuerdo</span></span></center><br></td>";
                                $alternativas .= "<td width='20%'><center><input type='radio' name='" .  $id_encuesta . $preg->id_pregunta . "'
                                        value='4' " . $checkedCuatro . " required><br><img src='img/med_happy.png' width='32px'> <br>
                                        <span class='badge badge-success'><span class='blanco'>Muy de acuerdo</span></span></center><br></td>";

                                $alternativas .= "</tr></table>";

                                //echo "$alternativas";
        }

       // echo "<br>$alternativas";

       //echo "<br>row ".$row;
       //echo "<br><br>";echo "$alternativas";

        $row = str_replace("{PREGUNTA}", utf8_encode($preg->pregunta), $row);
        $row = str_replace("{ALTERNATIVAS}", $alternativas, $row);
        $row = str_replace("{RUT}", $rut, $row);
        $row = str_replace("{RUT_COLABORADOR}", $rut_colaborador, $row);
        $row = str_replace("{ID_PREGUNTA}", $preg->id_pregunta, $row);
    }

        $PRINCIPAL = str_replace("{ROW_PREGUNTAS_LIBRE}", utf8_encode($row), $PRINCIPAL);

    return ($row);
}


function allCuiPorEmpresa($buscar, $id_empresa)
{
    $dataPersonas = allCuiData($buscar, $id_empresa);
    if ($dataPersonas) {
        foreach ($dataPersonas as $dataPersonas_aux) {
            echo utf8_encode($dataPersonas_aux->area) . "   " . utf8_encode($buscar) . " " . utf8_encode($dataPersonas_aux->amaterno) . " " . "|" . $dataPersonas_aux->rut . "\n";
            //echo utf8_encode($dataPersonas_aux->nombre)."\n";
        }
    } else {
        $data = 'No Existe este CUI';
    }
    return $data;
}

function allCuiPorNombreOficina($buscar, $id_empresa)
{
    $dataPersonas = allCuiOficData($buscar, $id_empresa);
    //print_r($dataPersonas);
    if ($dataPersonas) {
        foreach ($dataPersonas as $dataPersonas_aux) {
            $data=utf8_encode($dataPersonas_aux->id_gerencia) . " " . utf8_encode($dataPersonas_aux->sucursal) . "";
            //echo utf8_encode($dataPersonas_aux->nombre)."\n";
        }
    } else {
        $data = 'No Existe CUI';
    }
   // print_r($data);exit();
    return $data;
}



function allPersonasPorNombreCargoPorEmpresa($buscar, $id_empresa, $rut)
{
    //$datos_usuario=UsuarioEnBasePersonas($rut);
    //$dataPersonas = allPersonasPorEmpresa($buscar, $id_empresa);
    $buscar       = LimpiaRutFront($buscar);
    $dataPersonas = allPersonasPorEmpresa($buscar, $id_empresa, $datos_usuario[0]->gerencia);
    if ($dataPersonas) {
        foreach ($dataPersonas as $dataPersonas_aux) {
            echo utf8_encode($dataPersonas_aux->nombre_completo) . " / " . utf8_encode($dataPersonas_aux->cargo) . " " . utf8_encode($dataPersonas_aux->rut_completo) . "" . "|" . $dataPersonas_aux->rut . "" . "|" . $dataPersonas_aux->local . "\n";
            //echo utf8_encode($dataPersonas_aux->nombre)."\n";
        }
    } else {
        $data = 'No Existe este nombre';
    }
    return $data;
}

function allPersonasPorNombreCargoPorEmpresaSinDivPersonas($buscar, $id_empresa, $rut)
{
    //$datos_usuario=UsuarioEnBasePersonas($rut);
    //$dataPersonas = allPersonasPorEmpresa($buscar, $id_empresa);
    $buscar       = LimpiaRutFront($buscar);
    $dataPersonas = allPersonasPorEmpresaSinDivPersona($buscar, $id_empresa, $datos_usuario[0]->gerencia);
    if ($dataPersonas) {
        foreach ($dataPersonas as $dataPersonas_aux) {
            echo utf8_encode($dataPersonas_aux->nombre_completo) . " " . utf8_encode($dataPersonas_aux->rut_completo) . "" . "|" . $dataPersonas_aux->rut . "" . "|" . $dataPersonas_aux->local . "\n";
            //echo utf8_encode($dataPersonas_aux->nombre)."\n";
        }
    } else {
        $data = 'No Existen Resultados';    }
    return $data;
}
function allPersonasPorNombreCargoPorEmpresaSinDivPersonasJefe($buscar, $id_empresa, $rut)
{
    //$datos_usuario=UsuarioEnBasePersonas($rut);
    //$dataPersonas = allPersonasPorEmpresa($buscar, $id_empresa);
    $buscar       = LimpiaRutFront($buscar);
    $dataPersonas = allPersonasPorEmpresaSinDivPersonaJefe($buscar, $id_empresa, $datos_usuario[0]->gerencia);
    if ($dataPersonas) {
        foreach ($dataPersonas as $dataPersonas_aux) {
            echo utf8_encode($dataPersonas_aux->nombre_completo) . " " . utf8_encode($dataPersonas_aux->rut_completo) . "" . "|" . $dataPersonas_aux->rut . "" . "|" . $dataPersonas_aux->local ." ". $dataPersonas_aux->unidad_negocio. "    \n";
            //echo utf8_encode($dataPersonas_aux->nombre)."\n";
        }
    } else {
        $data = 'No Existen Resultados';
    }
    return $data;
}

function RO_BuscaEstadoCursos($id_malla, $id_empresa, $rut, $PRINCIPAL)
{
    $arreglo_cursos = Ro_escuela_busca_cursosmalla($id_malla, $id_empresa);
    //echo "<br>";                print_r($arreglo_cursos);            echo "<br>";
    foreach ($arreglo_cursos as $arreglo_curso) {
        $arreglo = CAPACITACION_ObtenerEstadoAvanceCurso($rut, $arreglo_curso->id_curso, "", $id_empresa);
        if ($arreglo[4] >= 100) {
            $PRINCIPAL = str_replace("{ESTADO_" . $arreglo_curso->id_curso . "}", "Curso Realizado", $PRINCIPAL);
            $PRINCIPAL = str_replace("{ESTILO_ESCRO_" . $arreglo_curso->id_curso . "}", "fbox-icon-success", $PRINCIPAL);
            $PRINCIPAL = str_replace("{ICONO_ESCRO_" . $arreglo_curso->id_curso . "}", "icon-check", $PRINCIPAL);
        } elseif ($arreglo[4] > 0 and $arreglo[4] < 100) {
            $PRINCIPAL = str_replace("{ESTADO_" . $arreglo_curso->id_curso . "}", "Curso en Proceso", $PRINCIPAL);
            $PRINCIPAL = str_replace("{ESTILO_ESCRO_" . $arreglo_curso->id_curso . "}", "fbox-icon-warning", $PRINCIPAL);
            $PRINCIPAL = str_replace("{ICONO_ESCRO_" . $arreglo_curso->id_curso . "}", "icon-laptop", $PRINCIPAL);
        } else {
            $PRINCIPAL = str_replace("{ESTADO_" . $arreglo_curso->id_curso . "}", "Curso no Iniciado", $PRINCIPAL);
            $PRINCIPAL = str_replace("{ESTILO_ESCRO_" . $arreglo_curso->id_curso . "}", "fbox-icon", $PRINCIPAL);
            $PRINCIPAL = str_replace("{ICONO_ESCRO_" . $arreglo_curso->id_curso . "}", "icon-laptop", $PRINCIPAL);
        }
        //echo "<br>".$arreglo_curso->id_curso." rut ".$rut;
        //echo "<br>";
        //print_r($arreglo);
    }
    return ($PRINCIPAL);
}
function VerificaArregloSQLInjection($arreglo)
{
    //print_R($arreglo);
    //echo "aca";
    $flag          = "Todo Bien";
    //veo si es un arreglo
    $total_arreglo = count($arreglo);

    foreach ($arreglo as $clave => $valor) {
        //echo "El valor de $clave es: $valor<br><br>";
        //lo paso por la tabla de sql_injection
        if (strtoupper(trim($valor)) == "") {
            continue;
        }
        $valor = str_replace("'", "", $valor);
        $valor = str_replace('"', "", $valor);
        $valor = str_replace("+'", "", $valor);
        $valor = str_replace('--', "", $valor);





        $palabra_injection = buscaPalabraSqlInjection(strtoupper(trim($valor)));
        if ($palabra_injection) {
            //echo "<br><span class='badge_small badge-azul'> SQL INJECTION</span><br>";
            //echo $arreglo[$clave];
            $arreglo[$clave] = "";
            //echo "variable limpiada ".$arreglo[$clave]." <- <br>";
            //exit;
        } else {
            //Ahora traigo todas las palabras de la tabla, y las busco si estan, s
            $palabras = TraePalabraSqlInjection();
            foreach ($palabras as $pal) {
                $arreglo[$clave] = str_replace($pal->palabra, "", $arreglo[$clave]);
                $arreglo[$clave] = str_replace(strtoupper($pal->palabra), "", $arreglo[$clave]);
                $arreglo[$clave] = str_replace(strtolower($pal->palabra), "", $arreglo[$clave]);
            }
            //echo "<br>";
        }
    }
    exit;
    return ($arreglo);
}
function fechaCastellano($fecha)
{
    $fecha     = substr($fecha, 0, 10);
    $numeroDia = date('d', strtotime($fecha));
    $dia       = date('l', strtotime($fecha));
    $mes       = date('F', strtotime($fecha));
    $anio      = date('Y', strtotime($fecha));
    $dias_ES   = array(
        "Lunes",
        "Martes",
        "Miércoles",
        "Jueves",
        "Viernes",
        "Sábado",
        "Domingo"
    );
    $dias_EN   = array(
        "Monday",
        "Tuesday",
        "Wednesday",
        "Thursday",
        "Friday",
        "Saturday",
        "Sunday"
    );
    $nombredia = str_replace($dias_EN, $dias_ES, $dia);
    $meses_ES  = array(
    "Enero",
        "Febrero",
        "Marzo",
        "Abril",
        "Mayo",
        "Junio",
        "Julio",
        "Agosto",
        "Septiembre",
        "Octubre",
        "Noviembre",
        "Diciembre"
    );
    $meses_EN  = array(
        "January",
        "February",
        "March",
        "April",
        "May",
        "June",
        "July",
        "August",
        "September",
        "October",
        "November",
        "December"
    );
    $nombreMes = str_replace($meses_EN, $meses_ES, $mes);
    return $nombredia . " " . $numeroDia . " de " . $nombreMes . " de " . $anio;
}

function buscaarrobadomain($texto, $id_mp, $rut, $id_empresa)
{
   // echo "<br>texto $texto";
    $porciones = explode("@", $texto);
   // print_R($porciones);   sleep(2);

    for ($i = 0; $i < count($porciones); $i++) {
           //echo   "<br>porciones ".$porciones[$i];
            $texto=str_replace(' ', '_', $texto);
            $texto=str_replace(',', '_', $texto);
            $texto=str_replace(';', '_', $texto);
            $texto=str_replace('-', '_', $texto);
            $texto=str_replace('_', '_', $texto);
                    $porcionesX = explode("_", $texto);
                    for ($j = 0; $j < count($porcionesX); $j++) {
                     // echo   "<br>porciones X ".$porcionesX[$j];
                     if(substr( $porcionesX[$j], 0, 1 ) === "@"){
                       // echo $porcionesX[$j];

                       $arreglo[]= $porcionesX[$j];

                      }

                    }

                    //echo "<br> arreglo";



        }
    $i=0;
    $arreglo=(array_unique($arreglo));
    //print_r($arreglo);
    foreach ($arreglo as $unico){
       // echo "UNICO $unico";
      $tagueados[$i] = SaveMpTagPeople($unico, $id_mp, $rut, $id_empresa);
      $i++;
    }
                    // echo "<br>";sleep(4);


      // print_r($tagueados); exit();

        return $tagueados;
}

function SendGrid_Email($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url,
$texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url2, $tipomensaje, $rut, $key, $otro_template)
{
    global $global_sendgrid;
        //echo "<br>$global_sendgrid<br>$to";
		    $id_empresa="78";
 		if($tipo==""){$tipo="text/html";}
 		if($id_empresa==""){
            $id_empresa = $_SESSION["id_empresa"];
        }
		//echo "<br>otro template ".$otro_template;
    if($otro_template){
        $message = file_get_contents("https://" . $global_sendgrid . "/front/views/emails_notificaciones/" . $id_empresa . "_" . $otro_template . ".html");
		//echo "otro template";
        //echo "<br>views/emails_notificaciones/" . $id_empresa . "_" . $otro_template . ".html";

    }else{
        $message = file_get_contents("https://" . $global_sendgrid . "/front/views/emails_notificaciones/" . $id_empresa . "_template_notificacion.html");
        //echo " template normal ";
        //echo "https://" . $global_sendgrid . "/front/views/emails_notificaciones/" . $id_empresa . "_template_notificacion.html";
    }
				/* echo "<br>";
				  echo "https://".$global_sendgrid."/front/views/emails_notificaciones/".$id_empresa."_template_notificacion.html";
				 echo "<br>";
				  echo "<br>SendGrid_Email<br>
				    <br>to $to,
				    <br>nombreto $nombreto,
				    <br>from $from, <br>nombrefrom $nombrefrom,
				    <br> tipo $tipo,<br>
				    subject $subject,<br> titulo1 $titulo1,
				    <br> subtitulo1 $subtitulo1,<br>texto1 $texto1,<br>url $url,<br>txto url $texto_url,
				    <br>texto2 $texto2, <br>texto3 $texto3, <br>texto4 $texto4, <br>logo $logo, <br>id_empresa $id_empresa, <br>url $url, <br>tipomensaje $tipomensaje,<br>    rut $rut,
				    <br>key $key,<br>otro_template $otro_template";

    echo "<br>mensaje<br><br>$message";
				*/
    $message = str_replace("{TITULO1}", $titulo1, $message);
    $message = str_replace("{SUBTITULO1}", $subtitulo1, $message);
    $message = str_replace("{TEXTO1}", $texto1, $message);
    $message = str_replace("{URL}", $url, $message);
    $message = str_replace("{TEXTO_URL}", $texto_url, $message);
    $message = str_replace("{TEXTO2}", $texto2, $message);
    $message = str_replace("{TEXTO3}", $texto3, $message);
    $message = str_replace("{TEXTO4}", $texto4, $message);
    $message = str_replace("{LOGO}", $logo, $message);
    require("script/sendgrid-php/sendgrid-php.php");
    global $from_2022,$nombrefrom_2022,$api_key_2022;
    $from       = new SendGrid\Email($nombrefrom_2022, $from_2022);
    $to         = new SendGrid\Email($nombreto, $to);
    $content    = new SendGrid\Content($tipo, $message);
    $mail       = new SendGrid\Mail($from, $subject, $to, $content);
    $api_key_2022=getenv('api_key_2022');
    $apiKey     = $api_key_2022;
    $sg         = new \SendGrid($apiKey);
    $response   = $sg->client->mail()->send()->post($mail);
    //echo "<br>mensaje<br><br>$message";
    $statuscode = $response->statusCode();
    $headers    = $response->headers();
    $body       = $response->body();
    $fecha      = date("Y-m-d");
		/*echo "<br><br>statuscode_";    print_r($statuscode);
		echo "<br><br>headers_";        print_r($headers);
		echo "<br><br>body_";       print_r($body);
		exit();*/
	SaveLogEmails($id_empresa, $tipo, $subject, $to, $nombreto, $fecha, $statuscode, $headers, $body, $tipomensaje, $rut, $key);
}

function SendGrid_Email_template($to, $nombreto, $from, $nombrefrom, $tipo, $subject, $titulo1, $subtitulo1, $texto1, $url, $texto_url, $texto2, $texto3, $texto4, $logo, $id_empresa, $url2, $tipomensaje, $rut, $key, $template)
{

      if($id_empresa==""){ $id_empresa = $_SESSION["id_empresa"];}

    //$to="rod@gop.cl";

// echo "<br>SendGrid_Email_template<br><br>to $to, nombre $nombreto, from $from, nombre $nombrefrom, tipo $tipo,<br>
// subject $subject, titulo1 $titulo1, subtitulo1 $subtitulo1, t1 $texto1,url $url, texto url $texto_url, texto2 $texto2,
// texto3 $texto3, texto4 $texto4,
// logo $logo, idempresa $id_empresa, url $url, tipomensaje $tipomensaje, rut $rut, key $key template $template";
 //echo "<br>";    echo "https://".$_SERVER['SERVER_NAME']."/front/views/emails_notificaciones/".$id_empresa."_template_notificacion.html";    echo "<br>";

    $message = file_get_contents("".$template."");
    //echo "<br>message url $message";
    $message = str_replace("{TITULO1}", $titulo1, $message);
    $message = str_replace("{SUBTITULO1}", $subtitulo1, $message);
    $message = str_replace("{TEXTO1}", $texto1, $message);
    $message = str_replace("{URL}", $url, $message);
    $message = str_replace("{TEXTO_URL}", $texto_url, $message);
    $message = str_replace("{TEXTO2}", $texto2, $message);
    $message = str_replace("{TEXTO3}", $texto3, $message);
    $message = str_replace("{TEXTO4}", $texto4, $message);
    $message = str_replace("{LOGO}", $logo, $message);

    require("script/sendgrid-php/sendgrid-php.php");
    global $from_2022,$nombrefrom_2022,$api_key_2022;
    $from       = new SendGrid\Email($nombrefrom_2022, $from_2022);
    $to         = new SendGrid\Email($nombreto, $to);
    $content    = new SendGrid\Content($tipo, $message);
    $mail       = new SendGrid\Mail($from, $subject, $to, $content);
    $apiKey     = $api_key_2022;

    $sg         = new \SendGrid($apiKey);
    $response   = $sg->client->mail()->send()->post($mail);
    $statuscode = $response->statusCode();
    $headers    = $response->headers();
    $body       = $response->body();
    $fecha      = date("Y-m-d");

    //echo "<br><br>statuscode_";    print_r($statuscode);   echo "<br><br>headers_";    print_r($headers);    echo "<br><br>body_";    print_r($body); sleep(10);
    SaveLogEmails($id_empresa, $tipo, $subject, $to, $nombreto, $fecha, $statuscode, $headers, $body, $tipomensaje, $rut, $key);
}
function mp_search_banned_words($string, $banned_words)
{
    //echo "<br><br>$string<br>";
    //print_r($banned_words);
    foreach ($banned_words as $banned_word) {
        if (stristr($string, $banned_word->palabra)) {
            //echo "<br>banned $banned_word->palabra";

            return true;
        }
    }
    return false;
}
function mp_search_banned_words_replace_sanitizar($string, $banned_words)
{
    //echo "<br><br>string-> $string< br>";
    //print_r($banned_words);
    foreach ($banned_words as $banned_word) {
            //echo $banned_word->palabra."<br>";
        if (stristr($string, $banned_word->palabra)) {
           // echo "<br>banned $banned_word->palabra ";
            // echo "<br>string  $string";

            //$string=str_replace($banned_word->palabra, "", $string);
            $string  = str_replace($banned_word->palabra, "", $string);
            $string  = str_replace(strtoupper($banned_word->palabra), "", $string);
            $string  = str_replace(strtolower($banned_word->palabra), "", $string);
            //return true;
        }
    }
    //echo "<br>nuevo string ".$string;
    return $string;
}
function BuscaCategoriasEmpresa($PRINCIPAL, $id_empresa, $comunidad)
{
    $rut_sesion       = $_SESSION["user_"];
    $Categorias_array = BuscaCategoriasEmpresa_data($id_empresa, $comunidad);
    foreach ($Categorias_array as $cat) {
        //Veo si esta categoría está perfilada
        $esta_perfilada = VerificoPerfilamentoDeBiblioteca($cat->id, $id_empresa);
        if ($esta_perfilada) {
            //Veo si el usuario de sesion, tiene acceso a esta categoria
            $usuario_tiene_acceso = VerificoPerfilamentoDeBibliotecaUsuario($cat->id, $id_empresa, $rut_sesion);
            if ($usuario_tiene_acceso) {
                $row .= file_get_contents("views/biblioteca/" . $id_empresa . "_biblio_categoria.html");
            } else {
                continue;
            }
        } else {
            $row .= file_get_contents("views/biblioteca/" . $id_empresa . "_biblio_categoria.html");
        }
        $row              = str_replace("{NUM_ARCHIVOS}", $cat->total_archivos, $row);
        $row              = str_replace("{NOMBRE_CATEGORIA}", $cat->categoria, $row);
        //Traigo el listado de sub categorias por cada categoria
        $subcategorias    = BuscaSubCategoriasEmpresa_data($id_empresa, $comunidad, $cat->id);
        $row_subcategoria = "";
        foreach ($subcategorias as $subcate) {
            //print_r($subcate);
            $row_subcategoria .= file_get_contents("views/biblioteca/" . $id_empresa . "_biblio_subcategoria.html");
            $row_subcategoria = str_replace("{NUM_ARCHIVOS}", $subcate->total_archivos, $row_subcategoria);
            $row_subcategoria = str_replace("{NOMBRE_CATEGORIA}", $subcate->categoria, $row_subcategoria);
            $row_subcategoria = str_replace("{ID_SUBCAT}", $subcate->id, $row_subcategoria);
        }
        $row = str_replace("{BIBLIO_SUBCATEGORIAS}", $row_subcategoria, $row);
    }
    $PRINCIPAL = str_replace("{BIBLIO_CATEGORIAS}", utf8_encode($row), $PRINCIPAL);
    return ($PRINCIPAL);
}
function BuscaCategoriasFullEmpresa($PRINCIPAL, $id_empresa, $comunidad)
{
    $rut_sesion       = $_SESSION["user_"];
    $Categorias_array = BuscaCategoriasEmpresa_data($id_empresa, $comunidad);
    foreach ($Categorias_array as $cat) {
        //Veo si esta categoría está perfilada
        $esta_perfilada = VerificoPerfilamentoDeBiblioteca($cat->id, $id_empresa);
        if ($esta_perfilada) {
            //Veo si el usuario de sesion, tiene acceso a esta categoria
            $usuario_tiene_acceso = VerificoPerfilamentoDeBibliotecaUsuario($cat->id, $id_empresa, $rut_sesion);
            if ($usuario_tiene_acceso) {
                $row .= file_get_contents("views/biblioteca/" . $id_empresa . "_biblio_full.html");
            } else {
                continue;
            }
        } else {
            $row .= file_get_contents("views/biblioteca/" . $id_empresa . "_biblio_full.html");
        }
        $row              = str_replace("{NUM_ARCHIVOS}",       $cat->total_archivos, $row);
        $row              = str_replace("{NOMBRE_CATEGORIA}",   $cat->categoria, $row);
        $row              = str_replace("{ID_CATEGORIA}",       $cat->id, $row);

        //Traigo el listado de sub categorias por cada categoria
        $subcategorias    = BuscaSubCategoriasEmpresa_data($id_empresa, $comunidad, $cat->id);
        $row_subcategoria = "";
        foreach ($subcategorias as $subcate) {
            //print_r($subcate);
            $row_subcategoria .= file_get_contents("views/biblioteca/" . $id_empresa . "_biblio_full_subcat.html");
            $row_subcategoria = str_replace("{NUM_ARCHIVOS}", $subcate->total_archivos, $row_subcategoria);
            $row_subcategoria = str_replace("{NOMBRE_CATEGORIA}", $subcate->categoria, $row_subcategoria);
            $row_subcategoria = str_replace("{ID_SUBCAT}", $cat->id, $row_subcategoria);

                               $archivos_biblio_full= buscarArchivoSubCatFull($subcate->id) ;
                                       $row_archivos="";
                                        foreach ($archivos_biblio_full as $unico_archivo) {
                                            $row_archivos .= file_get_contents("views/biblioteca/" . $id_empresa . "_biblio_full_archivos.html");
                                            $row_archivos = str_replace("{NOMBRE_ARCHIVO_BIBLIOTECA_FULL}", $unico_archivo->titulo, $row_archivos);
                                            $row_archivos = str_replace("{DESCARGA_ARCHIVO_BIBLIOTECA_FULL}", $unico_archivo->archivo, $row_archivos);
                                            $row_archivos = str_replace("{ID_SUBCAT}", $subcate->id, $row_archivos);

                                    }

               $row_subcategoria = str_replace("{LISTA_ARCHIVO_BIBLIOTECA_FULL}", $row_archivos, $row_subcategoria);


        }
        $row = str_replace("{LISTA_SUBCATEGORIAS_BIBLIOTECA_FULL}", $row_subcategoria, $row);
    }
    $PRINCIPAL = str_replace("{BIBLIO_CATEGORIAS}", utf8_encode($row), $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocoObjetosPorCurso($PRINCIPAL, $id_empresa, $id_curso, $rut)
{
    //Traigo los ovjetos por curso
    $objetos = CHECK_ObjetosPorCurso($id_curso);
    foreach ($objetos as $obj) {
        $row .= file_get_contents("views/google_expand/row_objeto.html");
        $row = str_replace("{NOMBRE_OBJETO}", $obj->titulo, $row);
        $row = str_replace("{DESCRIPCION}", $obj->descripcion, $row);
        $row = str_replace("{IDOBJETO}", $obj->id, $row);
        $row = str_replace("{ID_OBJETO_ENCODEADO}", Encodear3($obj->id), $row);
        $row = str_replace("{IMAGEN}", $obj->imagen, $row);
        $row = str_replace("{ESTILO_OVERLAY}", $obj->imagentexto, $row);
        $row = str_replace("{RUT}", $rut, $row);
        $row = str_replace("{ID_OBJETO}", $obj->id, $row);
    }
    $PRINCIPAL = str_replace("{ROW_LISTADO_OBJETOS_GOOGLE_EXPANDS}", utf8_encode($row), $PRINCIPAL);
    return ($PRINCIPAL);
}
function ActualizaTablatblLmsReportePorRutPrograma($rut, $id_programa)
{
}
function ColocaListadoCertificaciones($PRINCIPAL, $rut, $id_empresa)
{
    $certificaciones = TraeCerficicacionesPorRutEmpresa($id_empresa, $rut);
    foreach ($certificaciones as $cert) {
        $row_certificacion .= file_get_contents("views/home/home_row_certificacion.html");
        $row_certificacion = str_replace("{NOMBRE_CERTIFICACIONES}", ($cert->certificacion), $row_certificacion);
        $valor             = str_replace(",", ".", $cert->nota);
        $row_certificacion = str_replace("{RESULTADO_CERTIFICACION}", $valor, $row_certificacion);
    }
    $PRINCIPAL = str_replace("{ROW_CERTIFICACIONES}", utf8_encode($row_certificacion), $PRINCIPAL);
    return ($PRINCIPAL);
}
function FormularioPost($PRINCIPAL, $id_mp, $id_empresa)
{
    $unico = com_mp_full_data($id_empresa, $id_mp);
    if ($unico) {
        $PRINCIPAL = str_replace("{VALOR_BOTON}", "Editar Publicacion", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ACTION}", "com_mp_edit_post", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_MP}", Encodear3($id_mp), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{VALOR_BOTON}", "Publicar", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ACTION}", "com_mp_save_post", $PRINCIPAL);
    }
    $PRINCIPAL          = str_replace("{TITULO}", utf8_encode($unico[0]->nombre), $PRINCIPAL);
    $PRINCIPAL          = str_replace("{LINK_YOUTUBE}", utf8_encode($unico[0]->video), $PRINCIPAL);
    //$PRINCIPAL = str_replace("{LINK_DOCUMENTO}",utf8_encode($unico[0]->archivo),$PRINCIPAL);
    $PRINCIPAL          = str_replace("{LINK_DOCUMENTO}", utf8_encode($unico[0]->url_documento), $PRINCIPAL);
    $PRINCIPAL          = str_replace("{FUENTE}", utf8_encode($unico[0]->fuente), $PRINCIPAL);
    $PRINCIPAL          = str_replace("{CONTENIDO}", utf8_encode($unico[0]->contenido), $PRINCIPAL);
    $PRINCIPAL          = str_replace("{RESUMEN}", utf8_encode($unico[0]->resumen), $PRINCIPAL);
    $PRINCIPAL          = str_replace("{SELECT_" . utf8_encode($unico[0]->tipo) . "}", "selected='selected'", $PRINCIPAL);
    $tags               = TagsPorMPEmpresa($id_mp, $id_empresa);
    $arreglo_tags       = "";
    $contador           = 1;
    $categorias_mp      = TraeCategoriasMejoresPracticas($id_empresa);
    $options_categorias = "";
    foreach ($categorias_mp as $cat) {
        if ($unico[0]->id_categoria == $cat->id_categoria) {
            $options_categorias .= "<option value='" . $cat->id_categoria . "' selected='selected'>" . $cat->categoria . "</option>";
        } else {
            $options_categorias .= "<option value='" . $cat->id_categoria . "'>" . $cat->categoria . "</option>";
        }
    }
    $array_MP_template = MP_BuscaTemplate($rut, $id_empresa);
    if ($array_MP_template[0]->template <> '') {
        $template = $array_MP_template[0]->template . "";
    } else {
        $template = "";
    }
    $ambitos_mp      = TraeAmbitosMejoresPracticas($id_empresa, $template);
    $options_ambitos = "";
    $options_ambitos .= "<option value=''>[ SELECCIONA ]</option>";
    foreach ($ambitos_mp as $ambito) {
        if ($unico[0]->id_ambito == $ambito->id_ambito) {
            $options_ambitos .= "<option value='" . $ambito->id_ambito . "' selected='selected'>" . $ambito->ambito . "</option>";
        } else {
            $options_ambitos .= "<option value='" . $ambito->id_ambito . "'>" . $ambito->ambito . "</option>";
        }
    }
    $PRINCIPAL = str_replace("{CATEGORIAS}", utf8_encode($options_categorias), $PRINCIPAL);
    $PRINCIPAL = str_replace("{AMBITOS}", utf8_encode($options_ambitos), $PRINCIPAL);
    foreach ($tags as $tg) {
        $arreglo_tags .= "#" . $tg->tag;
        if ($contador < count($tags)) {
            $arreglo_tags .= " ";
        }
        $contador++;
    }
    $PRINCIPAL = str_replace("{TAGS_MP}", utf8_encode($arreglo_tags), $PRINCIPAL);
    return ($PRINCIPAL);
}
function FormularioPostPregunta($PRINCIPAL, $id_mp, $id_empresa)
{
    $unico = com_mp_full_data($id_empresa, $id_mp);
    if ($unico) {
        $PRINCIPAL = str_replace("{VALOR_BOTON}", "Editar Pregunta", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ACTION}", "com_mp_edit_post_question", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_MP}", Encodear3($id_mp), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{VALOR_BOTON}", "Preguntar", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ACTION}", "com_mp_save_post_question", $PRINCIPAL);
    }
    $PRINCIPAL          = str_replace("{TITULO}", utf8_encode($unico[0]->nombre), $PRINCIPAL);
    $PRINCIPAL          = str_replace("{CONTENIDO}", utf8_encode($unico[0]->contenido), $PRINCIPAL);
    $PRINCIPAL          = str_replace("{RESUMEN}", utf8_encode($unico[0]->resumen), $PRINCIPAL);
    $contador           = 1;
    $categorias_mp      = TraeCategoriasMejoresPracticas($id_empresa);
    $options_categorias = "";
    foreach ($categorias_mp as $cat) {
        if ($unico[0]->id_categoria == $cat->id_categoria) {
            $options_categorias .= "<option value='" . $cat->id_categoria . "' selected='selected'>" . $cat->categoria . "</option>";
        } else {
            $options_categorias .= "<option value='" . $cat->id_categoria . "'>" . $cat->categoria . "</option>";
        }
    }
    $array_MP_template = MP_BuscaTemplate($rut, $id_empresa);
    if ($array_MP_template[0]->template <> '') {
        $template = $array_MP_template[0]->template . "";
    } else {
        $template = "";
    }
    $ambitos_mp      = TraeAmbitosMejoresPracticas($id_empresa, $template);
    $options_ambitos = "";
    $options_ambitos .= "<option value='' >[ SELECCIONA ]</option>";
    foreach ($ambitos_mp as $ambito) {
        if ($unico[0]->id_ambito == $ambito->id_ambito) {
            $options_ambitos .= "<option value='" . $ambito->id_ambito . "' selected='selected'>" . $ambito->ambito . "</option>";
        } else {
            $options_ambitos .= "<option value='" . $ambito->id_ambito . "'>" . $ambito->ambito . "</option>";
        }
    }
    $PRINCIPAL = str_replace("{CATEGORIAS}", utf8_encode($options_categorias), $PRINCIPAL);
    $PRINCIPAL = str_replace("{AMBITOS}", utf8_encode($options_ambitos), $PRINCIPAL);
    return ($PRINCIPAL);
}
function resumir($texto, $limite, $car=".", $final="…")
{
if(strlen($texto) <= $limite) return $texto;
  if(false !== ($breakpoint = strpos($texto, $car, $limite)))
  {
   $val=strlen($texto)-1;
   if( $breakpoint < $val)
   {
    $texto= substr($texto, 0, $breakpoint) . $final;
   }
  }
return $texto;
}
function ColocaListadoSesionesPorImparticion($PRINCIPAL, $rut, $id_imparticion, $id_empresa)
{
    $sesiones = TraeSesionesPorImparticion2($id_empresa, $id_imparticion);
    //echo "<pre>";
    //print_r($sesiones);
    foreach ($sesiones as $sesion) {
        $sesion_fecha        = date("d-m-Y", strtotime($sesion->fecha));
        $hoy                 = date("Y-m-d");
        $fecha_ses           = $sesion->fecha;
        //echo "<br>$hoy $fecha_ses _ ";
        //echo " - $rut, $id_imparticion, $id_empresa, $sesion->id";
        $EstaChequeadoSesion = VerificaSesionChequeado($rut, $id_imparticion, $id_empresa, $sesion->id);
        //echo "<br>";    echo $EstaChequeadoSesion[0]->cuenta;
        $Iconocheck          = "";
        if ($EstaChequeadoSesion[0]->cuenta == 1) {
            $Iconocheck = "<i class='icon-check icons'></i>";
        }
        //echo
        if ($fecha_ses > $hoy) {
            //echo  "1";
            //verifica si está o no chequear
            $boton_checkin = "    <center>Falta aún tiempo para que te chequees en esta sesión</center>";
        } elseif ($fecha_ses == $hoy) {
            //echo "2";
            //aparece boton chequear
            $boton_checkin = "    <center>
                <a href='?sw=CI_registraUsuarioCurso&buscacodigo={CODIGO_IMPARTICION}&idse={IDSESION}&fec=" . $fecha_ses . "' class='btn btn-success btn-block '>
                <span class='blanco'> $Iconocheck Hacer Check In </span></a>
            </center>";
        } elseif ($fecha_ses < $hoy) {
            //echo "3";
            //boton Ingresar
            $boton_checkin = "
                <a href='?sw=CI_registraUsuarioCurso&buscacodigo={CODIGO_IMPARTICION}&idse={IDSESION}&fec=" . $fecha_ses . "''
                 class='btn btn-success'>
                    <span class='blanco'> $Iconocheck Ingresar </span></a>
            ";
        }
        $row .= file_get_contents("views/checkin/CI_row_entorno_home_codigo.html");
        $row = str_replace("{FECHA}", $sesion_fecha, $row);
        $row = str_replace("{BOTON_CHECKIN}", $boton_checkin, $row);
        $row = str_replace("{CODIGO_IMPARTICION}", Encodear3($sesion->codigo_inscripcion), $row);
        $row = str_replace("{IDSESION}", $sesion->id, $row);
        $row = str_replace("{NOMBRE_RELATOR}", $sesion->nombre_relator, $row);
    }
    $PRINCIPAL = str_replace("{ROW_LISTADO_CHECKINS}", $row, $PRINCIPAL);
    return ($PRINCIPAL);
}
//Muestra fecha tipo Facebook
function nicetime($date)
{
    if (empty($date)) {
        return "No hay fecha que mostrar";
    }
    $periods   = array(
        "segundo",
        "minuto",
        "hora",
        "dia",
        "semana",
        "mes",
        "año",
        "decada"
    );
    $lengths   = array(
        "60",
        "60",
        "24",
        "7",
        "4.35",
        "12",
        "10"
    );
    $now       = time();
    $unix_date = strtotime($date);
    // check validity of date
    if (empty($unix_date)) {
        return "Bad date";
    }
    // is it future date or past date
    if ($now > $unix_date) {
        $difference = $now - $unix_date;
        $tense      = "hace";
    } else {
        $difference = $unix_date - $now;
        $tense      = "from now";
    }
    for ($j = 0; $difference >= $lengths[$j] && $j < count($lengths) - 1; $j++) {
        $difference /= $lengths[$j];
    }
    $difference = round($difference);
    if ($difference != 1) {
        $periods[$j] .= "s";
    }
    return "<span class=\"mini\">{$tense}</span><span class=\"big\"> $difference </span><span class=\"mini\">$periods[$j]</span> ";
}
function limit_words($string, $word_limit)
{
    $words = explode(" ",$string);
    return implode(" ",array_splice($words,0,$word_limit));
}
function ColocaDatosPuntosMedallas($PRINCIPAL, $id_empresa, $rut)
{
    $total_medallas = TotalMedalasPorRutEmpresa($rut, $id_empresa);
    $PRINCIPAL      = str_replace("{MEDALLASGANADOS}", $total_medallas[0]->total_medallas, $PRINCIPAL);
    $total_Niveles  = NivelesFinalizadosSinMalla($rut, $id_empresa);
    $PRINCIPAL      = str_replace("{SELLOSGANADOS}", count($total_Niveles), $PRINCIPAL);
    return ($PRINCIPAL);
}
function colocaVideosPorObjeto($id_objeto, $rut, $id_empresa, $pagina, $id_malla)
{
    //echo "$id_objeto, $id_empresa, $pagina, $id_malla)";
    $imagenes = VideosPorObjetoPorMalla($id_objeto, $id_empresa, $pagina, $id_malla);
    $j        = 1;
    foreach ($imagenes as $img) {
        if ($j == 1) {
            $row_html .= "<div class=''>";
        }
        $row_html .= file_get_contents("views/cursos/objetos/subirVideos/" . $id_empresa . "_lista_archivos.html");
        if ($j == 3) {
            $row_html .= "</div>";
            $j = 1;
        } else {
            $j++;
        }
        $figura   = '<a href="galeria/' . $img->archivo . '" title="' . $img->descripcion . '" onclick="vista_galeria(' . $img->id . ')"  data-gallery><img src="img/objetos/' . $img->archivo . '""></a>';
        $row_html = str_replace("{BLOQUE_PARA_VIDEO}", file_get_contents("videosCap/index_galeria_videos.php"), $row_html);
        $row_html = str_replace("{FIGURA}", $figura, $row_html);
        $row_html = str_replace("{URL_IMAGEN_ARCHIVO}", "img/objetos/" . $img->archivo . "", $row_html);
        $row_html = str_replace("{NOMBRE_VIDEO_MP4}", "img/objetos/" . $img->archivo . "", $row_html);
        $row_html = str_replace("{DESCRIPCION}", utf8_encode($img->nombre_completo), $row_html);
        $row_html = str_replace("{NOMBRE_PERSONA}", utf8_encode($img->nombre_completo), $row_html);
        $row_html = str_replace("{COMENTARIO}", utf8_encode($img->comentarios), $row_html);
        $row_html = str_replace("{URL_IMAGEN_PERSONA}", VerificaFotoPersonal($img->rut_autor), $row_html);
        $row_html = str_replace("{TITULO_VIDEO}", ($img->titulo_video), $row_html);
        $row_html = str_replace("{DESCRIPCION_VIDEO}", ($img->descripcion_video), $row_html);
        $row_html = str_replace("{IDVIDEO}", ($img->id), $row_html);
        if ($img->rut_autor == $rut) {
            $row_html = str_replace("{MEGUSTA}", ColocaMeGusta($img->id, "id_imagen_galeria", $id_empresa, $rut, "autor"), $row_html);
            $row_html = str_replace("{DELETE}", file_get_contents("views/cursos/objetos/subirVideos/" . $id_empresa . "_delete_imagen.html"), $row_html);
            $row_html = str_replace("{ID_IMAGEN_ENCODEADA}", Encodear3($img->id), $row_html);
        } else {
            $row_html = str_replace("{MEGUSTA}", ColocaMeGusta($img->id, "id_imagen_galeria", $id_empresa, $rut), $row_html);
            $row_html = str_replace("{DELETE}", "", $row_html);
        }
        $row_html = str_replace("{VISITAS}", 0, $row_html);
    }
    if ($j == 2 or $j == 3) {
        $row_html .= "</div>";
    }
    return ($row_html);
}
function ColocaBloqueMasMeGustaVideos($PRINCIPAL, $id_objeto, $id_malla)
{
    //obtengo comentarios dado id_objeto
    //$total_galerias=ObtenerFotosMasMegusta($id_objeto, $_SESSION["id_empresa"]);
    $total_galerias = ObtenerVideosMasMegusta($_SESSION["id_empresa"]);
    if ($total_galerias) {
        foreach ($total_galerias as $arch) {
            $row_html .= file_get_contents("views/cursos/objetos/subirVideos/lista_archivos_bloque.html");
            $row_html = str_replace("{URL_IMAGEN_ARCHIVO}", $arch->archivo, $row_html);
            $row_html = str_replace("{URL_IMAGEN_PERSONA}", VerificaFotoPersonal($arch->rut_autor), $row_html);
            $row_html = str_replace("{DESCRIPCION}", ($arch->nombre_completo), $row_html);
            $row_html = str_replace("{NOMBRE_PERSONA}", ($arch->nombre_completo), $row_html);
            $row_html = str_replace("{TITULO_VIDEO}", ($arch->titulo_video), $row_html);
            $row_html = str_replace("{DESCRIPCION_VIDEO}", ($arch->descripcion_video), $row_html);
            $row_html = str_replace("{IDVIDEO}", ($arch->id), $row_html);
            $row_html = str_replace("{MEGUSTA}", ColocaMeGusta($arch->id, "id_imagen_galeria", $_SESSION["id_empresa"], $arch->rut_autor, "autor", $id_objeto), $row_html);
        }
        $PRINCIPAL = str_replace("{BLOQUEVIDEOSPOPULARES}", utf8_encode($row_html), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BLOQUEVIDEOSPOPULARES}", "", $PRINCIPAL);
    }
    return ($PRINCIPAL);
}
function ColocaImagenPost($url_imagen)
{
    if ($url_imagen <> '') {
        $template_imagen = file_get_contents("views/comunidad_mp/com_imagen.html");
        $template_imagen = str_replace("{URL_IMAGEN_FONDO}", $url_imagen, $template_imagen);
    } else {
        $template_imagen = "";
    }
    return ($template_imagen);
}
function ellipsis($str, $len = 50)
{
    return strlen($str) > $len ? substr($str, 0, $len) . '...' : $str;
}
function rutemailaarroba($rut, $id_empresa){

    //echo "$rut, $id_empresa";

        $email  = TraeEmailUsuario($rut, $id_empresa);
        $arr_email= explode("@", $email);
        $nombre_email=$arr_email[0];
        $nombre="@".$nombre_email;

        return $nombre;

    }
function com_vota_reconoce_home($PRINCIPAL, $id_empresa, $rut, $ord_by, $filt_by, $filt_cat, $vp, $tag, $rut_enviado, $id_categoria)
{
    //BUSCADATOSPERSONALES CANJES
    //$puntos_usuario  = premios_buscadatos($rut, $id_empresa);
    //print_r($puntos_usuario);
    $PRINCIPAL       = str_replace("{TOTAL_PUNTOS_RECIBIDOS}", ($puntos_usuario[0]->puntosrecibidos), $PRINCIPAL);
    $PRINCIPAL       = str_replace("{TOTAL_MEDALLAS_RECIBIDAS}", ($puntos_usuario[0]->puntosrecibidos), $PRINCIPAL);

    $PRINCIPAL       = str_replace("{TOTAL_PUNTOS_CANJEADOS}", ($puntos_usuario[0]->puntoscanjeados), $PRINCIPAL);
    $PRINCIPAL       = str_replace("{TOTAL_PUNTOS_SALDOS}", ($puntos_usuario[0]->puntossaldo), $PRINCIPAL);
    $candidato_form  = "";
    $candidato_datos = "";
    if ($rut_enviado == "") {
        $candidato_form = file_get_contents("views/reconoce_vota/" . $id_empresa . "_row_buscacandidato.html");
    }
    $limit = 3;
    //$listado_mas=MPObtengoMasInteracciones($id_empresa, "ROW_CANDIDATO_DATOS", $limit);
    //$total_listado_mas_master="";
    if ($rut_enviado <> "") {
        $array_Reco_Gracias = BuscaDatosReconocimientoAgradecimientos($rut_enviado, $id_empresa);
        if ($array_Reco_Gracias[0]->num_gracias > 0) {
            $num_gracias = $array_Reco_Gracias[0]->num_gracias;
        } else {
            $num_gracias = 0;
        }
        if ($array_Reco_Gracias[0]->num_reconocimientos > 0) {
            $num_reconocimientos = $array_Reco_Gracias[0]->num_reconocimientos;
        } else {
            $num_reconocimientos = 0;
        }
        $candidato_datos .= file_get_contents("views/reconoce_vota/" . $id_empresa . "_row_candidato.html");
        $datos_usuario   = UsuarioEnBasePersonas($rut_enviado);
        $candidato_datos = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($rut_enviado), $candidato_datos);
        $candidato_datos = str_replace("{NOMBRE_AUTOR}", ($datos_usuario[0]->nombre_completo), $candidato_datos);
        $candidato_datos = str_replace("{CARGO_AUTOR}", ($datos_usuario[0]->cargo), $candidato_datos);
        $candidato_datos = str_replace("{NUM_GRACIAS}", ($num_gracias), $candidato_datos);
        $candidato_datos = str_replace("{NUM_RECONOCIMIENTO}", ($num_reconocimientos), $candidato_datos);
    }
    //$listado_mas                  = Vota_Reconocimiento_Interacciones($id_empresa, "REC_MAS_AGRACIADOS", $limit);
    $total_listado_mas_agraciados = "";
    foreach ($listado_mas as $listado_mas_unico) {
        $total_listado_mas_agraciados .= file_get_contents("views/reconoce_vota/" . $id_empresa . "_row_participantes_mas.html");
        $datos_usuario                = UsuarioEnBasePersonas($listado_mas_unico->rut);
        $total_listado_mas_agraciados = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($listado_mas_unico->rut), $total_listado_mas_agraciados);
        $total_listado_mas_agraciados = str_replace("{NOMBRE}", ($datos_usuario[0]->nombre_completo), $total_listado_mas_agraciados);
        $total_listado_mas_agraciados = str_replace("{NUM}", ($listado_mas_unico->cuenta), $total_listado_mas_agraciados);
        $total_listado_mas_agraciados = str_replace("{NUMTEXT}", " Pr&aacute;cticas Publicadas", $total_listado_mas_agraciados);
        $total_listado_mas_agraciados = str_replace("{TEXTO}", "<br>" . $listado_mas_unico->cuenta, $total_listado_mas_agraciados);
        $total_listado_mas_agraciados = str_replace("{RECONOCIMIENTO}", " <i class='-plaindivcenter nobottommargin far fa-heart'></i> ", $total_listado_mas_agraciados);
        $link                         = "?sw=listMejPrac&filt_by=" . $datos_usuario[0]->rut . "&vp=1#lista";
        $total_listado_mas_agraciados = str_replace("{LINK}", $link, $total_listado_mas_agraciados);
    }
    //$listado_mas                  = Vota_Reconocimiento_Interacciones($id_empresa, "REC_MR_MRS_GRACIAS", $limit);
    $total_listado_mas_mr_gracias = "";
    foreach ($listado_mas as $listado_mas_unico) {
        $total_listado_mas_mr_gracias .= file_get_contents("views/reconoce_vota/" . $id_empresa . "_row_participantes_mas.html");
        $datos_usuario                = UsuarioEnBasePersonas($listado_mas_unico->rut);
        $total_listado_mas_mr_gracias = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($listado_mas_unico->rut), $total_listado_mas_mr_gracias);
        $total_listado_mas_mr_gracias = str_replace("{NOMBRE}", ($datos_usuario[0]->nombre_completo), $total_listado_mas_mr_gracias);
        $total_listado_mas_mr_gracias = str_replace("{NUM}", ($listado_mas_unico->cuenta), $total_listado_mas_mr_gracias);
        $total_listado_mas_mr_gracias = str_replace("{NUMTEXT}", " Pr&aacute;cticas Publicadas", $total_listado_mas_mr_gracias);
        $total_listado_mas_mr_gracias = str_replace("{TEXTO}", "<br>" . $listado_mas_unico->cuenta, $total_listado_mas_mr_gracias);
        $total_listado_mas_mr_gracias = str_replace("{RECONOCIMIENTO}", " <i class='-plaindivcenter nobottommargin far fa-heart'></i> ", $total_listado_mas_mr_gracias);
        $link                         = "?sw=listMejPrac&filt_by=" . $datos_usuario[0]->rut . "&vp=1#lista";
        $total_listado_mas_mr_gracias = str_replace("{LINK}", $link, $total_listado_mas_mr_gracias);
    }
    //$listado_mas                     = Vota_Reconocimiento_Interacciones($id_empresa, "REC_MAS_RECONOCEDORES", $limit);
    //print_r($listado_mas);
    $total_listado_mas_reconocedores = "";
    foreach ($listado_mas as $listado_mas_unico) {
        $total_listado_mas_reconocedores .= file_get_contents("views/reconoce_vota/" . $id_empresa . "_row_participantes_mas.html");
        $datos_usuario                   = UsuarioEnBasePersonas($listado_mas_unico->rut);
        $total_listado_mas_reconocedores = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($listado_mas_unico->rut), $total_listado_mas_reconocedores);
        $total_listado_mas_reconocedores = str_replace("{NOMBRE}", ($datos_usuario[0]->nombre_completo), $total_listado_mas_reconocedores);
        $total_listado_mas_reconocedores = str_replace("{NUM}", ($listado_mas_unico->cuenta), $total_listado_mas_reconocedores);
        $total_listado_mas_reconocedores = str_replace("{NUMTEXT}", " Pr&aacute;cticas Publicadas", $total_listado_mas_reconocedores);
        $total_listado_mas_reconocedores = str_replace("{TEXTO}", "<br>" . $listado_mas_unico->cuenta, $total_listado_mas_reconocedores);
        $total_listado_mas_reconocedores = str_replace("{RECONOCIMIENTO}", " <i class='-plaindivcenter nobottommargin far fa-heart'></i> ", $total_listado_mas_reconocedores);
        $link                            = "?sw=listMejPrac&filt_by=" . $datos_usuario[0]->rut . "&vp=1#lista";
        $total_listado_mas_reconocedores = str_replace("{LINK}", $link, $total_listado_mas_reconocedores);
    }
    //$listado_recientes       = Vota_Reconocimiento_Interacciones($id_empresa, "REC_RECIENTES", $limit);
    $total_listado_recientes = "";
    foreach ($listado_recientes as $listado_recientes_unico) {
        $total_listado_recientes .= file_get_contents("views/reconoce_vota/" . $id_empresa . "_row_participantes_rec.html");
        $datos_usuario           = UsuarioEnBasePersonas($listado_recientes_unico->rut);
        $total_listado_recientes = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($listado_recientes_unico->rut), $total_listado_recientes);
        $total_listado_recientes = str_replace("{NOMBRE}", ($datos_usuario[0]->nombre_completo), $total_listado_recientes);
        $total_listado_recientes = str_replace("{NUM}", ($listado_recientes_unico->cuenta), $total_listado_recientes);
        $total_listado_recientes = str_replace("{NUMTEXT}", " Pr&aacute;cticas Publicadas", $total_listado_recientes);
        $total_listado_recientes = str_replace("{TEXTO}", " fue reconocido por ", $total_listado_recientes);
        $total_listado_recientes = str_replace("{RECONOCIMIENTO}", "Compromiso", $total_listado_recientes);
        $link                    = "?sw=listMejPrac&filt_by=" . $datos_usuario[0]->rut . "&vp=1#lista";
        $total_listado_recientes = str_replace("{LINK}", $link, $total_listado_recientes);
    }
    //$listado_valores       = Vota_Reconocimiento_Interacciones($id_empresa, "REC_VALORES", $limit);
    $total_listado_valores = "";
    foreach ($listado_valores as $listado_valores_unico) {
        $total_listado_valores .= file_get_contents("views/reconoce_vota/" . $id_empresa . "_row_vista_valores.html");
        $total_listado_valores = str_replace("{NUMERO}", $listado_valores_unico->cuenta, $total_listado_valores);
        $total_listado_valores = str_replace("{VALOR}", utf8_encode($listado_valores_unico->categoria), $total_listado_valores);
        $total_listado_valores = str_replace("{PORCENTAJE}", ($listado_valores_unico->porcentaje), $total_listado_valores);
    }
    $PRINCIPAL              = str_replace("{INSIGNIA}", "", $PRINCIPAL);
    $PRINCIPAL              = str_replace("{ROW_LISTADO_TIMELINE_PERSONAL}", utf8_encode($total_listado), $PRINCIPAL);
    $PRINCIPAL              = str_replace("{ROW_POST_RECENTS}", utf8_encode($total_posteos_recents), $PRINCIPAL);
    $PRINCIPAL              = str_replace("{ROW_PEOPLE_INTERESTING}", utf8_encode($total_people_interesting), $PRINCIPAL);
    $PRINCIPAL              = str_replace("{AGRUPACION_CATEGORIAS}", utf8_encode($total_agrup_categoria), $PRINCIPAL);
    $PRINCIPAL              = str_replace("{AGRUPACION_AMBITOS}", utf8_encode($total_agrup_ambito), $PRINCIPAL);
    $PRINCIPAL              = str_replace("{REC_RECIENTES}", utf8_encode($total_listado_recientes), $PRINCIPAL);
    $PRINCIPAL              = str_replace("{REC_MAS_AGRACIADOS}", utf8_encode($total_listado_mas_agraciados), $PRINCIPAL);
    $PRINCIPAL              = str_replace("{REC_MR_MRS_GRACIAS}", utf8_encode($total_listado_mas_mr_gracias), $PRINCIPAL);
    $PRINCIPAL              = str_replace("{REC_MAS_RECONOCEDORES}", utf8_encode($total_listado_mas_reconocedores), $PRINCIPAL);
    $PRINCIPAL              = str_replace("{REC_VALORES}", utf8_encode($total_listado_valores), $PRINCIPAL);
    $limit                  = 10;
    //MIS ULTIMOS CANJES
    //$data_premios_canjes    = premios_ultimos_canjes($id_empresa, $rut, $limit);
    $listado_ultimos_canjes = "";
    //print_r($data_premios_canjes);
    foreach ($data_premios_canjes as $data_premio_canje) {
        $listado_ultimos_canjes .= file_get_contents("views/reconoce_vota/" . $id_empresa . "_row_premios_ultimos_canjes.html");
        if ($data_premio_canje->estadovalidacion == '2') {
            $alerta = "<div class='alert alert-warning' role='alert'>  <strong>Canje Pendiente!</strong> Tu jefe aun no valida el Canje.</div>";
        } elseif ($data_premio_canje->estadovalidacion == '1') {
            $alerta = "";
        }
        $listado_ultimos_canjes = str_replace("{NOMBRE_PREMIO}", ($data_premio_canje->nombre_premio), $listado_ultimos_canjes);
        $listado_ultimos_canjes = str_replace("{FECHA_CANJE}", ($data_premio_canje->fecha_texto), $listado_ultimos_canjes);
        $listado_ultimos_canjes = str_replace("{HORA_INICIO}", ($data_premio_canje->hora_inicio), $listado_ultimos_canjes);
        $listado_ultimos_canjes = str_replace("{HORA_TERMINO}", ($data_premio_canje->hora_termino), $listado_ultimos_canjes);
        $listado_ultimos_canjes = str_replace("{PUNTOS_CANJEADOS}", ($data_premio_canje->puntos), $listado_ultimos_canjes);
        $listado_ultimos_canjes = str_replace("{ALERTA_PENDIENTE}", ($alerta), $listado_ultimos_canjes);
    }
    $PRINCIPAL                = str_replace("{ULTIMOSCANJES}", utf8_encode($listado_ultimos_canjes), $PRINCIPAL);
    //MIS ULTIMOS PUNTOS RECIBIDOS
   // $data_puntos_recibidos    = premios_ultimos_puntos_recibidos($id_empresa, $rut, $limit);
    $listado_puntos_recibidos = "";
    //print_r($data_premios_canjes);
    foreach ($data_puntos_recibidos as $data_punto_recibido) {
        $listado_puntos_recibidos .= file_get_contents("views/reconoce_vota/" . $id_empresa . "_row_puntos_ultimos_recibidos.html");
        $listado_puntos_recibidos = str_replace("{FECHA_RECIBIDO}", ($data_punto_recibido->fecha), $listado_puntos_recibidos);
        $listado_puntos_recibidos = str_replace("{PUNTOS_RECIBIDOS}", ($data_punto_recibido->puntos), $listado_puntos_recibidos);
    }
    $PRINCIPAL               = str_replace("{PUNTOSRECIBIDOS}", utf8_encode($listado_puntos_recibidos), $PRINCIPAL);
    //MIS RANKING PREMIOS GLOBALES
    //$data_ranking_premios    = premios_ranking_canjes($id_empresa, $limit);
    $listado_ranking_premios = "";
    foreach ($data_ranking_premios as $data_ranking_premio) {
        $listado_ranking_premios .= file_get_contents("views/reconoce_vota/" . $id_empresa . "_row_premios_ranking.html");
        $listado_ranking_premios = str_replace("{NOMBRE_PREMIO}", ($data_ranking_premio->nombre_premio), $listado_ranking_premios);
        $listado_ranking_premios = str_replace("{NUMERO_VECES_CANJEADO}", ($data_ranking_premio->cuenta), $listado_ranking_premios);
    }
    $PRINCIPAL                       = str_replace("{RANKINGCANJESGLOBALES}", utf8_encode($listado_ranking_premios), $PRINCIPAL);
    //MIS ULTIMOS CANJES GLOBALES PREMIOS GLOBALES
    //$data_ultimos_canjes_globales    = premios_ultimos_canjes_globales($id_empresa, $limit);
    //print_r($data_ultimos_canjes_globales);
    $listado_ultimos_canjes_globales = "";
    foreach ($data_ultimos_canjes_globales as $data_ultimo_canjes_global) {
        $listado_ultimos_canjes_globales .= file_get_contents("views/reconoce_vota/" . $id_empresa . "_row_premios_ultimos_canjes_globales.html");
        $listado_ultimos_canjes_globales = str_replace("{NOMBRE_PREMIO}", ($data_ultimo_canjes_global->nombre_premio), $listado_ultimos_canjes_globales);
        $listado_ultimos_canjes_globales = str_replace("{FECHA_CANJE}", ($data_ultimo_canjes_global->fecha), $listado_ultimos_canjes_globales);
    }
    $PRINCIPAL = str_replace("{ULTIMOSCANJESGLOBALES}", utf8_encode($listado_ultimos_canjes_globales), $PRINCIPAL);
    $PRINCIPAL = str_replace("{HIDDER_CANDIDATO}", Encodear5($rut_enviado), $PRINCIPAL);
    $PRINCIPAL = str_replace("{ROW_CANDIDATO_DATOS}", utf8_encode($candidato_datos), $PRINCIPAL);
    $PRINCIPAL = str_replace("{ROW_CANDIDATO_FORM}", utf8_encode($candidato_form), $PRINCIPAL);
    return ($PRINCIPAL);
}
function arrayUnique($array, $preserveKeys = false)
{
    // Unique Array for return
    $arrayRewrite = array();
    // Array with the md5 hashes
    $arrayHashes  = array();
    foreach ($array as $key => $item) {
        // Serialize the current element and create a md5 hash
        $hash = md5(serialize($item));
        // If the md5 didn't come up yet, add the element to
        // to arrayRewrite, otherwise drop it
        if (!isset($arrayHashes[$hash])) {
            // Save the current element hash
            $arrayHashes[$hash] = $hash;
            // Add element to the unique Array
            if ($preserveKeys) {
                $arrayRewrite[$key] = $item;
            } else {
                $arrayRewrite[] = $item;
            }
        }
    }
    return $arrayRewrite;
}
function Reconocer_personal_lista($PRINCIPAL, $id_empresa, $rut, $ord_by, $filt_by, $filt_cat, $vp, $tag, $rut_enviado, $tipo_query, $ambiente, $start_limit, $subcategoria)
{
    if ($rut_enviado <> '') {
        $Rut_Perfil = $rut_enviado;
    } else {
        $Rut_Perfil = $rut;
    }
    $array_MP_template = MP_BuscaTemplate($rut, $id_empresa);
    if ($array_MP_template[0]->template <> '') {
        $template = $array_MP_template[0]->template . "/";
    } else {
        $template = "";
    }
    if ($tipo_query <> '') {
        $todas                                  = com_mp_resultados_inteligentes($id_empresa, $tipo_query, "", $ambiente, $subcategoria);
        $total_listado_post_personas_resultados = "";
        foreach ($todas as $unico) {
            $tpi++;
            //print_r($unico);
            $guardo_codigo[$tpi] = $unico->codigo;
            $total_listado_post_personas_resultados .= file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_row_com_mp_persona_listado_tipoE_Reconoce.html");
            $total_listado_post_personas_resultados = str_replace("{HUINCHA_INTERACCIONES}", "", $total_listado_post_personas_resultados);
            $datos_interaccion_personal             = TraeBuscaInteraccionPersonal($unico->codigo, $id_empresa);
            if ($datos_interaccion_personal[0]->numbcicoins == "") {
                $num_coins = 0;
            } else {
                $num_coins = $datos_interaccion_personal[0]->numbcicoins;
            }
            if ($datos_interaccion_personal[0]->numaptitudesvalidadas == "") {
                $num_aptitudes = 0;
            } else {
                $num_aptitudes = $datos_interaccion_personal[0]->numaptitudesvalidadas;
            }
            if ($datos_interaccion_personal[0]->numpublicaciones == "") {
                $num_publicaciones = 0;
            } else {
                $num_publicaciones = $datos_interaccion_personal[0]->numpublicaciones;
            }
            if ($datos_interaccion_personal[0]->numseguidores == "") {
                $num_seguidores = 0;
            } else {
                $num_seguidores = $datos_interaccion_personal[0]->numseguidores;
            }
            $total_listado_post_personas_resultados = str_replace("{NUM_BCICOINS}", $num_coins, $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{NUM_SEGUIDORES}", $num_seguidores, $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{NUM_SEGUIDOS}", $datos_interaccion_personal[0]->numseguidos, $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{NUM_PUBLICACIONES}", $num_publicaciones, $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{NUM_MEGUSTA_FAVORITAS}", $datos_interaccion_personal[0]->nummegustafavorita, $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{NUM_VISITAS}", $datos_interaccion_personal[0]->numvisitas, $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{NUM_COMENTARIOS}", $datos_interaccion_personal[0]->numcomentarios, $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{NUM_APTITUDESVALIDADAS}", $num_aptitudes, $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{NUM_PUBLICACIONESSEGUIDAS}", $datos_interaccion_personal[0]->publicacionesseguidas, $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{NUM_INTERACCIONES}", $datos_interaccion_personal[0]->numinteracciones, $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{RUTEXPERTO}", $unico->codigo, $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{CARGO_EXPERTO}", $unico->cargo_experto, $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{NOMBRE_EXPERTO}", $unico->nombre_experto, $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($unico->codigo), $total_listado_post_personas_resultados);
            if ($unico->tipo == "MejorPractica") {
                $ico = "img/bci_mp_practica_icon.png";
            }
            if ($unico->tipo == "Papers") {
                $ico = "img/bci_mp_paper_icon.png";
            }
            if ($unico->tipo == "Publicacion") {
                $ico = "img/bci_mp_publicacion.png";
            }
            if ($unico->tipo == "Video" or $unico->tipo == "VideoInterno") {
                $ico = "img/bci_mp_practica_video.png";
            }
            if ($unico->tipo == "Links" or $unico->tipo == "LinkExterno") {
                $ico = "img/bci_mp_link_icon.png";
            }
            if ($unico->tipo == "Experiencias") {
                $ico = "img/bci_mp_experiencias_icon.png";
            }
            if ($unico->tipopost == "expertos") {
                $ico = "img/bci_mp_experto_icon.png";
            }
            if ($unico->tipo == "OportunidadMejora") {
                $ico = "img/bci_mp_oportunidadmejora_icon.png";
            }
            if ($unico->tipo == "Udnolohaga") {
                $ico = "img/bci_mp_udnolohaga_icon.png";
            }
            if ($unico->tipo == "RRPP") {
                $ico = "img/bci_mp_rrpp_icon.png";
            }
            if ($unico->tipo == "Pregunta") {
                $ico = "img/bci_mp_pregunta_icon.png";
            }
            if ($unico->tipo == "Respuesta") {
                $ico = "img/bci_mp_pregunta_icon.png";
            }
            $array_Reco_Gracias = BuscaDatosReconocimientoAgradecimientos($unico->codigo, $id_empresa);
            if ($array_Reco_Gracias[0]->num_gracias > 0) {
                $num_gracias = $array_Reco_Gracias[0]->num_gracias;
            } else {
                $num_gracias = 0;
            }
            if ($array_Reco_Gracias[0]->num_reconocimientos > 0) {
                $num_reconocimientos = $array_Reco_Gracias[0]->num_reconocimientos;
            } else {
                $num_reconocimientos = 0;
            }
            $total_listado_post_personas_resultados = str_replace("{NUM_GRACIAS}", ($num_gracias), $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{NUM_RECONOCIMIENTOS}", ($num_reconocimientos), $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{NOMBRE_MENTOR}", ($mentor), $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{ICONO}", $ico, $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{DESC_ICONO}", $unico->tipo, $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{HUINCHA_INTERACCIONES}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_huincha_interacciones.html"), $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = ColocaCantidadDeFavorito($total_listado_post_personas_resultados, $unico->id_mp, $id_empresa);
            $total_listado_post_personas_resultados = str_replace("{ID_MP}", $unico->codigo, $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{LINK}", $link_MP, $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{DESCRIPCION_CATEGORIA}", utf8_encode($unico->descripcion_categoria), $total_listado_post_personas_resultados);
            if ($unico->resumen == "" and $unico->contenido == "") {
                $resumen = ($unico->resumen);
            } elseif ($unico->resumen <> "" and $unico->contenido == "") {
                $resumen = ($unico->resumen);
            } elseif ($unico->resumen == "" and $unico->contenido <> "") {
                $resumen = limit_text($unico->contenido, 35);
            } elseif ($unico->resumen <> "" and $unico->contenido <> "") {
                $resumen = ($unico->resumen);
            } else {
                $resumen = "";
            }
            if ($unico->tipopost <> 'expertos') {
                $total_listado_post_personas_resultados = str_replace("{NOMBRE}", ($unico->nombre), $total_listado_post_personas_resultados);
                $total_listado_post_personas_resultados = str_replace("{CATEGORIA_MP}", $post_categoria, $total_listado_post_personas_resultados);
                $post_ambito                            = '<a href="?sw=com_mp_personal&amb=mp_amb&idamb=' . $unico->id_ambito . '&ambito=' . $unico->ambito . '">
<span class="badge_small badge-azul"><span class="blanco"><i class="icon-people icons"></i> ' . $unico->ambito . '</span></span></a>';
                $total_listado_post_personas_resultados = str_replace("{AMBITO_MP}", $post_ambito, $total_listado_post_personas_resultados);
                $total_listado_post_personas_resultados = str_replace("{RUT_AUTOR}", ($unico->rut), $total_listado_post_personas_resultados);
                $total_listado_post_personas_resultados = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($unico->rut), $total_listado_post_personas_resultados);
                $link                                   = "?sw=com_mp_full&id_mp=" . $unico->codigo . "";
            } else {
                $total_listado_post_personas_resultados = str_replace("{NOMBRE}", ("$resumen"), $total_listado_post_personas_resultados);
                $total_listado_post_personas_resultados = str_replace("{CATEGORIA_MP}", $post_categoria, $total_listado_post_personas_resultados);
                $post_ambito                            = '<a href="?sw=com_mp_personal&amb=mp_amb&idamb=' . $unico->id_ambito . '&ambito=' . $unico->ambito . '">
<span class="badge_small badge-azul"><span class="blanco"><i class="icon-people icons"></i> ' . $unico->ambito . '</span></span></a>';
                $total_listado_post_personas_resultados = str_replace("{AMBITO_MP}", $post_ambito, $total_listado_post_personas_resultados);
                $total_listado_post_personas_resultados = str_replace("{RUT_AUTOR}", ($unico->contenido), $total_listado_post_personas_resultados);
                $total_listado_post_personas_resultados = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($unico->codigo), $total_listado_post_personas_resultados);
                $link                                   = "?sw=com_mp_personal&rut_enviado=" . $unico->codigo . "&vp=1&mp=1";
            }
            $tiene_megusta = COMUNIDAD_TieneInteraccionPorRut($id_empresa, $unico->codigo, "MEGUSTA", $rut);
            if ($tiene_megusta) {
                $total_listado_post_personas_resultados = str_replace("{BLOQUE_MEGUSTA_POST}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_ya_megusta.html"), $total_listado_post_personas_resultados);
            } else {
                $total_listado_post_personas_resultados = str_replace("{BLOQUE_MEGUSTA_POST}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_megusta.html"), $total_listado_post_personas_resultados);
            }
            $total_listado_post_personas_resultados = ColocaCantidadDeMegusta($total_listado_post_personas_resultados, $unico->codigo, $id_empresa);
            //$total_listado_post_personas_resultados =ColocaCantidadDeNoMegusta($total_listado_post_personas_resultados , $unico->codigo, $id_empresa);
            $total_listado_post_personas_resultados = str_replace("{TIPO}", "A", $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{ID_MP}", ($unico->codigo), $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{CONTENIDO}", $resumen, $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{FECHA}", formatearFechaSmall($unico->fecha), $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{ESTADO}", ($unico->estado), $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{DESCRIPCION_ESTADO}", ($unico->descripcion_estado), $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{RUT}", ($rut), $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{NOMBRE_AUTOR}", ($unico->nombre_autor), $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{NUMVISITAS}", round($unico->numvisitas), $total_listado_post_personas_resultados);
            //$total_listado_post_personas_resultados = str_replace("{NUMMEGUSTA}",($unico->nummegusta),$total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{NUMNOMEGUSTA}", ($unico->numnomegusta), $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{NUMCOMPARTIDA}", ($unico->numcompartido), $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{NUMCOMENTARIO}", ($unico->numcomentarios), $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{NUMCOMENTARIOSREALES}", ($unico->numcomentariosreales), $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{NUMFAVORITA}", ($unico->numfavorita), $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{ESTILOESTADO}", ($unico->estilo), $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{ICONOESTADO}", ($unico->icono_estado), $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{ESTILOCATEGORIA}", ($unico->style), $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{ICONOCATEGORIA}", ($unico->icono), $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{CATEGORIA_MP}", ($unico->categoria), $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{LINK}", ($link), $total_listado_post_personas_resultados);
            if ($unico->tipo_multimedia == "imagen") {
                $imagen = "../../front/multimedia/" . $unico->multimedia;
            } else {
                $imagen = "";
            }
            if ($unico->tipo_multimedia == "video") {
                $video = "../../front/multimedia/" . $unico->multimedia;
            } else {
                $video = "";
            }
            $total_listado_post_personas_resultados = str_replace("{IMAGEN_POST}", "multimedia/" . $unico->imagenfondo, $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{VIDEO}", ($video), $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{TIPOMULTIMEDIA}", ($unico->tipo_multimedia), $total_listado_post_personas_resultados);
            $listado_comentarios                    = MuestraComentariosPorPost($unico->id_mp);
            $total_listado_post_personas_resultados = str_replace("{BLOQUE_COMENTARIOS}", $listado_comentarios, $total_listado_post_personas_resultados);
            if ($unico->url_documento) {
                $total_listado_post_personas_resultados = str_replace("{BLOQUE_URL_DOCUMENTO}", file_get_contents("views/comunidad_mp/row_com_mp_url_documento.html"), $total_listado_post_personas_resultados);
                $total_listado_post_personas_resultados = str_replace("{URL_DOCUMENTO}", ($unico->url_documento), $total_listado_post_personas_resultados);
            } else {
                $total_listado_post_personas_resultados = str_replace("{BLOQUE_URL_DOCUMENTO}", "", $total_listado_post_personas_resultados);
            }
            //echo "<br> video".$unico->video." imagen".$unico->imagenfondo;
            if ($unico->video) {
                $video_youtube                          = ColocaVideoYoutube($unico->video, $unico->id_mp);
                $total_listado_post_personas_resultados = str_replace("{VIDEO_IMAGEN}", $video_youtube, $total_listado_post_personas_resultados);
            } elseif ($unico->imagenfondo) {
                $bloque_imagen_fondo                    = ColocaImagenPost($unico->imagenfondo);
                $total_listado_post_personas_resultados = str_replace("{VIDEO_IMAGEN}", $bloque_imagen_fondo, $total_listado_post_personas_resultados);
            } else {
                $total_listado_post_personas_resultados = str_replace("{VIDEO_IMAGEN}", "", $total_listado_post_personas_resultados);
            }
            $total_listado_post_personas_resultados = str_replace("{TITULO_R}", $tituloR, $total_listado_post_personas_resultados);
            //tags por post
            $TagsPorPosts                           = TagsPorMPEmpresa($unico->codigo, $id_empresa);
            $tag_por_post                           = "";
            foreach ($TagsPorPosts as $TagsPorPost) {
                $tag_por_post .= '<a href="?sw=com_mp_personal&amb=mp_tag&tag=' . $TagsPorPost->tag . '"><span class="badge_small badge-white"><span class="negro">#' . $TagsPorPost->tag . '</span></span></a> ';
            }
            $total_listado_post_personas_resultados = str_replace("{TAGS_POR_POST}", ($tag_por_post), $total_listado_post_personas_resultados);
        }
        // no encontraste resultados?
        $mp_hacerpregunta .= file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_com_mp_hacer_pregunta.html");
        $mp_hacerpregunta = str_replace("{PREGUNTA}", $tipo_query, $mp_hacerpregunta);
    }



   //filtro por tipo
    $agrup_tiposPub    = MPObtengoTiposPubNumero($id_empresa); //print_r($agrup_tiposPub);
    $total_agrup_tipos = "";
    foreach ($agrup_tiposPub as $agrup_tipoPub) {
        $total_agrup_tipos .= file_get_contents("views/comunidad_mp/row_com_mp_grupo_tipos.html");
        $total_agrup_tipos = str_replace("{ITEM}", ($agrup_tipoPub->tipo), $total_agrup_tipos);
        //$total_agrup_tipos = str_replace("{NUM}",($agrup_categoria->cuenta),$total_agrup_tipos);
        $link_cat_amb      = "?sw=com_mp_personal&amb=mp_tipo&idcat=" . $agrup_tipoPub->tipo . "&cat=" . $agrup_tipoPub->tipo . "";
        $total_agrup_tipos = str_replace("{LINK}", $link_cat_amb, $total_agrup_tipos);
        //$total_agrup_tipos = str_replace("{GRUPO_SEGUIR_SEGUIDO_BOTON}",$var_gruposeguir,$total_agrup_tipos);
        //$total_agrup_tipos = str_replace("{GRUPO_SEGUIR_SEGUIDO_CLASS}",$var_groupseguir_class,$total_agrup_tipos);
        //echo $agrup_categoria->categoria;
    }
    $PRINCIPAL = str_replace("{INSIGNIA}", "", $PRINCIPAL);
    $PRINCIPAL = str_replace("{RUT_USUARIO}", $rut, $PRINCIPAL);
    $PRINCIPAL = str_replace("{MIRUT}", $rut, $PRINCIPAL);
    $PRINCIPAL = str_replace("{ROW_LISTADO_POST_VIDEOS}", utf8_encode($total_listado_post_tipo_new_videos), $PRINCIPAL);
    $PRINCIPAL = str_replace("{ROW_LISTADO_POST_NEWS_BIG}", utf8_encode($total_listado_post_tipo_news_big), $PRINCIPAL);
    $PRINCIPAL = str_replace("{ROW_LISTADO_POST_NEWS_3POST}", utf8_encode($total_listado_post_tipo_news_3post), $PRINCIPAL);
    //echo "4096 <br><br><br><br>ambiente $ambiente";
    if ($ambiente <> '') {
        $PRINCIPAL = str_replace("{IMAGEN_CONCURSO_HOME}", "", $PRINCIPAL);
        $PRINCIPAL = str_replace("{POST_RESULTADOS_COMUNIDAD_MP}", utf8_encode($total_listado_post_personas_resultados), $PRINCIPAL);
        $PRINCIPAL = str_replace("{POST_RESULTADOS_EXPERTOS_MP}", utf8_encode($total_listado_post_expertos_resultados), $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_TITULO_R_RESULTADOS}", ($titulo_R_resultados), $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_TITULO_E_RESULTADOS}", ($titulo_E_resultados), $PRINCIPAL);
        $PRINCIPAL = str_replace("{MP_HACERPREGUNTA}", utf8_encode($mp_hacerpregunta), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{IMAGEN_CONCURSO_HOME}", "<div class='row'><div class='col-xs-12'><a href='?sw=com_mp_concurso'><img src='img/comunidadmpa_banner_central_VF_rod.gif' border='0'></a>
    </div></div>", $PRINCIPAL);
        $PRINCIPAL = str_replace("{POST_RESULTADOS_COMUNIDAD_MP}", "", $PRINCIPAL);
        $PRINCIPAL = str_replace("{POST_RESULTADOS_EXPERTOS_MP}", "", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_TITULO_R_RESULTADOS}", ($titulo_R_resultados), $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_TITULO_E_RESULTADOS}", ($titulo_E_resultados), $PRINCIPAL);
        $PRINCIPAL = str_replace("{MP_HACERPREGUNTA}", utf8_encode($mp_hacerpregunta), $PRINCIPAL);
    }
    $PRINCIPAL = str_replace("{PERFIL_PERSONAL_COMUNIDAD_MP}", utf8_encode($perfil_personal), $PRINCIPAL);
    $PRINCIPAL = str_replace("{POST_FIJOS_COMUNIDAD_MP}", utf8_encode($post_fijo_personal), $PRINCIPAL);
    $PRINCIPAL = str_replace("{POST_ESTADISTICAS_COMUNIDAD_MP}", utf8_encode($post_fijo_estadisticas), $PRINCIPAL);
    $PRINCIPAL = str_replace("{ROW_LISTADO_POST_RECIENTES_FACEBOOK}", utf8_encode($total_listado_post_tipo_facebook), $PRINCIPAL);
    //echo "<br><br><br><br><br><br><br><br>vp $vp, amb $ambiente";
    if ($vp == "" and ($ambiente == "" or $ambiente == "mp_cat" or $ambiente == "mp_tag" or $ambiente == "mp_mp" or $ambiente == "mp_mf" or $ambiente == "mp_cc" or $ambiente == "mp_tipo")) {
        //echo "uno";
        //$total_listado_post_recientes.=file_get_contents("views/comunidad_mp/".$template.$id_empresa."_boton_carga_mas_post.html");
        //$total_listado_post_recientes = str_replace("{NUMERO_COMENTARIOS}","1",$total_listado_post_recientes);
        $PRINCIPAL = str_replace("{ROW_LISTADO_POST_RECIENTES}", utf8_encode($total_listado_post_recientes), $PRINCIPAL);
        //<div class='com_mp_title_featured fc-container__inner '><a href='?sw=com_mp_personal&amb=mp_rec'><span class='blanco'> Lo último en la Comunidad <i class='icon-arrow-right icons'></i></span></a></div>
        $PRINCIPAL = str_replace("{TITULO_LISTADO_POST_RECIENTES}", "", $PRINCIPAL);
    } else {
        //echo "dos";
        $PRINCIPAL = str_replace("{ROW_LISTADO_POST_RECIENTES}", "", $PRINCIPAL);
        $PRINCIPAL = str_replace("{TITULO_LISTADO_POST_RECIENTES}", "", $PRINCIPAL);
    }
    $PRINCIPAL  = str_replace("{ROW_LISTADO_TIMELINE_PERSONAL}", utf8_encode($total_listado_post_timeline), $PRINCIPAL);
    $PRINCIPAL  = str_replace("{ROW_LISTADO_TIMELINE_POST_POPULARES}", utf8_encode($total_listado_post_populares), $PRINCIPAL);
    $PRINCIPAL  = str_replace("{ROW_LISTADO_TIMELINE_PERSONAS_INTERES}", utf8_encode($total_listado_post_personas_interes), $PRINCIPAL);
    $PRINCIPAL  = str_replace("{ROW_LISTADO_TIMELINE_PERSONAL}", utf8_encode($total_listado), $PRINCIPAL);
    $PRINCIPAL  = str_replace("{TITULO_LISTADO_TIMELINE_TAG1}", utf8_encode($Top_Tag[0]->tag), $PRINCIPAL);
    $PRINCIPAL  = str_replace("{TITULO_LISTADO_TIMELINE_TAG2}", utf8_encode($Top_Tag[1]->tag), $PRINCIPAL);
    $PRINCIPAL  = str_replace("{TITULO_LISTADO_TIMELINE_TAG3}", utf8_encode($Top_Tag[2]->tag), $PRINCIPAL);
    $PRINCIPAL  = str_replace("{ROW_LISTADO_TIMELINE_TAG1}", utf8_encode($total_listado_post_tag1), $PRINCIPAL);
    $PRINCIPAL  = str_replace("{ROW_LISTADO_TIMELINE_TAG2}", utf8_encode($total_listado_post_tag2), $PRINCIPAL);
    $PRINCIPAL  = str_replace("{ROW_LISTADO_TIMELINE_TAG3}", utf8_encode($total_listado_post_tag3), $PRINCIPAL);
    //    }
    //preguntas
    $PRINCIPAL  = str_replace("{ROW_ULTIMOS_PREGUNTAS_PUBLICO}", utf8_encode($total_ultimos_posteos_publicados), $PRINCIPAL);
    //soy experto??
    $soyexperto = mp_verificaquesoy_experto($rut, $id_empresa, $subcategoria);
    if ($soyexperto[0]->cuenta >= 1) {
        $mp_num_preg_sin_contestar = mp_num_preguntas_sincontestar($rut, $id_empresa, $subcategoria);
        if ($mp_num_preg_sin_contestar[0]->cuenta == 1) {
            $alerta_experto_preguntas = "
    <div class='alert alert-danger' role='alert'>
          <strong>Existen " . $mp_num_preg_sin_contestar[0]->cuenta . " pregunta sin contestar</strong><br>Has click en el boton Responder, para contestar.<br> Tu respuesta quedara publicada en la Comunidad.
    </div>";
        } elseif ($mp_num_preg_sin_contestar[0]->cuenta > 1) {
            $alerta_experto_preguntas = "
    <div class='alert alert-danger' role='alert'>
          <strong>Existen " . $mp_num_preg_sin_contestar[0]->cuenta . " preguntas sin contestar</strong><br>Has click en el boton Responder, para contestar.<br> Tu respuesta quedara publicada en la Comunidad.
    </div>";
        } else {
            $alerta_experto_preguntas = "";
        }
        $PRINCIPAL = str_replace("{PREGUNTAS_COMUNIDAD_PARA_RESPONDER}", utf8_encode($total_preguntas_sin_responder), $PRINCIPAL);
        $PRINCIPAL = str_replace("{TITULO_PREGUNTAS_COMUNIDAD_PARA_RESPONDER}", utf8_encode($alerta_experto_preguntas), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{PREGUNTAS_COMUNIDAD_PARA_RESPONDER}", "", $PRINCIPAL);
        $PRINCIPAL = str_replace("{TITULO_PREGUNTAS_COMUNIDAD_PARA_RESPONDER}", "", $PRINCIPAL);
    }
    $PRINCIPAL                      = str_replace("{GRUPO_INTERES_1}", utf8_encode($mas_grupo_interes1[0]->categoria), $PRINCIPAL);
    $PRINCIPAL                      = str_replace("{GRUPO_INTERES_2}", utf8_encode($mas_grupo_interes2[0]->categoria), $PRINCIPAL);
    $PRINCIPAL                      = str_replace("{GRUPO_INTERES_3}", utf8_encode($mas_grupo_interes3[0]->categoria), $PRINCIPAL);
    $PRINCIPAL                      = str_replace("{ROW_MAS_PUBLICADOR_GRUPO_INTERES_1}", utf8_encode($total_mas_post_grupo_interes1), $PRINCIPAL);
    $PRINCIPAL                      = str_replace("{ROW_MAS_PUBLICADOR_GRUPO_INTERES_2}", utf8_encode($total_mas_post_grupo_interes2), $PRINCIPAL);
    $PRINCIPAL                      = str_replace("{ROW_MAS_PUBLICADOR_GRUPO_INTERES_3}", utf8_encode($total_mas_post_grupo_interes3), $PRINCIPAL);
    $PRINCIPAL                      = str_replace("{COM_MP_FRASES}", utf8_encode($total_mp_com_frases), $PRINCIPAL);
    $PRINCIPAL                      = str_replace("{ROW_POST_VALORADOS}", utf8_encode($total_posteos_mas_valorados), $PRINCIPAL);
    $PRINCIPAL                      = str_replace("{MP_NOVEDADES}", utf8_encode($total_posteos_novedades), $PRINCIPAL);
    $PRINCIPAL                      = str_replace("{MP_FOTOS}", utf8_encode($total_posteos_fotos), $PRINCIPAL);
    $PRINCIPAL                      = str_replace("{MIS_CAPACITACIONES_novedades}", utf8_encode($total_posteos_capacitaciones), $PRINCIPAL);
    $PRINCIPAL                      = str_replace("{ROW_PEOPLE_INTERACCIONES}", utf8_encode($total_people_mas_interacc), $PRINCIPAL);
    $PRINCIPAL                      = str_replace("{ROW_PEOPLE_MAS_SEGUIDOS}", utf8_encode($total_people_mas_seguida), $PRINCIPAL);
    $PRINCIPAL                      = str_replace("{ROW_PEOPLE_MAS_PUNTOS}", utf8_encode($total_people_mas_puntos), $PRINCIPAL);
    $PRINCIPAL                      = str_replace("{AGRUPACION_CATEGORIAS}", utf8_encode($total_agrup_categoria), $PRINCIPAL);
    $PRINCIPAL                      = str_replace("{ROW_PEOPLE_EXPERTOS}", utf8_encode($total_agrup_categoria_expertos), $PRINCIPAL);
    $PRINCIPAL                      = str_replace("{ROW_PEOPLE_QUESIGO}", utf8_encode($total_people_quesigo), $PRINCIPAL);
    $PRINCIPAL                      = str_replace("{ROW_TIPO_PUBLICACION}", utf8_encode($total_agrup_tipos), $PRINCIPAL);
    $PRINCIPAL                      = str_replace("{AGRUPACION_AMBITOS}", utf8_encode($total_agrup_ambitos), $PRINCIPAL);
    $PRINCIPAL                      = str_replace("{TAG_CLOUD}", utf8_encode($total_listado_tag_cloud), $PRINCIPAL);
    //Mini encuesta
    $total_mini_encuestas           = com_mp_mini_encuesta($id_empresa, $rut);
    $total_mini_encuesta_titulo     = "";
    $total_mini_encuesta_opciones   = "";
    $total_mini_encuesta_resultados = "";
    foreach ($total_mini_encuestas as $total_mini_encuesta) {
        //print_r($total_mini_encuesta);
        $total_mini_encuesta_titulo .= file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_com_mp_encuesta_mini_titulo.html");
        $total_mini_encuesta_titulo = str_replace("{MINI_ENCUESTA_PREGUNTA}", ($total_mini_encuesta->pregunta), $total_mini_encuesta_titulo);
        if ($total_mini_encuesta->respuesta == 0) {
            //muestra  opciones
            if ($total_mini_encuesta->opcion1 <> '') {
                $total_mini_encuesta_opciones .= file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_com_mp_encuesta_mini_opciones.html");
                $total_mini_encuesta_opciones = str_replace("{MINI_ENCUESTA_OPCION}", ($total_mini_encuesta->opcion1), $total_mini_encuesta_opciones);
                $total_mini_encuesta_opciones = str_replace("{MINI_ENCUESTA_OPCION_ID}", "opcion1", $total_mini_encuesta_opciones);
                $total_mini_encuesta_opciones = str_replace("{MINI_ENCUESTA_ID}", $total_mini_encuesta->id, $total_mini_encuesta_opciones);
            }
            if ($total_mini_encuesta->opcion2 <> '') {
                $total_mini_encuesta_opciones .= file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_com_mp_encuesta_mini_opciones.html");
                $total_mini_encuesta_opciones = str_replace("{MINI_ENCUESTA_OPCION}", ($total_mini_encuesta->opcion2), $total_mini_encuesta_opciones);
                $total_mini_encuesta_opciones = str_replace("{MINI_ENCUESTA_OPCION_ID}", "opcion2", $total_mini_encuesta_opciones);
                $total_mini_encuesta_opciones = str_replace("{MINI_ENCUESTA_ID}", $total_mini_encuesta->id, $total_mini_encuesta_opciones);
            }
            if ($total_mini_encuesta->opcion3 <> '') {
                $total_mini_encuesta_opciones .= file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_com_mp_encuesta_mini_opciones.html");
                $total_mini_encuesta_opciones = str_replace("{MINI_ENCUESTA_OPCION}", ($total_mini_encuesta->opcion3), $total_mini_encuesta_opciones);
                $total_mini_encuesta_opciones = str_replace("{MINI_ENCUESTA_OPCION_ID}", "opcion3", $total_mini_encuesta_opciones);
                $total_mini_encuesta_opciones = str_replace("{MINI_ENCUESTA_ID}", $total_mini_encuesta->id, $total_mini_encuesta_opciones);
            }
            if ($total_mini_encuesta->opcion4 <> '') {
                $total_mini_encuesta_opciones .= file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_com_mp_encuesta_mini_opciones.html");
                $total_mini_encuesta_opciones = str_replace("{MINI_ENCUESTA_OPCION}", ($total_mini_encuesta->opcion4), $total_mini_encuesta_opciones);
                $total_mini_encuesta_opciones = str_replace("{MINI_ENCUESTA_OPCION_ID}", "opcion4", $total_mini_encuesta_opciones);
                $total_mini_encuesta_opciones = str_replace("{MINI_ENCUESTA_ID}", $total_mini_encuesta->id, $total_mini_encuesta_opciones);
            }
        } else {
            //muestra  respuesta
            if ($total_mini_encuesta->opcion1 <> '') {
                $total_mini_encuesta_resultados .= file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_com_mp_encuesta_mini_resultados.html");
                $total_mini_encuesta_resultados = str_replace("{MINI_ENCUESTA_OPCION_PORCENTAJE}", $total_mini_encuesta->porcop1 . "%", $total_mini_encuesta_resultados);
                $total_mini_encuesta_resultados = str_replace("{MINI_ENCUESTA_OPCION_TEXTO}", $total_mini_encuesta->opcion1, $total_mini_encuesta_resultados);
                $total_mini_encuesta_resultados = str_replace("{MINI_ENCUESTA_OPCION_NUMERO}", $total_mini_encuesta->porcop1, $total_mini_encuesta_resultados);
            }
            if ($total_mini_encuesta->opcion2 <> '') {
                $total_mini_encuesta_resultados .= file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_com_mp_encuesta_mini_resultados.html");
                $total_mini_encuesta_resultados = str_replace("{MINI_ENCUESTA_OPCION_PORCENTAJE}", $total_mini_encuesta->porcop2 . "%", $total_mini_encuesta_resultados);
                $total_mini_encuesta_resultados = str_replace("{MINI_ENCUESTA_OPCION_TEXTO}", $total_mini_encuesta->opcion2, $total_mini_encuesta_resultados);
                $total_mini_encuesta_resultados = str_replace("{MINI_ENCUESTA_OPCION_NUMERO}", $total_mini_encuesta->porcop2, $total_mini_encuesta_resultados);
            }
            if ($total_mini_encuesta->opcion3 <> '') {
                $total_mini_encuesta_resultados .= file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_com_mp_encuesta_mini_resultados.html");
                $total_mini_encuesta_resultados = str_replace("{MINI_ENCUESTA_OPCION_PORCENTAJE}", $total_mini_encuesta->porcop3 . "%", $total_mini_encuesta_resultados);
                $total_mini_encuesta_resultados = str_replace("{MINI_ENCUESTA_OPCION_TEXTO}", $total_mini_encuesta->opcion3, $total_mini_encuesta_resultados);
                $total_mini_encuesta_resultados = str_replace("{MINI_ENCUESTA_OPCION_NUMERO}", $total_mini_encuesta->porcop3, $total_mini_encuesta_resultados);
            }
            if ($total_mini_encuesta->opcion4 <> '') {
                $total_mini_encuesta_resultados .= file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_com_mp_encuesta_mini_resultados.html");
                $total_mini_encuesta_resultados = str_replace("{MINI_ENCUESTA_OPCION_PORCENTAJE}", $total_mini_encuesta->porcop4 . "%", $total_mini_encuesta_resultados);
                $total_mini_encuesta_resultados = str_replace("{MINI_ENCUESTA_OPCION_TEXTO}", $total_mini_encuesta->opcion4, $total_mini_encuesta_resultados);
                $total_mini_encuesta_resultados = str_replace("{MINI_ENCUESTA_OPCION_NUMERO}", $total_mini_encuesta->porcop4, $total_mini_encuesta_resultados);
            }
        }
    }
    $PRINCIPAL = str_replace("{ENCUESTA_MINI_TITULO_PREGUNTA}", utf8_encode($total_mini_encuesta_titulo), $PRINCIPAL);
    $PRINCIPAL = str_replace("{ENCUESTA_MINI_OPCIONES}", utf8_encode($total_mini_encuesta_opciones), $PRINCIPAL);
    $PRINCIPAL = str_replace("{ENCUESTA_MINI_RESULTADOS}", utf8_encode($total_mini_encuesta_resultados), $PRINCIPAL);
    if ($tipo_query == "" and $ambiente == "" AND $rut_enviado == "") {
        //echo "<br><br><br><br><br><br>hola";
        $PRINCIPAL = str_replace("{ROW_CARGAS_MAS}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_com_mp_personal_solo_post_cargar.html"), $PRINCIPAL);
    } else {
        //echo "<br><br><br><br><br><br>chao";
        // $PRINCIPAL = str_replace("{ROW_CARGAS_MAS}","",$PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_CARGAS_MAS}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_com_mp_personal_solo_post_cargar.html"), $PRINCIPAL);
    }
    $arreglo_get               = $_GET;
    $array_para_enviar_via_url = serialize($arreglo_get);
    $array_para_enviar_via_url = urlencode($array_para_enviar_via_url);
    $PRINCIPAL                 = str_replace("{VARIABLES_GET_ENCODEADAS}", $array_para_enviar_via_url, $PRINCIPAL);
    //    $mp_comp_estadistica=MPO_Compestadistica($id_empresa);
    $categorias_mp             = TraeCategoriasMejoresPracticas($id_empresa);
    $options_categorias        = "";
    foreach ($categorias_mp as $cat) {
        $options_categorias .= "<option value='" . $cat->id_categoria . "'>" . $cat->categoria . "</option>";
    }
    $PRINCIPAL                    = str_replace("{CATEGORIAS_FORM}", utf8_encode($options_categorias), $PRINCIPAL);
    // notificaciones sin ver
    // Mis Notificaciones
    $com_mp_mis_notificaciones    = mp_interacciones_notificaciones_home($rut, $id_empresa, "");
    //print_r($com_mp_mis_notificaciones); echo "5613";
    $cuenta_notificaciones        = 0;
    $cuenta_notificaciones_sinver = 0;
    $total_notificaciones         = "";
    foreach ($com_mp_mis_notificaciones as $com_mp_mi_notificacion) {
        $muestra = 0;
        $cuenta_notificaciones++;
        $ico   = "";
        $texto = "";
        if ($com_mp_mi_notificacion->tipo == "COMENTARIO") {
            $ico = '<i class="icon-speech icons"></i> <br><small><small>[' . $com_mp_mi_notificacion->fecha . ']</small></small>';
            if ($com_mp_mi_notificacion->rutAutor == $Rut_Perfil) {
                $texto = '<a href="?sw=com_mp_personal&rut_enviado=' . $com_mp_mi_notificacion->rut_remitente . '=1&mp=1">
                    <strong>' . $com_mp_mi_notificacion->NombreRemitente . '</strong>
                    </a> coment&oacute;:
                     tu publicaci&oacute;n
                    <a href="?sw=com_mp_full&id_mp=' . $com_mp_mi_notificacion->id_mp . '"><strong>' . $com_mp_mi_notificacion->Publicacion . '</strong></a> ';
                if ($com_mp_mi_notificacion->visto_autor === null or $com_mp_mi_notificacion->visto_autor <> 1) {
                    $cuenta_notificaciones_sinver++;
                    $muestra = 1;
                }
            } else {
                $texto = 'Comentaste la publicaci&oacute;n
                    <a href="?sw=com_mp_full&id_mp=' . $com_mp_mi_notificacion->id_mp . '">
                    <strong>' . $com_mp_mi_notificacion->Publicacion . '</strong></a>  ';
            }
        }
        if ($com_mp_mi_notificacion->tipo == "SEGUIDO" and $Rut_Perfil <> $com_mp_mi_notificacion->rut_remitente) {
            $ico = '<i class="icon-user icons"></i> <br><small><small>[' . $com_mp_mi_notificacion->fecha . ']</small></small> ';
            if ($com_mp_mi_notificacion->rut_remitenteAutor == $Rut_Perfil) {
                $texto = 'Seguiste a <a href="?sw=com_mp_personal&rut_enviado=' . $com_mp_mi_notificacion->rut . '=1&mp=1">
                    <strong>' . $com_mp_mi_notificacion->NombreDestinatario . '</strong>
                    </a>';
            } else {
                $texto = '<a href="?sw=com_mp_personal&rut_enviado=' . $com_mp_mi_notificacion->rut_remitente . '=1&mp=1">
                    <strong>' . $com_mp_mi_notificacion->NombreRemitente . '</strong> te sigue';
                if ($com_mp_mi_notificacion->visto === null or $com_mp_mi_notificacion->visto <> 1 and $com_mp_mi_notificacion->rut_remitente <> $Rut_Perfil) {
                    $cuenta_notificaciones_sinver++;
                    $muestra = 1;
                }
            }
        }
        //publicaciones sin ver
        //echo "<br> rut $Rut_Perfil==".$com_mp_mi_notificacion->rut_remitente;
        if ($com_mp_mi_notificacion->tipo == "PUBLICACION_SEGUIDO" and $Rut_Perfil == $com_mp_mi_notificacion->rut_remitente) {
            if ($com_mp_mi_notificacion->rut_remitenteAutor <> $Rut_Perfil) {
                $ico   = '<i class="icon-user icons"></i> <br><small><small>[' . $com_mp_mi_notificacion->fecha . ']</small></small> ';
                //echo "<br> sigues a que publico ".$com_mp_mi_notificacion->rut_autor;
                //exit();
                $texto = $com_mp_mi_notificacion->NombreAutor . ' ha publicado
                    <a href="?sw=com_mp_full&id_mp=' . $com_mp_mi_notificacion->id_mp . '">
                    <strong>' . $com_mp_mi_notificacion->Publicacion . '</strong></a>  ';
                //echo "$com_mp_mi_notificacion->visto_remitente===null or $com_mp_mi_notificacion->visto_remitente<>1 and $com_mp_mi_notificacion->rut_remitente==$Rut_Perfil";
                if ($com_mp_mi_notificacion->visto_remitente === null or $com_mp_mi_notificacion->visto_remitente <> 1 and $com_mp_mi_notificacion->rut_remitente == $Rut_Perfil) {
                    $cuenta_notificaciones_sinver++;
                    $muestra = 1;
                }
            }
        }
        if ($com_mp_mi_notificacion->tipo == "MEGUSTA") {
            $ico = '<i class="icon-thumbs-up icons"></i> <br><small><small>[' . $com_mp_mi_notificacion->fecha . ']</small></small> ';
            if ($com_mp_mi_notificacion->rut == $Rut_Perfil) {
                $texto = 'Te gusta la publicaci&oacute;n <a href="?sw=com_mp_full&id_mp=' . $com_mp_mi_notificacion->id_mp . '">
                    <strong>' . $com_mp_mi_notificacion->Publicacion . '</strong></a> ';
            } else {
                $texto = 'A <a href="?sw=com_mp_personal&rut_enviado=' . $com_mp_mi_notificacion->rut . '=1&mp=1">
                    <strong>' . $com_mp_mi_notificacion->NombreDestinatario . '</strong>
                    </a> le Gusta tu publicaci&oacute;n
                    <a href="?sw=com_mp_full&id_mp=' . $com_mp_mi_notificacion->id_mp . '"><strong>' . $com_mp_mi_notificacion->Publicacion . '</strong></a> ';
                if ($com_mp_mi_notificacion->visto_autor === null or $com_mp_mi_notificacion->visto_autor <> 1) {
                    $cuenta_notificaciones_sinver++;
                    $muestra = 1;
                }
            }
        }
        if ($com_mp_mi_notificacion->tipo == "GRUPOSEGUIDO") {
            $ico = '<i class="icon-people icons"></i> <br><small><small>[' . $com_mp_mi_notificacion->fecha . ']</small></small> ';
            if ($com_mp_mi_notificacion->rut == $Rut_Perfil) {
                $texto = 'Seguiste el Grupo de Inter&eacute;s
                    <a href="?sw=com_mp_personal&amb=mp_cat&idcat=' . $com_mp_mi_notificacion->contenido . '&cat=' . $com_mp_mi_notificacion->NombreCategoria . '">
                    <strong>' . $com_mp_mi_notificacion->NombreCategoria . '</strong></a>
                    ';
            }
        }
        if ($com_mp_mi_notificacion->tipo == "COMPARTIDOCONMIGO") {
            $ico = '<i class="icon-share icons"></i> <br><small><small>[' . $com_mp_mi_notificacion->fecha . ']</small></small> ';
            if ($com_mp_mi_notificacion->rut <> $Rut_Perfil and $com_mp_mi_notificacion->rut_remitente <> $Rut_Perfil and $com_mp_mi_notificacion->rut == $com_mp_mi_notificacion->rut_remitente) {
                $texto = '<a href="?sw=com_mp_personal&rut_enviado=' . $com_mp_mi_notificacion->rut . '=1&mp=1">
                    <strong>' . $com_mp_mi_notificacion->NombreDestinatario . '</strong>
                    </a> guard&oacute; tu publicaci&oacute;n
                    <a href="?sw=com_mp_full&id_mp=' . $com_mp_mi_notificacion->id_mp . '"><strong>' . $com_mp_mi_notificacion->Publicacion . '</strong></a> ';
                if ($com_mp_mi_notificacion->visto_autor === null or $com_mp_mi_notificacion->visto_autor <> 1) {
                    $cuenta_notificaciones_sinver++;
                    $muestra = 1;
                }
            } elseif ($com_mp_mi_notificacion->rut == $Rut_Perfil and $com_mp_mi_notificacion->rut_remitente == $Rut_Perfil) {
                $texto = 'Guardaste la publicaci&oacute;n <a href="?sw=com_mp_full&id_mp=' . $com_mp_mi_notificacion->id_mp . '">
                    <strong>' . $com_mp_mi_notificacion->Publicacion . '</strong></a> ';
            } elseif ($com_mp_mi_notificacion->rut == $Rut_Perfil and $com_mp_mi_notificacion->rut_remitente <> $Rut_Perfil) {
                $texto = '<a href="?sw=com_mp_personal&rut_enviado=' . $com_mp_mi_notificacion->rut . '=1&mp=1">
                    <strong>' . $com_mp_mi_notificacion->NombreRemitente . '</strong>
                    </a> comparti&oacute; contigo la publicaci&oacute;n
                    <a href="?sw=com_mp_full&id_mp=' . $com_mp_mi_notificacion->id_mp . '"><strong>' . $com_mp_mi_notificacion->Publicacion . '</strong></a>';
                if ($com_mp_mi_notificacion->visto === null or $com_mp_mi_notificacion->visto <> 1) {
                    $cuenta_notificaciones_sinver++;
                    $muestra = 1;
                }
            } elseif ($com_mp_mi_notificacion->rut <> $Rut_Perfil and $com_mp_mi_notificacion->rut_remitente == $Rut_Perfil) {
                $texto = 'Compartiste con <a href="?sw=com_mp_personal&rut_enviado=' . $com_mp_mi_notificacion->rut . '=1&mp=1">
                    <strong>' . $com_mp_mi_notificacion->NombreDestinatario . '</strong>
                    </a> la publicaci&oacute;n
                    <a href="?sw=com_mp_full&id_mp=' . $com_mp_mi_notificacion->id_mp . '"><strong>' . $com_mp_mi_notificacion->Publicacion . '</strong></a>
                    ';
            }
        }
        if ($muestra == 1 and $cuenta_notificaciones_sinver <= 10) {
            $total_notificaciones .= file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_row_com_mp_perfil_mis_notificaciones_mini.html");
            $total_notificaciones = str_replace("{ICO}", ($ico), $total_notificaciones);
            $total_notificaciones = str_replace("{TEXTO}", ($texto), $total_notificaciones);
        }
    }
    $PRINCIPAL = str_replace("{MI_RUT}", $rut, $PRINCIPAL);
    $PRINCIPAL = str_replace("{ROW_COMP_MP_MIS_NOTIFICACIONES_SIN_VER}", utf8_encode($total_notificaciones), $PRINCIPAL);
    if ($cuenta_notificaciones_sinver > 0) {
        $PRINCIPAL = str_replace("{NUM_NOTIFICACIONES_SINVER_GLOBO}", "<span class='badge_bell badge-default-bell'>" . $cuenta_notificaciones_sinver . " </span> ", $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{NUM_NOTIFICACIONES_SINVER_GLOBO}", "", $PRINCIPAL);
    }
    $PRINCIPAL = str_replace("{COMP_MP_PUBLICACIONES_TOTALES}", $mp_comp_estadistica[0]->CuentaPublicaciones, $PRINCIPAL);
    $PRINCIPAL = str_replace("{COMP_MP_PUBLICACIONES_TOTALES}", $mp_comp_estadistica[0]->CuentaPublicaciones, $PRINCIPAL);
    $PRINCIPAL = str_replace("{COMP_MP_VISTAS_TOTALES}", $mp_comp_estadistica[0]->CuentaVisitas, $PRINCIPAL);
    $PRINCIPAL = str_replace("{COMP_MP_FAVORITAS_TOTALES}", $mp_comp_estadistica[0]->CuentaFavoritas, $PRINCIPAL);
    $PRINCIPAL = str_replace("{COMP_MP_MEGUSTA_TOTALES}", $mp_comp_estadistica[0]->CuentaMeGusta, $PRINCIPAL);
    return ($PRINCIPAL);
}
function Agradecer_personal_lista($PRINCIPAL, $id_empresa, $rut, $ord_by, $filt_by, $filt_cat, $vp, $tag, $rut_enviado, $tipo_query, $ambiente, $start_limit, $subcategoria)
{
    if ($rut_enviado <> '') {
        $Rut_Perfil = $rut_enviado;
    } else {
        $Rut_Perfil = $rut;
    }
    $array_MP_template = MP_BuscaTemplate($rut, $id_empresa);
    if ($array_MP_template[0]->template <> '') {
        $template = $array_MP_template[0]->template . "/";
    } else {
        $template = "";
    }
    if ($tipo_query <> '') {
        $todas                                  = com_mp_resultados_inteligentes($id_empresa, $tipo_query, "", $ambiente, $subcategoria);
        $total_listado_post_personas_resultados = "";
        foreach ($todas as $unico) {
            $tpi++;
            $guardo_codigo[$tpi] = $unico->codigo;
            $total_listado_post_personas_resultados .= file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_row_com_mp_persona_listado_tipoE_Agradecer.html");
            $total_listado_post_personas_resultados = str_replace("{HUINCHA_INTERACCIONES}", "", $total_listado_post_personas_resultados);
            $datos_interaccion_personal             = TraeBuscaInteraccionPersonal($unico->codigo, $id_empresa);
            if ($datos_interaccion_personal[0]->numbcicoins == "") {
                $num_coins = 0;
            } else {
                $num_coins = $datos_interaccion_personal[0]->numbcicoins;
            }
            if ($datos_interaccion_personal[0]->numaptitudesvalidadas == "") {
                $num_aptitudes = 0;
            } else {
                $num_aptitudes = $datos_interaccion_personal[0]->numaptitudesvalidadas;
            }
            if ($datos_interaccion_personal[0]->numpublicaciones == "") {
                $num_publicaciones = 0;
            } else {
                $num_publicaciones = $datos_interaccion_personal[0]->numpublicaciones;
            }
            if ($datos_interaccion_personal[0]->numseguidores == "") {
                $num_seguidores = 0;
            } else {
                $num_seguidores = $datos_interaccion_personal[0]->numseguidores;
            }
            $total_listado_post_personas_resultados = str_replace("{NUM_BCICOINS}", $num_coins, $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{NUM_SEGUIDORES}", $num_seguidores, $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{NUM_SEGUIDOS}", $datos_interaccion_personal[0]->numseguidos, $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{NUM_PUBLICACIONES}", $num_publicaciones, $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{NUM_MEGUSTA_FAVORITAS}", $datos_interaccion_personal[0]->nummegustafavorita, $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{NUM_VISITAS}", $datos_interaccion_personal[0]->numvisitas, $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{NUM_COMENTARIOS}", $datos_interaccion_personal[0]->numcomentarios, $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{NUM_APTITUDESVALIDADAS}", $num_aptitudes, $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{NUM_PUBLICACIONESSEGUIDAS}", $datos_interaccion_personal[0]->publicacionesseguidas, $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{NUM_INTERACCIONES}", $datos_interaccion_personal[0]->numinteracciones, $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{RUTEXPERTO}", $unico->codigo, $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{CARGO_EXPERTO}", $unico->cargo_experto, $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{NOMBRE_EXPERTO}", $unico->nombre_experto, $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($unico->codigo), $total_listado_post_personas_resultados);
            $array_Reco_Gracias                     = BuscaDatosReconocimientoAgradecimientos($unico->codigo, $id_empresa);
            if ($array_Reco_Gracias[0]->num_gracias > 0) {
                $num_gracias = $array_Reco_Gracias[0]->num_gracias;
            } else {
                $num_gracias = 0;
            }
            if ($array_Reco_Gracias[0]->num_reconocimientos > 0) {
                $num_reconocimientos = $array_Reco_Gracias[0]->num_reconocimientos;
            } else {
                $num_reconocimientos = 0;
            }
            //echo $array_Reco_Gracias->num_reconocimientos;
            $total_listado_post_personas_resultados = str_replace("{NUM_GRACIAS}", ($num_gracias), $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{NUM_RECONOCIMIENTOS}", ($num_reconocimientos), $total_listado_post_personas_resultados);
            if ($unico->tipo == "MejorPractica") {
                $ico = "img/bci_mp_practica_icon.png";
            }
            if ($unico->tipo == "Papers") {
                $ico = "img/bci_mp_paper_icon.png";
            }
            if ($unico->tipo == "Publicacion") {
                $ico = "img/bci_mp_publicacion.png";
            }
            if ($unico->tipo == "Video" or $unico->tipo == "VideoInterno") {
                $ico = "img/bci_mp_practica_video.png";
            }
            if ($unico->tipo == "Links" or $unico->tipo == "LinkExterno") {
                $ico = "img/bci_mp_link_icon.png";
            }
            if ($unico->tipo == "Experiencias") {
                $ico = "img/bci_mp_experiencias_icon.png";
            }
            if ($unico->tipopost == "expertos") {
                $ico = "img/bci_mp_experto_icon.png";
            }
            if ($unico->tipo == "OportunidadMejora") {
                $ico = "img/bci_mp_oportunidadmejora_icon.png";
            }
            if ($unico->tipo == "Udnolohaga") {
                $ico = "img/bci_mp_udnolohaga_icon.png";
            }
            if ($unico->tipo == "RRPP") {
                $ico = "img/bci_mp_rrpp_icon.png";
            }
            if ($unico->tipo == "Pregunta") {
                $ico = "img/bci_mp_pregunta_icon.png";
            }
            if ($unico->tipo == "Respuesta") {
                $ico = "img/bci_mp_pregunta_icon.png";
            }
            $total_listado_post_personas_resultados = str_replace("{NOMBRE_MENTOR}", ($mentor), $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{ICONO}", $ico, $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{DESC_ICONO}", $unico->tipo, $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{HUINCHA_INTERACCIONES}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_huincha_interacciones.html"), $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = ColocaCantidadDeFavorito($total_listado_post_personas_resultados, $unico->id_mp, $id_empresa);
            $total_listado_post_personas_resultados = str_replace("{ID_MP}", $unico->codigo, $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{LINK}", $link_MP, $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{DESCRIPCION_CATEGORIA}", utf8_encode($unico->descripcion_categoria), $total_listado_post_personas_resultados);
            if ($unico->resumen == "" and $unico->contenido == "") {
                $resumen = ($unico->resumen);
            } elseif ($unico->resumen <> "" and $unico->contenido == "") {
                $resumen = ($unico->resumen);
            } elseif ($unico->resumen == "" and $unico->contenido <> "") {
                $resumen = limit_text($unico->contenido, 35);
            } elseif ($unico->resumen <> "" and $unico->contenido <> "") {
                $resumen = ($unico->resumen);
            } else {
                $resumen = "";
            }
            if ($unico->tipopost <> 'expertos') {
                $total_listado_post_personas_resultados = str_replace("{NOMBRE}", ($unico->nombre), $total_listado_post_personas_resultados);
                $total_listado_post_personas_resultados = str_replace("{CATEGORIA_MP}", $post_categoria, $total_listado_post_personas_resultados);
                $post_ambito                            = '<a href="?sw=com_mp_personal&amb=mp_amb&idamb=' . $unico->id_ambito . '&ambito=' . $unico->ambito . '">
<span class="badge_small badge-azul"><span class="blanco"><i class="icon-people icons"></i> ' . $unico->ambito . '</span></span></a>';
                $total_listado_post_personas_resultados = str_replace("{AMBITO_MP}", $post_ambito, $total_listado_post_personas_resultados);
                $total_listado_post_personas_resultados = str_replace("{RUT_AUTOR}", ($unico->rut), $total_listado_post_personas_resultados);
                $total_listado_post_personas_resultados = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($unico->rut), $total_listado_post_personas_resultados);
                $link                                   = "?sw=com_mp_full&id_mp=" . $unico->codigo . "";
            } else {
                $total_listado_post_personas_resultados = str_replace("{NOMBRE}", ("$resumen"), $total_listado_post_personas_resultados);
                $total_listado_post_personas_resultados = str_replace("{CATEGORIA_MP}", $post_categoria, $total_listado_post_personas_resultados);
                $post_ambito                            = '<a href="?sw=com_mp_personal&amb=mp_amb&idamb=' . $unico->id_ambito . '&ambito=' . $unico->ambito . '">
<span class="badge_small badge-azul"><span class="blanco"><i class="icon-people icons"></i> ' . $unico->ambito . '</span></span></a>';
                $total_listado_post_personas_resultados = str_replace("{AMBITO_MP}", $post_ambito, $total_listado_post_personas_resultados);
                $total_listado_post_personas_resultados = str_replace("{RUT_AUTOR}", ($unico->contenido), $total_listado_post_personas_resultados);
                $total_listado_post_personas_resultados = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($unico->codigo), $total_listado_post_personas_resultados);
                $link                                   = "?sw=com_mp_personal&rut_enviado=" . $unico->codigo . "&vp=1&mp=1";
            }
            $tiene_megusta = COMUNIDAD_TieneInteraccionPorRut($id_empresa, $unico->codigo, "MEGUSTA", $rut);
            if ($tiene_megusta) {
                $total_listado_post_personas_resultados = str_replace("{BLOQUE_MEGUSTA_POST}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_ya_megusta.html"), $total_listado_post_personas_resultados);
            } else {
                $total_listado_post_personas_resultados = str_replace("{BLOQUE_MEGUSTA_POST}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_megusta.html"), $total_listado_post_personas_resultados);
            }
            $total_listado_post_personas_resultados = ColocaCantidadDeMegusta($total_listado_post_personas_resultados, $unico->codigo, $id_empresa);
            //$total_listado_post_personas_resultados =ColocaCantidadDeNoMegusta($total_listado_post_personas_resultados , $unico->codigo, $id_empresa);
            $total_listado_post_personas_resultados = str_replace("{TIPO}", "A", $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{ID_MP}", ($unico->codigo), $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{CONTENIDO}", $resumen, $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{FECHA}", formatearFechaSmall($unico->fecha), $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{ESTADO}", ($unico->estado), $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{DESCRIPCION_ESTADO}", ($unico->descripcion_estado), $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{RUT}", ($rut), $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{NOMBRE_AUTOR}", ($unico->nombre_autor), $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{NUMVISITAS}", round($unico->numvisitas), $total_listado_post_personas_resultados);
            //$total_listado_post_personas_resultados = str_replace("{NUMMEGUSTA}",($unico->nummegusta),$total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{NUMNOMEGUSTA}", ($unico->numnomegusta), $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{NUMCOMPARTIDA}", ($unico->numcompartido), $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{NUMCOMENTARIO}", ($unico->numcomentarios), $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{NUMCOMENTARIOSREALES}", ($unico->numcomentariosreales), $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{NUMFAVORITA}", ($unico->numfavorita), $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{ESTILOESTADO}", ($unico->estilo), $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{ICONOESTADO}", ($unico->icono_estado), $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{ESTILOCATEGORIA}", ($unico->style), $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{ICONOCATEGORIA}", ($unico->icono), $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{CATEGORIA_MP}", ($unico->categoria), $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{LINK}", ($link), $total_listado_post_personas_resultados);
            if ($unico->tipo_multimedia == "imagen") {
                $imagen = "../../front/multimedia/" . $unico->multimedia;
            } else {
                $imagen = "";
            }
            if ($unico->tipo_multimedia == "video") {
                $video = "../../front/multimedia/" . $unico->multimedia;
            } else {
                $video = "";
            }
            $total_listado_post_personas_resultados = str_replace("{IMAGEN_POST}", "multimedia/" . $unico->imagenfondo, $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{VIDEO}", ($video), $total_listado_post_personas_resultados);
            $total_listado_post_personas_resultados = str_replace("{TIPOMULTIMEDIA}", ($unico->tipo_multimedia), $total_listado_post_personas_resultados);
            $listado_comentarios                    = MuestraComentariosPorPost($unico->id_mp);
            $total_listado_post_personas_resultados = str_replace("{BLOQUE_COMENTARIOS}", $listado_comentarios, $total_listado_post_personas_resultados);
            if ($unico->url_documento) {
                $total_listado_post_personas_resultados = str_replace("{BLOQUE_URL_DOCUMENTO}", file_get_contents("views/comunidad_mp/row_com_mp_url_documento.html"), $total_listado_post_personas_resultados);
                $total_listado_post_personas_resultados = str_replace("{URL_DOCUMENTO}", ($unico->url_documento), $total_listado_post_personas_resultados);
            } else {
                $total_listado_post_personas_resultados = str_replace("{BLOQUE_URL_DOCUMENTO}", "", $total_listado_post_personas_resultados);
            }
            //echo "<br> video".$unico->video." imagen".$unico->imagenfondo;
            if ($unico->video) {
                $video_youtube                          = ColocaVideoYoutube($unico->video, $unico->id_mp);
                $total_listado_post_personas_resultados = str_replace("{VIDEO_IMAGEN}", $video_youtube, $total_listado_post_personas_resultados);
            } elseif ($unico->imagenfondo) {
                $bloque_imagen_fondo                    = ColocaImagenPost($unico->imagenfondo);
                $total_listado_post_personas_resultados = str_replace("{VIDEO_IMAGEN}", $bloque_imagen_fondo, $total_listado_post_personas_resultados);
            } else {
                $total_listado_post_personas_resultados = str_replace("{VIDEO_IMAGEN}", "", $total_listado_post_personas_resultados);
            }
            $total_listado_post_personas_resultados = str_replace("{TITULO_R}", $tituloR, $total_listado_post_personas_resultados);
            //tags por post
            $TagsPorPosts                           = TagsPorMPEmpresa($unico->codigo, $id_empresa);
            $tag_por_post                           = "";
            foreach ($TagsPorPosts as $TagsPorPost) {
                $tag_por_post .= '<a href="?sw=com_mp_personal&amb=mp_tag&tag=' . $TagsPorPost->tag . '"><span class="badge_small badge-white"><span class="negro">#' . $TagsPorPost->tag . '</span></span></a> ';
            }
            $total_listado_post_personas_resultados = str_replace("{TAGS_POR_POST}", ($tag_por_post), $total_listado_post_personas_resultados);
        }
        // no encontraste resultados?
        $mp_hacerpregunta .= file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_com_mp_hacer_pregunta.html");
        $mp_hacerpregunta = str_replace("{PREGUNTA}", $tipo_query, $mp_hacerpregunta);
    }
    //AMBIENTE VIDEOS
    //if($ambiente=="videos"){
    if ($id_empresa == 53) {
        //TIMELINE TIPO VIDEOS
        $todas                              = com_mp_lista_personal($id_empresa, $Rut_Perfil, $ord_by, $filt_by, $filt_cat, $vp, $arreglo_tag, $tag, $rut_enviado, "recientes", "6");
        $total_listado_post_tipo_new_videos = "";
        foreach ($todas as $unico) {
            if ($unico->id == 297)
                continue;
            //echo "id ".$unico->video." or ".$unico->imagenfondo." ";
            if ($unico->video <> '') {
                //echo "tipoA_1";
                $total_listado_post_tipo_new_videos .= file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_row_com_mp_persona_listado_tipoV.html");
            } else {
                continue;
            }
            $tiene_megusta = COMUNIDAD_TieneInteraccionPorRut($id_empresa, $unico->id_mp, "MEGUSTA", $rut);
            if ($tiene_megusta) {
                $total_listado_post_tipo_new_videos = str_replace("{BLOQUE_MEGUSTA_POST}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_ya_megusta.html"), $total_listado_post_tipo_new_videos);
            } else {
                $total_listado_post_tipo_new_videos = str_replace("{BLOQUE_MEGUSTA_POST}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_megusta.html"), $total_listado_post_tipo_new_videos);
            }
            $total_listado_post_tipo_new_videos = ColocaCantidadDeMegusta($total_listado_post_tipo_new_videos, $unico->id_mp, $id_empresa);
            $tiene_favorito                     = COMUNIDAD_TieneInteraccionPorRut($id_empresa, $unico->id_mp, "FAVORITA", $rut);
            if ($tiene_favorito) {
                $total_listado_post_tipo_new_videos = str_replace("{BLOQUE_FAVORITO_POR_POST}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_ya_favorito.html"), $total_listado_post_tipo_new_videos);
            } else {
                $total_listado_post_tipo_new_videos = str_replace("{BLOQUE_FAVORITO_POR_POST}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_favorito.html"), $total_listado_post_tipo_new_videos);
            }
            $total_listado_post_tipo_new_videos = str_replace("{HUINCHA_INTERACCIONES}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_huincha_interacciones.html"), $total_listado_post_tipo_new_videos);
            $total_listado_post_tipo_new_videos = ColocaCantidadDeFavorito($total_listado_post_tipo_new_videos, $unico->id_mp, $id_empresa);
            $total_listado_post_tipo_new_videos = str_replace("{ID_MP}", $unico->id_mp, $total_listado_post_tipo_new_videos);
            $total_listado_post_tipo_new_videos = str_replace("{LINK}", $link_MP, $total_listado_post_tipo_new_videos);
            $total_listado_post_tipo_new_videos = str_replace("{CATEGORIA_MP}", ($unico->categoria), $total_listado_post_tipo_new_videos);
            $total_listado_post_tipo_new_videos = str_replace("{DESCRIPCION_CATEGORIA}", utf8_encode($unico->descripcion_categoria), $total_listado_post_tipo_new_videos);
            $total_listado_post_tipo_new_videos = str_replace("{NOMBRE}", ($unico->nombre), $total_listado_post_tipo_new_videos);
            $total_listado_post_tipo_new_videos = str_replace("{CONTENIDO}", limit_text($unico->contenido, 35), $total_listado_post_tipo_new_videos);
            $total_listado_post_tipo_new_videos = str_replace("{FECHA}", formatearFechaSmall($unico->fecha), $total_listado_post_tipo_new_videos);
            $total_listado_post_tipo_new_videos = str_replace("{ESTADO}", ($unico->estado), $total_listado_post_tipo_new_videos);
            $total_listado_post_tipo_new_videos = str_replace("{DESCRIPCION_ESTADO}", ($unico->descripcion_estado), $total_listado_post_tipo_new_videos);
            $total_listado_post_tipo_new_videos = str_replace("{RUT_AUTOR}", ($unico->rut), $total_listado_post_tipo_new_videos);
            $total_listado_post_tipo_new_videos = str_replace("{RUT}", ($rut), $total_listado_post_tipo_new_videos);
            $total_listado_post_tipo_new_videos = str_replace("{NOMBRE_AUTOR}", ($unico->nombre_autor), $total_listado_post_tipo_new_videos);
            $total_listado_post_tipo_new_videos = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($unico->rut), $total_listado_post_tipo_new_videos);
            $total_listado_post_tipo_new_videos = str_replace("{NUMVISITAS}", round($unico->numvisitas), $total_listado_post_tipo_new_videos);
            $total_listado_post_tipo_new_videos = str_replace("{NUMMEGUSTA}", ($unico->nummegusta), $total_listado_post_tipo_new_videos);
            $total_listado_post_tipo_new_videos = str_replace("{NUMCOMPARTIDA}", ($unico->numcompartido), $total_listado_post_tipo_new_videos);
            $total_listado_post_tipo_new_videos = str_replace("{NUMCOMENTARIO}", ($unico->numcomentarios), $total_listado_post_tipo_new_videos);
            $total_listado_post_tipo_new_videos = str_replace("{NUMCOMENTARIOSREALES}", ($unico->numcomentariosreales), $total_listado_post_tipo_new_videos);
            $total_listado_post_tipo_new_videos = str_replace("{NUMFAVORITA}", ($unico->numfavorita), $total_listado_post_tipo_new_videos);
            $total_listado_post_tipo_new_videos = str_replace("{ESTILOESTADO}", ($unico->estilo), $total_listado_post_tipo_new_videos);
            $total_listado_post_tipo_new_videos = str_replace("{ICONOESTADO}", ($unico->icono_estado), $total_listado_post_tipo_new_videos);
            $total_listado_post_tipo_new_videos = str_replace("{ESTILOCATEGORIA}", ($unico->style), $total_listado_post_tipo_new_videos);
            $total_listado_post_tipo_new_videos = str_replace("{ICONOCATEGORIA}", ($unico->icono), $total_listado_post_tipo_new_videos);
            $total_listado_post_tipo_new_videos = str_replace("{CATEGORIA_MP}", ($unico->categoria), $total_listado_post_tipo_new_videos);
            if ($unico->tipo_multimedia == "imagen" and $unico->imagen_fondo <> '') {
                $imagen = "../../front/multimedia/" . $unico->multimedia;
            } else {
                $imagen = "";
            }
            if ($unico->tipo_multimedia == "video") {
                $video = "../../front/multimedia/" . $unico->multimedia;
            } else {
                $video = "";
            }
            $total_listado_post_tipo_new_videos = str_replace("{IMAGEN_POST}", "multimedia/" . $unico->imagenfondo, $total_listado_post_tipo_new_videos);
            $total_listado_post_tipo_new_videos = str_replace("{VIDEO}", ($video), $total_listado_post_tipo_new_videos);
            $total_listado_post_tipo_new_videos = str_replace("{TIPOMULTIMEDIA}", ($unico->tipo_multimedia), $total_listado_post_tipo_new_videos);
            $listado_comentarios                = MuestraComentariosPorPost($unico->id_mp);
            $total_listado_post_tipo_new_videos = str_replace("{BLOQUE_COMENTARIOS}", $listado_comentarios, $total_listado_post_tipo_new_videos);
            if ($unico->url_documento) {
                $total_listado_post_tipo_new_videos = str_replace("{BLOQUE_URL_DOCUMENTO}", file_get_contents("views/comunidad_mp/row_com_mp_url_documento.html"), $total_listado_post_tipo_new_videos);
                $total_listado_post_tipo_new_videos = str_replace("{URL_DOCUMENTO}", ($unico->url_documento), $total_listado_post_tipo_new_videos);
            } else {
                $total_listado_post_tipo_new_videos = str_replace("{BLOQUE_URL_DOCUMENTO}", "", $total_listado_post_tipo_new_videos);
            }
            if ($unico->video) {
                $video_youtube                      = ColocaVideoYoutube($unico->video, $unico->id_mp);
                $total_listado_post_tipo_new_videos = str_replace("{VIDEO_IMAGEN}", $video_youtube, $total_listado_post_tipo_new_videos);
            } else {
                $bloque_imagen_fondo                = ColocaImagenPost($unico->imagenfondo);
                $total_listado_post_tipo_new_videos = str_replace("{VIDEO_IMAGEN}", $bloque_imagen_fondo, $total_listado_post_tipo_new_videos);
            }
        }
    }
    //AMBIENTE BIG
    //if($ambiente=="big"){
    //exit;
    //TIMELINE TIPO NEW BIG
    if ($id_empresa == 53) {
        //echo "<br><br>";
        //$todas=com_mp_lista_personal($id_empresa, $Rut_Perfil, $ord_by, $filt_by, $filt_cat, $vp,$arreglo_tag, $tag, $rut_enviado, "recientes","1","1","1");
        $todas = NoticiaBig();
    }
    $total_listado_post_tipo_news_big = "";
    foreach ($todas as $unico) {
        //echo "id ".$unico->video." or ".$unico->imagenfondo." ";
        if ($unico->video <> '' or $unico->imagenfondo <> '') {
            //echo "tipoA_1";
            $total_listado_post_tipo_news_big .= file_get_contents("views/comunidad_mp/row_com_mp_persona_listado_tipoN.html");
        } else {
            //echo "tipoA";
            $total_listado_post_tipo_news_big .= file_get_contents("views/comunidad_mp/row_com_mp_persona_listado_tipoN.html");
        }
        $tiene_megusta = COMUNIDAD_TieneInteraccionPorRut($id_empresa, $unico->id_mp, "MEGUSTA", $rut);
        if ($tiene_megusta) {
            $total_listado_post_tipo_news_big = str_replace("{BLOQUE_MEGUSTA_POST}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_ya_megusta.html"), $total_listado_post_tipo_news_big);
        } else {
            $total_listado_post_tipo_news_big = str_replace("{BLOQUE_MEGUSTA_POST}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_megusta.html"), $total_listado_post_tipo_news_big);
        }
        $total_listado_post_tipo_news_big = ColocaCantidadDeMegusta($total_listado_post_tipo_news_big, $unico->id_mp, $id_empresa);
        $tiene_favorito                   = COMUNIDAD_TieneInteraccionPorRut($id_empresa, $unico->id_mp, "FAVORITA", $rut);
        if ($tiene_favorito) {
            $total_listado_post_tipo_news_big = str_replace("{BLOQUE_FAVORITO_POR_POST}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_ya_favorito.html"), $total_listado_post_tipo_news_big);
        } else {
            $total_listado_post_tipo_news_big = str_replace("{BLOQUE_FAVORITO_POR_POST}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_favorito.html"), $total_listado_post_tipo_news_big);
        }
        $total_listado_post_tipo_news_big = str_replace("{HUINCHA_INTERACCIONES}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_huincha_interacciones.html"), $total_listado_post_tipo_news_big);
        $total_listado_post_tipo_news_big = ColocaCantidadDeFavorito($total_listado_post_tipo_news_big, $unico->id_mp, $id_empresa);
        $total_listado_post_tipo_news_big = str_replace("{ID_MP}", $unico->id_mp, $total_listado_post_tipo_news_big);
        $total_listado_post_tipo_news_big = str_replace("{LINK}", $link_MP, $total_listado_post_tipo_news_big);
        $total_listado_post_tipo_news_big = str_replace("{CATEGORIA_MP}", ($unico->categoria), $total_listado_post_tipo_news_big);
        $total_listado_post_tipo_news_big = str_replace("{DESCRIPCION_CATEGORIA}", utf8_encode($unico->descripcion_categoria), $total_listado_post_tipo_news_big);
        $total_listado_post_tipo_news_big = str_replace("{NOMBRE}", ($unico->nombre), $total_listado_post_tipo_news_big);
        $total_listado_post_tipo_news_big = str_replace("{CONTENIDO}", limit_text($unico->contenido, 35), $total_listado_post_tipo_news_big);
        $total_listado_post_tipo_news_big = str_replace("{FECHA}", formatearFechaSmall($unico->fecha), $total_listado_post_tipo_news_big);
        $total_listado_post_tipo_news_big = str_replace("{ESTADO}", ($unico->estado), $total_listado_post_tipo_news_big);
        $total_listado_post_tipo_news_big = str_replace("{DESCRIPCION_ESTADO}", ($unico->descripcion_estado), $total_listado_post_tipo_news_big);
        $total_listado_post_tipo_news_big = str_replace("{RUT_AUTOR}", ($unico->rut), $total_listado_post_tipo_news_big);
        $total_listado_post_tipo_news_big = str_replace("{RUT}", ($rut), $total_listado_post_tipo_news_big);
        $total_listado_post_tipo_news_big = str_replace("{NOMBRE_AUTOR}", ($unico->nombre_autor), $total_listado_post_tipo_news_big);
        $total_listado_post_tipo_news_big = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($unico->rut), $total_listado_post_tipo_news_big);
        $total_listado_post_tipo_news_big = str_replace("{NUMVISITAS}", round($unico->numvisitas), $total_listado_post_tipo_news_big);
        $total_listado_post_tipo_news_big = str_replace("{NUMMEGUSTA}", ($unico->nummegusta), $total_listado_post_tipo_news_big);
        $total_listado_post_tipo_news_big = str_replace("{NUMCOMPARTIDA}", ($unico->numcompartido), $total_listado_post_tipo_news_big);
        $total_listado_post_tipo_news_big = str_replace("{NUMCOMENTARIO}", ($unico->numcomentarios), $total_listado_post_tipo_news_big);
        $total_listado_post_tipo_news_big = str_replace("{NUMCOMENTARIOSREALES}", ($unico->numcomentariosreales), $total_listado_post_tipo_news_big);
        $total_listado_post_tipo_news_big = str_replace("{NUMFAVORITA}", ($unico->numfavorita), $total_listado_post_tipo_news_big);
        $total_listado_post_tipo_news_big = str_replace("{ESTILOESTADO}", ($unico->estilo), $total_listado_post_tipo_news_big);
        $total_listado_post_tipo_news_big = str_replace("{ICONOESTADO}", ($unico->icono_estado), $total_listado_post_tipo_news_big);
        $total_listado_post_tipo_news_big = str_replace("{ESTILOCATEGORIA}", ($unico->style), $total_listado_post_tipo_news_big);
        $total_listado_post_tipo_news_big = str_replace("{ICONOCATEGORIA}", ($unico->icono), $total_listado_post_tipo_news_big);
        $total_listado_post_tipo_news_big = str_replace("{CATEGORIA_MP}", ($unico->categoria), $total_listado_post_tipo_news_big);
        if ($unico->tipo_multimedia == "imagen" and $unico->imagen_fondo <> '') {
            $imagen = "../../front/multimedia/" . $unico->multimedia;
        } else {
            $imagen = "";
        }
        if ($unico->tipo_multimedia == "video") {
            $video = "../../front/multimedia/" . $unico->multimedia;
        } else {
            $video = "";
        }
        $total_listado_post_tipo_news_big = str_replace("{IMAGEN_POST}", "multimedia/" . $unico->imagenfondo, $total_listado_post_tipo_news_big);
        $total_listado_post_tipo_news_big = str_replace("{VIDEO}", ($video), $total_listado_post_tipo_news_big);
        $total_listado_post_tipo_news_big = str_replace("{TIPOMULTIMEDIA}", ($unico->tipo_multimedia), $total_listado_post_tipo_news_big);
        $listado_comentarios              = MuestraComentariosPorPost($unico->id_mp);
        $total_listado_post_tipo_news_big = str_replace("{BLOQUE_COMENTARIOS}", $listado_comentarios, $total_listado_post_tipo_news_big);
        if ($unico->url_documento) {
            $total_listado_post_tipo_news_big = str_replace("{BLOQUE_URL_DOCUMENTO}", file_get_contents("views/comunidad_mp/row_com_mp_url_documento.html"), $total_listado_post_tipo_news_big);
            $total_listado_post_tipo_news_big = str_replace("{URL_DOCUMENTO}", ($unico->url_documento), $total_listado_post_tipo_news_big);
        } else {
            $total_listado_post_tipo_news_big = str_replace("{BLOQUE_URL_DOCUMENTO}", "", $total_listado_post_tipo_news_big);
        }
        if ($unico->video) {
            $video_youtube                    = ColocaVideoYoutube($unico->video, $unico->id_mp);
            $total_listado_post_tipo_news_big = str_replace("{VIDEO_IMAGEN}", $video_youtube, $total_listado_post_tipo_news_big);
        } else {
            $bloque_imagen_fondo              = ColocaImagenPost($unico->imagenfondo);
            $total_listado_post_tipo_news_big = str_replace("{VIDEO_IMAGEN}", $bloque_imagen_fondo, $total_listado_post_tipo_news_big);
        }
        $TagsPorPosts = TagsPorMPEmpresa($unico->id_mp, $id_empresa);
        $tag_por_post = "";
        foreach ($TagsPorPosts as $TagsPorPost) {
            $tag_por_post .= '<a href="?sw=com_mp_personal&amb=mp_tag&tag=' . $TagsPorPost->tag . '"><span class="badge_small badge-white"><span class="negro">#' . $TagsPorPost->tag . '</span></span></a> ';
        }
        $total_listado_post_tipo_news_big = str_replace("{TAGS_POR_POST}", ($tag_por_post), $total_listado_post_tipo_news_big);
    }
    //}
    //AMBIENTE 3 POST
    //if($ambiente=="3post"){
    if ($id_empresa == 53) {
        //$todas=com_mp_lista_personal($id_empresa, $Rut_Perfil, $ord_by, $filt_by, $filt_cat, $vp,$arreglo_tag, $tag, $rut_enviado, "recientes","2", "3", "1");
        $todos                              = NoticiaBig2();
        $total_listado_post_tipo_news_3post = "";
        foreach ($todos as $unico) {
            //echo "id ".$unico->video." or ".$unico->imagenfondo." ";
            if ($unico->video <> '' or $unico->imagenfondo <> '') {
                //echo "tipoA_1";
                $total_listado_post_tipo_news_3post .= file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_row_com_mp_persona_listado_tipoN1.html");
            } else {
                //echo "tipoA";
                $total_listado_post_tipo_news_3post .= file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_row_com_mp_persona_listado_tipoN1.html");
            }
            $tiene_megusta = COMUNIDAD_TieneInteraccionPorRut($id_empresa, $unico->id_mp, "MEGUSTA", $rut);
            if ($tiene_megusta) {
                $total_listado_post_tipo_news_3post = str_replace("{BLOQUE_MEGUSTA_POST}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_ya_megusta.html"), $total_listado_post_tipo_news_3post);
            } else {
                $total_listado_post_tipo_news_3post = str_replace("{BLOQUE_MEGUSTA_POST}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_megusta.html"), $total_listado_post_tipo_news_3post);
            }
            $total_listado_post_tipo_news_3post = ColocaCantidadDeMegusta($total_listado_post_tipo_news_3post, $unico->id_mp, $id_empresa);
            $tiene_favorito                     = COMUNIDAD_TieneInteraccionPorRut($id_empresa, $unico->id_mp, "FAVORITA", $rut);
            if ($tiene_favorito) {
                $total_listado_post_tipo_news_3post = str_replace("{BLOQUE_FAVORITO_POR_POST}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_ya_favorito.html"), $total_listado_post_tipo_news_3post);
            } else {
                $total_listado_post_tipo_news_3post = str_replace("{BLOQUE_FAVORITO_POR_POST}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_favorito.html"), $total_listado_post_tipo_news_3post);
            }
            $total_listado_post_tipo_news_3post = str_replace("{HUINCHA_INTERACCIONES}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_huincha_interacciones.html"), $total_listado_post_tipo_news_3post);
            $total_listado_post_tipo_news_3post = ColocaCantidadDeFavorito($total_listado_post_tipo_news_3post, $unico->id_mp, $id_empresa);
            $total_listado_post_tipo_news_3post = str_replace("{ID_MP}", $unico->id_mp, $total_listado_post_tipo_news_3post);
            $total_listado_post_tipo_news_3post = str_replace("{LINK}", $link_MP, $total_listado_post_tipo_news_3post);
            $total_listado_post_tipo_news_3post = str_replace("{CATEGORIA_MP}", ($unico->categoria), $total_listado_post_tipo_news_3post);
            $total_listado_post_tipo_news_3post = str_replace("{DESCRIPCION_CATEGORIA}", utf8_encode($unico->descripcion_categoria), $total_listado_post_tipo_news_3post);
            $total_listado_post_tipo_news_3post = str_replace("{NOMBRE}", ($unico->nombre), $total_listado_post_tipo_news_3post);
            $total_listado_post_tipo_news_3post = str_replace("{CONTENIDO}", limit_text($unico->contenido, 35), $total_listado_post_tipo_news_3post);
            $total_listado_post_tipo_news_3post = str_replace("{FECHA}", formatearFechaSmall($unico->fecha), $total_listado_post_tipo_news_3post);
            $total_listado_post_tipo_news_3post = str_replace("{ESTADO}", ($unico->estado), $total_listado_post_tipo_news_3post);
            $total_listado_post_tipo_news_3post = str_replace("{DESCRIPCION_ESTADO}", ($unico->descripcion_estado), $total_listado_post_tipo_news_3post);
            $total_listado_post_tipo_news_3post = str_replace("{RUT_AUTOR}", ($unico->rut), $total_listado_post_tipo_news_3post);
            $total_listado_post_tipo_news_3post = str_replace("{RUT}", ($rut), $total_listado_post_tipo_news_3post);
            $total_listado_post_tipo_news_3post = str_replace("{NOMBRE_AUTOR}", ($unico->nombre_autor), $total_listado_post_tipo_news_3post);
            $total_listado_post_tipo_news_3post = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($unico->rut), $total_listado_post_tipo_news_3post);
            $total_listado_post_tipo_news_3post = str_replace("{NUMVISITAS}", round($unico->numvisitas), $total_listado_post_tipo_news_3post);
            $total_listado_post_tipo_news_3post = str_replace("{NUMMEGUSTA}", ($unico->nummegusta), $total_listado_post_tipo_news_3post);
            $total_listado_post_tipo_news_3post = str_replace("{NUMCOMPARTIDA}", ($unico->numcompartido), $total_listado_post_tipo_news_3post);
            $total_listado_post_tipo_news_3post = str_replace("{NUMCOMENTARIO}", ($unico->numcomentarios), $total_listado_post_tipo_news_3post);
            $total_listado_post_tipo_news_3post = str_replace("{NUMCOMENTARIOSREALES}", ($unico->numcomentariosreales), $total_listado_post_tipo_news_3post);
            $total_listado_post_tipo_news_3post = str_replace("{NUMFAVORITA}", ($unico->numfavorita), $total_listado_post_tipo_news_3post);
            $total_listado_post_tipo_news_3post = str_replace("{ESTILOESTADO}", ($unico->estilo), $total_listado_post_tipo_news_3post);
            $total_listado_post_tipo_news_3post = str_replace("{ICONOESTADO}", ($unico->icono_estado), $total_listado_post_tipo_news_3post);
            $total_listado_post_tipo_news_3post = str_replace("{ESTILOCATEGORIA}", ($unico->style), $total_listado_post_tipo_news_3post);
            $total_listado_post_tipo_news_3post = str_replace("{ICONOCATEGORIA}", ($unico->icono), $total_listado_post_tipo_news_3post);
            $total_listado_post_tipo_news_3post = str_replace("{CATEGORIA_MP}", ($unico->categoria), $total_listado_post_tipo_news_3post);
            if ($unico->tipo_multimedia == "imagen" and $unico->imagen_fondo <> '') {
                $imagen = "../../front/multimedia/" . $unico->multimedia;
            } else {
                $imagen = "";
            }
            if ($unico->tipo_multimedia == "video") {
                $video = "../../front/multimedia/" . $unico->multimedia;
            } else {
                $video = "";
            }
            $total_listado_post_tipo_news_3post = str_replace("{IMAGEN_POST}", "multimedia/" . $unico->imagenfondo, $total_listado_post_tipo_news_3post);
            $total_listado_post_tipo_news_3post = str_replace("{VIDEO}", ($video), $total_listado_post_tipo_news_3post);
            $total_listado_post_tipo_news_3post = str_replace("{TIPOMULTIMEDIA}", ($unico->tipo_multimedia), $total_listado_post_tipo_news_3post);
            $listado_comentarios                = MuestraComentariosPorPost($unico->id_mp);
            $total_listado_post_tipo_news_3post = str_replace("{BLOQUE_COMENTARIOS}", $listado_comentarios, $total_listado_post_tipo_news_3post);
            if ($unico->url_documento) {
                $total_listado_post_tipo_news_3post = str_replace("{BLOQUE_URL_DOCUMENTO}", file_get_contents("views/comunidad_mp/row_com_mp_url_documento.html"), $total_listado_post_tipo_news_3post);
                $total_listado_post_tipo_news_3post = str_replace("{URL_DOCUMENTO}", ($unico->url_documento), $total_listado_post_tipo_news_3post);
            } else {
                $total_listado_post_tipo_news_3post = str_replace("{BLOQUE_URL_DOCUMENTO}", "", $total_listado_post_tipo_news_3post);
            }
            if ($unico->video) {
                $video_youtube                      = ColocaVideoYoutube($unico->video, $unico->id_mp);
                $total_listado_post_tipo_news_3post = str_replace("{VIDEO_IMAGEN}", $video_youtube, $total_listado_post_tipo_news_3post);
            } else {
                $bloque_imagen_fondo                = ColocaImagenPost($unico->imagenfondo);
                $total_listado_post_tipo_news_3post = str_replace("{VIDEO_IMAGEN}", $bloque_imagen_fondo, $total_listado_post_tipo_news_3post);
            }
        }
    }
    // FRASE
    // mas publicadores grupo interes 1
    $mas_grupo_interes1            = com_mp_post_rank_categorias($id_empresa, "1");
    $mas_post_rut_grupo_interes1   = com_mp_post_rank_mas_publicador_categoria($mas_grupo_interes1[0]->id_categoria, $id_empresa, $subcategoria);
    $mas_post_grupo_interes1       = com_mp_post_rank_rut_mas_publicador_categoria($mas_post_rut_grupo_interes1[0]->rut, $mas_grupo_interes1[0]->id_categoria, $id_empresa);
    $total_mas_post_grupo_interes1 = "";
    foreach ($mas_post_grupo_interes1 as $mas_post_g1) {
        $seguidores1 = $mas_post_g1->seguidores . " seguidores";
        $total_mas_post_grupo_interes1 .= file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_row_com_mp_people_mini.html");
        $total_mas_post_grupo_interes1 = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($mas_post_g1->rut), $total_mas_post_grupo_interes1);
        $total_mas_post_grupo_interes1 = str_replace("{ID_MP}", $mas_post_g1->id_mp, $total_mas_post_grupo_interes1);
        $total_mas_post_grupo_interes1 = str_replace("{CATEGORIA_MP}", ($mas_post_g1->categoria), $total_mas_post_grupo_interes1);
        $total_mas_post_grupo_interes1 = str_replace("{DESCRIPCION_CATEGORIA}", utf8_encode($mas_post_g1->descripcion_categoria), $total_mas_post_grupo_interes1);
        $total_mas_post_grupo_interes1 = str_replace("{NOMBRE}", ($mas_post_g1->nombre_autor), $total_mas_post_grupo_interes1);
        $total_mas_post_grupo_interes1 = str_replace("{CONTENIDO}", limit_text($mas_post_g1->contenido, 35), $total_mas_post_grupo_interes1);
        $total_mas_post_grupo_interes1 = str_replace("{SEGUIDORES}", $seguidores1, $total_mas_post_grupo_interes1);
        $total_mas_post_grupo_interes1 = str_replace("{PUNTOS}", "", $total_mas_post_grupo_interes1);
        /*
        $total_mas_post_grupo_interes1= str_replace("{FECHA}",formatearFechaSmall($mas_post_g1->fecha),$total_mas_post_grupo_interes1);
        $total_mas_post_grupo_interes1= str_replace("{ESTADO}",($mas_post_g1->estado),$total_mas_post_grupo_interes1);
        $total_mas_post_grupo_interes1= str_replace("{DESCRIPCION_ESTADO}",($mas_post_g1->descripcion_estado),$total_mas_post_grupo_interes1);
        $total_mas_post_grupo_interes1= str_replace("{RUT_AUTOR}",($mas_post_g1->rut),$total_mas_post_grupo_interes1);
        $total_mas_post_grupo_interes1= str_replace("{RUT}",($rut),$total_mas_post_grupo_interes1);
        $total_mas_post_grupo_interes1= str_replace("{NOMBRE_AUTOR}",($mas_post_g1->nombre_autor),$total_mas_post_grupo_interes1);
        $total_mas_post_grupo_interes1= str_replace("{FOTO_AUTOR}",VerificaFotoPersonal($mas_post_g1->rut),$total_mas_post_grupo_interes1);
        $total_mas_post_grupo_interes1= str_replace("{ESTILOESTADO}",($mas_post_g1->estilo),$total_mas_post_grupo_interes1);
        $total_mas_post_grupo_interes1= str_replace("{ICONOESTADO}",($mas_post_g1->icono_estado),$total_mas_post_grupo_interes1);
        $total_mas_post_grupo_interes1= str_replace("{ESTILOCATEGORIA}",($mas_post_g1->style),$total_mas_post_grupo_interes1);
        $total_mas_post_grupo_interes1= str_replace("{ICONOCATEGORIA}",($mas_post_g1->icono),$total_mas_post_grupo_interes1);
        $total_mas_post_grupo_interes1= str_replace("{CATEGORIA_MP}",($mas_post_g1->categoria),$total_mas_post_grupo_interes1);
        * */
        $total_mas_post_grupo_interes1 = str_replace("{NOMBRE}", ($mas_post_g1->nombre), $total_mas_post_grupo_interes1);
        $total_mas_post_grupo_interes1 = str_replace("{RUT_ENVIADO}", ($mas_post_g1->rut), $total_mas_post_grupo_interes1);
        $total_mas_post_grupo_interes1 = str_replace("{ID_MP}", ($mas_post_g1->id_mp), $total_mas_post_grupo_interes1);
        // BOTON SEGUIR
        $sesiguepersona                = count(VerificandompaSeguidores($rut, $mas_post_g1->rut, $id_empresa));
        if ($sesiguepersona > 0) {
            $boton_seguir = "
<center>
    <div class='badge_small badge-verde blanco mgtop5'>
        <i class='icon-check icons'></i> Siguiendo
    </div>
    <a href='?sw=com_mp_personal&rut_enviado=" . $mas_post_g1->rut . "&vp=1&sg=2' class='badge_small bg-white_borderBlue negro'> <i class='icon-user-following icons'></i> Dejar de seguir (-)</a>
</center>
";
        } else {
            $boton_seguir = "
<center>
    <a href='?sw=com_mp_personal&rut_enviado=" . $mas_post_g1->rut . "&vp=1&sg=1'
    class='badge_small bg-amarillos negro'> <i class='icon-user-following icons'></i> Seguir (+)</a>
</center>";
        }
        $total_mas_post_grupo_interes1 = str_replace("{BOTON_SEGUIR}", ($boton_seguir), $total_mas_post_grupo_interes1);
    }
    // mas publicadores grupo interes 2
    $mas_grupo_interes2          = com_mp_post_rank_categorias($id_empresa, "2");
    $mas_post_rut_grupo_interes2 = com_mp_post_rank_mas_publicador_categoria($mas_grupo_interes2[0]->id_categoria, $id_empresa, $subcategoria);
    $mas_post_grupo_interes2     = com_mp_post_rank_rut_mas_publicador_categoria($mas_post_rut_grupo_interes2[0]->rut, $mas_grupo_interes2[0]->id_categoria, $id_empresa);
    foreach ($mas_post_grupo_interes2 as $mas_post_g2) {
        $seguidores2 = $mas_post_g2->seguidores . " seguidores";
        $total_mas_post_grupo_interes2 .= file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_row_com_mp_people_mini.html");
        $total_mas_post_grupo_interes2 = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($mas_post_g2->rut), $total_mas_post_grupo_interes2);
        $total_mas_post_grupo_interes2 = str_replace("{HUINCHA_INTERACCIONES}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_huincha_interacciones.html"), $total_mas_post_grupo_interes2);
        $total_mas_post_grupo_interes2 = str_replace("{ID_MP}", $mas_post_g2->id_mp, $total_mas_post_grupo_interes2);
        $total_mas_post_grupo_interes2 = str_replace("{CATEGORIA_MP}", ($mas_post_g2->categoria), $total_mas_post_grupo_interes2);
        $total_mas_post_grupo_interes2 = str_replace("{DESCRIPCION_CATEGORIA}", utf8_encode($mas_post_g2->descripcion_categoria), $total_mas_post_grupo_interes2);
        $total_mas_post_grupo_interes2 = str_replace("{NOMBRE}", ($mas_post_g2->nombre_autor), $total_mas_post_grupo_interes2);
        $total_mas_post_grupo_interes2 = str_replace("{CONTENIDO}", limit_text($mas_post_g2->contenido, 35), $total_mas_post_grupo_interes2);
        $total_mas_post_grupo_interes2 = str_replace("{SEGUIDORES}", $seguidores2, $total_mas_post_grupo_interes2);
        $total_mas_post_grupo_interes2 = str_replace("{PUNTOS}", "", $total_mas_post_grupo_interes2);
        /*
        $total_mas_post_grupo_interes2= str_replace("{CONTENIDO}",limit_text($mas_post_g2->contenido,35),$total_mas_post_grupo_interes2);
        $total_mas_post_grupo_interes2= str_replace("{FECHA}",formatearFechaSmall($mas_post_g2->fecha),$total_mas_post_grupo_interes2);
        $total_mas_post_grupo_interes2= str_replace("{ESTADO}",($mas_post_g2->estado),$total_mas_post_grupo_interes2);
        $total_mas_post_grupo_interes2= str_replace("{DESCRIPCION_ESTADO}",($mas_post_g2->descripcion_estado),$total_mas_post_grupo_interes2);
        $total_mas_post_grupo_interes2= str_replace("{RUT_AUTOR}",($mas_post_g2->rut),$total_mas_post_grupo_interes2);
        $total_mas_post_grupo_interes2= str_replace("{RUT}",($rut),$total_mas_post_grupo_interes2);
        $total_mas_post_grupo_interes2= str_replace("{NOMBRE_AUTOR}",($mas_post_g2->nombre_autor),$total_mas_post_grupo_interes2);
        $total_mas_post_grupo_interes2= str_replace("{FOTO_AUTOR}",VerificaFotoPersonal($mas_post_g2->rut),$total_mas_post_grupo_interes2);
        $total_mas_post_grupo_interes2= str_replace("{ESTILOESTADO}",($mas_post_g2->estilo),$total_mas_post_grupo_interes2);
        $total_mas_post_grupo_interes2= str_replace("{ICONOESTADO}",($mas_post_g2->icono_estado),$total_mas_post_grupo_interes2);
        $total_mas_post_grupo_interes2= str_replace("{ESTILOCATEGORIA}",($mas_post_g2->style),$total_mas_post_grupo_interes2);
        $total_mas_post_grupo_interes2= str_replace("{ICONOCATEGORIA}",($mas_post_g2->icono),$total_mas_post_grupo_interes2);
        $total_mas_post_grupo_interes2= str_replace("{CATEGORIA_MP}",($mas_post_g2->categoria),$total_mas_post_grupo_interes2);
        $total_mas_post_grupo_interes2= str_replace("{NOMBRE}",($mas_post_g2->nombre),$total_mas_post_grupo_interes2);
        */
        $total_mas_post_grupo_interes2 = str_replace("{RUT_ENVIADO}", ($mas_post_g2->rut), $total_mas_post_grupo_interes2);
        $total_mas_post_grupo_interes2 = str_replace("{ID_MP}", ($mas_post_g2->id_mp), $total_mas_post_grupo_interes2);
        // BOTON SEGUIR
        $sesiguepersona                = count(VerificandompaSeguidores($rut, $mas_post_g2->rut, $id_empresa));
        if ($sesiguepersona > 0) {
            $boton_seguir = "
<center>
    <div class='badge_small badge-verde blanco mgtop5'>
        <i class='icon-check icons'></i> Siguiendo
    </div>
    <a href='?sw=com_mp_personal&rut_enviado=" . $mas_post_g2->rut . "&vp=1&sg=2' class='badge_small bg-white_borderBlue negro'> <i class='icon-user-following icons'></i> Dejar de seguir (-)</a>
</center>
";
        } else {
            $boton_seguir = "
<center>
    <a href='?sw=com_mp_personal&rut_enviado=" . $mas_post_g2->rut . "&vp=1&sg=1'
    class='badge_small bg-amarillos negro'> <i class='icon-user-following icons'></i> Seguir (+)</a>
</center>";
        }
        $total_mas_post_grupo_interes2 = str_replace("{BOTON_SEGUIR}", ($boton_seguir), $total_mas_post_grupo_interes2);
    }
    // mas publicadores grupo interes 3
    $mas_grupo_interes3          = com_mp_post_rank_categorias($id_empresa, "3");
    $mas_post_rut_grupo_interes3 = com_mp_post_rank_mas_publicador_categoria($mas_grupo_interes3[0]->id_categoria, $id_empresa, $subcategoria);
    $mas_post_grupo_interes3     = com_mp_post_rank_rut_mas_publicador_categoria($mas_post_rut_grupo_interes3[0]->rut, $mas_grupo_interes3[0]->id_categoria, $id_empresa);
    foreach ($mas_post_grupo_interes3 as $mas_post_g3) {
        $seguidores3 = $mas_post_g3->seguidores . " seguidores";
        $total_mas_post_grupo_interes3 .= file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_row_com_mp_people_mini.html");
        $total_mas_post_grupo_interes3 = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($mas_post_g3->rut), $total_mas_post_grupo_interes3);
        $total_mas_post_grupo_interes3 = str_replace("{HUINCHA_INTERACCIONES}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_huincha_interacciones.html"), $total_mas_post_grupo_interes3);
        $total_mas_post_grupo_interes3 = str_replace("{ID_MP}", $mas_post_g3->id_mp, $total_mas_post_grupo_interes3);
        $total_mas_post_grupo_interes3 = str_replace("{CATEGORIA_MP}", ($mas_post_g3->categoria), $total_mas_post_grupo_interes3);
        $total_mas_post_grupo_interes3 = str_replace("{DESCRIPCION_CATEGORIA}", utf8_encode($mas_post_g3->descripcion_categoria), $total_mas_post_grupo_interes3);
        $total_mas_post_grupo_interes3 = str_replace("{NOMBRE}", ($mas_post_g3->nombre_autor), $total_mas_post_grupo_interes3);
        $total_mas_post_grupo_interes3 = str_replace("{SEGUIDORES}", $seguidores3, $total_mas_post_grupo_interes3);
        $total_mas_post_grupo_interes3 = str_replace("{PUNTOS}", "", $total_mas_post_grupo_interes3);
        /*
        $total_mas_post_grupo_interes3= str_replace("{CONTENIDO}",limit_text($mas_post_g3->contenido,35),$total_mas_post_grupo_interes3);
        $total_mas_post_grupo_interes3= str_replace("{FECHA}",formatearFechaSmall($mas_post_g3->fecha),$total_mas_post_grupo_interes3);
        $total_mas_post_grupo_interes3= str_replace("{ESTADO}",($mas_post_g3->estado),$total_mas_post_grupo_interes3);
        $total_mas_post_grupo_interes3= str_replace("{DESCRIPCION_ESTADO}",($mas_post_g3->descripcion_estado),$total_mas_post_grupo_interes3);
        $total_mas_post_grupo_interes3= str_replace("{RUT_AUTOR}",($mas_post_g3->rut),$total_mas_post_grupo_interes3);
        $total_mas_post_grupo_interes3= str_replace("{RUT}",($rut),$total_mas_post_grupo_interes3);
        $total_mas_post_grupo_interes3= str_replace("{NOMBRE_AUTOR}",($mas_post_g3->nombre_autor),$total_mas_post_grupo_interes3);
        $total_mas_post_grupo_interes3= str_replace("{FOTO_AUTOR}",VerificaFotoPersonal($mas_post_g3->rut),$total_mas_post_grupo_interes3);
        $total_mas_post_grupo_interes3= str_replace("{ESTILOESTADO}",($mas_post_g3->estilo),$total_mas_post_grupo_interes3);
        $total_mas_post_grupo_interes3= str_replace("{ICONOESTADO}",($mas_post_g3->icono_estado),$total_mas_post_grupo_interes3);
        $total_mas_post_grupo_interes3= str_replace("{ESTILOCATEGORIA}",($mas_post_g3->style),$total_mas_post_grupo_interes3);
        $total_mas_post_grupo_interes3= str_replace("{ICONOCATEGORIA}",($mas_post_g3->icono),$total_mas_post_grupo_interes3);
        $total_mas_post_grupo_interes3= str_replace("{CATEGORIA_MP}",($mas_post_g3->categoria),$total_mas_post_grupo_interes3);
        $total_mas_post_grupo_interes3= str_replace("{NOMBRE}",($mas_post_g3->nombre),$total_mas_post_grupo_interes3);
        * */
        $total_mas_post_grupo_interes3 = str_replace("{RUT_ENVIADO}", ($mas_post_g3->rut), $total_mas_post_grupo_interes3);
        $total_mas_post_grupo_interes3 = str_replace("{ID_MP}", ($mas_post_g3->id_mp), $total_mas_post_grupo_interes3);
        // BOTON SEGUIR
        $sesiguepersona                = count(VerificandompaSeguidores($rut, $mas_post_g3->rut, $id_empresa));
        if ($sesiguepersona > 0) {
            $boton_seguir = "
<center>
    <div class='badge_small badge-verde blanco mgtop5'>
        <i class='icon-check icons'></i> Siguiendo
    </div>
    <a href='?sw=com_mp_personal&rut_enviado=" . $mas_post_g3->rut . "&vp=1&sg=2' class='badge_small bg-white_borderBlue negro'> <i class='icon-user-following icons'></i> Dejar de seguir (-)</a>
</center>
";
        } else {
            $boton_seguir = "
<center>
    <a href='?sw=com_mp_personal&rut_enviado=" . $mas_post_g3->rut . "&vp=1&sg=1'
    class='badge_small bg-amarillos negro'> <i class='icon-user-following icons'></i> Seguir (+)</a>
</center>";
        }
        $total_mas_post_grupo_interes3 = str_replace("{BOTON_SEGUIR}", ($boton_seguir), $total_mas_post_grupo_interes3);
    }
    $ultimos_posteos_publicados       = com_mp_preguntas_ultimos_recientes($rut, $id_empresa, $subcategoria);
    $total_ultimos_posteos_publicados = "";
    //print_r($ultimos_posteos_publicados);
    foreach ($ultimos_posteos_publicados as $post_reciente) {
        $total_ultimos_posteos_publicados .= file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_row_com_mp_mini.html");
        $total_ultimos_posteos_publicados = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($post_reciente->rut), $total_ultimos_posteos_publicados);
        $total_ultimos_posteos_publicados = str_replace("{ID_MP}", $post_reciente->id_mp, $total_ultimos_posteos_publicados);
        $total_ultimos_posteos_publicados = str_replace("{LINK}", $link_MP, $total_ultimos_posteos_publicados);
        $total_ultimos_posteos_publicados = str_replace("{TIPO}", "F", $total_ultimos_posteos_publicados);
        $total_ultimos_posteos_publicados = str_replace("{CATEGORIA_MP}", ($post_reciente->categoria), $total_ultimos_posteos_publicados);
        $total_ultimos_posteos_publicados = str_replace("{DESCRIPCION_CATEGORIA}", utf8_encode($post_reciente->descripcion_categoria), $total_ultimos_posteos_publicados);
        $total_ultimos_posteos_publicados = str_replace("{NOMBRE}", ($post_reciente->nombre), $total_ultimos_posteos_publicados);
        /*    $total_ultimos_posteos_publicados= str_replace("{CONTENIDO}",limit_text($post_reciente->contenido,35),$total_ultimos_posteos_publicados);
        $total_ultimos_posteos_publicados= str_replace("{FECHA}",formatearFechaSmall($post_reciente->fecha),$total_ultimos_posteos_publicados);
        $total_ultimos_posteos_publicados= str_replace("{ESTADO}",($post_reciente->estado),$total_ultimos_posteos_publicados);
        $total_ultimos_posteos_publicados= str_replace("{DESCRIPCION_ESTADO}",($post_reciente->descripcion_estado),$total_ultimos_posteos_publicados);
        */
        $total_ultimos_posteos_publicados = str_replace("{RUT_AUTOR}", ($post_reciente->rut), $total_ultimos_posteos_publicados);
        $total_ultimos_posteos_publicados = str_replace("{RUT}", ($rut), $total_ultimos_posteos_publicados);
        $total_ultimos_posteos_publicados = str_replace("{NOMBRE_AUTOR}", ($post_reciente->nombre_autor), $total_ultimos_posteos_publicados);
        $total_ultimos_posteos_publicados = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($post_reciente->rut), $total_ultimos_posteos_publicados);
        $total_ultimos_posteos_publicados = str_replace("{ESTILOESTADO}", ($post_reciente->estilo), $total_ultimos_posteos_publicados);
        $total_ultimos_posteos_publicados = str_replace("{ICONOESTADO}", ($post_reciente->icono_estado), $total_ultimos_posteos_publicados);
        $total_ultimos_posteos_publicados = str_replace("{ESTILOCATEGORIA}", ($post_reciente->style), $total_ultimos_posteos_publicados);
        $total_ultimos_posteos_publicados = str_replace("{ICONOCATEGORIA}", ($post_reciente->icono), $total_ultimos_posteos_publicados);
        $total_ultimos_posteos_publicados = str_replace("{CATEGORIA_MP}", ($post_reciente->categoria), $total_ultimos_posteos_publicados);
        /*
        $total_ultimos_posteos_publicados= str_replace("{IMAGEN_POST}","multimedia/".$post_reciente->imagenfondo,$total_ultimos_posteos_publicados);
        $total_ultimos_posteos_publicados= str_replace("{VIDEO}",($video),$total_ultimos_posteos_publicados);
        $total_ultimos_posteos_publicados= str_replace("{TIPOMULTIMEDIA}",($post_reciente->tipo_multimedia),$total_ultimos_posteos_publicados);
        */
        $total_ultimos_posteos_publicados = str_replace("{NOMBRE}", ($post_reciente->nombre), $total_ultimos_posteos_publicados);
        $total_ultimos_posteos_publicados = str_replace("{RUT_ENVIADO}", ($post_reciente->rut), $total_ultimos_posteos_publicados);
        $total_ultimos_posteos_publicados = str_replace("{ID_MP}", ($post_reciente->id_mp), $total_ultimos_posteos_publicados);
    }
    //ultimas preguntas para responder
    $ultimos_preguntas_publicadas_sinresponder = com_mp_preguntas_ultimos_recientes($rut, $id_empresa);
    $total_preguntas_sin_responder             = "";
    foreach ($ultimos_preguntas_publicadas_sinresponder as $pregunta_experto) {
        if ($subcategoria <> '' and $subcategoria <> $pregunta_experto->id_subcategoria) {
            continue;
        }
        if ($subcategoria == '' and $pregunta_experto->id_subcategoria <> '') {
            continue;
        }
        $total_preguntas_sin_responder .= file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_row_com_mp_persona_listado_tipoPRG.html");
        $post_categoria                = '<a href="?sw=com_mp_personal&amb=mp_cat&idcat=' . $pregunta_experto->id_categoria . '&cat=' . $pregunta_experto->categoria . '"><span class="badge_small badge-azul"><span class="blanco"><i class="icon-people icons"></i> ' . $pregunta_experto->categoria . '</span></span></a>';
        $ico                           = "img/bci_mp_pregunta_icon.png";
        $total_preguntas_sin_responder = str_replace("{ICONO}", $ico, $total_preguntas_sin_responder);
        $total_preguntas_sin_responder = str_replace("{DESC_ICONO}", $pregunta_experto->tipo, $total_preguntas_sin_responder);
        $total_preguntas_sin_responder = str_replace("{DESCRIPCION_CATEGORIA}", utf8_encode($pregunta_experto->descripcion_categoria), $total_preguntas_sin_responder);
        $total_preguntas_sin_responder = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($pregunta_experto->rut), $total_preguntas_sin_responder);
        $total_preguntas_sin_responder = str_replace("{ID_MP}", $pregunta_experto->id_mp, $total_preguntas_sin_responder);
        $total_preguntas_sin_responder = str_replace("{LINK}", $link_MP, $total_preguntas_sin_responder);
        $total_preguntas_sin_responder = str_replace("{TIPO}", "F", $total_preguntas_sin_responder);
        $total_preguntas_sin_responder = str_replace("{DESCRIPCION_CATEGORIA}", utf8_encode($pregunta_experto->descripcion_categoria), $total_preguntas_sin_responder);
        $total_preguntas_sin_responder = str_replace("{NOMBRE}", ($pregunta_experto->nombre), $total_preguntas_sin_responder);
        $total_preguntas_sin_responder = str_replace("{RUT_AUTOR}", ($pregunta_experto->rut), $total_preguntas_sin_responder);
        $total_preguntas_sin_responder = str_replace("{RUT}", ($rut), $total_preguntas_sin_responder);
        $total_preguntas_sin_responder = str_replace("{NOMBRE_AUTOR}", ($pregunta_experto->nombre_autor), $total_preguntas_sin_responder);
        $total_preguntas_sin_responder = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($pregunta_experto->rut), $total_preguntas_sin_responder);
        $total_preguntas_sin_responder = str_replace("{ESTILOESTADO}", ($pregunta_experto->estilo), $total_preguntas_sin_responder);
        $total_preguntas_sin_responder = str_replace("{ICONOESTADO}", ($pregunta_experto->icono_estado), $total_preguntas_sin_responder);
        $total_preguntas_sin_responder = str_replace("{ESTILOCATEGORIA}", ($pregunta_experto->style), $total_preguntas_sin_responder);
        $total_preguntas_sin_responder = str_replace("{ICONOCATEGORIA}", ($pregunta_experto->icono), $total_preguntas_sin_responder);
        $total_preguntas_sin_responder = str_replace("{CATEGORIA_MP}", ($post_categoria), $total_preguntas_sin_responder);
        $total_preguntas_sin_responder = str_replace("{NOMBRE}", ($pregunta_experto->nombre), $total_preguntas_sin_responder);
        $total_preguntas_sin_responder = str_replace("{RUT_ENVIADO}", ($pregunta_experto->rut), $total_preguntas_sin_responder);
        $total_preguntas_sin_responder = str_replace("{ID_MP}", ($pregunta_experto->id_mp), $total_preguntas_sin_responder);
        $total_preguntas_sin_responder = str_replace("{TIPO}", "A", $total_preguntas_sin_responder);
        $total_preguntas_sin_responder = str_replace("{ID_MP}", ($pregunta_experto->codigo), $total_preguntas_sin_responder);
        $total_preguntas_sin_responder = str_replace("{ID_MP_ENCODEADO}", Encodear3($pregunta_experto->id_mp), $total_preguntas_sin_responder);
        $total_preguntas_sin_responder = str_replace("{CONTENIDO}", $pregunta_experto->resumen, $total_preguntas_sin_responder);
        $total_preguntas_sin_responder = str_replace("{FECHA}", formatearFechaSmall($pregunta_experto->fecha), $total_preguntas_sin_responder);
        $total_preguntas_sin_responder = str_replace("{ESTADO}", ($pregunta_experto->estado), $total_preguntas_sin_responder);
        $total_preguntas_sin_responder = str_replace("{RUT}", ($rut), $total_preguntas_sin_responder);
        $total_preguntas_sin_responder = str_replace("{NOMBRE_AUTOR}", ($pregunta_experto->nombre_autor), $total_preguntas_sin_responder);
        $total_preguntas_sin_responder = str_replace("{NUMVISITAS}", round($pregunta_experto->numvisitas), $total_preguntas_sin_responder);
        $total_preguntas_sin_responder = str_replace("{EDITAR_RESPONDER_PREGUNTA_MP}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_responder_mp.html"), $total_preguntas_sin_responder);
        $total_preguntas_sin_responder = str_replace("{ID_MP_ENCODEADO}", Encodear3($pregunta_experto->id_mp), $total_preguntas_sin_responder);
    }
    $mp_com_frases_comunidad = com_mp_frases($id_empresa);
    //print_r($mp_com_frases);
    $total_mp_com_frases     = "";
    foreach ($mp_com_frases_comunidad as $mp_com_frase_comunidad) {
        $total_mp_com_frases .= file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_com_mp_frases.html");
        $total_mp_com_frases = str_replace("{FRASE}", ($mp_com_frase_comunidad->frase), $total_mp_com_frases);
        $total_mp_com_frases = str_replace("{AUTOR}", ($mp_com_frase_comunidad->autor), $total_mp_com_frases);
    }
    // MP MAS VALORADOS
    $posteos_mas_valorados       = com_mp_post_mas_valorados($rut, $id_empresa, $subcategoria);
    $total_posteos_mas_valorados = "";
    //print_r($posteos_mas_valorados);
    foreach ($posteos_mas_valorados as $post_recent) {
        if ($subcategoria <> '' and $subcategoria <> $post_recent->id_subcategoria) {
            continue;
        }
        if ($subcategoria == '' and $post_recent->id_subcategoria <> '') {
            continue;
        }
        $total_posteos_mas_valorados .= file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_row_com_mp_mini.html");
        $total_posteos_mas_valorados = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($post_recent->rut), $total_posteos_mas_valorados);
        $total_posteos_mas_valorados = str_replace("{ID_MP}", $post_recent->id_mp, $total_posteos_mas_valorados);
        $total_posteos_mas_valorados = str_replace("{LINK}", $link_MP, $total_posteos_mas_valorados);
        $total_posteos_mas_valorados = str_replace("{TIPO}", "F", $total_posteos_mas_valorados);
        $total_posteos_mas_valorados = str_replace("{CATEGORIA_MP}", ($post_recent->categoria), $total_posteos_mas_valorados);
        $total_posteos_mas_valorados = str_replace("{DESCRIPCION_CATEGORIA}", utf8_encode($post_recent->descripcion_categoria), $total_posteos_mas_valorados);
        $total_posteos_mas_valorados = str_replace("{NOMBRE}", ($post_recent->nombre), $total_posteos_mas_valorados);
        if ($id_empresa == 53) {
            $total_posteos_mas_valorados = str_replace("{CONTENIDO}", substr($post_recent->contenido, 0, 150), $total_posteos_mas_valorados);
        } else {
            $total_posteos_mas_valorados = str_replace("{CONTENIDO}", ($post_recent->contenido), $total_posteos_mas_valorados);
        }
        $total_posteos_mas_valorados = str_replace("{HUINCHA_INTERACCIONES}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_huincha_interacciones.html"), $total_posteos_mas_valorados);
        if ($post_recent->rut == $rut) {
            $total_posteos_mas_valorados = str_replace("{EDITAR_MP}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_editar_mp.html"), $total_posteos_mas_valorados);
            $total_posteos_mas_valorados = str_replace("{ELIMINAR_MP}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_borrar_mp.html"), $total_posteos_mas_valorados);
        } else {
            $total_posteos_mas_valorados = str_replace("{EDITAR_MP}", "", $total_posteos_mas_valorados);
            $total_posteos_mas_valorados = str_replace("{ELIMINAR_MP}", "", $total_posteos_mas_valorados);
        }
        $tiene_megusta = COMUNIDAD_TieneInteraccionPorRut($id_empresa, $post_recent->id_mp, "MEGUSTA", $rut);
        if ($tiene_megusta) {
            $total_posteos_mas_valorados = str_replace("{BLOQUE_MEGUSTA_POST}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_ya_megusta.html"), $total_posteos_mas_valorados);
        } else {
            $total_posteos_mas_valorados = str_replace("{BLOQUE_MEGUSTA_POST}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_megusta.html"), $total_posteos_mas_valorados);
        }
        $tiene_no_megusta = COMUNIDAD_TieneInteraccionPorRut($id_empresa, $post_recent->id_mp, "NOMEGUSTA", $rut);
        if ($tiene_no_megusta) {
            $total_posteos_mas_valorados = str_replace("{BLOQUE_NOMEGUSTA_POST}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_ya_nomegusta.html"), $total_posteos_mas_valorados);
        } else {
            $total_posteos_mas_valorados = str_replace("{BLOQUE_NOMEGUSTA_POST}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_nomegusta.html"), $total_posteos_mas_valorados);
        }
        $total_posteos_mas_valorados = ColocaCantidadDeMegusta($total_posteos_mas_valorados, $post_recent->id_mp, $id_empresa);
        $tiene_favorito              = COMUNIDAD_TieneInteraccionPorRut($id_empresa, $post_recent->id_mp, "FAVORITA", $rut);
        if ($tiene_favorito) {
            $total_posteos_mas_valorados = str_replace("{BLOQUE_FAVORITO_POR_POST}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_ya_favorito.html"), $total_posteos_mas_valorados);
        } else {
            $total_posteos_mas_valorados = str_replace("{BLOQUE_FAVORITO_POR_POST}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_favorito.html"), $total_posteos_mas_valorados);
        }
        $total_posteos_mas_valorados = str_replace("{ESTADO}", ($post_recent->estado), $total_posteos_mas_valorados);
        $total_posteos_mas_valorados = str_replace("{DESCRIPCION_ESTADO}", ($post_recent->descripcion_estado), $total_posteos_mas_valorados);
        $total_posteos_mas_valorados = str_replace("{RUT_AUTOR}", ($post_recent->rut), $total_posteos_mas_valorados);
        $total_posteos_mas_valorados = str_replace("{RUT}", ($rut), $total_posteos_mas_valorados);
        $total_posteos_mas_valorados = str_replace("{NOMBRE_AUTOR}", ($post_recent->nombre_autor), $total_posteos_mas_valorados);
        $total_posteos_mas_valorados = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($post_recent->rut), $total_posteos_mas_valorados);
        $total_posteos_mas_valorados = str_replace("{ESTILOESTADO}", ($post_recent->estilo), $total_posteos_mas_valorados);
        $total_posteos_mas_valorados = str_replace("{ICONOESTADO}", ($post_recent->icono_estado), $total_posteos_mas_valorados);
        $total_posteos_mas_valorados = str_replace("{ESTILOCATEGORIA}", ($post_recent->style), $total_posteos_mas_valorados);
        $total_posteos_mas_valorados = str_replace("{ICONOCATEGORIA}", ($post_recent->icono), $total_posteos_mas_valorados);
        $total_posteos_mas_valorados = str_replace("{CATEGORIA_MP}", ($post_recent->categoria), $total_posteos_mas_valorados);
        /*
        $total_posteos_mas_valorados = str_replace("{IMAGEN_POST}","multimedia/".$post_recent->imagenfondo,$total_posteos_mas_valorados);
        $total_posteos_mas_valorados = str_replace("{VIDEO}",($video),$total_posteos_mas_valorados);
        $total_posteos_mas_valorados = str_replace("{TIPOMULTIMEDIA}",($post_recent->tipo_multimedia),$total_posteos_mas_valorados);
        * */
        $total_posteos_mas_valorados = str_replace("{NOMBRE}", ($post_recent->nombre), $total_posteos_mas_valorados);
        $total_posteos_mas_valorados = str_replace("{RUT_ENVIADO}", ($post_recent->rut), $total_posteos_mas_valorados);
        $total_posteos_mas_valorados = str_replace("{ID_MP}", ($post_recent->id_mp), $total_posteos_mas_valorados);
    }
    // MP NOVEDADES
    $posteos_mas_novedades   = com_mp_post_portipo("Novedades", $id_empresa, $subcategoria);
    $total_posteos_novedades = "";
    foreach ($posteos_mas_novedades as $post_recent) {
        $total_posteos_novedades .= file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_row_com_mp_mini_banner.html");
        $total_posteos_novedades = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($post_recent->rut), $total_posteos_novedades);
        $total_posteos_novedades = str_replace("{ID_MP}", $post_recent->id_mp, $total_posteos_novedades);
        $total_posteos_novedades = str_replace("{LINK}", $link_MP, $total_posteos_novedades);
        $total_posteos_novedades = str_replace("{TIPO}", "F", $total_posteos_novedades);
        $total_posteos_novedades = str_replace("{CATEGORIA_MP}", ($post_recent->categoria), $total_posteos_novedades);
        $total_posteos_novedades = str_replace("{DESCRIPCION_CATEGORIA}", utf8_encode($post_recent->descripcion_categoria), $total_posteos_novedades);
        $total_posteos_novedades = str_replace("{NOMBRE}", ($post_recent->nombre), $total_posteos_novedades);
        if ($id_empresa == 53) {
            $total_posteos_novedades = str_replace("{CONTENIDO}", substr($post_recent->contenido, 0, 150), $total_posteos_novedades);
        } else {
            $total_posteos_novedades = str_replace("{CONTENIDO}", ($post_recent->contenido), $total_posteos_novedades);
        }
        $total_posteos_novedades = str_replace("{HUINCHA_INTERACCIONES}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_huincha_interacciones.html"), $total_posteos_novedades);
        if ($post_recent->rut == $rut) {
            $total_posteos_novedades = str_replace("{EDITAR_MP}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_editar_mp.html"), $total_posteos_novedades);
            $total_posteos_novedades = str_replace("{ELIMINAR_MP}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_borrar_mp.html"), $total_posteos_novedades);
        } else {
            $total_posteos_novedades = str_replace("{EDITAR_MP}", "", $total_posteos_novedades);
            $total_posteos_novedades = str_replace("{ELIMINAR_MP}", "", $total_posteos_novedades);
        }
        $tiene_megusta = COMUNIDAD_TieneInteraccionPorRut($id_empresa, $post_recent->id_mp, "MEGUSTA", $rut);
        if ($tiene_megusta) {
            $total_posteos_novedades = str_replace("{BLOQUE_MEGUSTA_POST}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_ya_megusta.html"), $total_posteos_novedades);
        } else {
            $total_posteos_novedades = str_replace("{BLOQUE_MEGUSTA_POST}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_megusta.html"), $total_posteos_novedades);
        }
        $tiene_no_megusta = COMUNIDAD_TieneInteraccionPorRut($id_empresa, $post_recent->id_mp, "NOMEGUSTA", $rut);
        if ($tiene_no_megusta) {
            $total_posteos_novedades = str_replace("{BLOQUE_NOMEGUSTA_POST}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_ya_nomegusta.html"), $total_posteos_novedades);
        } else {
            $total_posteos_novedades = str_replace("{BLOQUE_NOMEGUSTA_POST}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_nomegusta.html"), $total_posteos_novedades);
        }
        $total_posteos_novedades = ColocaCantidadDeMegusta($total_posteos_novedades, $post_recent->id_mp, $id_empresa);
        $tiene_favorito          = COMUNIDAD_TieneInteraccionPorRut($id_empresa, $post_recent->id_mp, "FAVORITA", $rut);
        if ($tiene_favorito) {
            $total_posteos_novedades = str_replace("{BLOQUE_FAVORITO_POR_POST}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_ya_favorito.html"), $total_posteos_novedades);
        } else {
            $total_posteos_novedades = str_replace("{BLOQUE_FAVORITO_POR_POST}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_favorito.html"), $total_posteos_novedades);
        }
        $total_posteos_novedades = str_replace("{ESTADO}", ($post_recent->estado), $total_posteos_novedades);
        $total_posteos_novedades = str_replace("{DESCRIPCION_ESTADO}", ($post_recent->descripcion_estado), $total_posteos_novedades);
        $total_posteos_novedades = str_replace("{RUT_AUTOR}", ($post_recent->rut), $total_posteos_novedades);
        $total_posteos_novedades = str_replace("{RUT}", ($rut), $total_posteos_novedades);
        $total_posteos_novedades = str_replace("{NOMBRE_AUTOR}", ($post_recent->nombre_autor), $total_posteos_novedades);
        $total_posteos_novedades = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($post_recent->rut), $total_posteos_novedades);
        $total_posteos_novedades = str_replace("{ESTILOESTADO}", ($post_recent->estilo), $total_posteos_novedades);
        $total_posteos_novedades = str_replace("{ICONOESTADO}", ($post_recent->icono_estado), $total_posteos_novedades);
        $total_posteos_novedades = str_replace("{ESTILOCATEGORIA}", ($post_recent->style), $total_posteos_novedades);
        $total_posteos_novedades = str_replace("{ICONOCATEGORIA}", ($post_recent->icono), $total_posteos_novedades);
        $total_posteos_novedades = str_replace("{CATEGORIA_MP}", ($post_recent->categoria), $total_posteos_novedades);
        $total_posteos_novedades = str_replace("{IMAGEN_POST}", "multimedia/" . $post_recent->imagenfondo, $total_posteos_novedades);
        $total_posteos_novedades = str_replace("{VIDEO}", ($video), $total_posteos_novedades);
        $total_posteos_novedades = str_replace("{TIPOMULTIMEDIA}", ($post_recent->tipo_multimedia), $total_posteos_novedades);
        $total_posteos_novedades = str_replace("{NOMBRE}", ($post_recent->nombre), $total_posteos_novedades);
        $total_posteos_novedades = str_replace("{RUT_ENVIADO}", ($post_recent->rut), $total_posteos_novedades);
        $total_posteos_novedades = str_replace("{ID_MP}", ($post_recent->id_mp), $total_posteos_novedades);
    }
    // MP FOTOS
    $posteos_mas_fotos   = com_mp_post_portipo("Foto", $id_empresa, $subcategoria);
    $total_posteos_fotos = "";
    foreach ($posteos_mas_fotos as $post_recent) {
        $total_posteos_fotos .= file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_row_com_mp_mini_banner.html");
        $total_posteos_fotos = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($post_recent->rut), $total_posteos_fotos);
        $total_posteos_fotos = str_replace("{ID_MP}", $post_recent->id_mp, $total_posteos_fotos);
        $total_posteos_fotos = str_replace("{LINK}", $link_MP, $total_posteos_fotos);
        $total_posteos_fotos = str_replace("{TIPO}", "F", $total_posteos_fotos);
        $total_posteos_fotos = str_replace("{CATEGORIA_MP}", ($post_recent->categoria), $total_posteos_fotos);
        $total_posteos_fotos = str_replace("{DESCRIPCION_CATEGORIA}", utf8_encode($post_recent->descripcion_categoria), $total_posteos_fotos);
        $total_posteos_fotos = str_replace("{NOMBRE}", ($post_recent->nombre), $total_posteos_fotos);
        if ($id_empresa == 53) {
            $total_posteos_fotos = str_replace("{CONTENIDO}", substr($post_recent->contenido, 0, 150), $total_posteos_fotos);
        } else {
            $total_posteos_fotos = str_replace("{CONTENIDO}", ($post_recent->contenido), $total_posteos_fotos);
        }
        $total_posteos_fotos = str_replace("{HUINCHA_INTERACCIONES}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_huincha_interacciones.html"), $total_posteos_fotos);
        if ($post_recent->rut == $rut) {
            $total_posteos_fotos = str_replace("{EDITAR_MP}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_editar_mp.html"), $total_posteos_fotos);
            $total_posteos_fotos = str_replace("{ELIMINAR_MP}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_borrar_mp.html"), $total_posteos_fotos);
        } else {
            $total_posteos_fotos = str_replace("{EDITAR_MP}", "", $total_posteos_fotos);
            $total_posteos_fotos = str_replace("{ELIMINAR_MP}", "", $total_posteos_fotos);
        }
        $tiene_megusta = COMUNIDAD_TieneInteraccionPorRut($id_empresa, $post_recent->id_mp, "MEGUSTA", $rut);
        if ($tiene_megusta) {
            $total_posteos_fotos = str_replace("{BLOQUE_MEGUSTA_POST}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_ya_megusta.html"), $total_posteos_fotos);
        } else {
            $total_posteos_fotos = str_replace("{BLOQUE_MEGUSTA_POST}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_megusta.html"), $total_posteos_fotos);
        }
        $tiene_no_megusta = COMUNIDAD_TieneInteraccionPorRut($id_empresa, $post_recent->id_mp, "NOMEGUSTA", $rut);
        if ($tiene_no_megusta) {
            $total_posteos_fotos = str_replace("{BLOQUE_NOMEGUSTA_POST}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_ya_nomegusta.html"), $total_posteos_fotos);
        } else {
            $total_posteos_fotos = str_replace("{BLOQUE_NOMEGUSTA_POST}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_nomegusta.html"), $total_posteos_fotos);
        }
        $total_posteos_fotos = ColocaCantidadDeMegusta($total_posteos_fotos, $post_recent->id_mp, $id_empresa);
        $tiene_favorito      = COMUNIDAD_TieneInteraccionPorRut($id_empresa, $post_recent->id_mp, "FAVORITA", $rut);
        if ($tiene_favorito) {
            $total_posteos_fotos = str_replace("{BLOQUE_FAVORITO_POR_POST}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_ya_favorito.html"), $total_posteos_fotos);
        } else {
            $total_posteos_fotos = str_replace("{BLOQUE_FAVORITO_POR_POST}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_favorito.html"), $total_posteos_fotos);
        }
        $total_posteos_fotos = str_replace("{ESTADO}", ($post_recent->estado), $total_posteos_fotos);
        $total_posteos_fotos = str_replace("{DESCRIPCION_ESTADO}", ($post_recent->descripcion_estado), $total_posteos_fotos);
        $total_posteos_fotos = str_replace("{RUT_AUTOR}", ($post_recent->rut), $total_posteos_fotos);
        $total_posteos_fotos = str_replace("{RUT}", ($rut), $total_posteos_fotos);
        $total_posteos_fotos = str_replace("{NOMBRE_AUTOR}", ($post_recent->nombre_autor), $total_posteos_fotos);
        $total_posteos_fotos = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($post_recent->rut), $total_posteos_fotos);
        $total_posteos_fotos = str_replace("{ESTILOESTADO}", ($post_recent->estilo), $total_posteos_fotos);
        $total_posteos_fotos = str_replace("{ICONOESTADO}", ($post_recent->icono_estado), $total_posteos_fotos);
        $total_posteos_fotos = str_replace("{ESTILOCATEGORIA}", ($post_recent->style), $total_posteos_fotos);
        $total_posteos_fotos = str_replace("{ICONOCATEGORIA}", ($post_recent->icono), $total_posteos_fotos);
        $total_posteos_fotos = str_replace("{CATEGORIA_MP}", ($post_recent->categoria), $total_posteos_fotos);
        $total_posteos_fotos = str_replace("{IMAGEN_POST}", "multimedia/" . $post_recent->imagenfondo, $total_posteos_fotos);
        $total_posteos_fotos = str_replace("{VIDEO}", ($video), $total_posteos_fotos);
        $total_posteos_fotos = str_replace("{TIPOMULTIMEDIA}", ($post_recent->tipo_multimedia), $total_posteos_fotos);
        $total_posteos_fotos = str_replace("{NOMBRE}", ($post_recent->nombre), $total_posteos_fotos);
        $total_posteos_fotos = str_replace("{RUT_ENVIADO}", ($post_recent->rut), $total_posteos_fotos);
        $total_posteos_fotos = str_replace("{ID_MP}", ($post_recent->id_mp), $total_posteos_fotos);
    }
    // MP CAPACITACIONES
    $posteos_mas_capacitaciones   = com_mp_post_portipo("Capacitaciones", $id_empresa, $subcategoria);
    $total_posteos_capacitaciones = "";
    //print_r($posteos_mas_capacitaciones);
    foreach ($posteos_mas_capacitaciones as $post_recent) {
        $total_posteos_capacitaciones .= file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_row_com_mp_mini_banner.html");
        $total_posteos_capacitaciones = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($post_recent->rut), $total_posteos_capacitaciones);
        $total_posteos_capacitaciones = str_replace("{ID_MP}", $post_recent->id_mp, $total_posteos_capacitaciones);
        $total_posteos_capacitaciones = str_replace("{LINK}", $link_MP, $total_posteos_capacitaciones);
        $total_posteos_capacitaciones = str_replace("{TIPO}", "F", $total_posteos_capacitaciones);
        $total_posteos_capacitaciones = str_replace("{CATEGORIA_MP}", ($post_recent->categoria), $total_posteos_capacitaciones);
        $total_posteos_capacitaciones = str_replace("{DESCRIPCION_CATEGORIA}", utf8_encode($post_recent->descripcion_categoria), $total_posteos_capacitaciones);
        $total_posteos_capacitaciones = str_replace("{NOMBRE}", ($post_recent->nombre), $total_posteos_capacitaciones);
        if ($id_empresa == 53) {
            $total_posteos_capacitaciones = str_replace("{CONTENIDO}", substr($post_recent->contenido, 0, 150), $total_posteos_capacitaciones);
        } else {
            $total_posteos_capacitaciones = str_replace("{CONTENIDO}", ($post_recent->contenido), $total_posteos_capacitaciones);
        }
        $total_posteos_capacitaciones = str_replace("{HUINCHA_INTERACCIONES}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_huincha_interacciones.html"), $total_posteos_capacitaciones);
        if ($post_recent->rut == $rut) {
            $total_posteos_capacitaciones = str_replace("{EDITAR_MP}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_editar_mp.html"), $total_posteos_capacitaciones);
            $total_posteos_capacitaciones = str_replace("{ELIMINAR_MP}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_borrar_mp.html"), $total_posteos_capacitaciones);
        } else {
            $total_posteos_capacitaciones = str_replace("{EDITAR_MP}", "", $total_posteos_capacitaciones);
            $total_posteos_capacitaciones = str_replace("{ELIMINAR_MP}", "", $total_posteos_capacitaciones);
        }
        $tiene_megusta = COMUNIDAD_TieneInteraccionPorRut($id_empresa, $post_recent->id_mp, "MEGUSTA", $rut);
        if ($tiene_megusta) {
            $total_posteos_capacitaciones = str_replace("{BLOQUE_MEGUSTA_POST}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_ya_megusta.html"), $total_posteos_capacitaciones);
        } else {
            $total_posteos_capacitaciones = str_replace("{BLOQUE_MEGUSTA_POST}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_megusta.html"), $total_posteos_capacitaciones);
        }
        $tiene_no_megusta = COMUNIDAD_TieneInteraccionPorRut($id_empresa, $post_recent->id_mp, "NOMEGUSTA", $rut);
        if ($tiene_no_megusta) {
            $total_posteos_capacitaciones = str_replace("{BLOQUE_NOMEGUSTA_POST}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_ya_nomegusta.html"), $total_posteos_capacitaciones);
        } else {
            $total_posteos_capacitaciones = str_replace("{BLOQUE_NOMEGUSTA_POST}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_nomegusta.html"), $total_posteos_capacitaciones);
        }
        $total_posteos_capacitaciones = ColocaCantidadDeMegusta($total_posteos_capacitaciones, $post_recent->id_mp, $id_empresa);
        $tiene_favorito               = COMUNIDAD_TieneInteraccionPorRut($id_empresa, $post_recent->id_mp, "FAVORITA", $rut);
        if ($tiene_favorito) {
            $total_posteos_capacitaciones = str_replace("{BLOQUE_FAVORITO_POR_POST}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_ya_favorito.html"), $total_posteos_capacitaciones);
        } else {
            $total_posteos_capacitaciones = str_replace("{BLOQUE_FAVORITO_POR_POST}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_bloque_favorito.html"), $total_posteos_capacitaciones);
        }
        $total_posteos_capacitaciones = str_replace("{ESTADO}", ($post_recent->estado), $total_posteos_capacitaciones);
        $total_posteos_capacitaciones = str_replace("{DESCRIPCION_ESTADO}", ($post_recent->descripcion_estado), $total_posteos_capacitaciones);
        $total_posteos_capacitaciones = str_replace("{RUT_AUTOR}", ($post_recent->rut), $total_posteos_capacitaciones);
        $total_posteos_capacitaciones = str_replace("{RUT}", ($rut), $total_posteos_capacitaciones);
        $total_posteos_capacitaciones = str_replace("{NOMBRE_AUTOR}", ($post_recent->nombre_autor), $total_posteos_capacitaciones);
        $total_posteos_capacitaciones = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($post_recent->rut), $total_posteos_capacitaciones);
        $total_posteos_capacitaciones = str_replace("{ESTILOESTADO}", ($post_recent->estilo), $total_posteos_capacitaciones);
        $total_posteos_capacitaciones = str_replace("{ICONOESTADO}", ($post_recent->icono_estado), $total_posteos_capacitaciones);
        $total_posteos_capacitaciones = str_replace("{ESTILOCATEGORIA}", ($post_recent->style), $total_posteos_capacitaciones);
        $total_posteos_capacitaciones = str_replace("{ICONOCATEGORIA}", ($post_recent->icono), $total_posteos_capacitaciones);
        $total_posteos_capacitaciones = str_replace("{CATEGORIA_MP}", ($post_recent->categoria), $total_posteos_capacitaciones);
        $total_posteos_capacitaciones = str_replace("{IMAGEN_POST}", "multimedia/" . $post_recent->imagenfondo, $total_posteos_capacitaciones);
        $total_posteos_capacitaciones = str_replace("{VIDEO}", ($video), $total_posteos_capacitaciones);
        $total_posteos_capacitaciones = str_replace("{TIPOMULTIMEDIA}", ($post_recent->tipo_multimedia), $total_posteos_capacitaciones);
        $total_posteos_capacitaciones = str_replace("{NOMBRE}", ($post_recent->nombre), $total_posteos_capacitaciones);
        $total_posteos_capacitaciones = str_replace("{RUT_ENVIADO}", ($post_recent->rut), $total_posteos_capacitaciones);
        $total_posteos_capacitaciones = str_replace("{ID_MP}", ($post_recent->id_mp), $total_posteos_capacitaciones);
    }
    $peoples_mas_seguida      = com_mp_people_mas_seguida($rut, $id_empresa, $subcategoria);
    $total_people_mas_seguida = "";
    //print_r($peoples_mas_seguida);
    foreach ($peoples_mas_seguida as $people_maseguidA) {
        $total_people_mas_seguida .= file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_row_com_mp_people_mini.html");
        $total_people_mas_seguida = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($people_maseguidA->rut), $total_people_mas_seguida);
        $total_people_mas_seguida = str_replace("{NOMBRE}", ($people_maseguidA->nombre), $total_people_mas_seguida);
        $total_people_mas_seguida = str_replace("{RUT_ENVIADO}", ($people_maseguidA->rut), $total_people_mas_seguida);
        $total_people_mas_seguida = str_replace("{SEGUIDORES}", ($people_maseguidA->seguidores . " seguidores"), $total_people_mas_seguida);
        $total_people_mas_seguida = str_replace("{PUNTOS}", "", $total_people_mas_seguida);
        // BOTON SEGUIR
        $sesiguepersona           = count(VerificandompaSeguidores($rut, $people_maseguidA->rut, $id_empresa));
        if ($sesiguepersona > 0) {
            $boton_seguir = "<center>    <div class='badge_small badge-verde blanco mgtop5'>    <i class='icon-check icons'></i> Siguiendo </div>
        <a href='?sw=com_mp_personal&rut_enviado=" . $people_maseguidA->rut . "&vp=1&sg=2' class='badge_small bg-white_borderBlue negro'>
        <i class='icon-user-following icons'></i> Dejar de seguir (-)</a></center>";
        } else {
            $boton_seguir = "<center><a href='?sw=com_mp_personal&rut_enviado=" . $people_maseguidA->rut . "&vp=1&sg=1'
         class='badge_small bg-amarillos negro'>
        <i class='icon-user-following icons'></i> Seguir (+)</a></center>";
        }
        $total_people_mas_seguida = str_replace("{BOTON_SEGUIR}", ($boton_seguir), $total_people_mas_seguida);
    }
    $peoples_mas_puntos      = com_mp_people_mas_puntos($rut, $id_empresa, $subcategoria);
    $total_people_mas_puntos = "";
    //print_r($peoples_mas_puntos);
    //exit();
    foreach ($peoples_mas_puntos as $peoples_ma_punto) {
        $total_people_mas_puntos .= file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_row_com_mp_people_mini.html");
        $total_people_mas_puntos = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($peoples_ma_punto->rut), $total_people_mas_puntos);
        $total_people_mas_puntos = str_replace("{NOMBRE}", ($peoples_ma_punto->nombre), $total_people_mas_puntos);
        $total_people_mas_puntos = str_replace("{RUT_ENVIADO}", ($peoples_ma_punto->rut), $total_people_mas_puntos);
        $total_people_mas_puntos = str_replace("{SEGUIDORES}", "", $total_people_mas_puntos);
        $total_people_mas_puntos = str_replace("{PUNTOS}", $peoples_ma_punto->puntos . " Bci Coins", $total_people_mas_puntos);
        // BOTON SEGUIR
        $sesiguepersona          = count(VerificandompaSeguidores($rut, $peoples_ma_punto->rut, $id_empresa));
        if ($sesiguepersona > 0) {
            $boton_seguir = "<center>    <div class='badge_small badge-verde blanco mgtop5'>    <i class='icon-check icons'></i> Siguiendo </div>
        <a href='?sw=com_mp_personal&rut_enviado=" . $peoples_ma_punto->rut . "&vp=1&sg=2'
        class='badge_small bg-amarillos negro'>
        <i class='icon-user-following icons'></i> Dejar de seguir (-)</a></center>";
        } else {
            $boton_seguir = "<center><a href='?sw=com_mp_personal&rut_enviado=" . $peoples_ma_punto->rut . "&vp=1&sg=1' class='badge_small bg-amarillos negro'>        <i class='icon-user-following icons'></i> Seguir (+)</a></center>";
        }
        $total_people_mas_puntos = str_replace("{BOTON_SEGUIR}", ($boton_seguir), $total_people_mas_puntos);
    }
    $peoples_mas_interacciones = com_mp_people_mas_interacciones($rut, $id_empresa, $subcategoria);
    $total_people_mas_interacc = "";
    //print_r($peoples_mas_interacciones);
    foreach ($peoples_mas_interacciones as $people_mas_interacc) {
        $total_people_mas_interacc .= file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_row_com_mp_people_mini.html");
        $total_people_mas_interacc = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($people_mas_interacc->rut), $total_people_mas_interacc);
        $total_people_mas_interacc = str_replace("{NOMBRE}", ($people_mas_interacc->nombre), $total_people_mas_interacc);
        $total_people_mas_interacc = str_replace("{RUT_ENVIADO}", ($people_mas_interacc->rut), $total_people_mas_interacc);
        $total_people_mas_interacc = str_replace("{SEGUIDORES}", ($people_mas_interacc->seguidores . " seguidores"), $total_people_mas_interacc);
        $total_people_mas_interacc = str_replace("{PUNTOS}", "", $total_people_mas_interacc);
        // BOTON SEGUIR
        $sesiguepersona            = count(VerificandompaSeguidores($rut, $people_mas_interacc->rut, $id_empresa));
        if ($sesiguepersona > 0) {
            $boton_seguir = "<center>    <div class='badge_small badge-verde blanco mgtop5'>    <i class='icon-check icons'></i> Siguiendo </div>
        <a href='?sw=com_mp_personal&rut_enviado=" . $people_mas_interacc->rut . "&vp=1&sg=2'
        class='badge_small bg-amarillos negro'>
        <i class='icon-user-following icons'></i> Dejar de seguir (-)</a></center>";
        } else {
            $boton_seguir = "<center><a href='?sw=com_mp_personal&rut_enviado=" . $people_mas_interacc->rut . "&vp=1&sg=1' class='badge_small bg-amarillos negro'>        <i class='icon-user-following icons'></i> Seguir (+)</a></center>";
        }
        $total_people_mas_interacc = str_replace("{BOTON_SEGUIR}", ($boton_seguir), $total_people_mas_interacc);
    }
    $peoples_quesigos     = com_mp_people_quesigo($rut, $id_empresa);
    $total_people_quesigo = "";
    foreach ($peoples_quesigos as $people_quesigo) {
        $total_people_quesigo .= file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_row_com_mp_people_mini.html");
        $datos                = $people_quesigo->cuenta . " seguidores";
        $total_people_quesigo = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($people_quesigo->rut), $total_people_quesigo);
        $total_people_quesigo = str_replace("{NOMBRE}", ($people_quesigo->nombrecompleto), $total_people_quesigo);
        $total_people_quesigo = str_replace("{RUT_ENVIADO}", ($people_quesigo->rut), $total_people_quesigo);
        $total_people_quesigo = str_replace("{DATOS}", ($datos), $total_people_quesigo);
        $total_people_quesigo = str_replace("{SEGUIDORES}", ($people_mas_interacc->seguidores . " seguidores"), $total_people_quesigo);
        $total_people_quesigo = str_replace("{PUNTOS}", "", $total_people_quesigo);
        // BOTON SEGUIR
        $sesiguepersona       = count(VerificandompaSeguidores($rut, $people_quesigo->rut, $id_empresa));
        if ($sesiguepersona > 0) {
            $boton_seguir = "<center>    <div class='badge_small badge-verde blanco mgtop5'>    <i class='icon-check icons'></i> Siguiendo </div>
        <a href='?sw=com_mp_personal&rut_enviado=" . $people_quesigo->rut . "&vp=1&sg=2'
        class='badge_small bg-amarillos negro'>
        <i class='icon-user-following icons'></i> Dejar de seguir (-)</a></center>";
        } else {
            $boton_seguir = "<center><a href='?sw=com_mp_personal&rut_enviado=" . $people_quesigo->rut . "&vp=1&sg=1' class='badge_small bg-white_borderBlue negro'>        <i class='icon-user-following icons'></i> Seguir (+)</a></center>";
        }
        $total_people_quesigo = str_replace("{BOTON_SEGUIR}", ($boton_seguir), $total_people_quesigo);
    }
    $limit                   = 9;
    $total_listado_tags      = com_mp_tag_data($id_empresa, $rut, $limit);
    $total_listado_tag_cloud = "";
    foreach ($total_listado_tags as $total_listado_tag_unico) {
        $total_listado_tag_cloud .= file_get_contents("views/comunidad_mp/com_mp_row_tag_cloud_search.html");
        $total_listado_tag_cloud = str_replace("{TAG}", $total_listado_tag_unico->tag, $total_listado_tag_cloud);
        $total_listado_tag_cloud = str_replace("{NUM}", $total_listado_tag_unico->cuenta, $total_listado_tag_cloud);
        $link                    = "?sw=com_mp_personal&amb=mp_tag&tag=" . $total_listado_tag_unico->tag . "";
        $total_listado_tag_cloud = str_replace("{LINK}", $link, $total_listado_tag_cloud);
    }
    $agrup_categorias      = MPObtengoCategoriasNumero($id_empresa);
    $total_agrup_categoria = "";
    foreach ($agrup_categorias as $agrup_categoria) {
        //revisa si usuario esta registrado en algun grupo
        $cuenta_seguido = com_mp_revisa_grupo_seguido($agrup_categoria->id_categoria, "GRUPOSEGUIDO", $id_empresa, $rut);
        //echo $cuenta_seguido[0]->cuenta;
        if ($cuenta_seguido[0]->cuenta == 0) {
            $var_gruposeguir       = "<a href='?sw=com_mp_personal&amb=mp_cat&idcat=" . $agrup_categoria->id_categoria . "&cat=" . $agrup_categoria->categoria . "&groupseguir=1'
            class='negro'> Seguir (+)</a>";
            $var_groupseguir_class = "azul";
        } else {
            $var_gruposeguir       = "<a href='?sw=com_mp_personal&amb=mp_cat&idcat=" . $agrup_categoria->id_categoria . "&cat=" . $agrup_categoria->categoria . "&groupseguir=2'
            class='negro'> Dejar de seguir (-)</a>";
            $var_groupseguir_class = "verde";
        }
        $var_gruposeguir       = "<a href='?sw=com_mp_personal&amb=mp_cat&idcat=" . $agrup_categoria->id_categoria . "&cat=" . $agrup_categoria->categoria . "&groupseguir=1'
            class='negro'> </a>";
        $var_groupseguir_class = "azul";
        $total_agrup_categoria .= file_get_contents("views/comunidad_mp/row_com_mp_grupo_interes.html");
        $total_agrup_categoria = str_replace("{ITEM}", ($agrup_categoria->categoria), $total_agrup_categoria);
        $total_agrup_categoria = str_replace("{NUM}", ($agrup_categoria->cuenta), $total_agrup_categoria);
        $link_cat_amb          = "?sw=com_mp_personal&amb=mp_cat&idcat=" . $agrup_categoria->id_categoria . "&cat=" . $agrup_categoria->categoria . "";
        $total_agrup_categoria = str_replace("{LINK}", $link_cat_amb, $total_agrup_categoria);
        $total_agrup_categoria = str_replace("{GRUPO_SEGUIR_SEGUIDO_BOTON}", $var_gruposeguir, $total_agrup_categoria);
        $total_agrup_categoria = str_replace("{GRUPO_SEGUIR_SEGUIDO_CLASS}", $var_groupseguir_class, $total_agrup_categoria);
        //    echo $agrup_categoria->categoria;
    }
    $agrup_ambitos       = MPObtengoAmbitosNumero($id_empresa, $array_MP_template[0]->template);
    $total_agrup_ambitos = "";
    foreach ($agrup_ambitos as $agrup_ambito) {
        //revisa si usuario esta registrado en algun grupo
        $cuenta_seguido        = com_mp_revisa_grupo_seguido($agrup_ambito->id_ambito, "GRUPOSEGUIDO", $id_empresa, $rut);
        //echo $cuenta_seguido[0]->cuenta;
        $var_gruposeguir       = "<a href='?sw=com_mp_personal&amb=mp_amb&idamb=" . $agrup_ambito->id_ambito . "&cat=" . $agrup_ambito->ambito . "&groupseguir=1'
            class='negro'> </a>";
        $var_groupseguir_class = "azul";
        $total_agrup_ambitos .= file_get_contents("views/comunidad_mp/row_com_mp_grupo_ambito.html");
        $total_agrup_ambitos = str_replace("{ITEM}", ($agrup_ambito->ambito), $total_agrup_ambitos);
        $total_agrup_ambitos = str_replace("{NUM}", ($agrup_ambito->cuenta), $total_agrup_ambitos);
        $link_cat_amb        = "?sw=com_mp_personal&amb=mp_amb&idamb=" . $agrup_ambito->id_ambito . "&ambito=" . $agrup_ambito->ambito . "";
        $total_agrup_ambitos = str_replace("{LINK}", $link_cat_amb, $total_agrup_ambitos);
        $total_agrup_ambitos = str_replace("{GRUPO_SEGUIR_SEGUIDO_BOTON}", $var_gruposeguir, $total_agrup_ambitos);
        $total_agrup_ambitos = str_replace("{GRUPO_SEGUIR_SEGUIDO_CLASS}", $var_groupseguir_class, $total_agrup_ambitos);
        //    echo $agrup_categoria->categoria;
    }
    //categorias expertos
    $agrup_categoria_expertos_expertos = MPObtengoCategoriasNumero($id_empresa);
    $total_agrup_categoria_expertos    = "";
    foreach ($agrup_categoria_expertos_expertos as $agrup_categoria_experto) {
        $cuenta_num = MP_numero_expertos_categoria($agrup_categoria_experto->id_categoria, $id_empresa);
        if ($cuenta_num > 0) {
            $total_agrup_categoria_expertos .= file_get_contents("views/comunidad_mp/row_com_mp_grupo_interes_expertos.html");
            $total_agrup_categoria_expertos = str_replace("{ITEM}", ($agrup_categoria_experto->categoria), $total_agrup_categoria_expertos);
            $total_agrup_categoria_expertos = str_replace("{NUM}", ($cuenta_num), $total_agrup_categoria_expertos);
            $link_cat_amb                   = "?sw=com_mp_personal&=mp_cat&soloexpertos=1&q=" . $agrup_categoria_experto->categoria . "";
            $total_agrup_categoria_expertos = str_replace("{LINK}", $link_cat_amb, $total_agrup_categoria_expertos);
            $total_agrup_categoria_expertos = str_replace("{GRUPO_SEGUIR_SEGUIDO_BOTON}", $var_gruposeguir, $total_agrup_categoria_expertos);
            $total_agrup_categoria_expertos = str_replace("{GRUPO_SEGUIR_SEGUIDO_CLASS}", $var_groupseguir_class, $total_agrup_categoria_expertos);
        }
    }
    //filtro por tipo
    $agrup_tiposPub    = MPObtengoTiposPubNumero($id_empresa); //print_r($agrup_tiposPub);
    $total_agrup_tipos = "";
    foreach ($agrup_tiposPub as $agrup_tipoPub) {
        $total_agrup_tipos .= file_get_contents("views/comunidad_mp/row_com_mp_grupo_tipos.html");
        $total_agrup_tipos = str_replace("{ITEM}", ($agrup_tipoPub->tipo), $total_agrup_tipos);
        //$total_agrup_tipos = str_replace("{NUM}",($agrup_categoria->cuenta),$total_agrup_tipos);
        $link_cat_amb      = "?sw=com_mp_personal&amb=mp_tipo&idcat=" . $agrup_tipoPub->tipo . "&cat=" . $agrup_tipoPub->tipo . "";
        $total_agrup_tipos = str_replace("{LINK}", $link_cat_amb, $total_agrup_tipos);
        //$total_agrup_tipos = str_replace("{GRUPO_SEGUIR_SEGUIDO_BOTON}",$var_gruposeguir,$total_agrup_tipos);
        //$total_agrup_tipos = str_replace("{GRUPO_SEGUIR_SEGUIDO_CLASS}",$var_groupseguir_class,$total_agrup_tipos);
        //echo $agrup_categoria->categoria;
    }
    $PRINCIPAL = str_replace("{INSIGNIA}", "", $PRINCIPAL);
    $PRINCIPAL = str_replace("{RUT_USUARIO}", $rut, $PRINCIPAL);
    $PRINCIPAL = str_replace("{MIRUT}", $rut, $PRINCIPAL);
    $PRINCIPAL = str_replace("{ROW_LISTADO_POST_VIDEOS}", utf8_encode($total_listado_post_tipo_new_videos), $PRINCIPAL);
    $PRINCIPAL = str_replace("{ROW_LISTADO_POST_NEWS_BIG}", utf8_encode($total_listado_post_tipo_news_big), $PRINCIPAL);
    $PRINCIPAL = str_replace("{ROW_LISTADO_POST_NEWS_3POST}", utf8_encode($total_listado_post_tipo_news_3post), $PRINCIPAL);
    //echo "4096 <br><br><br><br>ambiente $ambiente";
    if ($ambiente <> '') {
        $PRINCIPAL = str_replace("{IMAGEN_CONCURSO_HOME}", "", $PRINCIPAL);
        $PRINCIPAL = str_replace("{POST_RESULTADOS_COMUNIDAD_MP}", utf8_encode($total_listado_post_personas_resultados), $PRINCIPAL);
        $PRINCIPAL = str_replace("{POST_RESULTADOS_EXPERTOS_MP}", utf8_encode($total_listado_post_expertos_resultados), $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_TITULO_R_RESULTADOS}", ($titulo_R_resultados), $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_TITULO_E_RESULTADOS}", ($titulo_E_resultados), $PRINCIPAL);
        $PRINCIPAL = str_replace("{MP_HACERPREGUNTA}", utf8_encode($mp_hacerpregunta), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{IMAGEN_CONCURSO_HOME}", "<div class='row'><div class='col-xs-12'><a href='?sw=com_mp_concurso'><img src='img/comunidadmpa_banner_central_VF_rod.gif' border='0'></a>
    </div></div>", $PRINCIPAL);
        $PRINCIPAL = str_replace("{POST_RESULTADOS_COMUNIDAD_MP}", "", $PRINCIPAL);
        $PRINCIPAL = str_replace("{POST_RESULTADOS_EXPERTOS_MP}", "", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_TITULO_R_RESULTADOS}", ($titulo_R_resultados), $PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_TITULO_E_RESULTADOS}", ($titulo_E_resultados), $PRINCIPAL);
        $PRINCIPAL = str_replace("{MP_HACERPREGUNTA}", utf8_encode($mp_hacerpregunta), $PRINCIPAL);
    }
    $PRINCIPAL = str_replace("{PERFIL_PERSONAL_COMUNIDAD_MP}", utf8_encode($perfil_personal), $PRINCIPAL);
    $PRINCIPAL = str_replace("{POST_FIJOS_COMUNIDAD_MP}", utf8_encode($post_fijo_personal), $PRINCIPAL);
    $PRINCIPAL = str_replace("{POST_ESTADISTICAS_COMUNIDAD_MP}", utf8_encode($post_fijo_estadisticas), $PRINCIPAL);
    $PRINCIPAL = str_replace("{ROW_LISTADO_POST_RECIENTES_FACEBOOK}", utf8_encode($total_listado_post_tipo_facebook), $PRINCIPAL);
    //echo "<br><br><br><br><br><br><br><br>vp $vp, amb $ambiente";
    if ($vp == "" and ($ambiente == "" or $ambiente == "mp_cat" or $ambiente == "mp_tag" or $ambiente == "mp_mp" or $ambiente == "mp_mf" or $ambiente == "mp_cc" or $ambiente == "mp_tipo")) {
        //echo "uno";
        //$total_listado_post_recientes.=file_get_contents("views/comunidad_mp/".$template.$id_empresa."_boton_carga_mas_post.html");
        //$total_listado_post_recientes = str_replace("{NUMERO_COMENTARIOS}","1",$total_listado_post_recientes);
        $PRINCIPAL = str_replace("{ROW_LISTADO_POST_RECIENTES}", utf8_encode($total_listado_post_recientes), $PRINCIPAL);
        //<div class='com_mp_title_featured fc-container__inner '><a href='?sw=com_mp_personal&amb=mp_rec'><span class='blanco'> Lo último en la Comunidad <i class='icon-arrow-right icons'></i></span></a></div>
        $PRINCIPAL = str_replace("{TITULO_LISTADO_POST_RECIENTES}", "", $PRINCIPAL);
    } else {
        //echo "dos";
        $PRINCIPAL = str_replace("{ROW_LISTADO_POST_RECIENTES}", "", $PRINCIPAL);
        $PRINCIPAL = str_replace("{TITULO_LISTADO_POST_RECIENTES}", "", $PRINCIPAL);
    }
    $PRINCIPAL  = str_replace("{ROW_LISTADO_TIMELINE_PERSONAL}", utf8_encode($total_listado_post_timeline), $PRINCIPAL);
    $PRINCIPAL  = str_replace("{ROW_LISTADO_TIMELINE_POST_POPULARES}", utf8_encode($total_listado_post_populares), $PRINCIPAL);
    $PRINCIPAL  = str_replace("{ROW_LISTADO_TIMELINE_PERSONAS_INTERES}", utf8_encode($total_listado_post_personas_interes), $PRINCIPAL);
    $PRINCIPAL  = str_replace("{ROW_LISTADO_TIMELINE_PERSONAL}", utf8_encode($total_listado), $PRINCIPAL);
    $PRINCIPAL  = str_replace("{TITULO_LISTADO_TIMELINE_TAG1}", utf8_encode($Top_Tag[0]->tag), $PRINCIPAL);
    $PRINCIPAL  = str_replace("{TITULO_LISTADO_TIMELINE_TAG2}", utf8_encode($Top_Tag[1]->tag), $PRINCIPAL);
    $PRINCIPAL  = str_replace("{TITULO_LISTADO_TIMELINE_TAG3}", utf8_encode($Top_Tag[2]->tag), $PRINCIPAL);
    $PRINCIPAL  = str_replace("{ROW_LISTADO_TIMELINE_TAG1}", utf8_encode($total_listado_post_tag1), $PRINCIPAL);
    $PRINCIPAL  = str_replace("{ROW_LISTADO_TIMELINE_TAG2}", utf8_encode($total_listado_post_tag2), $PRINCIPAL);
    $PRINCIPAL  = str_replace("{ROW_LISTADO_TIMELINE_TAG3}", utf8_encode($total_listado_post_tag3), $PRINCIPAL);
    //    }
    //preguntas
    $PRINCIPAL  = str_replace("{ROW_ULTIMOS_PREGUNTAS_PUBLICO}", utf8_encode($total_ultimos_posteos_publicados), $PRINCIPAL);
    //soy experto??
    $soyexperto = mp_verificaquesoy_experto($rut, $id_empresa, $subcategoria);
    if ($soyexperto[0]->cuenta >= 1) {
        $mp_num_preg_sin_contestar = mp_num_preguntas_sincontestar($rut, $id_empresa, $subcategoria);
        if ($mp_num_preg_sin_contestar[0]->cuenta == 1) {
            $alerta_experto_preguntas = "
    <div class='alert alert-danger' role='alert'>
          <strong>Existen " . $mp_num_preg_sin_contestar[0]->cuenta . " pregunta sin contestar</strong><br>Has click en el boton Responder, para contestar.<br> Tu respuesta quedara publicada en la Comunidad.
    </div>";
        } elseif ($mp_num_preg_sin_contestar[0]->cuenta > 1) {
            $alerta_experto_preguntas = "
    <div class='alert alert-danger' role='alert'>
          <strong>Existen " . $mp_num_preg_sin_contestar[0]->cuenta . " preguntas sin contestar</strong><br>Has click en el boton Responder, para contestar.<br> Tu respuesta quedara publicada en la Comunidad.
    </div>";
        } else {
            $alerta_experto_preguntas = "";
        }
        $PRINCIPAL = str_replace("{PREGUNTAS_COMUNIDAD_PARA_RESPONDER}", utf8_encode($total_preguntas_sin_responder), $PRINCIPAL);
        $PRINCIPAL = str_replace("{TITULO_PREGUNTAS_COMUNIDAD_PARA_RESPONDER}", utf8_encode($alerta_experto_preguntas), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{PREGUNTAS_COMUNIDAD_PARA_RESPONDER}", "", $PRINCIPAL);
        $PRINCIPAL = str_replace("{TITULO_PREGUNTAS_COMUNIDAD_PARA_RESPONDER}", "", $PRINCIPAL);
    }
    $PRINCIPAL                      = str_replace("{GRUPO_INTERES_1}", utf8_encode($mas_grupo_interes1[0]->categoria), $PRINCIPAL);
    $PRINCIPAL                      = str_replace("{GRUPO_INTERES_2}", utf8_encode($mas_grupo_interes2[0]->categoria), $PRINCIPAL);
    $PRINCIPAL                      = str_replace("{GRUPO_INTERES_3}", utf8_encode($mas_grupo_interes3[0]->categoria), $PRINCIPAL);
    $PRINCIPAL                      = str_replace("{ROW_MAS_PUBLICADOR_GRUPO_INTERES_1}", utf8_encode($total_mas_post_grupo_interes1), $PRINCIPAL);
    $PRINCIPAL                      = str_replace("{ROW_MAS_PUBLICADOR_GRUPO_INTERES_2}", utf8_encode($total_mas_post_grupo_interes2), $PRINCIPAL);
    $PRINCIPAL                      = str_replace("{ROW_MAS_PUBLICADOR_GRUPO_INTERES_3}", utf8_encode($total_mas_post_grupo_interes3), $PRINCIPAL);
    $PRINCIPAL                      = str_replace("{COM_MP_FRASES}", utf8_encode($total_mp_com_frases), $PRINCIPAL);
    $PRINCIPAL                      = str_replace("{ROW_POST_VALORADOS}", utf8_encode($total_posteos_mas_valorados), $PRINCIPAL);
    $PRINCIPAL                      = str_replace("{MP_NOVEDADES}", utf8_encode($total_posteos_novedades), $PRINCIPAL);
    $PRINCIPAL                      = str_replace("{MP_FOTOS}", utf8_encode($total_posteos_fotos), $PRINCIPAL);
    $PRINCIPAL                      = str_replace("{MIS_CAPACITACIONES_novedades}", utf8_encode($total_posteos_capacitaciones), $PRINCIPAL);
    $PRINCIPAL                      = str_replace("{ROW_PEOPLE_INTERACCIONES}", utf8_encode($total_people_mas_interacc), $PRINCIPAL);
    $PRINCIPAL                      = str_replace("{ROW_PEOPLE_MAS_SEGUIDOS}", utf8_encode($total_people_mas_seguida), $PRINCIPAL);
    $PRINCIPAL                      = str_replace("{ROW_PEOPLE_MAS_PUNTOS}", utf8_encode($total_people_mas_puntos), $PRINCIPAL);
    $PRINCIPAL                      = str_replace("{AGRUPACION_CATEGORIAS}", utf8_encode($total_agrup_categoria), $PRINCIPAL);
    $PRINCIPAL                      = str_replace("{ROW_PEOPLE_EXPERTOS}", utf8_encode($total_agrup_categoria_expertos), $PRINCIPAL);
    $PRINCIPAL                      = str_replace("{ROW_PEOPLE_QUESIGO}", utf8_encode($total_people_quesigo), $PRINCIPAL);
    $PRINCIPAL                      = str_replace("{ROW_TIPO_PUBLICACION}", utf8_encode($total_agrup_tipos), $PRINCIPAL);
    $PRINCIPAL                      = str_replace("{AGRUPACION_AMBITOS}", utf8_encode($total_agrup_ambitos), $PRINCIPAL);
    $PRINCIPAL                      = str_replace("{TAG_CLOUD}", utf8_encode($total_listado_tag_cloud), $PRINCIPAL);
    //Mini encuesta
    $total_mini_encuestas           = com_mp_mini_encuesta($id_empresa, $rut);
    $total_mini_encuesta_titulo     = "";
    $total_mini_encuesta_opciones   = "";
    $total_mini_encuesta_resultados = "";
    foreach ($total_mini_encuestas as $total_mini_encuesta) {
        //print_r($total_mini_encuesta);
        $total_mini_encuesta_titulo .= file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_com_mp_encuesta_mini_titulo.html");
        $total_mini_encuesta_titulo = str_replace("{MINI_ENCUESTA_PREGUNTA}", ($total_mini_encuesta->pregunta), $total_mini_encuesta_titulo);
        if ($total_mini_encuesta->respuesta == 0) {
            //muestra  opciones
            if ($total_mini_encuesta->opcion1 <> '') {
                $total_mini_encuesta_opciones .= file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_com_mp_encuesta_mini_opciones.html");
                $total_mini_encuesta_opciones = str_replace("{MINI_ENCUESTA_OPCION}", ($total_mini_encuesta->opcion1), $total_mini_encuesta_opciones);
                $total_mini_encuesta_opciones = str_replace("{MINI_ENCUESTA_OPCION_ID}", "opcion1", $total_mini_encuesta_opciones);
                $total_mini_encuesta_opciones = str_replace("{MINI_ENCUESTA_ID}", $total_mini_encuesta->id, $total_mini_encuesta_opciones);
            }
            if ($total_mini_encuesta->opcion2 <> '') {
                $total_mini_encuesta_opciones .= file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_com_mp_encuesta_mini_opciones.html");
                $total_mini_encuesta_opciones = str_replace("{MINI_ENCUESTA_OPCION}", ($total_mini_encuesta->opcion2), $total_mini_encuesta_opciones);
                $total_mini_encuesta_opciones = str_replace("{MINI_ENCUESTA_OPCION_ID}", "opcion2", $total_mini_encuesta_opciones);
                $total_mini_encuesta_opciones = str_replace("{MINI_ENCUESTA_ID}", $total_mini_encuesta->id, $total_mini_encuesta_opciones);
            }
            if ($total_mini_encuesta->opcion3 <> '') {
                $total_mini_encuesta_opciones .= file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_com_mp_encuesta_mini_opciones.html");
                $total_mini_encuesta_opciones = str_replace("{MINI_ENCUESTA_OPCION}", ($total_mini_encuesta->opcion3), $total_mini_encuesta_opciones);
                $total_mini_encuesta_opciones = str_replace("{MINI_ENCUESTA_OPCION_ID}", "opcion3", $total_mini_encuesta_opciones);
                $total_mini_encuesta_opciones = str_replace("{MINI_ENCUESTA_ID}", $total_mini_encuesta->id, $total_mini_encuesta_opciones);
            }
            if ($total_mini_encuesta->opcion4 <> '') {
                $total_mini_encuesta_opciones .= file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_com_mp_encuesta_mini_opciones.html");
                $total_mini_encuesta_opciones = str_replace("{MINI_ENCUESTA_OPCION}", ($total_mini_encuesta->opcion4), $total_mini_encuesta_opciones);
                $total_mini_encuesta_opciones = str_replace("{MINI_ENCUESTA_OPCION_ID}", "opcion4", $total_mini_encuesta_opciones);
                $total_mini_encuesta_opciones = str_replace("{MINI_ENCUESTA_ID}", $total_mini_encuesta->id, $total_mini_encuesta_opciones);
            }
        } else {
            //muestra  respuesta
            if ($total_mini_encuesta->opcion1 <> '') {
                $total_mini_encuesta_resultados .= file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_com_mp_encuesta_mini_resultados.html");
                $total_mini_encuesta_resultados = str_replace("{MINI_ENCUESTA_OPCION_PORCENTAJE}", $total_mini_encuesta->porcop1 . "%", $total_mini_encuesta_resultados);
                $total_mini_encuesta_resultados = str_replace("{MINI_ENCUESTA_OPCION_TEXTO}", $total_mini_encuesta->opcion1, $total_mini_encuesta_resultados);
                $total_mini_encuesta_resultados = str_replace("{MINI_ENCUESTA_OPCION_NUMERO}", $total_mini_encuesta->porcop1, $total_mini_encuesta_resultados);
            }
            if ($total_mini_encuesta->opcion2 <> '') {
                $total_mini_encuesta_resultados .= file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_com_mp_encuesta_mini_resultados.html");
                $total_mini_encuesta_resultados = str_replace("{MINI_ENCUESTA_OPCION_PORCENTAJE}", $total_mini_encuesta->porcop2 . "%", $total_mini_encuesta_resultados);
                $total_mini_encuesta_resultados = str_replace("{MINI_ENCUESTA_OPCION_TEXTO}", $total_mini_encuesta->opcion2, $total_mini_encuesta_resultados);
                $total_mini_encuesta_resultados = str_replace("{MINI_ENCUESTA_OPCION_NUMERO}", $total_mini_encuesta->porcop2, $total_mini_encuesta_resultados);
            }
            if ($total_mini_encuesta->opcion3 <> '') {
                $total_mini_encuesta_resultados .= file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_com_mp_encuesta_mini_resultados.html");
                $total_mini_encuesta_resultados = str_replace("{MINI_ENCUESTA_OPCION_PORCENTAJE}", $total_mini_encuesta->porcop3 . "%", $total_mini_encuesta_resultados);
                $total_mini_encuesta_resultados = str_replace("{MINI_ENCUESTA_OPCION_TEXTO}", $total_mini_encuesta->opcion3, $total_mini_encuesta_resultados);
                $total_mini_encuesta_resultados = str_replace("{MINI_ENCUESTA_OPCION_NUMERO}", $total_mini_encuesta->porcop3, $total_mini_encuesta_resultados);
            }
            if ($total_mini_encuesta->opcion4 <> '') {
                $total_mini_encuesta_resultados .= file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_com_mp_encuesta_mini_resultados.html");
                $total_mini_encuesta_resultados = str_replace("{MINI_ENCUESTA_OPCION_PORCENTAJE}", $total_mini_encuesta->porcop4 . "%", $total_mini_encuesta_resultados);
                $total_mini_encuesta_resultados = str_replace("{MINI_ENCUESTA_OPCION_TEXTO}", $total_mini_encuesta->opcion4, $total_mini_encuesta_resultados);
                $total_mini_encuesta_resultados = str_replace("{MINI_ENCUESTA_OPCION_NUMERO}", $total_mini_encuesta->porcop4, $total_mini_encuesta_resultados);
            }
        }
    }
    $PRINCIPAL = str_replace("{ENCUESTA_MINI_TITULO_PREGUNTA}", utf8_encode($total_mini_encuesta_titulo), $PRINCIPAL);
    $PRINCIPAL = str_replace("{ENCUESTA_MINI_OPCIONES}", utf8_encode($total_mini_encuesta_opciones), $PRINCIPAL);
    $PRINCIPAL = str_replace("{ENCUESTA_MINI_RESULTADOS}", utf8_encode($total_mini_encuesta_resultados), $PRINCIPAL);
    if ($tipo_query == "" and $ambiente == "" AND $rut_enviado == "") {
        //echo "<br><br><br><br><br><br>hola";
        $PRINCIPAL = str_replace("{ROW_CARGAS_MAS}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_com_mp_personal_solo_post_cargar.html"), $PRINCIPAL);
    } else {
        //echo "<br><br><br><br><br><br>chao";
        // $PRINCIPAL = str_replace("{ROW_CARGAS_MAS}","",$PRINCIPAL);
        $PRINCIPAL = str_replace("{ROW_CARGAS_MAS}", file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_com_mp_personal_solo_post_cargar.html"), $PRINCIPAL);
    }
    $arreglo_get               = $_GET;
    $array_para_enviar_via_url = serialize($arreglo_get);
    $array_para_enviar_via_url = urlencode($array_para_enviar_via_url);
    $PRINCIPAL                 = str_replace("{VARIABLES_GET_ENCODEADAS}", $array_para_enviar_via_url, $PRINCIPAL);
    //    $mp_comp_estadistica=MPO_Compestadistica($id_empresa);
    $categorias_mp             = TraeCategoriasMejoresPracticas($id_empresa);
    $options_categorias        = "";
    foreach ($categorias_mp as $cat) {
        $options_categorias .= "<option value='" . $cat->id_categoria . "'>" . $cat->categoria . "</option>";
    }
    $PRINCIPAL                    = str_replace("{CATEGORIAS_FORM}", utf8_encode($options_categorias), $PRINCIPAL);
    // notificaciones sin ver
    // Mis Notificaciones
    $com_mp_mis_notificaciones    = mp_interacciones_notificaciones_home($rut, $id_empresa, "");
    //print_r($com_mp_mis_notificaciones); echo "5613";
    $cuenta_notificaciones        = 0;
    $cuenta_notificaciones_sinver = 0;
    $total_notificaciones         = "";
    foreach ($com_mp_mis_notificaciones as $com_mp_mi_notificacion) {
        $muestra = 0;
        $cuenta_notificaciones++;
        $ico   = "";
        $texto = "";
        if ($com_mp_mi_notificacion->tipo == "COMENTARIO") {
            $ico = '<i class="icon-speech icons"></i> <br><small><small>[' . $com_mp_mi_notificacion->fecha . ']</small></small>';
            if ($com_mp_mi_notificacion->rutAutor == $Rut_Perfil) {
                $texto = '<a href="?sw=com_mp_personal&rut_enviado=' . $com_mp_mi_notificacion->rut_remitente . '=1&mp=1">
                    <strong>' . $com_mp_mi_notificacion->NombreRemitente . '</strong>
                    </a> coment&oacute;:
                     tu publicaci&oacute;n
                    <a href="?sw=com_mp_full&id_mp=' . $com_mp_mi_notificacion->id_mp . '"><strong>' . $com_mp_mi_notificacion->Publicacion . '</strong></a> ';
                if ($com_mp_mi_notificacion->visto_autor === null or $com_mp_mi_notificacion->visto_autor <> 1) {
                    $cuenta_notificaciones_sinver++;
                    $muestra = 1;
                }
            } else {
                $texto = 'Comentaste la publicaci&oacute;n
                    <a href="?sw=com_mp_full&id_mp=' . $com_mp_mi_notificacion->id_mp . '">
                    <strong>' . $com_mp_mi_notificacion->Publicacion . '</strong></a>  ';
            }
        }
        if ($com_mp_mi_notificacion->tipo == "SEGUIDO" and $Rut_Perfil <> $com_mp_mi_notificacion->rut_remitente) {
            $ico = '<i class="icon-user icons"></i> <br><small><small>[' . $com_mp_mi_notificacion->fecha . ']</small></small> ';
            if ($com_mp_mi_notificacion->rut_remitenteAutor == $Rut_Perfil) {
                $texto = 'Seguiste a <a href="?sw=com_mp_personal&rut_enviado=' . $com_mp_mi_notificacion->rut . '=1&mp=1">
                    <strong>' . $com_mp_mi_notificacion->NombreDestinatario . '</strong>
                    </a>';
            } else {
                $texto = '<a href="?sw=com_mp_personal&rut_enviado=' . $com_mp_mi_notificacion->rut_remitente . '=1&mp=1">
                    <strong>' . $com_mp_mi_notificacion->NombreRemitente . '</strong> te sigue';
                if ($com_mp_mi_notificacion->visto === null or $com_mp_mi_notificacion->visto <> 1 and $com_mp_mi_notificacion->rut_remitente <> $Rut_Perfil) {
                    $cuenta_notificaciones_sinver++;
                    $muestra = 1;
                }
            }
        }
        //publicaciones sin ver
        //echo "<br> rut $Rut_Perfil==".$com_mp_mi_notificacion->rut_remitente;
        if ($com_mp_mi_notificacion->tipo == "PUBLICACION_SEGUIDO" and $Rut_Perfil == $com_mp_mi_notificacion->rut_remitente) {
            if ($com_mp_mi_notificacion->rut_remitenteAutor <> $Rut_Perfil) {
                $ico   = '<i class="icon-user icons"></i> <br><small><small>[' . $com_mp_mi_notificacion->fecha . ']</small></small> ';
                //echo "<br> sigues a que publico ".$com_mp_mi_notificacion->rut_autor;
                //exit();
                $texto = $com_mp_mi_notificacion->NombreAutor . ' ha publicado
                    <a href="?sw=com_mp_full&id_mp=' . $com_mp_mi_notificacion->id_mp . '">
                    <strong>' . $com_mp_mi_notificacion->Publicacion . '</strong></a>  ';
                //echo "$com_mp_mi_notificacion->visto_remitente===null or $com_mp_mi_notificacion->visto_remitente<>1 and $com_mp_mi_notificacion->rut_remitente==$Rut_Perfil";
                if ($com_mp_mi_notificacion->visto_remitente === null or $com_mp_mi_notificacion->visto_remitente <> 1 and $com_mp_mi_notificacion->rut_remitente == $Rut_Perfil) {
                    $cuenta_notificaciones_sinver++;
                    $muestra = 1;
                }
            }
        }
        if ($com_mp_mi_notificacion->tipo == "MEGUSTA") {
            $ico = '<i class="icon-thumbs-up icons"></i> <br><small><small>[' . $com_mp_mi_notificacion->fecha . ']</small></small> ';
            if ($com_mp_mi_notificacion->rut == $Rut_Perfil) {
                $texto = 'Te gusta la publicaci&oacute;n <a href="?sw=com_mp_full&id_mp=' . $com_mp_mi_notificacion->id_mp . '">
                    <strong>' . $com_mp_mi_notificacion->Publicacion . '</strong></a> ';
            } else {
                $texto = 'A <a href="?sw=com_mp_personal&rut_enviado=' . $com_mp_mi_notificacion->rut . '=1&mp=1">
                    <strong>' . $com_mp_mi_notificacion->NombreDestinatario . '</strong>
                    </a> le Gusta tu publicaci&oacute;n
                    <a href="?sw=com_mp_full&id_mp=' . $com_mp_mi_notificacion->id_mp . '"><strong>' . $com_mp_mi_notificacion->Publicacion . '</strong></a> ';
                if ($com_mp_mi_notificacion->visto_autor === null or $com_mp_mi_notificacion->visto_autor <> 1) {
                    $cuenta_notificaciones_sinver++;
                    $muestra = 1;
                }
            }
        }
        if ($com_mp_mi_notificacion->tipo == "GRUPOSEGUIDO") {
            $ico = '<i class="icon-people icons"></i> <br><small><small>[' . $com_mp_mi_notificacion->fecha . ']</small></small> ';
            if ($com_mp_mi_notificacion->rut == $Rut_Perfil) {
                $texto = 'Seguiste el Grupo de Inter&eacute;s
                    <a href="?sw=com_mp_personal&amb=mp_cat&idcat=' . $com_mp_mi_notificacion->contenido . '&cat=' . $com_mp_mi_notificacion->NombreCategoria . '">
                    <strong>' . $com_mp_mi_notificacion->NombreCategoria . '</strong></a>
                    ';
            }
        }
        if ($com_mp_mi_notificacion->tipo == "COMPARTIDOCONMIGO") {
            $ico = '<i class="icon-share icons"></i> <br><small><small>[' . $com_mp_mi_notificacion->fecha . ']</small></small> ';
            if ($com_mp_mi_notificacion->rut <> $Rut_Perfil and $com_mp_mi_notificacion->rut_remitente <> $Rut_Perfil and $com_mp_mi_notificacion->rut == $com_mp_mi_notificacion->rut_remitente) {
                $texto = '<a href="?sw=com_mp_personal&rut_enviado=' . $com_mp_mi_notificacion->rut . '=1&mp=1">
                    <strong>' . $com_mp_mi_notificacion->NombreDestinatario . '</strong>
                    </a> guard&oacute; tu publicaci&oacute;n
                    <a href="?sw=com_mp_full&id_mp=' . $com_mp_mi_notificacion->id_mp . '"><strong>' . $com_mp_mi_notificacion->Publicacion . '</strong></a> ';
                if ($com_mp_mi_notificacion->visto_autor === null or $com_mp_mi_notificacion->visto_autor <> 1) {
                    $cuenta_notificaciones_sinver++;
                    $muestra = 1;
                }
            } elseif ($com_mp_mi_notificacion->rut == $Rut_Perfil and $com_mp_mi_notificacion->rut_remitente == $Rut_Perfil) {
                $texto = 'Guardaste la publicaci&oacute;n <a href="?sw=com_mp_full&id_mp=' . $com_mp_mi_notificacion->id_mp . '">
                    <strong>' . $com_mp_mi_notificacion->Publicacion . '</strong></a> ';
            } elseif ($com_mp_mi_notificacion->rut == $Rut_Perfil and $com_mp_mi_notificacion->rut_remitente <> $Rut_Perfil) {
                $texto = '<a href="?sw=com_mp_personal&rut_enviado=' . $com_mp_mi_notificacion->rut . '=1&mp=1">
                    <strong>' . $com_mp_mi_notificacion->NombreRemitente . '</strong>
                    </a> comparti&oacute; contigo la publicaci&oacute;n
                    <a href="?sw=com_mp_full&id_mp=' . $com_mp_mi_notificacion->id_mp . '"><strong>' . $com_mp_mi_notificacion->Publicacion . '</strong></a>';
                if ($com_mp_mi_notificacion->visto === null or $com_mp_mi_notificacion->visto <> 1) {
                    $cuenta_notificaciones_sinver++;
                    $muestra = 1;
                }
            } elseif ($com_mp_mi_notificacion->rut <> $Rut_Perfil and $com_mp_mi_notificacion->rut_remitente == $Rut_Perfil) {
                $texto = 'Compartiste con <a href="?sw=com_mp_personal&rut_enviado=' . $com_mp_mi_notificacion->rut . '=1&mp=1">
                    <strong>' . $com_mp_mi_notificacion->NombreDestinatario . '</strong>
                    </a> la publicaci&oacute;n
                    <a href="?sw=com_mp_full&id_mp=' . $com_mp_mi_notificacion->id_mp . '"><strong>' . $com_mp_mi_notificacion->Publicacion . '</strong></a>
                    ';
            }
        }
        if ($muestra == 1 and $cuenta_notificaciones_sinver <= 10) {
            $total_notificaciones .= file_get_contents("views/comunidad_mp/" . $template . $id_empresa . "_row_com_mp_perfil_mis_notificaciones_mini.html");
            $total_notificaciones = str_replace("{ICO}", ($ico), $total_notificaciones);
            $total_notificaciones = str_replace("{TEXTO}", ($texto), $total_notificaciones);
        }
    }
    $PRINCIPAL = str_replace("{MI_RUT}", $rut, $PRINCIPAL);
    $PRINCIPAL = str_replace("{ROW_COMP_MP_MIS_NOTIFICACIONES_SIN_VER}", utf8_encode($total_notificaciones), $PRINCIPAL);
    if ($cuenta_notificaciones_sinver > 0) {
        $PRINCIPAL = str_replace("{NUM_NOTIFICACIONES_SINVER_GLOBO}", "<span class='badge_bell badge-default-bell'>" . $cuenta_notificaciones_sinver . " </span> ", $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{NUM_NOTIFICACIONES_SINVER_GLOBO}", "", $PRINCIPAL);
    }
    $PRINCIPAL = str_replace("{COMP_MP_PUBLICACIONES_TOTALES}", $mp_comp_estadistica[0]->CuentaPublicaciones, $PRINCIPAL);
    $PRINCIPAL = str_replace("{COMP_MP_PUBLICACIONES_TOTALES}", $mp_comp_estadistica[0]->CuentaPublicaciones, $PRINCIPAL);
    $PRINCIPAL = str_replace("{COMP_MP_VISTAS_TOTALES}", $mp_comp_estadistica[0]->CuentaVisitas, $PRINCIPAL);
    $PRINCIPAL = str_replace("{COMP_MP_FAVORITAS_TOTALES}", $mp_comp_estadistica[0]->CuentaFavoritas, $PRINCIPAL);
    $PRINCIPAL = str_replace("{COMP_MP_MEGUSTA_TOTALES}", $mp_comp_estadistica[0]->CuentaMeGusta, $PRINCIPAL);
    return ($PRINCIPAL);
}
function ActualizaTablatblLmsReportePorRut($rut)
{
    CRON_INDIVIDUAL_BorraTblLmsReporte($rut);
    $usuarios        = CRON_INDIVIDUAL_UsuariosPorEmpresaCapacitacion_sinSinEmpresa($arreglo_post, "", "", $rut);
    $start           = microtime(true);
    $id_empresaArray = CRON_INDIVIDUAL_ObtenerEmpresaDadoRutSinEmpresa($rut);
    foreach ($usuarios as $usu) {
        $id_empresa = $usuarios[0]->id_empresa;
        $datamalla  = CRON_INDIVIDUAL_ObtenerDatosRelMallaUsuarioDadoRutSinEmpresa($rut);
        $cursos     = CRON_INDIVIDUAL_LMS_REPORTE_TraeCursosInscripcionUsuario($rut, $id_empresa);
        foreach ($cursos as $curso) {
            //print_r($curso);
            //echo "<br><br>";
            //echo "<br>curso id ".$curso->id_curso." rut ".$usu->rut." malla ".$curso->id_malla;
            $i++;
            //$arreglo_post[curso]=$curso->id;
            $arreglo_post[curso]            = $curso->id_curso;
            //echo $curso->id_curso."<br>";
            $datos_relacion_rel_malla_curso = RON_INDIVIDUAL_LMS_REPORTE_TraeMallaCurso($curso->id_curso, $curso->id_malla, $id_empresa);
            //print_r($datos_relacion_rel_malla_curso);
            //echo "<br><br>";
            $id_programa_bbddhost           = CRON_INDIVIDUAL_LMS_Buscabbddhost($datos_relacion_rel_malla_curso[0]->id_programa, $id_empresa);
            //print_r($id_programa_bbddhost);
            if ($id_programa_bbddhost[0]->bbdd_host) {
                //echo $id_programa_bbddhost[0]->bbdd_host." PROGRAMA HOST <br>";
                $hostname = $id_programa_bbddhost[0]->bbdd_host;
                $database = $id_programa_bbddhost[0]->bbdd_database;
                $username = $id_programa_bbddhost[0]->bbdd_username;
                $password = $id_programa_bbddhost[0]->bbdd_password;
                $conexion = new mysqli($hostname, $username, $password, $database);
                //$sql="select * from tbl_usuario where rut='".$usu->rut."'";
                //Traigo datos desde la tabla lms_reporte
                $sql      = "
                        select *
                            from tbl_lms_reportes
                            where rut='" . $usu->rut . "' and
                                id_malla='" . $datos_relacion_rel_malla_curso[0]->id_malla . "' and
                                id_clasificacion='" . $datos_relacion_rel_malla_curso[0]->id_clasificacion . "' and
                                id_curso='" . $curso->id_curso . "' and
                                id_empresa='" . $id_programa_bbddhost[0]->id_empresa_programa . "'
                                ";
                //echo $sql;
                //echo "<br>";
                $query    = $conexion->query($sql);
                if ($query->num_rows > 0) {
                    while ($r = $query->fetch_array()) {
                        //print_r($r);
                        //echo "<br><br>";
                        //echo $r["nombre"];
                        //echo "<br>";
                        $nombre                      = $r["nombre"];
                        $cargo                       = $r["cargo"];
                        $email                       = $r["email"];
                        $datos_calculos_malla[2][3]  = $r["c1"];
                        $datos_calculos_malla[2][4]  = $r["c2"];
                        $datos_calculos_malla[2][4]  = $r["c3"];
                        $c3                          = $r["id_malla"];
                        $id_clasificacion            = $r["id_clasificacion"];
                        $datos_calculos_malla[1]     = $r["avance"];
                        $puntos                      = $r["puntos"];
                        $resultado                   = $r["resultado"];
                        $datos_calculos_malla[2][7]  = $r["medallas"];
                        $fecha                       = $r["fecha"];
                        $hora                        = $r["hora"];
                        $id_empresa_externo          = $r["id_empresa"];
                        $datos_calculos_malla[2][0]  = $r["rut_completo"];
                        $datos_calculos_malla2       = ColocaDatosMallaCapacitacion($rows, $usu->rut, $id_empresa, "", "admin", $arreglo_post, "", $tipo_de_reporte);
                        $datos_calculos_malla[2][3]  = $datos_calculos_malla2[2][3];
                        $datos_calculos_malla[2][4]  = $datos_calculos_malla2[2][4];
                        $datos_calculos_malla[2][5]  = $datos_calculos_malla2[2][5];
                        $datos_calculos_malla[2][10] = $datos_calculos_malla2[2][10];
                    }
                } else {
                    //    echo "No hay resultados";
                }
            } else {
                $datos_calculos_malla = ColocaDatosMallaCapacitacion($rows, $usu->rut, $id_empresa, "", "admin", $arreglo_post, "", $tipo_de_reporte);
                //print_r($datos_calculos_malla);
            }
            $fecha_inicial       = CRON_INDIVIDUAL_LMS_REPORTE_VerificaObjetoFinalizadoDadoObjetoPrimero($curso->id_curso, $usu->rut);
            $fecha_final         = CRON_INDIVIDUAL_LMS_REPORTE_VerificaObjetoFinalizadoDadoObjetoUltima($curso->id_curso, $usu->rut);
            $fecha_final_guardar = "";
            if ($fecha_inicial[0]->fecha <> $fecha_final[0]->fecha and $fecha_inicial[0]->hora <> $fecha_final[0]->hora) {
                $fecha_final_guardar = $fecha_final[0]->fecha;
            }
            $rows = str_replace("{RUT_COMPLETO_EVALUADO}", $datos_calculos_malla[2][0], $rows);
            $rows = str_replace("{NOMBRE_COMPLETO}", $datos_calculos_malla[2][1], $rows);
            $rows = str_replace("{CARGO}", $datos_calculos_malla[2][2], $rows);
            $rows = str_replace("{CAMPO1}", $datos_calculos_malla[2][3], $rows);
            $rows = str_replace("{CAMPO2}", $datos_calculos_malla[2][4], $rows);
            $rows = str_replace("{CAMPO3}", $datos_calculos_malla[2][5], $rows);
            $rows = str_replace("{EMAIL}", $datos_calculos_malla[2][9], $rows);
            $rows = str_replace("{MALLA}", $arreglo_post["malla"], $rows);
            $rows = str_replace("{NUM}", $i, $rows);
            $rows = str_replace("{CURSO}", utf8_encode($curso->nombre), $rows);
            $rows = str_replace("{NUMERO_AVANCE}", CRON_INDIVIDUAL_ColocarColoresConPorcentajeProgressBar($datos_calculos_malla[1]), $rows);
            //$resultado=GAMIFICACIONResultadosPorSoloCurso($usu->rut, $curso->id_curso, $id_empresa);
            //$puntos=GAMIFICACIONResultadosPorSoloCursoPuntos($usu->rut, $curso->id, $id_empresa);
            if ($id_programa_bbddhost[0]->bbdd_host) {
            } else {
                $resultado = GAMIFICACIONResultadosPorSoloCurso($usu->rut, $curso->id_curso, $id_empresa);
                $puntos    = CRON_INDIVIDUAL_GAMIFICACIONResultadosPorSoloCursoPuntos($usu->rut, $curso->id_curso, $id_empresa);
            }
            $rows = str_replace("{PUNTOS}", round($puntos), $rows);
            $rows = str_replace("{RESULTADO}", round($resultado), $rows);
            $rows = str_replace("{MEDALLAS}", $datos_calculos_malla[2][7], $rows);
            //echo "sin insertar";
            CRON_INDIVIDUAL_Inserta_tbl_lms_reportes_sinempresa($usu->rut, $usu->nombre_completo, $usu->cargo, $usu->email, utf8_decode($datos_calculos_malla[2][3]), utf8_decode($datos_calculos_malla[2][4]), utf8_decode($datos_calculos_malla[2][5]), utf8_encode($datos_relacion_rel_malla_curso[0]->id_malla), utf8_encode($datos_relacion_rel_malla_curso[0]->id_clasificacion), utf8_encode($datos_relacion_rel_malla_curso[0]->id_curso), $datos_calculos_malla[1], $puntos, $resultado, $datos_calculos_malla[2][7], $id_empresa, $datos_calculos_malla[2][0], utf8_encode($datos_relacion_rel_malla_curso[0]->id_foco), utf8_encode($datos_relacion_rel_malla_curso[0]->id_programa), $fecha_inicial[0]->fecha, $fecha_final_guardar, utf8_decode($datos_calculos_malla[2][10]), ($datos_relacion_rel_malla_curso[0]->opcional));
        }
    }
    $end = (microtime(true) - $start);
    //echo "elapsed time: $end";
}
function MuestraNotaConvertidaPorEmpresa($id_empresa, $nota)
{

    //echo "<br>$nota";

    $datos_empresa   = DatosEmpresa($id_empresa);
    $nota_convertida = "-";
    if ($datos_empresa[0]->tokem_validacion_externo = "nota1a7trivia") {
        $nota_convertida = ColocaNotaConvertidaTrivia($nota);
    } else {
        $nota_convertida = $nota;
    }
    return ($nota_convertida);
}
function VerificaEstadoDimensionesObjetivosIngresados($evaluado, $id_dimension, $id_empresa)
{
    $objetivos = TraeObjetivosIndividualesDadoRut($evaluado);
    if ($objetivos) {
        $arreglo[0] = '<span class="etiquetaPrograma etiquetaPrograma-aprobado pull-left"><i class="fas fa-check-square"></i>&nbsp;&nbsp;Ingresado</span>';
        $arreglo[1] = 1;
    } else {
        //Veo si tiene 1 objetivo ingresado
        $objetivo_por_dimension = ObjetivosPodDimensionEmpresaUsuario($evaluado, $id_empresa, $id_dimension);
        if (count($objetivo_por_dimension) > 0) {
            $arreglo[0] = '<span class="etiquetaPrograma etiquetaPrograma-pendiente pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Pendiente</span>';
            $arreglo[1] = 2;
        } else {
            $arreglo[0] = '<span class="etiquetaPrograma etiquetaPrograma-pendiente pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Pendiente</span>';
            $arreglo[1] = 0;
        }
    }
    return ($arreglo);
}
function ColocaNotaConvertidaTrivia($nota)
{
    $Nota1a7 = 1;

    // Check if $nota is a number
    if (is_numeric($nota)) {
        $Nota1a7 = 0.06 * $nota + 1;
        $Nota1a7 = round($Nota1a7, 1);

        if ($nota === 0) {
            $Nota1a7 = 1;
        }

        if ($nota === 100) {
            $Nota1a7 = 7;
        }
    }

    return $Nota1a7;
}
function ObtnieneNotaObjetosPonderados($id_empresa, $id_curso, $rut)
{
    $notas      = NotasPonderacionPorObjetoRut($rut, $id_curso, $id_empresa);
    $acumulador = 0;
    foreach ($notas as $not) {
        $acumulador = $acumulador + (($not->nota * $not->ponderacion) / 100);
    }
    return ($acumulador);
}
function ReparaInconsistenciasObjetoCursoMallaAvance($rut, $id_empresa)
{
    //objetos con id curso vacio
    $objetosInconsistencias = ReparaInconsistenciasObjetoCursoMallaAvanceData($rut);
    foreach ($objetosInconsistencias as $objetoInconsistencia) {
        $id_cursoReparar = ReparaInconsistenciasBuscaCursoDadoObjetos($objetoInconsistencia->id_objeto, $id_empresa);
        //print_r($id_cursoReparar);
        ReparaInconsistenciasActualizaObjetoFinalizadoDadoObjetos($rut, $objetoInconsistencia->id_objeto, $id_cursoReparar[0]->id_curso, $id_empresa);
    }
    $objetosInconsistentesErroneos = ReparaInconsistenciasObjetoCursoIncorrectoData($rut);
    foreach ($objetosInconsistentesErroneos as $objetoInconsistenteErroneo) {
        $id_cursoReparar = ReparaInconsistenciasBuscaCursoDadoObjetos($objetoInconsistenteErroneo->id_objeto, $id_empresa);
        ReparaInconsistenciasActualizaObjetoFinalizadoDadoObjetos($rut, $objetoInconsistenteErroneo->id_objeto, $id_cursoReparar[0]->id_curso, $id_empresa);
    }
}
function ReparaInconsistenciasAvanceCurso($rut, $id_curso, $id_empresa)
{





    //$start = microtime(true);

    //echo "hola";
    $AvanceDetalle = ReparaInconsistenciasBuscaObjetoFinalizadosCurso($id_curso, $id_empresa, $rut);
    $nota          = GAMIFICACIONTraeDatosObjetosPorCurso($rut, $id_curso);
    $nota          = $nota[0]->promedio_por_curso;
    //echo "<br>diferencia $id_curso propuesto ";
    //echo $AvanceDetalle[0]->AvancePropuesto;
    //echo "escrito ";
    //    echo $AvanceDetalle[0]->AvanceEscrito;
    if ($AvanceDetalle[0]->AvancePropuesto >= 100) {
        $avance = 100;$estado = 1;
    }
    if ($AvanceDetalle[0]->AvancePropuesto <= 100) {
        $avance = $AvanceDetalle[0]->AvancePropuesto;$estado = 3;
    }
    $datos_objeto = TraigoObjetoCertificacionDadoCurso($id_curso, $id_empresa);
    //print_r($datos_objeto);
    //exit;
    if ($avance == 100) {
        if ($datos_objeto[0]->nota_aprobacion <> '' and $nota < $datos_objeto[0]->nota_aprobacion) {
            //REPROBADO
            //$estado=0;
            $estado             = 1;
            $estado_descripcion = "REPROBADO";
        } else {
            //APROBADO
            $estado             = 1;
            $estado_descripcion = "APROBADO";
        }
        //}
    }
    //echo $avance;exit;
    ReparaInconsistenciasActualizaIncripcionCierre($avance, $estado, $rut, $id_curso, $id_empresa, $nota, $estado_descripcion);


}
function ColocaDatosBiografiaProfesional($id_objeto, $rut, $PRINCIPAL)
{
    return ($PRINCIPAL);
}
function FinalizaObjetoPorUsuario($rut, $id_objeto, $id_empresa)
{
    $datos_objeto = DatosObjeto($id_objeto);
    $puntos       = $datos_objeto[0]->puntos;
    $medalla      = $datos_objeto[0]->medallas;
    FinalizaObjetoFullDatos($rut, $id_objeto, $id_empresa);
}
function EnviaCorreoAccionesPendientes($rut_colaborador, $rut_jefatura, $id_empresa)
{
    //echo "$rut_destinatario,$nombre, $id_estado, $id_empresa, $tipo_correo, $tiporecipiente, $id_mp";
    $datos_empresa      = DatosEmpresa($id_empresa);
    $datos_colaborador  = UsuarioEnBasePersonas($rut_colaborador);
    $datos_jefatura     = UsuarioEnBasePersonas($rut_jefatura);
    $nombre_colaborador = $datos_colaborador[0]->nombre_completo;
    $nombre_jefatura    = $datos_jefatura[0]->nombre_completo;
    $email_jefatura     = $datos_jefatura[0]->email;
    $template_correo    = file_get_contents("views/correos/61_correo_a_jefe.html");
    $template_correo    = str_replace("{NOMBRE_JEFE}", utf8_encode($nombre_jefatura), $template_correo);
    $template_correo    = str_replace("{NOMBRE_COLABORADOR}", utf8_encode($nombre_colaborador), $template_correo);
    //$template_correo = str_replace("{PRACTICA}",utf8_encode($nombre_practica),$template_correo);
    $mail               = new PHPMailer;
    //Tell PHPMailer to use SMTP
    $mail->isSMTP(); //Enable SMTP debugging
    // 0 = off (for production use)
    // 1 = client messages
    // 2 = client and server messages
    $mail->SMTPDebug   = 1;
    //Ask for HTML-friendly debug output
    $mail->Debugoutput = 'error_log';
    //Set the hostname of the mail server
    $mail->Host        = $datos_empresa[0]->server;
    //Set the SMTP port number - likely to be 25, 465 or 587
    $mail->Port        = 25;
    //Whether to use SMTP authentication
    $mail->SMTPAuth    = true;
    //Username to use for SMTP authentication
    $mail->Username    = $datos_empresa[0]->envio_correos;
    //Password to use for SMTP authentication
    $mail->Password    = $datos_empresa[0]->envio_correos_pass;
    //Set who the message is to be sent from
    $mail->setFrom($datos_empresa[0]->envio_correos, "RF");
    $mail->addAddress("daniel@gop.cl", $datos_destinatario[0]->nombre_completo);
    $mail->addAddress("rod@gop.cl", $datos_destinatario[0]->nombre_completo);
    //Set the subject line
    $mail->Subject = "Jefe debes validar el Pasaporte";
    //Read an HTML message body from an external file, convert referenced images to embedded,
    //convert HTML into a basic plain-text alternative body
    $mail->msgHTML($template_correo, dirname(__FILE__));
    //Replace the plain text body with one created manually
    $mail->AltBody = 'Si no puedes visualizar este correo ....';
    //Attach an image file
    //$mail->addAttachment('images/phpmailer_mini.png');
    //send the message, check for errors
    if (!$mail->send()) {
        //echo "Mailer Error: " . $mail->ErrorInfo;
    } else {
        //echo "Message sent!";
    }
    //exit;
}
function VerificoEvalCursos($id_objeto, $rut)
{
    $datos_objeto = DatosObjeto($id_objeto);
    if ($datos_objeto[0]->preguntas_aleatorias > 0) {
        //$datos_preguntas=PreguntasDadoIdObjetoaleatorio($id_objeto, $rut);
        $datos_preguntas = EVALUACION_PreguntasDadoIdObjetoaleatorio($id_objeto, $rut);
    } else {
        //$datos_preguntas=PreguntasDadoIdObjeto($id_objeto);
        $datos_preguntas = EVALUACION_PreguntasDadoIdObjeto($id_objeto);
    }
    $PRINCIPAL       = str_replace("{NOMBRE_OBJETO}", utf8_encode($datos_objeto[0]->titulo), $PRINCIPAL);
    $datos_usuario   = UsuarioEnBasePersonas($rut);
    $PRINCIPAL       = str_replace("{NOMBRE_USUARIO}", utf8_encode($datos_usuario[0]->nombre_completo), $PRINCIPAL);
    $total_preguntas = "";
    $i               = 1;
    $correctas       = 0;
    foreach ($datos_preguntas as $preg) {
        $total_preguntas .= file_get_contents("views/cursos/informe/" . $_SESSION["id_empresa"] . "_row_informe_eval_preguntas.html");
        $total_preguntas   = str_replace("{N}", $i, $total_preguntas);
        $total_preguntas   = str_replace("{PREGUNTA}", $preg->pregunta, $total_preguntas);
        //Verifico si la respuesta que ingreso el usuario para eta pregunta es correcta o no
        $respuesta_usuario = ObtenerRespuestaDeUsuario($preg->id, $rut);
        //print_r($respuesta_usuario);
        $total_preguntas   = str_replace("{TURESPUESTA}", $respuesta_usuario[0]->alternativa, $total_preguntas);
        if ($respuesta_usuario[0]->correcta == "1") {
            $total_preguntas = str_replace("{COLOR_FONDO}", "color_aprobado_text", $total_preguntas);
            $total_preguntas = str_replace("{ICONO_INFORME_PREGUNTAS}", "fas fa-check-square", $total_preguntas);
            $total_preguntas = str_replace("{RESPUESTA_CORRECTA}", "", $total_preguntas);
            $correctas++;
        } else {
            $total_preguntas = str_replace("{COLOR_FONDO}", "color_reprobado_text", $total_preguntas);
            $total_preguntas = str_replace("{ICONO_INFORME_PREGUNTAS}", "far fa-times-circle", $total_preguntas);
            if ($_SESSION["id_empresa"] <> 57) {
                $total_preguntas = str_replace("{RESPUESTA_CORRECTA}", file_get_contents("views/cursos/informe/row_respuesta_correcta.html"), $total_preguntas);
            } else {
                $total_preguntas = str_replace("{RESPUESTA_CORRECTA}", "", $total_preguntas);
            }
            $total_preguntas = str_replace("{CORRECTA}", $respuesta_usuario[0]->alternativa_correcta, $total_preguntas);
        }
        $i++;
    }
    //NotaFinal
    //$nota_final = ($correctas * 100) / count($datos_preguntas);
    if ($_SESSION["id_empresa"] == 57) {
        if ($nota_final == 100) {
            $arreglo[0] = "aprobado";
        } else if ($nota_final >= 0 and $nota_final < 100) {
            $arreglo[0] = "reprobado";
        }
    } else if ($_SESSION["id_empresa"] == 53) {
        if ($nota_final >= 75) {
            $arreglo[0] = "aprobado";
        } else {
            $arreglo[0] = "reprobado";
        }
    } else {
        //Veo si tiene nota de aprobacion el objeto
        $nota_aprobacion_objeto = $datos_objeto[0]->nota_aprobacion;
        if ($nota_aprobacion_objeto) {
            if ($nota_final >= $nota_aprobacion_objeto) {
                $arreglo[0] = "aprobado";
            } else {
                $arreglo[0] = "reprobado";
            }
        } else {
            if ($nota_final == 100) {
                $arreglo[0] = "aprobado";
            } else {
                $arreglo[0] = "reprobado";
            }
        }
    }
    return ($arreglo);
}
function ColocaPReguntasPorEval($id_objeto)
{
    //traigo las preguntas
    $preguntas = PreguntasEvalDadoIdObjeto($id_objeto);
    foreach ($preguntas as $preg) {
        $bloque_preguntas .= file_get_contents("views/cursos/objetos/preguntas/row_pregunta.html");
        $bloque_preguntas  = str_replace("{PREGUNTA}", ($preg->pregunta), $bloque_preguntas);
        $bloque_preguntas  = str_replace("{NUMERO_PREGUNTA}", ($preg->orden_preguntas), $bloque_preguntas);
        //Por cada pregunta, traigo las alternativas
        $alternativas      = AlternativasDadoId($preg->id_grupo_alternativas);
        $html_alternativas = "";
        foreach ($alternativas as $alt) {
            $html_alternativas .= file_get_contents("views/cursos/objetos/preguntas/row_alternativa.html");
            $html_alternativas = str_replace("{ALTERNATIVA}", ($alt->alternativa), $html_alternativas);
            if ($alt->correcta == 1) {
                $html_alternativas = str_replace("{CORRECTA}", "<img src='img/correcta.png'>", $html_alternativas);
            } else if ($alt->correcta == 0) {
                $html_alternativas = str_replace("{CORRECTA}", "<img src='img/incorrecta.png'>", $html_alternativas);
            }
        }
        $bloque_preguntas = str_replace("{ROW_ALTERNATIVAS}", ($html_alternativas), $bloque_preguntas);
    }
    return (utf8_encode($bloque_preguntas));
}
function ColocaObjetosPorCursoSiNotiene($id_empresa, $id_curso, $codigo_imparticion)
{
    $tiene_objeto = CHECK_ObjetosPorCurso($id_curso);
    if (!$tiene_objeto) {
        //Inserto los objetos en la tabla objeto, por este curso
        $objetos = CHECK_TraeObjetosPAraIngresar();
        $orden   = 1;
        foreach ($objetos as $obj) {
            //Inserto el objeto
            //InsertoObjetoCheckin($obj, $id_empresa, $id_curso, $orden);
            if ($codigo_imparticion) {
                InsertoObjetoCheckin($obj, $id_empresa, $codigo_imparticion, $orden, $id_curso);
            } else {
                InsertoObjetoCheckin($obj, $id_empresa, $id_curso, $orden);
            }
            $orden++;
            if ($obj->extension_objeto == "18") {
                if ($codigo_imparticion) {
                    $id_evaluacion = CreoEvaluacionPorObjeto($id_empresa, $codigo_imparticion, $codigo_imparticion . "_" . $obj->id);
                } else {
                    $id_evaluacion = CreoEvaluacionPorObjeto($id_empresa, $id_curso, $id_curso . "_" . $obj->id);
                }
            }
        }
    }
}
function ColocaBloqueComentariosPorObjetoConReplay($id_objeto, $rut, $rut_colaborador_vista_jefe)
{
    //Veo si hay documentos por Objeto
    //echo " rut $rut  ----  desde jefe $rut_colaborador_vista_jefe";
    //$comentarios=ComentariosPorObjeto($id_objeto);
    //echo $rut_colaborador_vista_jefe." rut col desde vista jefe";
    if ($rut_colaborador_vista_jefe) {
        $comentarios = ComentariosPorObjetoPorColaborador($id_objeto, $rut_colaborador_vista_jefe);
    } else {
        $comentarios = ComentariosPorObjetoPorColaborador($id_objeto, $rut);
    }
    $bloque_comentarios = "";
    if ($comentarios) {
        $total = "";
        foreach ($comentarios as $unico) {
            $bloque_comentarios = file_get_contents("views/cursos/objetos/foro_prod/bloque_comentario.html");
            $bloque_comentarios = str_replace("{URL_IMAGEN_PERSONA}", VerificaFotoPersonal($unico->rut), $bloque_comentarios);
            $bloque_comentarios = str_replace("{NOMBRE}", ($unico->nombre_persona), $bloque_comentarios);
            $bloque_comentarios = str_replace("{COMENTARIO}", ($unico->comentario), $bloque_comentarios);
            $bloque_comentarios = str_replace("{RUT_ENCODEADO_AUTOR_COMENTARIO}", Encodear3($unico->rut), $bloque_comentarios);
            $bloque_comentarios = str_replace("{FECHA}", FechaTipoSpa($unico->fecha . " " . $unico->hora), $bloque_comentarios);
            $tiene_megusta      = MegustaPorComentarioRut($unico->id, $rut);
            if ($unico->rut == $rut) {
                $bloque_comentarios = str_replace("{BLOQUE_MEGUSTA}", file_get_contents("views/cursos/objetos/foro_prod/bloque_comentario_micomentario.html"), $bloque_comentarios);
            } else {
                if ($tiene_megusta) {
                    $bloque_comentarios = str_replace("{BLOQUE_MEGUSTA}", file_get_contents("views/cursos/objetos/foro_prod/bloque_comentario_yamegusta.html"), $bloque_comentarios);
                } else {
                    $bloque_comentarios = str_replace("{BLOQUE_MEGUSTA}", file_get_contents("views/cursos/objetos/foro_prod/bloque_comentario_megusta.html"), $bloque_comentarios);
                }
            }
            $bloque_comentarios             = str_replace("{ID_COMENTARIO}", $unico->id, $bloque_comentarios);
            // $bloque_comentarios = str_replace("{ID_OBJETO_ENCODEADO}",$id_objeto,$bloque_comentarios);
            $bloque_comentarios             = str_replace("{ID_COMENTARIO_MEGUSTA}", $unico->id, $bloque_comentarios);
            //Verifico si este comentario ya tiene un me gusta, si ya tiene, le muestro un bloque de me gusta,
            //sino el bloque de Yamegusta
            //Veo cuantos ME GUSTA tiene este comentario
            $cantidad_megusta_porcomentario = MegustaPorComentario($unico->id);
            $bloque_comentarios             = str_replace("{XMEGUSTA}", count($cantidad_megusta_porcomentario), $bloque_comentarios);
            //Aca veo si tiene REPLYS
            $replys                         = ReplysPorComentarios($unico->id);
            $bloque_comentarios             = str_replace("{NUM_RESP}", count($replys), $bloque_comentarios);
            if ($replys) {
                foreach ($replys as $repl) {
                    $replys_html .= file_get_contents("views/cursos/objetos/foro_prod/bloque_comentario_replay.html");
                    $replys_html             = str_replace("{URL_IMAGEN_PERSONA}", VerificaFotoPersonal($repl->rut), $replys_html);
                    $replys_html             = str_replace("{NOMBRE}", ($repl->nombre_completo), $replys_html);
                    $replys_html             = str_replace("{COMENTARIO}", ($repl->comentario), $replys_html);
                    $replys_html             = str_replace("{RUT_ENCODEADO_AUTOR_COMENTARIO}", Encodear3($repl->rut), $replys_html);
                    $replys_html             = str_replace("{FECHA}", FechaTipoSpa($repl->fecha . " " . $repl->hora), $replys_html);
                    $tiene_megusta_por_reply = MegustaPorComentarioRutReply($repl->id, $rut);
                    if ($repl->rut == $rut) {
                        $replys_html = str_replace("{BLOQUE_MEGUSTA_REPLY}", file_get_contents("views/cursos/objetos/foro_prod/bloque_comentario_reply_micomentario.html"), $replys_html);
                    } else {
                        if ($tiene_megusta_por_reply) {
                            $replys_html = str_replace("{BLOQUE_MEGUSTA_REPLY}", file_get_contents("views/cursos/objetos/foro_prod/bloque_comentario_reply_yamegusta.html"), $replys_html);
                        } else {
                            $replys_html = str_replace("{BLOQUE_MEGUSTA_REPLY}", file_get_contents("views/cursos/objetos/foro_prod/bloque_comentario_reply_megusta.html"), $replys_html);
                        }
                    }
                    $replys_html                         = str_replace("{ID_COMENTARIO_REPLY}", ($repl->id), $replys_html);
                    $cantidad_megusta_porcomentarioReply = MegustaPorComentarioReply($repl->id);
                    $replys_html                         = str_replace("{XMEGUSTAREPLY}", count($cantidad_megusta_porcomentarioReply), $replys_html);
                }
                $bloque_comentarios = str_replace("{LISTADO_REPLY_POR_COMENTARIO}", $replys_html, $bloque_comentarios);
            } else {
                $bloque_comentarios = str_replace("{LISTADO_REPLY_POR_COMENTARIO}", "", $bloque_comentarios);
            }
            $total .= $bloque_comentarios;
        }
    } else {
    }
    return (utf8_encode($total));
}
function ColocaBloqueComparte($PRINCIPAL, $id_empresa, $id_malla, $rut, $tipo)
{
    if ($tipo == "home") {
        $limit_total = "3";
        $html        = file_get_contents("views/cursos/objetos/foro_cat/formulario.html");
    } else if ($tipo == "todo") {
        $limit_total = "";
        $html        = file_get_contents("views/cursos/objetos/foro_cat/formulario_completo.html");
    }
    $html             = str_replace("{URL_MIPERFIL}", VerificaFotoPersonal($rut), $html);
    $html             = str_replace("{ID_MALLA_ENCODEADO}", Encodear3($id_malla), $html);
    //Dado la malla, traigo los cursos
    $cursos_por_malla = ObtenerCursosDadoMalla2($id_malla);
    $options_cursos   = "";
    foreach ($cursos_por_malla as $curso) {
        $options_cursos .= "<option value='" . $curso->id . "'>" . $curso->nombre . "</option>";
    }
    $html                = str_replace("{OPTIONS}", utf8_encode($options_cursos), $html);
    $html                = str_replace("{ID_MALLA_ENCODEADA}", Encodear3($id_malla), $html);
    //Aca traigo los ultimos 3 comentarios con más me gusta
    $ultimos_comentarios = ComentariosPorMallaEmpresa($id_malla, $id_empresa, $limit_total);
    $html_comentarios    = "";
    foreach ($ultimos_comentarios as $comen) {
        $html_comentarios .= file_get_contents("views/cursos/objetos/foro_cat/row_reciente.html");
        $html_comentarios = str_replace("{NOMBRE_COMPLETO}", $comen->nombre_completo, $html_comentarios);
        $html_comentarios = str_replace("{COMENTARIO}", $comen->comentario, $html_comentarios);
        $html_comentarios = str_replace("{CATEGORIA}", $comen->valor_categoria, $html_comentarios);
        $html_comentarios = str_replace("{URL_PERSONA}", VerificaFotoPersonal($comen->rut), $html_comentarios);
        $html_comentarios = str_replace("{TIEMPO}", ($comen->fecha), $html_comentarios);
        $tiene_megusta    = MegustaPorComentarioRut($comen->id, $rut);
        if ($comean->rut == $rut) {
            $html_comentarios = str_replace("{BLOQUE_MEGUSTA}", file_get_contents("views/cursos/objetos/foro_cat/bloque_comentario_micomentario.html"), $html_comentarios);
        } else {
            if ($tiene_megusta) {
                $html_comentarios = str_replace("{BLOQUE_MEGUSTA}", file_get_contents("views/cursos/objetos/foro_cat/bloque_comentario_yamegusta.html"), $html_comentarios);
            } else {
                $html_comentarios = str_replace("{BLOQUE_MEGUSTA}", file_get_contents("views/cursos/objetos/foro_cat/bloque_comentario_megusta.html"), $html_comentarios);
            }
        }
        $html_comentarios               = str_replace("{ID_COMENTARIO_MEGUSTA}", ($comen->id), $html_comentarios);
        $cantidad_megusta_porcomentario = MegustaPorComentario($comen->id);
        $html_comentarios               = str_replace("{XMEGUSTA}", count($cantidad_megusta_porcomentario), $html_comentarios);
    }
    $ultimos_comentarios_ingresados = ComentariosPorMallaEmpresaLimit($id_malla, $id_empresa, $limit_total);
    foreach ($ultimos_comentarios_ingresados as $comen) {
        $html_comentarios_ultimos .= file_get_contents("views/cursos/objetos/foro_cat/row_reciente.html");
        $html_comentarios_ultimos = str_replace("{NOMBRE_COMPLETO}", $comen->nombre_completo, $html_comentarios_ultimos);
        $html_comentarios_ultimos = str_replace("{COMENTARIO}", $comen->comentario, $html_comentarios_ultimos);
        $html_comentarios_ultimos = str_replace("{CATEGORIA}", $comen->valor_categoria, $html_comentarios_ultimos);
        $html_comentarios_ultimos = str_replace("{URL_PERSONA}", VerificaFotoPersonal($comen->rut), $html_comentarios_ultimos);
        $html_comentarios_ultimos = str_replace("{TIEMPO}", ($comen->fecha), $html_comentarios_ultimos);
        $tiene_megusta            = MegustaPorComentarioRut($comen->id, $rut);
        if ($comean->rut == $rut) {
            $html_comentarios_ultimos = str_replace("{BLOQUE_MEGUSTA}", file_get_contents("views/cursos/objetos/foro_cat/bloque_comentario_micomentario.html"), $html_comentarios_ultimos);
        } else {
            if ($tiene_megusta) {
                $html_comentarios_ultimos = str_replace("{BLOQUE_MEGUSTA}", file_get_contents("views/cursos/objetos/foro_cat/bloque_comentario_yamegusta.html"), $html_comentarios_ultimos);
            } else {
                $html_comentarios_ultimos = str_replace("{BLOQUE_MEGUSTA}", file_get_contents("views/cursos/objetos/foro_cat/bloque_comentario_megusta.html"), $html_comentarios_ultimos);
            }
        }
        $html_comentarios_ultimos       = str_replace("{ID_COMENTARIO_MEGUSTA}", ($comen->id), $html_comentarios_ultimos);
        $cantidad_megusta_porcomentario = MegustaPorComentario($comen->id);
        $html_comentarios_ultimos       = str_replace("{XMEGUSTA}", count($cantidad_megusta_porcomentario), $html_comentarios_ultimos);
    }
    $html      = str_replace("{LISTADO_COMENTARIOS}", utf8_encode($html_comentarios), $html);
    $html      = str_replace("{LISTADO_COMENTARIOS_RECIENTES}", utf8_encode($html_comentarios_ultimos), $html);
    $PRINCIPAL = str_replace("{BLOQUE_COMPARTE}", $html, $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocaRankingTopHomeInicial($PRINCIPAL, $id_empresa, $id_malla)
{
    $limit            = 10;
    //Por default ejecuta en base a avance de la malla
    $listado_usuarios = ObtenerRankigPorAvanceMallaempresa($limit, $id_empresa, $id_malla);
    $i                = 1;
    foreach ($listado_usuarios as $unico) {
        $listado .= file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_ranking_individual_home.html");
        $listado = str_replace("{NOMBRE_COMPLETO}", $unico->nombre_completo, $listado);
        $listado = str_replace("{CARGO}", $unico->cargo, $listado);
        $listado = str_replace("{URL_PERSONA}", ColocaImagenVerificaAvatar($unico->rut), $listado);
        $listado = str_replace("{RANK}", $i, $listado);
        $listado = str_replace("{VALOR}", FormatearPorcentajes($unico->valor), $listado);
        $listado = str_replace("{medallas}", ($unico->cuentamedallas), $listado);
        $listado = str_replace("{PUNTOS_CONSOLIDADOS}", ($unico->cuentapuntos), $listado);
        $i++;
    }
    $PRINCIPAL = str_replace("{ROW_LISTADO_RANKING_Individual}", $listado, $PRINCIPAL);
    $PRINCIPAL = str_replace("{ROW_LISTADO_RANKING_HOME}", $listado, $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocaRankingTopHomeInicialIndividual($PRINCIPAL, $id_empresa, $id_malla)
{
    $limit            = 10;
    //Por default ejecuta en base a avance de la malla
    $listado_usuarios = ObtenerRankigPorAvanceMallaempresaIndividual($limit, $id_empresa, $id_malla);
    $i                = 1;
    foreach ($listado_usuarios as $unico) {
        $listado .= file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_ranking_individual_home.html");
        $listado = str_replace("{NOMBRE_COMPLETO}", $unico->nombre_completo, $listado);
        $listado = str_replace("{CARGO}", $unico->cargo, $listado);
        $listado = str_replace("{URL_PERSONA}", ColocaImagenVerificaAvatar($unico->rut), $listado);
        $listado = str_replace("{RANK}", $i, $listado);
        $listado = str_replace("{VALOR}", ($unico->puntos), $listado);
        $i++;
    }
    $PRINCIPAL = str_replace("{ROW_LISTADO_RANKING_Individual}", $listado, $PRINCIPAL);
    return ($PRINCIPAL);
}
function PuntosPersonalesHomeBciRev($id_empresa, $id_malla, $rut, $PRINCIPAL)
{
    $limit            = 10;
    //Por default ejecuta en base a avance de la malla
    $listado_usuarios = PuntosPersonalesHomeBciRev_data($id_empresa, $id_malla, $rut);
    $i                = 1;
    //print_r($listado_usuarios);
    foreach ($listado_usuarios as $unico) {
        $listado .= file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_ranking_individual_home.html");
        $listado = str_replace("{NOMBRE_COMPLETO}", $unico->nombre_completo, $listado);
        $listado = str_replace("{CARGO}", $unico->cargo, $listado);
        $listado = str_replace("{URL_PERSONA}", ColocaImagenVerificaAvatar($unico->rut), $listado);
        $listado = str_replace("{RANK}", $i, $listado);
        $listado = str_replace("{VALOR}", FormatearPorcentajes($unico->valor), $listado);
        $i++;
    }
    $PRINCIPAL = str_replace("{REV_MUESTRA_PUNTOS_TOTALES}", $listado, $PRINCIPAL);
    return (FormatearPorcentajes($unico->valor));
}
function ColocarBLOQUEDATOSUsuarios2($total, $id_empresa, $rut)
{
    $total                   = str_replace("{BLOQUE_DATOS_PERSONALES}", file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_mi_perfil_bloque_datos.html"), $total);
    $total                   = str_replace("{RANK}", $i, $total);
    $total                   = str_replace("{NOMBRE_COMPLETO}", $usu->nombre_completo, $total);
    $total                   = str_replace("{CARGO}", $usu->cargo, $total);
    $total                   = str_replace("{PUNTOS_CONSOLIDADOS}", $usu->puntosconsolidados, $total);
    $total                   = str_replace("{medallas}", $usu->medallas, $total);
    $total                   = str_replace("{URL_PERSONA}", ColocaImagenVerificaAvatar($usu->rut), $total);
    $total                   = str_replace("{RUT_ENCODEADO}", Encodear3($usu->rut), $total);
    $total                   = str_replace("{RUT}", ($usu->rut), $total);
    $total_imagenes_medallas = ColocaImagenesMedallas($usu->medallas, $imagen_medalla);
    $total                   = str_replace("{IMAGENMEDALLAS}", $total_imagenes_medallas, $total);
    $total                   = str_replace("{CAMPO1}", ($usu->campo1), $total);
    $total                   = str_replace("{CAMPO2}", ($usu->campo2), $total);
    $total                   = str_replace("{CAMPO3}", ($usu->campo3), $total);
    $total                   = str_replace("{NOMBRE_COMPLETO}", "hol", $total);
    return ($total);
}
function Lms_Muestra_Objetos_Comunidades($PRINCIPAL, $id_malla, $id_empresa)
{
    $Lms_Trae_Comunidades = Lms_Trae_Comunidades_Objeto_Malla_empresa($id_malla, $id_empresa);
    //print_r($Lms_Trae_Comunidades);
    if ($Lms_Trae_Comunidades) {
        foreach ($Lms_Trae_Comunidades as $Lms_Trae_Comunidad) {
            //print_r($Lms_Trae_Comunidad);
            $PRINCIPAL = ComunidadObjeto($PRINCIPAL, $Lms_Trae_Comunidad->template, $Lms_Trae_Comunidad->id_objeto, $Lms_Trae_Comunidad->numerorows, $Lms_Trae_Comunidad->orden, $Lms_Trae_Comunidad->lectura, $Lms_Trae_Comunidad->volver, $Lms_Trae_Comunidad->sinboton, $Lms_Trae_Comunidad->textoboton);
        }
    } else {
        echo "No hay objetos cargados en las comunidades";
    }
    return $PRINCIPAL;
}
function ColocaBloqueCompromisosMasVotados($PRINCIPAL, $id_objeto)
{
    //obtengo comentarios dado id_objeto
    $total_compromisos = ObtenerCompromisosDadoIdObjeto($id_objeto);
    if ($total_compromisos) {
        foreach ($total_compromisos as $comp) {
            $row_html .= file_get_contents("views/cursos/objetos/compromisos/row_reciente.html");
            $row_html = str_replace("{NOMBRE_COMPLETO}", $comp->nombre_completo, $row_html);
            $row_html = str_replace("{COMPROMISO}", $comp->compromiso, $row_html);
            $row_html = str_replace("{PA1}", $comp->pa1, $row_html);
            $row_html = str_replace("{PC1}", $comp->pc1, $row_html);
            $row_html = str_replace("{PA2}", $comp->pa2, $row_html);
            $row_html = str_replace("{PC2}", $comp->pc2, $row_html);
            $row_html = str_replace("{PA3}", $comp->pa3, $row_html);
            $row_html = str_replace("{PC3}", $comp->pc3, $row_html);
            $row_html = str_replace("{TIEMPO}", FechaTipoSpa($comp->fecha . " " . $comp->hora), $row_html);
            $row_html = str_replace("{CANTIDAD_MEGUSTA}", $comp->total_megusta, $row_html);
            $row_html = str_replace("{URL_PERSONA}", VerificaFotoPersonal($comp->rut), $row_html);
        }
        $PRINCIPAL = str_replace("{BLOQUE_COMPROMISOS_MAS_VOTADOS}", utf8_encode($row_html), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BLOQUE_COMPROMISOS_MAS_VOTADOS}", "", $PRINCIPAL);
    }
    return ($PRINCIPAL);
}
function ColocaCompromisosPorObjeto($id_objeto, $rut)
{
    //Veo si hay documentos por Objeto
    $compromisos        = CompromisosPorObjetosDatos($id_objeto);
    $bloque_compromisos = "";
    if ($compromisos) {
        $total = "";
        foreach ($compromisos as $unico) {
            $bloque_compromisos = file_get_contents("views/cursos/objetos/compromisos/bloque_compromiso.html");
            $bloque_compromisos = str_replace("{URL_IMAGEN_PERSONA}", VerificaFotoPersonal($unico->rut), $bloque_compromisos);
            $bloque_compromisos = str_replace("{NOMBRE}", ($unico->nombre_completo), $bloque_compromisos);
            $bloque_compromisos = str_replace("{COMPROMISO}", ($unico->compromiso), $bloque_compromisos);
            $bloque_compromisos = str_replace("{PA1}", ($unico->pa1), $bloque_compromisos);
            $bloque_compromisos = str_replace("{PC1}", ($unico->pc1), $bloque_compromisos);
            $bloque_compromisos = str_replace("{PA2}", ($unico->pa1), $bloque_compromisos);
            $bloque_compromisos = str_replace("{PC2}", ($unico->pc1), $bloque_compromisos);
            $bloque_compromisos = str_replace("{PA3}", ($unico->pa1), $bloque_compromisos);
            $bloque_compromisos = str_replace("{PC3}", ($unico->pc1), $bloque_compromisos);
            $bloque_compromisos = str_replace("{META}", ($unico->meta), $bloque_compromisos);
            $bloque_compromisos = str_replace("{PLAN}", ($unico->plan), $bloque_compromisos);
            $bloque_compromisos = str_replace("{RUT_ENCODEADO_AUTOR_COMENTARIO}", Encodear3($unico->rut), $bloque_compromisos);
            $bloque_compromisos = str_replace("{FECHA}", FechaTipoSpa($unico->fecha . " " . $unico->hora), $bloque_compromisos);
            $tiene_megusta      = MegustaPorCompromisoRut($unico->id, $rut);
            /* if($unico->rut==$rut){
            $bloque_compromisos = str_replace("{BLOQUE_MEGUSTA}",file_get_contents("views/cursos/objetos/compromisos/bloque_micompromiso.html"),$bloque_compromisos);
            }else{
            if($tiene_megusta){
            $bloque_compromisos = str_replace("{BLOQUE_MEsGUSTA}",file_get_contents("views/cursos/objetos/compromisos/bloque_yamegusta.html"),$bloque_compromisos);
            }else{
            $bloque_compromisos = str_replace("{BLOQUE_MEGUdSTA}",file_get_contents("views/cursos/objetos/compromisos/bloque_megusta.html"),$bloque_compromisos);
            }
            }
            * */
            if ($tiene_megusta) {
                $bloque_compromisos = str_replace("{BLOQUE_MEGUSTA}", file_get_contents("views/cursos/objetos/compromisos/bloque_yamegusta.html"), $bloque_compromisos);
            } else {
                $bloque_compromisos = str_replace("{BLOQUE_MEGUSTA}", file_get_contents("views/cursos/objetos/compromisos/bloque_megusta.html"), $bloque_compromisos);
            }
            $bloque_compromisos             = str_replace("{ID_COMPROMISO}", $unico->id, $bloque_compromisos);
            $bloque_compromisos             = str_replace("{ID_COMPROMISO_MEGUSTA}", $unico->id, $bloque_compromisos);
            //Verifico si este comentario ya tiene un me gusta, si ya tiene, le muestro un bloque de me gusta,
            //sino el bloque de Yamegusta
            //Veo cuantos ME GUSTA tiene este comentario
            $cantidad_megusta_porcompromiso = MegustaPorCompromiso($unico->id);
            $bloque_compromisos             = str_replace("{XMEGUSTA}", count($cantidad_megusta_porcompromiso), $bloque_compromisos);
            $total .= $bloque_compromisos;
        }
    } else {
    }
    return (utf8_encode($total));
}
function MuestraInformeEnc($PRINCIPAL, $id_encuesta, $id_empresa, $id_objeto, $id_curso)
{
    //dada la id de la encuestra, traigo las dimesiones
    $dimensiones_por_encuesta = ENC_TraigoDimensionesPorEncuesta($id_empresa, $id_encuesta);
    $html .= file_get_contents("views/encuesta/" . $id_empresa . "_template_enc_informe.html");
    foreach ($dimensiones_por_encuesta as $dimen) {
        $row .= file_get_contents("views/encuesta/" . $id_empresa . "_row_dimension_informe.html");
        $row                     = str_replace("{GRAFICO}", file_get_contents("views/encuesta/" . $id_empresa . "_barra1.html"), $row);
        $row                     = str_replace("{CODIGO_GRAFICO}", ($dimen->iddimension), $row);
        $row                     = str_replace("{NOMBRE_DIMENSION}", ($dimen->dimension), $row);
        //Por cada dimension traigo las preguntas
        $preguntas_por_dimension = ENC_TraigoPreguntaDadaDimenion($dimen->iddimension);
        $acumulador_notas        = 0;
        $acumulador_rojo         = 0;
        $acumulador_amarillo     = 0;
        $acamulador_verde        = 0;
        $acumulador_cuenta       = 0;
        $acumulador_1            = 0;
        $acumulador_2            = 0;
        $acumulador_3            = 0;
        $acumulador_4            = 0;
        $acumulador_5            = 0;
        $acumulador_6            = 0;
        $acumulador_7            = 0;
        $acumulador_T            = 0;
        //echo $dimen->dimension."<br>";
        foreach ($preguntas_por_dimension as $preg) {
            $promedio_por_preg = ENC_CuentaDeRespuestasPorPregunta7op($id_empresa, $id_encuesta, $preg->idpregunta, $id_objeto);
            //echo "<pre>";
            //print_r($promedio_por_preg);
            $acumulador_notas  = $acumulador_notas + $promedio_por_preg[0]->promedio_pregunta;
            ++$numpreg;
            $acumulador_1 = $promedio_por_preg[0]->cuenta1 + $acumulador_1;
            $acumulador_2 = $promedio_por_preg[0]->cuenta2 + $acumulador_2;
            $acumulador_3 = $promedio_por_preg[0]->cuenta3 + $acumulador_3;
            $acumulador_4 = $promedio_por_preg[0]->cuenta4 + $acumulador_4;
            $acumulador_5 = $promedio_por_preg[0]->cuenta5 + $acumulador_5;
            $acumulador_6 = $promedio_por_preg[0]->cuenta6 + $acumulador_6;
            $acumulador_7 = $promedio_por_preg[0]->cuenta7 + $acumulador_7;
            $acumulador_T = $promedio_por_preg[0]->cuentatodas + $acumulador_T;
        }
        //echo "$acumulador_1 $acumulador_2 $acumulador_3 $acumulador_4 $acumulador_5 $acumulador_6 $acumulador_7 <br>";
        $promedio_1 = round(100 * $acumulador_1 / $acumulador_T, 1);
        $promedio_2 = round(100 * $acumulador_2 / $acumulador_T, 1);
        $promedio_3 = round(100 * $acumulador_3 / $acumulador_T, 1);
        $promedio_4 = round(100 * $acumulador_4 / $acumulador_T, 1);
        $promedio_5 = round(100 * $acumulador_5 / $acumulador_T, 1);
        $promedio_6 = round(100 * $acumulador_6 / $acumulador_T, 1);
        $promedio_7 = round(100 * $acumulador_7 / $acumulador_T, 1);
        $row        = str_replace("{VALUE1}", round($promedio_1, 0), $row);
        $row        = str_replace("{VALUE2}", round($promedio_2, 0), $row);
        $row        = str_replace("{VALUE3}", round($promedio_3, 0), $row);
        $row        = str_replace("{VALUE4}", round($promedio_4, 0), $row);
        $row        = str_replace("{VALUE5}", round($promedio_5, 0), $row);
        $row        = str_replace("{VALUE6}", round($promedio_6, 0), $row);
        $row        = str_replace("{VALUE7}", round($promedio_7, 0), $row);
    }
    $html = str_replace("{LISTADO_DIMENSIONES}", ($row), $html);
    //$comentarios=ComentariosFinalesEncSatis($id_objeto, $id_empresa);
    foreach ($comentarios as $comentario) {
        $row_comentario .= file_get_contents("views/encuesta/" . $id_empresa . "_row_comentario_informe.html");
        $row_comentario = str_replace("{COMENTARIO}", ($comentario->comentario), $row_comentario);
    }
    $html      = str_replace("{LISTADO_COMENTARIOS}", ($row_comentario), $html);
    $PRINCIPAL = str_replace("{BLOQUE_ENCUESTA}", utf8_encode($html), $PRINCIPAL);
    return ($PRINCIPAL);
}
function TransformaEscalaBase100($promedio_por_dimension, $max, $min)
{
    $resto = $max - $min;
    $saldo = round(100 / $resto);
    $valor = round(($promedio_por_dimension - 1) * $saldo);
    return $valor;
}
function ConsultaWebService($rut, $id_objeto, $verifica)
{
    $id_empresa      = $_SESSION["id_empresa"];
    $datos_objeto    = DatosObjeto($id_objeto);
    $datos_usuario   = UsuarioEnBasePersonas($rut);
    $link_webservice = utf8_encode($datos_objeto[0]->llamada_webservice);
    //$datos_usuario[0]->email="pamela.bizama@bci.cl";
    $link_webservice = str_replace("{CORREO}", $datos_usuario[0]->email, $link_webservice);
    //print_r($link_webservice);
    $JsonSource      = $link_webservice;
    $json            = json_decode(file_get_contents($JsonSource));
    $status          = $json->info->status;
    $resultado       = $json->info->resutl;
    //$status="OK";
    //$status="ERROR";
    if ($verifica == 1) {
        if ($id_objeto == "br_m1c5m5") {
            $status = "OK";
        }
        ;
        if ($id_objeto == "br_m1c5m6") {
            $status = "OK";
        }
        ;
        if ($id_objeto == "br_m2m29") {
            $status = "OK";
        }
        ;
        if ($id_objeto == "br_m2m30") {
            $status = "OK";
        }
        ;
    }
    if ($status == "OK" or $id_objeto == "br_m1c1m3") {
        /*$tiene_punto_objeto=GAMIFICACIONTienePuntosPorCursoObjetoRutEmpresa($rut, $id_objeto, $datos_objeto[0]->id_curso, $_SESSION["id_empresa"]);
        if($tiene_punto_objeto){
        $objeto_finalizado=ObjetoFinalizadoDadoIdYRut($rut ,$id_objeto);
        if(!$objeto_finalizado){
        IngresoObjetoFinalizado($rut, $id_objeto, "", "", "", $datos_objeto[0]->id_curso);
        VerificaFinalizaCurso($datos_objeto[0]->id_curso, $rut);
        CAPACITACIONActualizarDatosCierre($id_curso, $rut, $_SESSION["id_empresa"], "");
        }
        }else{
        if($datos_objeto[0]->gamificado==1){
        IngresoObjetoFinalizado($rut, $id_objeto, $tiempo_navegado, "", "", $datos_objeto[0]->id_curso);
        VerificaFinalizaCurso($datos_objeto[0]->id_curso, $rut);
        }
        }
        */
        FinalizaObjetoFullDatos($rut, $id_objeto, $id_empresa);
        $bloque_finalizado = file_get_contents("views/cursos/objetos/WebService/bloqueRealizado.html");
        $arreglo[0]        = $bloque_finalizado;
    } else {
        if ($verifica == 1) {
            //$bloque_finalizado.=file_get_contents("views/cursos/objetos/WebService/bloqueError.html");
            //Inserto registro en tabla de objetos no finalizados
            InsertaRegistroTblRegistrosNofinalizados($rut, $id_empresa, $id_malla, $datos_objeto[0]->id_curso, $id_objeto);
            $bloque_finalizado .= file_get_contents("views/cursos/objetos/WebService/bloqueNoRealizadoConAlert.html");
            $bloque_finalizado = str_replace("{ID_CURSO_ENCODEADO}", Encodear3($datos_objeto[0]->id_curso), $bloque_finalizado);
        } else {
            $bloque_finalizado .= file_get_contents("views/cursos/objetos/WebService/bloqueNoRealizado.html");
        }
        //$bloque_finalizado = str_replace("{URL}",$link_webservice,$bloque_finalizado);
        $arreglo[0] = $bloque_finalizado;
    }
    return ($arreglo);
}
function ObtenerDatosMoodle($arreglo_datos_curso, $HTML, $bloque, $id_scorm, $rut_usuario)
{
    if ($rut_usuario) {
        $datos_usuario = UsuarioEnBasePersonas($rut_usuario);
    } else {
        $datos_usuario = UsuarioEnBasePersonas($_SESSION["user_"]);
    }
    $userid_moodle = $datos_usuario[0]->userid_moodle;
    $id_curso      = $arreglo_datos_curso->id_curso;
    //$id_scorm=$arreglo_datos_curso->id_scorm;
    $link2         = mysql_connect("gopartners.cl", "gopartne_moodle", "GMknehSNTpSR");
    mysql_select_db("gopartne_moodle26", $link2);
    $sql2                 = "SELECT * FROM mdl_scorm_scoes where scorm='$id_scorm' and scormtype='sco'";
    //echo $sql2;
    $result2              = mysql_query($sql2, $link2);
    //esta correspnde a la cantidad de modulos por ese scorm
    $cantidad_scorm       = mysql_num_rows($result2);
    //echo $cantidad_scorm;echo "<br>";
    //$sql3="select * from mdl_scorm_scoes_track where userid='$userid_moodle' and value>='0' and value <='100' and scormid='$id_scorm'";
    //$sql3="select * from mdl_scorm_scoes_track where userid='$userid_moodle' and value='completed'   and scormid='$id_scorm'";
    $sql3                 = "select * from mdl_scorm_scoes_track where userid='$userid_moodle' and (value='completed' or value='passed' or value='failed')  and scormid='$id_scorm'";
    //echo "<br>";
    //echo $sql3;
    //exit;
    $result3              = mysql_query($sql3, $link2);
    $cantidad_finalizados = mysql_num_rows($result3);
    //echo $cantidad_finalizados;exit;
    //PORCENTAJE DE AVANCE
    $porcentaje_avance    = round(($cantidad_finalizados * 100) / $cantidad_scorm);
    //porcentaje de avance
    $arreglo[0]           = $porcentaje_avance;
    //echo $porcentaje_avance."<br><br>";
    //Ahora obtengo la nota mas alta
    $sql4                 = "select *  from mdl_scorm_scoes_track where userid='$userid_moodle' and element='cmi.core.score.raw' and scormid='$id_scorm' order by value desc limit 1";
    $result4              = mysql_query($sql4, $link2);
    while ($row = mysql_fetch_array($result4)) {
        $nota = $row['value'];
    }
    //devuelvo la nota
    $arreglo[1]      = $nota;
    //devuelvo el total de modulos
    $arreglo[2]      = $cantidad_scorm;
    //devuelvo el total de finalizados
    $arreglo[3]      = $cantidad_finalizados;
    $HTML            = str_replace("{TOTAL_MODULOS}", $arreglo[2], $HTML);
    $HTML            = str_replace("{TOTAL_MODULOS_PENDIENTES}", $arreglo[2] - $arreglo[3], $HTML);
    $HTML            = str_replace("{TOTAL_MODULOS_FINALIZADOS}", $arreglo[3], $HTML);
    $HTML            = str_replace("{NOTA_OBTENIDA}", $arreglo[1], $HTML);
    $arreglo[4]      = $HTML;
    $row_curso_nivel = file_get_contents("views/cursos/capacitacion/" . $_SESSION["id_empresa"] . "_row_bloque_niveles_curso.html");
    $row_curso_nivel = str_replace("{TOTAL_MODULOS_PENDIENTES}", $arreglo[2] - $arreglo[3], $row_curso_nivel);
    $row_curso_nivel = str_replace("{TOTAL_MODULOS_FINALIZADOS}", $arreglo[3], $row_curso_nivel);
    $row_curso_nivel = str_replace("{NOMBRE_CURSO_MOODLE}", utf8_encode($arreglo_datos_curso->nombre_curso), $row_curso_nivel);
    $arreglo[5]      = $row_curso_nivel;
    return ($arreglo);
}
function MPColocaOtrasPracticas($id_mp, $tipo, $id_empresa, $limit)
{
    //trae el total de interacciones por mp
    $total_practicas_leidas = MPOtrasPracticas($id_mp, $tipo, $id_empresa, $limit);
    //echo "<br>$id_mp, $tipo, $id_empresa, $limit<br>";
    //print_r($total_practicas);
    if ($total_practicas_leidas) {
        foreach ($total_practicas_leidas as $total_practica) {
            $total_practicas .= file_get_contents("views/mejorespracticas/mp_row_otraspracticas.html");
            $total_practicas = str_replace("{NOMBRE_PRACTICA}", $total_practica->nombre, $total_practicas);
            $total_practicas = str_replace("{ID_MP}", $total_practica->id_mp, $total_practicas);
            $total_practicas = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($total_practica->rut), $total_practicas);
            $datos_usuario   = UsuarioEnBasePersonas($total_practica->rut);
            $total_practicas = str_replace("{NOMBRE_AUTOR}", $datos_usuario[0]->nombre_completo, $total_practicas);
            //$total_practicas = str_replace("{LINK}",VerificaFotoPersonal($total_practica->rut),$total_practicas);
        }
    } else {
        $total_practicas = "No existen pr&aacute;cticas";
    }
    //print_r($total_practicas);
    //$PRINCIPAL = str_replace("{INTERACCIONES}",$listado_interacciones,$PRINCIPAL);
    return (utf8_encode($total_practicas));
}
function MPColocaPreguntasPracticas($id_empresa, $limit)
{
    $total_practicas_leidas = MPPreguntas($id_empresa, $limit);
    //echo "<br>$id_empresa, $limit<br>";
    //print_r($total_practicas);
    if ($total_practicas_leidas) {
        foreach ($total_practicas_leidas as $total_practica) {
            $total_practicas .= file_get_contents("views/mejorespracticas/mp_row_preguntaspracticas.html");
            $total_practicas = str_replace("{NOMBRE_PRACTICA}", $total_practica->pregunta, $total_practicas);
            $total_practicas = str_replace("{ID_MP}", $total_practica->id_mp, $total_practicas);
            $total_practicas = str_replace("{RUT_AUTOR}", $total_practica->autor_pregunta, $total_practicas);
            $total_practicas = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($total_practica->autor_pregunta), $total_practicas);
            $datos_usuario   = UsuarioEnBasePersonas($total_practica->autor_pregunta);
            $total_practicas = str_replace("{NOMBRE_AUTOR}", $datos_usuario[0]->nombre_completo, $total_practicas);
            //$total_practicas = str_replace("{LINK}",VerificaFotoPersonal($total_practica->rut),$total_practicas);
        }
    } else {
        $total_practicas = "No existen preguntas";
    }
    //$PRINCIPAL = str_replace("{INTERACCIONES}",$listado_interacciones,$PRINCIPAL);
    return (utf8_encode($total_practicas));
}
function MPColocaBloqueInteracciones($id_mp, $id_empresa, $pdf)
{
    //trae el total de interacciones por mp
    $total_interacciones = MPTotalInteraccionesPorMP($id_mp, $id_empresa);
    if ($total_interacciones) {
        foreach ($total_interacciones as $tot) {
            if ($pdf == "pdf") {
                $listado_interacciones .= file_get_contents("views/mejorespracticas/mp_interaccion_ingresada_pdf.html");
            } else {
                $listado_interacciones .= file_get_contents("views/mejorespracticas/mp_interaccion_ingresada.html");
            }
            $listado_interacciones = str_replace("{NOMBRE_COMPLETO}", $tot->nombre_completo, $listado_interacciones);
            $listado_interacciones = str_replace("{COMENTARIO}", $tot->contenido, $listado_interacciones);
            $listado_interacciones = str_replace("{TIEMPO}", formatearFechaCompleta($tot->fecha), $listado_interacciones);
            $listado_interacciones = str_replace("{URL_PERSONA}", VerificaFotoPersonal($tot->rut), $listado_interacciones);
        }
    } else {
        $total_interacciones = "No existen interacciones";
    }
    //$PRINCIPAL = str_replace("{INTERACCIONES}",$listado_interacciones,$PRINCIPAL);
    return (utf8_encode($listado_interacciones));
}
function MPColocaBloqueComentario($id_mp, $id_empresa, $rut)
{
    //echo "$id_mp, $id_empresa, $rut";
    $html          = file_get_contents("views/mejorespracticas/mp_interaccion_comentario.html");
    $html          = str_replace("{FOTO_AUTOR}", VerificaFotoPersonal($rut), $html);
    $datos_usuario = UsuarioEnBasePersonas($rut);
    //print_r($datos_usuario);
    //echo "nombre ".$datos_usuario[0]->nombre_completo;
    $html          = str_replace("{NOMBRE_AUTOR}", $datos_usuario[0]->nombre_completo, $html);
    $html          = str_replace("{ID_MP_ENCODEADO}", Encodear3($id_mp), $html);
    return ($html);
}
function SubirArchivosGenericos($FILES, $extension_doc, $prefijo, $ruta, $numero, $nombre_file)
{
    //echo "<br>SubirArchivosGenericos $extension_doc, $prefijo, $ruta, $numero, $nombre_file<br>";
    //echo "$extension_archivo, $prefijo, $ruta";exit;
    //$ruta_con_archivo=$ruta."/".$prefijo."_BK.".$extension_archivo;
    $ruta_con_archivo = $ruta . "/" . $prefijo . "." . $extension_doc;
    copy($FILES[$nombre_file]['tmp_name'], $ruta_con_archivo);
    $nombre_imagen_video = $prefijo . "." . $extension_doc;
    //RedimensionarImagenSlider($ruta_con_archivo, $nombre_imagen_slider);
    //Devuelvol un arreglo, con datos del archivo subido
    $arreglo[0]          = $ruta_con_archivo; //Ruta Completa
    
    if($extension_doc<>""){
    $arreglo[1]          = $prefijo . "." . $extension_doc; //Nombre del Archivo	
    } else {
		$arreglo[1]          = "";
    }
    
    $arreglo[2]          = $ruta . "/" . $prefijo; //Ruta del Objeto sin el index
    return ($arreglo);
}
function SubirImagenfondo($FILES, $extension_doc, $prefijo, $ruta, $numero)
{
    //echo "$extension_archivo, $prefijo, $ruta";exit;
    //$ruta_con_archivo=$ruta."/".$prefijo."_BK.".$extension_archivo;
    $ruta_con_archivo = $ruta . "/" . $prefijo . "." . $extension_doc;
    copy($FILES['imagen_fondo']['tmp_name'], $ruta_con_archivo);
    $nombre_imagen_video = $prefijo . "." . $extension_doc;
    //RedimensionarImagenSlider($ruta_con_archivo, $nombre_imagen_slider);
    //Devuelvol un arreglo, con datos del archivo subido
    $arreglo[0]          = $ruta_con_archivo; //Ruta Completa
    $arreglo[1]          = $prefijo . "." . $extension_doc; //Nombre del Archivo
    $arreglo[2]          = $ruta . "/" . $prefijo; //Ruta del Objeto sin el index
    return ($arreglo);
}
function SubirArchivos($FILES, $extension_doc, $prefijo, $ruta, $numero)
{
    //echo "$extension_archivo, $prefijo, $ruta";exit;
    //$ruta_con_archivo=$ruta."/".$prefijo."_BK.".$extension_archivo;
    $ruta_con_archivo = $ruta . "/" . $prefijo . "." . $extension_doc;
    copy($FILES['archivo'.$numero]['tmp_name'], $ruta_con_archivo);
    $nombre_imagen_video = $prefijo . "." . $extension_doc;
    //RedimensionarImagenSlider($ruta_con_archivo, $nombre_imagen_slider);
    //Devuelvol un arreglo, con datos del archivo subido
    $arreglo[0]          = $ruta_con_archivo; //Ruta Completa
    $arreglo[1]          = $prefijo . "." . $extension_doc; //Nombre del Archivo
    $arreglo[2]          = $ruta . "/" . $prefijo; //Ruta del Objeto sin el index
    return ($arreglo);
}
function SubirArchivos2($FILES, $extension_doc, $prefijo, $ruta, $numero)
{
    //echo "$extension_archivo, $prefijo, $ruta";exit;
    //$ruta_con_archivo=$ruta."/".$prefijo."_BK.".$extension_archivo;
    $ruta_con_archivo = $ruta . "/" . $prefijo . "." . $extension_doc;
    copy($FILES['archivo2']['tmp_name'], $ruta_con_archivo);
    $nombre_imagen_video = $prefijo . "." . $extension_doc;
    //RedimensionarImagenSlider($ruta_con_archivo, $nombre_imagen_slider);
    //Devuelvol un arreglo, con datos del archivo subido
    $arreglo[0]          = $ruta_con_archivo; //Ruta Completa
    $arreglo[1]          = $prefijo . "." . $extension_doc; //Nombre del Archivo
    $arreglo[2]          = $ruta . "/" . $prefijo; //Ruta del Objeto sin el index
    return ($arreglo);
}
function ColocaPreguntaConcurso($PRINCIPAL, $id_empresa, $rut)
{
    $PRINCIPAL             = str_replace("{RUT}", Encodear3($rut), $PRINCIPAL);
    $datos_pregunta_activa = TraePreguntaActivaConcurso($id_empresa);
    $PRINCIPAL             = str_replace("{PREGUNTA_ACTIVA}", utf8_encode($datos_pregunta_activa[0]->pregunta), $PRINCIPAL);
    $PRINCIPAL             = str_replace("{ID_PREGUNTA}", Encodear3($datos_pregunta_activa[0]->id), $PRINCIPAL);
    return ($PRINCIPAL);
}
function limit_text($text, $limit)
{
    if (str_word_count($text, 0) > $limit) {
        $words = str_word_count($text, 2);
        $pos   = array_keys($words);
        $text  = substr($text, 0, $pos[$limit]) . '...';
    }
    return strip_tags($text);
}
function EnviaCorreoBuenasPracticas($rut_destinatario, $nombre, $id_estado, $id_empresa, $tipo_correo, $tiporecipiente, $id_mp)
{
    //echo "$rut_destinatario,$nombre, $id_estado, $id_empresa, $tipo_correo, $tiporecipiente, $id_mp";
    $datos_empresa   = DatosEmpresa($id_empresa);
    $datos_practica  = MPObtengoMejorPractica($id_empresa, $id_mp);
    $nombre_practica = $datos_practica[0]->nombre;
    $nombre_autor    = $datos_practica[0]->nombre_autor;
    $rut_autor       = $datos_practica[0]->rut;
    $datos_autor     = UsuarioEnBasePersonas($rut_autor);
    $datos_admin     = UsuarioAdminEmpresa($id_empresa);
    //print_r($datos_autor);
    $nombre_autor    = $datos_autor[0]->nombre_completo;
    $email_autor     = $datos_autor[0]->email;
    $datos_Estado    = MP_ObtengoDatosEstadoPorEmpresa($id_empresa, $id_estado);
    $template_correo = file_get_contents("views/mejorespracticas/correos/" . $datos_Estado[0]->{$tipo_correo});
    $template_correo = str_replace("{NOMBRE}", utf8_encode($nombre_autor), $template_correo);
    $template_correo = str_replace("{PRACTICA}", utf8_encode($nombre_practica), $template_correo);
    $asunto          = $datos_Estado[0]->{$tiporecipiente};
    //print_r($datos_Estado);
    //echo "<br>asunto $asunto";
    if ($tipo_correo == "template_email_autor") {
        $nombre_envio = $datos_autor[0]->nombre_completo;
        $email_envio  = $datos_autor[0]->email;
        //echo "<br><br>usuario $rut_destinatario,$nombre, $id_estado, $id_empresa, $tipo_correo, $tiporecipiente,  $id_mp,
        //nombrepractica $nombre_practica, rut_autor $rut_autor,  nombre_autor $nombre_autor, email_autor $email_autor    ";
    }
    if ($tipo_correo == "template_email_admin") {
        //print_r($datos_admin);
        foreach ($datos_admin as $datos_admin_usuario) {
            $email_admin = $datos_admin_usuario->email;
        }
        $nombre_envio = "Administrador";
        $email_envio  = $email_admin;
        //$email_envio="rod.arancibia@gmail.cl";
        //echo "<br><br>admin $rut_destinatario,$nombre, $id_estado, $id_empresa, $tipo_correo, $tiporecipiente,  $id_mp,
        //nombrepractica $nombre_practica, rut_autor $rut_autor,  nombre_autor $nombre_autor, email_autor $email_autor, email_admin $email_admin  <br>
        //$nombre_envio<br>
        // $email_admin ";   exit();
    }
    if ($id_estado > 1) {
        $mail = new PHPMailer;
        //Tell PHPMailer to use SMTP
        $mail->isSMTP(); //Enable SMTP debugging
        // 0 = off (for production use)
        // 1 = client messages
        // 2 = client and server messages
        $mail->SMTPDebug   = 1;
        //Ask for HTML-friendly debug output
        $mail->Debugoutput = 'error_log';
        //Set the hostname of the mail server
        $mail->Host        = $datos_empresa[0]->server;
        //Set the SMTP port number - likely to be 25, 465 or 587
        $mail->Port        = 25;
        //Whether to use SMTP authentication
        $mail->SMTPAuth    = true;
        //Username to use for SMTP authentication
        $mail->Username    = $datos_empresa[0]->envio_correos;
        //Password to use for SMTP authentication
        $mail->Password    = $datos_empresa[0]->envio_correos_pass;
        //Set who the message is to be sent from
        $mail->setFrom($datos_empresa[0]->envio_correos, $datos_empresa[0]->envio_correos);
        //Set an alternative reply-to address
        //$mail->addReplyTo('replyto@example.com', 'First Last');
        //Set who the message is to be sent to
        //$mail->addAddress($datos_destinatario[0]->email, $datos_destinatario[0]->nombre_completo);
        //$mail->addAddress("daniel@gop.cl", $datos_destinatario[0]->nombre_completo);
        $mail->addAddress($email_envio, $nombre_envio);
        //$mail->addAddress("francisco.lopez@tnt.com", $datos_destinatario[0]->nombre_completo);
        //$mail->addAddress("rod@gop.cl", $datos_destinatario[0]->nombre_completo);
        //$mail->AddBCC("backup@sgd.cl","BCC: ".$datos_destinatario[0]->nombre_completo);
        //Set the subject line
        $mail->Subject = $asunto;
        //Read an HTML message body from an external file, convert referenced images to embedded,
        //convert HTML into a basic plain-text alternative body
        $mail->msgHTML($template_correo, dirname(__FILE__));
        //Replace the plain text body with one created manually
        $mail->AltBody = 'Si no puedes visualizar este correo ....';
        //Attach an image file
        //$mail->addAttachment('images/phpmailer_mini.png');
        //send the message, check for errors
        if (!$mail->send()) {
            echo "Mailer Error: " . $mail->ErrorInfo;
        } else {
            echo "Message sent!";
        }
    }
    //exit;
}
function ColocaListadoColaboradoresPorMP($PRINCIPAL, $id_empresa, $rut, $id_mp)
{
    $usuarios = MP_UsuariosPorMPYUsuario($id_mp, $id_empresa);
    if ($usuarios) {
        $total_colaboradores = "";
        foreach ($usuarios as $usu) {
            $total_colaboradores .= file_get_contents("views/mejorespracticas/mp_row_colaboradores.html");
            $total_colaboradores = str_replace("{NOMBRE}", $usu->nombre_completo, $total_colaboradores);
            $total_colaboradores = str_replace("{CARGO}", $usu->cargo, $total_colaboradores);
            $total_colaboradores = str_replace("{ROL}", $usu->rol, $total_colaboradores);
        }
        $PRINCIPAL = str_replace("{LISTADO_USUARIOS}", utf8_encode($total_colaboradores), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{LISTADO_USUARIOS}", "", $PRINCIPAL);
    }
    return ($PRINCIPAL);
}
function allPersonasPorNombrePorEmpresaGenerico($buscar, $id_empresa, $rut)
{
    $datos_usuario = UsuarioEnBasePersonas($rut);
    $dataPersonas  = allPersonasPorEmpresa($buscar, $id_empresa);
    if ($dataPersonas) {
        foreach ($dataPersonas as $dataPersonas_aux) {
            echo utf8_encode($dataPersonas_aux->nombre) . " " . utf8_encode($dataPersonas_aux->apaterno) . " " . utf8_encode($dataPersonas_aux->amaterno) . " " . "|" . $dataPersonas_aux->rut . "\n";
            //echo utf8_encode($dataPersonas_aux->nombre)."\n";
        }
    } else {
        $data = 'No Existe este nombre';
    }
    return $data;
}
function ColocaTitulosPorPaso($PRINCIPAL, $id_empresa)
{
    $pasos = MP_TraigoPasosPorEmpresa($id_empresa);
    $i     = 1;
    foreach ($pasos as $pas) {
        $PRINCIPAL = str_replace("{NUMPASO$i}", $i, $PRINCIPAL);
        $PRINCIPAL = str_replace("{NOMBREPASO$i}", utf8_encode($pas->paso), $PRINCIPAL);
        $PRINCIPAL = str_replace("{DESCRIPCION$i}", utf8_encode($pas->descripcion), $PRINCIPAL);
        $PRINCIPAL = str_replace("{TEXTO$i}", utf8_encode($pas->texto), $PRINCIPAL);
        $i++;
    }
    return ($PRINCIPAL);
}
function FormularioBuenasPracticas($PRINCIPAL, $id_empresa, $rut, $id_mp)
{
    //Coloco combobox, de categorias.
    //$categorias=TraeCategoriasMejoresPracticas($id_empresa);
    $categorias = TraeCategoriasMejoresPracticasParaCombo($id_empresa);
    $datos_mp   = DatosMPDadoId($id_mp);
    $ambitos    = TraeAmbitosMejoresPracticas($id_empresa);
    if ($id_mp) {
        if ($datos_mp[0]->muestra == 1) {
            $PRINCIPAL = str_replace("{STYLE_BLOQUE_OTRA_OPOR}", '', $PRINCIPAL);
        } else {
            $PRINCIPAL = str_replace("{STYLE_BLOQUE_OTRA_OPOR}", 'style="display:none;"', $PRINCIPAL);
        }
    } else {
        $PRINCIPAL = str_replace("{STYLE_BLOQUE_OTRA_OPOR}", 'style="display:none;"', $PRINCIPAL);
    }
    $categoria_options     = "";
    $listado_colaboradores = TotalUsuariosPorempresa($id_empresa);
    foreach ($listado_colaboradores as $list) {
        $html_colaboradores .= "<option value='" . $list->rut . "'>" . $list->nombre_completo . "</option>";
    }
    foreach ($categorias as $cat) {
        if ($datos_mp[0]->id_categoria == $cat->id_categoria) {
            $categoria_options .= "<option selected='selected' value='" . $cat->id_categoria . "'>" . $cat->categoria . "</option>";
        } else if ($datos_mp[0]->muestra == "1" and $cat->id_categoria == "0") {
            $categoria_options .= "<option selected='selected' value='" . $cat->id_categoria . "'>" . $cat->categoria . "</option>";
        } else {
            $categoria_options .= "<option value='" . $cat->id_categoria . "'>" . $cat->categoria . "</option>";
        }
    }
    $ambito_options = "";
    foreach ($ambitos as $amb) {
        if ($datos_mp[0]->id_ambito == $amb->id_ambito) {
            $ambito_options .= "<option selected='selected' value='" . $amb->id_ambito . "'>" . $amb->ambito . "</option>";
        } else {
            $ambito_options .= "<option value='" . $amb->id_ambito . "'>" . $amb->ambito . "</option>";
        }
    }
    if ($id_mp) {
        $PRINCIPAL = str_replace("{ID_MP}", $id_mp, $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_MP_ENCODEADO}", Encodear3($id_mp), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{ID_MP}", "", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_MP_ENCODEADO}", "", $PRINCIPAL);
    }
    $PRINCIPAL = str_replace("{OPTIONS_CATEGORIAS_MEJORES_PRACTICAS}", utf8_encode($categoria_options), $PRINCIPAL);
    $PRINCIPAL = str_replace("{OPTIONS_AMBITOS_MEJORES_PRACTICAS}", utf8_encode($ambito_options), $PRINCIPAL);
    $PRINCIPAL = str_replace("{OPTION_LISTADO_COLABORADORES}", utf8_encode($html_colaboradores), $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALUE_NOMBRE}", utf8_encode($datos_mp[0]->nombre), $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALUE_OBJETIVO}", utf8_encode($datos_mp[0]->objetivo), $PRINCIPAL);
    $PRINCAL   = str_replace("{VALUE_APLICACION}", utf8_encode($datos_mp[0]->aplicacion), $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALUE_METRICA}", utf8_encode($datos_mp[0]->metrica), $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALUE_IMPACTO}", utf8_encode($datos_mp[0]->impacto), $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALUE_PROBLEMA}", utf8_encode($datos_mp[0]->problema), $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALUE_KPI_AFECTADO}", utf8_encode($datos_mp[0]->kpi_afectado), $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALUE_CUANTIFICACION}", utf8_encode($datos_mp[0]->cuantificacion), $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALUE_COACH}", utf8_encode($datos_mp[0]->coach), $PRINCIPAL);
    $PRINCIPAL = str_replace("{CONTENIDO_INGRESADO}", utf8_encode($datos_mp[0]->contenido), $PRINCIPAL);
    $PRINCIPAL = str_replace("{VALUE_TAGS}", utf8_encode($datos_mp[0]->tag), $PRINCIPAL);
    if ($datos_mp[0]->muestra == 1) {
        $PRINCIPAL = str_replace("{NOMBRE_CATEGORIA}", utf8_encode($datos_mp[0]->nombre_categoria), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{NOMBRE_CATEGORIA}", "", $PRINCIPAL);
    }
    //coloca listado de Usuarios por ID_MP
    $PRINCIPAL = ColocaListadoColaboradoresPorMP($PRINCIPAL, $id_empresa, $rut, $id_mp);
    return ($PRINCIPAL);
}
function ColocaDatosHomeSGD($PRINCIPAL, $id_empresa)
{
    $datos_home = ObtenerContenidosInicialSGDPorEmpresa($id_empresa);
    $PRINCIPAL  = str_replace("{TITULO}", utf8_encode($datos_home[0]->titulo), $PRINCIPAL);
    $PRINCIPAL  = str_replace("{TEXTO_INTRODUCCION}", utf8_encode($datos_home[0]->introduccion), $PRINCIPAL);
    $PRINCIPAL  = str_replace("{TEXTO_TRANSVERSALES}", utf8_encode($datos_home[0]->competencias_transversales), $PRINCIPAL);
    $PRINCIPAL  = str_replace("{TEXTO_LIDERAZGO}", utf8_encode($datos_home[0]->competencias_liderazgo), $PRINCIPAL);
    $PRINCIPAL  = str_replace("{IMAGEN_LOGIN}", utf8_encode($datos_home[0]->imagen_home), $PRINCIPAL);
    $importante = ObtenerContenidosBloqueImportante($id_empresa);
    foreach ($importante as $imp) {
        $row_importante_home .= '<tr>
                                <td  valign="top"><span class="color_cafeemiliana"><i class="fa fa-angle-right padRight10px"></i></span></td>
                                <td><span class="color_cafeemiliana">' . $imp->texto . '</td>
                            </tr>
                            <tr><td colspan="2"><br></td></tr>';
    }
    $PRINCIPAL = str_replace("{ROW_IMPORTANTES}", utf8_encode($row_importante_home), $PRINCIPAL);
    $tips      = ObtenerContenidosBloqueTips($id_empresa);
    foreach ($tips as $imp) {
        $row_tips_home .= '<tr>
                                <td  valign="top"><span class="color_cafeemiliana"><i class="fa fa-angle-right padRight10px"></i></span></td>
                                <td><span class="color_cafeemiliana">' . $imp->texto . '</td>
                            </tr>
                            <tr><td colspan="2"><br></td></tr>
                            ';
    }
    $PRINCIPAL = str_replace("{ROW_TIPS}", utf8_encode($row_tips_home), $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocaPaginacionDeNoticias($pagina, $id_empresa, $noticas_por_pagina, $id_categoria)
{
    //$imagenes=FotosPorObjeto($id_objeto, $_SESSION["id_empresa"], "no");
    $noticias = TraeNoticiasTodas($id_empresa, $id_categoria);
    if (!$pagina) {
        $pagina = 1;
    }
    $total_noticias = count($noticias);
    $paginacion     = file_get_contents("views/noticias/entorno_paginacion.html");
    $total_paginas  = ceil($total_noticias / $noticas_por_pagina);
    //echo "$imagenes_por_pagina, $total_imagenes, $total_paginas";
    for ($i = 1; $i <= $total_paginas; $i++) {
        $row .= file_get_contents("views/noticias/row_paginacion.html");
        $row = str_replace("{NUMERO_PAGINA}", $i, $row);
        $row = str_replace("{PAGINA}", $i, $row);
        if ($pagina == $i) {
            $row = str_replace("{CLASE_ACTIVO}", "class='active'", $row);
        } else {
            $row = str_replace("{CLASE_ACTIVO}", "", $row);
        }
    }
    $paginacion = str_replace("{ROW_PAGINACION}", $row, $paginacion);
    return ($paginacion);
}
function ObtenerNotaDeEvaluacionSuma($id_objeto, $rut)
{
    $respuestas      = RespuestasDadoRutObjeto($rut, $id_objeto);
    $suma_respuestas = 0;
    foreach ($respuestas as $res) {
        $suma_respuestas = $suma_respuestas + $res->puntaje;
    }
    return ($suma_respuestas);
}
function ColocarFormularioPorImagenSubida($PRINCIPAL, $rut, $id_empresa, $id_imagen)
{
    $datos_imagen = ObtenerImagenDadoID($id_imagen);
    $PRINCIPAL    = str_replace("{URL_FOTO}", $datos_imagen[0]->archivo, $PRINCIPAL);
    $PRINCIPAL    = str_replace("{ID_IMAGEN_ENCODEADA}", Encodear3($id_imagen), $PRINCIPAL);
    $PRINCIPAL    = str_replace("{COMENTARIOS}", utf8_encode($datos_imagen[0]->comentarios), $PRINCIPAL);
    if ($datos_imagen[0]->modalidad == 1) {
        $PRINCIPAL = str_replace("{DESCCATEGORIA}", "Mi Mamá", $PRINCIPAL);
        $PRINCIPAL = str_replace("{SEL1}", "selected='selected'", $PRINCIPAL);
    } else if ($datos_imagen[0]->modalidad == 2) {
        $PRINCIPAL = str_replace("{DESCCATEGORIA}", "La Mamá de mis hijos", $PRINCIPAL);
        $PRINCIPAL = str_replace("{SEL2}", "selected='selected'", $PRINCIPAL);
    } else if ($datos_imagen[0]->modalidad == 3) {
        $PRINCIPAL = str_replace("{DESCCATEGORIA}", "Yo como Mamá", $PRINCIPAL);
        $PRINCIPAL = str_replace("{SEL3}", "selected='selected'", $PRINCIPAL);
    }
    return ($PRINCIPAL);
}
function ColocaObjetivoPorGerencia($PRINCIPAL, $id_empresa, $rut)
{
    $datos     = DNCObtengoObjetivoPorEmpresa($rut, $id_empresa);
    $PRINCIPAL = str_replace("{OBJETIVO_POR_GERENCIA}", utf8_encode($datos[0]->objetivo), $PRINCIPAL);
    return ($PRINCIPAL);
}
function GAMIFICACIONResultadosPorCursoMalla($rut, $id_curso, $id_malla, $id_empresa)
{
    if ($id_curso && $id_malla) {
        $nota_por_curso = GAMIFICACION_NotaPorCursoUsuarioEmpresa($rut, $id_curso, $id_empresa, $id_malla);
        $nota           = round($nota_por_curso[0]->nota_por_curso);
    } else if ($id_malla && !$id_curso) {
        $nota_por_malla = GAMIFICACION_NotaPorMallaUsuarioEmpresa($rut, $id_malla, $id_empresa);
        $nota           = round($nota_por_malla[0]->nota_por_malla);
    }
    return ($nota);
}
function GAMIFICACIONResultadosPorSoloCurso($rut, $id_curso, $id_empresa)
{
    $nota_por_curso = GAMIFICACION_NotaPorSoloCursoUsuarioEmpresa($rut, $id_curso, $id_empresa);
    $nota           = $nota_por_curso[0]->nota_por_curso;
    return ($nota);
}
function GAMIFICACION_ActualizaNivelVersion2($id_malla, $id_empresa, $rut)
{
    //Primero traigo el nivel actual.
    $datos_puntos_consolidado = TienePuntosConsolidadosPorMalla($rut, $id_empresa, $id_malla);
    $id_nivel                 = $datos_puntos_consolidado[0]->nivel;
    //dado el nivel, traigo el curso
    $datos_curso              = GAMIFICACION_ObtengoCursoDadoNivel($id_nivel, $id_empresa);
    $id_curso                 = $datos_curso[0]->idcurso;
    $datos_objeto_por_curso   = GAMIFICACIONTraeDatosObjetosPorCurso($rut, $id_curso);
    if ($datos_objeto_por_curso[0]->total_objetos == $datos_objeto_por_curso[0]->total_objetos_finalizados) {
        //Si la cantidad de objetos del curso, mas la cantidad de objetos finalizados,
        //significa que el nivel se paso, por ende se actualiza
        $orden_actual        = $datos_curso[0]->idorden;
        $orden_proximo_nivel = $orden_actual + 1;
        //ahora obtengo nivel, dado la malla y el orden
        $datos_nuevo_nivel   = GAMIFICACION_TraigoNivelDadoOrdenYMalla($id_malla, $orden_proximo_nivel);
        GAMIFICACION_ActualizaSoloNivel($datos_nuevo_nivel[0]->idnivel, $id_empresa, $rut, $id_malla);
    }
}
function ColocaPaginacionDeImagenes($pagina, $id_objeto, $rut, $id_malla, $cantidad_imagenes_galeria)
{
    //$imagenes=FotosPorObjeto($id_objeto, $_SESSION["id_empresa"], "no");
    //echo "$pagina, $id_objeto, $rut, idmalla $id_malla";
    $imagenes = FotosPorObjeto($id_objeto, $_SESSION["id_empresa"], "no", $id_malla);
    if (!$pagina) {
        $pagina = 1;
    }
    $imagenes_por_pagina = $cantidad_imagenes_galeria;
    $total_imagenes      = count($imagenes);
    $paginacion          = file_get_contents("views/cursos/objetos/subirFotos/entorno_paginacion.html");
    $total_paginas       = ceil($total_imagenes / $imagenes_por_pagina);
    //echo "$imagenes_por_pagina, $total_imagenes, $total_paginas";
    for ($i = 1; $i <= $total_paginas; $i++) {
        $row .= file_get_contents("views/cursos/objetos/subirFotos/row_paginacion.html");
        $row = str_replace("{NUMERO_PAGINA}", $i, $row);
        $row = str_replace("{PAGINA}", $i, $row);
        if ($pagina == $i) {
            $row = str_replace("{CLASE_ACTIVO}", "class='active'", $row);
        } else {
            $row = str_replace("{CLASE_ACTIVO}", "", $row);
        }
    }
    $paginacion = str_replace("{ROW_PAGINACION}", $row, $paginacion);
    return ($paginacion);
}
function RedimensionarImagenParaGaleria($rutaImagenOriginal, $nombre_imagen, $ext, $nombre_nuevo_archivo, $id_empresa)
{
    //echo "$rutaImagenOriginal, $nombre_imagen, $ext, $nombre_nuevo_archivo, $id_empresa";exit;
    //Ruta de la imagen original
    //$rutaImagenOriginal="./imagen/i2.jpg";
    //Creamos una variable imagen a partir de la imagen original
    if ($ext == "gif") {
        $img_original = imagecreatefromgif($rutaImagenOriginal);
    } else if ($ext == "png") {
        $img_original = imagecreatefrompng($rutaImagenOriginal);
    } else {
        $img_original = imagecreatefromjpeg($rutaImagenOriginal);
    }
    //echo $rutaImagenOriginal;exit;
    //Se define el maximo ancho o alto que tendra la imagen final
    //$alto_orig=imagesy($img_original);
    //$ancho_orig=imagesx($img_original);
    $max_ancho = 1000;
    $max_alto  = 1000;
    //Ancho y alto de la imagen original
    list($ancho, $alto) = getimagesize($rutaImagenOriginal);
    //Se calcula ancho y alto de la imagen final
    $x_ratio = $max_ancho / $ancho;
    $y_ratio = $max_alto / $alto;
    //Si el ancho y el alto de la imagen no superan los maximos,
    //ancho final y alto final son los que tiene actualmente
    if (($ancho <= $max_ancho) && ($alto <= $max_alto)) { //Si ancho
        $ancho_final = $ancho;
        $alto_final  = $alto;
    }
    /*
     * si proporcion horizontal*alto mayor que el alto maximo,
     * alto final es alto por la proporcion horizontal
     * es decir, le quitamos al alto, la misma proporcion que
     * le quitamos al alto
     *
     */
    elseif (($x_ratio * $alto) < $max_alto) {
        $alto_final  = ceil($x_ratio * $alto);
        $ancho_final = $max_ancho;
    }
    /*
     * Igual que antes pero a la inversa
     */
    else {
        $ancho_final = ceil($y_ratio * $ancho);
        $alto_final  = $max_alto;
    }
    if ($ancho > $alto) {
        $alto_final  = $max_alto;
        $ancho_final = ceil($y_ratio * $ancho);
    } else if ($alto > $ancho) {
        $alto_final  = ceil($x_ratio * $alto);
        $ancho_final = $max_ancho;
    }
    //Creamos una imagen en blanco de tamaÃ±o $ancho_final  por $alto_final .
    $tmp = imagecreatetruecolor($ancho_final, $alto_final);
    //Copiamos $img_original sobre la imagen que acabamos de crear en blanco ($tmp)
    imagecopyresampled($tmp, $img_original, 0, 0, 0, 0, $ancho_final, $alto_final, $ancho, $alto);
    //Se destruye variable $img_original para liberar memoria
    imagedestroy($img_original);
    //Definimos la calidad de la imagen final
    $calidad = 95;
    //Se crea la imagen final en el directorio indicado
    //imagejpeg($tmp,"../front/img/noticias/thum/".$nombre_imagen,$calidad);
    if ($ext == "gif") {
        imagegif($tmp, "../../front/galeria/" . $nombre_nuevo_archivo);
    } else if ($ext == "png") {
        imagepng($tmp, "../../front/galeria/" . $nombre_nuevo_archivo);
    } else {
        imagejpeg($tmp, "../../front/galeria/" . $nombre_nuevo_archivo);
    }
    /* SI QUEREMOS MOSTRAR LA IMAGEN EN EL NAVEGADOR
     *
     * descomentamos las lineas 64 ( Header("Content-type: image/jpeg"); ) y 65 ( imagejpeg($tmp); )
     * y comentamos la linea 57 ( imagejpeg($tmp,"./imagen/retoque.jpg",$calidad); )
     */
    //Header("Content-type: image/jpeg");
    //imagejpeg($tmp);
}
function OptionsCompetenciasDadoPerfil($perfil_evaluacion, $seleccionado)
{
    $competencias = ObtengoCompetenciasDadoPerfilConNombreCompetencia($perfil_evaluacion);
    foreach ($competencias as $comp) {
        if ($seleccionado == $comp->id_competencia) {
            $options .= "<option selected='selected' value='" . $comp->id_competencia . "'>" . $comp->nombre_competencia . "</option>";
        } else {
            $options .= "<option value='" . $comp->id_competencia . "'>" . $comp->nombre_competencia . "</option>";
        }
    }
    return (utf8_encode($options));
}
function getRutDV($rut)
{
    $rut = strrev($rut);
    $aux = 1;
    for ($i = 0; $i < strlen($rut); $i++) {
        $aux++;
        $s += intval($rut[$i]) * $aux;
        if ($aux == 7) {
            $aux = 1;
        }
    }
    $digit = 11 - $s % 11;
    if ($digit == 11) {
        $d = 0;
    } elseif ($digit == 10) {
        $d = "K";
    } else {
        $d = $digit;
    }
    return $d;
}
function ObtieneNotaObjetivosSinTablaRespuesta($evaluado, $evaluador, $id_proceso, $id_dimension)
{
    //$objetivos=ObjetivosEspecificosConRespuestaEvaluadoEvaluadorProceso($evaluado, $evaluador, $id_proceso);
    $objetivos  = NotasObjetivosPorDimension($evaluado, $evaluador, $id_proceso);
    $pond_total = 100;
    $i          = 0;
    foreach ($objetivos as $ob) {
        $acumulador = $acumulador + (($ob->nota_promediada * $ob->ponderacion) / $pond_total);
        $i++;
    }
    //echo "acumulador $acumulador <br>";
    //exit;
    return ($acumulador);
}
function ColocaBloqueMasMeGustaFotos($PRINCIPAL, $id_objeto, $id_malla)
{
    //obtengo comentarios dado id_objeto
    //$total_galerias=ObtenerFotosMasMegusta($id_objeto, $_SESSION["id_empresa"]);
    $total_galerias = ObtenerFotosMasMegustaPorMalla($id_objeto, $_SESSION["id_empresa"], $id_malla);
    if ($total_galerias) {
        foreach ($total_galerias as $arch) {
            $row_html .= file_get_contents("views/cursos/objetos/subirFotos/62_lista_archivos_bloque.html");
            $row_html = str_replace("{URL_IMAGEN_ARCHIVO}", $arch->archivo, $row_html);
            $row_html = str_replace("{URL_IMAGEN_PERSONA}", VerificaFotoPersonal($arch->rut_autor), $row_html);
            $row_html = str_replace("{DESCRIPCION}", ($arch->nombre_completo), $row_html);
            $row_html = str_replace("{MEGUSTA}", ColocaMeGusta($arch->id, "id_imagen_galeria", $_SESSION["id_empresa"], $arch->rut_autor, "autor", $id_objeto), $row_html);
        }
        $PRINCIPAL = str_replace("{BLOQUE_FOTOS_MAS_MEGUSTA}", utf8_encode($row_html), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BLOQUE_FOTOS_MAS_MEGUSTA}", "", $PRINCIPAL);
    }
    return ($PRINCIPAL);
}
function RedimensionarImagenSubirObjetos($rutaImagenOriginal, $nombre_imagen, $ext, $nombre_nuevo_archivo, $id_empresa)
{
    //Ruta de la imagen original
    //$rutaImagenOriginal="./imagen/i2.jpg";
    //Creamos una variable imagen a partir de la imagen original
    if ($ext == "gif") {
        $img_original = imagecreatefromgif($rutaImagenOriginal);
    } else if ($ext == "png") {
        $img_original = imagecreatefrompng($rutaImagenOriginal);
    } else {
        $img_original = imagecreatefromjpeg($rutaImagenOriginal);
    }
    //Se define el maximo ancho o alto que tendra la imagen final
    //$alto_orig=imagesy($img_original);
    //$ancho_orig=imagesx($img_original);
    $max_ancho = 800;
    $max_alto  = 800;
    //Ancho y alto de la imagen original
    list($ancho, $alto) = getimagesize($rutaImagenOriginal);
    //Se calcula ancho y alto de la imagen final
    $x_ratio = $max_ancho / $ancho;
    $y_ratio = $max_alto / $alto;
    //Si el ancho y el alto de la imagen no superan los maximos,
    //ancho final y alto final son los que tiene actualmente
    //if( ($ancho >= $max_ancho) && ($alto >= $max_alto) ){//Si ancho
    if ($ancho >= $alto and $ancho > 50) {
        //Horizontal
        if ($ancho >= $max_alto) {
            $ancho_final = $max_ancho;
            //$alto_final = $alto;
            $alto_final  = round(($x_ratio * $alto), 0);
            //echo "ancho ".$ancho_final." ".$alto_final;exit;
        }
    } else if ($ancho < $alto and $ancho > 50) {
        //Vertical
        if ($alto >= $max_ancho) {
            //$ancho_final = $ancho;
            $alto_final  = $max_alto;
            $ancho_final = round(($y_ratio * $ancho), 0);
        }
    } else {
        echo "<script>
                    window.history.back();
                    </script>";
        exit;
    }
    /*if($ancho >= $max_alto){
    $ancho_final = $max_ancho;
    //$alto_final = $alto;
    $alto_final = ceil($x_ratio * $alto);
    //echo "ancho ".$ancho_final." ".$alto_final;exit;
    } else if($alto >= $max_ancho){
    //$ancho_final = $ancho;
    $alto_final = $max_alto;
    $ancho_final = ceil($y_ratio * $ancho);
    }else{
    $alto_final = 800;
    $ancho_final = 800;
    }
    /*if( ($ancho >= $max_alto) && ($alto >= $max_ancho) ){
    $ancho_final = $ancho;
    $alto_final = $alto;
    }
    * */
    /*
     * si proporcion horizontal*alto mayor que el alto maximo,
     * alto final es alto por la proporcion horizontal
     * es decir, le quitamos al alto, la misma proporcion que
     * le quitamos al alto
     *
     */
    /*elseif (($x_ratio * $alto) < $max_alto){
    $alto_final = ceil($x_ratio * $alto);
    $ancho_final = $max_ancho;
    }
    * */
    /*
     * Igual que antes pero a la inversa
     */
    /*else{
    $ancho_final = ceil($y_ratio * $ancho);
    $alto_final = $max_alto;
    }
    *
    * */
    /*if($ancho>$alto){
    $alto_final=$max_alto;
    $ancho_final=ceil($y_ratio * $ancho);
    }else if($alto>$ancho){
    $alto_final=ceil($x_ratio * $alto);
    $ancho_final=$max_ancho;
    }
    *
    * */
    //Creamos una imagen en blanco de tamaÃ±o $ancho_final  por $alto_final .
    $tmp = imagecreatetruecolor($ancho_final, $alto_final);
    //Copiamos $img_original sobre la imagen que acabamos de crear en blanco ($tmp)
    imagecopyresampled($tmp, $img_original, 0, 0, 0, 0, $ancho_final, $alto_final, $ancho, $alto);
    //Se destruye variable $img_original para liberar memoria
    imagedestroy($img_original);
    //Definimos la calidad de la imagen final
    $calidad = 95;
    //Se crea la imagen final en el directorio indicado
    //imagejpeg($tmp,"../front/img/noticias/thum/".$nombre_imagen,$calidad);
    if ($ext == "gif") {
        imagegif($tmp, "img/objetos/" . $nombre_nuevo_archivo);
    } else if ($ext == "png") {
        imagepng($tmp, "img/objetos/" . $nombre_nuevo_archivo);
    } else {
        imagejpeg($tmp, "img/objetos/" . $nombre_nuevo_archivo);
    }
    /* SI QUEREMOS MOSTRAR LA IMAGEN EN EL NAVEGADOR
     *
     * descomentamos las lineas 64 ( Header("Content-type: image/jpeg"); ) y 65 ( imagejpeg($tmp); )
     * y comentamos la linea 57 ( imagejpeg($tmp,"./imagen/retoque.jpg",$calidad); )
     */
    //Header("Content-type: image/jpeg");
    //imagejpeg($tmp);
}
function ColocaBloqueDerechoCursosNiveles($PRINCIPAL, $rut, $id_empresa, $id_clasificacion, $id_malla)
{
    $PRINCIPAL = str_replace("{BLOQUE_CURSOS_NIVELES}", file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_bloque_niveles_curso.html"), $PRINCIPAL);
    if ($id_clasificacion && $id_malla) {
        $cursos = CAPACITACION_cursosPorClasificacionMalla($id_malla, $id_clasificacion);
        //exit;
    } else if ($id_malla) {
        $cursos = CAPACITACION_cursosPorClasificacionMalla($id_malla, null);
    }
    $total_avance                     = 0;
    $total_puntajes_maximos_por_curso = 0;
    foreach ($cursos as $cur) {
        $row_curso .= file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_bloque_niveles_curso.html");
        $avances                          = ColocaAvanceCursoPorPuntosDeObjetos($row_curso, $cur->id_curso, $rut, $id_empresa);
        $row_curso                        = $avances[0];
        $total_avance                     = $total_avance + $avances[1];
        $total_puntajes_maximos_por_curso = $total_puntajes_maximos_por_curso + $cur->puntos_maximo;
    }
    $promedio  = (100 * $total_avance) / $total_puntajes_maximos_por_curso;
    //echo $total_avance." - ".$total_puntajes_maximos_por_curso;
    $PRINCIPAL = str_replace("{AVANCE_MALLA_POR_OBJETOS}", FormatearPorcentajes($promedio), $PRINCIPAL);
    $PRINCIPAL = str_replace("{ROW_CURSOS_RESUMENES}", $row_curso, $PRINCIPAL);
    return ($PRINCIPAL);
}
//$directorio_galerias='../admin/img/galerias/';

function RedimensionarImagenPerfil($rutaImagenOriginal, $nombre_imagen, $ext, $nombre_nuevo_archivo, $id_empresa)
{
    //Ruta de la imagen original
    //$rutaImagenOriginal="./imagen/i2.jpg";
    //Creamos una variable imagen a partir de la imagen original
    if ($ext == "gif") {
        $img_original = imagecreatefromgif($rutaImagenOriginal);
    } else if ($ext == "png") {
        $img_original = imagecreatefrompng($rutaImagenOriginal);
    } else {
        $img_original = imagecreatefromjpeg($rutaImagenOriginal);
    }
    //Se define el maximo ancho o alto que tendra la imagen final
    //$alto_orig=imagesy($img_original);
    //$ancho_orig=imagesx($img_original);
    $max_ancho = 250;
    $max_alto  = 250;
    //Ancho y alto de la imagen original
    list($ancho, $alto) = getimagesize($rutaImagenOriginal);
    //Se calcula ancho y alto de la imagen final
    $x_ratio = $max_ancho / $ancho;
    $y_ratio = $max_alto / $alto;
    //Si el ancho y el alto de la imagen no superan los maximos,
    //ancho final y alto final son los que tiene actualmente
    if (($ancho <= $max_ancho) && ($alto <= $max_alto)) { //Si ancho
        $ancho_final = $ancho;
        $alto_final  = $alto;
    }
    /*
     * si proporcion horizontal*alto mayor que el alto maximo,
     * alto final es alto por la proporcion horizontal
     * es decir, le quitamos al alto, la misma proporcion que
     * le quitamos al alto
     *
     */
    elseif (($x_ratio * $alto) < $max_alto) {
        $alto_final  = ceil($x_ratio * $alto);
        $ancho_final = $max_ancho;
    }
    /*
     * Igual que antes pero a la inversa
     */
    else {
        $ancho_final = ceil($y_ratio * $ancho);
        $alto_final  = $max_alto;
    }
    if ($ancho > $alto) {
        $alto_final  = $max_alto;
        $ancho_final = ceil($y_ratio * $ancho);
    } else if ($alto > $ancho) {
        $alto_final  = ceil($x_ratio * $alto);
        $ancho_final = $max_ancho;
    }
    //Creamos una imagen en blanco de tamaÃ±o $ancho_final  por $alto_final .
    $tmp = imagecreatetruecolor($ancho_final, $alto_final);
    //Copiamos $img_original sobre la imagen que acabamos de crear en blanco ($tmp)
    imagecopyresampled($tmp, $img_original, 0, 0, 0, 0, $ancho_final, $alto_final, $ancho, $alto);
    //Se destruye variable $img_original para liberar memoria
    imagedestroy($img_original);
    //Definimos la calidad de la imagen final
    $calidad = 95;
    //Se crea la imagen final en el directorio indicado
    //imagejpeg($tmp,"../front/img/noticias/thum/".$nombre_imagen,$calidad);
    if ($ext == "gif") {
        imagegif($tmp, "img/avatars/" . $id_empresa . "/thum_" . $nombre_nuevo_archivo);
    } else if ($ext == "png") {
        imagepng($tmp, "img/avatars/" . $id_empresa . "/thum_" . $nombre_nuevo_archivo);
    } else {
        imagejpeg($tmp, "img/avatars/" . $id_empresa . "/thum_" . $nombre_nuevo_archivo);
    }
    /* SI QUEREMOS MOSTRAR LA IMAGEN EN EL NAVEGADOR
     *
     * descomentamos las lineas 64 ( Header("Content-type: image/jpeg"); ) y 65 ( imagejpeg($tmp); )
     * y comentamos la linea 57 ( imagejpeg($tmp,"./imagen/retoque.jpg",$calidad); )
     */
    //Header("Content-type: image/jpeg");
    //imagejpeg($tmp);
}
function ColocaImagenVerificaAvatar($rut, $desde_admin)
{
    //Debo traer los datos del usuario, para ver si la foto esta con guion
    if ($_SESSION["id_empresa"] == 28) {
        $datos_usuario = UsuarioEnBasePersonas($rut);
        $numero_sap    = $datos_usuario[0]->codigo_sap;
        $rut           = $numero_sap;
        $rut_completo  = $numero_sap;
        if ($desde_admin == "admin") {
            $ruta              = "img/personas/28/" . $rut;
            $ruta_rut_completo = "img/personas/28/" . $rut_completo;
        } else {
            $ruta              = "img/personas/28/" . $rut;
            $ruta_rut_completo = "img/personas/28/" . $rut_completo;
        }
    } else {
        $datos_usuario = UsuarioEnBasePersonas($rut);
        $rut_completo  = $datos_usuario[0]->rut_completo;
        if ($desde_admin == "admin") {
            $ruta              = "../front/img/personas/" . $rut;
            $ruta_rut_completo = "../front/img/personas/" . $rut_completo;
        } else {
            $ruta              = "img/personas/" . $rut;
            $ruta_rut_completo = "img/personas/" . $rut_completo;
        }
    }
    if ($datos_usuario[0]->avatar) {
        if ($_SESSION["id_empresa"] == 59 or $_SESSION["id_empresa"] == 75 or $_SESSION["id_empresa"] == 22) {
            $imagen = $datos_usuario[0]->avatar;
            //    echo $imagen."<br><br>";
        } else {
            $imagen = "img/avatars/" . $_SESSION["id_empresa"] . "/" . $datos_usuario[0]->avatar;
        }
    } else {
        if (file_exists($ruta . ".jpg")) {
            $imagen = $ruta . ".jpg";
        } else if (file_exists($ruta . ".JPG")) {
            $imagen = $ruta . ".JPG";
        } else if (file_exists($ruta . ".gif")) {
            $imagen = $ruta . ".gif";
        } else if (file_exists($ruta_rut_completo . ".jpg")) {
            $imagen = $ruta_rut_completo . ".jpg";
        } else if (file_exists($ruta_rut_completo . ".JPG")) {
            $imagen = $ruta_rut_completo . ".JPG";
        } else if (file_exists($ruta_rut_completo . ".gif")) {
            $imagen = $ruta_rut_completo . ".gif";
        } else {
            $imagen = "img/sinfoto.png";
        }
    }
    return ($imagen);
}
function ColocaImagenesMedallas($total_medallas, $imagen_medalla)
{
    for ($tot = 1; $tot <= $total_medallas; $tot++) {
        $html_medallas .= "<img src='img/bci_elviaje_medalla.jpg'>";
    }
    return ($html_medallas);
}
function colocaImagenesPorObjeto($id_objeto, $rut, $id_empresa, $pagina, $id_malla, $cantidad_imagenes_galeria)
{
    //echo "$id_objeto, $id_empresa, $pagina, $id_malla)";
    $imagenes = FotosPorObjetoPorMalla($id_objeto, $id_empresa, $pagina, $id_malla, $cantidad_imagenes_galeria);
    $j        = 1;
    foreach ($imagenes as $img) {
        if ($j == 1) {
            $row_html .= "<div class='row'>";
        }
        $row_html .= file_get_contents("views/cursos/objetos/subirFotos/" . $id_empresa . "_lista_archivos.html");
        if ($j == 3) {
            $row_html .= "</div>";
            $j = 1;
        } else {
            $j++;
        }
        $figura   = '<a href="galeria/' . $img->archivo . '" title="' . $img->descripcion . '" onclick="vista_galeria(' . $img->id . ')"  data-gallery><img src="img/objetos/' . $img->archivo . '""></a>';
        $row_html = str_replace("{FIGURA}", $figura, $row_html);
        $row_html = str_replace("{URL_IMAGEN_ARCHIVO}", "img/objetos/" . $img->archivo . "", $row_html);
        $row_html = str_replace("{DESCRIPCION}", utf8_encode($img->nombre_completo), $row_html);
        $row_html = str_replace("{COMENTARIO}", utf8_encode($img->comentarios), $row_html);
        $row_html = str_replace("{URL_IMAGEN_PERSONA}", VerificaFotoPersonal($img->rut_autor), $row_html);
        if ($img->rut_autor == $rut) {
            $row_html = str_replace("{MEGUSTA}", ColocaMeGusta($img->id, "id_imagen_galeria", $id_empresa, $rut, "autor"), $row_html);
            $row_html = str_replace("{DELETE}", file_get_contents("views/cursos/objetos/subirFotos/" . $id_empresa . "_delete_imagen.html"), $row_html);
            $row_html = str_replace("{ID_IMAGEN_ENCODEADA}", Encodear3($img->id), $row_html);
        } else {
            $row_html = str_replace("{MEGUSTA}", ColocaMeGusta($img->id, "id_imagen_galeria", $id_empresa, $rut), $row_html);
            $row_html = str_replace("{DELETE}", "", $row_html);
        }
        $row_html = str_replace("{VISITAS}", 0, $row_html);
        if ($img->modalidad == 1) {
            $row_html = str_replace("{CATEGORIA}", "Mi Mamá", $row_html);
        } else if ($img->modalidad == 2) {
            $row_html = str_replace("{CATEGORIA}", "La Mamá de mis hijos", $row_html);
        } else if ($img->modalidad == 3) {
            $row_html = str_replace("{CATEGORIA}", "Yo como Mamá", $row_html);
        }
    }
    if ($j == 2 or $j == 3) {
        $row_html .= "</div>";
    }
    return ($row_html);
}
function ColocaBloqueRecienteForo($PRINCIPAL, $id_objeto)
{
    //obtengo comentarios dado id_objeto
    $total_comentarios = ObtenerComentariosDadoIdObjeto($id_objeto);
    if ($total_comentarios) {
        foreach ($total_comentarios as $come) {
            $row_html .= file_get_contents("views/cursos/objetos/foro/bloque_comentario_destacado.html");
            $row_html = str_replace("{NOMBRE_COMPLETO}", $come->nombre_completo, $row_html);
            $row_html = str_replace("{COMENTARIO}", $come->comentario, $row_html);
            $row_html = str_replace("{CANTIDAD_MEGUSTA}", $come->total_megusta, $row_html);
            $row_html = str_replace("{TIEMPO}", FechaTipoSpa($come->fecha . " " . $come->hora), $row_html);
            $row_html = str_replace("{URL_PERSONA}", VerificaFotoPersonal($come->rut), $row_html);
        }
        $PRINCIPAL = str_replace("{BLOQUE_DESTACADOS}", utf8_encode($row_html), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BLOQUE_DESTACADOS}", "", $PRINCIPAL);
    }
    return ($PRINCIPAL);
}

function ColocaMPEstadisticas($PRINCIPAL, $id_empresa)
{
    
    return ($PRINCIPAL);
}
function GAMIFICACIONColocaEnvironmentBotonModulos($PRINCIPAL, $rut, $id_objetivo, $orden, $id_curso, $id_empresa)
{
    $datos_objeto_por_curso = GAMIFICACIONTraeDatosObjetosPorCurso($rut, $id_curso);
    if ($datos_objeto_por_curso[0]->total_objetos == $datos_objeto_por_curso[0]->total_objetos_finalizados) {
        $PRINCIPAL = str_replace("{ENVIRONMENT_AMBIENTE}", "FinNivel", $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{ENVIRONMENT_AMBIENTE}", "interPant", $PRINCIPAL);
    }
    return ($PRINCIPAL);
}
function ActualizoEstadoInscripcionCierre($id_curso, $rut, $id_empresa)
{
    //
    $datos                     = GAMIFICACIONTraeDatosObjetosPorCurso($rut, $id_curso);
    $total_objetos             = $datos[0]->total_objetos;
    $total_objetos_finalizados = $datos[0]->total_objetos_finalizados;
    $promedio_por_curso        = $datos[0]->promedio_por_curso;
   // print_r($datos);
    $porcentaje_Avance         = ColocaDecimalesNotasFinales(0, (($total_objetos_finalizados * 100) / $total_objetos), $tipo);
    if ($porcentaje_Avance == 100) {

            $estado = 1;

    } else if ($porcentaje_Avance >= 0 or $porcentaje_Avance < 100 and ($total_objetos <> $total_objetos_finalizados)) {
        //en proceso
        $estado = 3;
    }
    //ahora actualizo el porcentaje de avance de la tabla inscripcion cierre
    //ahora,
    $array_malla = BuscaMallaapartirRutCursoObjeto($id_curso, $rut, $id_empresa);
    //print_r($array_malla);
    GAMIFICACIONActualizarDatosCierre($id_curso, $rut, $id_empresa, $porcentaje_Avance, $estado, $promedio_por_curso,"","");
}





function ActualizoTipsGanados($id_objeto, $id_tip, $rut, $id_empresa)
{
    //InsertUpdateTipsGanados($id_objeto, $id_tip, $rut, $id_empresa);
}
function GamificacionPuntos($rut, $id_empresa, $id_objeto, $id_curso, $malla, $puntos, $medallas)
{
    //Primero veo si tiene o no en la tabla de puntos
    $tiene_puntos_objeto = GAMIFICACIONTienePuntosPorCursoObjetoRutEmpresa($rut, $id_objeto, $id_curso, $id_empresa);
    if (!$tiene_puntos_objeto) {
        GAMIFICACIONInsertaPuntosPorObjeto($rut, $id_objeto, $id_curso, $id_empresa, $puntos, $medallas,"","","","");
//        $tiene_consolidado_puntos = GAMIFICACIONTienePuntosAcumuladosPorRutEmpresa($rut, $id_empresa);
        if ($tiene_consolidado_puntos) {
            $puntos_para_consolidado = $tiene_consolidado_puntos[0]->puntos + $puntos;
            GAMIFICACIONActualizarDatosConsolidados($rut, $id_empresa, $puntos_para_consolidado, $tiene_consolidado_puntos[0]->nivel, $medallas);
        } else {
            GAMIFICACIONInsertaPuntosAcumulados($rut, $id_empresa, $puntos_para_consolidado, $tiene_consolidado_puntos[0]->nivel, $medallas,"");
        }
    } else {
        //$tiene_consolidado_puntos = GAMIFICACIONTienePuntosAcumuladosPorRutEmpresa($rut, $id_empresa);
        if ($tiene_consolidado_puntos) {
            $puntos_para_consolidado = $tiene_consolidado_puntos[0]->puntos;
            GAMIFICACIONActualizarDatosConsolidados($rut, $id_empresa, $puntos_para_consolidado, $tiene_consolidado_puntos[0]->nivel, $medallas);
        } else {
            GAMIFICACIONInsertaPuntosAcumulados($rut, $id_empresa, $puntos_para_consolidado, $tiene_consolidado_puntos[0]->nivel, $medallas,"");
        }
    }
    //veo si tiene puntos consolidados
}
function ColocaBloqueDeComentariosFinalesEvaluado($PRINCIPAL, $evaluado, $evaluador, $id_proceso)
{
    $esta_validado_el_evaluado = VerificaSiObjetivosEstanValidadosDadoEvaluadorIdProcesoEvaluado($evaluador, $id_proceso, $evaluado);
    if ($esta_validado_el_evaluado) {
        $html = file_get_contents("views/sgd/objetivos/preguntas_finales_evaluado_evaluado.html");
    } else {
        $finalizado_evaluado = TienePReguntasFinalesEvaluado($evaluado);
        if ($finalizado_evaluado) {
            $html = file_get_contents("views/sgd/objetivos/preguntas_finales_evaluado_lectura.html");
            $html = str_replace("{CORP}", $finalizado_evaluado[0]->conocimiento_corporativo, $html);
            $html = str_replace("{AREA}", $finalizado_evaluado[0]->conocimiento_area, $html);
            $html = str_replace("{INDIVIDUAL}", $finalizado_evaluado[0]->conocimiento_objetivos_individual, $html);
            $html = str_replace("{COMPETENCIAS}", $finalizado_evaluado[0]->conocimiento_competencias, $html);
            $html = str_replace("{TUVE_FEEDBACK}", $finalizado_evaluado[0]->tuve_reunion, $html);
            $html = str_replace("{COMENTARIO}", $finalizado_evaluado[0]->comentarios, $html);
        } else {
            $html = file_get_contents("views/sgd/objetivos/preguntas_finales_evaluado.html");
        }
    }
    $PRINCIPAL = str_replace("{BLOQUE_VALIDACION_EVALUADO}", $html, $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocarRankingPorCamposPorPuntos($PRINCIPAL, $id_empresa, $rut)
{
    $datos_empresa          = DatosEmpresa($id_empresa);
    //Campo1
    $datos_usuario_campo123 = UsuarioEnBaseDePersonasInnerEmpresa($rut);
    $datos                  = GAMIFICACION_TodosLosConsolidadosPorCampoEmpresa($id_empresa, $datos_empresa[0]->campo1);
    if ($datos) {
        $i     = 1;
        $total = file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_ranking_grupal_titulo.html");
        $total = str_replace("{NOMBRE_CRITERIO}", $datos_empresa[0]->campo1, $total);
        foreach ($datos as $uni) {
            $total .= file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_ranking_grupal.html");
            $total = str_replace("{RANK}", $i, $total);
            if ($datos_usuario_campo123[0]->{$datos_usuario_campo123[0]->campo1} == $uni->valor_campo) {
                $total = str_replace("{CLASE_COMOVOY}", "lms_miranking", $total);
            } else {
                $total = str_replace("{CLASE_COMOVOY}", "", $total);
            }
            $total = str_replace("{NOMBRE}", $uni->valor_campo, $total);
            $total = str_replace("{PUNTOS}", $uni->suma_puntos, $total);
            $total = str_replace("{MEDALLAS}", $uni->suma_medallas, $total);
            $i++;
        }
    }
    $datos = GAMIFICACION_TodosLosConsolidadosPorCampoEmpresa($id_empresa, $datos_empresa[0]->campo2);
    if ($datos) {
        $i = 1;
        $total .= file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_ranking_grupal_titulo.html");
        $total = str_replace("{NOMBRE_CRITERIO}", $datos_empresa[0]->campo2, $total);
        foreach ($datos as $uni) {
            $total .= file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_ranking_grupal.html");
            $total = str_replace("{RANK}", $i, $total);
            if ($datos_usuario_campo123[0]->{$datos_usuario_campo123[0]->campo2} == $uni->valor_campo) {
                $total = str_replace("{CLASE_COMOVOY}", "lms_miranking", $total);
            } else {
                $total = str_replace("{CLASE_COMOVOY}", "", $total);
            }
            $total = str_replace("{NOMBRE}", $uni->valor_campo, $total);
            $total = str_replace("{PUNTOS}", $uni->suma_puntos, $total);
            $total = str_replace("{MEDALLAS}", $uni->suma_medallas, $total);
            $i++;
        }
    }
    $datos = GAMIFICACION_TodosLosConsolidadosPorCampoEmpresa($id_empresa, $datos_empresa[0]->campo3);
    if ($datos) {
        $i = 1;
        $total .= file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_ranking_grupal_titulo.html");
        $total = str_replace("{NOMBRE_CRITERIO}", $datos_empresa[0]->campo3, $total);
        foreach ($datos as $uni) {
            $total .= file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_ranking_grupal.html");
            $total = str_replace("{RANK}", $i, $total);
            if ($datos_usuario_campo123[0]->{$datos_usuario_campo123[0]->campo3} == $uni->valor_campo) {
                $total = str_replace("{CLASE_COMOVOY}", "lms_miranking", $total);
            } else {
                $total = str_replace("{CLASE_COMOVOY}", "", $total);
            }
            $total = str_replace("{NOMBRE}", $uni->valor_campo, $total);
            $total = str_replace("{PUNTOS}", $uni->suma_puntos, $total);
            $total = str_replace("{MEDALLAS}", $uni->suma_medallas, $total);
            $i++;
        }
    }
    $PRINCIPAL = str_replace("{ROW_RANKING}", utf8_encode($total), $PRINCIPAL);
    return ($PRINCIPAL);
}
function OBJETIVOS_AvanceEvaluador($rut_evaluador, $id_proceso, $id_empresa)
{
    $total_evaluados             = TraeRelacionesSinAeConDatos($rut_evaluador, $id_proceso);
    //Ahora traigo el total de evaluados finalizados en la tabla objetivos_individuales_finalizados
    $total_evaluados_finalizados = VerificoEvaluadosFinalizadosPorEvaluador($rut_evaluador, $id_proceso, $id_empresa);
    //echo count($total_evaluados)."<br>".count($total_evaluados_finalizados);
    if (count($total_evaluados) == count($total_evaluados_finalizados)) {
        $arreglo[0] = 1;
        $arreglo[1] = "Finalizados";
    } else {
        $arreglo[0] = 0;
        $arreglo[1] = "Pendientes";
    }
    return ($arreglo);
}
function ColocarRankingUsuariosPorPuntos($PRINCIPAL, $id_empresa, $id_malla)
{
    //echo "$id_empresa, $id_malla";
    //$total_usuarios=GAMIFICACION_TodosLosConsolidados($id_empresa);
    $total_usuarios = GAMIFICACION_TodosLosConsolidados($id_empresa, $id_malla);
    $i              = 1;
    //print_r($total_usuarios);
    foreach ($total_usuarios as $usu) {
        $total .= file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_row_ranking_individual.html");
        $total = str_replace("{BLOQUE_DATOS_PERSONALES_VE}", file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_ve_perfil_bloque_datos.html"), $total);
        $total = str_replace("{RANK}", $i, $total);
        $total = str_replace("{NOMBRE_COMPLETO}", $usu->nombre_completo, $total);
        $total = str_replace("{CARGO}", $usu->cargo, $total);
        $total = str_replace("{PUNTOS}", $usu->puntos, $total);
        $total = str_replace("{PUNTOS_CONSOLIDADOS}", $usu->puntosconsolidados, $total);
        $total = str_replace("{medallas}", $usu->medallas, $total);
        //$total = str_replace("{URL_PERSONA}",VerificaFotoPersonal($usu->rut),$total);
        if ($_SESSION["user_"] == $usu->rut) {
            $total = str_replace("{CLASE_COMOVOY}", "lms_miranking", $total);
        } else {
            $total = str_replace("{CLASE_COMOVOY}", "", $total);
        }
        $total                   = str_replace("{URL_PERSONA}", ColocaImagenVerificaAvatar($usu->rut), $total);
        $total                   = str_replace("{RUT_ENCODEADO}", Encodear3($usu->rut), $total);
        $total                   = str_replace("{RUT}", ($usu->rut), $total);
        $total_imagenes_medallas = ColocaImagenesMedallas($usu->medallas, $imagen_medalla);
        $total                   = str_replace("{IMAGENMEDALLAS_USUARIOS}", $total_imagenes_medallas, $total);
        $total                   = str_replace("{CAMPO1}", ($usu->campo1), $total);
        $total                   = str_replace("{CAMPO2}", ($usu->campo2), $total);
        $total                   = str_replace("{CAMPO3}", ($usu->campo3), $total);
        $i++;
    }
    $PRINCIPAL = str_replace("{ROW_RANKING}", utf8_encode($total), $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocarBLOQUEDATOSUsuarios($PRINCIPAL, $id_empresa, $rut)
{
    $total                   = str_replace("{BLOQUE_DATOS_PERSONALES}", file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_mi_perfil_bloque_datos.html"), $total);
    $total                   = str_replace("{RANK}", $i, $total);
    $total                   = str_replace("{NOMBRE_COMPLETO}", $usu->nombre_completo, $total);
    $total                   = str_replace("{CARGO}", $usu->cargo, $total);
    $total                   = str_replace("{PUNTOS_CONSOLIDADOS}", $usu->puntosconsolidados, $total);
    $total                   = str_replace("{medallas}", $usu->medallas, $total);
    $total                   = str_replace("{URL_PERSONA}", ColocaImagenVerificaAvatar($usu->rut), $total);
    $total                   = str_replace("{RUT_ENCODEADO}", Encodear3($usu->rut), $total);
    $total                   = str_replace("{RUT}", ($usu->rut), $total);
    $total_imagenes_medallas = ColocaImagenesMedallas($usu->medallas, $imagen_medalla);
    $total                   = str_replace("{IMAGENMEDALLAS_USUARIOS}", $total_imagenes_medallas, $total);
    $total                   = str_replace("{CAMPO1}", ($usu->campo1), $total);
    $total                   = str_replace("{CAMPO2}", ($usu->campo2), $total);
    $total                   = str_replace("{CAMPO3}", ($usu->campo3), $total);
    $total                   = str_replace("{NOMBRE_COMPLETO}", "hol", $total);
    print_r($total);
    return ($total);
}
function GAMIFICACION_ActualizaNivel($id_malla, $id_empresa, $rut)
{
    $datos_nivel = GAMIFICACION_ObtenerNivelesPorMallaEmpresa($id_malla, $id_empresa);
    //ahora que tengo los datos, hago un ciclo, para ver si cada curs esta o no finalizado
    foreach ($datos_nivel as $unico) {
        $estado_por_curso = CAPACITACION_ObtenerEstadoAvanceCurso($rut, $unico->idcurso, "", $id_empresa);
        $curso_finalizado = VErificaCursoFinalizado($unico->idcurso, $rut);
        if ($curso_finalizado)
            continue;
        if ($estado_por_curso[4] == 0) {
            //Verifico si la cantidad de modulos del curso=nivel es igual a los modulos finalizados de este curso=nivel
            $datos_objeto_por_curso = GAMIFICACIONTraeDatosObjetosPorCurso($rut, $id_curso);
            $detalle_nivel          = GAMIFICACION_ObtenerDescripcionNivelesPorIdEmpresa($unico->idnivel, $id_empresa);
            //veo si tiene acumulado los puntos
            //$tiene_puntos           = GAMIFICACIONTienePuntosAcumuladosPorRutEmpresa($rut, $id_empresa);
            if ($tiene_puntos) {
                GAMIFICACIONActualizarDatosConsolidados($rut, $id_empresa, $tiene_puntos[0]->puntos, $unico->idnivel, $tiene_puntos[0]->medallas + $unico->medallas);
            } else {
                GAMIFICACIONInsertaPuntosAcumulados($rut, $id_empresa, 0, $unico->idnivel, 0,"");
            }
            break;
        }
    }
}

function comprimir_pagina($buffer)
{
    $busca     = array(
        '/\>[^\S ]+/s',
        '/[^\S ]+\</s',
        '/(\s)+/s'
    );
    $reemplaza = array(
        '>',
        '<',
        '\\1'
    );
    return preg_replace($busca, $reemplaza, $buffer);
}

function CAPACITACION_ObtenerEstadoAvanceCurso($rut, $id_curso, $id_inscripcion, $id_empresa)
{

//echo "<br>CAPACITACION_ObtenerEstadoAvanceCurso($rut, $id_curso, $id_inscripcion, $id_empresa";

    if ($id_inscripcion) {

    //echo "id inscripcion";
    //TIENE INSCRIPCION EN ELEARNING

     $datos_inscripcion_cierre = TieneInscripcionCierreDadoRutYCursoEmpresaInscripcion($rut, $id_curso, $id_inscripcion, $id_empresa);

        if ($datos_inscripcion_cierre[0]->estado == 1 and $datos_inscripcion_cierre[0]->estado_descripcion == "") {
            //echo "___1.1";exit();
            $arreglo[0]  = '<span class="etiquetaPrograma etiquetaPrograma-aprobado pull-left"><i class="fas fa-check-square"></i>&nbsp;&nbsp;Aprobado</span>';
            $arreglo[1]  = 'success';
            $arreglo[2]  = '<i class="fas fa-check-square"></i>';
            $arreglo[3]  = 100;
            //avance de tabla cierre
            $arreglo[4]  = $datos_inscripcion_cierre[0]->avance;
            $arreglo[5]  = $datos_inscripcion_cierre[0]->navegacionminutos;
            $arreglo[6]  = $datos_inscripcion_cierre[0]->estado;
            $arreglo[7]  = $datos_inscripcion_cierre[0]->nota;
            $arreglo[8]  = $datos_inscripcion_cierre[0]->fecha_termino;
            $arreglo[9]  = '<span class="etiquetaPrograma etiquetaPrograma-aprobado pull-left"><i class="fas fa-check-square"></i>&nbsp;&nbsp;Aprobado&nbsp;' . $datos_inscripcion_cierre[0]->nota . '</span>';
            $arreglo[10] = $datos_inscripcion_cierre[0]->porcentaje_asistencia;
            $arreglo[11] = '<i class="fa fa-check" aria-hidden="true"></i>';
            $arreglo[12] = 'vr_color_verde';
            $arreglo[13] = $datos_inscripcion_cierre[0]->caso_especial;
        } else if ($datos_inscripcion_cierre[0]->estado === '0') {
            //echo "___2.1";exit();
            $arreglo[0]  = '<span class="etiquetaPrograma etiquetaPrograma-reprobado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Reprobado</span>';
            $arreglo[1]  = 'danger';
            $arreglo[2]  = '<i class="far fa-times-circle"></i>';
            $arreglo[3]  = 100;
            $arreglo[4]  = $datos_inscripcion_cierre[0]->avance;
            $arreglo[5]  = $datos_inscripcion_cierre[0]->navegacionminutos;
            $arreglo[6]  = $datos_inscripcion_cierre[0]->estado;
            $arreglo[7]  = $datos_inscripcion_cierre[0]->nota;
            $arreglo[8]  = $datos_inscripcion_cierre[0]->fecha_termino;
            $arreglo[9]  = '<span class="etiquetaPrograma etiquetaPrograma-reprobado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Reprobado&nbsp;' . $datos_inscripcion_cierre[0]->nota . '</span>';
            $arreglo[10] = $datos_inscripcion_cierre[0]->porcentaje_asistencia;
            $arreglo[11] = '<i class="fa fa-times" aria-hidden="true"></i>';
            $arreglo[12] = 'vr_color_rojo';
            $arreglo[13] = $datos_inscripcion_cierre[0]->caso_especial;
        } else if ($datos_inscripcion_cierre[0]->estado == 3) {
            //echo "___3.1";exit();
            $arreglo[0]  = '<span class="etiquetaPrograma etiquetaPrograma-proceso pull-left"><i class="fas fa-spinner"></i>&nbsp;En Proceso</span>';
            $arreglo[1]  = 'danger';
            $arreglo[2]  = '<i class="icon-hourglass icons"></i>';
            $arreglo[3]  = 100;
            $arreglo[4]  = $datos_inscripcion_cierre[0]->avance;
            $arreglo[5]  = $datos_inscripcion_cierre[0]->navegacionminutos;
            $arreglo[6]  = $datos_inscripcion_cierre[0]->estado;
            $arreglo[7]  = $datos_inscripcion_cierre[0]->nota;
            $arreglo[8]  = $datos_inscripcion_cierre[0]->fecha_termino;
            $arreglo[9]  = '<span class="etiquetaPrograma etiquetaPrograma-proceso pull-left"><i class="fas fa-spinner"></i>&nbsp;En Proceso&nbsp;' . $datos_inscripcion_cierre[0]->nota . '</span>';
            $arreglo[10] = $datos_inscripcion_cierre[0]->porcentaje_asistencia;
            $arreglo[11] = '<i class="fa fa-clock-o" aria-hidden="true"></i>';
            $arreglo[12] = 'vr_color_amarillo';
            $arreglo[13] = $datos_inscripcion_cierre[0]->caso_especial;
        } else if ($datos_inscripcion_cierre[0]->estado == 4) {
            //   echo "___4.1";exit();
            $arreglo[0]  = '<span class="etiquetaPrograma etiquetaPrograma-noiniciado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;No Iniciado </span>';
            $arreglo[1]  = 0;
            $arreglo[2]  = '<i class="icon-frame icons"></i>';
            $arreglo[3]  = 0;
            $arreglo[4]  = $datos_inscripcion_cierre[0]->avance;
            $arreglo[5]  = $datos_inscripcion_cierre[0]->navegacionminutos;
            $arreglo[6]  = $datos_inscripcion_cierre[0]->estado;
            $arreglo[7]  = $datos_inscripcion_cierre[0]->nota;
            $arreglo[8]  = $datos_inscripcion_cierre[0]->fecha_termino;
            $arreglo[9]  = '<span class="etiquetaPrograma etiquetaPrograma-noiniciado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;No Iniciado </span>';
            $arreglo[10] = $datos_inscripcion_cierre[0]->porcentaje_asistencia;
            $arreglo[11] = '<i class="fa fa-circle-thin" aria-hidden="true"></i>';
            $arreglo[12] = 'vr_color_gris';
            $arreglo[13] = $datos_inscripcion_cierre[0]->caso_especial;
        } else if (count($datos_inscripcion_cierre) == 0) {
            //echo "___5.1";exit();
            $arreglo[0]  = '<span class="etiquetaPrograma etiquetaPrograma-noiniciado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;No Iniciado </span>';
            $arreglo[1]  = 0;
            $arreglo[2]  = '<i class="icon-frame icons"></i>';
            $arreglo[3]  = 0;
            $arreglo[4]  = 0;
            $arreglo[5]  = 0;
            $arreglo[6]  = $datos_inscripcion_cierre[0]->estado;
            $arreglo[7]  = $datos_inscripcion_cierre[0]->nota;
            $arreglo[8]  = $datos_inscripcion_cierre[0]->fecha_termino;
            $arreglo[9]  = '<span class="etiquetaPrograma etiquetaPrograma-noiniciado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;No Iniciado </span>';
            $arreglo[10] = $datos_inscripcion_cierre[0]->porcentaje_asistencia;
            $arreglo[11] = '<i class="fa fa-circle-thin" aria-hidden="true"></i>';
            $arreglo[12] = 'vr_color_gris';
            $arreglo[13] = $datos_inscripcion_cierre[0]->caso_especial;
        } else if ($datos_inscripcion_cierre[0]->estado == 1 and $datos_inscripcion_cierre[0]->estado_descripcion == "Aprueba") {
            //echo "___6.1";exit();
            $arreglo[0]  = '<span class="etiquetaPrograma etiquetaPrograma-aprobado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Aprueba </span>';
            $arreglo[1]  = 0;
            $arreglo[2]  = '<i class="icon-frame icons"></i>';
            $arreglo[3]  = 100;
            $arreglo[4]  = $datos_inscripcion_cierre[0]->avance;
            $arreglo[5]  = $datos_inscripcion_cierre[0]->navegacionminutos;
            $arreglo[6]  = $datos_inscripcion_cierre[0]->estado;
            $arreglo[7]  = $datos_inscripcion_cierre[0]->nota;
            $arreglo[8]  = $datos_inscripcion_cierre[0]->fecha_termino;
            $arreglo[9]  = '<span class="etiquetaPrograma etiquetaPrograma-aprobado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Aprueba </span>';
            $arreglo[10] = $datos_inscripcion_cierre[0]->porcentaje_asistencia;
            $arreglo[11] = '<i class="fa fa-check" aria-hidden="true"></i>';
            $arreglo[12] = 'vr_color_verde';
            $arreglo[13] = $datos_inscripcion_cierre[0]->caso_especial;
        } else if ($datos_inscripcion_cierre[0]->estado == 1 and $datos_inscripcion_cierre[0]->estado_descripcion == "APROBADO") {
            //   echo "___7.1";exit();
            $arreglo[0]  = '<span class="etiquetaPrograma etiquetaPrograma-aprobado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;APROBADO </span>';
            $arreglo[1]  = 0;
            $arreglo[2]  = '<i class="icon-frame icons"></i>';
            $arreglo[3]  = 100;
            $arreglo[4]  = $datos_inscripcion_cierre[0]->avance;
            $arreglo[5]  = $datos_inscripcion_cierre[0]->navegacionminutos;
            $arreglo[6]  = $datos_inscripcion_cierre[0]->estado;
            $arreglo[7]  = $datos_inscripcion_cierre[0]->nota;
            $arreglo[8]  = $datos_inscripcion_cierre[0]->fecha_termino;
            $arreglo[9]  = '<span class="etiquetaPrograma etiquetaPrograma-aprobado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;APROBADO </span>';
            $arreglo[10] = $datos_inscripcion_cierre[0]->porcentaje_asistencia;
            $arreglo[11] = '<i class="fa fa-check" aria-hidden="true"></i>';
            $arreglo[12] = 'vr_color_verde';
            $arreglo[13] = $datos_inscripcion_cierre[0]->caso_especial;
        } else if ($datos_inscripcion_cierre[0]->estado == 1 and $datos_inscripcion_cierre[0]->estado_descripcion == "Reprueba") {
            //echo "___8.1";exit();
            $arreglo[0]  = '<span class="etiquetaPrograma etiquetaPrograma-reprobado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Reprueba </span>';
            $arreglo[1]  = 0;
            $arreglo[2]  = '<i class="icon-frame icons"></i>';
            $arreglo[3]  = 100;
            $arreglo[4]  = $datos_inscripcion_cierre[0]->avance;
            $arreglo[5]  = $datos_inscripcion_cierre[0]->navegacionminutos;
            $arreglo[6]  = $datos_inscripcion_cierre[0]->estado;
            $arreglo[7]  = $datos_inscripcion_cierre[0]->nota;
            $arreglo[8]  = $datos_inscripcion_cierre[0]->fecha_termino;
            $arreglo[9]  = '<span class="etiquetaPrograma etiquetaPrograma-reprobado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Reprueba </span>';
            $arreglo[10] = $datos_inscripcion_cierre[0]->porcentaje_asistencia;
            $arreglo[11] = '<i class="fa fa-check" aria-hidden="true"></i>';
            $arreglo[12] = 'vr_color_rojo';
            $arreglo[13] = $datos_inscripcion_cierre[0]->caso_especial;
        } else if ($datos_inscripcion_cierre[0]->estado == 1 and $datos_inscripcion_cierre[0]->estado_descripcion == "REPROBADO") {
            //echo "___9.1";exit();
            $arreglo[0]  = '<span class="etiquetaPrograma etiquetaPrograma-reprobado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;REPROBADO </span>';
            $arreglo[1]  = 0;
            $arreglo[2]  = '<i class="icon-frame icons"></i>';
            $arreglo[3]  = 100;
            $arreglo[4]  = $datos_inscripcion_cierre[0]->avance;
            $arreglo[5]  = $datos_inscripcion_cierre[0]->navegacionminutos;
            $arreglo[6]  = $datos_inscripcion_cierre[0]->estado;
            $arreglo[7]  = $datos_inscripcion_cierre[0]->nota;
            $arreglo[8]  = $datos_inscripcion_cierre[0]->fecha_termino;
            $arreglo[9]  = '<span class="etiquetaPrograma etiquetaPrograma-reprobado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;REPROBADO </span>';
            $arreglo[10] = $datos_inscripcion_cierre[0]->porcentaje_asistencia;
            $arreglo[11] = '<i class="fa fa-check" aria-hidden="true"></i>';
            $arreglo[12] = 'vr_color_rojo';
            $arreglo[13] = $datos_inscripcion_cierre[0]->caso_especial;
        }



    } else {
        $datos_inscripcion_cierre = TieneInscripcionCierreDadoRutYCursoEmpresa($rut, $id_curso, $id_empresa);
//        print_r($datos_inscripcion_cierre);

        if ($datos_inscripcion_cierre[0]->estado == 1 and $datos_inscripcion_cierre[0]->estado_descripcion == "") {
            //echo "___1.1";exit();
            $arreglo[0]  = '<span class="etiquetaPrograma etiquetaPrograma-aprobado pull-left"><i class="fas fa-check-square"></i>&nbsp;&nbsp;Aprobado</span>';
            $arreglo[1]  = 'success';
            $arreglo[2]  = '<i class="fas fa-check-square"></i>';
            $arreglo[3]  = 100;
            //avance de tabla cierre
            $arreglo[4]  = $datos_inscripcion_cierre[0]->avance;
            $arreglo[5]  = $datos_inscripcion_cierre[0]->navegacionminutos;
            $arreglo[6]  = $datos_inscripcion_cierre[0]->estado;
            $arreglo[7]  = $datos_inscripcion_cierre[0]->nota;
            $arreglo[8]  = $datos_inscripcion_cierre[0]->fecha_termino;
            $arreglo[9]  = '<span class="etiquetaPrograma etiquetaPrograma-aprobado pull-left"><i class="fas fa-check-square"></i>&nbsp;&nbsp;Aprobado&nbsp;' . $datos_inscripcion_cierre[0]->nota . '</span>';
            $arreglo[10] = $datos_inscripcion_cierre[0]->porcentaje_asistencia;
            $arreglo[11] = '<i class="fa fa-check" aria-hidden="true"></i>';
            $arreglo[12] = 'vr_color_verde';
            $arreglo[13] = $datos_inscripcion_cierre[0]->caso_especial;
        } else if ($datos_inscripcion_cierre[0]->estado === '0') {
            //echo "___2.1";exit();
            $arreglo[0]  = '<span class="etiquetaPrograma etiquetaPrograma-reprobado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Reprobado</span>';
            $arreglo[1]  = 'danger';
            $arreglo[2]  = '<i class="far fa-times-circle"></i>';
            $arreglo[3]  = 100;
            $arreglo[4]  = $datos_inscripcion_cierre[0]->avance;
            $arreglo[5]  = $datos_inscripcion_cierre[0]->navegacionminutos;
            $arreglo[6]  = $datos_inscripcion_cierre[0]->estado;
            $arreglo[7]  = $datos_inscripcion_cierre[0]->nota;
            $arreglo[8]  = $datos_inscripcion_cierre[0]->fecha_termino;
            $arreglo[9]  = '<span class="etiquetaPrograma etiquetaPrograma-reprobado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Reprobado&nbsp;' . $datos_inscripcion_cierre[0]->nota . '</span>';
            $arreglo[10] = $datos_inscripcion_cierre[0]->porcentaje_asistencia;
            $arreglo[11] = '<i class="fa fa-times" aria-hidden="true"></i>';
            $arreglo[12] = 'vr_color_rojo';
            $arreglo[13] = $datos_inscripcion_cierre[0]->caso_especial;
        } else if ($datos_inscripcion_cierre[0]->estado == 3) {
            //echo "___3.1";exit();
            $arreglo[0]  = '<span class="etiquetaPrograma etiquetaPrograma-proceso pull-left"><i class="fas fa-spinner"></i>&nbsp;En Proceso</span>';
            $arreglo[1]  = 'danger';
            $arreglo[2]  = '<i class="icon-hourglass icons"></i>';
            $arreglo[3]  = 100;
            $arreglo[4]  = $datos_inscripcion_cierre[0]->avance;
            $arreglo[5]  = $datos_inscripcion_cierre[0]->navegacionminutos;
            $arreglo[6]  = $datos_inscripcion_cierre[0]->estado;
            $arreglo[7]  = $datos_inscripcion_cierre[0]->nota;
            $arreglo[8]  = $datos_inscripcion_cierre[0]->fecha_termino;
            $arreglo[9]  = '<span class="etiquetaPrograma etiquetaPrograma-proceso pull-left"><i class="fas fa-spinner"></i>&nbsp;En Proceso&nbsp;' . $datos_inscripcion_cierre[0]->nota . '</span>';
            $arreglo[10] = $datos_inscripcion_cierre[0]->porcentaje_asistencia;
            $arreglo[11] = '<i class="fa fa-clock-o" aria-hidden="true"></i>';
            $arreglo[12] = 'vr_color_amarillo';
            $arreglo[13] = $datos_inscripcion_cierre[0]->caso_especial;
        } else if ($datos_inscripcion_cierre[0]->estado == 4) {
            //   echo "___4.1";exit();
            $arreglo[0]  = '<span class="etiquetaPrograma etiquetaPrograma-noiniciado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;No Iniciado </span>';
            $arreglo[1]  = 0;
            $arreglo[2]  = '<i class="icon-frame icons"></i>';
            $arreglo[3]  = 0;
            $arreglo[4]  = $datos_inscripcion_cierre[0]->avance;
            $arreglo[5]  = $datos_inscripcion_cierre[0]->navegacionminutos;
            $arreglo[6]  = $datos_inscripcion_cierre[0]->estado;
            $arreglo[7]  = $datos_inscripcion_cierre[0]->nota;
            $arreglo[8]  = $datos_inscripcion_cierre[0]->fecha_termino;
            $arreglo[9]  = '<span class="etiquetaPrograma etiquetaPrograma-noiniciado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;No Iniciado </span>';
            $arreglo[10] = $datos_inscripcion_cierre[0]->porcentaje_asistencia;
            $arreglo[11] = '<i class="fa fa-circle-thin" aria-hidden="true"></i>';
            $arreglo[12] = 'vr_color_gris';
            $arreglo[13] = $datos_inscripcion_cierre[0]->caso_especial;
        } else if (count($datos_inscripcion_cierre) == 0) {
            //echo "___5.1";exit();
            $arreglo[0]  = '<span class="etiquetaPrograma etiquetaPrograma-noiniciado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;No Iniciado </span>';
            $arreglo[1]  = 0;
            $arreglo[2]  = '<i class="icon-frame icons"></i>';
            $arreglo[3]  = 0;
            $arreglo[4]  = 0;
            $arreglo[5]  = 0;
            $arreglo[6]  = $datos_inscripcion_cierre[0]->estado;
            $arreglo[7]  = $datos_inscripcion_cierre[0]->nota;
            $arreglo[8]  = $datos_inscripcion_cierre[0]->fecha_termino;
            $arreglo[9]  = '<span class="etiquetaPrograma etiquetaPrograma-noiniciado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;No Iniciado </span>';
            $arreglo[10] = $datos_inscripcion_cierre[0]->porcentaje_asistencia;
            $arreglo[11] = '<i class="fa fa-circle-thin" aria-hidden="true"></i>';
            $arreglo[12] = 'vr_color_gris';
            $arreglo[13] = $datos_inscripcion_cierre[0]->caso_especial;
        } else if ($datos_inscripcion_cierre[0]->estado == 1 and $datos_inscripcion_cierre[0]->estado_descripcion == "Aprueba") {
            //echo "___6.1";exit();
            $arreglo[0]  = '<span class="etiquetaPrograma etiquetaPrograma-aprobado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Aprueba </span>';
            $arreglo[1]  = 0;
            $arreglo[2]  = '<i class="icon-frame icons"></i>';
            $arreglo[3]  = 100;
            $arreglo[4]  = $datos_inscripcion_cierre[0]->avance;
            $arreglo[5]  = $datos_inscripcion_cierre[0]->navegacionminutos;
            $arreglo[6]  = $datos_inscripcion_cierre[0]->estado;
            $arreglo[7]  = $datos_inscripcion_cierre[0]->nota;
            $arreglo[8]  = $datos_inscripcion_cierre[0]->fecha_termino;
            $arreglo[9]  = '<span class="etiquetaPrograma etiquetaPrograma-aprobado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Aprueba </span>';
            $arreglo[10] = $datos_inscripcion_cierre[0]->porcentaje_asistencia;
            $arreglo[11] = '<i class="fa fa-check" aria-hidden="true"></i>';
            $arreglo[12] = 'vr_color_verde';
            $arreglo[13] = $datos_inscripcion_cierre[0]->caso_especial;
        } else if ($datos_inscripcion_cierre[0]->estado == 1 and $datos_inscripcion_cierre[0]->estado_descripcion == "APROBADO") {
            //   echo "___7.1";exit();
            $arreglo[0]  = '<span class="etiquetaPrograma etiquetaPrograma-aprobado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;APROBADO </span>';
            $arreglo[1]  = 0;
            $arreglo[2]  = '<i class="icon-frame icons"></i>';
            $arreglo[3]  = 100;
            $arreglo[4]  = $datos_inscripcion_cierre[0]->avance;
            $arreglo[5]  = $datos_inscripcion_cierre[0]->navegacionminutos;
            $arreglo[6]  = $datos_inscripcion_cierre[0]->estado;
            $arreglo[7]  = $datos_inscripcion_cierre[0]->nota;
            $arreglo[8]  = $datos_inscripcion_cierre[0]->fecha_termino;
            $arreglo[9]  = '<span class="etiquetaPrograma etiquetaPrograma-aprobado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;APROBADO </span>';
            $arreglo[10] = $datos_inscripcion_cierre[0]->porcentaje_asistencia;
            $arreglo[11] = '<i class="fa fa-check" aria-hidden="true"></i>';
            $arreglo[12] = 'vr_color_verde';
            $arreglo[13] = $datos_inscripcion_cierre[0]->caso_especial;
        } else if ($datos_inscripcion_cierre[0]->estado == 1 and $datos_inscripcion_cierre[0]->estado_descripcion == "Reprueba") {
            //echo "___8.1";exit();
            $arreglo[0]  = '<span class="etiquetaPrograma etiquetaPrograma-reprobado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Reprueba </span>';
            $arreglo[1]  = 0;
            $arreglo[2]  = '<i class="icon-frame icons"></i>';
            $arreglo[3]  = 100;
            $arreglo[4]  = $datos_inscripcion_cierre[0]->avance;
            $arreglo[5]  = $datos_inscripcion_cierre[0]->navegacionminutos;
            $arreglo[6]  = $datos_inscripcion_cierre[0]->estado;
            $arreglo[7]  = $datos_inscripcion_cierre[0]->nota;
            $arreglo[8]  = $datos_inscripcion_cierre[0]->fecha_termino;
            $arreglo[9]  = '<span class="etiquetaPrograma etiquetaPrograma-reprobado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Reprueba </span>';
            $arreglo[10] = $datos_inscripcion_cierre[0]->porcentaje_asistencia;
            $arreglo[11] = '<i class="fa fa-check" aria-hidden="true"></i>';
            $arreglo[12] = 'vr_color_rojo';
            $arreglo[13] = $datos_inscripcion_cierre[0]->caso_especial;
        } else if ($datos_inscripcion_cierre[0]->estado == 1 and $datos_inscripcion_cierre[0]->estado_descripcion == "REPROBADO") {
            //echo "___9.1";exit();
            $arreglo[0]  = '<span class="etiquetaPrograma etiquetaPrograma-reprobado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;REPROBADO </span>';
            $arreglo[1]  = 0;
            $arreglo[2]  = '<i class="icon-frame icons"></i>';
            $arreglo[3]  = 100;
            $arreglo[4]  = $datos_inscripcion_cierre[0]->avance;
            $arreglo[5]  = $datos_inscripcion_cierre[0]->navegacionminutos;
            $arreglo[6]  = $datos_inscripcion_cierre[0]->estado;
            $arreglo[7]  = $datos_inscripcion_cierre[0]->nota;
            $arreglo[8]  = $datos_inscripcion_cierre[0]->fecha_termino;
            $arreglo[9]  = '<span class="etiquetaPrograma etiquetaPrograma-reprobado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;REPROBADO </span>';
            $arreglo[10] = $datos_inscripcion_cierre[0]->porcentaje_asistencia;
            $arreglo[11] = '<i class="fa fa-check" aria-hidden="true"></i>';
            $arreglo[12] = 'vr_color_rojo';
            $arreglo[13] = $datos_inscripcion_cierre[0]->caso_especial;
        }
    }
    return ($arreglo);
}
function ColocaFiltros3Campos($PRINCIPAL, $id_empresa, $arreglo_post)
{
    $datos_empresa = DatosEmpresa($id_empresa);
    $PRINCIPAL     = str_replace("{CAMPO1}", $datos_empresa[0]->campo1, $PRINCIPAL);
    $campo1        = CriteriosParaTablaResumenReporteAvanceParaReportesSGD($id_empresa, $datos_empresa[0]->campo1);
    foreach ($campo1 as $val) {
        if ($arreglo_post[$datos_empresa[0]->campo1] == $val->campo) {
            $options_campo1 .= "<option selected value='" . $val->campo . "'>" . $val->campo . "</option>";
        } else {
            $options_campo1 .= "<option value='" . $val->campo . "'>" . $val->campo . "</option>";
        }
    }
    $PRINCIPAL = str_replace("{OPTIONS_CAMPO1}", utf8_encode($options_campo1), $PRINCIPAL);
    $PRINCIPAL = str_replace("{CAMPO2}", $datos_empresa[0]->campo2, $PRINCIPAL);
    $campo2    = CriteriosParaTablaResumenReporteAvanceParaReportesSGD($id_empresa, $datos_empresa[0]->campo2);
    foreach ($campo2 as $val) {
        if ($arreglo_post[$datos_empresa[0]->campo2] == $val->campo) {
            $options_campo2 .= "<option selected value='" . $val->campo . "'>" . $val->campo . "</option>";
        } else {
            $options_campo2 .= "<option value='" . $val->campo . "'>" . $val->campo . "</option>";
        }
    }
    $PRINCIPAL = str_replace("{OPTIONS_CAMPO2}", utf8_encode($options_campo2), $PRINCIPAL);
    $PRINCIPAL = str_replace("{CAMPO3}", $datos_empresa[0]->campo3, $PRINCIPAL);
    $campo3    = CriteriosParaTablaResumenReporteAvanceParaReportesSGD($id_empresa, $datos_empresa[0]->campo3);
    foreach ($campo3 as $val) {
        if ($arreglo_post[$datos_empresa[0]->campo3] == $val->campo) {
            $options_campo3 .= "<option selected value='" . $val->campo . "'>" . $val->campo . "</option>";
        } else {
            $options_campo3 .= "<option value='" . $val->campo . "'>" . $val->campo . "</option>";
        }
    }
    $PRINCIPAL = str_replace("{OPTIONS_CAMPO3}", utf8_encode($options_campo3), $PRINCIPAL);
    if ($arreglo_post["rutevaluador"] && $arreglo_post["evaluador"]) {
        $PRINCIPAL = str_replace("{FILTRO_RUTEVALUADOR}", $arreglo_post["rutevaluador"], $PRINCIPAL);
        $PRINCIPAL = str_replace("{FILTRO_NOMBREEVALUADOR}", $arreglo_post["evaluador"], $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{FILTRO_RUTEVALUADOR}", "", $PRINCIPAL);
        $PRINCIPAL = str_replace("{FILTRO_NOMBREEVALUADOR}", "", $PRINCIPAL);
    }
    if ($arreglo_post["rutcalibrador"] && $arreglo_post["calibrador"]) {
        $PRINCIPAL = str_replace("{FILTRO_RUTCALIBRADOR}", $arreglo_post["rutcalibrador"], $PRINCIPAL);
        $PRINCIPAL = str_replace("{FILTRO_NOMBRECALIBRADOR}", $arreglo_post["calibrador"], $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{FILTRO_RUTCALIBRADOR}", "", $PRINCIPAL);
        $PRINCIPAL = str_replace("{FILTRO_NOMBRECALIBRADOR}", "", $PRINCIPAL);
    }
    return ($PRINCIPAL);
}
function GraficoArana($matriz)
{
    for ($i = 1; $i <= count($matriz); $i++) {
        $nombres .= "'" . $matriz[$i - 1]["nombre"] . "' ";
        $notas_jefe .= $matriz[$i - 1]["nota"];
        if ($matriz[$i - 1]["nota_ae"]) {
            $notas_ae .= $matriz[$i - 1]["nota_ae"];
        } else {
            $notas_ae .= "0";
        }
        if ($i < count($matriz)) {
            $nombres .= ", ";
            $notas_jefe .= ", ";
            $notas_ae .= ", ";
        }
    }
    $grafico       = file_get_contents("views/sgd/graficos/graficoAranaAeJefe.html");
    $datos_empresa = DatosEmpresa($_SESSION["id_empresa"]);
    $grafico       = str_replace("{COLOR_GRAFICO}", $datos_empresa[0]->color_grafico1, $grafico);
    $grafico       = str_replace("{COMPETENCIAS}", utf8_encode($nombres), $grafico);
    $grafico       = str_replace("{NOTAS_DESCENDENTE}", ($notas_jefe), $grafico);
    //$grafico = str_replace("{NOTAS_AUTOEVALUACION}",utf8_encode($notas_ae),$grafico);
    $grafico       = str_replace("{NOTAS_AUTOEVALUACION}", ($notas_ae), $grafico);
    return ($grafico);
}
function ColocaDatosUsuarioSGD($html, $rut, $texto_mensaje, $rut_evaluador, $id_proceso)
{
    $html           = str_replace("{SECCION_DATOS_USUARIO}", file_get_contents("views/sgd/datos_superior_usuario.html"), $html);
    $datos          = DatosUsuarioConDatosEvaluadorPorProceso($rut, $rut_evaluador, $id_proceso);
    //exit;
    $datos_proceso_ = TraeDatosProcesoAnualDadoProcesoEval($id_proceso);
    if ($datos[0]->nombre_evaluador) {
        //$html = str_replace("{EVALUADOR}",utf8_encode($datos[0]->nombrecompletojefe),$html);
        $html = str_replace("{EVALUADOR}", utf8_encode($datos[0]->nombrecompletojefe), $html);
        $html = str_replace("{CARGO_EVALUADOR}", utf8_encode($datos[0]->cargo_evaluador), $html);
        $html = str_replace("{NOMBRE_CALIBRADOR}", utf8_encode($datos[0]->nombrecompletocalibrador), $html);
        $html = str_replace("{CARGO_CALIBRADOR}", utf8_encode($datos[0]->cargo_calibrador), $html);
        $html = str_replace("{NOMBRE_VALIDADOR}", utf8_encode($datos[0]->nombrecompletovalidador), $html);
        $html = str_replace("{CARGO_VALIDADOR}", utf8_encode($datos[0]->cargo_validador), $html);
        $html = str_replace("{AGNO_PROCESO}", utf8_encode($datos_proceso_[0]->agno_proceso), $html);
    } else {
        $html = str_replace("{EVALUADOR}", "Sin Evaluador", $html);
        $html = str_replace("{CARGO_EVALUADOR}", "Sin Evaluador", $html);
    }
    //SECCION NOMBRE EVALUADO
    if ($datos[0]->nombre && $datos[0]->apaterno && $datos[0]->amaterno) {
        $html = str_replace("{NOMBRE_EVALUADO}", utf8_encode($datos[0]->nombre . " " . $datos[0]->apaterno . " " . $datos[0]->amaterno), $html);
    } else if ($datos[0]->nombre_completo) {
        $html = str_replace("{NOMBRE_EVALUADO}", utf8_encode($datos[0]->nombre_completo), $html);
    } else if ($datos[0]->nombre) {
        $html = str_replace("{NOMBRE_EVALUADO}", utf8_encode($datos[0]->nombre), $html);
    } else {
        $html = str_replace("{NOMBRE_EVALUADO}", "Sin Nombre", $html);
    }
    if ($datos[0]->nombre && $datos[0]->apaterno && $datos[0]->amaterno) {
        $html = str_replace("{NOMBRE}", utf8_encode($datos[0]->nombre . " " . $datos[0]->apaterno . " " . $datos[0]->amaterno), $html);
    } else {
        $html = str_replace("{NOMBRE}", utf8_encode($datos[0]->nombre_completo), $html);
    }
    //SECCION NOMBRE JEFATURA - ESTE SE LEE DESDE LA TABLA TBL_USUARIO, CAMPO JEFE DEL USUARIO
    if ($datos[0]->nombre && $datos[0]->apaterno && $datos[0]->amaterno) {
        $html = str_replace("{NOMBRE_EVALUADO}", utf8_encode($datos[0]->nombre . " " . $datos[0]->apaterno . " " . $datos[0]->amaterno), $html);
    } else {
        $html = str_replace("{NOMBRE_EVALUADO}", utf8_encode($datos[0]->nombre_completo), $html);
    }
    if ($datos[0]->nombre_jefatura_tabla_usuario && $datos[0]->apaterno_jefatura_tabla_usuario && $datos[0]->amaterno_jefatura_tabla_usuario) {
        $html = str_replace("{NOMBRE_JEFATURA_TBL_USUARIO}", utf8_encode($datos[0]->nombre_jefatura_tabla_usuario . " " . $datos[0]->apaterno_jefatura_tabla_usuario . " " . $datos[0]->amaterno_jefatura_tabla_usuario), $html);
    } else {
        $html = str_replace("{NOMBRE_JEFATURA_TBL_USUARIO}", utf8_encode($datos[0]->nombre_completo_jefatura_tabla_usuario), $html);
    }
    //$html = str_replace("{NOMBRE}",utf8_encode($datos[0]->nombre_completo),$html);
    $html = str_replace("{CARGO_EVALUADO}", utf8_encode($datos[0]->cargo), $html);
    $html = str_replace("{CARGO}", utf8_encode($datos[0]->cargo), $html);
    $html = str_replace("{PERFIL_EVALUACION}", utf8_encode($datos[0]->nombre_perfil), $html);
    $html = str_replace("{IMAGEN_EVALUADO}", VerificaFotoPersonal($datos[0]->rut), $html);
    $html = str_replace("{IMG_FOTO}", VerificaFotoPersonal($datos[0]->rut), $html);
    if ($texto_mensaje == 1) {
        $html = str_replace("{MENSAJE}", file_get_contents("views/sgd/validacion/texto_no_validacion.html"), $html);
    } elseif ($texto_mensaje == 2) {
        $html = str_replace("{MENSAJE}", file_get_contents("views/sgd/texto_no_objetivos_jefe.html"), $html);
    } elseif ($texto_mensaje == "bitacora") {
        $html = str_replace("{MENSAJE}", file_get_contents("views/sgd/bitacora/boton_ingreso_formulario.html"), $html);
    } elseif ($texto_mensaje == "planes") {
        $html = str_replace("{MENSAJE}", file_get_contents("views/sgd/planes/boton_ingreso_formulario.html"), $html);
    } elseif ($texto_mensaje == "graficoFrecuenciaCompetencia ") {
        $html = str_replace("{MENSAJE}", "", $html);
    } elseif ($texto_mensaje == "sinmensaje") {
        $html = str_replace("{MENSAJE}", "", $html);
    } else {
        $html = str_replace("{MENSAJE}", "", $html);
    }
    //Verifico si el usuario es JEfe, si es asi, coloca boton Mi Equipo
    $es_evaluador = VerSiEsEvaluador($rut);
    if ($es_evaluador) {
        $html = str_replace("{EQUIPO}", '<a href="?sw=sgd2_e&er=' . Encodear3($rut) . '"><button class="btnver btn-gray btn-sm"><i class="fa fa-users pad_r"></i>Ver Equipo</button></a>', $html);
    } else {
        $html = str_replace("{EQUIPO}", "", $html);
    }
    if (file_exists("docs/dc/" . $rut . ".pdf")) {
        $html = str_replace("{DESCRIPCIONCARGO}", file_get_contents("views/sgd/boton_descripcion_cargo.html"), $html);
        $html = str_replace("{RUT}", $rut, $html);
    } else {
        $html = str_replace("{DESCRIPCIONCARGO}", "", $html);
    }
    return ($html);
}


function ColocarAvanceValidacionDadoRutValidador($PRINCIPAL, $rut_validador, $id_empresa)
{
    $evaluadores                  = TraeEvaluadoresDadoValidadorFijObjetivos($rut_validador, $id_empresa);
    $dimensiones_por_empresa      = DimensionesObjetivosPorEmpresa($id_empresa);
    $total_dimensiones            = 0;
    $total_fijaciones_finalizadas = 0;
    $total_fijaciones_proceso     = 0;
    $total_fijaciones_pendientes  = 0;
    $total_validadas              = 0;
    foreach ($evaluadores as $eva) {
        $total_dimensiones_evaluador            = 0;
        $total_fijaciones_finalizadas_evaluador = 0;
        $total_fijaciones_proceso_evaluador     = 0;
        $total_fijaciones_pendientes_evaluador  = 0;
        //$total_validadas_evaluador=0;
        unset($matriz_estados_generales_validador);
        $row .= file_get_contents("views/sgd/objetivos/row_evaluadores_lista_resumen.html");
        $row       = str_replace("{NOMBRE}", $eva->nombre_completo, $row);
        $row       = str_replace("{CARGO}", $eva->cargo, $row);
        $row       = str_replace("{RUT_EVALUADOR_ENCODEADO}", Encodear3($eva->evaluador), $row);
        $row       = str_replace("{URL_PERSONA}", VerificaFotoPersonal($eva->evaluador), $row);
        //Por cada colaborador, armo el menu de resumen
        $evaluados = TraeRelacionesSinAeSinProceso($eva->evaluador);
        foreach ($evaluados as $rut_eva) {
            //Por cada Evaluado, hago un foreach de dimensiones, y por cada dimension, veo si está finalizada o no
            foreach ($dimensiones_por_empresa as $dimen) {
                $total_dimensiones++;
                $total_dimensiones_evaluador++;
                //Aca verifico si este evaluado para esta dimension está finalizada o no.
                $estado_evaluado = VerificaEstadoDimensionesObjetivos($rut_eva->evaluado, $dimen->id, $id_empresa);
                $estado_validado = VerificaEstadoDimensionesObjetivosParaValidacion($rut_eva->evaluado, $dimen->id, $id_empresa);
                $matriz_estados_generales_validador[0]["total_total"]++;
                $matriz_validados_evaluador[0][total_total]++;
                if ($estado_validado[1] == 3) {
                    $total_validadas_evaluador[$dimen->id]["validadas"]++;
                    $total_fijaciones_validadas++;
                }
                if ($estado_evaluado[1] == 1) {
                    $total_fijaciones_finalizadas++;
                    $total_fijaciones_finalizadas_evaluador++;
                    $matriz_estados_generales_validador[$dimen->id]["estado_ingreso_finalizado"]++;
                }
                if ($estado_evaluado[1] == 2) {
                    $total_fijaciones_proceso++;
                    $total_fijaciones_proceso_evaluador++;
                    $matriz_estados_generales_validador[$dimen->id]["estado_enproceso_fijacion"]++;
                }
                if ($estado_evaluado[1] == 0) {
                    $total_fijaciones_pendientes++;
                    $total_fijaciones_pendientes_evaluador++;
                    $matriz_estados_generales_validador[$dimen->id]["estado_pendiente_fijacion"]++;
                }
            }
        }
        $row_dimensiones = "";
        //echo "echo $total_dimensiones_evaluador
        //<pre>";
        // print_r($matriz_estados_generales_validador);
        foreach ($dimensiones_por_empresa as $dimen) {
            $row_dimensiones .= file_get_contents("views/sgd/objetivos/row_resumen_por_dimension_evaluado.html");
            $row_dimensiones = str_replace("{NOMBRE_DIMENSION}", $dimen->nombre, $row_dimensiones);
            if ($matriz_estados_generales_validador[$dimen->id]["estado_ingreso_finalizado"] == $total_dimensiones_evaluador / 3) {
                $row_dimensiones = str_replace("{ESTADO}", '<span class="etiquetaPrograma etiquetaPrograma-aprobado pull-left"><i class="fas fa-check-square"></i>&nbsp;&nbsp;Ingresado</span>', $row_dimensiones);
            } else if ($matriz_estados_generales_validador[$dimen->id]["estado_enproceso_fijacion"] > 0 or $matriz_estados_generales_validador[$dimen->id]["estado_ingreso_finalizado"] < $total_dimensiones_evaluador) {
                $row_dimensiones = str_replace("{ESTADO}", '<span class="etiquetaPrograma etiquetaPrograma-proceso pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Pendiente</span>', $row_dimensiones);
            } else {
                $row_dimensiones = str_replace("{ESTADO}", '<span class="etiquetaPrograma etiquetaPrograma-pendiente pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Pendiente</span>', $row_dimensiones);
            }
            if ($total_validadas_evaluador[$dimen->id]["validadas"] == $total_dimensiones_evaluador / 3) {
                $row_dimensiones = str_replace("{ESTADO_VALIDACION}", '<span class="etiquetaPrograma etiquetaPrograma-aprobado pull-left"><i class="fas fa-check-square"></i>&nbsp;&nbsp;Validado</span>', $row_dimensiones);
            } else {
                $row_dimensiones = str_replace("{ESTADO_VALIDACION}", '<span class="etiquetaPrograma etiquetaPrograma-pendiente pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Pendiente</span>', $row_dimensiones);
            }
        }
        $row = str_replace("{ROW_RESUMEN_POR_EVALUADO}", $row_dimensiones, $row);
    }
    $PRINCIPAL  = str_replace("{LISTADO_COLABORADORES}", utf8_encode($row), $PRINCIPAL);
    //Avance Validador
    $arreglo[0] = EntregaPorcentaje($total_dimensiones, $total_fijaciones_validadas);
    $PRINCIPAL  = str_replace("{AVANCE_VALIDADOR_ETAPA}", $arreglo[0] . "%", $PRINCIPAL);
    return ($PRINCIPAL);
}
function EnviaCorreoAJefeDesdeValidador($rut_emisor, $rut_destinatario, $id_empresa)
{
    $datos_destinatario = UsuarioEnBasePersonas($destinatario);
    //print_r($datos_destinatario);exit;
    $datos_emisor       = UsuarioEnBasePersonas($rut_emisor);
    $datos_destinatario = UsuarioEnBasePersonas($rut_destinatario);
    $template_correo    = file_get_contents("views/sgd/objetivos/correos/email_a_jefe_de_validador.html");
    $template_correo    = str_replace("{NOMBRE_JEFE}", utf8_encode($datos_destinatario[0]->nombre_completo), $template_correo);
    $template_correo    = str_replace("{NOMBRE_DEL_JEFE_DE_JEFE}", utf8_encode($datos_emisor[0]->nombre_completo), $template_correo);
    $template_correo    = str_replace("{texto_mensaje}", utf8_encode($mensaje), $template_correo);
    $asunto_mensaje     = TraeAsuntoDeMensaje($tipo_mensaje);
    $datos_empresa      = DatosEmpresa($id_empresa);
    $mail               = new PHPMailer;
    //Tell PHPMailer to use SMTP
    $mail->isSMTP(); //Enable SMTP debugging
    // 0 = off (for production use)
    // 1 = client messages
    // 2 = client and server messages
    $mail->SMTPDebug   = 1;
    //Ask for HTML-friendly debug output
    $mail->Debugoutput = 'error_log';
    //Set the hostname of the mail server
    $mail->Host        = $datos_empresa[0]->server;
    //Set the SMTP port number - likely to be 25, 465 or 587
    $mail->Port        = 25;
    //Whether to use SMTP authentication
    $mail->SMTPAuth    = true;
    //Username to use for SMTP authentication
    $mail->Username    = $datos_empresa[0]->envio_correos;
    //Password to use for SMTP authentication
    $mail->Password    = $datos_empresa[0]->envio_correos_pass;
    //Set who the message is to be sent from
    $mail->setFrom($datos_empresa[0]->envio_correos, $datos_empresa[0]->envio_correos);
    //Set an alternative reply-to address
    //$mail->addReplyTo('replyto@example.com', 'First Last');
    //Set who the message is to be sent to
    //$mail->addAddress($datos_destinatario[0]->email, $datos_destinatario[0]->nombre_completo);
    $mail->addAddress("daniel@gop.cl", $datos_destinatario[0]->nombre_completo);
    //$mail->addAddress("rod@gop.cl", $datos_destinatario[0]->nombre_completo);
    //$mail->addAddress("francisco.lopez@tnt.com", $datos_destinatario[0]->nombre_completo);
    //$mail->addAddress("rod@gop.cl", $datos_destinatario[0]->nombre_completo);
    $mail->AddBCC("backup@sgd.cl", "BCC: " . $datos_destinatario[0]->nombre_completo);
    //Set the subject line
    $mail->Subject = "" . $datos_emisor[0]->nombre_completo . " ha validado tu Fijacion de Objetivos";
    //Read an HTML message body from an external file, convert referenced images to embedded,
    //convert HTML into a basic plain-text alternative body
    $mail->msgHTML($template_correo, dirname(__FILE__));
    //Replace the plain text body with one created manually
    $mail->AltBody = 'Si no puedes visualizar este correo ....';
    //Attach an image file
    //$mail->addAttachment('images/phpmailer_mini.png');
    //send the message, check for errors
    if (!$mail->send()) {
        //echo "Mailer Error: " . $mail->ErrorInfo;
    } else {
        //echo "Message sent!";
    }
    //exit;
}
function EnviaCorreoAJefeDelJefeParaValidar($rut_emisor, $rut_destinatario, $id_empresa)
{
    $datos_destinatario = UsuarioEnBasePersonas($destinatario);
    //print_r($datos_destinatario);exit;
    $datos_emisor       = UsuarioEnBasePersonas($rut_emisor);
    $datos_destinatario = UsuarioEnBasePersonas($rut_destinatario);
    $template_correo    = file_get_contents("views/sgd/objetivos/correos/email_a_jefe_de_jefe.html");
    $template_correo    = str_replace("{NOMBRE_JEFE}", utf8_encode($datos_emisor[0]->nombre_completo), $template_correo);
    $template_correo    = str_replace("{NOMBRE_DEL_JEFE_DE_JEFE}", utf8_encode($datos_destinatario[0]->nombre_completo), $template_correo);
    $template_correo    = str_replace("{texto_mensaje}", utf8_encode($mensaje), $template_correo);
    $asunto_mensaje     = TraeAsuntoDeMensaje($tipo_mensaje);
    $datos_empresa      = DatosEmpresa($id_empresa);
    $mail               = new PHPMailer;
    //Tell PHPMailer to use SMTP
    $mail->isSMTP(); //Enable SMTP debugging
    // 0 = off (for production use)
    // 1 = client messages
    // 2 = client and server messages
    $mail->SMTPDebug   = 1;
    //Ask for HTML-friendly debug output
    $mail->Debugoutput = 'error_log';
    //Set the hostname of the mail server
    $mail->Host        = $datos_empresa[0]->server;
    //Set the SMTP port number - likely to be 25, 465 or 587
    $mail->Port        = 25;
    //Whether to use SMTP authentication
    $mail->SMTPAuth    = true;
    //Username to use for SMTP authentication
    $mail->Username    = $datos_empresa[0]->envio_correos;
    //Password to use for SMTP authentication
    $mail->Password    = $datos_empresa[0]->envio_correos_pass;
    //Set who the message is to be sent from
    $mail->setFrom($datos_empresa[0]->envio_correos, $datos_empresa[0]->envio_correos);
    //Set an alternative reply-to address
    //$mail->addReplyTo('replyto@example.com', 'First Last');
    //Set who the message is to be sent to
    //$mail->addAddress($datos_destinatario[0]->email, $datos_destinatario[0]->nombre_completo);
    $mail->addAddress("daniel@gop.cl", $datos_destinatario[0]->nombre_completo);
    //$mail->addAddress("rod@gop.cl", $datos_destinatario[0]->nombre_completo);
    //$mail->addAddress("francisco.lopez@tnt.com", $datos_destinatario[0]->nombre_completo);
    //$mail->addAddress("rod@gop.cl", $datos_destinatario[0]->nombre_completo);
    $mail->AddBCC("backup@sgd.cl", "BCC: " . $datos_destinatario[0]->nombre_completo);
    //Set the subject line
    $mail->Subject = "" . $datos_emisor[0]->nombre_completo . " solicita validar Fijacion de Objetivos";
    //Read an HTML message body from an external file, convert referenced images to embedded,
    //convert HTML into a basic plain-text alternative body
    $mail->msgHTML($template_correo, dirname(__FILE__));
    //Replace the plain text body with one created manually
    $mail->AltBody = 'Si no puedes visualizar este correo ....';
    //Attach an image file
    //$mail->addAttachment('images/phpmailer_mini.png');
    //send the message, check for errors
    if (!$mail->send()) {
        //echo "Mailer Error: " . $mail->ErrorInfo;
    } else {
        //echo "Message sent!";
    }
    //exit;
}
function ComboBoxConductasCriticasDadoPerfilYCompetencias($id_perfil, $competencia, $conducta_seleccionada)
{
    $conducta = TraeConductasDadaIdCompetencia($competencia, $id_perfil);
    foreach ($conducta as $con) {
        if ($conducta_seleccionada == $con->id_conducta) {
            $options .= "<option selected value='" . $con->id_conducta . "'>" . $con->conducta . "</option>";
        } else {
            $options .= "<option value='" . $con->id_conducta . "'>" . $con->conducta . "</option>";
        }
    }
    return ($options);
}
function ComboBoxCompetenciasPorPerfil($id_perfil, $seleccionado)
{
    $competencias = CompetenciasDadoPerfilParaObjetivos($id_perfil);
    foreach ($competencias as $comp) {
        if ($seleccionado == $comp->id_componente_reporte) {
            $options .= "<option selected value='" . $comp->id_componente_reporte . "'>" . $comp->nombre . "</option>";
        } else {
            $options .= "<option value='" . $comp->id_componente_reporte . "'>" . $comp->nombre . "</option>";
        }
    }
    return ($options);
}
function VerificaEstadoDimensionesObjetivosParaValidacion($evaluado, $id_dimension, $id_empresa)
{
    //Verifico si se encuentra validado
    $objetivos_por_dimension_validados = VerificaSiObjetivosEstanValidadosPorDimension($evaluado, $id_dimension, $id_empresa);
    if ($objetivos_por_dimension_validados) {
        $arreglo[0] = '<span class="etiquetaPrograma etiquetaPrograma-aprobado pull-left"><i class="fas fa-check-square"></i>&nbsp;&nbsp;Validado</span>';
        $arreglo[1] = 3;
    } else {
        $datos_finalizado = VerificaDimensionFinalizadaObjetivos($evaluado, $id_dimension, $id_empresa);
        $arreglo[0]       = '<span class="etiquetaPrograma etiquetaPrograma-pendiente pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Pendiente</span>';
        $arreglo[1]       = 2;
    }
    return ($arreglo);
}
function FormularioValidacionObjetivosV2($PRINCIPAL, $rut_fijador, $rut_evaluado, $id_empresa, $id_proceso, $id_objetivo, $rut_validador)
{
    $muestra_boton_envia_a_jefe = 0;
    //$datos_evaluado=UsuarioEnBasePersonas($rut_evaluado);
    $datos_evaluado             = UsuarioEnBasePersonasConEvaluadorValidador($rut_evaluado);
    $dimensiones_por_empresa    = DimensionesObjetivosPorEmpresa($id_empresa);
    $PRINCIPAL                  = str_replace("{BLOQUE_RESUMEN_COLABORADOR}", file_get_contents("views/sgd/objetivos/row_colaboradores_lista_resumen_superior.html"), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{NOMBRE}", utf8_encode($datos_evaluado[0]->nombre_completo), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{PERFIL_COMPETENCIAS}", utf8_encode($datos_evaluado[0]->perfil_competencia), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{JEFE}", utf8_encode($datos_evaluado[0]->nombre_evaluador), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{JEFE_DEL_JEFE}", utf8_encode($datos_evaluado[0]->nombre_validador), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{CARGO}", utf8_encode($datos_evaluado[0]->cargo), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{FECHA_INGRESO}", utf8_encode($datos_evaluado[0]->fecha_ingreso), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{URL_PERSONA}", VerificaFotoPersonal($rut_evaluado), $PRINCIPAL);
    $row_dimensiones            = "";
    foreach ($dimensiones_por_empresa as $dimen) {
        $row_dimensiones .= file_get_contents("views/sgd/objetivos/row_resumen_por_dimension_evaluado.html");
        $row_dimensiones             = str_replace("{NOMBRE_DIMENSION}", $dimen->nombre, $row_dimensiones);
        $estado_dimension            = VerificaEstadoDimensionesObjetivos($rut_evaluado, $dimen->id, $id_empresa);
        $row_dimensiones             = str_replace("{ESTADO}", $estado_dimension[0], $row_dimensiones);
        $estado_dimension_validacion = VerificaEstadoDimensionesObjetivosParaValidacion($rut_evaluado, $dimen->id, $id_empresa);
        $row_dimensiones             = str_replace("{ESTADO_VALIDACION}", $estado_dimension_validacion[0], $row_dimensiones);
    }
    $PRINCIPAL = str_replace("{ROW_RESUMEN_POR_EVALUADO}", utf8_encode($row_dimensiones), $PRINCIPAL);
    //Por cada dimension, armo el formulario
    foreach ($dimensiones_por_empresa as $dimen) {
        //$estado_dimension=VerificaEstadoDimensionesObjetivos($rut_evaluado, $dimen->id, $id_empresa);
        $estado_dimension = VerificaEstadoDimensionesObjetivosParaValidacion($rut_evaluado, $dimen->id, $id_empresa);
        if ($estado_dimension[1] <> 3) {
            $formularios .= file_get_contents("views/sgd/objetivos/dimensiones/" . $dimen->template);
            $row_html = file_get_contents("views/sgd/objetivos/dimensiones/" . $dimen->row);
            $dimensiones_finalizadas++;
        } else {
            $formularios .= file_get_contents("views/sgd/objetivos/dimensiones/" . $dimen->template_lectura);
            $row_html = file_get_contents("views/sgd/objetivos/dimensiones/" . $dimen->row_lectura);
        }
        //$formularios.=file_get_contents("views/sgd/objetivos/dimensiones/".$dimen->template);
        //$row_html=file_get_contents("views/sgd/objetivos/dimensiones/".$dimen->row);
        //Aca veo si hay comentarios de esta dimension o no
        $tiene_comentarios = VerificaComentariosPorDimension($rut_fijador, $rut_evaluado, $dimen->id, $id_empresa);
        if ($tiene_comentarios) {
            $formularios = str_replace("{VALUE_ACCIONES_REALIZADAS}", utf8_encode($tiene_comentarios[0]->acciones_realizadas), $formularios);
            $formularios = str_replace("{VALUE_IMPACTO}", utf8_encode($tiene_comentarios[0]->impacto), $formularios);
            $formularios = str_replace("{CASE_FORM_COMEN_DIMENSION}", "updComDim", $formularios);
        } else {
            $formularios = str_replace("{VALUE_ACCIONES_REALIZADAS}", "", $formularios);
            $formularios = str_replace("{VALUE_IMPACTO}", "", $formularios);
            $formularios = str_replace("{CASE_FORM_COMEN_DIMENSION}", "saveComDim", $formularios);
        }
        $formularios               = str_replace("{NUMERO}", $dimen->orden, $formularios);
        $formularios               = str_replace("{NOMBRE_DIMENSION}", utf8_encode($dimen->nombre), $formularios);
        $formularios               = str_replace("{CASE_FORM}", $dimen->case . "&val=1", $formularios);
        //$formularios = str_replace("{BOTON1}",file_get_contents("views/sgd/objetivos/BotonJefeJefeValida.html"),$formularios);
        $formularios               = str_replace("{BOTON1}", "", $formularios);
        $formularios               = str_replace("{ID_DIMENSION_ENCODEADO}", $dimen->id, $formularios);
        $formularios               = str_replace("{OPTIONS_PONDERACIONES}", PondObjetivos2(""), $formularios);
        $formularios               = str_replace("{OPTIONS_COMPETENCIAS}", utf8_encode(ComboBoxCompetenciasPorPerfil($datos_evaluado[0]->id_perfil_competencia, "")), $formularios);
        //Por cada formulario, veo si existen objetivos ingresados en esta dimension
        //$objetivos_ingresados=ObjetivosPodDimensionEmpresaUsuario($rut_evaluado, $id_empresa, $dimen->id);
        //Por cada formulario, veo si existen objetivos ingresados en esta dimension
        $objetivos_ingresados      = ObjetivosPodDimensionEmpresaUsuario($rut_evaluado, $id_empresa, $dimen->id, $datos_evaluado[0]->id_perfil_competencia);
        $suma_objetivos_ingresados = ObjetivosPodDimensionEmpresaUsuarioSumaPonderacion($rut_evaluado, $id_empresa, $dimen->id);
        if ($dimen->tiene_ponderacion == 1) {
            if (count($objetivos_ingresados) >= $dimen->minimo && count($objetivos_ingresados) <= $dimen->maximo && $suma_objetivos_ingresados[0]->suma_ponderaciones == 100) {
                $muestra_boton_envia_a_jefe++;
            }
        } else {
            if (count($objetivos_ingresados) >= $dimen->minimo && count($objetivos_ingresados) <= $dimen->maximo) {
                $muestra_boton_envia_a_jefe++;
            }
        }
        if ($objetivos_ingresados) {
            $formularios                = str_replace("{BLOQUE_LISTADO_OBJETIVOS_INGRESADOS}", file_get_contents("views/sgd/objetivos/dimensiones/" . $dimen->entornoLecturaForm), $formularios);
            $total_objetivos_ingresados = "";
            $k                          = 0;
            $suma_ponderacion           = 0;
            foreach ($objetivos_ingresados as $obj_ing) {
                $k++;
                //$total_objetivos_ingresados.=file_get_contents("views/sgd/objetivos/dimensiones/".$dimen->row);
                if ($id_objetivo == $obj_ing->id) {
                    $total_objetivos_ingresados .= file_get_contents("views/sgd/objetivos/dimensiones/edita_" . $dimen->row);
                } else {
                    $total_objetivos_ingresados .= $row_html;
                }
                //$total_objetivos_ingresados.=$row_html;
                $total_objetivos_ingresados = str_replace("{NUMERO}", $k, $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{ID_DIMENSION}", $dimen->id, $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{ID_DIMENSION_ENCODEADA}", Encodear3($dimen->id), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{PARAMETROS_VAL}", "&rval=" . $rut_validador, $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{OBJETIVO}", utf8_encode($obj_ing->descripcion_objetivo), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{ID_OBJETIVO_ENCODEADO}", Encodear3($obj_ing->id), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{ID_OBJETIVO}", ($obj_ing->id), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{ACCION}", utf8_encode($obj_ing->accion_clave), $total_objetivos_ingresados);
                //$total_objetivos_ingresados = str_replace("{CONDUCTA_CRITICA}",utf8_encode($obj_ing->conducta_critica),$total_objetivos_ingresados);
                //$total_objetivos_ingresados = str_replace("{CONDUCTA_CRITICA}",utf8_encode($obj_ing->nombre_competencia),$total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{CONDUCTA_CRITICA}", utf8_encode($obj_ing->nombre_conducta), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{COMPETENCIA}", utf8_encode($obj_ing->nombre_competencia), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{COMENTARIO}", utf8_encode($obj_ing->comentarios), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{ACCION_DESARROLLO}", utf8_encode($obj_ing->acciones_desarrollo), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{RESPONSABLE}", utf8_encode($obj_ing->responsable), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{FECHA}", utf8_encode($obj_ing->fecha_limite), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{ENV_EDITAR}", "updobjetivoV2Val", $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{PONDERACION}", utf8_encode($obj_ing->ponderacion) . "%", $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{OPTIONS_PONDERACIONES_INGRESADO}", PondObjetivos2($obj_ing->ponderacion) . "%", $total_objetivos_ingresados);
                //$total_objetivos_ingresados  = str_replace("{OPTIONS_COMPETENCIAS_INGRESADO}",utf8_encode(ComboBoxCompetenciasPorPerfil($datos_evaluado[0]->id_perfil_competencia, $obj_ing->conducta_critica)),$total_objetivos_ingresados );
                $total_objetivos_ingresados = str_replace("{OPTIONS_COMPETENCIAS_INGRESADO}", utf8_encode(ComboBoxCompetenciasPorPerfil($datos_evaluado[0]->id_perfil_competencia, $obj_ing->competencia)), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{OPTIONS_CONDUCTAS_CRITICAS}", utf8_encode(ComboBoxConductasCriticasDadoPerfilYCompetencias($datos_evaluado[0]->id_perfil_competencia, $obj_ing->competencia, $obj_ing->conducta_critica)), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{ACCIONES_REALIZADAS}", utf8_encode($obj_ing->acciones_realizadas), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{IMPACTO}", utf8_encode($obj_ing->impacto), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{TIPO_ACCION}", utf8_encode($obj_ing->tipo_accion), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{SELECTED_" . utf8_encode($obj_ing->tipo_accion) . "}", "selected", $total_objetivos_ingresados);
                $suma_ponderacion           = $suma_ponderacion + $obj_ing->ponderacion;
            }
            $formularios = str_replace("{ROW_INGRESADOS}", $total_objetivos_ingresados, $formularios);
            $formularios = str_replace("{TOTAL_PONDERACION}", $suma_ponderacion . "%", $formularios);
            $formularios = str_replace("{ID_PERFIL_COMPETENCIAS}", $datos_evaluado[0]->id_perfil_competencia, $formularios);
            if ($suma_ponderacion == 100) {
                $formularios = str_replace("{CLASE_PONDERACION}", "pond_correcto", $formularios);
            } else {
                $formularios = str_replace("{CLASE_PONDERACION}", "pond_alerta", $formularios);
            }
        } else {
            $formularios = str_replace("{ROW_INGRESADOS}", "NO", $formularios);
        }
    }
    //$PRINCIPAL = str_replace("{BOTON_ENVIA_A_VALIDAR_OBJETIVOS}",file_get_contents("views/sgd/objetivos/BotonJefeJefeValida.html"),$PRINCIPAL);
    if ($muestra_boton_envia_a_jefe == count($dimensiones_por_empresa) && $estado_dimension[1] <> 3) {
        $PRINCIPAL = str_replace("{BOTON_ENVIA_A_VALIDAR_OBJETIVOS}", file_get_contents("views/sgd/objetivos/BotonJefeJefeValida.html"), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BOTON_ENVIA_A_VALIDAR_OBJETIVOS}", "", $PRINCIPAL);
    }
    $PRINCIPAL = str_replace("{NUMERO_PASO}", count($dimensiones_por_empresa) + 1, $PRINCIPAL);
    $PRINCIPAL = str_replace("{BLOQUE_FORMULARIOS_POR_DIMENSIONES}", $formularios, $PRINCIPAL);
    $PRINCIPAL = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($rut_evaluado), $PRINCIPAL);
    return ($PRINCIPAL);
}
function LimpiaRutFront($rut)
{
    $rut         = str_replace(".", "", $rut);
    $arreglo_rut = explode("-", $rut);
    $rut         = intval(preg_replace('/[^0-9]+/', '', $arreglo_rut[0]), 10);
    return ($rut);
}
function ColocaJefaturasDadoValidador($PRINCIPAL, $rut_validador, $id_empresa)
{
    //$evaluados=TraeRelacionesSinAeSinProceso($rut_fijador);
    $evaluadores                  = TraeEvaluadoresDadoValidadorFijObjetivos($rut_validador, $id_empresa);
    $dimensiones_por_empresa      = DimensionesObjetivosPorEmpresa($id_empresa);
    $total_dimensiones            = 0;
    $total_fijaciones_finalizadas = 0;
    $total_fijaciones_proceso     = 0;
    $total_fijaciones_pendientes  = 0;
    $total_validadas              = 0;
    foreach ($evaluadores as $eva) {
        $total_dimensiones_evaluador            = 0;
        $total_fijaciones_finalizadas_evaluador = 0;
        $total_fijaciones_proceso_evaluador     = 0;
        $total_fijaciones_pendientes_evaluador  = 0;
        //$total_validadas_evaluador=0;
        //Esta es para cada evaluador, por eso se limpia en cada vuelta
        unset($matriz_estados_generales_validador);
        $row .= file_get_contents("views/sgd/objetivos/row_evaluadores_lista_resumen.html");
        $row       = str_replace("{NOMBRE}", $eva->nombre_completo, $row);
        $row       = str_replace("{CARGO}", $eva->cargo, $row);
        $row       = str_replace("{RUT_EVALUADOR_ENCODEADO}", Encodear3($eva->evaluador), $row);
        $row       = str_replace("{URL_PERSONA}", VerificaFotoPersonal($eva->evaluador), $row);
        //Por cada colaborador, armo el menu de resumen
        $evaluados = TraeRelacionesSinAeSinProceso($eva->evaluador);
        foreach ($evaluados as $rut_eva) {
            //Por cada Evaluado, hago un foreach de dimensiones, y por cada dimension, veo si está finalizada o no
            foreach ($dimensiones_por_empresa as $dimen) {
                $total_dimensiones++;
                $total_dimensiones_evaluador++;
                //Aca verifico si este evaluado para esta dimension está finalizada o no.
                $estado_evaluado = VerificaEstadoDimensionesObjetivos($rut_eva->evaluado, $dimen->id, $id_empresa);
                $estado_validado = VerificaEstadoDimensionesObjetivosParaValidacion($rut_eva->evaluado, $dimen->id, $id_empresa);
                $matriz_estados_generales_validador[0]["total_total"]++;
                $matriz_validados_evaluador[0][total_total]++;
                $matriz_estados_generales_validador[$dimen->id]["total_por_dimension"]++;
                if ($estado_validado[1] == 3) {
                    $total_validadas_evaluador[$dimen->id]["validadas"]++;
                    $total_fijaciones_validadas++;
                }
                if ($estado_evaluado[1] == 1) {
                    $total_fijaciones_finalizadas++;
                    $total_fijaciones_finalizadas_evaluador++;
                    $matriz_estados_generales_validador[$dimen->id]["estado_ingreso_finalizado"]++;
                }
                if ($estado_evaluado[1] == 2) {
                    $total_fijaciones_proceso++;
                    $total_fijaciones_proceso_evaluador++;
                    $matriz_estados_generales_validador[$dimen->id]["estado_enproceso_fijacion"]++;
                }
                if ($estado_evaluado[1] == 0) {
                    $total_fijaciones_pendientes++;
                    $total_fijaciones_pendientes_evaluador++;
                    $matriz_estados_generales_validador[$dimen->id]["estado_pendiente_fijacion"]++;
                }
            }
        }
        $row_dimensiones = "";
        //echo "echo $total_dimensiones_evaluador
        //<pre>";
        // print_r($matriz_estados_generales_validador);
        foreach ($dimensiones_por_empresa as $dimen) {
            $row_dimensiones .= file_get_contents("views/sgd/objetivos/row_resumen_por_dimension_evaluado.html");
            $row_dimensiones = str_replace("{NOMBRE_DIMENSION}", $dimen->nombre, $row_dimensiones);
            if ($matriz_estados_generales_validador[$dimen->id]["estado_ingreso_finalizado"] == $total_dimensiones_evaluador / count($dimensiones_por_empresa)) {
                //if($matriz_estados_generales_validador[$dimen->id]["estado_ingreso_finalizado"]==$matriz_estados_generales_validador[$dimen->id]["total_por_dimension"]){
                $row_dimensiones = str_replace("{ESTADO}", '<span class="etiquetaPrograma etiquetaPrograma-aprobado pull-left"><i class="fas fa-check-square"></i>&nbsp;&nbsp;Ingresado</span>', $row_dimensiones);
            } else if ($matriz_estados_generales_validador[$dimen->id]["estado_enproceso_fijacion"] > 0 or $matriz_estados_generales_validador[$dimen->id]["estado_ingreso_finalizado"] < $total_dimensiones_evaluador) {
                $row_dimensiones = str_replace("{ESTADO}", '<span class="etiquetaPrograma etiquetaPrograma-proceso pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Pendiente</span>', $row_dimensiones);
            } else {
                $row_dimensiones = str_replace("{ESTADO}", '<span class="etiquetaPrograma etiquetaPrograma-pendiente pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Pendiente</span>', $row_dimensiones);
            }
            if ($total_validadas_evaluador[$dimen->id]["validadas"] == $total_dimensiones_evaluador / count($dimensiones_por_empresa)) {
                $row_dimensiones = str_replace("{ESTADO_VALIDACION}", '<span class="etiquetaPrograma etiquetaPrograma-aprobado pull-left"><i class="fas fa-check-square"></i>&nbsp;&nbsp;Validado</span>', $row_dimensiones);
            } else {
                $row_dimensiones = str_replace("{ESTADO_VALIDACION}", '<span class="etiquetaPrograma etiquetaPrograma-pendiente pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Pendiente</span>', $row_dimensiones);
            }
        }
        //print_r($matriz_estados_generales_validador);echo "<br>";
        $row = str_replace("{ROW_RESUMEN_POR_EVALUADO}", $row_dimensiones, $row);
    }
    //echo "total dimensiones $total_dimensiones total dimensiones evaluador $total_dimensiones_evaluador";
    $PRINCIPAL = str_replace("{LISTADO_COLABORADORES}", utf8_encode($row), $PRINCIPAL);
    $PRINCIPAL = str_replace("{AVANCE_EVALUADOS}", EntregaPorcentaje($total_dimensiones, $total_fijaciones_validadas), $PRINCIPAL);
    $PRINCIPAL = str_replace("{AVANCE_VALIDADOR}", EntregaPorcentaje($total_dimensiones, $total_fijaciones_validadas) . "%", $PRINCIPAL);
    //print_r($total_validadas_evaluador);
    foreach ($dimensiones_por_empresa as $dimen) {
        $row_dimensiones_gen .= file_get_contents("views/sgd/objetivos/row_resumen_por_dimension.html");
        $row_dimensiones_gen = str_replace("{NOMBRE_DIMENSION}", $dimen->nombre, $row_dimensiones_gen);
        $row_dimensiones_gen = str_replace("{AVANCE_DIMENSION}", EntregaPorcentaje($total_dimensiones, $total_fijaciones_finalizadas), $row_dimensiones_gen);
        $row_dimensiones_gen = str_replace("{AVANCE_DIMENSION_VALIDACION}", EntregaPorcentaje($total_dimensiones, $total_fijaciones_validadas), $row_dimensiones_gen);
    }
    //echo "total $total_dimensiones, total finalizadas $total_fijaciones_finalizadas, total en proceso $total_fijaciones_proceso , total pendientes $total_fijaciones_pendientes";
    $PRINCIPAL = str_replace("{ROW_LISTADO_RESUMEN}", utf8_encode($row_dimensiones_gen), $PRINCIPAL);
    return ($PRINCIPAL);
}
function VerificaEstadoDimensionesObjetivos($evaluado, $id_dimension, $id_empresa)
{
    $datos_finalizado = VerificaDimensionFinalizadaObjetivos($evaluado, $id_dimension, $id_empresa);
    if ($datos_finalizado) {
        $arreglo[0] = '<span class="etiquetaPrograma etiquetaPrograma-aprobado pull-left"><i class="fas fa-check-square"></i>&nbsp;&nbsp;Ingresado</span>';
        $arreglo[1] = 1;
    } else {
        //Veo si tiene 1 objetivo ingresado
        $objetivo_por_dimension = ObjetivosPodDimensionEmpresaUsuario($evaluado, $id_empresa, $id_dimension);
        if (count($objetivo_por_dimension) > 0) {
            if ($id_empresa == 76 or $id_empresa == 61) {
                $arreglo[0] = '<span class="etiquetaPrograma etiquetaPrograma-proceso pull-left"><i class="fas fa-spinner"></i>&nbsp;En Proceso</span>';
                $arreglo[1] = 2;
            } else {
                $arreglo[0] = '<span class="etiquetaPrograma etiquetaPrograma-pendiente pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Pendiente</span>';
                $arreglo[1] = 2;
            }
        } else {
            $arreglo[0] = '<span class="etiquetaPrograma etiquetaPrograma-pendiente pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Pendiente</span>';
            $arreglo[1] = 0;
        }
    }
    return ($arreglo);
}
function FormularioIngresoObjetivosV2($PRINCIPAL, $rut_fijador, $rut_evaluado, $id_empresa, $id_proceso, $id_objetivo, $rut_validador, $tipo_reporte, $tipo_proceso_objetivos, $tipo_vista)
{
    $muestra_boton_envia_a_jefe = 0;
    //$datos_evaluado=UsuarioEnBasePersonas($rut_evaluado);
    $datos_evaluado             = UsuarioEnBasePersonasConEvaluadorValidador($rut_evaluado);
    $dimensiones_por_empresa    = DimensionesObjetivosPorEmpresa($id_empresa);
    if ($tipo_reporte == "pdf") {
        $PRINCIPAL = str_replace("{BLOQUE_RESUMEN_COLABORADOR}", file_get_contents("views/sgd/objetivos/row_colaboradores_lista_resumen_superior_pdf.html"), $PRINCIPAL);
        //$codigo_barra=new barCodeGenrator("201601".$datos_evaluado[0]->rut_completo,0,'hello.gif', 190, 130, true);
        //$PRINCIPAL = str_replace("{CODIGO_INFORME}",$codigo_barra,$PRINCIPAL);
        $PRINCIPAL = str_replace("{CODIGO_INFORME}", "201601" . $datos_evaluado[0]->rut_completo, $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BLOQUE_RESUMEN_COLABORADOR}", file_get_contents("views/sgd/objetivos/" . $id_empresa . "_row_colaboradores_lista_resumen_superior.html"), $PRINCIPAL);
    }
    $PRINCIPAL       = str_replace("{RUT_COMPLETO}", utf8_encode($datos_evaluado[0]->rut_completo), $PRINCIPAL);
    $PRINCIPAL       = str_replace("{NOMBRE}", utf8_encode($datos_evaluado[0]->nombre_completo), $PRINCIPAL);
    $PRINCIPAL       = str_replace("{PERFIL_COMPETENCIAS}", utf8_encode($datos_evaluado[0]->perfil_competencia), $PRINCIPAL);
    $PRINCIPAL       = str_replace("{FECHA_INGRESO}", formatearFechaCompleta($datos_evaluado[0]->fecha_ingreso), $PRINCIPAL);
    $PRINCIPAL       = str_replace("{JEFE}", utf8_encode($datos_evaluado[0]->nombre_evaluador), $PRINCIPAL);
    $PRINCIPAL       = str_replace("{JEFE_DEL_JEFE}", utf8_encode($datos_evaluado[0]->nombre_validador), $PRINCIPAL);
    $PRINCIPAL       = str_replace("{CARGO}", utf8_encode($datos_evaluado[0]->cargo), $PRINCIPAL);
    $PRINCIPAL       = str_replace("{GERENCIA}", utf8_encode($datos_evaluado[0]->gerencia), $PRINCIPAL);
    $PRINCIPAL       = str_replace("{DEPARTAMENTO}", utf8_encode($datos_evaluado[0]->departamento), $PRINCIPAL);
    $PRINCIPAL       = str_replace("{GRUPO_COMPETENCIAS}", utf8_encode($datos_evaluado[0]->perfil_competencia), $PRINCIPAL);
    $PRINCIPAL       = str_replace("{URL_PERSONA}", VerificaFotoPersonal($rut_evaluado), $PRINCIPAL);
    $row_dimensiones = "";
    foreach ($dimensiones_por_empresa as $dimen) {
        $row_dimensiones .= file_get_contents("views/sgd/objetivos/" . $id_empresa . "_row_resumen_por_dimension_evaluado.html");
        $row_dimensiones             = str_replace("{NOMBRE_DIMENSION}", $dimen->nombre, $row_dimensiones);
        $estado_dimension            = VerificaEstadoDimensionesObjetivos($rut_evaluado, $dimen->id, $id_empresa);
        $row_dimensiones             = str_replace("{ESTADO}", $estado_dimension[0], $row_dimensiones);
        $estado_dimension_validacion = VerificaEstadoDimensionesObjetivosParaValidacion($rut_evaluado, $dimen->id, $id_empresa);
        $row_dimensiones             = str_replace("{ESTADO_VALIDACION}", $estado_dimension_validacion[0], $row_dimensiones);
        $estado_ingresado            = VerificaEstadoDimensionesObjetivosIngresados($rut_evaluado, $dimen->id, $id_empresa);
        $row_dimensiones             = str_replace("{ESTADO_INGRESO}", $estado_ingresado[0], $row_dimensiones);
    }
    $PRINCIPAL = str_replace("{ROW_RESUMEN_POR_EVALUADO}", utf8_encode($row_dimensiones), $PRINCIPAL);
    //Por cada dimension, armo el formulario
    if ($id_empresa == 61) {
        if ($tipo_reporte == "pdf") {
            $formularios .= file_get_contents("views/sgd/objetivos/dimensiones/formulario_resultados_negocio_pdf.html");
            $formularios .= file_get_contents("views/sgd/objetivos/dimensiones/61_titulo_resultado_individuales_pdf.html");
        } else {
            $formularios .= file_get_contents("views/sgd/objetivos/dimensiones/formulario_resultados_negocio.html");
            $formularios .= file_get_contents("views/sgd/objetivos/dimensiones/61_titulo_resultado_individuales.html");
        }
    }
    foreach ($dimensiones_por_empresa as $dimen) {
        $estado_dimension                        = VerificaEstadoDimensionesObjetivos($rut_evaluado, $dimen->id, $id_empresa);
        $vista_lectura_para_colaborador_fijacion = "";
        if ($estado_dimension[1] == 1) {
            if ($tipo_reporte == "pdf") {
                $formularios .= file_get_contents("views/sgd/objetivos/dimensiones/pdf_" . $dimen->template_lectura);
                $row_html = file_get_contents("views/sgd/objetivos/dimensiones/pdf_" . $dimen->row_lectura);
                //echo "1.1";
            } else {
                if ($id_empresa == 76 && $rut_fijador <> $rut_evaluado) {
                    //aca ya esta finalizada, veo si está validado o no
                    $objetivos_validados_por_dimension = VerificaSiObjetivosEstanValidadosPorDimension($rut_evaluado, $dimen->id, $id_empresa);
                    if ($objetivos_validados_por_dimension && $tipo_vista <> "prop") {
                        //$formularios.=file_get_contents("views/sgd/objetivos/dimensiones/".$dimen->template_lectura);
                        //$row_html=file_get_contents("views/sgd/objetivos/dimensiones/".$dimen->row_lectura);
                        $formularios .= file_get_contents("views/sgd/objetivos/dimensiones/" . $dimen->template);
                        $row_html = file_get_contents("views/sgd/objetivos/dimensiones/" . $dimen->row);
                        //echo "1.2";
                    } else if ($tipo_vista == "prop") {
                        $formularios .= file_get_contents("views/sgd/objetivos/dimensiones/" . $dimen->template_lectura);
                        $row_html = file_get_contents("views/sgd/objetivos/dimensiones/" . $dimen->row_lectura);
                        //echo "1.3";
                        if ($id_empresa == 76) {
                            $vista_lectura_para_colaborador_fijacion = "log";
                        } else {
                            $vista_lectura_para_colaborador_fijacion = "";
                        }
                    } else {
                        $formularios .= file_get_contents("views/sgd/objetivos/dimensiones/" . $dimen->template);
                        $row_html = file_get_contents("views/sgd/objetivos/dimensiones/" . $dimen->row);
                        //echo "1.4";
                    }
                } else {
                    $formularios .= file_get_contents("views/sgd/objetivos/dimensiones/" . $dimen->template_lectura);
                    $row_html = file_get_contents("views/sgd/objetivos/dimensiones/" . $dimen->row_lectura);
                    //echo "1.5";
                    if ($tipo_vista == "prop") {
                        $vista_lectura_para_colaborador_fijacion = "log";
                    } else {
                        $vista_lectura_para_colaborador_fijacion = "";
                    }
                }
            }
            $dimensiones_finalizadas++;
        } else if ($estado_dimension[1] == 0 or $estado_dimension[1] == 2) {
            if ($dimen->solo_lectura == 1) {
                exit;
                $formularios .= file_get_contents("views/sgd/objetivos/dimensiones/" . $dimen->template_lectura);
                $row_html = file_get_contents("views/sgd/objetivos/dimensiones/" . $dimen->row_lectura);
                //echo "1.6";
            } else {
                $formularios .= file_get_contents("views/sgd/objetivos/dimensiones/" . $dimen->template);
                $row_html = file_get_contents("views/sgd/objetivos/dimensiones/" . $dimen->row);
                //echo "1.7";
            }
        }
        $objetivos_ingresados = ObjetivosPodDimensionEmpresaUsuario($rut_evaluado, $id_empresa, $dimen->id, $datos_evaluado[0]->id_perfil_competencia, $vista_lectura_para_colaborador_fijacion);
        $formularios          = str_replace("{CASE_FORM}", $dimen->case, $formularios);
        $formularios          = str_replace("{NUMERO}", $dimen->orden, $formularios);
        $formularios          = str_replace("{NOMBRE_DIMENSION}", utf8_encode($dimen->nombre), $formularios);
        $formularios          = str_replace("{DESCRIPCION}", utf8_encode($dimen->descripcion), $formularios);
        $formularios          = str_replace("{BOTON1}", "", $formularios);
        $formularios          = str_replace("{ID_DIMENSION_ENCODEADO}", $dimen->id, $formularios);
        $formularios          = str_replace("{OPTIONS_PONDERACIONES}", PondObjetivos2(""), $formularios);
        $formularios          = str_replace("{OPTIONS_PONDERACIONES_1_A_99}", PondObjetivosa99(""), $formularios);
        $formularios          = str_replace("{OPTIONS_DIMENSION_" . $dimen->id . "}", ColocaOpcionesDeMetrica($id_empresa, $dimen->id), $formularios);
        //Traigo las metricas por empresa
        $metricas             = totalMetricasObjetivosPorEmpresa($id_empresa);
        foreach ($metricas as $metri) {
            $options_metricas .= "<option value='" . $metri->metrica . "'>" . $metri->metrica . "</option>";
        }
        $formularios           = str_replace("{OPTIONS_PONDERACIONES_A10}", PondObjetivosa100(""), $formularios);
        $formularios           = str_replace("{OPTIONS_METRICAS_OBJETIVOS}", utf8_encode($options_metricas), $formularios);
        //Verifico si este jefe, ya tiene algunos finalizados, si es asi, isto a los usuarios finalizados
        $evalaudos_finalizados = VerificoEvaluadosFinalizadosPorEvaluador($rut_fijador, $id_proceso, $id_empresa);
        if ($id_empresa == 76) {
            $evaluados_finalizados_2 = VerificoEvaluadosFinalizadosPorEvaluador2($rut_fijador, $id_proceso, $id_empresa);
            if ($evaluados_finalizados_2) {
                //Verifico si este evaluado ya esta finalizado con la fijación
                $individual_finalizado = VerificoEvaluadoPRocesoEmpresaFinalizadoObjetivos($rut_evaluado, $id_empresa, $id_proceso);
                $PRINCIPAL             = str_replace("{BLOQUE_REPLICA}", file_get_contents("views/sgd/objetivos/" . $id_empresa . "_paso2_bloque_replica.html"), $PRINCIPAL);
                foreach ($evaluados_finalizados_2 as $eva) {
                    $options_usuarios .= "<option value='" . $eva->evaluado . "'>" . $eva->nombre_completo . "</option>";
                }
                $PRINCIPAL = str_replace("{OPTIONS_USUARIOS}", $options_usuarios, $PRINCIPAL);
                $PRINCIPAL = str_replace("{RUT_EVALUADO}", encodear3($rut_evaluado), $PRINCIPAL);
            } else {
                $PRINCIPAL = str_replace("{BLOQUE_REPLICA}", "ñññ", $PRINCIPAL);
            }
        } else {
            if ($evalaudos_finalizados) {
                //Verifico si este evaluado ya esta finalizado con la fijación
                $individual_finalizado = VerificoEvaluadoPRocesoEmpresaFinalizadoObjetivos($rut_evaluado, $id_empresa, $id_proceso);
                if ($individual_finalizado) {
                    $PRINCIPAL = str_replace("{BLOQUE_REPLICA}", "", $PRINCIPAL);
                } else {
                    $PRINCIPAL = str_replace("{BLOQUE_REPLICA}", file_get_contents("views/sgd/objetivos/" . $id_empresa . "_paso2_bloque_replica.html"), $PRINCIPAL);
                }
                foreach ($evalaudos_finalizados as $eva) {
                    $options_usuarios .= "<option value='" . $eva->evaluado . "'>" . $eva->nombre_completo . "</option>";
                }
                $PRINCIPAL = str_replace("{OPTIONS_USUARIOS}", $options_usuarios, $PRINCIPAL);
                $PRINCIPAL = str_replace("{RUT_EVALUADO}", encodear3($rut_evaluado), $PRINCIPAL);
            } else {
                $PRINCIPAL = str_replace("{BLOQUE_REPLICA}", "", $PRINCIPAL);
            }
        }
        $formularios                         = str_replace("{ID_PERFIL_COMPETENCIAS}", $datos_evaluado[0]->id_perfil_competencia, $formularios);
        $options_pond_dimensiones            = "";
        $tiene_ponderacion_dimension_usuario = TienePonderacionDimensionPorUsuarioDimension($rut_evaluado, $id_empresa, $dimen->id);
        $formularios                         = str_replace("{PONDERACION_DESDE_BASE}", $tiene_ponderacion_dimension_usuario[0]->ponderacion, $formularios);
        for ($j = 5; $j <= 50; $j++) {
            if ($tiene_ponderacion_dimension_usuario[0]->ponderacion == $j) {
                $options_pond_dimensiones .= "<option value='" . $j . "' selected='selected'>$j%</option>";
            } else {
                $options_pond_dimensiones .= "<option value='" . $j . "'>$j%</option>";
            }
            $j = $j + 4;
        }
        $formularios               = str_replace("{OPTIONS_PONDERACIONES_DIMENSIONES}", $options_pond_dimensiones, $formularios);
        //Options de Competencias
        $formularios               = str_replace("{OPTIONS_COMPETENCIAS}", utf8_encode(ComboBoxCompetenciasPorPerfil($datos_evaluado[0]->id_perfil_competencia, "")), $formularios);
        //Por cada formulario, veo si existen objetivos ingresados en esta dimension
        $suma_objetivos_ingresados = ObjetivosPodDimensionEmpresaUsuarioSumaPonderacion($rut_evaluado, $id_empresa, $dimen->id);
        if ($dimen->tiene_ponderacion == 1) {
            if (count($objetivos_ingresados) >= $dimen->minimo && count($objetivos_ingresados) <= $dimen->maximo && $suma_objetivos_ingresados[0]->suma_ponderaciones == 100) {
                $muestra_boton_envia_a_jefe++;
            }
        } else {
            if (count($objetivos_ingresados) >= $dimen->minimo && count($objetivos_ingresados) <= $dimen->maximo) {
                $muestra_boton_envia_a_jefe++;
            }
        }
        if ($objetivos_ingresados) {
            $formularios                = str_replace("{BLOQUE_LISTADO_OBJETIVOS_INGRESADOS}", file_get_contents("views/sgd/objetivos/dimensiones/" . $dimen->entornoLecturaForm), $formularios);
            $formularios                = str_replace("{TEXTO_MENSAJE_CUMPLE_OBJETIVOS}", file_get_contents("views/sgd/objetivos/dimensiones/texto_suma_objetivos.html"), $formularios);
            $total_objetivos_ingresados = "";
            $k                          = 0;
            $suma_ponderacion           = 0;
            foreach ($objetivos_ingresados as $obj_ing) {
                $k++;
                //$total_objetivos_ingresados.=file_get_contents("views/sgd/objetivos/dimensiones/".$dimen->row);
                if ($id_objetivo == $obj_ing->id) {
                    $total_objetivos_ingresados .= file_get_contents("views/sgd/objetivos/dimensiones/edita_" . $dimen->row);
                } else {
                    $total_objetivos_ingresados .= $row_html;
                }
                $total_objetivos_ingresados = str_replace("{NUMERO}", $k, $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{ID_DIMENSION}", $dimen->id, $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{ID_DIMENSION_ENCODEADA}", Encodear3($dimen->id), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{NOMBRE_DIMENSION_PDF}", utf8_encode($obj_ing->nombre_dimension_pdf), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{PONDERACION_PDF_POR_DIMENSION}", $tiene_ponderacion_dimension_usuario[0]->ponderacion, $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{PARAMETROS_VAL}", "", $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{OBJETIVO}", utf8_encode($obj_ing->descripcion_objetivo), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{OBJETIVO_METRICA}", utf8_encode($obj_ing->descripcion_metrica), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{ID_OBJETIVO_ENCODEADO}", Encodear3($obj_ing->id), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{ID_OBJETIVO}", ($obj_ing->id), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{ACCION}", utf8_encode($obj_ing->accion_clave), $total_objetivos_ingresados);
                //$total_objetivos_ingresados = str_replace("{CONDUCTA_CRITICA}",utf8_encode($obj_ing->conducta_critica),$total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{CONDUCTA_CRITICA}", utf8_encode($obj_ing->nombre_conducta), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{COMPETENCIA}", utf8_encode($obj_ing->nombre_competencia), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{COMENTARIO}", utf8_encode($obj_ing->comentarios), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{ACCION_DESARROLLO}", utf8_encode($obj_ing->acciones_desarrollo), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{RESPONSABLE}", utf8_encode($obj_ing->responsable), $total_objetivos_ingresados);
                foreach ($metricas as $metri) {
                    if (($obj_ing->metrica) == $metri->metrica) {
                        $options_metricas_por_objetivo .= "<option value='" . $metri->metrica . "' selected='selected'>" . $metri->metrica . "</option>";
                    } else {
                        $options_metricas_por_objetivo .= "<option value='" . $metri->metrica . "'>" . $metri->metrica . "</option>";
                    }
                }
                $total_objetivos_ingresados = str_replace("{OPTIONS_METRICAS_OBJETIVOS}", utf8_encode($options_metricas_por_objetivo), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{NOCUMPLE}", utf8_encode($obj_ing->nocumple), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{CUMPLE}", utf8_encode($obj_ing->cumple), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{SOBRESALE}", utf8_encode($obj_ing->sobresale), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{FECHA}", utf8_encode($obj_ing->fecha_limite), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{ENV_EDITAR}", "updobjetivoV2", $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{PONDERACION}", utf8_encode($obj_ing->ponderacion) . "%", $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{METRICA}", utf8_encode($obj_ing->metrica), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{META}", utf8_encode($obj_ing->meta), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{OPTIONS_PONDERACIONES_INGRESADO}", PondObjetivos2($obj_ing->ponderacion) . "%", $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{OPTIONS_PONDERACIONES_INGRESADO_1_A_99}", PondObjetivosa99($obj_ing->ponderacion) . "%", $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{OPTIONS_PONDERACIONES_A10}", PondObjetivosa100($obj_ing->ponderacion), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{OPTIONS_COMPETENCIAS_INGRESADO}", utf8_encode(ComboBoxCompetenciasPorPerfil($datos_evaluado[0]->id_perfil_competencia, $obj_ing->competencia)), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{OPTIONS_CONDUCTAS_CRITICAS}", utf8_encode(ComboBoxConductasCriticasDadoPerfilYCompetencias($datos_evaluado[0]->id_perfil_competencia, $obj_ing->competencia, $obj_ing->conducta_critica)), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{ACCIONES_REALIZADAS}", utf8_encode($obj_ing->acciones_realizadas), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{IMPACTO}", utf8_encode($obj_ing->impacto), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{TIPO_ACCION}", utf8_encode($obj_ing->tipo_accion), $total_objetivos_ingresados);
                $total_objetivos_ingresados = str_replace("{SELECTED_" . utf8_encode($obj_ing->tipo_accion) . "}", "selected", $total_objetivos_ingresados);
                $suma_ponderacion           = $suma_ponderacion + $obj_ing->ponderacion;
            }
            $formularios = str_replace("{ROW_INGRESADOS}", $total_objetivos_ingresados, $formularios);
            $formularios = str_replace("{TOTAL_PONDERACION}", $suma_ponderacion . "%", $formularios);
            if ($suma_ponderacion == 100) {
                $formularios = str_replace("{CLASE_PONDERACION}", "pond_correcto", $formularios);
            } else {
                $formularios = str_replace("{CLASE_PONDERACION}", "pond_alerta", $formularios);
            }
        } else {
            $formularios = str_replace("{BLOQUE_LISTADO_OBJETIVOS_INGRESADOS}", "", $formularios);
            $formularios = str_replace("{ROW_INGRESADOS}", "NO", $formularios);
        }
    }
    //if($dimensiones_finalizadas==count($dimensiones_por_empresa)){
    //echo $muestra_boton_envia_a_jefe;
    if ($muestra_boton_envia_a_jefe == count($dimensiones_por_empresa) && $estado_dimension[1] <> 1) {
        if ($tipo_proceso_objetivos == 1) {
            $PRINCIPAL = str_replace("{BOTON_ENVIA_A_VALIDAR_OBJETIVOS}", file_get_contents("views/sgd/objetivos/boton_envia_valida_a_evaluado.html"), $PRINCIPAL);
            $alerta    = "no";
        } else {
            $PRINCIPAL = str_replace("{BOTON_ENVIA_A_VALIDAR_OBJETIVOS}", file_get_contents("views/sgd/objetivos/boton_envia_a_jefatura.html"), $PRINCIPAL);
            $alerta    = "si";
        }
    } else {
        //Aca ademas debo validar si es que este evaluado ya esta finalizado, porque si ya esta finalizado
        //No se debe mostrar ningun boton
        $verifico_evaluado_finalizado = VerificoEvaluadoEvaluadorPRocesoEmpresaFinalizadoObjetivos($rut_evaluado, $rut_fijador, $id_empresa, $id_proceso);
        if ($verifico_evaluado_finalizado) {
            if ($id_empresa == 41) {
                $PRINCIPAL = str_replace("{BOTON_ENVIA_A_VALIDAR_OBJETIVOS}", file_get_contents("views/sgd/objetivos/bloque_competencias.html"), $PRINCIPAL);
            } else {
                $PRINCIPAL = str_replace("{BOTON_ENVIA_A_VALIDAR_OBJETIVOS}", "", $PRINCIPAL);
            }
        } else {
            if ($id_empresa == 41) {
                $PRINCIPAL = str_replace("{BOTON_ENVIA_A_VALIDAR_OBJETIVOS}", "", $PRINCIPAL);
            } else {
                if ($rut_fijador == $rut_evaluado) {
                    $PRINCIPAL = str_replace("{BOTON_ENVIA_A_VALIDAR_OBJETIVOS}", file_get_contents("views/sgd/objetivos/boton_envia_a_jefatura.html"), $PRINCIPAL);
                } else {
                    if ($id_empresa == 76) {
                        //si no está validado, muestro el oton, si no no muestro el boton
                        $evaluado_esta_validado = VerificaSiObjetivosEstanValidadosDadoIdProcesoSoloEvaluado($id_proceso, $rut_evaluado);
                        if ($evaluado_esta_validado) {
                            $PRINCIPAL = str_replace("{BOTON_ENVIA_A_VALIDAR_OBJETIVOS}", "", $PRINCIPAL);
                        } else {
                            if ($tipo_vista == "prop") {
                                $PRINCIPAL = str_replace("{BOTON_ENVIA_A_VALIDAR_OBJETIVOS}", "", $PRINCIPAL);
                            } else {
                                $PRINCIPAL = str_replace("{BOTON_ENVIA_A_VALIDAR_OBJETIVOS}", file_get_contents("views/sgd/objetivos/" . $id_empresa . "_boton_jefe_valida_objetivos.html"), $PRINCIPAL);
                            }
                        }
                    } else {
                        $PRINCIPAL = str_replace("{BOTON_ENVIA_A_VALIDAR_OBJETIVOS}", file_get_contents("views/sgd/objetivos/boton_envia_a_jefatura.html"), $PRINCIPAL);
                    }
                }
                //$PRINCIPAL = str_replace("{BOTON_ENVIA_A_VALIDAR_OBJETIVOS}",file_get_contents("views/sgd/objetivos/boton_envia_a_jefatura_NO.html"),$PRINCIPAL);
            }
        }
        $alerta = "no";
    }
    $PRINCIPAL  = str_replace("{NUMERO_PASO}", count($dimensiones_por_empresa) + 1, $PRINCIPAL);
    $PRINCIPAL  = str_replace("{BLOQUE_FORMULARIOS_POR_DIMENSIONES}", $formularios, $PRINCIPAL);
    $PRINCIPAL  = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($rut_evaluado), $PRINCIPAL);
    $arreglo[0] = $alerta;
    $arreglo[1] = $PRINCIPAL;
    //return($PRINCIPAL);
    return ($arreglo);
}
function ColocaColaboradoresResumenObjetivos($PRINCIPAL, $rut_fijador, $id_empresa, $rut_validador, $id_proceso)
{
    if ($id_proceso) {
        //$evaluados=TraeRelacionesSinAe($rut_fijador, $id_proceso);
        if ($id_empresa == 766) {
            $evaluados = TraeRelacionesConDatosConAe($rut_fijador, $id_proceso);
        } else {
            $evaluados = TraeRelacionesSinAeConDatos($rut_fijador, $id_proceso);
        }
    } else {
        $evaluados = TraeRelacionesSinAeSinProceso($rut_fijador);
    }
    $datos_fijador = UsuarioEnBasePersonas($rut_fijador);
    if ($evaluados) {
        $PRINCIPAL = str_replace("{BLOQUE_MI_EQUIPO}", file_get_contents("views/sgd/objetivos/" . $id_empresa . "_paso1_bloque_equipo.html"), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BLOQUE_MI_EQUIPO}", "", $PRINCIPAL);
    }
    $PRINCIPAL                    = str_replace("{NOMBRE_FIJADOR}", utf8_encode($datos_fijador[0]->nombre_completo), $PRINCIPAL);
    $dimensiones_por_empresa      = DimensionesObjetivosPorEmpresa($id_empresa);
    $total_dimensiones            = 0;
    $total_fijaciones_finalizadas = 0;
    $total_validadas              = 0;
    if ($rut_validador) {
        $row_html = file_get_contents("views/sgd/objetivos/row_colaboradores_lista_resumen_validador.html");
    } else {
        //$row_html=file_get_contents("views/sgd/objetivos/row_colaboradores_lista_resumen.html");
        $row_html = file_get_contents("views/sgd/objetivos/" . $id_empresa . "_row_colaboradores_lista_resumen.html");
    }
    $datos_proceso = TraeProcesosDeEvaluacionDadoId($id_proceso);
    if ($datos_proceso[0]->quien_fija == "evaluado") {
        $row .= $row_html;
        $row                         = str_replace("{NOMBRE}", $datos_fijador[0]->nombre_completo, $row);
        $row                         = str_replace("{FECHA_INGRESO}", $datos_fijador[0]->fecha_ingreso, $row);
        $row                         = str_replace("{PERFIL_COMPETENCIAS}", $datos_fijador[0]->perfil_competencia, $row);
        $row                         = str_replace("{JEFE}", $datos_fijador[0]->nombre_evaluador, $row);
        $datos_jefe_dede_tbl_usuario = UsuarioEnBasePersonas($datos_fijador[0]->jefe);
        if ($datos_jefe_dede_tbl_usuario[0]->nombre_completo) {
            $row = str_replace("{JEFE_DESDE_TABLA_USUARIO}", $datos_jefe_dede_tbl_usuario[0]->nombre_completo, $row);
        } else {
            $row = str_replace("{JEFE_DESDE_TABLA_USUARIO}", "Sin Jefatura", $row);
        }
        $row             = str_replace("{JEFE_DEL_JEFE}", $datos_fijador[0]->nombre_validador, $row);
        $row             = str_replace("{CARGO}", $datos_fijador[0]->cargo_evaluado, $row);
        $row             = str_replace("{FECHA_INGRESO}", $datos_fijador[0]->fecha_ingreso_evaluado, $row);
        $row             = str_replace("{SUCURSALES_CASAMATRIZ}", $eva->sucursal, $row);
        //Veo si esta finalizado para el evaluado, si es asi, muestro el boton para que ve alos objetivos fijados
        $esta_finalizado = VerificaDimensionFinalizadaObjetivosPorEvaluado($rut_fijador, $id_empresa);
        if ($esta_finalizado) {
            $row = str_replace("{BOTON_VER_DETALLE}", file_get_contents("views/sgd/objetivos/boton_ver_detalle_evaluado_desde_evaluado.html"), $row);
            $row = str_replace("{BOTON_VE_INFORME}", file_get_contents("views/sgd/objetivos/" . $id_empresa . "_boton_descarga_informe.html"), $row);
        } else {
            $row = str_replace("{BOTON_VE_INFORME}", "", $row);
            if ($id_empresa == 76) {
                $row = str_replace("{BOTON_VER_DETALLE}", file_get_contents("views/sgd/objetivos/boton_ver_detalle_evaluado_desde_evaluador.html"), $row);
            } else {
                $row = str_replace("{BOTON_VER_DETALLE}", "", $row);
            }
        }
        $row = str_replace("{RUT_EVALUADO}", $rut_fijador, $row);
        $row = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($rut_fijador), $row);
        $row = str_replace("{URL_PERSONA}", VerificaFotoPersonal($rut_fijador), $row);
        foreach ($dimensiones_por_empresa as $dimen) {
            $row_dimensiones .= file_get_contents("views/sgd/objetivos/" . $id_empresa . "_row_resumen_por_dimension_evaluado.html");
            $row_dimensiones             = str_replace("{NOMBRE_DIMENSION}", $dimen->nombre, $row_dimensiones);
            //Verifico si está finalizada esta dimension para este evaluado
            $estado_dimension            = VerificaEstadoDimensionesObjetivos($rut_fijador, $dimen->id, $id_empresa);
            $row_dimensiones             = str_replace("{ESTADO}", $estado_dimension[0], $row_dimensiones);
            $estado_dimension_validacion = VerificaEstadoDimensionesObjetivosParaValidacion($rut_fijador, $dimen->id, $id_empresa);
            $row_dimensiones             = str_replace("{ESTADO_VALIDACION}", $estado_dimension_validacion[0], $row_dimensiones);
            $estado_ingresado            = VerificaEstadoDimensionesObjetivosIngresados($rut_fijador, $dimen->id, $id_empresa);
            $row_dimensiones             = str_replace("{ESTADO_INGRESO}", $estado_ingresado[0], $row_dimensiones);
            if ($estado_ingresado[1] == 1) {
                $total_ingresos++;
            }
        }
        $row = str_replace("{ROW_RESUMEN_POR_EVALUADO}", $row_dimensiones, $row);
        if ($id_empresa == 76) {
            $row_miperfil = $row;
            $row          = "";
        }
    }
    $PRINCIPAL = str_replace("{LISTADO_MI_PERFIL}", utf8_encode($row_miperfil), $PRINCIPAL);
    foreach ($evaluados as $eva) {
        //$dimensione s_por_empresa=DimensionesObjetivosPorEmpresaCruceFinalizados($id_empresa, $eva->evaluado);
        if ($eva->objetivos_masivos == 1) {
            $row .= file_get_contents("views/sgd/objetivos/" . $id_empresa . "_row_colaboradores_lista_resumen_masivo.html");
        } else {
            $row .= $row_html;
        }
        //ACA Verifico si es que está o no validado
        $objetivos_validados = VerificaSiObjetivosEstanValidadosDadoEvaluadorIdProcesoEvaluado($rut_fijador, $id_proceso, $eva->evaluado);
        if ($objetivos_validados or $eva->objetivos_masivos == 1) {
            if ($rut_validador) {
                $row = str_replace("{BOTON_VE_INFORME}", file_get_contents("views/sgd/objetivos/boton_descarga_informe_desde_validador.html"), $row);
            } else {
                //$row = str_replace("{BOTON_VE_INFORME}",file_get_contents("views/sgd/objetivos/boton_descarga_informe.html"),$row);
                if ($eva->objetivos_masivos == 1) {
                    $row = str_replace("{BOTON_VE_INFORME}", file_get_contents("views/sgd/objetivos/boton_descarga_informe_solo_texto.html"), $row);
                } else {
                    $row = str_replace("{BOTON_VE_INFORME}", file_get_contents("views/sgd/objetivos/boton_descarga_informe.html"), $row);
                }
            }
            //Veo si esta descargado este informe, si es asi, coloco texto finalizado
            $esta_finalizado_proceso = OBJETIVOS_InformesDescargadosPorEvaluadorProcesoEmpresaEvaluado($eva->evaluado, $eva->evaluador, $id_proceso, $id_empresa);
            if ($esta_finalizado_proceso) {
                $texto_a_mostrar = file_get_contents("views/sgd/objetivos/texto_proceso_finalizado.html");
            } else {
                $texto_a_mostrar = "";
            }
            if ($eva->objetivos_masivos == 1) {
                $texto_a_mostrar .= file_get_contents("views/sgd/objetivos/texto_carga_masiva.html");
            }
            $row = str_replace("{TEXTO_PROCESO_FINALIZADO}", $texto_a_mostrar, $row);
            //$row = str_replace("{BOTON_VER_DETALLE}","acacacac",$row);
            $row = str_replace("{BOTON_VER_DETALLE}", file_get_contents("views/sgd/objetivos/boton_visualiza_metas.html"), $row);
        } else {
            $row = str_replace("{BOTON_VE_INFORME}", "", $row);
            if ($rut_validador) {
                $row = str_replace("{BOTON_VER_DETALLE}", file_get_contents("views/sgd/objetivos/boton_ver_detalle_evaluado.html"), $row);
            } else {
                $row = str_replace("{BOTON_VER_DETALLE}", file_get_contents("views/sgd/objetivos/boton_ver_detalle_evaluado_desde_evaluador.html"), $row);
            }
        }
        $row             = str_replace("{NOMBRE}", $eva->nombre_completo, $row);
        $row             = str_replace("{FECHA_INGRESO}", $eva->fecha_ingreso, $row);
        $row             = str_replace("{PERFIL_COMPETENCIAS}", $eva->perfil_competencia, $row);
        $row             = str_replace("{JEFE}", $eva->nombre_evaluador_1, $row);
        $row             = str_replace("{JEFE_DEL_JEFE}", $eva->nombre_validador, $row);
        $row             = str_replace("{JEFE_DESDE_TABLA_USUARIO}", $eva->nombre_evaluador_1, $row);
        $row             = str_replace("{CARGO}", $eva->cargo_evaluado, $row);
        $row             = str_replace("{CARGO}", $eva->cargo_evaluado, $row);
        $row             = str_replace("{SUCURSALES_CASAMATRIZ}", $eva->sucursal, $row);
        $row             = str_replace("{RUT_EVALUADO}", $eva->evaluado, $row);
        $row             = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($eva->evaluado), $row);
        $row             = str_replace("{URL_PERSONA}", VerificaFotoPersonal($eva->evaluado), $row);
        //Por cada colaborador, armo el menu de resumen
        $row_dimensiones = "";
        foreach ($dimensiones_por_empresa as $dimen) {
            $row_dimensiones .= file_get_contents("views/sgd/objetivos/" . $id_empresa . "_row_resumen_por_dimension_evaluado.html");
            $row_dimensiones             = str_replace("{NOMBRE_DIMENSION}", $dimen->nombre, $row_dimensiones);
            //Verifico si está finalizada esta dimension para este evaluado
            $estado_dimension            = VerificaEstadoDimensionesObjetivos($eva->evaluado, $dimen->id, $id_empresa);
            $row_dimensiones             = str_replace("{ESTADO}", $estado_dimension[0], $row_dimensiones);
            $estado_dimension_validacion = VerificaEstadoDimensionesObjetivosParaValidacion($eva->evaluado, $dimen->id, $id_empresa);
            $row_dimensiones             = str_replace("{ESTADO_VALIDACION}", $estado_dimension_validacion[0], $row_dimensiones);
            $estado_ingresado            = VerificaEstadoDimensionesObjetivosIngresados($eva->evaluado, $dimen->id, $id_empresa);
            $row_dimensiones             = str_replace("{ESTADO_INGRESO}", $estado_ingresado[0], $row_dimensiones);
            if ($estado_dimension_validacion[1] == 3) {
                $matriz_total_validadas[$dimen->id]["validadas"]++;
            }
            if ($estado_ingresado[1] == 1) {
                $total_ingresos++;
            }
            $total_dimensiones++;
            $matris_datos_generales[$dimen->id]["total"]++;
            //Esto implica si esta finalizado o no.
            if ($estado_dimension[1] == 1) {
                $total_fijaciones_finalizadas++;
                $matris_datos_generales[$dimen->id]["finalizado"]++;
            }
        }
        $row = str_replace("{ROW_RESUMEN_POR_EVALUADO}", $row_dimensiones, $row);
    }
    $PRINCIPAL = str_replace("{LISTADO_COLABORADORES}", utf8_encode($row), $PRINCIPAL);
    $PRINCIPAL = str_replace("{AVANCE_EVALUADOS}", EntregaPorcentaje($total_dimensiones, $total_fijaciones_finalizadas), $PRINCIPAL);
    foreach ($dimensiones_por_empresa as $dimen) {
        $row_dimensiones_gen .= file_get_contents("views/sgd/objetivos/" . $id_empresa . "_row_resumen_por_dimension.html");
        $row_dimensiones_gen = str_replace("{NOMBRE_DIMENSION}", $dimen->nombre, $row_dimensiones_gen);
        $row_dimensiones_gen = str_replace("{AVANCE_DIMENSION}", EntregaPorcentaje($matris_datos_generales[$dimen->id]["total"], $matris_datos_generales[$dimen->id]["finalizado"]), $row_dimensiones_gen);
        $row_dimensiones_gen = str_replace("{AVANCE_DIMENSION_VALIDACION}", EntregaPorcentaje($matris_datos_generales[$dimen->id]["total"], $matriz_total_validadas[$dimen->id]["validadas"]), $row_dimensiones_gen);
        $row_dimensiones_gen = str_replace("{AVANCE_DIMENSION_INGRESO}", EntregaPorcentaje($matris_datos_generales[$dimen->id]["total"], ($total_ingresos / count($dimensiones_por_empresa))), $row_dimensiones_gen);
    }
    $PRINCIPAL = str_replace("{ROW_LISTADO_RESUMEN}", utf8_encode($row_dimensiones_gen), $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocaResumenObjetivos($PRINCIPAL, $rut_fijador, $id_empresa)
{
    return ($PRINCIPAL);
}
function colocarColaboradoresPorRutConDatos($PRINCIPAL, $id_empresa, $rut)
{
    $listado_colaboradores = TotalUsuariosPorRutJefe($rut);
    foreach ($listado_colaboradores as $unico) {
        //$row.=file_get_contents("views/miperfil/row_colaboradores_miperfil.html");
        $row .= file_get_contents("views/miequipo/row_equipo_resumen.html");
        $row = str_replace("{NOMBRE}", $unico->nombre . " " . $unico->apaterno . " " . $unico->amaterno, $row);
        $row = str_replace("{CARGO}", $unico->cargo, $row);
        $row = str_replace("{FECHA_CUMPLEANOS}", formatearFecha($unico->fecha_nacimiento), $row);
        $row = str_replace("{URL_PERSONA}", VerificaFotoPersonal($unico->rut), $row);
        $row = str_replace("{RUT_ENCODEADO}", Encodear3($unico->rut), $row);
        list($total_inscripciones, $total_aprobados, $total_reprobados, $total_en_proceso) = CAPACITACION_DatosGeneralesPorUsuario($unico->rut);
        $estado                           = EntregaEstadoAvanceBarraMalla(EntregaPorcentaje($total_inscripciones, $total_aprobados));
        $acumulador_avance_colaboradores  = $acumulador_avance_colaboradores + EntregaPorcentaje($total_inscripciones, $total_aprobados);
        $PRINCIPAL                        = str_replace("{NUMERO_AVANCE}", round(EntregaPorcentaje($total_inscripciones, $total_aprobados)), $PRINCIPAL);
        $PRINCIPAL                        = str_replace("{COLOR_PROGRESS_BAR}", $estado[0], $PRINCIPAL);
        $row                              = str_replace("{AVANCE_COLABORADOR}", EntregaPorcentaje($total_inscripciones, $total_aprobados), $row);
        $total_visitas                    = TotalVisitasDadoRutCaseEmpresaFront($unico->rut, $id_empresa, "home_minvest");
        $row                              = str_replace("{NUM_VISITAS_COLABORADOR}", $total_visitas[0]->total_visitas, $row);
        $acumulador_visitas_colaboradores = $acumulador_visitas_colaboradores + $total_visitas[0]->total_visitas;
    }
    $PRINCIPAL = str_replace("{NUM_PERSONAS_MI_EQUIPO}", count($listado_colaboradores), $PRINCIPAL);
    $PRINCIPAL = str_replace("{PROMEDIO_EQUIPO}", round($acumulador_avance_colaboradores / count($listado_colaboradores)), $PRINCIPAL);
    $PRINCIPAL = str_replace("{NUM_VISITAS_MI_EQUIPO}", $acumulador_visitas_colaboradores, $PRINCIPAL);
    $PRINCIPAL = str_replace("{BLOQUE_COLABORADORES}", utf8_encode($row), $PRINCIPAL);
    return ($PRINCIPAL);
}
function colocarReconocimientosGraciasPorRut($PRINCIPAL, $id_empresa, $rut)
{
    $listado = TotalReconocimientosGraciasJefe($rut, $id_empresa);
    //print_r($listado);
    foreach ($listado as $unico) {
        $row .= file_get_contents("views/reconoce_vota/" . $id_empresa . "_rec_vot_carrusel.html");
        $row                              = str_replace("{NOMBRE_DESTINATARIO}", $unico->nombre_destinatario, $row);
        $row                              = str_replace("{NOMBRE_REMITENTE}", $unico->nombre_remitente, $row);
        $row                              = str_replace("{FOTO_DESTINATARIO}", VerificaFotoPersonal($unico->avatar_destinatario), $row);
        $row                              = str_replace("{FOTO_REMITENTE}", VerificaFotoPersonal($unico->avatar_remitente), $row);
        $row                              = str_replace("{MENSAJE}", ($unico->mensaje), $row);
        $acumulador_visitas_colaboradores = $acumulador_visitas_colaboradores + $total_visitas[0]->total_visitas;
        $cuenta_colaborador++;
    }
    $lms_graf_acciones_verde = $sum_verde;
    $PRINCIPAL               = str_replace("{NUM_PERSONAS_MI_EQUIPO}", count($listado_colaboradores), $PRINCIPAL);
    $PRINCIPAL               = str_replace("{PROMEDIO_EQUIPO}", round($acumulador_avance_colaboradores / count($listado_colaboradores)), $PRINCIPAL);
    $PRINCIPAL               = str_replace("{NUM_VISITAS_MI_EQUIPO}", $acumulador_visitas_colaboradores, $PRINCIPAL);
    $PRINCIPAL               = str_replace("{ROW_REC_VAL_CARRUSEL_RECONOCIMIENTOS_GRACIAS}", utf8_encode($row), $PRINCIPAL);
    return ($PRINCIPAL);
}
function colocarPuntosPorRut($PRINCIPAL, $id_empresa, $rut)
{
    $listado = TotalReconocimientosGraciasJefe($rut, $id_empresa);
    //print_r($listado);

    foreach ($listado as $unico) {
        //$row.=file_get_contents("views/reconoce_vota/".$id_empresa."_rec_vot_carrusel.html");
        //$row = str_replace("{NOMBRE_DESTINATARIO}",$unico->nombre_destinatario,$row);
        //$row = str_replace("{NOMBRE_REMITENTE}",$unico->nombre_remitente,$row);
        // $row = str_replace("{FOTO_DESTINATARIO}",VerificaFotoPersonal($unico->avatar_destinatario),$row);
        // $row = str_replace("{FOTO_REMITENTE}",VerificaFotoPersonal($unico->avatar_remitente),$row);
        // $row = str_replace("{MENSAJE}",($unico->mensaje),$row);
        // $acumulador_visitas_colaboradores=$acumulador_visitas_colaboradores+$total_visitas[0]->total_visitas;
        // $cuenta_colaborador++;
    }

    // solo dos tipos de puntos

    if($id_empresa=="52"){



    $row .= file_get_contents("views/reconoce_vota/" . $id_empresa . "_puntos_counter.html");
    $row = str_replace("{ICONO_PUNTOS}", "i-plain nobottommargin i-azul fas fa-gem", $row);
    $row = str_replace("{PUNTOS}", "0", $row);
    $row = str_replace("{NOMBRE_PUNTOS}", "Diamantes", $row);
    $row .= file_get_contents("views/reconoce_vota/" . $id_empresa . "_puntos_counter.html");
    $row       = str_replace("{ICONO_PUNTOS}", "i-plain nobottommargin i-azul far fa-dot-circle", $row);
    $row       = str_replace("{PUNTOS}", "0", $row);
    $row       = str_replace("{NOMBRE_PUNTOS}", "Puntos", $row);
    $PRINCIPAL = str_replace("{ROW_PUNTOS_PROFILE}", utf8_encode($row), $PRINCIPAL);

    }


    if($id_empresa=="81"){

    $row1 .= file_get_contents("views/reconoce_vota/" . $id_empresa . "_puntos_counter_only.html");
    $row1       = str_replace("{ICONO_PUNTOS}", "i-plain nobottommargin i-azul far fa-dot-circle", $row1);
    $row1       = str_replace("{PUNTOS}", "0", $row1);
    $row1       = str_replace("{NOMBRE_PUNTOS}", "Puntos", $row1);
    $PRINCIPAL = str_replace("{ROW_PUNTOS_PROFILE}", utf8_encode($row1), $PRINCIPAL);

    }
    //puntos empresa 78

    if($id_empresa=="78"){

    $row1 .= file_get_contents("views/reconoce_vota/" . $id_empresa . "_puntos_counter_only.html");
    $row1       = str_replace("{ICONO_PUNTOS}", "i-plain nobottommargin i-azul fas fa-globe", $row1);
    $row1       = str_replace("{PUNTOS}", "0", $row1);
    $row1       = str_replace("{NOMBRE_PUNTOS}", "Puntos", $row1);
    $PRINCIPAL = str_replace("{ROW_PUNTOS_PROFILE}", utf8_encode($row1), $PRINCIPAL);

    }

    return ($PRINCIPAL);
}
function colocarReconocimientosPerfilPorEquipo($PRINCIPAL, $id_empresa, $rut)
{
    $arr_reco            = BuscaDatosReconocimientoAgradecimientosEquipo($rut, $id_empresa);
    $num_gracias         = $arr_reco[0]->num_gracias;
    $num_reconocimientos = $arr_reco[0]->num_reconocimientos;
    $row .= file_get_contents("views/reconoce_vota/" . $id_empresa . "_puntos_counter.html");
    $row = str_replace("{ICONO_PUNTOS}", "icon-star", $row);
    $row = str_replace("{PUNTOS}", $num_reconocimientos, $row);
    $row = str_replace("{NOMBRE_PUNTOS}", "Reconocimientos", $row);
    $row .= file_get_contents("views/reconoce_vota/" . $id_empresa . "_puntos_counter.html");
    $row       = str_replace("{ICONO_PUNTOS}", "far fa-heart", $row);
    $row       = str_replace("{PUNTOS}", $num_gracias, $row);
    $row       = str_replace("{NOMBRE_PUNTOS}", "Agradecimientos", $row);
    $PRINCIPAL = str_replace("{ROW_RECONOCIMIENTOS_PROFILE}", utf8_encode($row), $PRINCIPAL);
    return ($PRINCIPAL);
}
function colocarReconocimientosPerfilPorRut($PRINCIPAL, $id_empresa, $rut)
{
    $arr_reco            = BuscaDatosReconocimientoAgradecimientos($rut, $id_empresa);
    $num_gracias         = $arr_reco[0]->num_gracias;
    $num_reconocimientos = $arr_reco[0]->num_reconocimientos;
    $row .= file_get_contents("views/reconoce_vota/" . $id_empresa . "_puntos_counter.html");
    $row = str_replace("{ICONO_PUNTOS}", "icon-star", $row);
    $row = str_replace("{PUNTOS}", $num_reconocimientos, $row);
    $row = str_replace("{NOMBRE_PUNTOS}", "Reconocimientos", $row);
    $row .= file_get_contents("views/reconoce_vota/" . $id_empresa . "_puntos_counter.html");
    $row       = str_replace("{ICONO_PUNTOS}", "far fa-heart", $row);
    $row       = str_replace("{PUNTOS}", $num_gracias, $row);
    $row       = str_replace("{NOMBRE_PUNTOS}", "Agradecimientos", $row);
    $PRINCIPAL = str_replace("{ROW_RECONOCIMIENTOS_PROFILE}", utf8_encode($row), $PRINCIPAL);
    return ($PRINCIPAL);
}
function colocarKpiPorRut($PRINCIPAL, $id_empresa, $rut)
{
    $cuenta_kpi = 0;
    $listado       = lista_kpis_por_rut($rut, $id_empresa);
   // print_r($listado);

    foreach ($listado as $unico) {

        $row .= file_get_contents("views/kpi/".$id_empresa."_lista_kpis.html");
        $row = str_replace("{NOMBRE_KPI}",  utf8_encode($unico->nombre),     $row);
        $row = str_replace("{DATO1}",       utf8_encode($unico->avance),     $row);
        $row = str_replace("{DATO2}",       utf8_encode($unico->variacion),  $row);
        $row = str_replace("{DATO3}",       utf8_encode($unico->monto),      $row);

    }
    $PRINCIPAL = str_replace("{KPIS_PERFIL_PERSONAL}", ($row), $PRINCIPAL);
    $PRINCIPAL = str_replace("{NUM_BADGES}", ($cuenta_badges), $PRINCIPAL);
    return ($PRINCIPAL);
}

function colocarlogrosBadgesPorRut($PRINCIPAL, $id_empresa, $rut)
{   //echo "rut $rut, id_empresa $id_empresa";
    $cuenta_badges = 0;
    $listado       = lista_badges_por_rut($rut, $id_empresa);
    foreach ($listado as $unico) {
        if ($unico->fecha == "") {
            $estilo_badge = " img_grayscale_opacity";
            $texto        = "<br>" . utf8_encode($unico->nombre);
            $width_image  = "96px";
        } else {
            $estilo_badge = "";
            $texto        = "<br>" . utf8_encode($unico->nombre) . "<br>" . $unico->fecha;
            $width_image  = "96px";
            $cuenta_badges++;
        }
        $row .= file_get_contents("views/badges/" . $id_empresa . "_lista_badges.html");
        $row = str_replace("{IMAGEN_BADGE}", $unico->imagen, $row);
        $row = str_replace("{ESTILO_IMAGEN_BADGE}", $estilo_badge, $row);
        $row = str_replace("{TEXTO_BADGE}", $texto, $row);
        $row = str_replace("{WIDTH_IMAGEN_BADGE}", $width_image, $row);
    }  //echo $row;
    $PRINCIPAL = str_replace("{LISTA_BADGES_PLATAFORMA}", ($row), $PRINCIPAL);
    $PRINCIPAL = str_replace("{NUM_BADGES}", ($cuenta_badges), $PRINCIPAL);
    return ($PRINCIPAL);
}


function colocarlogrosBadgesPorRut_MiEquipo($PRINCIPAL, $id_empresa, $rut)
{   //echo "rut $rut, id_empresa $id_empresa";
    $cuenta_badges = 0;
    $listado       = lista_badges_por_rut($rut, $id_empresa);
    foreach ($listado as $unico) {
        if ($unico->fecha == "") {
            $estilo_badge = " img_grayscale_opacity";
            $texto        = "<br>" . utf8_encode($unico->nombre);
            $width_image  = "96px";
        } else {
            $estilo_badge = "";
            $texto        = "<br>" . utf8_encode($unico->nombre) . "<br>" . $unico->fecha;
            $width_image  = "96px";
            $cuenta_badges++;
        }
        $row .= file_get_contents("views/badges/" . $id_empresa . "_lista_badges.html");
        $row = str_replace("{IMAGEN_BADGE}", $unico->imagen, $row);
        $row = str_replace("{ESTILO_IMAGEN_BADGE}", $estilo_badge, $row);
        $row = str_replace("{TEXTO_BADGE}", $texto, $row);
        $row = str_replace("{WIDTH_IMAGEN_BADGE}", $width_image, $row);
    }  //echo $row;
    $PRINCIPAL = str_replace("{LISTA_BADGES_PLATAFORMA}", ($row), $PRINCIPAL);
    $PRINCIPAL = str_replace("{NUM_BADGES}", ($cuenta_badges), $PRINCIPAL);
    return ($PRINCIPAL);
}
function colocarListaRankingAgradecimientos($PRINCIPAL, $id_empresa)
{
    $listado = DataChartAgradecimientos($id_empresa);
    //print_r($listado);
    foreach ($listado as $unico) {
        //    echo "<br>".$tipo_reco;
        $row .= file_get_contents("views/reconoce_vota/" . $id_empresa . "_lista_rank_gracias_tabla.html");
        $row = str_replace("{CATEGORIA}", $unico->categoria, $row);
        $row = str_replace("{DESCRIPCION_CATEGORIA}", $unico->categoria_resumen, $row);
        $row = str_replace("{NUM_GRACIAS}", $unico->cuentaCat, $row);
        $row = str_replace("{PORCENTAJE}", $unico->PromCat, $row);
    }
    $PRINCIPAL = str_replace("{ROW_REC_RANKING_LISTA_GRACIAS}", utf8_encode($row), $PRINCIPAL);
    return ($PRINCIPAL);
}
function colocarListadONUTRankingAgradecimientos($PRINCIPAL, $div, $id_empresa)
{
    $listado = DataChartDonutAgradecimientos($id_empresa, $div);
    //print_r($listado);
    foreach ($listado as $unico){
            $serie.= "['".$unico->categorita."', ".$unico->Cuenta."],";
    }
    //echo  $serie;
    $row .= file_get_contents("views/reconoce_vota/" . $id_empresa . "_chart_semidonut.html");
    $row = str_replace("{SERIE}", $serie, $row);

    $PRINCIPAL = str_replace("{CHART_DONUT_RANKING_LISTA_GRACIAS}", utf8_encode($row), $PRINCIPAL);
    return ($PRINCIPAL);
}
function colocarColaboradoresPorRutSoloClick($PRINCIPAL, $id_empresa, $rut)
{		$cuenta_colaborador=0;
    $listado_colaboradores = TotalUsuariosPorRutJefe($rut);
    foreach ($listado_colaboradores as $unico) {
        $array_Reco_Gracias = BuscaDatosReconocimientoAgradecimientos($unico->rut, $id_empresa);
        //print_r($array_Reco_Gracias);
        if ($array_Reco_Gracias[0]->num_gracias > 0) {
            $num_gracias = $array_Reco_Gracias[0]->num_gracias;
        } else {
            $num_gracias = 0;
        }
        if ($array_Reco_Gracias[0]->num_reconocimientos > 0) {
            $num_reconocimientos = $array_Reco_Gracias[0]->num_reconocimientos;
        } else {
            $num_reconocimientos = 0;
        }
        // print_r($unico);
        //$row.=file_get_contents("views/miperfil/row_colaboradores_miperfil.html");
        //$row.=file_get_contents("views/mi_equipo_lms/row_equipo_resumen.html");
        //echo "" . $id_empresa . "_row_equipo_resumen_soloclick.html";

        $row .= file_get_contents("views/mi_equipo_lider/" . $id_empresa . "_row_equipo_resumen_soloclick.html");
        //$row = str_replace("{MEDALLAS}",$datos_consolidados[0]->medallas,$row);
        $row                              = str_replace("{MEDALLAS}", $medallas, $row);
        $row                              = str_replace("{NOMBRE}", $unico->nombre . " " . $unico->apaterno . " " . $unico->amaterno, $row);
        $row                              = str_replace("{CARGO}", $unico->cargo, $row);
        $row                              = str_replace("{GERENCIA}", $unico->gerencia, $row);
        $row                              = str_replace("{FECHA_CUMPLEANOS}", formatearFecha($unico->fecha_nacimiento), $row);
        $row                              = str_replace("{URL_PERSONA}", VerificaFotoPersonal($unico->rut), $row);
        $row                              = str_replace("{RUT_ENCODEADO}", Encodear5($unico->rut), $row);
        $row                              = str_replace("{RUT_COL}", Encodear5($unico->rut), $row);
        $row                              = str_replace("{NUM_RECONOCIMIENTOS}", $num_reconocimientos, $row);
        $row                              = str_replace("{NUM_GRACIAS}", $num_gracias, $row);
        $row                              = str_replace("{ACCION}", ($accion), $row);
        $acumulador_visitas_colaboradores = $acumulador_visitas_colaboradores + $total_visitas[0]->total_visitas;
        $cuenta_colaborador++;
    }
    
    if($cuenta_colaborador>0){
    	
    $PRINCIPAL               = str_replace("{DISPLAY_NONE}", "", $PRINCIPAL);
    	
    } else {
    $PRINCIPAL               = str_replace("{DISPLAY_NONE}", "display:none;", $PRINCIPAL);
    	
    }
    
    $lms_graf_acciones_verde = $sum_verde;
    $PRINCIPAL               = str_replace("{NUM_PERSONAS_MI_EQUIPO}", count($listado_colaboradores), $PRINCIPAL);
    $PRINCIPAL               = str_replace("{PROMEDIO_EQUIPO}", round($acumulador_avance_colaboradores / count($listado_colaboradores)), $PRINCIPAL);
    $PRINCIPAL               = str_replace("{NUM_VISITAS_MI_EQUIPO}", $acumulador_visitas_colaboradores, $PRINCIPAL);
    $PRINCIPAL               = str_replace("{BLOQUE_COLABORADORES}", utf8_encode($row), $PRINCIPAL);
    $PRINCIPAL               = str_replace("{LMS_GRAFICO_1COLOR}", file_get_contents("views/mi_equipo_lms/" . $id_empresa . "_barra_1color.html"), $PRINCIPAL);
    $PRINCIPAL               = str_replace("{LMS_AVANCEEQUIPO}", $lms_avance_equipo, $PRINCIPAL);
    $PRINCIPAL               = str_replace("{LMS_GRAFICO_3COLORES}", file_get_contents("views/mi_equipo_lms/" . $id_empresa . "_barra_3colores.html"), $PRINCIPAL);
    $PRINCIPAL               = str_replace("{VALUEVERDE}", $lms_graf_acciones_verde, $PRINCIPAL);
    $PRINCIPAL               = str_replace("{VALUEAMARILLO}", $lms_graf_acciones_amarillo, $PRINCIPAL);
    $PRINCIPAL               = str_replace("{VALUEROJO}", $lms_graf_acciones_rojo, $PRINCIPAL);
    $PRINCIPAL               = str_replace("{LMS_NUM_PENDIENTES}", $num_acciones_pendientes, $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocaChartAgradecimientos($PRINCIPAL, $id_empresa)
{
    $listado_por_Agradecimientos = DataChartAgradecimientos($id_empresa);
    foreach ($listado_por_Agradecimientos as $unico) {
        $linea_data .= "{name : '" . $unico->categoria . "', y : " . $unico->PromCat . "},";
    }
    $PRINCIPAL = str_replace("{DATA_VALUES_RECONOCE_GRACIAS_CHART}", ($linea_data), $PRINCIPAL);
    return ($PRINCIPAL);

}
function MiEquipo_2020_sgd_resumen_consolidado($PRINCIPAL, $id_empresa, $rut)
{
	$row .= file_get_contents("views/mi_equipo_consolidado/" . $id_empresa . "_sgd_resumen_2020.html");
	$listado_colaboradores = TotalUsuariosDependientesJefe($rut);
	$rango1=0;
	$rango2=0;
	$rango3=0;
	$rango4=0;
	$rango5=0;
	$metas1="";	$metas2="";$metas3="";$metas4="";$metas5="";
	foreach ($listado_colaboradores as $unico) {

	 //echo "<br>";	 print_r($unico);  
		
		//Traigo los datos desde la tabla sgd full
		$datos_sgd_full=DatosDesdeSgdFull($unico->rut, $rut);
		//echo $datos_sgd_full[0]->resultado_evaluacion_descendente_categoria;
		//print_r($datos_sgd_full);
		//echo "<br><br>";
		if($datos_sgd_full) $contador_usuarios++;
		if($datos_sgd_full[0]->resultado_evaluacion_descendente_categoria=="Bajo lo esperado"){
			$rango1++;
			
		}else if($datos_sgd_full[0]->resultado_evaluacion_descendente_categoria=="Puede mejorar"){
			$rango2++;
		}else if($datos_sgd_full[0]->resultado_evaluacion_descendente_categoria=="Cumple"){
			$rango3++;
		}else if($datos_sgd_full[0]->resultado_evaluacion_descendente_categoria=="Cumplimiento destacado"){
			$rango4++;
		}else if($datos_sgd_full[0]->resultado_evaluacion_descendente_categoria=="Cumplimiento con excelencia"){
			$rango5++;
		}
				
				
				
		$datos_sgd_metas=DatosDesdeSgdFullMetas($unico->rut, "2018",  $id_empresa);
//echo "<br>meta 	".$unico->rut;	print_r($datos_sgd_metas);
if(	$datos_sgd_metas[0]->categoria=="Bajo las Exigencias Mínimas"){
	$metas5++;
	$alt_txt_metas5.=$datos_sgd_metas[0]->nombre_completo." ";
}	
if(	$datos_sgd_metas[0]->categoria=="Bajo lo esperado"){
	$metas4++;
	$alt_txt_metas4.=$datos_sgd_metas[0]->nombre_completo." ";
}	
if(	$datos_sgd_metas[0]->categoria=="Destacado"){
	$metas3++;
	$alt_txt_metas3.=$datos_sgd_metas[0]->nombre_completo." ";
}	
if(	$datos_sgd_metas[0]->categoria=="Esperado"){
	$metas2++;
	$alt_txt_metas2.=$datos_sgd_metas[0]->nombre_completo." ";
}	
if(	$datos_sgd_metas[0]->categoria=="Excepcional"){
	$metas1++;
	$alt_txt_metas1.=$datos_sgd_metas[0]->nombre_completo." ";
}	
				

if($metas1>0){$linea_metas1=$metas1." <span data-tooltip='".$alt_txt_metas1."' data-tooltip-position='top'>&nbsp;<i class='fas fa-info-circle'></i></span>";}
if($metas2>0){$linea_metas2=$metas2." <span data-tooltip='".$alt_txt_metas2."' data-tooltip-position='top'>&nbsp;<i class='fas fa-info-circle'></i></span>";}
if($metas3>0){$linea_metas3=$metas3." <span data-tooltip='".$alt_txt_metas3."' data-tooltip-position='top'>&nbsp;<i class='fas fa-info-circle'></i></span>";}
if($metas4>0){$linea_metas4=$metas4." <span data-tooltip='".$alt_txt_metas4."' data-tooltip-position='top'>&nbsp;<i class='fas fa-info-circle'></i></span>";}
if($metas5>0){$linea_metas5=$metas5." <span data-tooltip='".$alt_txt_metas5."' data-tooltip-position='top'>&nbsp;<i class='fas fa-info-circle'></i></span>";}
		
		if($datos_sgd_full[0]->cuadrante_potencial==1 && $datos_sgd_full[0]->cuadrante_desempeno==1){
							$nombres_cuadrantes1.=$unico->nombre_completo." ";
							$cuadrante1++;
							
							$url_imagen=VerificaFotoPersonal($unico->rut);
							//$imagen_cuadrantes1.=$cuadrante1.'<img src="'.$url_imagen.'" alt="'.$unico->nombre_completo.'" class="img-circle width-30"><br>';
		}else if($datos_sgd_full[0]->cuadrante_potencial==2 && $datos_sgd_full[0]->cuadrante_desempeno==1){
							$cuadrante2++;
							$nombres_cuadrantes2.=$unico->nombre_completo." ";
							$url_imagen=VerificaFotoPersonal($unico->rut);
							//$imagen_cuadrantes1.='2<img src="'.$url_imagen.'" alt="'.$unico->nombre_completo.'" class="img-circle width-30"><br>';
		}else if($datos_sgd_full[0]->cuadrante_potencial==3 && $datos_sgd_full[0]->cuadrante_desempeno==1){
							$cuadrante3++;
							$nombres_cuadrantes3.=$unico->nombre_completo." ";
							$url_imagen=VerificaFotoPersonal($unico->rut);
							//$imagen_cuadrantes3.='3<img src="'.$url_imagen.'" alt="'.$unico->nombre_completo.'" class="img-circle width-30"><br>';
		}else if($datos_sgd_full[0]->cuadrante_potencial==1 && $datos_sgd_full[0]->cuadrante_desempeno==2){
							$cuadrante4++;
							$nombres_cuadrantes4.=$unico->nombre_completo." ";
							$url_imagen=VerificaFotoPersonal($unico->rut);
							$imagen_cuadrantes4.='4<img src="'.$url_imagen.'" alt="'.$unico->nombre_completo.'" class="img-circle width-30"><br>';
		}else if($datos_sgd_full[0]->cuadrante_potencial==2 && $datos_sgd_full[0]->cuadrante_desempeno==2){
							$cuadrante5++;
							$nombres_cuadrantes5.=$unico->nombre_completo."  ";
							$url_imagen=VerificaFotoPersonal($unico->rut);
							$imagen_cuadrantes5.='5<img src="'.$url_imagen.'" alt="'.$unico->nombre_completo.'" class="img-circle width-30"><br>';
		}else if($datos_sgd_full[0]->cuadrante_potencial==3 && $datos_sgd_full[0]->cuadrante_desempeno==2){
							$cuadrante6++;
							$nombres_cuadrantes6.=$unico->nombre_completo." ";
							$url_imagen=VerificaFotoPersonal($unico->rut);
							$imagen_cuadrantes6.='6<img src="'.$url_imagen.'" alt="'.$unico->nombre_completo.'" class="img-circle width-30"><br>';
		}else if($datos_sgd_full[0]->cuadrante_potencial==1 && $datos_sgd_full[0]->cuadrante_desempeno==3){
							$cuadrante7++;
							$nombres_cuadrantes7.=$unico->nombre_completo." ";
							$url_imagen=VerificaFotoPersonal($unico->rut);
							$imagen_cuadrantes7.=$cuadrante7;
							
							
							
		}else if($datos_sgd_full[0]->cuadrante_potencial==2 && $datos_sgd_full[0]->cuadrante_desempeno==3){
							$cuadrante8++;
							$nombres_cuadrantes8.=$unico->nombre_completo." ";
							$url_imagen=VerificaFotoPersonal($unico->rut);
							$imagen_cuadrantes8.='8<img src="'.$url_imagen.'" alt="'.$unico->nombre_completo.'" class="img-circle width-30"><br>';
		}else if($datos_sgd_full[0]->cuadrante_potencial==3 && $datos_sgd_full[0]->cuadrante_desempeno==3){
							$cuadrante9++; 
							$nombres_cuadrantes9.=$unico->nombre_completo." ";
							$url_imagen=VerificaFotoPersonal($unico->rut);
							$imagen_cuadrantes9.='9<img src="'.$url_imagen.'" alt="'.$unico->nombre_completo.'" class="img-circle width-30"><br>';
		}
				
	 }
	 
	$PRINCIPAL = str_replace("{MI_EQUIPO_SGD_RESUMEN_2020}", $row, $PRINCIPAL);
	
	$PRINCIPAL = str_replace("{RANGO1}", $rango1, $PRINCIPAL);
	$PRINCIPAL = str_replace("{RANGO2}", $rango2, $PRINCIPAL);
	$PRINCIPAL = str_replace("{RANGO3}", $rango3, $PRINCIPAL);
	$PRINCIPAL = str_replace("{RANGO4}", $rango4, $PRINCIPAL);
	$PRINCIPAL = str_replace("{RANGO5}", $rango5, $PRINCIPAL);

	$PRINCIPAL = str_replace("{METAS_1}", $linea_metas1, $PRINCIPAL);
	$PRINCIPAL = str_replace("{METAS_2}", $linea_metas2, $PRINCIPAL);
	$PRINCIPAL = str_replace("{METAS_3}", $linea_metas3, $PRINCIPAL);
	$PRINCIPAL = str_replace("{METAS_4}", $linea_metas4, $PRINCIPAL);
	$PRINCIPAL = str_replace("{METAS_5}", $linea_metas5, $PRINCIPAL);


	
	
	
//echo "<br>nombres_cuadrantes5 $cuadrante5 $nombres_cuadrantes5";
if($cuadrante1>0){$cuadrante1="<center><span style=''>".$cuadrante1."<span data-tooltip='".$nombres_cuadrantes1."' data-tooltip-position='top'>&nbsp;<i class='fas fa-info-circle'></i></span></span></center>";}
if($cuadrante2>0){$cuadrante2="<center><span style=''>".$cuadrante2."<span data-tooltip='".$nombres_cuadrantes2."' data-tooltip-position='top'>&nbsp;<i class='fas fa-info-circle'></i></span></span></center>";}
if($cuadrante3>0){$cuadrante3="<center><span style=''>".$cuadrante3."<span data-tooltip='".$nombres_cuadrantes3."' data-tooltip-position='top'>&nbsp;<i class='fas fa-info-circle'></i></span></span></center>";}
if($cuadrante4>0){$cuadrante4="<center><span style=''>".$cuadrante4."<span data-tooltip='".$nombres_cuadrantes4."' data-tooltip-position='top'>&nbsp;<i class='fas fa-info-circle'></i></span></span></center>";}
if($cuadrante5>0){$cuadrante5="<center><span style=''>".$cuadrante5."<span data-tooltip='".$nombres_cuadrantes5."' data-tooltip-position='top'>&nbsp;<i class='fas fa-info-circle'></i></span></span></center>";}
if($cuadrante6>0){$cuadrante6="<center><span style=''>".$cuadrante6."<span data-tooltip='".$nombres_cuadrantes6."' data-tooltip-position='top'>&nbsp;<i class='fas fa-info-circle'></i></span></span></center>";}
if($cuadrante7>0){$cuadrante7="<center><span style=''>".$cuadrante7."<span data-tooltip='".$nombres_cuadrantes7."' data-tooltip-position='top'>&nbsp;<i class='fas fa-info-circle'></i></span></span></center>";}
if($cuadrante8>0){$cuadrante8="<center><span style=''>".$cuadrante8."<span data-tooltip='".$nombres_cuadrantes8."' data-tooltip-position='top'>&nbsp;<i class='fas fa-info-circle'></i></span></span></center>";}
if($cuadrante9>0){$cuadrante9="<center><span style=''>".$cuadrante9."<span data-tooltip='".$nombres_cuadrantes9."' data-tooltip-position='top'>&nbsp;<i class='fas fa-info-circle'></i></span></span></center>";}
	
	
	$PRINCIPAL = str_replace("{CUADRANTE_1}", "".$cuadrante1."", $PRINCIPAL);
	$PRINCIPAL = str_replace("{CUADRANTE_2}", "".$cuadrante2."", $PRINCIPAL);
	$PRINCIPAL = str_replace("{CUADRANTE_3}", "".$cuadrante3."", $PRINCIPAL);
	$PRINCIPAL = str_replace("{CUADRANTE_4}", "".$cuadrante4."", $PRINCIPAL);
	$PRINCIPAL = str_replace("{CUADRANTE_5}", "".$cuadrante5."", $PRINCIPAL);
	$PRINCIPAL = str_replace("{CUADRANTE_6}", "".$cuadrante6."", $PRINCIPAL);
	$PRINCIPAL = str_replace("{CUADRANTE_7}", "".$cuadrante7."", $PRINCIPAL);
	$PRINCIPAL = str_replace("{CUADRANTE_8}", "".$cuadrante8."", $PRINCIPAL);
	$PRINCIPAL = str_replace("{CUADRANTE_9}", "".$cuadrante9."", $PRINCIPAL);
	

	
	/*
	
	$PRINCIPAL = str_replace("{TOOLTIP_1_1}", "<small>".$nombres_cuadrantes1."</small>", $PRINCIPAL);
	$PRINCIPAL = str_replace("{TOOLTIP_1_2}", "<small>".$nombres_cuadrantes2."</small>", $PRINCIPAL);
	$PRINCIPAL = str_replace("{TOOLTIP_1_3}", "<small>".$nombres_cuadrantes3."</small>", $PRINCIPAL);
	$PRINCIPAL = str_replace("{TOOLTIP_2_1}", "<small>".$nombres_cuadrantes4."</small>", $PRINCIPAL);
	$PRINCIPAL = str_replace("{TOOLTIP_2_2}", "<small>".$nombres_cuadrantes5."</small>", $PRINCIPAL);
	$PRINCIPAL = str_replace("{TOOLTIP_2_3}", "<small>".$nombres_cuadrantes6."</small>", $PRINCIPAL);
	$PRINCIPAL = str_replace("{TOOLTIP_3_1}", "<small>".$nombres_cuadrantes7."</small>", $PRINCIPAL);
	$PRINCIPAL = str_replace("{TOOLTIP_3_2}", "<small>".$nombres_cuadrantes8."</small>", $PRINCIPAL);
	$PRINCIPAL = str_replace("{TOOLTIP_3_3}", "<small>".$nombres_cuadrantes9."</small>", $PRINCIPAL);
	*/
	$total=count($listado_colaboradores);
	$PRINCIPAL = str_replace("{POR_RANGO1}", round(($rango1*100)/$contador_usuarios), $PRINCIPAL);
	$PRINCIPAL = str_replace("{POR_RANGO2}", round(($rango2*100)/$contador_usuarios), $PRINCIPAL);
	$PRINCIPAL = str_replace("{POR_RANGO3}", round(($rango3*100)/$contador_usuarios), $PRINCIPAL);
	$PRINCIPAL = str_replace("{POR_RANGO4}", round(($rango4*100)/$contador_usuarios), $PRINCIPAL);
	$PRINCIPAL = str_replace("{POR_RANGO5}", round(($rango5*100)/$contador_usuarios), $PRINCIPAL);
	
	
 
	return ($PRINCIPAL);		
}	
function RowColaboradoresPorRutConDatos_equipo_consolidado($PRINCIPAL, $id_empresa, $rut)
{
	$listado_colaboradores = TotalUsuariosDependientesJefe($rut);
	 foreach ($listado_colaboradores as $unico) {
		$array_res[5]=0;
        $array_res=BuscaCountResultadosMiEquipo($unico->rut,$id_empresa);
				$row .= file_get_contents("views/mi_equipo_consolidado/" . $id_empresa . "_row_mi_equipo.html");
				$row = str_replace("{RUT_COLABORADOR}", $unico->rut, $row);
				$row = str_replace("{NOMBRE_COLABORADOR}", $unico->nombre_completo, $row);
        $row = str_replace("{CARGO_COLABORADOR}", $unico->cargo, $row);
        $row = str_replace("{AVATAR_COLABORADOR}", VerificaFotoPersonal($unico->rut), $row);
        $row = str_replace("{PROM_DESEMPENO}",          $array_res[4], $row);
        $row = str_replace("{NUM_AGRA_RECIBIDOS}",      $array_res[1], $row);
        $row = str_replace("{NUM_RECO_RECIBIDOS}",      $array_res[2], $row);
        $row = str_replace("{NUM_CURSOS_REALIZADOS}",   $array_res[3], $row);
        $row = str_replace("{NUM_LOGROS}",   			$array_res[6], $row);
				$rut_enc=($unico->rut);
				if($array_res[5]>0){
					$boton_ver_equipo	=	"<a href='?sw=mi_equipo_consolidado&r_enc=".Encodear4($rut_enc)."' class='btn btn-info'>Ver Equipo</a>";
				} else {
					$boton_ver_equipo	=	"<br><br>";
				}
				$boton_ver_mas		=	"<a href='?sw=mi_equipo_consolidado_ficha&r_enc=".Encodear4($rut_enc)."' class='btn btn-info'>Ver Ficha Personal</a>";
	      $row = str_replace("{VER_EQUIPO}",   $boton_ver_equipo, $row);
	      $row = str_replace("{VER_MAS}",   $boton_ver_mas, $row);
        if($array_res[4]>0){
					 $array4= $array_res[4]+ $array4;
      	   $cuenta4++;
         }
        $array6=$array_res[6]+$array6;		 
				$array3=$array_res[3]+$array3;
        $array2=$array_res[2]+$array2;
        $array1=$array_res[1]+$array1;
	 }
		 		$array4_avg=round($array4/$cuenta4,2);
    $PRINCIPAL = str_replace("{PROM_DESEMPENO}",        $array4_avg, $PRINCIPAL);
    $PRINCIPAL = str_replace("{NUM_AGRA_RECIBIDOS}", $array1, $PRINCIPAL);
    $PRINCIPAL = str_replace("{NUM_RECO_RECIBIDOS}", $array2, $PRINCIPAL);
    $PRINCIPAL = str_replace("{NUM_CURSOS_REALIZADOS}", $array3, $PRINCIPAL);
    $PRINCIPAL = str_replace("{NUM_LOGROS}", $array6, $PRINCIPAL);
		$PRINCIPAL = str_replace("{ROW_LISTA_MI_EQUIPO}", $row, $PRINCIPAL);
		$PRINCIPAL = str_replace("{RANGO1}", $rango1, $PRINCIPAL);
		$PRINCIPAL = str_replace("{RANGO2}", $rango2, $PRINCIPAL);
		$PRINCIPAL = str_replace("{RANGO3}", $rango3, $PRINCIPAL);
		$PRINCIPAL = str_replace("{RANGO4}", $rango4, $PRINCIPAL);
		$PRINCIPAL = str_replace("{RANGO5}", $rango5, $PRINCIPAL);
    return ($PRINCIPAL);
}
function colocarColaboradoresPorRutConDatos_lms_lider($PRINCIPAL, $id_empresa, $rut, $id_programa_bbdd, $id_curso, $id_objeto, $ajax)
{

//echo       // "<br>colocarColaboradoresPorRutConDatos_lms_lider  $id_programa_bbdd, $id_curso ";

    $listado_colaboradores = TotalUsuariosPorRutJefe($rut);
    if (count($listado_colaboradores) == 0) {
        $listado_colaboradores = TotalUsuariosPorRutJefeResponsable($rut);
    }
    if ($_GET["sw"] == "mi_perfil_esc") {
        $listado_colaboradores = TotalUsuariosMiRut($rut);
    }
    $acumulador_nota_final  = 0;
    $contador_colaboradores = 0;

    foreach ($listado_colaboradores as $unico) {
      //print_r($unico);
        //$row.=file_get_contents("views/miperfil/row_colaboradores_miperfil.html");
        //$row.=file_get_contents("views/mi_equipo_lms/row_equipo_resumen.html");
        //ActualizaTablatblLmsReportePorRut($unico->rut);
        $datos_integracion     = lms_integracion_programas($unico->rut, $id_empresa, "equipo", $id_programa_bbdd, $id_curso, $id_objeto);
        //print_r($datos_integracion);
        $acumulador_nota_final = $acumulador_nota_final + $datos_integracion[1];
        $contador_colaboradores++;
        //$row = str_replace("{ROW_LISTA_PROGRAMAS}",utf8_decode($datos_integracion[0]),$row);
        //$row.=file_get_contents("views/mi_equipo_lider/".$id_empresa."_row_equipo_resumen.html");
        //$row = str_replace("{TRIVIAS}",$datos_integracion[2]." &nbsp;&nbsp;Ver Ficha <a href='?sw=fichasTrivias'>aca</a>",$row);
        //echo "<br>".$unico->rut." ".$id_programa_bbdd;
        //print_r($datos_integracion[2]);
        if ($ajax == "ajax") {
                $row .= file_get_contents("views/mi_equipo_lider/" . $id_empresa . "_row_equipo_resumen_ajax.html");
        } else {
                $row .= file_get_contents("views/mi_equipo_lider/" . $id_empresa . "_row_equipo_resumen.html");
        }
         //echo "<br>hola1";
        $buscaCursosHistoricosAprobados=VistaCursosHistoricosResumenData($unico->rut, $id_empresa);
        $cuentaApro=0;$cuentaCursos=0;
        foreach ($buscaCursosHistoricosAprobados as $unicoRow)

        {
                if($unicoRow->estado=="APROBADO"){
                    $cuentaApro++;
                }
                $cuentaCursos++;
        }
        $rut_enco=Encodear3($unico->rut);
        $row_historicos="

                            <span class='badge badge-info'><span class='blanco'>".$cuentaCursos."</span> </span> <span class=' font-blue'> cursos realizados</span>
                            <span class='badge badge-primary'><span class='blanco'>     ".$cuentaApro."</span> </span><span class=' font-blue'>  cursos aprobados</span>
                            <a href='?sw=lms_lista_historicos&rut_enc=".$rut_enco."' class='btn btn-info btn-sm' ><span class='blanco'>Ver Cursos Históricos</span></a>
                            <br>
                        ";

        $row                = str_replace("{ROW_HISTORICOS}", utf8_decode($row_historicos), $row);

        $row                = str_replace("{ROW_LISTA_PROGRAMAS_mi_equipo_lider}", utf8_decode($datos_integracion[0]), $row);
        //echo "<br>hola2";

        $row                = str_replace("{RUT_JEFE}", $unico->rut, $row);
        $array_Reco_Gracias = BuscaDatosReconocimientoAgradecimientos($unico->rut, $id_empresa);
        if ($array_Reco_Gracias[0]->num_gracias > 0) {
            $num_gracias = $array_Reco_Gracias[0]->num_gracias;
        } else {
            $num_gracias = 0;
        }
        if ($array_Reco_Gracias[0]->num_reconocimientos > 0) {
            $num_reconocimientos = $array_Reco_Gracias[0]->num_reconocimientos;
        } else {
            $num_reconocimientos = 0;
        }
        $row = str_replace("{NUM_RECONOCIMIENTOS}", $num_reconocimientos, $row);
        $row = str_replace("{NUM_GRACIAS}", $num_gracias, $row);
        if ($datos_integracion[2]) {
            $row = str_replace("{TRIVIAS}", file_get_contents("views/mi_equipo_lider/" . $id_empresa . "_boton_ver_trivias.html"), $row);
            if ($id_objeto) {
                $datos_objeto = DatosObjeto($id_objeto);
                $row          = str_replace("{OBJETO}", $datos_objeto[0]->titulo, $row);
            } else {
                $row = str_replace("{OBJETO}", "", $row);
            }
            $row = str_replace("{PROMEDIO_TRIVIAS_POR_PROGRAMA}", $datos_integracion[2], $row);
            $row = str_replace("{PROMEDIO_TRIVIAS_POR_PROGRAMA_1A7}", ColocaNotaConvertidaTrivia($datos_integracion[2]), $row);
            $row = str_replace("{RUT_COLABORADOR_ENCODADO}", Encodear3($unico->rut), $row);
        } else {
            $row = str_replace("{TRIVIAS}", "", $row);
        }
        $datos_mallapersona = buscamalla($unico->rut, $id_empresa);
        $datos_mallapersona[0]->id_malla;
        $datos_malla        = DatosMalla($datos_mallapersona[0]->id_malla);
        $datos_consolidados = TienePuntosConsolidadosPorMalla($unico->rut, $id_empresa, $datos_mallapersona[0]->id_malla);
        $row                = str_replace("{PUNTOS}", $datos_consolidados[0]->puntos, $row);
        $promedio_trivias   = PromedioTrivias($unico->rut, $id_empresa);
        if (!$promedio_trivias[0]->promedio_trivias) {
            $row = str_replace("{PROMEDIO}", "0", $row);
        } else {
            $row = str_replace("{PROMEDIO}", round($promedio_trivias[0]->promedio_trivias), $row);
        }
        if ($promedio_trivias[0]->promedio_trivias > 0) {
            $row = str_replace("{PODERES}", "<img src='img/61_rf_badges_5.png' width='20'>", $row);
        } else {
            $row = str_replace("{PODERES}", "", $row);
        }
        $medallas = "";
        for ($k = 1; $k <= $datos_consolidados[0]->medallas; $k++) {
            $medallas .= "<img src='img/rf_medal.png'>";
        }
        //$row = str_replace("{MEDALLAS}",$datos_consolidados[0]->medallas,$row);
        $row               = str_replace("{MEDALLAS}", $medallas, $row);
        $arreglo_subequipo = TotalUsuariosPorRutJefe($unico->rut);
        $num_subequipo     = count($arreglo_subequipo);
        if ($num_subequipo > 0) {
            $mi_equipo_ver_equipo = "<span class='label-small label-small-info  pull-right'>Ver Equipo <span class='badge'>" . $num_subequipo . " <i class='icon-people icons'></i></span> </span>";
        } else {
            $mi_equipo_ver_equipo = "";
        }
        $row = str_replace("{NOMBRE}", $unico->nombre . " " . $unico->apaterno . " " . $unico->amaterno, $row);
        $row = str_replace("{CARGO}", $unico->cargo, $row);
        $row = str_replace("{GERENCIA}", $unico->gerencia, $row);
        $row = str_replace("{FECHA_CUMPLEANOS}", formatearFecha($unico->fecha_nacimiento), $row);
        $row = str_replace("{URL_PERSONA}", VerificaFotoPersonal($unico->rut), $row);
        $row = str_replace("{RUT_ENCODEADO}", Encodear3($unico->rut), $row);
        $row = str_replace("{MALLA}", ($datos_malla[0]->nombre), $row);
        $row = str_replace("{MIEQUIPO_VER_EQUIPO}", ($mi_equipo_ver_equipo), $row);
        $row = str_replace("{NUM_MIEQUIPO_VER_EQUIPO}", ($num_subequipo), $row);
        $row = str_replace("{RUT_COL}", ($unico->rut), $row);

    //echo "<br>hola3";


 list($total_inscripciones, $total_aprobados, $total_reprobados, $total_en_proceso) = CAPACITACION_DatosGeneralesPorUsuario($unico->rut);
        $estado                           = EntregaEstadoAvanceBarraMalla(EntregaPorcentaje($total_inscripciones, $total_aprobados));
        $listado_colaborador_sub          = TotalUsuariosPorRutJefe($unico->rut);
        $num_reportes_sub                 = count($listado_colaborador_sub);
        $accion                           = Lms_Busca_Acciones_Pendientes($rut, $unico->rut, $id_empresa);
        $preguntaspendientes              = Lms_Busca_Preguntas_Pendientes($rut, $unico->rut, $id_empresa);
        //echo "<pre>";
        //print_r($preguntaspendientes);
        //$row = str_replace("{TRIVIAS}",("TRIVIAS"),$row);
        $row                              = str_replace("{ACCION}", ($accion), $row);
        $row                              = str_replace("{PREGUNTAS}", ($preguntaspendientes), $row);
        //Desafios Finaliados
        $desafios_finalizados             = TraigoDesafiosFinalizados($unico->rut, $id_empresa);
        $row                              = str_replace("{DESAFIOS_FINALIZADOS}", count($desafios_finalizados), $row);
        $avance                           = round(EntregaPorcentaje($total_inscripciones, $total_aprobados));
        //    echo "<br>$avance";
        $acumulador_avance_colaboradores  = $acumulador_avance_colaboradores + EntregaPorcentaje($total_inscripciones, $total_aprobados);
        $PRINCIPAL                        = str_replace("{NUMERO_AVANCE}", round(EntregaPorcentaje($total_inscripciones, $total_aprobados)), $PRINCIPAL);
        $PRINCIPAL                        = str_replace("{COLOR_PROGRESS_BAR}", $estado[0], $PRINCIPAL);
        $row                              = str_replace("{AVANCE_COLABORADOR}", EntregaPorcentaje($total_inscripciones, $total_aprobados), $row);
        //$total_visitas=TotalVisitasDadoRutCaseEmpresaFront($unico->rut, $id_empresa, "home_minvest");
        $row                              = str_replace("{NUM_VISITAS_COLABORADOR}", $total_visitas[0]->total_visitas, $row);
        $acumulador_visitas_colaboradores = $acumulador_visitas_colaboradores + $total_visitas[0]->total_visitas;
        $cuenta_colaborador++;
        $preguntasPendiente       = Lms_Cuenta_Preguntas_Pendientes_data($unico->rut, $id_empresa);
        $num_preguntas_pendientes = $preguntasPendiente[0]->pendientes + $num_preguntas_pendientes;
        //print_r($preguntasPendiente);
        //echo "<br>num_preguntas_pendientes $num_preguntas_pendientes";
        $num_preguntas_realizadas = $preguntasPendiente[0]->realizadas + $num_preguntas_realizadas;
    }


    $accionesPendiente          = Lms_Cuenta_Acciones_Pendientes_data_lider($rut, $id_empresa);
    $num_acciones_pendientes    = $accionesPendiente[0]->pendientes;
    $num_acciones_realizadas    = $accionesPendiente[0]->realizadas;
    //echo "<br>hola4";

    //echo "cuentacolaborador $cuenta_colaborador, nun acciones $num_acciones_pendientes, $num_acciones_realizadas";
    //echo "100*$acumulador_avance_colaboradores/$cuenta_colaborador";
    $sum_verde                  = round(100 * $num_acciones_realizadas / $cuenta_colaborador);
    $sum_amarillo               = 0;
    $sum_rojo                   = round(100 * $num_acciones_pendientes / $cuenta_colaborador);
    $sum_avanceequipo           = round($acumulador_avance_colaboradores / $cuenta_colaborador);
    $lms_avance_equipo          = $sum_avanceequipo;
    $lms_graf_acciones_rojo     = $sum_rojo;
    $lms_graf_acciones_amarillo = $sum_amarillo;
    $lms_graf_acciones_verde    = $sum_verde;
    $promedio_final             = $acumulador_nota_final / $contador_colaboradores;
    $PRINCIPAL                  = str_replace("{VALOR_PROMEDIO}", round($promedio_final), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{NUM_PERSONAS_MI_EQUIPO}", count($listado_colaboradores), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{PROMEDIO_EQUIPO}", round($acumulador_avance_colaboradores / count($listado_colaboradores)), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{NUM_VISITAS_MI_EQUIPO}", $acumulador_visitas_colaboradores, $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{BLOQUE_COLABORADORES}", utf8_encode($row), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{LMS_GRAFICO_1COLOR}", file_get_contents("views/mi_equipo_lms/" . $id_empresa . "_barra_1color.html"), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{LMS_AVANCEEQUIPO}", $lms_avance_equipo, $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{LMS_GRAFICO_3COLORES}", file_get_contents("views/mi_equipo_lms/" . $id_empresa . "_barra_3colores.html"), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{VALUEVERDE}", $lms_graf_acciones_verde, $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{VALUEAMARILLO}", $lms_graf_acciones_amarillo, $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{VALUEROJO}", $lms_graf_acciones_rojo, $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{LMS_NUM_PENDIENTES}", $num_acciones_pendientes, $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{LMS_NUM_REALIZADOS}", $num_acciones_realizadas, $PRINCIPAL);
    //AVANCE GLOBAL Y POR C1,C2, C3, C4
    $arra_usu                   = busca_c1_c2_c3_c4_jefe($rut, $id_empresa);
    //print_r($arra_usu);
    $c1                         = $arra_usu[0]->c1;
    $c2                         = $arra_usu[0]->c2;
    $c3                         = $arra_usu[0]->c3;
    $c4                         = $arra_usu[0]->c4;
    $jefe                       = $arra_usu[0]->jefe;
    //echo "<br>c1 $c1, c2 $c2, c3 $c3, c4 $c4, jefe $jefe<br>";
    $data_array_avance          = lms_avance_promedio_c1_c2_c3_c4_jefe($rut, $c1, $c2, $c3, $c4, $jefe, $programa, $curso, $id_empresa);
    //print_r($data_array_avance);
    $PRINCIPAL                  = str_replace("{AVANCE_PROM_TOTAL}", round($data_array_avance[5], 0), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{AVANCE_PROM_JEFE}", round($data_array_avance[4], 0), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{AVANCE_PROM_C1}", round($data_array_avance[0], 0), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{AVANCE_PROM_C2}", round($data_array_avance[1], 0), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{AVANCE_PROM_C3}", round($data_array_avance[2], 0), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{AVANCE_PROM_C4}", round($data_array_avance[3], 0), $PRINCIPAL);
    $PRINCIPAL                  = str_replace("{AVANCE_PROM_IND}", round($data_array_avance[6], 0), $PRINCIPAL);

  $listaProgramas_Select      = lms_integracion_lista_programasSinRut($id_empresa, $rut);
    $options_select_programa    = "";
    foreach ($listaProgramas_Select as $prog) {
        if ($id_programa_bbdd == $prog->id_programa) {
            $options_select_programa .= "<option value='" . $prog->id_programa . "' selected='selected'>" . $prog->nombre_programa . "</option>";
        } else {
            $options_select_programa .= "<option value='" . $prog->id_programa . "'>" . $prog->nombre_programa . "</option>";
        }
    }
    $PRINCIPAL = str_replace("{OPTIONS_PROGRAMAS_BBDD}", utf8_encode($options_select_programa), $PRINCIPAL);
    if ($id_programa_bbdd) {
        $arreglo_post   = $_POST;
        $cursos         = REL_MALLA_CURSO_TraeCursosDadoPrograma2($id_empresa, $arreglo_post);
        $options_cursos = "";
        foreach ($cursos as $prog) {
            if ($prog->id_curso == $id_curso) {
                $options_cursos .= "<option value='" . $prog->id_curso . "' selected>" . $prog->nombre . " (" . $prog->id_curso . ")</option>";
            } else {
                $options_cursos .= "<option value='" . $prog->id_curso . "'>" . $prog->nombre . " (" . $prog->id_curso . ")</option>";
            }
        }
    }
    $PRINCIPAL = str_replace("{OPTIONS_CURSOS}", utf8_encode($options_cursos), $PRINCIPAL);
    //Objetos
    if ($id_curso) {
        $objetos = CHECK_ObjetosPorCurso($arreglo_post["cursos"]);
        $options = "";
        foreach ($objetos as $obj) {
            if ($obj->id == $id_objeto) {
                $options .= "<option selected value='" . $obj->id . "'>" . $obj->titulo . "</option>";
            } else {
                $options .= "<option value='" . $obj->id . "'>" . $obj->titulo . "</option>";
            }
        }
        $PRINCIPAL = str_replace("{OPTIONS_OBJETOS}", utf8_encode($options), $PRINCIPAL);
    }
    //Mallas
    $mallas = MallasPorEmpresa2($id_empresa);
    foreach ($mallas as $mal) {
        if ($mal->nombre <> '') {
            $options_mallas .= "<option value='" . $mal->id . "'>" . $mal->nombre . "</option>";
        }
    }
    $PRINCIPAL            = str_replace("{OPTIONS_MALLAS}", utf8_encode($options_mallas), $PRINCIPAL);
    //Mensajes_por Agente
    $total_respondidas    = 0;
    $total_no_respondidas = 0;
    $mensajes_por_Agente  = TraeMensajesPorAgente($rut, $id_empresa);
    foreach ($mensajes_por_Agente as $mensaje) {
        if ($mensaje->total_respuestas_agente > 0) {
            $total_respondidas++;
        } else {
            $total_no_respondidas++;
        }
    }
    //$PRINCIPAL = str_replace("{LMS_NUM_PREGUNTAS_PENDIENTES}",$num_preguntas_pendientes,$PRINCIPAL);
    //$PRINCIPAL = str_replace("{LMS_NUM_PREGUNTAS_REALIZADOS}",$num_preguntas_realizadas,$PRINCIPAL);
    $array_Reco_Gracias = BuscaDatosReconocimientoAgradecimientos($unico->rut, $id_empresa);
    if ($array_Reco_Gracias[0]->num_gracias > 0) {
        $num_gracias = $array_Reco_Gracias[0]->num_gracias;
    } else {
        $num_gracias = 0;
    }
    if ($array_Reco_Gracias[0]->num_reconocimientos > 0) {
        $num_reconocimientos = $array_Reco_Gracias[0]->num_reconocimientos;
    } else {
        $num_reconocimientos = 0;
    }
    $PRINCIPAL = str_replace("{NUM_RECONOCIMIENTOS}", $num_reconocimientos, $PRINCIPAL);
    $PRINCIPAL = str_replace("{NUM_GRACIAS}", $num_gracias, $PRINCIPAL);
    $PRINCIPAL = str_replace("{LMS_NUM_PREGUNTAS_PENDIENTES}", $total_no_respondidas, $PRINCIPAL);
    $PRINCIPAL = str_replace("{LMS_NUM_PREGUNTAS_REALIZADOS}", $total_respondidas, $PRINCIPAL);
    return ($PRINCIPAL);
}
function ListadoColaboradoresObjetivos($html, $evaluador, $rut_evaluado, $id_bitacora, $sgd_version, $id_proceso)
{
    $evaluados                     = TraeRelacionesSinAe($evaluador, $id_proceso);
    $total_html                    = file_get_contents("views/sgd/bitacora/entorno_bloque_principal_chilquinta.html");
    $row_template                  = file_get_contents("views/sgd/listado_colaboradores/row_colaboradores_objetivo.html");
    $row                           = "";
    $ok_finalizado                 = 0;
    $html                          = str_replace("{SECCION_EQUIPO_CONSOLIDADO}", file_get_contents("views/sgd/bitacora/vista_consolidada_equipo.html"), $html);
    $html                          = str_replace("{GRAFICO}", file_get_contents("views/sgd/graficos/graficoBarraBitacora.html"), $html);
    $total_positivas_por_evaluador = 0;
    $total_negativas_por_evaluador = 0;
    foreach ($evaluados as $evaluado) {
        $row .= $row_template;
        $objetivos_validados_por_validador = VerificaSiObjetivosEstanValidados($evaluado->evaluado);
        //$row=FormularioIngresaObjetivos($row, $evaluado->evaluado, $evaluador);
        $row                               = ColocaDatosUsuario($row, $evaluado->evaluado, "bitacora");
        $row                               = str_replace("{BOTON_BITACORA}", file_get_contents("views/sgd/listado_colaboradores/boton_ingresa_objetivos.html"), $row);
        //$valores_objetivos=ListadoObjetivosAValidar($evaluado->evaluado, $evaluador, $id_objetivo, "jefe");
        $valores_objetivos                 = ListadoIngresoBitacoras($evaluado->evaluado, $evaluador, $id_bitacora, "jefe");
        $row                               = str_replace("{LISTADO_OBJETIVOS_A_EVALUAR}", $valores_objetivos, $row);
        $row                               = str_replace("{ID_PROCESO_ENCODEADO}", Encodear3($id_proceso), $row);
        $ponderaciones_bases               = DevuelvePonderacionesPorEvaluado($evaluado->evaluado);
        $verifica_evaluado_validado        = VerificaSiObjetivosEstanAjustados($evaluado->evaluado);
        if ($rut_evaluado == $evaluado->evaluado) {
            $row = str_replace("{FORMULARIO_INGRESO}", file_get_contents("views/sgd/objetivos/formulario.html"), $row);
            $row = str_replace("{OPTIONS_VALORES}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_bitacora_valores", "", "valor", "id", "order by valor asc", $_SESSION["id_empresa"]), $row);
        } else {
            $row = str_replace("{FORMULARIO_INGRESO}", "", $row);
        }
        $row                           = str_replace("{RUT_ENCODEADO}", Encodear3($evaluado->evaluado), $row);
        $row                           = str_replace("{RUT_EVALUADO}", ($evaluado->evaluado), $row);
        //Veo cuantas posotivas y cuantas negativas tiene
        $positivas                     = VerificaBitacorasPositivasNegativas($evaluado->evaluado, "si");
        $negativas                     = VerificaBitacorasPositivasNegativas($evaluado->evaluado, "no");
        $row                           = str_replace("{X_POSITIVAS}", count($positivas), $row);
        $row                           = str_replace("{X_NEGATIVAS}", count($negativas), $row);
        $total_positivas_por_evaluador = $total_positivas_por_evaluador + count($positivas);
        $total_negativas_por_evaluador = $total_negativas_por_evaluador + count($negativas);
        $row                           = str_replace("{CANTIDAD}", count($positivas) + count($negativas), $row);
        $row                           = str_replace("{BOTON_JEFE_VALIDA_OBJETIVOS}", "", $row);
        $row                           = str_replace("{TOTAL_SUMA_PONDERACION}", $valores_objetivos[1], $row);
        $row                           = str_replace("{PONDERACION_OBJETIVOS_INDIVIDUALES}", $ponderaciones_bases[2], $row);
        if ($valores_objetivos[1] == $ponderaciones_bases[2]) {
            $row = str_replace("{OK}", "OK", $row);
        } else {
            $row = str_replace("{OK}", "", $row);
        }
        $row = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($evaluado->evaluado), $row);
        if ($valores_objetivos[1] == $ponderaciones_bases[2]) {
            $ok_finalizado++;
        }
        //ACA veo si es que tiene comentarios de rechazo
        $comentarios           = ObtenerObjetivosDeRechazoUltimo($evaluado->evaluado);
        $comentarios_validador = "";
        foreach ($comentarios as $com) {
            $comentarios_validador .= $com->comentario . "<br>";
        }
        $row = str_replace("{COMENTARIOS_VALIDADOR}", $comentarios_validador, $row);
    }
    $total_total = ($total_negativas_por_evaluador + $total_positivas_por_evaluador);
    $html        = str_replace("{TOTAL_POSITIVAS}", ColocaDecimalesNotasFinales(0, ($total_positivas_por_evaluador * 100) / $total_total), $html);
    $html        = str_replace("{TOTAL_NEGATIVAS}", ColocaDecimalesNotasFinales(0, ($total_negativas_por_evaluador * 100) / $total_total), $html);
    $html        = str_replace("{TOTAL_POR_EVALUADOR}", $total_total, $html);
    $html        = str_replace("{TOTAL_EVALUADOR_POSITIVAS}", ($total_positivas_por_evaluador), $html);
    $html        = str_replace("{TOTAL_EVALUADOR_NEGATIVAS}", ($total_negativas_por_evaluador), $html);
    $total_html  = str_replace("{LISTADO_COLABORADORES}", ($row), $total_html);
    $html        = str_replace("{ENTORNO_LISTADO_EVALUACION}", ($total_html), $html);
    return ($html);
}
function EntregaEstadoAvanceBarraMalla($valor)
{
    if ($valor < 50) {
        $arreglo[0] = "etiquetaPrograma-reprobado";
    } else if ($valor < 75) {
        $arreglo[0] = "etiquetaPrograma-proceso";
    } else if ($valor >= 75) {
        $arreglo[0] = "etiquetaPrograma-aprobado";
    }
    return ($arreglo);
}
function EntregaPorcentaje($total, $valor)
{
    if($total>0){
        return (FormatearPorcentajes(($valor * 100) / $total));
        }
}
function ColocaDatosCampusPuntos($PRINCIPAL, $rut, $id_empresa, $tipo_llamada, $filtro_desde_admin)
{
    //La variable tipo_llamada, se utiliza para cuando se llama desde el administrador
    $puntos = 0;
    //echo "<br><br>2724 ColocaDatosCampusPuntos tipo llamada $tipo_llamada, $filtro_desde_Admin";
    //$datos  = GAMIFICACIONTienePuntosAcumuladosPorRutEmpresa($rut, $id_empresa, $filtro_desde_admin);
    //print_r($datos); exit();
    if ($datos[0]->avatar) {
        if ($id_empresa == '59' or $id_empresa == '75' or $id_empresa == '22') {
            $PRINCIPAL = str_replace("{URL_PERSONA}", "" . $datos[0]->avatar, $PRINCIPAL);
        } else {
            $PRINCIPAL = str_replace("{URL_PERSONA}", "img/avatars/$id_empresa/" . $datos[0]->avatar, $PRINCIPAL);
        }
    } else {
        $PRINCIPAL = str_replace("{URL_PERSONA}", VerificaFotoPersonal($rut), $PRINCIPAL);
    }
    for ($tot = 1; $tot <= $datos[0]->medallas; $tot++) {
        //$html_medallas.="<img src='img/".$datos[0]->imagenmedalla."'>";
        $imagen_medalla = $datos[0]->imagenmedalla;
        if ($imagen_medalla == "") {
            $imagen_medalla_array = buscaimagenmedallamalla($rut, $id_empresa);
            $imagen_medalla       = $imagen_medalla_array[0]->imagenmedallamalla;
            $html_medallas .= "<img src='img/$imagen_medalla' width='24' height='24'>";
        } else {
            $html_medallas .= "<img src='img/$imagen_medalla'  width='24' height='24'>";
        }
    }
    $PRINCIPAL = str_replace("{IMAGENMEDALLAS}", $html_medallas, $PRINCIPAL);
    if ($datos[0]->puntosconsolidados === 0 or $datos[0]->puntosconsolidados > 0) {
        $puntos = $datos[0]->puntosconsolidados;
    }
    if ($puntos === 0 and $datos[0]->puntos > 0) {
        $puntos = $datos[0]->puntos;
    }
    //$PRINCIPAL = str_replace("{PUNTOS}",$datos[0]->puntos,$PRINCIPAL);
    //$PRINCIPAL = str_replace("{PUNTOS}",$datos[0]->puntosconsolidados,$PRINCIPAL);
    $PRINCIPAL     = str_replace("{PUNTOS}", $puntos, $PRINCIPAL);
    $PRINCIPAL     = str_replace("{NUMNIVEL}", $datos[0]->numnivel, $PRINCIPAL);
    $PRINCIPAL     = str_replace("{NOMBRENIVELPERSONA}", $datos[0]->descripcion_nivel, $PRINCIPAL);
    $PRINCIPAL     = str_replace("{DESCRIPCIONNIVEL}", utf8_encode($datos[0]->texto_descripcion_nivel), $PRINCIPAL);
    $PRINCIPAL     = str_replace("{TEXTOACCION}", utf8_encode($datos[0]->textoaccion), $PRINCIPAL);
    $PRINCIPAL     = str_replace("{IMAGENNIVEL}", utf8_encode($datos[0]->imagenmiperfil), $PRINCIPAL);
    $PRINCIPAL     = str_replace("{RANKING}", "-", $PRINCIPAL);
    $PRINCIPAL     = str_replace("{MEDALLAS}", $datos[0]->medallas, $PRINCIPAL);
    $PRINCIPAL     = str_replace("{CAMPO1}", utf8_encode($datos[0]->campo1), $PRINCIPAL);
    $PRINCIPAL     = str_replace("{CAMPO2}", $datos[0]->campo2, $PRINCIPAL);
    $PRINCIPAL     = str_replace("{CAMPO3}", $datos[0]->campo3, $PRINCIPAL);
    $PRINCIPAL     = str_replace("{CAMPO4}", $datos[0]->campo4, $PRINCIPAL);
    $PRINCIPAL     = str_replace("{EMAIL}", $datos[0]->email, $PRINCIPAL);
    //echo "rut $rut, c3".$datos[0]->campo3." c4 ".$datos[0]->campo4;
    $PRINCIPAL     = str_replace("{RUT_EVALUADO}", $rut, $PRINCIPAL);
    $PRINCIPAL     = str_replace("{NOMBRE_COMPLETO}", utf8_encode($datos[0]->nombre_completo), $PRINCIPAL);
    $PRINCIPAL     = str_replace("{RUT_COMPLETO_EVALUADO}", $datos[0]->rut_completo_evaluado, $PRINCIPAL);
    $PRINCIPAL     = str_replace("{PORCENTAJE_BARRA_NIVEL}", $datos[0]->porcentajebarranivel, $PRINCIPAL);
    $PRINCIPAL     = str_replace("{NUMDESAFIOS}", $datos[0]->total_objetos_por_curso_actual - $datos[0]->totalobjetos_finalizados, $PRINCIPAL);
    $PRINCIPAL     = str_replace("{CARGO}", utf8_encode($datos[0]->cargo_usuario), $PRINCIPAL);
    /*$total_avatars = GAMIFICACION_AvatarsPorEmpresa($id_empresa);
    $cont_rows     = 0;
    foreach ($total_avatars as $avatar) {
        $cont_rows++;
        $total_avatars_html .= file_get_contents("views/cursos/capacitacion/row_avatar.html");
        $total_avatars_html = str_replace("{NOMBRE_ARCHIVO}", $avatar->nombre_archivo, $total_avatars_html);
        $total_avatars_html = str_replace("{CARPETA_AVATARS}", $id_empresa, $total_avatars_html);
        $total_avatars_html = str_replace("{ID_AVATAR}", $avatar->nombre_archivo, $total_avatars_html);
        $total_avatars_html = str_replace("{ID}", $avatar->id, $total_avatars_html);
        if ($cont_rows == 2) {
            $total_avatars_html .= "<div class='row'></div>";
            $cont_rows = 0;
        } else {
            $cont_rows++;
        }
    }*/
    $PRINCIPAL    = str_replace("{ID_EMPRESA}", $id_empresa, $PRINCIPAL);
    $PRINCIPAL    = str_replace("{ROWS_AVATARS}", $total_avatars_html, $PRINCIPAL);
    //Aca traigo el listado de los puntos
    $total_puntos = GAMIFICACIONTotalPuntosPorObjetoDadoRutEmpresa($rut, $id_empresa);
    foreach ($total_puntos as $pun) {
        //$row_por_puntos .= file_get_contents("views/cursos/capacitacion/" . $id_empresa . "_mi_perfil_row_puntos_por_objeto.html");
        $row_por_puntos = str_replace("{MODULO}", utf8_encode($pun->titulo), $row_por_puntos);
        $row_por_puntos = str_replace("{TOTAL_PUNTOS}", $pun->puntos, $row_por_puntos);
        $row_por_puntos = str_replace("{FECHA}", formatearFechaSmall($pun->fecha), $row_por_puntos);
        if ($pun->rut_autor_megusta) {
            //$row_por_puntos = str_replace("{MEGUSTA_ROW}","+1 ".$pun->nombre_autor_megusta,$row_por_puntos);
            $row_por_puntos = str_replace("{MEGUSTA_ROW}", "<br>Me Gusta", $row_por_puntos);
        } else {
            $row_por_puntos = str_replace("{MEGUSTA_ROW}", "", $row_por_puntos);
        }
        $imagen_medalla = "";
        $html_medallas  = "";
        for ($tott = 1; $tott <= $pun->medallas; $tott++) {
            //$html_medallas.="<img src='img/".$datos[0]->imagenmedalla."'>";
            $imagen_medalla = $datos[0]->imagenmedalla;
            if ($imagen_medalla == "") {
                //echo "hola";
                $imagen_medalla_array = buscaimagenmedallamalla($rut, $id_empresa);
                $imagen_medalla       = $imagen_medalla_array[0]->imagenmedallamalla;
                $html_medallas .= "<img src='img/$imagen_medalla'>";
            } else {
                $html_medallas .= "<img src='img/$imagen_medalla'>";
            }
        }
        if ($html_medallas) {
            $row_por_puntos = str_replace("{MEDALLA_ROW}", "<br>" . $html_medallas, $row_por_puntos);
        } else {
            $row_por_puntos = str_replace("{MEDALLA_ROW}", "", $row_por_puntos);
        }
    }
    $PRINCIPAL = str_replace("{LISTADO_DETALLE_PUNTOS}", $row_por_puntos, $PRINCIPAL);
    //print_r($datos);exit();
    if ($tipo_llamada == "admin") {
        //Rut Completo Usuario
        $arreglo[0] = $datos[0]->rut_completo_evaluado;
        //Nombre Completo
        $arreglo[1] = utf8_encode($datos[0]->nombre_completo);
        //CARGO
        $arreglo[2] = utf8_encode($datos[0]->cargo_usuario);
        //Campo 1
        $arreglo[3] = utf8_encode($datos[0]->campo1);
        //Campo 2
        $arreglo[4] = utf8_encode($datos[0]->campo2);
        //Campo 3
        $arreglo[5] = utf8_encode($datos[0]->campo3);
        //Puntos
        //$arreglo[6]=$datos[0]->puntosconsolidados;
        $arreglo[6] = $puntos;
        //Medallas
        $arreglo[7] = $datos[0]->medallas;
        if ($datos[0]->ingresocurso > 0) {
            $ingreso = 1;
        } else {
            $ingreso = 0;
        }
        $arreglo[8]  = $ingreso;
        $arreglo[9]  = utf8_encode($datos[0]->email_usuario);
        $arreglo[10] = utf8_encode($datos[0]->campo4);
        //    print_r($arreglo);
        return ($arreglo);
        //return($PRINCIPAL);
    } else {
        return ($PRINCIPAL);
    }
}
function BloqueListadoSalonFama($html, $id_empresa, $id_categoria, $ano)
{
    //Traigo el listado de usuarios para ver en Clasicos
    //$datos=TraeListadoClasicos($id_empresa, "", "order by antiguedad desc");
    //$datos=TotalReconocimientosPorCategoriaGenerico($id_categoria, $id_empresa);
    $datos       = TotalReconocimientosPorCategoriaGenericoPorAno($id_categoria, $id_empresa, $ano);
    $subtitulo   = "";
    //echo round($datos[0]->antiguedad/5);
    $valor_mayor = (round($datos[0]->antiguedad / 10) * 10);
    $html        = str_replace("{TITULO_SALON_FAMA}", utf8_encode($datos[0]->titulo_pagina), $html);
    $html        = str_replace("{DESCRIPCION}", utf8_encode($datos[0]->descripcion_categoria), $html);
    $valor_menor = $valor_mayor - 10;
    //echo "<br>";
    $j           = 0;
    foreach ($datos as $unico) {
        $row .= file_get_contents("views/salondelafama/row_generico.html");
        $row = str_replace("{NOMBRE}", $unico->nombre_completo, $row);
        $row = str_replace("{ANOS}", $unico->antiguedad, $row);
        $row = str_replace("{CARGO}", $unico->cargo, $row);
        $row = str_replace("{URL_PERSONA}", VerificaFotoPersonal($unico->rut), $row);
        $row = str_replace("{RUT_ENCODEADO}", Encodear3($unico->rut), $row);
    }
    $html = str_replace("{BLOQUE_LISTADO_CLASICOS}", utf8_Encode($row), $html);
    return ($html);
}
function ObtieneResumenesNotasFinalesPorEvaluador($entorno, $rut_evaluador, $id_proceso, $calibrador)
{
    if ($calibrador) {
        //$evaluados=TraeEvaluadosDadoEvaluadorPorProceso2PorCalibrador($calibrador, $id_proceso);
        $evaluados = TraeEvaluadosDadoEvaluadorPorProceso2PorCalibradorSinAe($calibrador, $id_proceso);
    } else {
        //$evaluados=TraeEvaluadosDadoEvaluadorPorProceso2($rut_evaluador, $id_proceso);
        $evaluados = TraeEvaluadosDadoEvaluadorPorProceso2SinAe($rut_evaluador, $id_proceso);
    }
    foreach ($evaluados as $ev) {
        $datos_resumen = ResultadosFinales($ev->rut, $ev->evaluador, $id_proceso, "");
        //PARA CHILQUINTA ES SOLO LA COMP, PARA TURBUS, EL PROMEDIO ENTRE COMP Y OBJ
        if ($datos_resumen[27] > 0) {
            $acummulador_notas = $acummulador_notas + $datos_resumen[27];
            $contador++;
        }
        //ESPECIFICOS
        if (round($datos_resumen[31]) > 0) {
            $acumulador_objetivos = $acumulador_objetivos + round($datos_resumen[31]);
            $contador_obj++;
        }
        if ($datos_resumen[32] > 0) {
            $acumulador_nota_competencias = $acumulador_nota_competencias + $datos_resumen[32];
            $contador_competencias++;
        }
        $datos_resumen_ae = ResultadosFinales($ev->rut, $ev->rut, $id_proceso, "");
        if ($datos_resumen_ae[27] > 0) {
            $acummulador_notas_ae = $acummulador_notas_ae + $datos_resumen_ae[27];
            $contador_ae++;
        }
    }
    if ($_SESSION["id_empresa"] == 43) {
        $nota_final_evaluados = (($acumulador_nota_competencias / $contador_competencias) * 0.4) + (($acumulador_objetivos / $contador_obj) * 0.6);
    } else {
        $nota_final_evaluados = $acummulador_notas / $contador;
    }
    $nota_final_objetivos    = $acumulador_objetivos / $contador_obj;
    $nota_final_competencias = $acumulador_nota_competencias / $contador_competencias;
    if ($nota_final_competencias) {
        $datos_nota_final_evaluados_competencias = ObtenerCriterioPuntajeMatrizNotaFinal($nota_final_competencias, "", 0, "nota_final", $rut_evaluador, $id_proceso);
        $entorno                                 = str_replace("{NOTA_COMP_ESPE_INT}", ColocaDecimalesNotasFinales(2, $nota_final_competencias), $entorno);
        $entorno                                 = str_replace("{CRITERIO_COMP_ESPE_INT}", $datos_nota_final_evaluados_competencias[0], $entorno);
        $entorno                                 = str_replace("{ESTILO_COMP_ESPE_INT}", $datos_nota_final_evaluados_competencias[2], $entorno);
    } else {
        $entorno = str_replace("{NOTA_COMP_ESPE_INT}", "", $entorno);
        $entorno = str_replace("{CRITERIO_COMP_ESPE_INT}", "", $entorno);
        $entorno = str_replace("{ESTILO_COMP_ESPE_INT}", "", $entorno);
    }
    if ($nota_final_objetivos) {
        $datos_nota_final_evaluados_objetivos = ObtenerCriterioPuntajeMatrizNotaFinal($nota_final_objetivos, "", 0, "nota_final", $rut_evaluador, $id_proceso);
        $entorno                              = str_replace("{NOTA_OBJ_ESP_INT}", ColocaDecimalesNotasFinales(2, $nota_final_objetivos), $entorno);
        $entorno                              = str_replace("{CRITERIO_OBJ_ESP_INT}", $datos_nota_final_evaluados_objetivos[0], $entorno);
        $entorno                              = str_replace("{ESTILO_OBJ_ESP_INT}", $datos_nota_final_evaluados_objetivos[2], $entorno);
    }
    if ($contador_competencias == count($evaluados)) {
        if ($nota_final_evaluados) {
            if ($calibrador) {
                //$datos_nota_final_evaluados=ObtenerCriterioPuntajeMatrizNotaFinal($nota_final_evaluados, $evaluados[0]->evaluador, 0, "nota_final", $evaluados[0]->evaluador, $id_proceso);
                $datos_nota_final_evaluados = ObtenerCriterioPuntajeMatrizNotaFinal($nota_final_evaluados, "", 0, "nota_final", $evaluados[0]->evaluador, $id_proceso);
            } else {
                //$datos_nota_final_evaluados=ObtenerCriterioPuntajeMatrizNotaFinal($nota_final_evaluados, $rut_evaluador, 0, "nota_final", $evaluados[0]->evaluador, $id_proceso);
                $datos_nota_final_evaluados = ObtenerCriterioPuntajeMatrizNotaFinal($nota_final_evaluados, "", 0, "nota_final", $rut_evaluador, $id_proceso);
            }
            $entorno = str_replace("{NOTA_FINAL}", ColocaDecimalesNotasFinales(2, $nota_final_evaluados), $entorno);
            $entorno = str_replace("{ESTILO_NOTA_FINAL}", $datos_nota_final_evaluados[2], $entorno);
            $entorno = str_replace("{ICONO_NOTA_FINAL}", $datos_nota_final_evaluados[3], $entorno);
            $entorno = str_replace("{CRITERIO_NOTA_FINAL}", $datos_nota_final_evaluados[0], $entorno);
        } else {
            $entorno = str_replace("{NOTA_FINAL}", "", $entorno);
            $entorno = str_replace("{ESTILO_NOTA_FINAL}", "etiquetaPrograma-pendiente", $entorno);
            $entorno = str_replace("{ICONO_NOTA_FINAL}", "circle-icon-sgd-3", $entorno);
            $entorno = str_replace("{CRITERIO_NOTA_FINAL}", "Pendiente", $entorno);
        }
    } else {
        $entorno = str_replace("{NOTA_FINAL}", "", $entorno);
        $entorno = str_replace("{ESTILO_NOTA_FINAL}", "etiquetaPrograma-pendiente", $entorno);
        $entorno = str_replace("{ICONO_NOTA_FINAL}", "circle-icon-sgd-3", $entorno);
        $entorno = str_replace("{CRITERIO_NOTA_FINAL}", "Pendiente", $entorno);
    }
    $nota_final_evaluados_ae = $acummulador_notas_ae / $contador_ae;
    if ($nota_final_evaluados_ae) {
        if ($calibrador) {
            //$datos_nota_final_evaluados_ae=ObtenerCriterioPuntajeMatrizNotaFinal($nota_final_evaluados_ae, $evaluados[0]->evaluador, 0, "nota_final", $evaluados[0]->evaluador, $id_proceso);
            $datos_nota_final_evaluados_ae = ObtenerCriterioPuntajeMatrizNotaFinal($nota_final_evaluados_ae, "", 0, "nota_final", $rut_evaluador, $id_proceso);
        } else {
            //$datos_nota_final_evaluados_ae=ObtenerCriterioPuntajeMatrizNotaFinal($nota_final_evaluados_ae, $rut_evaluador, 0, "nota_final", $evaluados[0]->evaluador, $id_proceso);
            $datos_nota_final_evaluados_ae = ObtenerCriterioPuntajeMatrizNotaFinal($nota_final_evaluados_ae, "", 0, "nota_final", $rut_evaluador, $id_proceso);
        }
        $entorno = str_replace("{NOTA_COMP_ESPE_INT_AE}", ColocaDecimalesNotasFinales(2, $nota_final_evaluados_ae), $entorno);
        $entorno = str_replace("{ESTILO_COMP_ESPE_INT_AE}", $datos_nota_final_evaluados_ae[2], $entorno);
        $entorno = str_replace("{ICONO_COMP_ESPE_INT_AE}", $datos_nota_final_evaluados_ae[3], $entorno);
        $entorno = str_replace("{CRITERIO_COMP_ESPE_INT_AE}", $datos_nota_final_evaluados_ae[0], $entorno);
    } else {
        $entorno = str_replace("{NOTA_COMP_ESPE_INT_AE}", "", $entorno);
        $entorno = str_replace("{ESTILO_COMP_ESPE_INT_AE}", "etiquetaPrograma-pendiente", $entorno);
        $entorno = str_replace("{ICONO_COMP_ESPE_INT_AE}", "circle-icon-sgd-3", $entorno);
        $entorno = str_replace("{CRITERIO_COMP_ESPE_INT_AE}", "Pendiente", $entorno);
    }
    return ($entorno);
}
function CalibraEval($html, $evaluado, $evaluador, $id_proceso, $id_empresa)
{
    $datos_proceso_evaluacion = TraeProcesosDeEvaluacionPorEmpresaYDiProceso($id_empresa, $id_proceso);
    $decimales_para_proceso   = $datos_proceso_evaluacion[0]->decimales_puntajes;
    $datos_evaluado           = UsuarioEnBasePersonas($evaluado);
    $datos_perfil_evaluacion  = UsuarioEnBasePersonas2PorProceso($evaluado, $id_proceso);
    //Bloque Resumen Superior
    $template_top             = file_get_contents("views/sgd/informe/tabla_superior_informe.html");
    //$total_evaluados.=ColocaDatosUsuario($template_top, $evaluado);
    $total_evaluados .= ColocaDatosUsuarioSGD($template_top, $evaluado, "", $evaluador, $id_proceso);
    $total_evaluados = str_replace("{TABLA_RESUMEN1}", file_get_contents("views/sgd/informe/tabla_superior_resumen/tabla_resumen1_sinareacorp_dinamico.html"), $total_evaluados);
    $total_evaluados = ArmaTemplareDeTablaResumen($total_evaluados, $_SESSION["ano_proceso_anual"], $id_empresa, $datos_perfil_evaluacion[0]->perfil_evaluacion, $evaluado, $evaluador, "no");
    $html            = str_replace("{BLOQUE_RESUMEN_EVALUADO}", $total_evaluados, $html);
    $html            = str_replace("{PASOS}", "", $html);
    //Bloque de detalle por competencias
    //$competencias=CompetenciasDadoPerfil($datos_perfil_evaluacion[0]->perfil_evaluacion, $evaluado, $evaluador);
    $competencias    = CompetenciasDadoPerfilPorProceso($datos_perfil_evaluacion[0]->perfil_evaluacion, $evaluado, $evaluador, $id_proceso);
    $html            = str_replace("{NOMBRE_INFORME_EVALUACION}", utf8_encode($datos_proceso_evaluacion[0]->titulo_informes_proceso), $html);
    //Aca pregunto si es que se muestra o no el promedio de las competencias.
    if ($datos_proceso_evaluacion[0]->muestra_promedio_competencias == 1) {
        $row                      = file_get_contents("views/sgd/informe/row_informe1_comp.html");
        $row                      = str_replace("{NOMBRE}", "Promedio por Competencias", $row);
        $nota_final_competencias  = ObtieneNotaFinalCompetencias($datos_perfil_evaluacion[0]->perfil_evaluacion, $evaluado, $evaluador, $id_proceso);
        $criterios_nota_final     = ObtenerCriterioPuntajeMatrizNotaFinal($nota_final_competencias[0], $evaluado, "", "comp", $evaluador, $id_proceso);
        $row                      = str_replace("{NOMBRE}", "Promedio por Competencias", $row);
        $row                      = str_replace("{ESTILO_ETIQUETA}", $criterios_nota_final[2], $row);
        $row                      = str_replace("{ICONO}", $criterios_nota_final[3], $row);
        $row                      = str_replace("{CRITERIO}", $criterios_nota_final[0], $row);
        $row                      = str_replace("{NOTA}", FormatearPorcentajesSinDecimal($nota_final_competencias[0]) . "", $row);
        $template_row_competencia = file_get_contents("views/sgd/informe/row_informe1_comp_v2.html");
    } else {
        //$template_row_competencia=file_get_contents("views/sgd/informe/row_informe1_comp_calibra.html");
        $template_row_competencia = file_get_contents("views/sgd/informe/row_informe1_comp_calibra.html");
    }
    $i = 0;
    foreach ($competencias as $com) {
        //$row.=file_get_contents("views/sgd/informe/row_informe1_comp.html");
        $row .= $template_row_competencia;
        $criterios                          = ObtenerCriterioPuntajeMatrizNotaFinal($com->nota_promedio, $evaluado, "", "comp", $evaluador, $id_proceso);
        $row                                = str_replace("{NOMBRE}", $com->nombre_componente, $row);
        $matriz_competencias[$i]["nombre"]  = $com->sigla;
        $row                                = str_replace("{ID_COMPETENCIA_NAME}", $com->id_componente, $row);
        $row                                = str_replace("{ID_COMPETENCIA_ENCODEADO}", Encodear3($com->id_componente), $row);
        $row                                = str_replace("{DESCRIPCION}", $com->descripcion_componente, $row);
        $row                                = str_replace("{RUT_EVALUADOR_ENCODEADO}", Encodear3($evaluador), $row);
        $row                                = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($evaluado), $row);
        $row                                = str_replace("{ID_PROCESO_ENCODEADO}", Encodear3($id_proceso), $row);
        $row                                = str_replace("{PONDERACION}", "", $row);
        $row                                = str_replace("{ESTILO_ETIQUETA}", $criterios[2], $row);
        $row                                = str_replace("{ICONO}", $criterios[3], $row);
        $row                                = str_replace("{CRITERIO}", $criterios[0], $row);
        //$row = str_replace("{NOTA}",FormatearPorcentajesSinDecimal($com->nota_promedio)."%",$row);
        $row                                = str_replace("{NOTA}", ColocaDecimalesNotasFinales($decimales_para_proceso, $com->nota_promedio, $tipo) . "", $row);
        $matriz_competencias[$i]["nota"]    = ($com->nota_promedio);
        $row                                = str_replace("{NOTA_CALIBRA}", ColocaDecimalesNotasFinales($decimales_para_proceso, $com->nota_promedio, $tipo) . "", $row);
        //AE
        //BLOQUE PARA MOSTRAR NOTAS AE
        $competencias_ae                    = CompetenciasDadoPerfilPorCompetencia($datos_perfil_evaluacion[0]->perfil_evaluacion, $evaluado, $evaluado, $com->id_competencia);
        $criterios_ae                       = ObtenerCriterioPuntajeMatrizNotaFinal($competencias_ae[0]->nota_promedio, $evaluado, "", "comp", $evaluador, $id_proceso);
        $row                                = str_replace("{ESTILO_ETIQUETA_AE}", $criterios_ae[2], $row);
        $row                                = str_replace("{ICONO_AE}", $criterios_ae[3], $row);
        $row                                = str_replace("{CRITERIO_AE}", $criterios_ae[0], $row);
        $row                                = str_replace("{NOTA_AE}", FormatearPorcentajesSinDecimal($competencias_ae[0]->nota_promedio) . "%", $row);
        $matriz_competencias[$i]["nota_ae"] = FormatearPorcentajesSinDecimal($competencias_ae[0]->nota_promedio);
        /*$row = str_replace("{ESTILO_ETIQUETA_AE}",$criterios_ae[2],$row);
        $row = str_replace("{ICONO_AE}",$criterios_ae[3],$row);
        $row = str_replace("{CRITERIO_AE}",$criterios_ae[0],$row);
        $row = str_replace("{NOTA_AE}",FormatearPorcentajesSinDecimal($competencias_ae[0]->nota_promedio)."",$row);
        $matriz_competencias[$i]["nota_ae"]=FormatearPorcentajesSinDecimal($competencias_ae[0]->nota_promedio);
        * */
        $i++;
        //Por cada competencia veo si tiene mas de una pregunta ,si es asi, las muestra, con la
        //Respuesta correspondiente
        if ($com->muestra_preguntas_informe == 1) {
            $preguntas_por_competencias = PreguntasPorCompetenciaConRespuesta($com->id_competencia, $evaluado, $evaluador, $id_proceso);
            $row_preg                   = "";
            //echo "$evaluado $evaluador <br>";
            foreach ($preguntas_por_competencias as $preg_uni) {
                //$row_preg.=file_get_contents("views/sgd/informe/row_informe1.1_comp.html");
                $row_preg .= file_get_contents("views/sgd/informe/row_informe1.1_comp_preg_calibra.html");
                $row_preg                      = str_replace("{NOMBRE_1}", $preg_uni->pregunta, $row_preg);
                $row_preg                      = str_replace("{NOMBRE_PREGUNTA}", $preg_uni->id, $row_preg);
                $row_preg                      = str_replace("{NOMBRE_PREGUNTA_COMPUESTO}", $evaluado . "-" . $preg_uni->id, $row_preg);
                $row_preg                      = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($evaluado), $row_preg);
                $row_preg                      = str_replace("{RUT_EVALUADOR_ENCODEADO}", Encodear3($evaluador), $row_preg);
                $row_preg                      = str_replace("{ID_PROCESO_ENCODEADO}", Encodear3($id_proceso), $row_preg);
                $row_preg                      = str_replace("{ID_PREGUNTA_ENCODEADO}", Encodear3($preg_uni->id), $row_preg);
                $row_preg                      = str_replace("{ID_COMPETENCIA_ENCODEADO}", Encodear3($com->id_competencia), $row_preg);
                $row_preg                      = str_replace("{DESCRIPCION_1}", "", $row_preg);
                $row_preg                      = str_replace("{PONDERACION_1}", "", $row_preg);
                $criterios_detalle_preg        = ObtenerCriterioPuntajeMatrizNotaFinal($preg_uni->puntaje, $evaluado, "", "comp", $evaluador, $id_proceso);
                $row_preg                      = str_replace("{ESTILO_ETIQUETA_1}", $criterios_detalle_preg[2], $row_preg);
                $row_preg                      = str_replace("{ICONO_1}", $criterios_detalle_preg[3], $row_preg);
                $row_preg                      = str_replace("{CRITERIO_1}", $criterios_detalle_preg[0], $row_preg);
                $row_preg                      = str_replace("{NOTA_1}", FormatearPorcentajesSinDecimal($preg_uni->puntaje) . "", $row_preg);
                //PARA AE
                $preguntas_por_competencias_ae = PreguntasPorCompetenciaConRespuestaPorPregunta($com->id_competencia, $evaluado, $evaluado, $id_proceso, $preg_uni->id);
                $criterios_detalle_preg_ae     = ObtenerCriterioPuntajeMatrizNotaFinal($preguntas_por_competencias_ae[0]->puntaje, $evaluado, "", "comp", $evaluador, $id_proceso);
                $row_preg                      = str_replace("{ESTILO_ETIQUETA_1_AE}", $criterios_detalle_preg_ae[2], $row_preg);
                $row_preg                      = str_replace("{ICONO_1_AE}", $criterios_detalle_preg_ae[3], $row_preg);
                $row_preg                      = str_replace("{CRITERIO_1_AE}", $criterios_detalle_preg_ae[0], $row_preg);
                $row_preg                      = str_replace("{NOTA_1_AE}", FormatearPorcentajesSinDecimal($preguntas_por_competencias_ae[0]->puntaje) . "", $row_preg);
            }
        }
        $row .= $row_preg;
        $row .= "</form>";
    }
    $html              = str_replace("{LISTADO_COMPETENCIAS}", utf8_encode($row), $html);
    $html              = str_replace("{BLOQUE_ESPECIFICOS}", "", $html);
    //Objetivos Empresa
    $objetivos_empresa = ObjetivosDeEmpresaConNota($datos_evaluado[0]->id_empresa, $id_proceso);
    if ($objetivos_empresa) {
        $html = str_replace("{BLOQUE_COORPORATIVOS}", file_get_contents("views/sgd/informe/entorno_informe_bloque_corporativo.html"), $html);
        foreach ($objetivos_empresa as $ob) {
            //$row3.=file_get_contents("views/sgd/informe/row_informe1_desactivado.html");
            $row3 .= file_get_contents("views/sgd/informe/row_informe1.html");
            $row3   = str_replace("{NOMBRE}", $ob->descripcion_objetivo, $row3);
            $row3   = str_replace("{PONDERACION}", "30%", $row3);
            $row3   = str_replace("{DESCRIPCION}", "", $row3);
            $datos3 = ObtenerCriterioPuntajeMatrizNotaFinal($ob->nota, $evaluado, "", "corp", $evaluador, $id_proceso);
            $row3   = str_replace("{NOTA}", FormatearPorcentajesSinDecimal($ob->nota) . "%", $row3);
            $row3   = str_replace("{ESTILO_ETIQUETA}", $datos3[2], $row3);
            $row3   = str_replace("{CRITERIO}", $datos3[0], $row3);
            $row3   = str_replace("{ICONO}", $datos3[3], $row3);
        }
        $html = str_replace("{LISTADO_OBJETIVOS_CORPORATIVOS}", utf8_encode($row3), $html);
    } else {
        $html = str_replace("{BLOQUE_COORPORATIVOS}", "", $html);
    }
    //OBJETIVOS AREA
    $datos_usuario               = UsuarioEnBasePersonasInnerArea($evaluado);
    //con el id del area, y el id de la empresa, traigo los datos de los objetivos de area
    $html                        = str_replace("{BLOQUE_AREA}", "", $html);
    $datos_evaluacion_resultados = ResultadosFinales($evaluado, $evaluador, $id_procesoo);
    $html                        = str_replace("{ESTILO_OBJIND}", $datos_evaluacion_resultados[0], $html);
    $html                        = str_replace("{ICONO_OBJIND}", $datos_evaluacion_resultados[4], $html);
    $html                        = str_replace("{CRITERIO_OBJETIVOS_IND}", $datos_evaluacion_resultados[1], $html);
    $html                        = str_replace("{ESTILO_COMP}", $datos_evaluacion_resultados[2], $html);
    $html                        = str_replace("{ICONO_COMP}", $datos_evaluacion_resultados[5], $html);
    $html                        = str_replace("{CRITERIO_COMPETENCIAS}", $datos_evaluacion_resultados[3], $html);
    //Graficos Individuales
    $html                        = str_replace("{GRAFICO_COMPETENCIAS}", GraficoPorCompetenciasPorEvaluadorCalibrador($evaluador, $id_proceso, "", $evaluado), $html);
    //Grafico de Araña
    $html                        = str_replace("{GRAFICO_ARANA}", GraficoArana($matriz_competencias), $html);
    return ($html);
}
function EstadoAvanceLiberacionCalibracion($rut_calibrador, $id_proceso, $evaluador)
{
    if ($evaluador) {
        //$cantidad_calibraciones=TraeCantidadDeCalibracionesPorEvaluador($rut_calibrador, $id_proceso, $evaluador);
        $cantidad_calibraciones = TraeCantidadDeCalibracionesPorEvaluadorSinAe($rut_calibrador, $id_proceso, $evaluador);
    } else {
        //$cantidad_calibraciones=TraeCantidadDeCalibraciones($rut_calibrador, $id_proceso);
        $cantidad_calibraciones = TraeCantidadDeCalibracionesSinAe($rut_calibrador, $id_proceso);
    }
    //Veo cuantos ya he liberado
    $cantidad_liberados = TraeCantidadLiberadosPorCalibrador($rut_calibrador, $id_proceso);
    //$arreglo[0]=count($cantidad_calibraciones)-count($cantidad_liberados);
    $arreglo[0]         = count($cantidad_calibraciones);
    //echo $arreglo[0]." aca";
    if ($arreglo[0] == "") {
    }
    $arreglo[1] = count($cantidad_liberados);
    return ($arreglo);
}
function ColocaGraficoAvanceLiberados($PRINCIPAL, $rut_calibrador, $id_proceso, $id_empresa)
{
    $grafico       = file_get_contents("views/sgd/graficos/graficoTorta.html");
    //Veo cuantos debe calibrar
    $datos         = EstadoAvanceLiberacionCalibracion($rut_calibrador, $id_proceso);
    $grafico       = str_replace("{DETIPO}", "evaluaciones liberadas", $grafico);
    $grafico       = str_replace("{PIECHART_SGD}", $rut_calibrador, $grafico);
    $grafico       = str_replace("{TOTAL_PENDIENTES}", $datos[0], $grafico);
    $grafico       = str_replace("{TOTAL_LIBERADOS}", $datos[1], $grafico);
    $grafico       = str_replace("{TOTAL_MENOS_LIBERADOS}", $datos[0] - $datos[1], $grafico);
    $grafico       = str_replace("{TOTAL_MENOS_LIBERADOS}", $datos[0] - $datos[1], $grafico);
    $datos_proceso = TraeProcesosDeEvaluacionPorEmpresaYDiProceso($id_empresa, $id_proceso);
    $grafico       = str_replace("{COLOR_GRAFICO_2}", $datos_proceso[0]->color_grafico_2, $grafico);
    $PRINCIPAL     = str_replace("{GRAFICO_TORTA}", $grafico, $PRINCIPAL);
    return ($PRINCIPAL);
}
function ListadoTotalColaboradoresPreviaCalibracion($html, $rut, $proceso_anual, $id_empresa, $id_proceso, $calibrador, $id_proceso_calibrar)
{
    $entorno              = file_get_contents("views/sgd/sgd2_entorno_equipo_chilquinta_calibracion.html");
    $entorno              = str_replace("{SECCION_GRAFICOS_CONSOLIDADOS}", file_get_contents("views/sgd/vista_consolidada_graficos.html"), $entorno);
    $entorno              = str_replace("{GRAFICO1.1}", ConsolidadoLineal($rut, "", $id_proceso_calibrar, $id_empresa), $entorno);
    $entorno              = str_replace("{GRAFICO1.2}", GraficoPorCompetenciasPorEvaluadorCalibrador($rut, $id_proceso_calibrar, ""), $entorno);
    $entorno              = ObtieneResumenesNotasFinalesPorEvaluador($entorno, $rut, $id_proceso_calibrar);
    //$entorno = str_replace("{TABLA_DATOS_USUARIO_SsUPERIOR}",file_get_contents("views/sgd/tabla_datos_superior_usuario.html"),$entorno);
    $entorno              = str_replace("{GRAFICO_TORTA}", "", $entorno);
    $entorno              = ColocaDatosUsuario($entorno, $rut, "graficoFrecuenciaCompetencia");
    //Aca valido si el evaluador termino sus evaluaciones, en tabla tbl_sgd_finalizados_evaluador.
    $finalizado_evaluador = FinalizadoEvaluador($rut);
    if ($finalizado_evaluador) {
        $entorno = str_replace("{LINK_EVALUACION_EQUIPO}", "sgd2", $entorno);
    } else {
        $entorno = str_replace("{LINK_EVALUACION_EQUIPO}", "ev#pag", $entorno);
    }
    //Aca traigo ellistado total de los colaboradores
    //$evaluados=TraeEvaluadosDadoEvaluador($rut);
    //$evaluados=TraeEvaluadosDadoEvaluadorSinMiPerfil($rut);
    //$evaluados=TraeEvaluadosDadoEvaluadorPorProceso($rut);
    //$evaluados=TraeEvaluadosDadoEvaluadorPorProcesoSinAe($rut, $id_proceso_calibrar);
    $evaluados = TraeEvaluadosDadoEvaluadorPorProcesoSinAePorProceso($rut, $id_proceso_calibrar);
    //$evaluados=TraeEvaluadosDadoEvaluadorPorProceso2($rut, $id_proceso_calibrar);
    if (!$evaluados) {
        $html = str_replace("{ENTORNO_LISTADO_COLABORADORES}", "
            <div class='row'>
</div>
            ", $html);
    } else {
        $total_evaluados = "";
        $obj_fin         = 0;
        foreach ($evaluados as $ev) {
            $row = file_get_contents("views/sgd/listado_colaboradores/row_colaboradores_previa_calibracion.html");
            $total_evaluados .= ColocaDatosUsuario($row, $ev->rut);
            //COMENTADO PARA OPTIMIZAR 22-11-2015
            if ($id_empresa == 28) {
                $total_evaluados     = str_replace("{TABLA_RESUMEN1}", file_get_contents("views/sgd/informe/tabla_superior_resumen/tabla_resumen1_sinareacorp_dinamico_chilquinta.html"), $total_evaluados);
                $total_evaluados     = str_replace("{BOTON_EVALUACION_INDIVIDUAL}", file_get_contents("views/sgd/informe/tabla_superior_resumen/boton_eval_individual.html"), $total_evaluados);
                //Verifico si está finalizada la evaluacion de este proceso
                $verifica_finalizado = FinalizadoEvaluadoEvaluador($ev->rut, $ev->evaluador, $ev->id_proceso);
                if ($verifica_finalizado) {
                    //Verifico tambien si está liberado o no por el calibrador
                    $verifica_liberado = TraeLiberadoEvaluadoEvaluadorCalibrador($ev->rut, $ev->evaluador, $calibrador, $ev->id_proceso);
                    if ($verifica_liberado) {
                        $total_evaluados = str_replace("{BOTON}", file_get_contents("views/sgd/evaluacion/boton_ver_informe.html"), $total_evaluados);
                    } else {
                        $total_evaluados = str_replace("{BOTON}", file_get_contents("views/sgd/listado_colaboradores/boton_calibra_individual.html"), $total_evaluados);
                    }
                } else {
                    $total_evaluados = str_replace("{BOTON}", "", $total_evaluados);
                }
                $estado_liberado_feedback = LiberadoFeedbackLiberado($ev->rut, $ev->evaluador, $ev->calibrador, $ev->id_proceso, $id_empresa);
                $total_evaluados          = str_replace("{ETIQUETA_ESTADO}", $estado_liberado_feedback[0], $total_evaluados);
                $total_evaluados          = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($ev->rut), $total_evaluados);
                $total_evaluados          = str_replace("{RUT_EVALUADOR_ENCODEADO}", Encodear3($ev->evaluador), $total_evaluados);
                $total_evaluados          = str_replace("{ID_PROCESO_ENCODEADO}", Encodear3($ev->id_proceso), $total_evaluados);
                //Aca traigo la nota final de cadaevaluadopara acumular y mostrar en el resumen superior
                $datos_resumen            = ResultadosFinales($ev->rut, $rut, $id_proceso, "");
                if ($datos_resumen[27] > 0) {
                    $acummulador_notas = $acummulador_notas + $datos_resumen[27];
                    $contador++;
                }
            } else {
                $total_evaluados = str_replace("{TABLA_RESUMEN1}", file_get_contents("views/sgd/informe/tabla_superior_resumen/tabla_resumen1_sinareacorp_dinamico.html"), $total_evaluados);
            }
            $total_evaluados    = ArmaTemplareDeTablaResumen($total_evaluados, $proceso_anual, $id_empresa, $ev->perfil_evaluacion, $ev->rut, $rut);
            //Verifico si está finalizado este evaluado en el proceso de objetivos
            $feedback_objetivos = TomoConocimientoEvaluado($ev->rut);
            if ($feedback_objetivos) {
                $obj_fin++;
            }
            //$total_evaluados = ColocaPonderaciones($total_evaluados, $ev->rut);
            $total_evaluados = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($ev->rut), $total_evaluados);
            //$total_evaluados=ColocaResultadosTablaReumen($total_evaluados, $ev->rut, $rut);
            $total_evaluados = SemaforosEstadosObjetivos($total_evaluados, $ev->rut, $_SESSION["ano_proceso_anual"]);
            //COMENTADO PARA OPTIMIZAR 22-11-2015
            //$total_evaluados = str_replace("{PARAMETROS_EVAL}",Encodear3($ev->rut.";".$rut),$total_evaluados);
        }
        $nota_final_evaluados = $acummulador_notas / $contador;
        if ($nota_final_evaluados) {
            $datos_nota_final_evaluados = ObtenerCriterioPuntajeMatrizNotaFinal($nota_final_evaluados, $rut, 0, "nota_final");
            $entorno                    = str_replace("{NOTA_FINAL}", ColocaDecimalesNotasFinales(2, $nota_final_evaluados), $entorno);
            $entorno                    = str_replace("{ESTILO_NOTA_FINAL}", $datos_nota_final_evaluados[2], $entorno);
            $entorno                    = str_replace("{ICONO_NOTA_FINAL}", $datos_nota_final_evaluados[3], $entorno);
            $entorno                    = str_replace("{CRITERIO_NOTA_FINAL}", $datos_nota_final_evaluados[0], $entorno);
        } else {
            $entorno = str_replace("{NOTA_FINAL}", "", $entorno);
            $entorno = str_replace("{ESTILO_NOTA_FINAL}", "etiquetaPrograma-pendiente", $entorno);
            $entorno = str_replace("{ICONO_NOTA_FINAL}", "circle-icon-sgd-3", $entorno);
            $entorno = str_replace("{CRITERIO_NOTA_FINAL}", "Pendiente", $entorno);
        }
        //aca calculo el porcentaje de avance de objetivos de todos los colaboradores.
        $entorno = str_replace("{POR_AVANCE_OBJ}", ($obj_fin * 100) / count($evaluados), $entorno);
        $entorno = str_replace("{POR_AVANCE_EV_EQUIPO}", 0, $entorno);
        $entorno = str_replace("{LISTADO_COLABORADORES}", ($total_evaluados), $entorno);
        $html    = str_replace("{ENTORNO_LISTADO_COLABORADORES}", ($entorno), $html);
    }
    return ($html);
}
function ColocaTitulosDinamicosPorEmpresa($PRINCIPAL, $id_empresa, $seccion)
{
    $titulos = TitulosDinamicosPorEmpresaEnv($id_empresa, $seccion);
    foreach ($titulos as $tit) {
        $PRINCIPAL = str_replace($tit->etiqueta, utf8_encode($tit->titulo), $PRINCIPAL);
    }
    return ($PRINCIPAL);
}
function ListadoTotalCalibrador($html, $rut, $proceso_anual, $id_empresa, $id_proceso, $id_proceso_a_calibrar)
{
    $html                = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($rut), $html);
    $datos_evaluado_jefe = UsuarioEnBasePersonas($rut);
    $datos_usuario       = UsuarioEnBasePersonas($rut);
    $html                = str_replace("{NOMBRE_DEPENDIENTE}", utf8_encode($datos_usuario[0]->nombre), $html);
    $html                = str_replace("{PARAMETROS_EVAL}", Encodear3($ev->rut . ";" . $rut), $html);
    $entorno             = file_get_contents("views/sgd/sgd2_entorno_equipo_chilquinta_calibracion.html");
    $entorno             = str_replace("{TABLA_DATOS_USUARIO_SUPERIOR}", file_get_contents("views/sgd/tabla_datos_superior_usuario.html"), $entorno);
    $entorno             = ColocaDatosUsuario($entorno, $rut, "graficoFrecuenciaCompetencia");
    $entorno             = str_replace("{SECCION_GRAFICOS_CONSOLIDADOS}", file_get_contents("views/sgd/vista_consolidada_graficos.html"), $entorno);
    $entorno             = str_replace("{GRAFICO1.1}", ConsolidadoLineal("", $rut, $id_proceso_a_calibrar, $id_empresa), $entorno);
    $entorno             = str_replace("{GRAFICO1.2}", GraficoPorCompetenciasPorEvaluadorCalibrador("", $id_proceso_a_calibrar, $rut), $entorno);
    $evaluadores         = TraeEvaluadoresPorProcesoDadoCalibrador($rut, $id_proceso_a_calibrar);
    if (!$evaluadores) {
        $html = str_replace("{ENTORNO_LISTADO_COLABORADORES}", "
            <div class='row'>
            </div>
            ", $html);
    } else {
        $total_evaluados = "";
        $obj_fin         = 0;
        foreach ($evaluadores as $ev) {
            $row = file_get_contents("views/sgd/listado_colaboradores/row_colaboradores_calibracion.html");
            $total_evaluados .= ColocaDatosUsuario($row, $ev->rut);
            //COMENTADO PARA OPTIMIZAR 22-11-2015
            $total_evaluados = ColocaAvanceEvaluadorDadoLosFinalizados($total_evaluados, $ev->rut, $id_proceso_a_calibrar, $id_empresa);
            if ($id_empresa == 28) {
                $total_evaluados          = str_replace("{TABLA_RESUMEN1}", file_get_contents("views/sgd/informe/tabla_superior_resumen/tabla_resumen1_sinareacorp_dinamico_chilquinta.html"), $total_evaluados);
                $total_evaluados          = str_replace("{BOTON_EVALUACION_INDIVIDUAL}", file_get_contents("views/sgd/informe/tabla_superior_resumen/boton_eval_individual.html"), $total_evaluados);
                //Verifico si está finalizada la evaluacion de este proceso
                $verifica_eval_finalizada = FinalizadoEvaluadoEvaluador($ev->rut, $rut, $id_proceso);
                if ($verifica_eval_finalizada) {
                    $total_evaluados = str_replace("{BOTON_VE_INFORME_POR_PROCESO}", file_get_contents("views/sgd/informe/tabla_superior_resumen/boton_ve_informe.html"), $total_evaluados);
                } else {
                    $total_evaluados = str_replace("{BOTON_VE_INFORME_POR_PROCESO}", "", $total_evaluados);
                }
                $total_evaluados = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($ev->rut), $total_evaluados);
                $total_evaluados = str_replace("{ID_PROCESO_ENCODEADO}", Encodear3($id_proceso), $total_evaluados);
            } else {
                $total_evaluados = str_replace("{TABLA_RESUMEN1}", file_get_contents("views/sgd/informe/tabla_superior_resumen/tabla_resumen1_sinareacorp_dinamico.html"), $total_evaluados);
            }
            //$total_evaluados=ArmaTemplareDeTablaResumen($total_evaluados, $proceso_anual, $id_empresa, $ev->perfil_evaluacion, $ev->rut, $rut);
            //Verifico si está finalizado este evaluado en el proceso de objetivos
            $feedback_objetivos = TomoConocimientoEvaluado($ev->rut);
            if ($feedback_objetivos) {
                $obj_fin++;
            }
            //$total_evaluados = ColocaPonderaciones($total_evaluados, $ev->rut);
            $verifico_si_libero = EstadoAvanceLiberacionCalibracion($rut, $id_proceso_a_calibrar, $ev->rut);
            //if($verifico_si_libero[0]==0){
            if ($verifico_si_libero[0] == $verifico_si_libero[1]) {
                //$total_evaluados = str_replace("{BOTON_LIBERAR}","",$total_evaluados);
                $total_evaluados = str_replace("{BOTON_LIBERAR}", file_get_contents("views/sgd/listado_colaboradores/boton_liberar.html"), $total_evaluados);
                $total_evaluados = str_replace("{BOTON_VER_EVALUADOS_PARA_CALIBRAR}", file_get_contents("views/sgd/listado_colaboradores/boton_ve_colaboradores.html"), $total_evaluados);
            } else {
                $total_evaluados = str_replace("{BOTON_LIBERAR}", file_get_contents("views/sgd/listado_colaboradores/boton_liberar.html"), $total_evaluados);
                //aca debo verificar si la evaluacion de este evaluado está finalizada o no.
                $total_evaluados = str_replace("{BOTON_VER_EVALUADOS_PARA_CALIBRAR}", file_get_contents("views/sgd/listado_colaboradores/boton_ve_colaboradores_para_calibrar.html"), $total_evaluados);
            }
            $total_evaluados = str_replace("{ID_PROCESO_CALIBRAR_ENCODEADO}", Encodear3($id_proceso_a_calibrar), $total_evaluados);
            $total_evaluados = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($ev->rut), $total_evaluados);
            $total_evaluados = str_replace("{RUT_EVALUADOR_ENCODEADO}", Encodear3($ev->rut), $total_evaluados);
            $total_evaluados = str_replace("{RUT_CALIBRADOR_ENCODEADO}", Encodear3($rut), $total_evaluados);
            $total_evaluados = str_replace("{ID_PROCESO_CALIBRAR}", Encodear3($id_proceso_a_calibrar), $total_evaluados);
            $total_evaluados = str_replace("{ID_PROCESO}", Encodear3($id_proceso), $total_evaluados);
            $total_evaluados = ObtieneResumenesNotasFinalesPorEvaluador($total_evaluados, $ev->rut, $id_proceso_a_calibrar);
        }
        $entorno = ObtieneResumenesNotasFinalesPorEvaluador($entorno, "", $id_proceso_a_calibrar, $rut);
        //aca calculo el porcentaje de avance de objetivos de todos los colaboradores.
        $entorno = str_replace("{POR_AVANCE_OBJ}", ($obj_fin * 100) / count($evaluados), $entorno);
        $entorno = str_replace("{POR_AVANCE_EV_EQUIPO}", 0, $entorno);
        $entorno = str_replace("{LISTADO_COLABORADORES}", ($total_evaluados), $entorno);
        $html    = str_replace("{ENTORNO_LISTADO_COLABORADORES}", ($entorno), $html);
    }
    return ($html);
}
function ColocaDecimalesNotasFinales($numero_decimales, $valor, $tipo)
{
    if ($numero_decimales > 0) {
        return (number_format($valor, $numero_decimales, ".", "."));
    } else {
        return (round($valor));
    }
}
function colocarArchivosDirectores($rut, $id_empresa)
{
    $verifica = VerificoEnTablaDeDirectores($rut, $id_empresa);
    if ($verifica) {
        $template = file_get_contents("views/pagina/descarga_documentos.html");
    } else {
        $template = "";
    }
    return ($template);
}
Function PorcentajeAvanceEvaluador($evaluador, $id_proceso)
{
    //$perfiles=TotalPerfilesDadoEvaluador1PorProceso($evaluador, $id_proceso);
    //for($i=0;$i<count($perfiles);$i++){
    //        $sql.=" perfil_evaluacion='".$perfiles[$i]->id_perfil_ev."'";
    //        if($perfiles[$i+1]->id_perfil_ev) $sql.=" or";
    //    }
    //    $total_paginas=count(TotalIdCompetencias($sql));
    //Obtengo la pagina que esta el evaluador
    //    $pagina_actual=SesionSGDSoloEvaluador($evaluador, $id_proceso);
    //    $porcentaje_avance[0]=FormatearPorcentajesSinDecimal(($pagina_actual[0]->pagina*100)/$total_paginas);
    //    return($porcentaje_avance);
}
function ColocaAvanceEvaluadorDadoLosFinalizados($PRINCIPAL, $evaluador, $id_proceso, $id_empresa, $origen, $arreglo_post)
{
    if ($arreglo_post["rutevaluador"])
        $evaluador = $arreglo_post["rutevaluador"];
    if ($arreglo_post["rutcalibrador"])
        $calibrador = $arreglo_post["rutcalibrador"];
    //traigo total de evaluadores
    if ($evaluador) {
        $evaluados = TraeEvaluadosDadoEvaluadorPorProceso2SinAe($evaluador, $id_proceso);
    } else if ($id_proceso) {
        $evaluados = TraeEvaluadosDadoEvaluadorPorProceso2SinAeSoloProceso($id_proceso, $arreglo_post);
    }
    $finaliza = 0;
    foreach ($evaluados as $eva) {
        $esta_finalizado = FinalizadoEvaluadoEvaluadorProProceso($eva->rut, $eva->evaluador, $eva->id_proceso);
        if ($esta_finalizado) {
            $finaliza++;
        }
    }
    //total evaluaciones
    $arreglo[0] = count($evaluados);
    $arreglo[1] = $finaliza;
    if ($origen == "admin") {
        $grafico = file_get_contents("../front/views/sgd/graficos/graficoTorta.html");
    } else {
        $grafico = file_get_contents("views/sgd/graficos/" . $id_empresa . "_graficoTorta.html");
    }
    if ($origen == "admin") {
        $grafico = str_replace("{PIECHART_SGD}", "graficoAdminAvance", $grafico);
    } else {
        $grafico = str_replace("{PIECHART_SGD}", $evaluador, $grafico);
    }
    $grafico       = str_replace("{DETIPO}", "evaluaciones realizadas", $grafico);
    $grafico       = str_replace("{TOTAL_LIBERADOS}", $finaliza, $grafico);
    $grafico       = str_replace("{TOTAL_PENDIENTES}", count($evaluados), $grafico);
    $grafico       = str_replace("{TOTAL_MENOS_LIBERADOS}", (count($evaluados) - $finaliza), $grafico);
    $datos_proceso = TraeProcesosDeEvaluacionPorEmpresaYDiProceso($id_empresa, $id_proceso);
    $grafico       = str_replace("{COLOR_GRAFICO_2}", $datos_proceso[0]->color_grafico_2, $grafico);
    $grafico       = str_replace("{TITULO_GRAFICO_2}", $datos_proceso[0]->titulo_grafico_2, $grafico);
    $PRINCIPAL     = str_replace("{GRAFICO_AVANCE_EVALUADOR}", $grafico, $PRINCIPAL);
    return ($PRINCIPAL);
}
function OptionDestinatariosPorUsuario($seleccionado, $rut, $id_empresa)
{
    if ($rut) {
        $destinatarios = DAtosDestinatariosPorUsuario($rut);
    } else {
        $destinatarios = TiposDestinatariosPorEmpresa($id_empresa);
    }
    foreach ($destinatarios as $unico) {
        if ($unico->tipo_destinatario == $seleccionado) {
            $options .= "<option selected value='" . $unico->tipo_destinatario . "'>" . $unico->nombre . "</option>";
        } else {
            $options .= "<option value='" . $unico->tipo_destinatario . "'>" . $unico->nombre . "</option>";
        }
    }
    return ($options);
}
function ListadoIngresoPlanesParaSeguimiento($evaluado, $evaluador, $id_plan)
{
    //$tiene_bitacora=TraeDatosPorBitacora($evaluado);
    $tiene_planes       = TraeDatosPorPlanes($evaluado);
    //VErifico si los planes estan finalizados
    $planes_finalizados = VerificaEstadoPlanes($evaluado);
    if ($tiene_planes) {
        foreach ($tiene_planes as $dato) {
            if ($dato->id == $id_plan) {
                $template .= file_get_contents("views/sgd/planes/row_plan_edicion.html");
                $template = str_replace("{OPTIONS_VALORES}", OptionsCompetenciasPorPerfil($evaluado->perfil_evaluacion, ""), $template);
                $template = str_replace("{OPTIONS_PLAZOS_POR_EMPRESA}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_planes_plazos", $dato->plazo, "nombre", "id", "order by orden asc", $_SESSION["id_empresa"]), $template);
            } else {
                if ($planes_finalizados) {
                    if ($evaluado <> $evaluador) {
                        $template .= file_get_contents("views/sgd/planes/row_plan_lectura_sin_editar.html");
                        if ($dato->jefe_sugiere) {
                            if ($dato->seguimiento_grado_cumplimiento) {
                                $template = str_replace("{BLOQUE_COMENTARIOS_JEFE}", file_get_contents("views/sgd/planes/bloque_comentarios_jefe_lectura.html") . file_get_contents("views/sgd/planes/bloque_seguimiento_por_plan_lectura.html"), $template);
                                $template = str_replace("{GRADO_CUMPLIMIENTO}", $dato->seguimiento_grado_cumplimiento, $template);
                                $template = str_replace("{COMENTARIO_CUMPLIMIENTO}", $dato->seguimiento_comentario, $template);
                            } else {
                                $template = str_replace("{BLOQUE_COMENTARIOS_JEFE}", file_get_contents("views/sgd/planes/bloque_comentarios_jefe_lectura.html") . file_get_contents("views/sgd/planes/bloque_seguimiento_por_plan.html"), $template);
                            }
                            if ($dato->jefe_sugiere == "si") {
                                $template = str_replace("{SUGIERE}", "La Jefatura acepta los planes", $template);
                            } else {
                                $template = str_replace("{SUGIERE}", "La Jefatura acepta con observaciones", $template);
                            }
                            $template = str_replace("{COMENTARIO}", $dato->jefe_comentario, $template);
                        } else {
                            $template = str_replace("{BLOQUE_COMENTARIOS_JEFE}", file_get_contents("views/sgd/planes/bloque_comentarios_jefe.html"), $template);
                        }
                        $template = str_replace("{ID_PLAN}", $dato->id, $template);
                        $template = str_replace("{RUT_EVALUADO}", $evaluado, $template);
                    } else {
                        $template .= file_get_contents("views/sgd/planes/row_plan_lectura_sin_editar.html");
                        if ($dato->jefe_sugiere) {
                            if ($dato->seguimiento_grado_cumplimiento) {
                                $template = str_replace("{BLOQUE_COMENTARIOS_JEFE}", file_get_contents("views/sgd/planes/bloque_comentarios_jefe_lectura.html") . file_get_contents("views/sgd/planes/bloque_seguimiento_por_plan_lectura.html"), $template);
                                $template = str_replace("{GRADO_CUMPLIMIENTO}", $dato->seguimiento_grado_cumplimiento, $template);
                                $template = str_replace("{COMENTARIO_CUMPLIMIENTO}", $dato->seguimiento_comentario, $template);
                            } else {
                                $template = str_replace("{BLOQUE_COMENTARIOS_JEFE}", file_get_contents("views/sgd/planes/bloque_comentarios_jefe_lectura.html"), $template);
                            }
                            if ($dato->jefe_sugiere == "si") {
                                $template = str_replace("{SUGIERE}", "La Jefatura acepta los planes", $template);
                            } else {
                                $template = str_replace("{SUGIERE}", "La Jefatura acepta con observaciones", $template);
                            }
                            $template = str_replace("{COMENTARIO}", $dato->jefe_comentario, $template);
                        } else {
                            $template = str_replace("{BLOQUE_COMENTARIOS_JEFE}", "", $template);
                        }
                    }
                } else {
                    if ($evaluado <> $evaluador) {
                        $template = file_get_contents("views/sgd/planes/row_plan_no_finalizado_por_evaluado.html");
                    } else {
                        $template .= file_get_contents("views/sgd/planes/row_plan_lectura.html");
                    }
                }
            }
            $template = str_replace("{COMPETENCIA}", utf8_encode($dato->nombre_competencia), $template);
            $template = str_replace("{ACTIVIDAD_A_DESARROLLAR}", $dato->actividad_desarrollar, $template);
            $template = str_replace("{RESULTADO_ESPERADO}", $dato->resultado_esperado, $template);
            $template = str_replace("{FECHA_INICIO}", formatearFechaCompleta($dato->fecha_inicio), $template);
            $template = str_replace("{FECHA_TERMINO}", formatearFechaCompleta($dato->fecha_termino), $template);
            $template = str_replace("{PLAZOS}", $dato->plazo_nombre, $template);
            $template = str_replace("{ID_PLANES_ENCODEADO}", Encodear3($dato->id), $template);
        }
        $arreglo[0] = "si";
        $arreglo[1] = $template;
    } else {
        if ($evaluado <> evaluador) {
            $template = file_get_contents("views/sgd/planes/row_plan_no_finalizado_por_evaluado.html");
        } else {
            $template = file_get_contents("views/sgd/planes/sin_planes.html");
        }
        $arreglo[0] = "no";
        $arreglo[1] = $template;
    }
    return ($arreglo);
}
function ListadoColaboradoresPlanesSeguimiento($html, $evaluador, $rut_evaluado, $id_plan)
{
    $evaluados = EvaluadosDadoEvaluador($evaluador);
    //Se muestran los objetivos individuales.
    if ($_SESSION["id_empresa"] == 28) {
        $total_html   = file_get_contents("views/sgd/planes/entorno_bloque_principal_chilquinta.html");
        $template_row = file_get_contents("views/sgd/planes/row_colaboradores_chilquinta.html");
    } else {
        $total_html   = file_get_contents("views/sgd/planes/entorno_bloque_principal.html");
        $template_row = file_get_contents("views/sgd/planes/row_colaboradores.html");
    }
    //Primero veo si es que hay registro en la tabla de sesion
    $row           = "";
    $ok_finalizado = 0;
    foreach ($evaluados as $evaluado) {
        $row .= $template_row;
        $objetivos_validados_por_validador = VerificaSiObjetivosEstanValidados($evaluado->evaluado);
        if ($evaluado->evaluado == $evaluador) {
            $row = ColocaDatosUsuario($row, $evaluado->evaluado, "sinmensaje");
        } else {
            $row = ColocaDatosUsuario($row, $evaluado->evaluado, "sinmensaje");
        }
        //$listado=ListadoIngresoPlanes($evaluado->evaluado, $evaluador, $id_plan, "jefe");
        $listado                    = ListadoIngresoPlanesParaSeguimiento($evaluado->evaluado, $evaluador, $id_plan, "jefe");
        $row                        = str_replace("{LISTADO_OBJETIVOS_A_EVALUAR}", $listado[1], $row);
        $row                        = str_replace("{BOTON_PLANES_INGRESA}", "", $row);
        $ponderaciones_bases        = DevuelvePonderacionesPorEvaluado($evaluado->evaluado);
        $verifica_evaluado_validado = VerificaSiObjetivosEstanAjustados($evaluado->evaluado);
        if ($rut_evaluado == $evaluado->evaluado && !$id_plan) {
            $row = str_replace("{FORMUARIO_BITACORA}", file_get_contents("views/sgd/planes/formulario.html"), $row);
            $row = str_replace("{OPTIONS_VALORES}", OptionsCompetenciasPorPerfil($evaluado->perfil_evaluacion, ""), $row);
            $row = str_replace("{OPTIONS_PLAZOS_POR_EMPRESA}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_planes_plazos", "", "nombre", "id", "order by orden asc", $_SESSION["id_empresa"]), $row);
        } else {
            $row = str_replace("{FORMUARIO_BITACORA}", "", $row);
        }
        $row          = str_replace("{RUT_ENCODEADO}", Encodear3($evaluado->evaluado), $row);
        $row          = str_replace("{RUT_EVALUADO}", ($evaluado->evaluado), $row);
        $total_planes = TraeDatosPorPlanes($evaluado->evaluado);
        $row          = str_replace("{X_PLANES}", count($total_planes), $row);
        $row          = str_replace("{BOTON_JEFE_VALIDA_OBJETIVOS}", "", $row);
        $row          = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($evaluado->evaluado), $row);
        //ACA veo si es que tiene comentarios de rechazo
        //ACA VEO PARA COLOCAR EL BOTON ENVIAR A VALIDACION
        if ($evaluado->evaluado == $evaluador) {
            if ($listado[0] == "si") {
                $plan_finalizado = VerificaEstadoPlanes($evaluado->evaluado);
                if ($plan_finalizado) {
                    $row = str_replace("{BOTON_VALIDACIONES_PLANES}", "", $row);
                } else {
                    $row = str_replace("{BOTON_VALIDACIONES_PLANES}", file_get_contents("views/sgd/planes/boton_envia_a_validar.html"), $row);
                    $row = str_replace("{RUT_USUARIO_ENCODEADO}", Encodear3($evaluado->evaluado), $row);
                }
            } else {
                $row = str_replace("{BOTON_VALIDACIONES_PLANES}", "", $row);
            }
        } else {
            $row = str_replace("{BOTON_VALIDACIONES_PLANES}", "", $row);
        }
    }
    $total_html = str_replace("{LISTADO_COLABORADORES}", ($row), $total_html);
    $html       = str_replace("{ENTORNO_LISTADO_EVALUACION}", ($total_html), $html);
    return ($html);
}
function ListadoIngresoPlanes($evaluado, $evaluador, $id_plan, $tipo, $id_proceso, $id_proceso_plan, $perfil_evaluacion)
{
    //print_R($_SESSION);
    $id_empresa         = $_SESSION["id_empresa"];
    $datos_proceso      = TraeProcesosDeEvaluacionDadoId($_SESSION["id_proceso"]);
    //$tiene_bitacora=TraeDatosPorBitacora($evaluado);
    //$tiene_planes=TraeDatosPorPlanes($evaluado);
    //$tiene_planes=TraeDatosPorPlanesPorProceso($evaluado, $datos_proceso[0]->id_proceso_a_evaluar);
    $tiene_planes       = TraeDatosPorPlanesPorProcesoPlan($evaluado, $id_proceso_plan);
    //VErifico si los planes estan finalizados
    //$planes_finalizados=VerificaEstadoPlanes($evaluado);
    $planes_finalizados = VerificaEstadoPlanesPorProcesoEmpresa($evaluado, $id_proceso_plan, $id_empresa);
    if ($tiene_planes) {
        foreach ($tiene_planes as $dato) {
            if ($dato->id == $id_plan) {
                $template .= file_get_contents("views/sgd/planes/row_plan_edicion.html");
                //$template = str_replace("{OPTIONS_VALORES}",OptionsCompetenciasPorPerfil($evaluado->perfil_evaluacion, ""),$template);
                $template = str_replace("{OPTIONS_VALORES}", OptionsCompetenciasDadoPerfil($perfil_evaluacion, $dato->id_competencia), $template);
                $template = str_replace("{OPTIONS_PLAZOS_POR_EMPRESA}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_planes_plazos", $dato->plazo, "nombre", "id", "order by orden asc", $_SESSION["id_empresa"]), $template);
            } else {
                if ($planes_finalizados) {
                    if ($evaluado <> $evaluador) {
                        $template .= file_get_contents("views/sgd/planes/row_plan_lectura_sin_editar.html");
                        if ($dato->jefe_sugiere) {
                            $template = str_replace("{BLOQUE_COMENTARIOS_JEFE}", file_get_contents("views/sgd/planes/bloque_comentarios_jefe_lectura.html"), $template);
                            if ($dato->jefe_sugiere == "si") {
                                $template = str_replace("{SUGIERE}", "La Jefatura acepta los planes", $template);
                            } else {
                                $template = str_replace("{SUGIERE}", "La Jefatura acepta con observaciones", $template);
                            }
                            $template = str_replace("{COMENTARIO}", $dato->jefe_comentario, $template);
                        } else {
                            $template = str_replace("{BLOQUE_COMENTARIOS_JEFE}", file_get_contents("views/sgd/planes/bloque_comentarios_jefe.html"), $template);
                            $template = str_replace("{ID_PLAN}", $dato->id, $template);
                            $template = str_replace("{RUT_EVALUADO}", $evaluado, $template);
                        }
                    } else {
                        //$template.=file_get_contents("views/sgd/planes/row_plan_lectura_sin_editar.html");
                        $template .= file_get_contents("views/sgd/planes/row_plan_lectura_con_grado_avance.html");
                        //$template = str_replace("{BLOQUE_COMENTARIOS_JEFE}","ddfdf",$template);
                        if ($dato->jefe_sugiere) {
                            $template = str_replace("{BLOQUE_COMENTARIOS_JEFE}", file_get_contents("views/sgd/planes/bloque_comentarios_jefe_lectura.html"), $template);
                            if ($dato->jefe_sugiere == "si") {
                                $template = str_replace("{SUGIERE}", "La Jefatura acepta los planes", $template);
                            } else {
                                $template = str_replace("{SUGIERE}", "La Jefatura acepta con observaciones", $template);
                            }
                            $template = str_replace("{COMENTARIO}", $dato->jefe_comentario, $template);
                        } else {
                            $template = str_replace("{BLOQUE_COMENTARIOS_JEFE}", "", $template);
                        }
                    }
                } else {
                    if ($evaluado <> $evaluador) {
                        $template = file_get_contents("views/sgd/planes/row_plan_no_finalizado_por_evaluado.html");
                    } else {
                        $template .= file_get_contents("views/sgd/planes/row_plan_lectura.html");
                    }
                }
            }
            //SEGUIMIENTO
            if ($dato->seguimiento_grado_cumplimiento && $dato->seguimiento_comentario) {
                $template = str_replace("{BLOQUE_SEGUIMIENTO}", file_get_contents("views/sgd/planes/28_bloque_seguimiento_lectura.html"), $template);
                $template = str_replace("{GRADO}", $dato->seguimiento_grado_cumplimiento, $template);
                $template = str_replace("{COMENTARIO_SEGUIMIENTO}", utf8_encode($dato->seguimiento_comentario), $template);
            } else {
                if ($evaluado == $evaluador) {
                    $template = str_replace("{BLOQUE_SEGUIMIENTO}", file_get_contents("views/sgd/planes/28_bloque_seguimiento.html"), $template);
                } else {
                    $template = str_replace("{BLOQUE_SEGUIMIENTO}", "", $template);
                }
            }
            $template = str_replace("{COMPETENCIA}", utf8_encode($dato->nombre_competencia), $template);
            $template = str_replace("{ACTIVIDAD_A_DESARROLLAR}", $dato->actividad_desarrollar, $template);
            $template = str_replace("{RESULTADO_ESPERADO}", $dato->resultado_esperado, $template);
            //$template = str_replace("{FECHA_INICIO}",formatearFechaCompleta($dato->fecha_inicio),$template);
            $template = str_replace("{FECHA_INICIO}", ($dato->fecha_inicio), $template);
            //$template = str_replace("{FECHA_TERMINO}",formatearFechaCompleta($dato->fecha_termino),$template);
            $template = str_replace("{FECHA_TERMINO}", ($dato->fecha_termino), $template);
            $template = str_replace("{PLAZOS}", $dato->plazo_nombre, $template);
            $template = str_replace("{ID_PLANES_ENCODEADO}", ($dato->id), $template);
            $template = str_replace("{ID_PROCESO_ENCODEADO}", Encodear3($id_proceso), $template);
            $template = str_replace("{ID_PROCESO_PLAN_ENCODEADO}", Encodear3($id_proceso_plan), $template);
        }
        $arreglo[0] = "si";
        $arreglo[1] = $template;
    } else {
        if ($evaluado <> evaluador) {
            $template = file_get_contents("views/sgd/planes/row_plan_no_finalizado_por_evaluado.html");
        } else {
            $template = file_get_contents("views/sgd/planes/sin_planes.html");
        }
        $arreglo[0] = "no";
        $arreglo[1] = $template;
    }
    return ($arreglo);
}
function OptionsCompetenciasPorPerfil($perfil, $seleccionado)
{
    $competencias = CompetenciasPorPerfilConNombre($perfil);
    foreach ($competencias as $unico) {
        $options .= "<option value='" . $unico->id_componente . "'>" . $unico->nombre_competencia . "</option>";
    }
    return (utf8_encode($options));
}
function ListadoColaboradoresPlanes($html, $evaluador, $rut_evaluado, $id_plan, $id_proceso, $id_proceso_plan)
{
    $id_empresa = $_SESSION["id_empresa"];
    //$evaluados=EvaluadosDadoEvaluador($evaluador);
    $evaluados  = EvaluadosDadoEvaluadorParaBitacoraPorProceso($evaluador, $id_proceso);
    //Se muestran los objetivos individuales.
    if ($_SESSION["id_empresa"] == 28) {
        $total_html   = file_get_contents("views/sgd/planes/entorno_bloque_principal_chilquinta.html");
        $template_row = file_get_contents("views/sgd/planes/row_colaboradores_chilquinta.html");
    } else {
        $total_html   = file_get_contents("views/sgd/planes/entorno_bloque_principal.html");
        $template_row = file_get_contents("views/sgd/planes/row_colaboradores.html");
    }
    //Primero veo si es que hay registro en la tabla de sesion
    $row           = "";
    $ok_finalizado = 0;
    foreach ($evaluados as $evaluado) {
        $row .= $template_row;
        if ($evaluado->evaluado == $evaluador) {
            $row = str_replace("{BOTON_PLANES_INGRESA}", file_get_contents("views/sgd/planes/boton_ingreso_formulario.html"), $row);
        } else {
            $row = str_replace("{BOTON_PLANES_INGRESA}", "", $row);
        }
        $objetivos_validados_por_validador = VerificaSiObjetivosEstanValidados($evaluado->evaluado);
        //$row=FormularioIngresaObjetivos($row, $evaluado->evaluado, $evaluador);
        if ($evaluado->evaluado == $evaluador) {
            $row = ColocaDatosUsuario($row, $evaluado->evaluado, "planes");
        } else {
            $row = ColocaDatosUsuario($row, $evaluado->evaluado, "sinmensaje");
        }
        //$valores_objetivos=ListadoObjetivosAValidar($evaluado->evaluado, $evaluador, $id_objetivo, "jefe");
        $listado                    = ListadoIngresoPlanes($evaluado->evaluado, $evaluador, $id_plan, "jefe", $id_proceso, $id_proceso_plan, $evaluado->perfil_evaluacion_competencias);
        $row                        = str_replace("{LISTADO_OBJETIVOS_A_EVALUAR}", $listado[1], $row);
        $ponderaciones_bases        = DevuelvePonderacionesPorEvaluado($evaluado->evaluado);
        $verifica_evaluado_validado = VerificaSiObjetivosEstanAjustados($evaluado->evaluado);
        if ($rut_evaluado == $evaluado->evaluado && !$id_plan) {
            $row = str_replace("{FORMUARIO_BITACORA}", file_get_contents("views/sgd/planes/formulario.html"), $row);
            //$row = str_replace("{OPTIONS_VALORES}",OptionsGenericoNombreDadoValoresPorEmpresa("tbl_bitacora_valores", "",  "valor", "id", "order by valor asc", $_SESSION["id_empresa"]),$row);
            //]Aca traigo las competencias de este perfil
            $row = str_replace("{OPTIONS_VALORES}", OptionsCompetenciasDadoPerfil($evaluado->perfil_evaluacion_competencias, ""), $row);
            $row = str_replace("{OPTIONS_PLAZOS_POR_EMPRESA}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_planes_plazos", "", "nombre", "id", "order by orden asc", $_SESSION["id_empresa"]), $row);
        } else if ($_SESSION["user_"] == $evaluado->evaluado) {
            $row = str_replace("{FORMUARIO_BITACORA}", file_get_contents("views/sgd/planes/formulario.html"), $row);
            //$row = str_replace("{OPTIONS_VALORES}",OptionsGenericoNombreDadoValoresPorEmpresa("tbl_bitacora_valores", "",  "valor", "id", "order by valor asc", $_SESSION["id_empresa"]),$row);
            //]Aca traigo las competencias de este perfil
            $row = str_replace("{OPTIONS_VALORES}", OptionsCompetenciasDadoPerfil($evaluado->perfil_evaluacion_competencias, ""), $row);
            $row = str_replace("{OPTIONS_PLAZOS_POR_EMPRESA}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_planes_plazos", "", "nombre", "id", "order by orden asc", $_SESSION["id_empresa"]), $row);
        } else {
            $row = str_replace("{FORMUARIO_BITACORA}", "", $row);
        }
        $row              = str_replace("{RUT_ENCODEADO}", Encodear3($evaluado->evaluado), $row);
        $row              = str_replace("{RUT_EVALUADO}", ($evaluado->evaluado), $row);
        //$total_planes=TraeDatosPorPlanes($evaluado->evaluado);
        $total_planes     = TraeDatosPorPlanesPorProcesoPlan($evaluado->evaluado, $id_proceso_plan);
        $row              = str_replace("{X_PLANES}", count($total_planes), $row);
        //$planes_validados=TraePlanesValidados($evaluado->evaluado);
        $planes_validados = TraePlanesValidadosPorProcesoPlan($evaluado->evaluado, $id_proceso_plan);
        $row              = str_replace("{X_VALIDADOS}", count($planes_validados), $row);
        $row              = str_replace("{X_NO_VALIDADOS}", count($total_planes) - count($planes_validados), $row);
        $row              = str_replace("{BOTON_JEFE_VALIDA_OBJETIVOS}", "", $row);
        $row              = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($evaluado->evaluado), $row);
        //ACA veo si es que tiene comentarios de rechazo
        //ACA VEO PARA COLOCAR EL BOTON ENVIAR A VALIDACION
        if ($evaluado->evaluado == $evaluador) {
            if ($listado[0] == "si") {
                //$plan_finalizado=VerificaEstadoPlanes($evaluado->evaluado);
                $plan_finalizado = VerificaEstadoPlanesPorProcesoEmpresa($evaluado->evaluado, $id_proceso_plan, $id_empresa);
                if ($plan_finalizado) {
                    $row = str_replace("{BOTON_VALIDACIONES_PLANES}", "", $row);
                } else {
                    $row = str_replace("{BOTON_VALIDACIONES_PLANES}", file_get_contents("views/sgd/planes/boton_envia_a_validar.html"), $row);
                    $row = str_replace("{RUT_USUARIO_ENCODEADO}", Encodear3($evaluado->evaluado), $row);
                }
            } else {
                $row = str_replace("{BOTON_VALIDACIONES_PLANES}", "", $row);
            }
        } else {
            $row = str_replace("{BOTON_VALIDACIONES_PLANES}", "", $row);
        }
    }
    $total_html = str_replace("{LISTADO_COLABORADORES}", ($row), $total_html);
    $html       = str_replace("{ENTORNO_LISTADO_EVALUACION}", ($total_html), $html);
    return ($html);
}
function ColocaMeGusta($id_objeto, $tipo_objeto, $id_empresa, $rut, $autor, $id_objeto_curso_megusta)
{
    $tiene_megusta = VerCantidadMeGustaPorObjetoYUsuario($id_objeto, $tipo_objeto, $id_empresa, $rut);
    if ($tiene_megusta or $autor) {
        $row              = file_get_contents("views/megusta/bloque_comentario_yamegusta.html");
        $cantidad_megusta = VerCantidadMeGustaPorObjeto($id_objeto, $tipo_objeto, $id_empresa);
        $row              = str_replace("{CANTIDAD_MEGUSTA}", count($cantidad_megusta), $row);
    } else {
        $row              = file_get_contents("views/megusta/bloque_comentario_megusta.html");
        $row              = str_replace("{ID_CONTENIDO}", ($id_objeto), $row);
        $row              = str_replace("{TIPO_OBJETO_MEGUSTA}", $tipo_objeto, $row);
        $row              = str_replace("{ID_OBJETO_MEGUSTA}", $_SESSION["id_objeto"], $row);
        $cantidad_megusta = VerCantidadMeGustaPorObjeto($id_objeto, $tipo_objeto, $id_empresa);
        $row              = str_replace("{CANTIDAD_MEGUSTA}", count($cantidad_megusta), $row);
    }
    return ($row);
}
function ColocaMeGustaApoyoInt($id_objeto, $tipo_objeto, $id_empresa, $rut, $autor, $id_objeto_curso_megusta)
{
    $tiene_megusta = VerInteraccionesPorObjetoYUsuario($id_objeto, $tipo_objeto, $id_empresa, $rut, "MEGUSTA");
    if ($tiene_megusta) {
        $row = file_get_contents("views/megusta/bloque_comentario_yamegusta_apoyo.html");
        //$cantidad_megusta=VerCantidadMeGustaPorObjeto($id_objeto, $tipo_objeto, $id_empresa);
        //$row = str_replace("{CANTIDAD_MEGUSTA}",count($cantidad_megusta),$row);
    } else {
        $row = file_get_contents("views/megusta/bloque_comentario_megusta_apoyo.html");
        $row = str_replace("{ID_CONTENIDO}", ($id_objeto), $row);
        $row = str_replace("{TIPO_OBJETO_MEGUSTA}", $tipo_objeto, $row);
        $row = str_replace("{ID_OBJETO_MEGUSTA}", $_SESSION["id_objeto"], $row);
        //$cantidad_megusta=VerCantidadMeGustaPorObjeto($id_objeto, $tipo_objeto, $id_empresa);
        //$row = str_replace("{CANTIDAD_MEGUSTA}",count($cantidad_megusta),$row);
    }
    return ($row);
}
function ColocaFavoritoInt($id_objeto, $tipo_objeto, $id_empresa, $rut, $autor, $id_objeto_curso_megusta)
{
    $tiene_favorita = VerInteraccionesPorObjetoYUsuario($id_objeto, $tipo_objeto, $id_empresa, $rut, "FAVORITA");
    if ($tiene_favorita) {
        $row = file_get_contents("views/megusta/bloque_comentario_yafavorita_apoyo.html");
        //$cantidad_megusta=VerCantidadMeGustaPorObjeto($id_objeto, $tipo_objeto, $id_empresa);
        //$row = str_replace("{CANTIDAD_MEGUSTA}",count($cantidad_megusta),$row);
    } else {
        $row = file_get_contents("views/megusta/bloque_comentario_favorita_apoyo.html");
        $row = str_replace("{ID_CONTENIDO}", ($id_objeto), $row);
        $row = str_replace("{TIPO_OBJETO_MEGUSTA}", $tipo_objeto, $row);
        $row = str_replace("{ID_OBJETO_MEGUSTA}", $_SESSION["id_objeto"], $row);
        //$cantidad_megusta=VerCantidadMeGustaPorObjeto($id_objeto, $tipo_objeto, $id_empresa);
        //$row = str_replace("{CANTIDAD_MEGUSTA}",count($cantidad_megusta),$row);
    }
    return ($row);
}

function MuestraSucursal($PRINCIPAL, $id_sucursal, $id_empresa)
{
    //con el ide de empresa e id de sucursal,traigo los campos a leer
    $campos = TraigoCamposParaSucursalPorEmpresa($id_empresa);
    /*$i=1;
    foreach($campos as $camp){
    $campos_valor.=$camp->campo." as ".$camp->nombrecampo;
    if($i<count($campos)){
    $campos_valor.=", ";
    }
    $i++;
    }
    */
    foreach ($campos as $camp) {
        $dato_a_mostrar = TraeCampoPorSucursalEmpresa($camp->campo, $id_sucursal, $id_empresa);
        $row .= file_get_contents("views/sucursales/row_datos.html");
        $row = str_replace("{NOMBRE_CAMPO}", $camp->nombrecampo, $row);
        if ($camp->veperfil) {
            $datos_usuario = UsuarioEnBasePersonas($dato_a_mostrar[0]->valor);
            $row           = str_replace("{VALOR_CAMPO}", "<a  href='?sw=veperfil&r=" . Encodear3($dato_a_mostrar[0]->valor) . "'>" . $datos_usuario[0]->nombre_completo . " </a>", $row);
        } else {
            $row = str_replace("{VALOR_CAMPO}", $dato_a_mostrar[0]->valor, $row);
        }
    }
    //traigo la coordenada X
    $coordenadaX = TraeCampoPorSucursalEmpresa("coordenadax_googlemap", $id_sucursal, $id_empresa);
    $coordenadaY = TraeCampoPorSucursalEmpresa("coordenaday_googlemap", $id_sucursal, $id_empresa);
    $PRINCIPAL   = str_replace("{COORX}", $coordenadaX[0]->valor, $PRINCIPAL);
    $PRINCIPAL   = str_replace("{ROW_DATOS}", utf8_encode($row), $PRINCIPAL);
    $PRINCIPAL   = str_replace("{COORY}", $coordenadaY[0]->valor, $PRINCIPAL);
    return ($PRINCIPAL);
}

function ArmaTemplareDeTablaResumen($html, $id_proceso_anual, $id_empresa, $perfil_evaluacion, $evaluado, $rut, $muestra_boton_informe, $id_proceso_para_reportes_admin)
{
    //$id_proceso_para_reportes_admin -->se lo paso desde el admin, para los reportes de resultados
    //echo "$id_proceso_anual, $id_empresa, $perfil_evaluacion, $evaluado, $rut, $muestra_boton_informe, $id_proceso_para_reportes_admin";
    $porcentajes = TraePonderacionesPorPerfil($perfil_evaluacion);
    $contador    = 0;
    if ($porcentajes[0]->objetivos_empresa > 0) {
        $tr_items .= file_get_contents("views/sgd/informe/tabla_superior_resumen/tr_por_item.html");
        $tr_items = str_replace("{ITEM_PORCEN}", $porcentajes[0]->objetivos_empresa . "% Corporativo", $tr_items);
        $tr_valores .= file_get_contents("views/sgd/informe/tabla_superior_resumen/tr_valores_empresa.html");
        $contador++;
    }
    if ($porcentajes[0]->objetivos_area > 0) {
        $tr_items .= file_get_contents("views/sgd/informe/tabla_superior_resumen/tr_por_item.html");
        $tr_items = str_replace("{ITEM_PORCEN}", $porcentajes[0]->objetivos_area . "% Area", $tr_items);
        $tr_valores .= file_get_contents("views/sgd/informe/tabla_superior_resumen/tr_valores_area.html");
        $contador++;
    }
    if ($porcentajes[0]->objetivos_individuales > 0) {
        $tr_items .= file_get_contents("views/sgd/informe/tabla_superior_resumen/tr_por_item.html");
        $tr_items = str_replace("{ITEM_PORCEN}", $porcentajes[0]->objetivos_individuales . "% " . $porcentajes[0]->nombre_objetivos_individuales, $tr_items);
        $tr_valores .= file_get_contents("views/sgd/informe/tabla_superior_resumen/tr_valores_ind.html");
        $contador++;
    }
    if ($porcentajes[0]->competencias > 0) {
        $tr_items .= file_get_contents("views/sgd/informe/tabla_superior_resumen/tr_por_item.html");
        if ($id_empresa == 28) {
            $tr_items = str_replace("{ITEM_PORCEN}", $porcentajes[0]->nombre_competencias, $tr_items);
        } else {
            $tr_items = str_replace("{ITEM_PORCEN}", $porcentajes[0]->competencias . "% " . $porcentajes[0]->nombre_competencias, $tr_items);
        }
        $tr_valores .= file_get_contents("views/sgd/informe/tabla_superior_resumen/tr_valores_comp.html");
        $contador++;
    }
    if ($id_empresa == 28 or $id_empresa == 61) {
        $tr_items .= file_get_contents("views/sgd/informe/tabla_superior_resumen/tr_por_item.html");
        $tr_items = str_replace("{ITEM_PORCEN}", "Autoevaluacion", $tr_items);
        $tr_valores .= file_get_contents("views/sgd/informe/tabla_superior_resumen/tr_valores_ae.html");
        $contador++;
    }
    $html                = str_replace("{FILAS_DINAMICAS_DE_LOS_PORCENTAJES}", utf8_encode($tr_items), $html);
    $datos_proceso_anual = DatosProcesoAnual($id_proceso_anual, $id_empresa);
    //$procesos=ProcesosEvalPorProcesoAnual($datos_proceso_anual[0]->id);
    $procesos            = ProcesosEvalPorProcesoAnualParaTabla($datos_proceso_anual[0]->id, "evaluacion");
    $td_por_proceso      = "";
    if ($id_empresa == 28) {
        $row_template = file_get_contents("views/sgd/informe/tabla_superior_resumen/td_por_proceso_chilquinta.html");
    } else {
        $row_template = file_get_contents("views/sgd/informe/tabla_superior_resumen/td_por_proceso.html");
    }
    foreach ($procesos as $unico) {
        $td_por_proceso .= $row_template;
        if ($unico->evaluacion_individual == 1) {
            $td_por_proceso = str_replace("{BOTON_EVALUACION_INDIVIDUAL}", file_get_contents("views/sgd/informe/tabla_superior_resumen/boton_eval_individual.html"), $td_por_proceso);
        } else {
            $td_por_proceso = str_replace("{BOTON_EVALUACION_INDIVIDUAL}", "", $td_por_proceso);
        }
        //Por cada proceso, verifico si está finalizado para este evaluado y evaluador, asi
        //veo si coloco o no el boton de Ver Informe
        if ($muestra_boton_informe == "no") {
            $td_por_proceso = str_replace("{BOTON_VE_INFORME_POR_PROCESO}", "", $td_por_proceso);
        } else {
            $proceso_finalizado = FinalizadoEvaluadoEvaluadorProProceso($evaluado, $rut, $unico->id_proceso);
            if ($proceso_finalizado) {
                if ($muestra_boton_informe == "no") {
                    $td_por_proceso = str_replace("{BOTON_VE_INFORME_POR_PROCESO}", "", $td_por_proceso);
                } else {
                    $td_por_proceso = str_replace("{BOTON_VE_INFORME_POR_PROCESO}", file_get_contents("views/sgd/informe/tabla_superior_resumen/boton_ve_informe.html"), $td_por_proceso);
                }
            } else {
                $td_por_proceso = str_replace("{BOTON_VE_INFORME_POR_PROCESO}", "", $td_por_proceso);
            }
        }
        $td_por_proceso = str_replace("{NOMBRE_PROCESO}", $unico->descripcion_proceso, $td_por_proceso);
        $td_por_proceso = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($evaluado), $td_por_proceso);
        $td_por_proceso = str_replace("{ID_PROCESO_ENCODEADO}", Encodear3($unico->id_proceso), $td_por_proceso);
        $td_por_proceso = str_replace("{FILAS_NOTAS_DINAMICAS}", $tr_valores, $td_por_proceso);
        //Ahora por cada proceso, lo paso por la funcion que coloca los datos
        if ($evaluado == $rut) {
            $datos_rel = ObtenerJefeRelPorProceso($evaluado, $unico->id_proceso);
            //$rut=$datos_rel[0]->evaluador;
        }
        $td_por_proceso = ColocaResultadosTablaReumen($td_por_proceso, $evaluado, $rut, $unico->id_proceso, $unico->id_proceso, $id_proceso_para_reportes_admin);
        if ($unico->nota_final == 1) {
            if ($id_proceso_para_reportes_admin) {
                if ($id_proceso_para_reportes_admin == $unico->id_proceso) {
                    $html = ColocaResultadosTablaReumen($html, $evaluado, $rut, $unico->id_proceso, $unico->id_proceso, $id_proceso_para_reportes_admin);
                }
            } else {
                $html = ColocaResultadosTablaReumen($html, $evaluado, $rut, $unico->id_proceso, $unico->id_proceso, $id_proceso_para_reportes_admin);
            }
        }
    }
    $html = str_replace("{COLUMNAS_DINAMICAS_DADA_CANTIDAD_PROCESOS}", utf8_encode($td_por_proceso), $html);
    return ($html);
}

function OptionsCategoriasValoresFormularios($id_Categoria, $id_empresa)
{
    $valores = TraigoValoresPorCategoria($id_Categoria, $id_empresa);
    foreach ($valores as $val) {
        $html .= "<option value=" . $val->id . ">" . $val->nombre . "</option>";
    }
    return (utf8_encode($html));
}
function BloqueBuscadorPersonasDirectorio($html, $id_empresa)
{
    $html = str_replace("{SECCION_BUSCA_PERSONAS_DIRECTORIO}", file_get_contents("views/buscador_personas/buscador.html"), $html);
    return ($html);
}
function buscacursosaprobadospornivel($id_orden_nivel, $rut, $id_empresa, $id_malla)
{
    //echo "<br>$id_orden_nivel,$rut, $id_empresa, $id_malla";
    $buscacursosaprobadospornivel_arreglos = buscacursosaprobadospornivel_data($id_orden_nivel, $rut, $id_empresa, $id_malla);
    //print_r($buscacursosaprobadospornivel_arreglos);
    foreach ($buscacursosaprobadospornivel_arreglos as $cursonivel) {
        //    echo "<br>$cursonivel->idcurso ";
        //    echo "$cursonivel->aprobado";
        if ($cursonivel->aprobado == 1) {
            $cursoaprobado++;
        }
    }
    return $cursoaprobado;
}
function ObtenerAnosDadoFecha($fecha)
{
    $dias = explode("-", $fecha, 3);
    $dias = mktime(0, 0, 0, $dias[1], $dias[0], $dias[2]);
    $edad = (int) ((time() - $dias) / 31556926);
    return $edad;
}
function BloqueBanners($html, $id_empresa)
{
    //Traigo los banner por empresa
    $total_banners = BannersPorEmpresa($id_empresa);
    if ($total_banners) {
        $html_banners = "";
        foreach ($total_banners as $banner) {
            if ($banner->icono) {
                $html_banners .= file_get_contents("views/banners/imagentexto_conicono.html");
                $html_banners = str_replace("{ICONO}", $banner->icono, $html_banners);
            } else {
                $html_banners .= file_get_contents("views/banners/" . $banner->template);
            }
            $html_banners = str_replace("{TEXTO}", utf8_encode($banner->texto), $html_banners);
            $html_banners = str_replace("{IMAGEN_IZQUIERDA}", $banner->imagen_izquierda, $html_banners);
        }
        $html = str_replace("{SECCION_BANNERS}", ($html_banners), $html);
    } else {
        $html = str_replace("{SECCION_BANNERS}", "", $html);
    }
    return ($html);
}
function ArmaBloqueComentariosPorEmpresa($PRINCIPAL, $id_empresa, $rut, $id_categoria, $id_comentario)
{
    //echo "$id_categoria $id_comentario";
    $categorias = CategoriasComentariosPorEmpresa($id_empresa);
    foreach ($categorias as $cat) {
        if ($id_categoria == $cat->id) {
            $formulario .= file_get_contents("views/comentarios/formulario_edicion.html");
            $datos_comentario = DatosComentarioPorId($id_comentario);
            $formulario       = str_replace("{COMENTARIO}", $datos_comentario[0]->comentario, $formulario);
            $formulario       = str_replace("{ID_COMENTARIO_ENCODEADO}", $id_comentario, $formulario);
        } else {
            $formulario .= file_get_contents("views/comentarios/formulario.html");
        }
        $formulario      = str_replace("{DESCRIPCION}", $cat->descripcion, $formulario);
        $formulario      = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($rut), $formulario);
        $comentarios     = ComentariosPorCategoria($cat->id);
        $html_comentario = "";
        if ($comentarios) {
            foreach ($comentarios as $comen) {
                $html_comentario .= file_get_contents("views/comentarios/row_comentario.html");
                $html_comentario = str_replace("{COMENTARIO}", $comen->comentario, $html_comentario);
                $html_comentario = str_replace("{FECHA}", FechaTipoSpa($comen->fecha), $html_comentario);
                $html_comentario = str_replace("{ID_COMENTARIO_ENCODEADO}", Encodear3($comen->id), $html_comentario);
            }
            $formulario = str_replace("{BLOQUE_COMENTARIOS_INGRESADOS}", $html_comentario, $formulario);
        } else {
            $formulario = str_replace("{BLOQUE_COMENTARIOS_INGRESADOS}", "", $formulario);
        }
        $formulario = str_replace("{ID_CATEGORIA_COMENTARIO_ENCODEADO}", Encodear3($cat->id), $formulario);
    }
    //Veo si tiene comentarios
    $PRINCIPAL = str_replace("{ENTORNO_COMENTARIOS}", utf8_encode($formulario), $PRINCIPAL);
    return ($PRINCIPAL);
}
function EvaluadoParaEstaPregunta($id_componente, $id_pregunta, $evaluado, $id_perfil)
{
    //$preguntas_por_encuesta=PreguntasPorCompetenciaPorPerfilEval($id_perfil);
    $preguntas_por_encuesta = PreguntasPorCompetenciaPorPerfilEvalParaValidar($id_perfil);
    $muestra                = "no";
    foreach ($preguntas_por_encuesta as $unico) {
        if ($unico->id == $id_pregunta) {
            $muestra = "si";
            continue;
        }
    }
    return ($muestra);
}
function ListadoIngresoBitacoras($evaluado, $evaluador, $id_bitacora, $tipo, $sgd_version)
{
    if ($_SESSION["id_empresa"] == 28) {
        $tiene_bitacora = TraeDatosPorBitacoraPorCompetencia($evaluado);
    } else {
        $tiene_bitacora = TraeDatosPorBitacora($evaluado);
    }
    if ($tiene_bitacora) {
        foreach ($tiene_bitacora as $dato) {
            if ($dato->id == $id_bitacora) {
                if ($sgd_version == 2) {
                    $template .= file_get_contents("views/sgd/bitacora/row_bitacora_edicion_chilquinta.html");
                } else {
                    $template .= file_get_contents("views/sgd/bitacora/row_bitacora_edicion.html");
                }
                $template = str_replace("{OPTIONS_VALORES}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_bitacora_valores", $dato->valor, "valor", "id", "order by valor asc", $_SESSION["id_empresa"]), $template);
                if ($dato->realizado == "si") {
                    $template = str_replace("{CHECKEDREALIZADOSI}", "checked", $template);
                    $template = str_replace("{CHECKEDREALIZADONO}", "", $template);
                    $template = str_replace("{STYLE_DISPLAY}", 'style="display: none"', $template);
                } else if ($dato->realizado == "no") {
                    $template = str_replace("{CHECKEDREALIZADONO}", "checked", $template);
                    $template = str_replace("{CHECKEDREALIZADOSI}", "", $template);
                } else {
                    $template = str_replace("{CHECKEDREALIZADONO}", "", $template);
                    $template = str_replace("{CHECKEDREALIZADOSI}", "", $template);
                }
            } else {
                if ($sgd_version == 2) {
                    $template .= file_get_contents("views/sgd/bitacora/row_bitacora_lectura_chilquinta.html");
                    if ($evaluado == $evaluador) {
                        $template = str_replace("{BOTON_MODIFICAR}", file_get_contents("views/sgd/bitacora/boton_modifica.html"), $template);
                    } else {
                        $template = str_replace("{BOTON_MODIFICAR}", "", $template);
                    }
                } else {
                    $template .= file_get_contents("views/sgd/bitacora/row_bitacora_lectura.html");
                }
            }
            $template = str_replace("{VALOR}", utf8_encode($dato->nombre_valor), $template);
            $template = str_replace("{TEXTO_ST}", $dato->texto_st, $template);
            $template = str_replace("{AUTOR}", utf8_encode($dato->nombre_completo), $template);
            $template = str_replace("{FECHA}", formatearFechaCompleta($dato->fecha), $template);
            $template = str_replace("{TEXTO_A}", $dato->texto_a, $template);
            $template = str_replace("{TEXTO_R}", $dato->texto_r, $template);
            if ($dato->realizado == "si") {
                $template = str_replace("{REALIZADO}", file_get_contents("views/sgd/bitacora/realizado_si.html"), $template);
                $template = str_replace("{LINEA_BLOQUE_NEGATIVO}", file_get_contents("views/sgd/bitacora/row_bitacora_lectura_bloque_positivo.html"), $template);
            } else {
                $template = str_replace("{REALIZADO}", file_get_contents("views/sgd/bitacora/realizado_no.html"), $template);
                $template = str_replace("{LINEA_BLOQUE_NEGATIVO}", file_get_contents("views/sgd/bitacora/row_bitacora_lectura_bloque_negativo.html"), $template);
            }
            //$template = str_replace("{REALIZADO}",$dato->realizado,$template);
            $template = str_replace("{TEXTO_AA}", $dato->texto_aa, $template);
            $template = str_replace("{TEXTO_AT}", $dato->texto_at, $template);
            $template = str_replace("{ID_BITACORA_ENCODEADA}", Encodear3($dato->id), $template);
            $template = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($evaluado), $template);
        }
    } else {
        $template = file_get_contents("views/sgd/bitacora/sin_objetivos.html");
    }
    return ($template);
}
function ListadoColaboradoresBitacora($html, $evaluador, $rut_evaluado, $id_bitacora, $sgd_version, $id_proceso)
{
    //$evaluados=EvaluadosDadoEvaluador($evaluador);
    //$evaluados=EvaluadosDadoEvaluadorParaBitacora($evaluador);
    $evaluados = EvaluadosDadoEvaluadorParaBitacoraPorProceso($evaluador, $id_proceso);
    //Se muestran los objetivos individuales.
    //if($_SESSION["id_empresa"]==28){
    if ($sgd_version == 2) {
        $total_html   = file_get_contents("views/sgd/bitacora/entorno_bloque_principal_chilquinta.html");
        $row_template = file_get_contents("views/sgd/bitacora/row_colaboradores_chilquinta.html");
        //$row_template=file_get_contents("views/sgd/bitacora/row_colaboradores.html");
    } else {
        $total_html   = file_get_contents("views/sgd/bitacora/entorno_bloque_principal.html");
        $row_template = file_get_contents("views/sgd/bitacora/row_colaboradores.html");
    }
    //Primero veo si es que hay registro en la tabla de sesion
    $row                           = "";
    $ok_finalizado                 = 0;
    $html                          = str_replace("{SECCION_EQUIPO_CONSOLIDADO}", file_get_contents("views/sgd/bitacora/vista_consolidada_equipo.html"), $html);
    $html                          = str_replace("{GRAFICO}", file_get_contents("views/sgd/graficos/graficoBarraBitacora.html"), $html);
    $total_positivas_por_evaluador = 0;
    $total_negativas_por_evaluador = 0;
    foreach ($evaluados as $evaluado) {
        $row .= $row_template;
        $objetivos_validados_por_validador = VerificaSiObjetivosEstanValidados($evaluado->evaluado);
        //$row=FormularioIngresaObjetivos($row, $evaluado->evaluado, $evaluador);
        $row                               = ColocaDatosUsuario($row, $evaluado->evaluado, "bitacora");
        //$valores_objetivos=ListadoObjetivosAValidar($evaluado->evaluado, $evaluador, $id_objetivo, "jefe");
        $valores_objetivos                 = ListadoIngresoBitacoras($evaluado->evaluado, $evaluador, $id_bitacora, "jefe", $sgd_version);
        $row                               = str_replace("{LISTADO_OBJETIVOS_A_EVALUAR}", $valores_objetivos, $row);
        $ponderaciones_bases               = DevuelvePonderacionesPorEvaluado($evaluado->evaluado);
        $verifica_evaluado_validado        = VerificaSiObjetivosEstanAjustados($evaluado->evaluado);
        if ($rut_evaluado == $evaluado->evaluado && !$id_bitacora) {
            if ($sgd_version == 2) {
                $row = str_replace("{FORMUARIO_BITACORA}", file_get_contents("views/sgd/bitacora/formulario_chilquinta.html"), $row);
                $row = str_replace("{OPTIONS_VALORES}", OptionsCompetenciasDadoPerfil($evaluado->perfil_evaluacion_competencias), $row);
            } else {
                $row = str_replace("{FORMUARIO_BITACORA}", file_get_contents("views/sgd/bitacora/formulario.html"), $row);
                $row = str_replace("{OPTIONS_VALORES}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_bitacora_valores", "", "valor", "id", "order by valor asc", $_SESSION["id_empresa"]), $row);
            }
        } else {
            $row = str_replace("{FORMUARIO_BITACORA}", "", $row);
        }
        $row                           = str_replace("{RUT_ENCODEADO}", Encodear3($evaluado->evaluado), $row);
        $row                           = str_replace("{RUT_EVALUADO}", ($evaluado->evaluado), $row);
        //Veo cuantas posotivas y cuantas negativas tiene
        $positivas                     = VerificaBitacorasPositivasNegativas($evaluado->evaluado, "si");
        $negativas                     = VerificaBitacorasPositivasNegativas($evaluado->evaluado, "no");
        $row                           = str_replace("{X_POSITIVAS}", count($positivas), $row);
        $row                           = str_replace("{X_NEGATIVAS}", count($negativas), $row);
        $total_positivas_por_evaluador = $total_positivas_por_evaluador + count($positivas);
        $total_negativas_por_evaluador = $total_negativas_por_evaluador + count($negativas);
        $row                           = str_replace("{CANTIDAD}", count($positivas) + count($negativas), $row);
        $row                           = str_replace("{BOTON_JEFE_VALIDA_OBJETIVOS}", "", $row);
        $row                           = str_replace("{TOTAL_SUMA_PONDERACION}", $valores_objetivos[1], $row);
        $row                           = str_replace("{PONDERACION_OBJETIVOS_INDIVIDUALES}", $ponderaciones_bases[2], $row);
        if ($valores_objetivos[1] == $ponderaciones_bases[2]) {
            $row = str_replace("{OK}", "OK", $row);
        } else {
            $row = str_replace("{OK}", "", $row);
        }
        $row = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($evaluado->evaluado), $row);
        if ($valores_objetivos[1] == $ponderaciones_bases[2]) {
            $ok_finalizado++;
        }
        //ACA veo si es que tiene comentarios de rechazo
        $comentarios           = ObtenerObjetivosDeRechazoUltimo($evaluado->evaluado);
        $comentarios_validador = "";
        foreach ($comentarios as $com) {
            $comentarios_validador .= $com->comentario . "<br>";
        }
        $row = str_replace("{COMENTARIOS_VALIDADOR}", $comentarios_validador, $row);
    }
    $total_total = ($total_negativas_por_evaluador + $total_positivas_por_evaluador);
    $html        = str_replace("{TOTAL_POSITIVAS}", ColocaDecimalesNotasFinales(0, ($total_positivas_por_evaluador * 100) / $total_total), $html);
    $html        = str_replace("{TOTAL_NEGATIVAS}", ColocaDecimalesNotasFinales(0, ($total_negativas_por_evaluador * 100) / $total_total), $html);
    $html        = str_replace("{TOTAL_POR_EVALUADOR}", $total_total, $html);
    $html        = str_replace("{TOTAL_EVALUADOR_POSITIVAS}", ($total_positivas_por_evaluador), $html);
    $html        = str_replace("{TOTAL_EVALUADOR_NEGATIVAS}", ($total_negativas_por_evaluador), $html);
    $total_html  = str_replace("{LISTADO_COLABORADORES}", ($row), $total_html);
    $html        = str_replace("{ENTORNO_LISTADO_EVALUACION}", ($total_html), $html);
    return ($html);
}
function ColocaBloqueMP3PorObjeto($id_objeto)
{
    //Veo si hay MP3 por Objeto
    $datos_objeto = DatosObjeto($id_objeto);
    $bloque_mp3   = "";
    if ($datos_objeto[0]->mp3) {
        $bloque_mp3 = file_get_contents("views/cursos/contenidos/entorno_bloque_mp3.html");
        $bloque_mp3 = str_replace("{URL_MP3}", $datos_objeto[0]->mp3, $bloque_mp3);
    }
    return ($bloque_mp3);
}
function MuestraResultadosPreguntaPorObjetoCheck($id_objeto, $id_pregunta, $rut)
{
    $entorno .= file_get_contents("views/cursos/contenidos/entorno_preguntas_respuesta_lectura.html");
    //TRaigo todas las posibles respuestas por cada una de las preguntas
    $alternativas     = AlternativasDadoGupoIdPregunta($id_pregunta);
    $datos_pregunta   = DatosPreguntaObjetoDadoId($id_pregunta);
    //Traigo el total de respuestas dado el id de la pregunta, y el id del objeto
    $total_respuestas = ObtenerRespuestasPreguntaPorObjetoPRegunta($id_objeto, $id_pregunta);
    $contador_arreglo = 0;
    foreach ($alternativas as $unico) {
        //$template.=file_get_contents("views/cursos/contenidos/row_bloque_pregunta_respuesta_lectura.html");
        //$template = str_replace("{ALTERNATIVA}",$unico->alternativa,$template);
        //Por cada alternativa y pregunta, veo cuantas respuestas hay...
        $cantt_respuestas                                       = ObtenerRespuestasPreguntaPorObjetoYTipo($id_objeto, $id_pregunta, $unico->id);
        //$template = str_replace("{PORCENTAJE}",FormatearPorcentajesSinDecimal(($cantt_respuestas[0]->total*100)/$total_respuestas[0]->total),$template);
        $arreglo_alternativas[$contador_arreglo]["alternativa"] = $unico->alternativa;
        $arreglo_alternativas[$contador_arreglo]["valor"]       = FormatearPorcentajesSinDecimal(($cantt_respuestas[0]->total * 100) / $total_respuestas[0]->total);
        $contador_arreglo++;
    }
    foreach ($arreglo_alternativas as $key => $row) {
        $aux[$key] = $row['valor'];
    }
    array_multisort($aux, SORT_DESC, $arreglo_alternativas);
    for ($i = 0; $i < count($arreglo_alternativas); $i++) {
        $template .= file_get_contents("views/cursos/contenidos/row_bloque_pregunta_respuesta_lectura.html");
        $template = str_replace("{ALTERNATIVA}", $arreglo_alternativas[$i]["alternativa"], $template);
        $template = str_replace("{PORCENTAJE}", $arreglo_alternativas[$i]["valor"], $template);
    }
    $entorno = str_replace("{LISTADO_RESPUESTAS_ALTERNATIVAS}", $template, $entorno);
    $entorno = str_replace("{PREGUNTA}", utf8_encode($datos_pregunta[0]->pregunta), $entorno);
    return ($entorno);
}
function MuestraResultadosPreguntaPorObjeto($id_objeto, $id_pregunta, $rut)
{
    $template                    = file_get_contents("views/cursos/contenidos/entorno_bloque_pregunta_respuesta.html");
    $datos_pregunta              = DatosPreguntaObjetoDadoId($id_pregunta);
    $template                    = str_replace("{PREGUNTA}", utf8_encode($datos_pregunta[0]->pregunta), $template);
    //Obtengo datos
    $alternativa1                = ObtenerRespuestasPreguntaPorObjetoYTipo($id_objeto, $id_pregunta, 1);
    $alternativa2                = ObtenerRespuestasPreguntaPorObjetoYTipo($id_objeto, $id_pregunta, 2);
    $alternativa3                = ObtenerRespuestasPreguntaPorObjetoYTipo($id_objeto, $id_pregunta, 3);
    $total                       = $alternativa1[0]->total + $alternativa2[0]->total + $alternativa3[0]->total;
    $arreglo[0]["color"]         = "sessions_red.png";
    $arreglo[0]["nota"]          = FormatearPorcentajesSinDecimal(($alternativa1[0]->total * 100) / $total);
    $arreglo[0]["color_grafico"] = "danger";
    $arreglo[1]["color"]         = "sessions_yellow.png";
    $arreglo[1]["nota"]          = FormatearPorcentajesSinDecimal(($alternativa2[0]->total * 100) / $total);
    $arreglo[1]["color_grafico"] = "yellow";
    $arreglo[2]["color"]         = "sessions_green.png";
    $arreglo[2]["nota"]          = FormatearPorcentajesSinDecimal(($alternativa3[0]->total * 100) / $total);
    $arreglo[2]["color_grafico"] = "success";
    foreach ($arreglo as $key => $row) {
        $aux[$key] = $row['nota'];
    }
    array_multisort($aux, SORT_DESC, $arreglo);
    for ($i = 0; $i < 3; $i++) {
        $alternativas_rows .= file_get_contents("views/cursos/contenidos/row_respuesta_pregunta1.html");
        $alternativas_rows = str_replace("{IMAGEN}", $arreglo[$i]["color"], $alternativas_rows);
        $alternativas_rows = str_replace("{NOTA}", $arreglo[$i]["nota"], $alternativas_rows);
        $alternativas_rows = str_replace("{COLOR_GRAFICO}", $arreglo[$i]["color_grafico"], $alternativas_rows);
    }
    $template = str_replace("{RESPUESTAS_PREGUNTA1}", $alternativas_rows, $template);
    //$template = str_replace("{NOTAAMARILLO}",FormatearPorcentajesSinDecimal(($alternativa2[0]->total*100)/$total),$template);
    //$template = str_replace("{NOTAVERDE}",FormatearPorcentajesSinDecimal(($alternativa3[0]->total*100)/$total),$template);
    return ($template);
}
function MuestraResultadosPreguntaPorObjeto4($id_objeto, $id_pregunta, $rut)
{
    $template                    = file_get_contents("views/cursos/contenidos/entorno_bloque_pregunta_respuesta4.html");
    //$datos_pregunta=PreguntaEncuestaParaTNT();
    $datos_pregunta              = PreguntaEncuestaParaPorEmpresa($_SESSION["id_empresa"]);
    $template                    = str_replace("{PREGUNTA}", utf8_encode($datos_pregunta[0]->pregunta), $template);
    //Obtengo datos
    $alternativa1                = ObtenerRespuestasPreguntaPorObjetoYTipo(0, $id_pregunta, 1);
    $alternativa2                = ObtenerRespuestasPreguntaPorObjetoYTipo(0, $id_pregunta, 2);
    $alternativa3                = ObtenerRespuestasPreguntaPorObjetoYTipo(0, $id_pregunta, 3);
    $alternativa4                = ObtenerRespuestasPreguntaPorObjetoYTipo(0, $id_pregunta, 4);
    $total                       = $alternativa1[0]->total + $alternativa2[0]->total + $alternativa3[0]->total + $alternativa4[0]->total;
    $arreglo[0]["color"]         = "Seguridad";
    $arreglo[0]["nota"]          = FormatearPorcentajesSinDecimal(($alternativa1[0]->total * 100) / $total);
    $arreglo[0]["color_grafico"] = "danger";
    $arreglo[1]["color"]         = "Salud";
    $arreglo[1]["nota"]          = FormatearPorcentajesSinDecimal(($alternativa2[0]->total * 100) / $total);
    $arreglo[1]["color_grafico"] = "yellow";
    $arreglo[2]["color"]         = "Recreacion";
    $arreglo[2]["nota"]          = FormatearPorcentajesSinDecimal(($alternativa3[0]->total * 100) / $total);
    $arreglo[2]["color_grafico"] = "success";
    $arreglo[3]["color"]         = "Financieros";
    $arreglo[3]["nota"]          = FormatearPorcentajesSinDecimal(($alternativa4[0]->total * 100) / $total);
    $arreglo[3]["color_grafico"] = "success";
    foreach ($arreglo as $key => $row) {
        $aux[$key] = $row['nota'];
    }
    array_multisort($aux, SORT_DESC, $arreglo);
    for ($i = 0; $i < 4; $i++) {
        //$alternativas_rows.=file_get_contents("views/cursos/contenidos/row_respuesta_pregunta".$datos_pregunta[0]->numero_template_pregunta.".html");
        $alternativas_rows .= file_get_contents("views/cursos/contenidos/row_respuesta_pregunta" . $datos_pregunta[0]->numero_template_pregunta . ".html");
        $alternativas_rows = str_replace("{ALTERNATIVA}", $arreglo[$i]["color"], $alternativas_rows);
        $alternativas_rows = str_replace("{NOTA}", $arreglo[$i]["nota"], $alternativas_rows);
        $alternativas_rows = str_replace("{COLOR_GRAFICO}", $arreglo[$i]["color_grafico"], $alternativas_rows);
    }
    $template = str_replace("{RESPUESTAS_PREGUNTA1}", $alternativas_rows, $template);
    //$template = str_replace("{NOTAAMARILLO}",FormatearPorcentajesSinDecimal(($alternativa2[0]->total*100)/$total),$template);
    //$template = str_replace("{NOTAVERDE}",FormatearPorcentajesSinDecimal(($alternativa3[0]->total*100)/$total),$template);
    return ($template);
}
function FormatearPorcentajesSinDecimal($valor)
{
    $valor = number_format($valor, 0, ",", ".");
    return ($valor);
}
function FormatearPorcentajes1Decimal($valor)
{
    $valor = number_format($valor, 1, ",", ".");
    return ($valor);
}
function ColocaBloquePreguntaPorObjeto($id_objeto, $rut, $tipo)
{
    //Veo si hay documentos por Objeto
    if ($_SESSION["id_empresa"] == 22) {
        //$pregunta=PreguntaEncuestaParaTNT();
        //$pregunta=PreguntaEncuestaParaPorEmpresa($_SESSION["id_empresa"]);
        //$tipo=$pregunta[0]->numero_template_pregunta;
        //$pregunta=PreguntaDadoIdObjeto(999, 2);
        $pregunta = PreguntaEncuestaParaPorEmpresa($_SESSION["id_empresa"]);
        $tipo     = $pregunta[0]->tipo;
    } else if ($_SESSION["id_empresa"] == 41) {
        //$pregunta=PreguntaEncuestaParaTNT();
        $pregunta = PreguntaEncuestaParaPorEmpresa($_SESSION["id_empresa"]);
        $tipo     = $pregunta[0]->numero_template_pregunta;
    } else {
        $pregunta = PreguntaDadoIdObjeto($id_objeto, $tipo);
        $tipo     = $pregunta[0]->tipo;
    }
    $bloque_archivos = "";
    if ($pregunta) {
        $tiene_respuesta = VerificaRespuestaPorPreguntaObjetoUsuario($id_objeto, $pregunta[0]->id, $rut);
        //si tiene respuesta
        if ($tiene_respuesta) {
            if ($tipo == 1) {
                $bloque_archivos = MuestraResultadosPreguntaPorObjeto($id_objeto, $pregunta[0]->id, $rut);
            } else if ($tipo == 2) {
                $bloque_archivos = MuestraResultadosPreguntaPorObjetoCheck($id_objeto, $pregunta[0]->id, $rut);
            } else if ($tipo == 3) {
                $bloque_archivos = MuestraResultadosPreguntaPorObjetoCheck($id_objeto, $pregunta[0]->id, $rut);
                //}else if($tipo==4){
            } else {
                $bloque_archivos = MuestraResultadosPreguntaPorObjeto4($id_objeto, $pregunta[0]->id, $rut);
            }
        } else {
            $bloque_archivos = file_get_contents("views/cursos/contenidos/entorno_bloque_pregunta" . $tipo . ".html");
            $bloque_archivos = str_replace("{PREGUNTA}", utf8_encode($pregunta[0]->pregunta), $bloque_archivos);
            $bloque_archivos = str_replace("{ID_PREGUNTA_ENCODEADA}", utf8_encode($pregunta[0]->id), $bloque_archivos);
            if ($tipo == 2) {
                //Coloco las alternativas
                $alternativas = AlternativasDadoGupoId($pregunta[0]->id_alternativas);
                foreach ($alternativas as $alt) {
                    $alternativas_html .= file_get_contents("views/cursos/contenidos/row_alternativa_pregunta_objeto.html");
                    $alternativas_html = str_replace("{ALTERNATIVA}", $alt->alternativa, $alternativas_html);
                    $alternativas_html = str_replace("{VALUE_CHECK}", $alt->id, $alternativas_html);
                }
                $bloque_archivos = str_replace("{TOTAL_ALTERNATIVAS}", count($alternativas), $bloque_archivos);
            } else if ($tipo == 3) {
                //Coloco las alternativas
                $alternativas = AlternativasDadoGupoId($pregunta[0]->id_alternativas);
                foreach ($alternativas as $alt) {
                    $alternativas_html .= file_get_contents("views/cursos/contenidos/row_alternativa_pregunta_objeto_radio.html");
                    $alternativas_html = str_replace("{ALTERNATIVA}", $alt->alternativa, $alternativas_html);
                    $alternativas_html = str_replace("{VALUE_CHECK}", $alt->id, $alternativas_html);
                    $alternativas_html = str_replace("{NAME}", $pregunta[0]->id, $alternativas_html);
                }
                $bloque_archivos = str_replace("{TOTAL_ALTERNATIVAS}", count($alternativas), $bloque_archivos);
            }
            $bloque_archivos = str_replace("{OPCIONES}", $alternativas_html, $bloque_archivos);
        }
    }
    return ($bloque_archivos);
}
function ColocaBloqueDocumentosPorObjeto($id_objeto)
{
    //Veo si hay documentos por Objeto
    $archivos        = ArchivosDadoIdObjeto($id_objeto);
    $bloque_archivos = "";
    if ($archivos) {
        $bloque_archivos = file_get_contents("views/cursos/contenidos/entorno_bloque_documentos.html");
        foreach ($archivos as $unico) {
            $row .= file_get_contents("views/cursos/contenidos/bloque_documento.html");
            $row = str_replace("{TITULO}", $unico->titulo, $row);
            $row = str_replace("{DESCRIPCION}", utf8_encode($unico->descripcion), $row);
            $row = str_replace("{DOCUMENTO_DESCARGA}", $unico->archivo, $row);
        }
        $bloque_archivos = str_replace("{ROWS_MATERIAL_APOYO}", $row, $bloque_archivos);
    }
    return ($bloque_archivos);
    /*
    $bloques_texto=BloqueCitaPorObjeto($id_objeto);
    $html_bloque="";
    if($bloques_texto){
    $html_bloque=file_get_contents("views/cursos/contenidos/entorno_bloque_cita.html");
    foreach($bloques_texto as $unico){
    $row.=file_get_contents("views/cursos/contenidos/bloque_cita.html");
    $row = str_replace("{TEXTO}",$unico->texto,$row);
    }
    //$html_bloque = str_replace("{ROWS}",$row, $html_bloque);
    $html_bloque = str_replace("{ROWS_CITA}",$row,$html_bloque);
    }else{
    }
    return(utf8_encode($html_bloque));*/
}
function MobileDetectFunction()
{
}
function ColocaBloqueCitasPorObjeto($id_objeto)
{
    $bloques_texto = BloqueCitaPorObjeto($id_objeto);
    $html_bloque   = "";
    if ($bloques_texto) {
        $html_bloque = file_get_contents("views/cursos/contenidos/entorno_bloque_cita.html");
        foreach ($bloques_texto as $unico) {
            $row .= file_get_contents("views/cursos/contenidos/bloque_cita.html");
            $row = str_replace("{TEXTO}", $unico->texto, $row);
        }
        //$html_bloque = str_replace("{ROWS}",$row, $html_bloque);
        $html_bloque = str_replace("{ROWS_CITA}", $row, $html_bloque);
    } else {
    }
    return (utf8_encode($html_bloque));
}
function ColocaBloqueTextosPorObjeto($id_objeto)
{
    $bloques_texto = BloqueTextoPorObjeto($id_objeto);
    $html_bloque   = "";
    if ($bloques_texto) {
        $html_bloque = file_get_contents("views/cursos/contenidos/entorno_bloque_texto.html");
        foreach ($bloques_texto as $unico) {
            $row .= file_get_contents("views/cursos/contenidos/bloque_texto.html");
            $row = str_replace("{TEXTO}", $unico->texto, $row);
        }
        //$html_bloque = str_replace("{ROWS}",$row, $html_bloque);
        $html_bloque = str_replace("{ROWS}", $row, $html_bloque);
    } else {
    }
    return (utf8_encode($html_bloque));
}
function colocarReconocimientosPorRut($PRINCIPAL, $id_empresa, $rut)
{
    $listado_reconocimientos = TotalReconocimientosPorRut($rut, $id_empresa);
    if ($listado_reconocimientos) {
        $PRINCIPAL = str_replace("{BLOQUE_RECONOCIMIENTOS}", file_get_contents("views/miperfil/bloque_mis_reconocimientos.html"), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BLOQUE_RECONOCIMIENTOS}", "", $PRINCIPAL);
    }
    foreach ($listado_reconocimientos as $unico) {
        $row .= file_get_contents("views/salondelafama/row_bloquesalonfama2.html");
        $row   = str_replace("{NOMBRE_CATEGORIA}", $unico->nombre_categoria, $row);
        $row   = str_replace("{LOGO_CATEGORIA}", $unico->imagen, $row);
        $row   = str_replace("{DESCRIPCION_CATEGORIA}", $unico->descripcion_categoria, $row);
        //Por la categoria traigo la cantidad X de ganadores
        $datos = ObtenerSalonPorCategoriaYEmpresa($id_empresa, $unico->id, 1);
        $row   = str_replace("{NOMBRE_PERSONAS}", $datos[0]->nombre_persona . " " . $datos[0]->apaterno . " " . $datos[0]->amaterno, $row);
        $row   = str_replace("{CARGO_PERSONAS}", $datos[0]->cargo, $row);
        $row   = str_replace("{URL_PERSONA}", VerificaFotoPersonal($datos[0]->rut), $row);
        $row   = str_replace("{RUT_ENCODEADO}", Encodear3($datos[0]->rut), $row);
        $row   = str_replace("{TEXTO1}", $datos[0]->texto1, $row);
        $row   = str_replace("{TEXTO2}", $datos[0]->texto2, $row);
        $row   = str_replace("{TEXTO3}", $datos[0]->texto3, $row);
        $row   = str_replace("{TEXTO4}", $datos[0]->texto4, $row);
        $row   = str_replace("{TEXTO5}", $datos[0]->texto5, $row);
    }
    $PRINCIPAL = str_replace("{LISTADO_RECONOCIMIENTOS}", utf8_encode($row), $PRINCIPAL);
    return ($PRINCIPAL);
}
function Noticias($PRINCIPAL, $tipo, $limit, $variable)
{
    if ($tipo == "1") {
        $template_row = file_get_contents("views/noticias/row_noticias_principales.html");
        if ($variable) {
            $noticias = TraeNoticiasPrincipalesPorGerencia($_SESSION["id_empresa"], $variable, $limit);
        } else {
            $noticias = TraeNoticiasPrincipales($_SESSION["id_empresa"], $variable, $limit);
        }
    } else if ($tipo == "sola") {
        $template_row = file_get_contents("views/noticias/row_noticias_1.html");
        $noticias     = TraeNoticiasSecundarias($_SESSION["id_empresa"], $limit);
    } else if ($tipo == "CATEGORIA_CONCURSO") {
        $template_row = file_get_contents("views/noticias/row_general_TREScolumnas.html");
        $noticias     = TraeNoticiasSecundariasCategoria($_SESSION["id_empresa"], $limit, 72);
    } else if ($tipo == "CATEGORIA_PRENSA") {
        $template_row = file_get_contents("views/noticias/row_general_TREScolumnas.html");
        $noticias     = TraeNoticiasSecundariasCategoria($_SESSION["id_empresa"], $limit, 71);
    } else if ($tipo == "2") {
        $template_row = file_get_contents("views/noticias/row_noticias_2.html");

        if($_SESSION["id_empresa"]==41){

            $noticias     = TraeNoticiasSecundariasSinConcurso($_SESSION["id_empresa"], $limit);
        }else{
            $noticias     = TraeNoticiasSecundarias($_SESSION["id_empresa"], $limit);
        }

    } else if ($tipo == "3") {
        $template_row = file_get_contents("views/noticias/row_noticias_terciarias.html");
        $noticias     = TraeNoticiasSecundarias($_SESSION["id_empresa"], $limit);
    } else if ($tipo == "4") {
        $template_row = file_get_contents("views/noticias/row_noticias_4.html");
        $noticias     = TraeNoticiasSecundarias($_SESSION["id_empresa"], $limit);
    } else if ($tipo == "53") {
        $template_row = file_get_contents("views/noticias/53_row_noticias_4.html");
        $noticias     = TraeNoticiasSecundarias($_SESSION["id_empresa"], $limit);
    } else if ($tipo == "5") {
        $template_row = file_get_contents("views/noticias/row_noticias_5.html");
        $noticias     = TraeNoticiasSecundarias($_SESSION["id_empresa"], $limit);
    } else if ($tipo == "6") {
        $template_row = file_get_contents("views/noticias/row_noticias_6.html");
        $noticias     = TraeNoticiasSecundarias($_SESSION["id_empresa"], $limit);
    } else if ($tipo == "7") {
        $template_row = file_get_contents("views/noticias/row_noticias_principales_7.html");
        if ($variable) {
            $noticias = TraeNoticiasPrincipalesPorGerencia($_SESSION["id_empresa"], $variable, $limit);
        } else {
            $noticias = TraeNoticiasPrincipales($_SESSION["id_empresa"], $variable, $limit);
        }
    } else if ($tipo == "8") {
        $template_row = file_get_contents("views/noticias/row_noticias_8.html");
        $noticias     = TraeNoticiasSecundarias($_SESSION["id_empresa"], $limit);
    } else if ($tipo == "9") {
        $template_row = file_get_contents("views/noticias/row_noticias_9.html");
        $noticias     = TraeNoticiasSecundarias($_SESSION["id_empresa"], $limit);
    } else if ($tipo == "principal_2columnas") {
        $template_row = file_get_contents("views/noticias/row_principal_DOScolumnas.html");
        $noticias     = TraeNoticiasSecundarias($_SESSION["id_empresa"], $limit);
    } else if ($tipo == "principal_DOScolumnas") {
        $template_row = file_get_contents("views/noticias/row_principal_DOScolumnas.html");
        $noticias     = TraeNoticiasPrincipales($_SESSION["id_empresa"], $limit);
    } else if ($tipo == "general_TREScolumnas") {
        $template_row = file_get_contents("views/noticias/row_general_TREScolumnas.html");
        $noticias     = TraeNoticiasSecundarias($_SESSION["id_empresa"], $limit);
    } else if ($tipo == "2columnas") {
        $template_row = file_get_contents("views/noticias/row_general_2columnas.html");
        $noticias     = TraeNoticiasSecundarias($_SESSION["id_empresa"], $limit);
    } else if ($tipo == "1columnabciprod") {
        $template_row = file_get_contents("views/noticias/row_1columnas_prod.html");
        $noticias     = TraeNoticiasSecundarias($_SESSION["id_empresa"], $limit);
    } else if ($tipo == "1columnasinhref") {
        $template_row = file_get_contents("views/noticias/row_1columnas_sinhref.html");
        $noticias     = TraeNoticiasSecundarias($_SESSION["id_empresa"], $limit);
    } else if ($tipo == "1columnasinhref_wide") {
        $template_row = file_get_contents("views/noticias/row_1columnas_sinhref_wide.html");
        $noticias     = TraeNoticiasSecundarias($_SESSION["id_empresa"], $limit);
    } else if ($tipo == "enFila") {
        $template_row = file_get_contents("views/noticias/row_enfila.html");
        $noticias     = TraeNoticiasSecundarias($_SESSION["id_empresa"], $limit);
    } else if ($tipo == "enFilaV2") {
        $template_row = file_get_contents("views/noticias/row_enfila_v2.html");
        $noticias     = TraeNoticiasSecundarias($_SESSION["id_empresa"], $limit);
    }
    //
    //print_r($noticias);
    foreach ($noticias as $not) {
        $row                 = $template_row;
        $TodoslosComentarios = TodosComentarios($not->id);
        //$row = str_replace("{PORTADA}",imagen_existe($not->portada),$row);
        if ($not->imagen_thumb) {
            $row = str_replace("{PORTADA}", "thum/" . $not->imagen_thumb, $row);
            $row = str_replace("{IMAGEN_NOTICIA}", "thum/" . $not->imagen_thumb, $row);
        } else {
            $row = str_replace("{PORTADA}", $not->portada, $row);
            $row = str_replace("{IMAGEN_NOTICIA}", $not->portada, $row);
        }
        $row         = str_replace("{TITULO}", $not->titulo, $row);
        $row         = str_replace("{FECHA}", FechaTipoSpa($not->fecha_creacion), $row);
        //$row = str_replace("{CONTENIDO_CORTO}",substr($not->contenido, 0, 100),$row);
        $row         = str_replace("{CONTENIDO_CORTO}", tokenTruncate($not->bajada, 245), $row);
        $row         = str_replace("{CONTENIDO_CORTO2}", tokenTruncate($not->bajada, 150), $row);
        $row         = str_replace("{ID_NOTICIA}", Encodear($not->id), $row);
        $row         = str_replace("{COMENTARIOS}", count($TodoslosComentarios), $row);
        $row         = str_replace("{CATEGORIA}", $not->nombre_categoria, $row);
        //datos autor
        $datos_autor = UsuarioEnBasePersonas($not->rut_creador);
        $row         = str_replace("{AUTOR}", $datos_autor[0]->nombre . " " . $datos_autor[0]->apaterno . " " . $datos_autor[0]->apaterno, $row);
        $total_html .= $row;
    }
    //echo $total_html;
    $PRINCIPAL = str_replace("{COLUMNAS_NOTICIAS_" . $tipo . "}", utf8_encode($total_html), $PRINCIPAL);
    return ($PRINCIPAL);
}
function ComunidadObjeto($PRINCIPAL, $tipo, $id_objeto, $limit, $num, $lectura, $volver, $sinboton, $textoboton)
{
    //echo "$tipo, $id_objeto, $limit, $num, $lectura, $volver, $sinboton, $textoboton";
    if ($tipo == "opinion") {
        $template_row  = file_get_contents("views/comunidad/row_opinion_comunidad.html");
        //echo "hola";
        $datos_objetos = traeLineasObjetov($_SESSION["id_empresa"], $tipo, $id_objeto, $limit);
        //echo "chau";
    } else if ($tipo == "foto") {
        $template_row  = file_get_contents("views/comunidad/row_opinion_comunidad.html");
        $datos_objetos = traeLineasObjetov($_SESSION["id_empresa"], $tipo, $id_objeto, $limit);
    } else if ($tipo == "compromiso") {
        $template_row  = file_get_contents("views/comunidad/row_compromiso_comunidad.html");
        $datos_objetos = traeLineasObjetov($_SESSION["id_empresa"], $tipo, $id_objeto, $limit);
    }
    $titulo_objeto = traetituloObjeto($_SESSION["id_empresa"], $id_objeto);
    foreach ($datos_objetos as $dato_objeto) {
        $row         = $template_row;
        $row         = str_replace("{COMENTARIO}", $dato_objeto->comentario, $row);
        $row         = str_replace("{COMPROMISO}", $dato_objeto->compromiso, $row);
        $row         = str_replace("{META}", $dato_objeto->meta, $row);
        $row         = str_replace("{PLAN}", $dato_objeto->plan, $row);
        $datos_autor = UsuarioEnBasePersonas($dato_objeto->rut);
        $row         = str_replace("{AUTOR}", $datos_autor[0]->nombre_completo, $row);
        //datos autor
        $row         = str_replace("{URL_PERSONA}", VerificaFotoPersonal($dato_objeto->rut), $row);
        $total_html .= $row;
    }
    //echo $total_html;
    $PRINCIPAL = str_replace("{LISTA_OBJETO" . $num . "}", utf8_encode($total_html), $PRINCIPAL);
    $PRINCIPAL = str_replace("{OBJETO" . $num . "}", utf8_encode($titulo_objeto[0]->titulo_principal), $PRINCIPAL);
    $PRINCIPAL = str_replace("{DESCOBJETO" . $num . "}", utf8_encode($titulo_objeto[0]->descripcion), $PRINCIPAL);
    if ($sinboton <> 1) {
        $PRINCIPAL = str_replace("{BOTON" . $num . "}", file_get_contents("views/comunidad/row_boton_ingresa.html"), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BOTON" . $num . "}", "", $PRINCIPAL);
    }
    if ($lectura == 1) {
        $PRINCIPAL = str_replace("{LINK_OBJETO}", "?sw=contenido&i=" . Encodear3($id_objeto) . "&tt=1&checkin=1", $PRINCIPAL);
        $PRINCIPAL = str_replace("{TEXTOBOTON}", utf8_encode($textoboton), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{LINK_OBJETO}", "?sw=contenido&i=" . Encodear3($id_objeto) . "&checkin=1", $PRINCIPAL);
        $PRINCIPAL = str_replace("{TEXTOBOTON}", utf8_encode($textoboton), $PRINCIPAL);
    }
    /*
    if($lectura==1){
    $PRINCIPAL = str_replace("{LINK_OBJETO".$num."}","?sw=contenido&i=".Encodear3($id_objeto)."&tt=1&checkin=1",$PRINCIPAL);
    } else {
    $PRINCIPAL = str_replace("{LINK_OBJETO".$num."}","?sw=contenido&i=".Encodear3($id_objeto)."&checkin=1",$PRINCIPAL);
    }
    */
    return ($PRINCIPAL);
}
function FaqObjeto($PRINCIPAL, $rut, $id_empresa)
{
    $datos_mallapersona = buscamalla($rut, $id_empresa);
    //print_r($datos_mallapersona);
    $id_malla           = $datos_mallapersona[0]->id_malla;
    $template_row       = file_get_contents("views/faq/" . $id_empresa . "_row_faq.html");
    $datos_objetos      = traeLineasFaqs($id_empresa, $id_malla);
    //print_r($datos_objetos);
    foreach ($datos_objetos as $dato_objeto) {
        $row = $template_row;
        //$TodoslosComentarios=TodosComentarios($not->id);
        //$row = str_replace("{PORTADA}",imagen_existe($not->portada),$row);
        $row = str_replace("{NOMBREFAQ}", ($dato_objeto->faq_nombre), $row);
        $row = str_replace("{CONTENIDOFAQ}", ($dato_objeto->faq_contenido), $row);
        //datos autor
        $row = str_replace("{CATEGORIAFAQ}", utf8_decode($dato_objeto->categoria), $row);
        $row = str_replace("{IDFAQ}", $dato_objeto->id, $row);
        $total_html .= $row;
    }
    //echo $total_html;
    $PRINCIPAL = str_replace("{LISTA_FAQS}", utf8_encode($total_html), $PRINCIPAL);
    return ($PRINCIPAL);
}
function devuelveNombreMes($numero_mes)
{
    if ($numero_mes == "1") {
        return ("Enero");
    } else if ($numero_mes == "2") {
        return ("Febrero");
    } else if ($numero_mes == "3") {
        return ("Marzo");
    } else if ($numero_mes == "4") {
        return ("Abril");
    } else if ($numero_mes == "5") {
        return ("Mayo");
    } else if ($numero_mes == "6") {
        return ("Junio");
    } else if ($numero_mes == "7") {
        return ("Julio");
    } else if ($numero_mes == "8") {
        return ("Agosto");
    } else if ($numero_mes == "9") {
        return ("Septiembre");
    } else if ($numero_mes == "10") {
        return ("Octubre");
    } else if ($numero_mes == "11") {
        return ("Noviembre");
    } else if ($numero_mes == "12") {
        return ("Diciembre");
    }
}
function colocaIndicadores($PRINCIPAL, $variable, $id_empresa)
{
    //Traigo los registros de la tabla
    $indicadores = TraeIndicadores($id_empresa, $variable);
    foreach ($indicadores as $unico) {
        $grafico .= file_get_contents("views/graficos/sgd/barraslinea.html");
        $grafico         = str_replace("{NOMBRE_GRAFICO}", "Grafico" . $unico->id, $grafico);
        $grafico         = str_replace("{TITULO}", $unico->nombre, $grafico);
        $grafico         = str_replace("{x}", $unico->mes, $grafico);
        $grafico         = str_replace("{y1}", $unico->y1, $grafico);
        $grafico         = str_replace("{y2}", $unico->y2, $grafico);
        $grafico         = str_replace("{y3}", $unico->y3, $grafico);
        //Ahora por cada indicador, traigo la data
        $datos_indicador = DataPorIndicador($unico->id);
        $html_datos      = "";
        $i               = 1;
        foreach ($datos_indicador as $datos_unico) {
            //print_r($datos_unico);echo "<br>";
            $html_datos .= "['" . $datos_unico->x . "', " . $datos_unico->y1 . ", " . $datos_unico->y2 . ", " . $datos_unico->y3 . "]";
            if ($i < count($datos_indicador))
                $html_datos .= ",";
            $i++;
        }
        //echo "<br><br>";
        $grafico = str_replace("{ARREGLO_DATOS}", $html_datos, $grafico);
    }
    $PRINCIPAL = str_replace("{LISTADO_GRAFICOS}", $grafico, $PRINCIPAL);
    return ($PRINCIPAL);
}
function EntornoEvaluacionListadoAlternativasDinamicas($html, $evaluador, $pagina, $id_empresa, $id_proceso, $evaluado_individual)
{
    if ($evaluado_individual) {
        $evaluados = EvaluadosDadoEvaluadorPorProcesoPorEvaluado($evaluador, $id_proceso, $evaluado_individual);
    } else {
        //$evaluados=EvaluadosDadoEvaluadorPorProceso($evaluador, $id_proceso);
        $evaluados = EvaluadosDadoEvaluadorPorProcesoSinAe($evaluador, $id_proceso);
    }
    $datos_proceso       = TraeProcesosDeEvaluacionPorEmpresaYDiProceso($id_empresa, $id_proceso);
    $id_proceso_anterior = $datos_proceso[0]->id_proceso_anterior;
    if ($evaluados) {
        if ($evaluado_individual) {
            $perfiles = TotalPerfilesDadoEvaluador1PorEvaluado($evaluador, $evaluado_individual, $id_proceso);
        } else {
            //$perfiles=TotalPerfilesDadoEvaluador1($evaluador);
            $perfiles = TotalPerfilesDadoEvaluador1PorProceso($evaluador, $id_proceso);
        }
        //Aca tengo todos los perfiles, con esto, obtengo todas las competencias.
        for ($i = 0; $i < count($perfiles); $i++) {
            $sql .= " perfil_evaluacion='" . $perfiles[$i]->id_perfil_ev . "'";
            if ($perfiles[$i + 1]->id_perfil_ev)
                $sql .= " or";
        }
        if ($evaluado_individual) {
            $componentes               = TotalIdCompetenciasIndividual($sql);
            //$entorno_eval_competencias=file_get_contents("views/sgd/evaluacion/entorno_individual_evaluacion_competencia.html");
            $entorno_eval_competencias = file_get_contents("views/sgd/evaluacion/" . $id_empresa . "_entorno_individual_evaluacion_competencia.html");
            if ($evaluado_individual == $evaluador) {
                $entorno_eval_competencias = str_replace("{TEXTO_COMENTARIO_POR_COMPETENCIA_INDIVIDUAL}", "Recuerda exponer situaciones concretas que validen tu autoevaluación. Será importante para tu Supervisor conocer tu percepción al evaluarte.", $entorno_eval_competencias);
            } else {
                $entorno_eval_competencias = str_replace("{TEXTO_COMENTARIO_POR_COMPETENCIA_INDIVIDUAL}", "Recuerda que es importante retroalimentar a tu equipo! Tus observaciones pueden hacer la diferencia sobre cómo se percibe el proceso de evaluación. Recuerda ser lo más objetivo posible y relatar experiencias concretas!", $entorno_eval_competencias);
            }
            $entorno_eval_competencias = ColocaDatosUsuario($entorno_eval_competencias, $evaluado_individual);
            $verifico_eval_finalizada  = FinalizadoEvaluadoEvaluadorProProceso($evaluado_individual, $evaluador, $id_proceso);
            if ($verifico_eval_finalizada) {
                $html = str_replace("{VER_INFORME_INDIVIDUAL}", file_get_contents("views/sgd/evaluacion/boton_ver_informe.html"), $html);
                $html = str_replace("{ID_PROCESO_ENCODEADO}", Encodear3($id_proceso), $html);
                $html = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($evaluado_individual), $html);
            } else {
                $html = str_replace("{VER_INFORME_INDIVIDUAL}", "", $html);
            }
            if ($pagina > 1) {
                $entorno_eval_competencias = str_replace("{BOTON_ATRAS}", file_get_contents("views/sgd/evaluacion/boton_atras_eval_competencias.html"), $entorno_eval_competencias);
                if ($evaluado_individual == $evaluador) {
                    $entorno_eval_competencias = str_replace("{VISTA_AE}", "&ae=1", $entorno_eval_competencias);
                } else {
                    $entorno_eval_competencias = str_replace("{VISTA_AE}", "", $entorno_eval_competencias);
                }
                $total_html = str_replace("{BOTON_ATRAS}", file_get_contents("views/sgd/evaluacion/boton_atras_eval_competencias.html"), $total_html);
            } else {
                $entorno_eval_competencias = str_replace("{BOTON_ATRAS}", "", $entorno_eval_competencias);
                $total_html                = str_replace("{BOTON_ATRAS}", "", $total_html);
                $entorno_eval_competencias = str_replace("{VISTA_AE}", "", $entorno_eval_competencias);
            }
        } else {
            $componentes               = TotalIdCompetencias($sql);
            $total_html                = file_get_contents("views/sgd/evaluacion/" . $id_empresa . "_entorno_equipo_evaluacion_competencia.html");
            $entorno_eval_competencias = file_get_contents("views/sgd/evaluacion/" . $id_empresa . "_entorno_equipo_evaluacion_competencia.html");
            $html                      = str_replace("{VER_INFORME_INDIVIDUAL}", "", $html);
            if ($pagina > 1) {
                $entorno_eval_competencias = str_replace("{BOTON_ATRAS}", file_get_contents("views/sgd/evaluacion/boton_atras_eval_competencias.html"), $entorno_eval_competencias);
                $total_html                = str_replace("{BOTON_ATRAS}", file_get_contents("views/sgd/evaluacion/boton_atras_eval_competencias.html"), $total_html);
            } else {
                $entorno_eval_competencias = str_replace("{BOTON_ATRAS}", "", $entorno_eval_competencias);
                $total_html                = str_replace("{BOTON_ATRAS}", "", $total_html);
            }
        }
        if ($datos_proceso[0]->tiene_especificos == 1) {
            /****************************/
            /******************************/
            /********PARA CUANDO TIENE OBJETIVOS*/
            if ($pagina > 1) {
                /****************************/
                /******************************/
                /********PARA CUANDO NO TIENE OBJETIVOS*/
                /****************************************************************/
                //BLOQUE QUE VALIDA LA CANTIDAD DE RESPUESTAS POR PAGINA JAVASCRIPT
                /****************************************************************/
                //$total_html=file_get_contents("views/sgd/evaluacion/entorno_equipo_evaluacion_competencia.html");
                $total_html = $entorno_eval_competencias;
                if ($datos_proceso[0]->validacion_js_preguntas == 1) {
                    $total_html = str_replace("{BLOQUE_FUNCION_JAVASCRIPT_PARA_VALIDAR_CANTIDAD_ALTERNATIVAS}", file_get_contents("views/sgd/evaluacion/funcionValidaCantidadRespuestas.html"), $total_html);
                } else {
                    $total_html = str_replace("{BLOQUE_FUNCION_JAVASCRIPT_PARA_VALIDAR_CANTIDAD_ALTERNATIVAS}", file_get_contents("views/sgd/evaluacion/funcionNext.html"), $total_html);
                }
                //$total_html = str_replace("{TOTAL_EVALUADOS}",(count($evaluados)*60)/100,$total_html);
                //$total_html = str_replace("{TOTAL_TOTAL_EVALUADOS}",count($evaluados),$total_html);
                //$total_html = str_replace("{TOTAL_EVALUADOS_1_2}",(count($evaluados)*40)/100,$total_html);
                //$total_html = str_replace("{TOTAL_EVALUADOS_4_5}",(count($evaluados)*40)/100,$total_html);
                //Se muestran las competencias para evaluar.
                //echo "pagina $pagina <br>";
                //print_r($componentes);exit;
                //Aca verifico si la pagina actual es mayor a la cantidad de paginas//si es asi, lo tiro para afuera, e inserto registro de finalizado.
                if ($pagina > count($componentes) + 1) {
                    InsertaEvaluadorFinalizado($evaluador, $id_proceso);
                    //Aca ,por cada uno de los evaluados del evaluador, se inserta registro de finalizado evaluado evaluador
                    foreach ($evaluados as $evaluad) {
                        InsertaEvaluadoEvaluadorFinalizado($evaluad->evaluado, $evaluador, $id_proceso);
                    }
                    echo "<script>
                    location.href='?sw=sgd2&ip=" . Encodear3($id_proceso) . "';
                    </script>";
                    exit;
                }
                /////////////////*********************************/////////////////////////////
                //SECCION PARA ENCABEZADOS COMPETENCIAS
                //if($componentes[$pagina-1]->muestra_competencia==1){
                if ($componentes[$pagina - 2]->muestra_competencia == 1) {
                    $total_html = str_replace("{ENCABEZADO_COMPETENCIA}", file_get_contents("views/sgd/evaluacion/encabezado_competencia.html"), $total_html);
                    $total_html = str_replace("{COMPETENCIA}", utf8_encode($componentes[$pagina - 2]->nombre), $total_html);
                    $total_html = str_replace("{DESCRIPCION_COMPETENCIA}", utf8_encode($componentes[$pagina - 2]->descripcion_competencia), $total_html);
                } else {
                    $total_html = str_replace("{ENCABEZADO_COMPETENCIA}", "", $total_html);
                }
                /////////////////*********************************/////////////////////////////
                //SECCION PARA ENCABEZADO DIMENSIONES
                if ($componentes[$pagina - 2]->muestra_dimension == 1) {
                    $total_html = str_replace("{ENCABEZADO_DIMENSION}", file_get_contents("views/sgd/evaluacion/encabezado_dimension.html"), $total_html);
                    $total_html = str_replace("{DIMENSION}", utf8_encode($componentes[$pagina - 2]->nombre_dimension), $total_html);
                } else {
                    $total_html = str_replace("{ENCABEZADO_COMPETENCIA}", "", $total_html);
                    $total_html = str_replace("{ENCABEZADO_DIMENSION}", "", $total_html);
                }
                if ($componentes[$pagina - 2]->comentario_obligatorio == 1) {
                    $comentario_obligatorio = "required";
                } else {
                    $comentario_obligatorio = "";
                }
                $total_html                 = str_replace("{ID_ENCODEADO_COMPETENCIA}", $componentes[$pagina - 2]->id_componente, $total_html);
                $total_html                 = str_replace("{ID_COMPETENCIA}", $componentes[$pagina - 2]->id_componente, $total_html);
                $comentario_por_competencia = TieneComentarioPorCompetencia($evaluado_individual, $evaluador, $componentes[$pagina - 2]->id_componente, $id_empresa, $id_proceso);
                $total_html                 = str_replace("{COMENTARIO_POR_COMPETENCIA}", utf8_encode($comentario_por_competencia[0]->comentario), $total_html);
                if ($evaluado_individual) {
                    //Traigo las preguntas por la competencia
                    $preguntas = PreguntasPorCompetencia($componentes[$pagina - 2]->id_componente);
                    foreach ($preguntas as $preg) {
                        // echo "evaluado $evaluado_individual, evaluador $evaluador, idproceso $id_proceso, idpregunta ".$preg->id."<br>";
                        //Aca veo si para esta pregunta, este evaluado para este evaluador tiene respuesta
                        $tiene_respuesta = TieneRespuestaCompetenciaProProceso($evaluado_individual, $evaluador, $preg->id, $id_proceso);
                        $listado_preguntas .= file_get_contents("views/sgd/evaluacion/" . $id_empresa . "_row_pregunta_por_competencia.html");
                        $listado_preguntas = str_replace("{NOMBRE_PREGUNTA}", $preg->pregunta, $listado_preguntas);
                        $alternativas      = AlternativasDadoIdGrupo($preg->id_alternativa);
                        $td_options        = "";
                        foreach ($alternativas as $alt) {
                            $td .= file_get_contents("views/sgd/evaluacion/alternativa_encabezado.html");
                            $td                = str_replace("{DESCRIPCION_ALTERNATIVA}", utf8_encode($alt->alternativa), $td);
                            //Por cada alternativa, verifico si tiene más de una opcion
                            $mas_de_una_opcion = MasDeUnaOpcionPorAlternativa($alt->puntaje, $id_empresa, $id_proceso);
                            if ($mas_de_una_opcion) {
                                $td_options .= file_get_contents("views/sgd/evaluacion/alternativa_options_dinamico.html");
                                $options = "";
                                foreach ($mas_de_una_opcion as $unico) {
                                    $options .= file_get_contents("views/sgd/evaluacion/options_dinamico.html");
                                    $options    = str_replace("{VALUE}", $unico->valor_puntaje, $options);
                                    $td_options = str_replace("{ETIQUETA}", $unico->titulo_opciones, $td_options);
                                    $options    = str_replace("{SIGNO}", $unico->signo, $options);
                                    $options    = str_replace("{CHECK}", "{SELECT" . $unico->valor_puntaje . "} ", $options);
                                }
                                $td_options = str_replace("{SELECT" . $tiene_respuesta[0]->puntaje . "}", "checked", $td_options);
                                $options    = str_replace("{SELECT" . $tiene_respuesta[0]->puntaje . "}", "checked", $options);
                                $td_options = str_replace("{OPTIONS_}", $options, $td_options);
                            } else {
                                $td_options .= file_get_contents("views/sgd/evaluacion/alternativa_options.html");
                                if ($tiene_respuesta[0]->puntaje == $alt->puntaje) {
                                    $td_options = str_replace("{CHECK}", "checked='checked'", $td_options);
                                } else {
                                    $td_options = str_replace("{CHECK}", "", $td_options);
                                }
                                $td_options = str_replace("{VALUE}", $alt->puntaje, $td_options);
                                $td_options = str_replace("{SIGNO}", $unico->signo, $td_options);
                                //$td_options = str_replace("{CHECK}","{SELECT".$alt->puntaje."} ",$td_options);
                            }
                        }
                        $listado_preguntas = str_replace("{NIVELES_TD}", $td_options, $listado_preguntas);
                        $listado_preguntas = str_replace("{NOMBRE_RADIO}", $evaluado_individual . "-" . $preg->id, $listado_preguntas);
                        $listado_preguntas = str_replace("{NOMBRE_RADIO_SOLO_PREGUNTA}", $preg->id, $listado_preguntas);
                        $total_html        = str_replace("{NIVELES_TD}", ($td), $total_html);
                    }
                    $listado_preguntas          = str_replace("{NOMBRE_PREGUNTA}", $preg->pregunta, $listado_preguntas);
                    $total_html                 = str_replace("{LISTADO_PREGUNTAS_A_EVALUAR_POR_COMPETENCIAS}", utf8_encode($listado_preguntas), $total_html);
                    $total_html                 = str_replace("{EVALUADO_ENCODEADO}", Encodear3($evaluado_individual), $total_html);
                    $total_html                 = str_replace("{TOTAL_PREGUNTAS_A_RESPONDER}", count($preguntas), $total_html);
                    $comentario_por_competencia = TieneComentarioPorCompetencia($evaluado_individual, $evaluador, $componentes[$pagina - 1]->id_componente, $id_empresa, $id_proceso);
                    $total_html                 = str_replace("{COMENTARIO_POR_COMPETENCIA}", utf8_encode($comentario_por_competencia[0]->comentario), $total_html);
                } else {
                    //REPLACE PARA LA PREGUNTA
                    $total_html = str_replace("{NOMBRE_PREGUNTA}", utf8_encode($componentes[$pagina - 2]->pregunta), $total_html);
                    if ($componentes[$pagina - 2]->descripcion) {
                        $total_html = str_replace("{TOOLTIP_DESCRIPCION}", file_get_contents("views/sgd/evaluacion/tooltip_descripcion.html"), $total_html);
                    } else {
                        $total_html = str_replace("{TOOLTIP_DESCRIPCION}", "", $total_html);
                    }
                    $total_html   = str_replace("{DESCRIPCION_PREGUNTA}", utf8_encode($componentes[$pagina - 2]->descripcion), $total_html);
                    $total_html   = str_replace("{ID_PREGUNTA_ENCODEADA}", $componentes[$pagina - 2]->id_pregunta, $total_html);
                    $alternativas = AlternativasDadoIdGrupo($componentes[$pagina - 2]->id_alternativa);
                    //Esta codicion es para ver si es que tiene o no comentariop
                    //Si tiene, se coloca el encabezado
                    if ($componentes[$pagina - 2]->tiene_comentarios == 1) {
                        $template_comentario_por_pregunta = file_get_contents("views/sgd/evaluacion/comentario_por_pregunta.html");
                        //Este es para colocar el width dinamico
                        $rowspan_tiene_comentario         = "rowspan='2'";
                    } else {
                        //$total_html = str_replace("{SECCION_ENCABEADO_COMENTARIO}","",$total_html);
                        $template_comentario_por_pregunta = "";
                        $rowspan_tiene_comentario         = "";
                    }
                    $width_dinamico_options = FormatearPorcentajesSinDecimal(100 / (count($alternativas)));
                    foreach ($alternativas as $alt) {
                        $td .= file_get_contents("views/sgd/evaluacion/alternativa_encabezado.html");
                        $td                = str_replace("{DESCRIPCION_ALTERNATIVA}", $alt->alternativa, $td);
                        //Por cada alternativa, verifico si tiene más de una opcion
                        $mas_de_una_opcion = MasDeUnaOpcionPorAlternativa($alt->puntaje, $id_empresa, $id_proceso);
                        if ($mas_de_una_opcion) {
                            //exit("b");
                            $td_options .= file_get_contents("views/sgd/evaluacion/alternativa_options_dinamico.html");
                            $options = "";
                            foreach ($mas_de_una_opcion as $unico) {
                                //exit("c");
                                $options .= file_get_contents("views/sgd/evaluacion/options_dinamico.html");
                                $options    = str_replace("{VALUE}", $unico->valor_puntaje, $options);
                                $td_options = str_replace("{ETIQUETA}", $unico->titulo_opciones, $td_options);
                                $options    = str_replace("{SIGNO}", $unico->signo, $options);
                                $options    = str_replace("{CHECK}", "{SELECT" . $unico->valor_puntaje . "} ", $options);
                            }
                            $td_options = str_replace("{OPTIONS_}", $options, $td_options);
                        } else {
                            $td_options .= file_get_contents("views/sgd/evaluacion/alternativa_options.html");
                            $td_options = str_replace("{VALUE}", $alt->puntaje, $td_options);
                            $td_options = str_replace("{DESCRIPCION_ANTERNATIVA_2}", $alt->alternativa, $td_options);
                            $td_options = str_replace("{SIGNO}", $unico->signo, $td_options);
                            $td_options = str_replace("{CHECK}", "{SELECT" . $alt->puntaje . "} ", $td_options);
                        }
                    }
                    $total_html = str_replace("{NIVELES_TD}", utf8_encode($td), $total_html);
                    $html       = FuncionParaObtenerCalculoMientrasAvanzaPagina($html, $evaluador, $id_proceso, $id_empresa);
                    $row        = BloqueListadoEvaluadosEvalCompetencias($evaluados, $evaluador, $componentes[$pagina - 2]->id_componente, $componentes[$pagina - 2]->id_pregunta, $id_proceso_anterior, $id_proceso, $comentario_obligatorio, $td_options, $template_comentario_por_pregunta);
                    $total_html = str_replace("{LISTADO_COLABORADORES}", ($row[0]), $total_html);
                    $total_html = str_replace("{TOTAL_EVALUADOS}", ($row[1] * 60) / 100, $total_html);
                    $total_html = str_replace("{TOTAL_EVALUADOS_1_2}", ($row[1] * 40) / 100, $total_html);
                    $total_html = str_replace("{TOTAL_EVALUADOS_4_5}", ($row[1] * 40) / 100, $total_html);
                    $total_html = str_replace("{TOTAL_TOTAL_EVALUADOS}", $row[1], $total_html);
                    $total_html = str_replace("{WIDTH_DINAMICO_OPCIONES}", ($width_dinamico_options), $total_html);
                }
                $html = str_replace("{PAGINACION_EVALUACION}", PaginacionSGDPorPreguntasV2($evaluador, $pagina, $id_proceso, count($componentes), "no", $evaluado_individual), $html);
                $html = str_replace("{BARRA_PROGESS}", file_get_contents("views/sgd/evaluacion/barra_progress.html"), $html);
                if ($evaluado_individual) {
                    $porcentaje_avance = AvanceDeEvaluados($evaluador, $id_proceso, "", "", $datos_proceso[0]->id_proceso_anual, $evaluado_individual, "");
                } else {
                    $porcentaje_avance = AvanceDeEvaluados($evaluador, $id_proceso, "", "", $datos_proceso[0]->id_proceso_anual, "", "");
                }
                $html = str_replace("{VALOR_AVANCE}", FormatearPorcentajesSinDecimal($porcentaje_avance[0]), $html);
            } else {
                //Se muestran los objetivos individuales.
                $total_html = file_get_contents("views/sgd/evaluacion/" . $id_empresa . "_entorno_equipo_evaluacion.html");
                if ($_GET["ae"] == 1) {
                    $total_html = str_replace("{SOLO_AE}", "&ae=1", $total_html);
                } else {
                    $total_html = str_replace("{SOLO_AE}", "", $total_html);
                }
                //Primero veo si es que hay registro en la tabla de sesion
                $row = "";
                foreach ($evaluados as $evaluado) {
                    if ($_SESSION["id_empresa"] == 11 or $_SESSION["id_empresa"] == 66 or $_SESSION["id_empresa"] == 74) {
                        $row .= file_get_contents("views/sgd/evaluacion/" . $id_empresa . "_row_colaboradores_evaluacion.html");
                        $row = ColocaDatosUsuario($row, $evaluado->evaluado);
                        $row = str_replace("{LISTADO_OBJETIVOS_A_EVALUAR}", ListadoObjetivosEvaluacion($evaluado->evaluado, $evaluador, $id_proceso, $id_empresa), $row);
                    } else {
                        $row .= file_get_contents("views/sgd/evaluacion/row_colaboradores_evaluacion_dinamico.html");
                        $row = ColocaDatosUsuario($row, $evaluado->evaluado);
                        //$bloque_objetivos_especificos=BloqueListadoObjetivoEspecificos($evaluado->evaluado, $evaluador, $id_proceso, $id_empresa);
                        //$row = str_replace("{LISTADO_OBJETIVOS_A_EVALUAR}",ListadoObjetivosEvaluacion($evaluado->evaluado, $evaluador, $id_proceso),$row);
                        $row = str_replace("{LISTADO_OBJETIVOS_A_EVALUAR}", utf8_encode(BloqueListadoObjetivoEspecificos($evaluado->evaluado, $evaluador, $id_proceso, $id_empresa, "no")), $row);
                    }
                }
                $total_html = str_replace("{LISTADO_COLABORADORES}", ($row), $total_html);
                $total_html = str_replace("{GRAFICO}", "", $total_html);
            }
            $html = str_replace("{PAGINACION_EVALUACION}", PaginacionSGDPorPreguntasV2($evaluador, $pagina, $id_proceso, count($componentes), "si", $evaluado_individual), $html);
        } else {
            /****************************/
            /******************************/
            /********PARA CUANDO NO TIENE OBJETIVOS*/
            /****************************************************************/
            //BLOQUE QUE VALIDA LA CANTIDAD DE RESPUESTAS POR PAGINA JAVASCRIPT
            /****************************************************************/
            //$total_html=file_get_contents("views/sgd/evaluacion/entorno_equipo_evaluacion_competencia.html");
            $total_html = $entorno_eval_competencias;
            if ($datos_proceso[0]->validacion_js_preguntas == 1) {
                $total_html = str_replace("{BLOQUE_FUNCION_JAVASCRIPT_PARA_VALIDAR_CANTIDAD_ALTERNATIVAS}", file_get_contents("views/sgd/evaluacion/funcionValidaCantidadRespuestas.html"), $total_html);
            } else {
                $total_html = str_replace("{BLOQUE_FUNCION_JAVASCRIPT_PARA_VALIDAR_CANTIDAD_ALTERNATIVAS}", file_get_contents("views/sgd/evaluacion/" . $id_empresa . "_funcionNext.html"), $total_html);
            }
            //$total_html = str_replace("{TOTAL_EVALUADOS}",(count($evaluados)*60)/100,$total_html);
            //$total_html = str_replace("{TOTAL_TOTAL_EVALUADOS}",count($evaluados),$total_html);
            //$total_html = str_replace("{TOTAL_EVALUADOS_1_2}",(count($evaluados)*40)/100,$total_html);
            //$total_html = str_replace("{TOTAL_EVALUADOS_4_5}",(count($evaluados)*40)/100,$total_html);
            //Se muestran las competencias para evaluar.
            //Aca verifico si la pagina actual es mayor a la cantidad de paginas//si es asi, lo tiro para afuera, e inserto registro de finalizado.
            if ($pagina > count($componentes)) {
                InsertaEvaluadorFinalizado($evaluador, $id_proceso);
                //Aca ,por cada uno de los evaluados del evaluador, se inserta registro de finalizado evaluado evaluador
                foreach ($evaluados as $evaluad) {
                    InsertaEvaluadoEvaluadorFinalizado($evaluad->evaluado, $evaluador, $id_proceso);
                }
                echo "<script>
                    location.href='?sw=sgd2&ip=" . Encodear3($id_proceso) . "';
                    </script>";
                exit;
            }
            /////////////////*********************************/////////////////////////////
            //SECCION PARA ENCABEZADOS COMPETENCIAS
            if ($componentes[$pagina - 1]->muestra_competencia == 1) {
                $total_html = str_replace("{ENCABEZADO_COMPETENCIA}", file_get_contents("views/sgd/evaluacion/" . $id_empresa . "_encabezado_competencia.html"), $total_html);
                $total_html = str_replace("{COMPETENCIA}", utf8_encode($componentes[$pagina - 1]->nombre), $total_html);
                if (utf8_encode($componentes[$pagina - 1]->imagen_competencia)) {
                    $total_html = str_replace("{IMAGEN_COMPETENCIA}", "<img src='img/" . utf8_encode($componentes[$pagina - 1]->imagen_competencia) . "' width=90>", $total_html);
                } else {
                    $total_html = str_replace("{IMAGEN_COMPETENCIA}", "", $total_html);
                }
                $total_html = str_replace("{DESCRIPCION_COMPETENCIA}", utf8_encode($componentes[$pagina - 1]->descripcion_competencia), $total_html);
            } else {
                $total_html = str_replace("{ENCABEZADO_COMPETENCIA}", "", $total_html);
            }
            /////////////////*********************************/////////////////////////////
            //SECCION PARA ENCABEZADO DIMENSIONES
            if ($componentes[$pagina - 1]->muestra_dimension == 1) {
                $total_html = str_replace("{ENCABEZADO_DIMENSION}", file_get_contents("views/sgd/evaluacion/encabezado_dimension.html"), $total_html);
                $total_html = str_replace("{DIMENSION}", utf8_encode($componentes[$pagina - 1]->nombre_dimension), $total_html);
            } else {
                $total_html = str_replace("{ENCABEZADO_COMPETENCIA}", "", $total_html);
                $total_html = str_replace("{ENCABEZADO_DIMENSION}", "", $total_html);
            }
            if ($componentes[$pagina - 1]->comentario_obligatorio == 1) {
                $comentario_obligatorio = "required";
            } else {
                $comentario_obligatorio = "";
            }
            $total_html                 = str_replace("{ID_ENCODEADO_COMPETENCIA}", $componentes[$pagina - 1]->id_componente, $total_html);
            $total_html                 = str_replace("{ID_COMPETENCIA}", $componentes[$pagina - 1]->id_componente, $total_html);
            $comentario_por_competencia = TieneComentarioPorCompetencia($evaluado_individual, $evaluador, $componentes[$pagina - 1]->id_componente, $id_empresa, $id_proceso);
            $total_html                 = str_replace("{COMENTARIO_POR_COMPETENCIA}", utf8_encode($comentario_por_competencia[0]->comentario), $total_html);
            if ($evaluado_individual) {
                //Traigo las preguntas por la competencia
                $preguntas = PreguntasPorCompetencia($componentes[$pagina - 1]->id_componente);
                foreach ($preguntas as $preg) {
                    // echo "evaluado $evaluado_individual, evaluador $evaluador, idproceso $id_proceso, idpregunta ".$preg->id."<br>";
                    //Aca veo si para esta pregunta, este evaluado para este evaluador tiene respuesta
                    $tiene_respuesta = TieneRespuestaCompetenciaProProceso($evaluado_individual, $evaluador, $preg->id, $id_proceso);
                    $listado_preguntas .= file_get_contents("views/sgd/evaluacion/" . $id_empresa . "_row_pregunta_por_competencia.html");
                    $listado_preguntas = str_replace("{NOMBRE_PREGUNTA}", $preg->pregunta, $listado_preguntas);
                    $alternativas      = AlternativasDadoIdGrupo($preg->id_alternativa);
                    $td_options        = "";
                    foreach ($alternativas as $alt) {
                        $td .= file_get_contents("views/sgd/evaluacion/alternativa_encabezado.html");
                        $td                = str_replace("{DESCRIPCION_ALTERNATIVA}", utf8_encode($alt->alternativa), $td);
                        //Por cada alternativa, verifico si tiene más de una opcion
                        $mas_de_una_opcion = MasDeUnaOpcionPorAlternativa($alt->puntaje, $id_empresa, $id_proceso);
                        if ($mas_de_una_opcion) {
                            $td_options .= file_get_contents("views/sgd/evaluacion/alternativa_options_dinamico.html");
                            $options = "";
                            foreach ($mas_de_una_opcion as $unico) {
                                $options .= file_get_contents("views/sgd/evaluacion/options_dinamico.html");
                                $options    = str_replace("{VALUE}", $unico->valor_puntaje, $options);
                                $td_options = str_replace("{ETIQUETA}", $unico->titulo_opciones, $td_options);
                                $options    = str_replace("{SIGNO}", $unico->signo, $options);
                                $options    = str_replace("{CHECK}", "{SELECT" . $unico->valor_puntaje . "} ", $options);
                            }
                            $td_options = str_replace("{OPTIONS_}", $options, $td_options);
                        } else {
                            $td_options .= file_get_contents("views/sgd/evaluacion/alternativa_options.html");
                            if ($tiene_respuesta[0]->puntaje == $alt->puntaje) {
                                $td_options = str_replace("{CHECK}", "checked='checked'", $td_options);
                            } else {
                                $td_options = str_replace("{CHECK}", "", $td_options);
                            }
                            $td_options = str_replace("{VALUE}", $alt->puntaje, $td_options);
                            $td_options = str_replace("{DESCRIPCION_ANTERNATIVA_2}", $alt->alternativa, $td_options);
                            $td_options = str_replace("{SIGNO}", $unico->signo, $td_options);
                            //$td_options = str_replace("{CHECK}","{SELECT".$alt->puntaje."} ",$td_options);
                        }
                    }
                    $listado_preguntas = str_replace("{NIVELES_TD}", $td_options, $listado_preguntas);
                    $listado_preguntas = str_replace("{NOMBRE_RADIO}", $evaluado_individual . "-" . $preg->id, $listado_preguntas);
                    $listado_preguntas = str_replace("{NOMBRE_RADIO_SOLO_PREGUNTA}", $preg->id, $listado_preguntas);
                    $total_html        = str_replace("{NIVELES_TD}", ($td), $total_html);
                }
                $listado_preguntas          = str_replace("{NOMBRE_PREGUNTA}", $preg->pregunta, $listado_preguntas);
                $total_html                 = str_replace("{LISTADO_PREGUNTAS_A_EVALUAR_POR_COMPETENCIAS}", utf8_encode($listado_preguntas), $total_html);
                $total_html                 = str_replace("{EVALUADO_ENCODEADO}", Encodear3($evaluado_individual), $total_html);
                $total_html                 = str_replace("{TOTAL_PREGUNTAS_A_RESPONDER}", count($preguntas), $total_html);
                $comentario_por_competencia = TieneComentarioPorCompetencia($evaluado_individual, $evaluador, $componentes[$pagina - 1]->id_componente, $id_empresa, $id_proceso);
                $total_html                 = str_replace("{COMENTARIO_POR_COMPETENCIA}", utf8_encode($comentario_por_competencia[0]->comentario), $total_html);
            } else {
                //REPLACE PARA LA PREGUNTA
                $total_html = str_replace("{NOMBRE_PREGUNTA}", utf8_encode($componentes[$pagina - 1]->pregunta), $total_html);
                if ($componentes[$pagina - 1]->descripcion) {
                    $total_html = str_replace("{TOOLTIP_DESCRIPCION}", file_get_contents("views/sgd/evaluacion/tooltip_descripcion.html"), $total_html);
                } else {
                    $total_html = str_replace("{TOOLTIP_DESCRIPCION}", "", $total_html);
                }
                $total_html   = str_replace("{DESCRIPCION_PREGUNTA}", utf8_encode($componentes[$pagina - 1]->descripcion), $total_html);
                $total_html   = str_replace("{ID_PREGUNTA_ENCODEADA}", $componentes[$pagina - 1]->id_pregunta, $total_html);
                $alternativas = AlternativasDadoIdGrupo($componentes[$pagina - 1]->id_alternativa);
                //Esta codicion es para ver si es que tiene o no comentariop
                //Si tiene, se coloca el encabezado
                if ($componentes[$pagina - 1]->tiene_comentarios == 1) {
                    $template_comentario_por_pregunta = file_get_contents("views/sgd/evaluacion/comentario_por_pregunta.html");
                    //Este es para colocar el width dinamico
                    $rowspan_tiene_comentario         = "rowspan='2'";
                } else {
                    //$total_html = str_replace("{SECCION_ENCABEADO_COMENTARIO}","",$total_html);
                    $template_comentario_por_pregunta = "";
                    $rowspan_tiene_comentario         = "";
                }
                $width_dinamico_options = FormatearPorcentajesSinDecimal(100 / (count($alternativas)));
                foreach ($alternativas as $alt) {
                    $td .= file_get_contents("views/sgd/evaluacion/alternativa_encabezado.html");
                    $td                = str_replace("{DESCRIPCION_ALTERNATIVA}", $alt->alternativa, $td);
                    //Por cada alternativa, verifico si tiene más de una opcion
                    $mas_de_una_opcion = MasDeUnaOpcionPorAlternativa($alt->puntaje, $id_empresa, $id_proceso);
                    if ($mas_de_una_opcion) {
                        $td_options .= file_get_contents("views/sgd/evaluacion/alternativa_options_dinamico.html");
                        $options = "";
                        foreach ($mas_de_una_opcion as $unico) {
                            $options .= file_get_contents("views/sgd/evaluacion/options_dinamico.html");
                            $options    = str_replace("{VALUE}", $unico->valor_puntaje, $options);
                            $td_options = str_replace("{ETIQUETA}", $unico->titulo_opciones, $td_options);
                            $options    = str_replace("{SIGNO}", $unico->signo, $options);
                            $options    = str_replace("{CHECK}", "{SELECT" . $unico->valor_puntaje . "} ", $options);
                        }
                        $td_options = str_replace("{OPTIONS_}", $options, $td_options);
                    } else {
                        $td_options .= file_get_contents("views/sgd/evaluacion/alternativa_options.html");
                        $td_options = str_replace("{VALUE}", $alt->puntaje, $td_options);
                        $td_options = str_replace("{SIGNO}", $unico->signo, $td_options);
                        $td_options = str_replace("{CHECK}", "{SELECT" . $alt->puntaje . "} ", $td_options);
                    }
                }
                $total_html = str_replace("{NIVELES_TD}", utf8_encode($td), $total_html);
                $html       = FuncionParaObtenerCalculoMientrasAvanzaPagina($html, $evaluador, $id_proceso, $id_empresa);
                $row        = BloqueListadoEvaluadosEvalCompetencias($evaluados, $evaluador, $componentes[$pagina - 1]->id_componente, $componentes[$pagina - 1]->id_pregunta, $id_proceso_anterior, $id_proceso, $comentario_obligatorio, $td_options, $template_comentario_por_pregunta);
                $total_html = str_replace("{LISTADO_COLABORADORES}", ($row[0]), $total_html);
                $total_html = str_replace("{TOTAL_EVALUADOS}", ($row[1] * 60) / 100, $total_html);
                $total_html = str_replace("{TOTAL_EVALUADOS_1_2}", ($row[1] * 40) / 100, $total_html);
                $total_html = str_replace("{TOTAL_EVALUADOS_4_5}", ($row[1] * 40) / 100, $total_html);
                $total_html = str_replace("{TOTAL_TOTAL_EVALUADOS}", $row[1], $total_html);
                $total_html = str_replace("{WIDTH_DINAMICO_OPCIONES}", ($width_dinamico_options), $total_html);
            }
            $html = str_replace("{PAGINACION_EVALUACION}", PaginacionSGDPorPreguntasV2($evaluador, $pagina, $id_proceso, count($componentes), "no", $evaluado_individual), $html);
            $html = str_replace("{BARRA_PROGESS}", file_get_contents("views/sgd/evaluacion/barra_progress.html"), $html);
            if ($evaluado_individual) {
                $porcentaje_avance = AvanceDeEvaluados($evaluador, $id_proceso, "", "", $datos_proceso[0]->id_proceso_anual, $evaluado_individual, "");
            } else {
                $porcentaje_avance = AvanceDeEvaluados($evaluador, $id_proceso, "", "", $datos_proceso[0]->id_proceso_anual, "", "");
            }
            $html = str_replace("{VALOR_AVANCE}", FormatearPorcentajesSinDecimal($porcentaje_avance[0]), $html);
        }
    } else {
        $total_html = "<div>Proceso no Activado o no tiene evaluados</div>";
    }
    $html = str_replace("{ENTORNO_LISTADO_EVALUACION}", ($total_html), $html);
    return ($html);
}
function formatearFecha($valor_fecha)
{
    $dia = date("d", strtotime($valor_fecha));
    $mes = devuelveNombreMes(date("m", strtotime($valor_fecha)));
    return ($dia . " de " . $mes);
    //return($fecha2=date("d-m",strtotime($valor_fecha)));
}
function formatearFechaSmall($valor_fecha)
{
    $d = date("d", strtotime($valor_fecha));
    $m = date("m", strtotime($valor_fecha));
    $a = date("Y", strtotime($valor_fecha));
    return ($d . "-" . $m . "-" . $a);
    //return($fecha2=date("d-m",strtotime($valor_fecha)));
}
function formatearFechaCompleta($valor_fecha)
{
    $dia = date("d", strtotime($valor_fecha));
    $mes = devuelveNombreMes(date("m", strtotime($valor_fecha)));
    $ano = date("Y", strtotime($valor_fecha));
    //return($fecha2=date("d-m-Y",strtotime($valor_fecha)));
    return ($dia . " de " . $mes . " de " . $ano);
}
function ListadoMensajesPrincipalesAgente($PRINCIPAL, $rut, $id_empresa, $filtro_destinatario, $id_curso, $id_objeto, $vista_agente, $rut_agente)
{
    if ($rut_agente) {
        $mensajes = TotalMensajesPorRutEmpresaAgenteFiltroAgente($rut, $id_empresa, $rut_agente);
    } else {
        $mensajes = TotalMensajesPorRutEmpresaAgente($rut, $id_empresa);
    }
    //Coloca DAtos de Agente (Campo JEfe tbl_usuarios)
    $datos_agente     = DatosMiAgente($rut, $id_empresa);
    $PRINCIPAL        = str_replace("{NOMBRE_AGENTE}", $datos_agente[0]->nombre_completo, $PRINCIPAL);
    $PRINCIPAL        = str_replace("{CARGO_AGENTE}", $datos_agente[0]->cargo, $PRINCIPAL);
    $PRINCIPAL        = str_replace("{EMAIL_AGENTE}", $datos_agente[0]->email, $PRINCIPAL);
    $PRINCIPAL        = str_replace("{TELEFONO_AGENTE}", $datos_agente[0]->telefono, $PRINCIPAL);
    $PRINCIPAL        = str_replace("{URL_IMAGEN_AGENTE}", VerificaFotoPersonal($datos_agente[0]->jefe), $PRINCIPAL);
    $usuario_en_curso = CI_verificausuariocurso($rut, $id_curso, $id_empresa);
    if ($usuario_en_curso[0]->relator == 1) {
        $PRINCIPAL = str_replace("{BOTON_PREGUNTAR}", "", $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BOTON_PREGUNTAR}", file_get_contents("views/mensajeria/" . $id_empresa . "_boton_preguntar.html"), $PRINCIPAL);
    }
    if ($mensajes) {
        //print_r($mensajes);
        foreach ($mensajes as $unico) {
            if ($usuario_en_curso[0]->relator == 1) {
                $row .= file_get_contents("views/mensajeria/" . $id_empresa . "_row_mensaje_principal_relator.html");
                $row = str_replace("{BLOQUE_RESPUESTA_RAPIDA}", file_get_contents("views/mensajeria/" . $id_empresa . "_bloque_respuesta_rapida_usuario_relator.html"), $row);
                $row = str_replace("{ID_OBJETO_ENCODEADO}", Encodear3($id_objeto), $row);
                $row = str_replace("{ID_CURSO_ENCODEADO}", Encodear3($id_curso), $row);
            } else {
                if ($rut_agente) {
                    $row .= file_get_contents("views/mensajeria/" . $id_empresa . "_row_mensaje_principal_agente.html");
                    $row = str_replace("{RUT_AGENTE}", ($rut_agente), $row);
                } else {
                    $row .= file_get_contents("views/mensajeria/" . $id_empresa . "_row_mensaje_principal.html");
                }
                $row = str_replace("{BLOQUE_RESPUESTA_RAPIDA}", file_get_contents("views/mensajeria/" . $id_empresa . "_bloque_respuesta_rapida_usuario.html"), $row);
            }
            //print_r($unico);
            $row                   = str_replace("{ID_COMENTARIO}", $unico->id, $row);
            $row                   = str_replace("{ID_MENSAJE_ENCODEADO}", Encodear3($unico->id), $row);
            $row                   = str_replace("{NOMBRE_CREADOR}", $unico->nombre_creador . " " . $unico->apaterno . " " . $unico->amaterno, $row);
            $row                   = str_replace("{URL_PERSONA}", VerificaFotoPersonal($unico->rut_creador), $row);
            $row                   = str_replace("{NOMBRE_DESTINATARIO}", $unico->nombre_tipo_destinatario, $row);
            $row                   = str_replace("{ASUNTO}", $unico->nombre_titulo, $row);
            $row                   = str_replace("{MENSAJE}", utf8_encode($unico->mensaje), $row);
            $estado                = EstadoMensajeria($unico->id);
            $row                   = str_replace("{ESTADO}", $estado[1], $row);
            $row                   = str_replace("{FECHA}", formatearFechaCompleta($unico->fecha), $row);
            $row                   = str_replace("{CANTIDAD_RESPUESTAS}", ($unico->total_comen), $row);
            $respuesta_por_mensaje = RespuestasPorMensaje($unico->id);
            if ($respuesta_por_mensaje) {
                $row_resp = "";
                foreach ($respuesta_por_mensaje as $resp) {
                    $row_resp .= file_get_contents("views/mensajeria/" . $id_empresa . "_bloque_listado_respuesta.html");
                    $row_resp  = str_replace("{URL_PERSONA}", VerificaFotoPersonal($resp->rut_creador), $row_resp);
                    $row_resp  = str_replace("{RUT_USUARIO_ENCODEADO}", Encodear3($resp->rut_creador), $row_resp);
                    $row_resp  = str_replace("{NOMBRE}", ($resp->nombre) . " " . $resp->amaterno . " " . $resp->apaterno, $row_resp);
                    $row_resp  = str_replace("{CARGO}", $resp->cargo, $row_resp);
                    $row_resp  = str_replace("{MENSAJE_RESPUESTA}", utf8_encode($resp->mensaje), $row_resp);
                    $hora      = $resp->hora;
                    $nuevaHora = strtotime('-7 hour', strtotime($hora));
                    $nuevaHora = date('H:i:s', $nuevaHora);
                    $row_resp  = str_replace("{FECHA_RESPUESTA}", formatearFechaCompleta($resp->fecha), $row_resp);
                }
                $row = str_replace("{BLOQUE_LISTADO_RESPUESTAS}", $row_resp, $row);
            } else {
                $row = str_replace("{BLOQUE_LISTADO_RESPUESTAS}", "", $row);
            }
        }
        $PRINCIPAL = str_replace("{LISTADO_MENSAJES_PRINCIPALES}", $row, $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{LISTADO_MENSAJES_PRINCIPALES}", "No hay preguntas", $PRINCIPAL);
    }
    //Aca verifico si el usuario, con el rut, está en el listado de los remitentes
    $es_admini_mensajeria = EsDestinatarioMensajeria($rut);
    if ($id_objeto && $id_curso) {
        //Aca veo si el usuario es relator de este curso, si es asi, le muestro el boton de responder
        $usuario_en_curso = CI_verificausuariocurso($rut, $id_curso, $id_empresa);
        if ($usuario_en_curso[0]->relator == 1) {
            $PRINCIPAL = str_replace("{BOTONERA_ADMINISTRACION}", file_get_contents("views/mensajeria/" . $id_empresa . "_botones_administracion.html"), $PRINCIPAL);
        } else {
            $PRINCIPAL = str_replace("{BOTONERA_ADMINISTRACION}", "", $PRINCIPAL);
        }
    } else if ($es_admini_mensajeria) {
        $PRINCIPAL = str_replace("{BOTONERA_ADMINISTRACION}", file_get_contents("views/mensajeria/" . $id_empresa . "_botones_administracion.html"), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BOTONERA_ADMINISTRACION}", "", $PRINCIPAL);
    }
    //$PRINCIPAL = str_replace("{OPTIONS_DESTINATARIOS}",OptionsGenericoNombreDadoValoresPorEmpresa("tbl_mensajes_destinatarios", "",  "nombre", "id", "order by nombre asc", $id_empresa, ""),$PRINCIPAL);
    $PRINCIPAL = str_replace("{OPTIONS_DESTINATARIOS}", OptionDestinatariosPorUsuario($filtro_destinatario, "", $id_empresa), $PRINCIPAL);
    return ($PRINCIPAL);
}
function ListadoMensajesPrincipales($PRINCIPAL, $rut, $id_empresa, $filtro_destinatario, $id_curso, $id_objeto)
{
    if ($id_objeto && $id_curso) {
        $mensajes = TotalMensajesPorEmpresaCursoObjeto($id_empresa, $id_curso, $id_objeto);
    } else if ($filtro_destinatario) {
        $mensajes = TotalMensajesPorRutEmpresaPorTipoDestinatario($rut, $id_empresa, $filtro_destinatario);
    } else {
        $mensajes = TotalMensajesPorRutEmpresa($rut, $id_empresa);
    }
    $usuario_en_curso = CI_verificausuariocurso($rut, $id_curso, $id_empresa);
    if ($usuario_en_curso[0]->relator == 1) {
        $PRINCIPAL = str_replace("{BOTON_PREGUNTAR}", "", $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BOTON_PREGUNTAR}", file_get_contents("views/mensajeria/" . $id_empresa . "_boton_preguntar.html"), $PRINCIPAL);
    }
    if ($mensajes) {
        //print_r($mensajes);
        foreach ($mensajes as $unico) {
            if ($usuario_en_curso[0]->relator == 1) {
                $row .= file_get_contents("views/mensajeria/" . $id_empresa . "_row_mensaje_principal_relator.html");
                $row = str_replace("{BLOQUE_RESPUESTA_RAPIDA}", file_get_contents("views/mensajeria/" . $id_empresa . "_bloque_respuesta_rapida_usuario_relator.html"), $row);
                $row = str_replace("{ID_OBJETO_ENCODEADO}", Encodear3($id_objeto), $row);
                $row = str_replace("{ID_CURSO_ENCODEADO}", Encodear3($id_curso), $row);
            } else {
                $row .= file_get_contents("views/mensajeria/" . $id_empresa . "_row_mensaje_principal.html");
                $row = str_replace("{BLOQUE_RESPUESTA_RAPIDA}", file_get_contents("views/mensajeria/" . $id_empresa . "_bloque_respuesta_rapida_usuario.html"), $row);
            }
            //print_r($unico);
            $row                   = str_replace("{ID_COMENTARIO}", $unico->id, $row);
            $row                   = str_replace("{ID_MENSAJE_ENCODEADO}", Encodear3($unico->id), $row);
            $row                   = str_replace("{NOMBRE_CREADOR}", $unico->nombre_creador . " " . $unico->apaterno . " " . $unico->amaterno, $row);
            $row                   = str_replace("{URL_PERSONA}", VerificaFotoPersonal($unico->rut_creador), $row);
            $row                   = str_replace("{NOMBRE_DESTINATARIO}", $unico->nombre_tipo_destinatario, $row);
            $row                   = str_replace("{ASUNTO}", $unico->nombre_titulo, $row);
            $row                   = str_replace("{MENSAJE}", utf8_encode($unico->mensaje), $row);
            $estado                = EstadoMensajeria($unico->id);
            $row                   = str_replace("{ESTADO}", $estado[1], $row);
            $row                   = str_replace("{FECHA}", formatearFechaCompleta($unico->fecha), $row);
            $row                   = str_replace("{CANTIDAD_RESPUESTAS}", ($unico->total_comen), $row);
            $respuesta_por_mensaje = RespuestasPorMensaje($unico->id);
            if ($respuesta_por_mensaje) {
                $row_resp = "";
                foreach ($respuesta_por_mensaje as $resp) {
                    $row_resp .= file_get_contents("views/mensajeria/" . $id_empresa . "_bloque_listado_respuesta.html");
                    $row_resp  = str_replace("{URL_PERSONA}", VerificaFotoPersonal($resp->rut_creador), $row_resp);
                    $row_resp  = str_replace("{RUT_USUARIO_ENCODEADO}", Encodear3($resp->rut_creador), $row_resp);
                    $row_resp  = str_replace("{NOMBRE}", ($resp->nombre) . " " . $resp->amaterno . " " . $resp->apaterno, $row_resp);
                    $row_resp  = str_replace("{CARGO}", $resp->cargo, $row_resp);
                    $row_resp  = str_replace("{MENSAJE_RESPUESTA}", utf8_encode($resp->mensaje), $row_resp);
                    $hora      = $resp->hora;
                    $nuevaHora = strtotime('-7 hour', strtotime($hora));
                    $nuevaHora = date('H:i:s', $nuevaHora);
                    $row_resp  = str_replace("{FECHA_RESPUESTA}", formatearFechaCompleta($resp->fecha), $row_resp);
                }
                $row = str_replace("{BLOQUE_LISTADO_RESPUESTAS}", $row_resp, $row);
            } else {
                $row = str_replace("{BLOQUE_LISTADO_RESPUESTAS}", "", $row);
            }
        }
        $PRINCIPAL = str_replace("{LISTADO_MENSAJES_PRINCIPALES}", $row, $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{LISTADO_MENSAJES_PRINCIPALES}", "No hay preguntas", $PRINCIPAL);
    }
    //Aca verifico si el usuario, con el rut, está en el listado de los remitentes
    $es_admini_mensajeria = EsDestinatarioMensajeria($rut);
    if ($id_objeto && $id_curso) {
        //Aca veo si el usuario es relator de este curso, si es asi, le muestro el boton de responder
        $usuario_en_curso = CI_verificausuariocurso($rut, $id_curso, $id_empresa);
        if ($usuario_en_curso[0]->relator == 1) {
            $PRINCIPAL = str_replace("{BOTONERA_ADMINISTRACION}", file_get_contents("views/mensajeria/" . $id_empresa . "_botones_administracion.html"), $PRINCIPAL);
        } else {
            $PRINCIPAL = str_replace("{BOTONERA_ADMINISTRACION}", "", $PRINCIPAL);
        }
    } else if ($es_admini_mensajeria) {
        $PRINCIPAL = str_replace("{BOTONERA_ADMINISTRACION}", file_get_contents("views/mensajeria/" . $id_empresa . "_botones_administracion.html"), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BOTONERA_ADMINISTRACION}", "", $PRINCIPAL);
    }
    //$PRINCIPAL = str_replace("{OPTIONS_DESTINATARIOS}",OptionsGenericoNombreDadoValoresPorEmpresa("tbl_mensajes_destinatarios", "",  "nombre", "id", "order by nombre asc", $id_empresa, ""),$PRINCIPAL);
    $PRINCIPAL = str_replace("{OPTIONS_DESTINATARIOS}", OptionDestinatariosPorUsuario($filtro_destinatario, "", $id_empresa), $PRINCIPAL);
    return ($PRINCIPAL);
}
function ListadoMensajesPrincipalesParaResponder($PRINCIPAL, $rut, $id_empresa, $filtro_destinatario, $id_curso, $id_objeto)
{
    //Traigo el listado de los mensajes, filtrado por empresa y por RUT
    if ($id_objeto && $id_curso) {
        $mensajes = TotalMensajesPorEmpresaCursoObjeto($id_empresa, $id_curso, $id_objeto);
    } else if ($filtro_destinatario) {
        $mensajes = TotalMensajesPorRutDestinatarioPerfilado($rut, $id_empresa, $filtro_destinatario);
    } else {
        $mensajes = TotalMensajesPorRutDestinatario($rut, $id_empresa);
    }
    if ($mensajes) {
        foreach ($mensajes as $unico) {
            $row .= file_get_contents("views/mensajeria/row_mensaje_principal_admin.html");
            $row                   = str_replace("{BLOQUE_RESPUESTA_RAPIDA}", file_get_contents("views/mensajeria/bloque_respuesta_rapida.html"), $row);
            $row                   = str_replace("{ID_COMENTARIO}", $unico->id, $row);
            $row                   = str_replace("{NOMBRE_CREADOR}", $unico->nombre_creador . " " . $unico->apaterno . " " . $unico->amaterno, $row);
            $row                   = str_replace("{NOMBRE_DESTINATARIO}", $unico->nombre_tipo_destinatario, $row);
            $row                   = str_replace("{ASUNTO}", $unico->nombre_titulo, $row);
            $row                   = str_replace("{MENSAJE}", $unico->mensaje, $row);
            $row                   = str_replace("{FECHA}", formatearFechaCompleta($unico->fecha), $row);
            $estado                = EstadoMensajeria($unico->id);
            $row                   = str_replace("{ESTADO}", $estado[1], $row);
            $row                   = str_replace("{FECHA}", formatearFechaCompleta($unico->fecha), $row);
            $row                   = str_replace("{CANTIDAD_RESPUESTAS}", ($unico->total_comen), $row);
            $respuesta_por_mensaje = RespuestasPorMensaje($unico->id);
            if ($respuesta_por_mensaje) {
                $row_resp = "";
                foreach ($respuesta_por_mensaje as $resp) {
                    $row_resp .= file_get_contents("views/mensajeria/bloque_listado_respuesta.html");
                    $row_resp  = str_replace("{URL_PERSONA}", VerificaFotoPersonal($resp->rut_creador), $row_resp);
                    $row_resp  = str_replace("{RUT_USUARIO_ENCODEADO}", Encodear3($resp->rut_creador), $row_resp);
                    $row_resp  = str_replace("{NOMBRE}", ($resp->nombre) . " " . $resp->amaterno . " " . $resp->apaterno, $row_resp);
                    $row_resp  = str_replace("{CARGO}", $resp->cargo, $row_resp);
                    $row_resp  = str_replace("{MENSAJE_RESPUESTA}", $resp->mensaje, $row_resp);
                    $hora      = $resp->hora;
                    $nuevaHora = strtotime('-7 hour', strtotime($hora));
                    $nuevaHora = date('H:i:s', $nuevaHora);
                    $row_resp  = str_replace("{FECHA_RESPUESTA}", formatearFechaCompleta($resp->fecha) . "<br>" . $nuevaHora, $row_resp);
                }
                $row = str_replace("{BLOQUE_LISTADO_RESPUESTAS}", $row_resp, $row);
            } else {
                $row = str_replace("{BLOQUE_LISTADO_RESPUESTAS}", "", $row);
            }
        }
        $PRINCIPAL = str_replace("{LISTADO_MENSAJES_PRINCIPALES}", $row, $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{LISTADO_MENSAJES_PRINCIPALES}", "No posee mensajes enviados al Administrador para responder", $PRINCIPAL);
    }
    //Aca verifico si el usuario, con el rut, está en el listado de los remitentes
    $es_admini_mensajeria = EsDestinatarioMensajeria($rut);
    if ($id_objeto && $id_curso) {
        //Aca veo si el usuario es relator de este curso, si es asi, le muestro el boton de responder
        $usuario_en_curso = CI_verificausuariocurso($rut, $id_curso, $id_empresa);
        if ($usuario_en_curso[0]->relator == 1) {
            $PRINCIPAL = str_replace("{BOTONERA_ADMINISTRACION}", file_get_contents("views/mensajeria/" . $id_empresa . "_botones_administracion.html"), $PRINCIPAL);
        } else {
            $PRINCIPAL = str_replace("{BOTONERA_ADMINISTRACION}", "", $PRINCIPAL);
        }
    } else if ($es_admini_mensajeria) {
        $PRINCIPAL = str_replace("{BOTONERA_ADMINISTRACION}", file_get_contents("views/mensajeria/botones_administracion.html"), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BOTONERA_ADMINISTRACION}", "", $PRINCIPAL);
    }
    $PRINCIPAL = str_replace("{OPTIONS_DESTINATARIOS_ADMIN}", OptionDestinatariosPorUsuario($filtro_destinatario, $rut, $id_empresa), $PRINCIPAL);
    //Bloque de las demás respuestas
    return ($PRINCIPAL);
}
function ColocaFormularioMensaje($PRINCIPAL, $id_empresa)
{
    $PRINCIPAL = str_replace("{OPTIONS_TIPO_MENSAJE}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_mensaje_tipo", "", "nombre", "id", "order by orden asc", $id_empresa), $PRINCIPAL);
    $PRINCIPAL = str_replace("{OPTIONS_TIPO_DESTINATARIO}", OptionsGenericoNombreDadoValoresPorEmpresa("tbl_mensajes_destinatarios", "", "nombre", "id", "order by nombre asc", $id_empresa), $PRINCIPAL);
    return ($PRINCIPAL);
}
function colocarColaboradoresPorRut($PRINCIPAL, $id_empresa, $rut)
{
    $listado_colaboradores = TotalUsuariosPorRutJefe($rut);
    if ($listado_colaboradores) {
        $PRINCIPAL = str_replace("{BLOQUE_COLABORADORES}", file_get_contents("views/miperfil/bloque_mis_colaboradores.html"), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BLOQUE_COLABORADORES}", "", $PRINCIPAL);
    }
    foreach ($listado_colaboradores as $unico) {
        $row .= file_get_contents("views/miperfil/row_colaboradores_miperfil.html");
        $row = str_replace("{NOMBRE}", $unico->nombre . " " . $unico->apaterno . " " . $unico->amaterno, $row);
        $row = str_replace("{CARGO}", $unico->cargo, $row);
        $row = str_replace("{FECHA_CUMPLEANOS}", formatearFecha($unico->fecha_nacimiento), $row);
        $row = str_replace("{URL_PERSONA}", VerificaFotoPersonal($unico->rut), $row);
        $row = str_replace("{RUT_ENCODEADO}", Encodear3($unico->rut), $row);
    }
    $PRINCIPAL = str_replace("{LISTADO_COLABORADORES_DIRECTOS}", utf8_encode($row), $PRINCIPAL);
    return ($PRINCIPAL);
}
function MuestraEvaluacionFeedback($id_evaluacion, $rut)
{
    $id_empresa               = $_SESSION["id_empresa"];
    //function MuestraEvaluacion($PRINCIPAL, $id_evaluacion, $rut){
    //ID_EVALUACION CORRESPONDE AL ID DEL OBJETO
    $datos_objeto             = DatosObjeto($id_evaluacion);
    $id_evaluacion_por_objeto = $datos_objeto[0]->id_evaluacion; //Id de la evaluacion. Este es el que se obtiene desde el campo id evaluacion de la tabla objeto
    $datos_evaluacion         = DatosEvaluacion($datos_objeto[0]->id_evaluacion);
    //Veo si está en la tabla sesion esta evaluacion, y este usuario
    $tiene_sesion             = SesionEvaluacionContenidos($id_evaluacion, $rut);
    $total_preguntas          = PreguntasDadoEvaluacion($id_evaluacion_por_objeto);
    //ACA VALIDA SI ES QUE EL OBJETO, QUE CONTIENE ESTA EVALUACION, TIENE PREGUNTAS ALEATORIAS O NO.
    //SI NO TIENE ALEATORIAS, LAS MUESTRA TODAS
    if ($datos_objeto[0]->preguntas_aleatorias > 0) {
        //Asigno a una tabla,si es que no esta asignado obviamente. La cantidad que corresponda de preguntas, asociadas al rut, curso y objeto.
        $tiene_preguntas_asociadas = VerificaSiTienePReguntasAsociadasRandomicas($rut, $id_evaluacion_por_objeto, $datos_objeto[0]->id);
        if (count($tiene_preguntas_asociadas) == 0) {
            shuffle($total_preguntas);
            $vueltas = 1;
            foreach ($total_preguntas as $pre) {
                InsertoRegistroPreguntasAleatorias($rut, $id_evaluacion_por_objeto, $datos_objeto[0]->id, $vueltas, $pre->id, $datos_objeto[0]->id_curso);
                if ($vueltas == $datos_objeto[0]->preguntas_aleatorias)
                    break;
                $vueltas++;
            }
        }
        if ($tiene_sesion) {
            //echo "1.1<br>";
            $pagina             = $tiene_sesion[0]->pagina - 1;
            $pregunta           = PreguntaDeEvaluacionAleatorias($id_evaluacion_por_objeto, $pagina, $rut);
            //echo "views/cursos/evaluacion/".$pregunta[0]->template_pregunta_feedback;
            $PRINCIPAL          = FuncionesTransversales(file_get_contents("views/cursos/evaluacion/" . $pregunta[0]->template_pregunta_feedback));
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA}", ($pregunta[0]->pregunta), $PRINCIPAL);
            //Funcion para mostrar las alternativas
            $PRINCIPAL          = str_replace("{OPCIONES}", MuestraAlternativas($pregunta[0]->id_grupo_alternativas, $pregunta[0]->id), $PRINCIPAL);
            $PRINCIPAL          = str_replace("{ID_PREGUNTA_ENCODEADO}", Encodear3($pregunta[0]->id), $PRINCIPAL);
            $PRINCIPAL          = str_replace("{ID_OBJETO_ENCODEADO}", Encodear3($id_evaluacion), $PRINCIPAL);
            $PRINCIPAL          = str_replace("{URL_IMAGEN}", $pregunta[0]->url_archivo, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{NUMERO_PREGUNTA}", $pagina, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_BAJADA1}", $pregunta[0]->bajada1, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_BAJADA2}", $pregunta[0]->bajada2, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_BAJADA3}", $pregunta[0]->bajada3, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_BAJADA4}", $pregunta[0]->bajada4, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_REFUERZO1}", $pregunta[0]->refuerzo1, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_REFUERZO2}", $pregunta[0]->refuerzo2, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_REFUERZO3}", $pregunta[0]->refuerzo3, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_REFUERZO4}", $pregunta[0]->refuerzo4, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_REFUERZO5}", $pregunta[0]->refuerzo5, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_REFUERZO6}", $pregunta[0]->refuerzo6, $PRINCIPAL);
            $respuesta_correcta = ObtenerRespuestaDeUsuario($pregunta[0]->id, $rut);
            if ($respuesta_correcta[0]->correcta == "1") {
                $PRINCIPAL = str_replace("{RESULTADO}", "CORRECTO", $PRINCIPAL);
                $PRINCIPAL = str_replace("{CLASERESULTADO}", "feedbackcorrecto", $PRINCIPAL);
            } else {
                $PRINCIPAL = str_replace("{RESULTADO}", "INCORRECTO", $PRINCIPAL);
                $PRINCIPAL = str_replace("{CLASERESULTADO}", "feedbackincorrecto", $PRINCIPAL);
            }
        } else {
            $pagina = 1;
            //Ingreso el registro de la sesion con pagina 1
            InsertaRegistroTablaSesionEvaluacionContenido($rut, $id_evaluacion, $pagina);
            $pregunta           = PreguntaDeEvaluacionAleatorias($id_evaluacion_por_objeto, $pagina, $rut);
            $PRINCIPAL          = FuncionesTransversales(file_get_contents("views/cursos/evaluacion/" . $pregunta[0]->template_pregunta_feedback));
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA}", ($pregunta[0]->pregunta), $PRINCIPAL);
            //Funcion para mostrar las alternativas
            $PRINCIPAL          = str_replace("{OPCIONES}", MuestraAlternativas($pregunta[0]->id_grupo_alternativas, $pregunta[0]->id), $PRINCIPAL);
            $PRINCIPAL          = str_replace("{ID_PREGUNTA_ENCODEADO}", Encodear3($pregunta[0]->id), $PRINCIPAL);
            $PRINCIPAL          = str_replace("{ID_OBJETO_ENCODEADO}", Encodear3($id_evaluacion), $PRINCIPAL);
            $PRINCIPAL          = str_replace("{NUMERO_PREGUNTA}", $pagina, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_BAJADA1}", $pregunta[0]->bajada1, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_BAJADA2}", $pregunta[0]->bajada2, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_BAJADA3}", $pregunta[0]->bajada3, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_BAJADA4}", $pregunta[0]->bajada4, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_REFUERZO1}", $pregunta[0]->refuerzo1, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_REFUERZO2}", $pregunta[0]->refuerzo2, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_REFUERZO3}", $pregunta[0]->refuerzo3, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_REFUERZO4}", $pregunta[0]->refuerzo4, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_REFUERZO5}", $pregunta[0]->refuerzo5, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_REFUERZO6}", $pregunta[0]->refuerzo6, $PRINCIPAL);
            $respuesta_correcta = ObtenerRespuestaDeUsuario($pregunta[0]->id, $rut);
            if ($respuesta_correcta[0]->correcta == "1") {
                $PRINCIPAL = str_replace("{RESULTADO}", "CORRECTO", $PRINCIPAL);
                $PRINCIPAL = str_replace("{CLASERESULTADO}", "feedbackcorrecto", $PRINCIPAL);
            } else {
                $PRINCIPAL = str_replace("{RESULTADO}", "INCORRECTO", $PRINCIPAL);
                $PRINCIPAL = str_replace("{CLASERESULTADO}", "feedbackincorrecto", $PRINCIPAL);
            }
        }
    } else {
        if ($tiene_sesion) {
            //$pagina=$tiene_sesion[0]->pagina;
            $pagina             = $tiene_sesion[0]->pagina - 1;
            $pregunta           = PreguntaDeEvaluacion($id_evaluacion_por_objeto, $pagina);
            $PRINCIPAL          = FuncionesTransversales(file_get_contents("views/cursos/evaluacion/" . $pregunta[0]->template_pregunta_feedback));
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA}", ($pregunta[0]->pregunta), $PRINCIPAL);
            //Funcion para mostrar las alternativas
            $PRINCIPAL          = str_replace("{OPCIONES}", MuestraAlternativas($pregunta[0]->id_grupo_alternativas, $pregunta[0]->id), $PRINCIPAL);
            $PRINCIPAL          = str_replace("{ID_PREGUNTA_ENCODEADO}", Encodear3($pregunta[0]->id), $PRINCIPAL);
            $PRINCIPAL          = str_replace("{ID_OBJETO_ENCODEADO}", Encodear3($id_evaluacion), $PRINCIPAL);
            $PRINCIPAL          = str_replace("{URL_IMAGEN}", $pregunta[0]->url_archivo, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{NUMERO_PREGUNTA}", $pregunta[0]->orden, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_BAJADA1}", $pregunta[0]->bajada1, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_BAJADA2}", $pregunta[0]->bajada2, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_BAJADA3}", $pregunta[0]->bajada3, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_BAJADA4}", $pregunta[0]->bajada4, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_REFUERZO1}", $pregunta[0]->refuerzo1, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_REFUERZO2}", $pregunta[0]->refuerzo2, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_REFUERZO3}", $pregunta[0]->refuerzo3, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_REFUERZO4}", $pregunta[0]->refuerzo4, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_REFUERZO5}", $pregunta[0]->refuerzo5, $PRINCIPAL);
            $PRINCIPAL          = str_replace("{TEXTO_PREGUNTA_REFUERZO6}", $pregunta[0]->refuerzo6, $PRINCIPAL);
            $respuesta_correcta = ObtenerRespuestaDeUsuario($pregunta[0]->id, $rut);
            if ($respuesta_correcta[0]->correcta == "1") {
                $PRINCIPAL = str_replace("{RESULTADO}", "CORRECTO", $PRINCIPAL);
                $PRINCIPAL = str_replace("{CLASERESULTADO}", "feedbackcorrecto", $PRINCIPAL);
            } else {
                $PRINCIPAL = str_replace("{RESULTADO}", "INCORRECTO", $PRINCIPAL);
                $PRINCIPAL = str_replace("{CLASERESULTADO}", "feedbackincorrecto", $PRINCIPAL);
            }
        } else {
            $pagina   = 1;
            //obtengo la primera pregunta
            $pregunta = PreguntaDeEvaluacion($id_evaluacion_por_objeto, $pagina1);
            //Inserto en la tabla de sesion la pgina 1.
            InsertaRegistroTablaSesionEvaluacionContenido($rut, $id_evaluacion, "1");
            $PRINCIPAL = FuncionesTransversales(file_get_contents("views/cursos/evaluacion/" . $pregunta[0]->template_pregunta_feedback));
            $PRINCIPAL = str_replace("{TEXTO_PREGUNTA}", ($pregunta[0]->pregunta), $PRINCIPAL);
            //Funcion para mostrar las alternativas
            $PRINCIPAL = str_replace("{OPCIONES}", MuestraAlternativas($pregunta[0]->id_grupo_alternativas, $pregunta[0]->id), $PRINCIPAL);
            $PRINCIPAL = str_replace("{ID_PREGUNTA_ENCODEADO}", Encodear3($pregunta[0]->id), $PRINCIPAL);
            $PRINCIPAL = str_replace("{ID_OBJETO_ENCODEADO}", Encodear3($id_evaluacion), $PRINCIPAL);
            $PRINCIPAL = str_replace("{NUMERO_PREGUNTA}", $pregunta[0]->orden, $PRINCIPAL);
            $PRINCIPAL = str_replace("{TEXTO_PREGUNTA_BAJADA1}", $pregunta[0]->bajada1, $PRINCIPAL);
            $PRINCIPAL = str_replace("{TEXTO_PREGUNTA_BAJADA2}", $pregunta[0]->bajada2, $PRINCIPAL);
            $PRINCIPAL = str_replace("{TEXTO_PREGUNTA_BAJADA3}", $pregunta[0]->bajada3, $PRINCIPAL);
            $PRINCIPAL = str_replace("{TEXTO_PREGUNTA_BAJADA4}", $pregunta[0]->bajada4, $PRINCIPAL);
        }
    }
    //PAGINACION////////////
    if ($datos_objeto[0]->preguntas_aleatorias > 0) {
        $total_preguntas = VerificaSiTienePReguntasAsociadasRandomicas($rut, $id_evaluacion_por_objeto, $datos_objeto[0]->id);
    } else {
        $total_preguntas = PreguntasDadoEvaluacion($id_evaluacion_por_objeto);
    }
    $PRINCIPAL     = str_replace("{ENTORNO_PAGINACION}", ArmaPaginacionEvaluacion($total_preguntas, $pagina), $PRINCIPAL);
    $PRINCIPAL     = str_replace("{ID_PREGUNTA_ENCODEADO}", Encodear3($id_evaluacion_por_objeto), $PRINCIPAL);
    $PRINCIPAL     = str_replace("{NAME_FORMULARIO}", "FormRespuestas", $PRINCIPAL);
    $PRINCIPAL     = str_replace("{VALOR_BOTON}", "Guardar y Avanzar", $PRINCIPAL);
    $PRINCIPAL     = str_replace("{NOMBRE_EVALUACION}", $datos_evaluacion[0]->nombre_evaluacion, $PRINCIPAL);
    $PRINCIPAL     = str_replace("{NOMBRE_OBJETO}", $datos_evaluacion[0]->nombre_evaluacion, $PRINCIPAL);
    $datos_usuario = UsuarioEnBasePersonas($rut);
    $PRINCIPAL     = str_replace("{NOMBRE_USUARIO}", ($datos_usuario[0]->nombre_completo), $PRINCIPAL);
    $PRINCIPAL     = str_replace("{AVANCEEVALUACION_PREGUNTADOS}", "100", $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocaDatosPerfil($PRINCIPAL, $rut)
{
    $PRINCIPAL             = str_replace("{FOTO_PERSONA}", VerificaFotoPersonal($rut), $PRINCIPAL);
    $datos_usuario         = DatosUsuarioLeftJefeDeTblUsuario($rut);
    //Datos JEfe
    
    
  if($datos_usuario[0]->vigencia_descripcion=="Beneficios_especialistas"){
  	echo "<script>alert('Beneficios_especialistas');</script>";
  	echo "<script>location.href='../beneficios/front/?sw=calendario';</script>";exit();
  	
  	//exit();
  }
    

  if($datos_usuario[0]->vigencia_descripcion=="Chileactivo"){
  	echo "<script>alert('ChileActivo');</script>";
  	echo "<script>location.href='../chileactivo/front/?sw=home_chileactivo';</script>";exit();
  	
  	//exit();
  }    
    $arreglo_rut_jefe      = explode("-", $datos_usuario[0]->jefe);
    $datos_personales_jefe = DatosUsuarioLeftJefeDeTblUsuario($arreglo_rut_jefe[0]);
    $PRINCIPAL             = str_replace("{NOMBRE}", utf8_encode($datos_usuario[0]->nombre . " " . $datos_usuario[0]->apaterno . " " . $datos_usuario[0]->amaterno), $PRINCIPAL);
    $PRINCIPAL             = str_replace("{CARGO}", utf8_encode($datos_usuario[0]->cargo), $PRINCIPAL);
    $PRINCIPAL             = str_replace("{GERENCIA}", utf8_encode($datos_usuario[0]->gerencia), $PRINCIPAL);
    $PRINCIPAL             = str_replace("{DIVISION}", utf8_encode($datos_usuario[0]->division), $PRINCIPAL);
    $PRINCIPAL             = str_replace("{CORREO}", $datos_usuario[0]->email, $PRINCIPAL);
    $PRINCIPAL             = str_replace("{RUT_ENCODEADO}", Encodear7($rut), $PRINCIPAL);
    
    $secret = getenv('SECRET_BEN_ESPC');
    $word = $rut . $secret;
    $token_hash = hash('sha256', $word);
    $PRINCIPAL             = str_replace("{TOKEN}", ($token_hash), $PRINCIPAL);
  
    return ($PRINCIPAL);
}
function DetectaSistema()
{
    $tablet_browser = 0;
    $mobile_browser = 0;
    $body_class     = 'desktop';
    if (preg_match('/(tablet|ipad|playbook)|(android(?!.*(mobi|opera mini)))/i', strtolower($_SERVER['HTTP_USER_AGENT']))) {
        $tablet_browser++;
        $body_class = "tablet";
    }
    if (preg_match('/(up.browser|up.link|mmp|symbian|smartphone|midp|wap|phone|android|iemobile)/i', strtolower($_SERVER['HTTP_USER_AGENT']))) {
        $mobile_browser++;
        $body_class = "mobile";
    }
    if ((strpos(strtolower($_SERVER['HTTP_ACCEPT']), 'application/vnd.wap.xhtml+xml') > 0) or ((isset($_SERVER['HTTP_X_WAP_PROFILE']) or isset($_SERVER['HTTP_PROFILE'])))) {
        $mobile_browser++;
        $body_class = "mobile";
    }
    $mobile_ua     = strtolower(substr($_SERVER['HTTP_USER_AGENT'], 0, 4));
    $mobile_agents = array(
        'w3c ',
        'acs-',
        'alav',
        'alca',
        'amoi',
        'audi',
        'avan',
        'benq',
        'bird',
        'blac',
        'blaz',
        'brew',
        'cell',
        'cldc',
        'cmd-',
        'dang',
        'doco',
        'eric',
        'hipt',
        'inno',
        'ipaq',
        'java',
        'jigs',
        'kddi',
        'keji',
        'leno',
        'lg-c',
        'lg-d',
        'lg-g',
        'lge-',
        'maui',
        'maxo',
        'midp',
        'mits',
        'mmef',
        'mobi',
        'mot-',
        'moto',
        'mwbp',
        'nec-',
        'newt',
        'noki',
        'palm',
        'pana',
        'pant',
        'phil',
        'play',
        'port',
        'prox',
        'qwap',
        'sage',
        'sams',
        'sany',
        'sch-',
        'sec-',
        'send',
        'seri',
        'sgh-',
        'shar',
        'sie-',
        'siem',
        'smal',
        'smar',
        'sony',
        'sph-',
        'symb',
        't-mo',
        'teli',
        'tim-',
        'tosh',
        'tsm-',
        'upg1',
        'upsi',
        'vk-v',
        'voda',
        'wap-',
        'wapa',
        'wapi',
        'wapp',
        'wapr',
        'webc',
        'winw',
        'winw',
        'xda ',
        'xda-'
    );
    if (in_array($mobile_ua, $mobile_agents)) {
        $mobile_browser++;
    }
    if (strpos(strtolower($_SERVER['HTTP_USER_AGENT']), 'opera mini') > 0) {
        $mobile_browser++;
        //Check for tablets on opera mini alternative headers
        $stock_ua = strtolower(isset($_SERVER['HTTP_X_OPERAMINI_PHONE_UA']) ? $_SERVER['HTTP_X_OPERAMINI_PHONE_UA'] : (isset($_SERVER['HTTP_DEVICE_STOCK_UA']) ? $_SERVER['HTTP_DEVICE_STOCK_UA'] : ''));
        if (preg_match('/(tablet|ipad|playbook)|(android(?!.*mobile))/i', $stock_ua)) {
            $tablet_browser++;
        }
    }
    if ($tablet_browser > 0) {
        // Si es tablet has lo que necesites
        //print 'es tablet';
        $arreglo_return[0] = 1;
    } else if ($mobile_browser > 0) {
        // Si es dispositivo mobil has lo que necesites
        //print 'es un mobil';
        $arreglo_return[0] = 2;
    } else {
        // Si es ordenador de escritorio has lo que necesites
        // print 'es un ordenador de escritorio';
        $arreglo_return[0] = 3;
    }
    return ($arreglo_return);
}
function TransformarEscalaEncSatisParaGrafico($valor)
{
    $valor = ($valor * 100) / 5;
    return ($valor);
}
function ColocaBloqueUltimasTres($PRINCIPAL, $id_empresa)
{
    //Traigo el listado de Categorias por empresa
    $noticias = TRaigoUltimas3Noticias($id_empresa);
    $i        = 20;
    foreach ($noticias as $unico) {
        //$row.=file_get_contents("views/bloques/row_bloques_sin_visitas.html");
        $row .= file_get_contents("views/bloques/row_bloques_noticias_recientes.html");
        $row = str_replace("{NOMBRE}", $unico->titulo, $row);
        $row = str_replace("{ID_NOTICIA}", Encodear($unico->id), $row);
        $row = str_replace("{TOTAL_DE_CURSOS}", "", $row);
        $i++;
    }
    $PRINCIPAL = str_replace("{BLOQUE_ULTIMAS_TRES}", utf8_encode($row), $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocaBloqueNoticiasSimilares($PRINCIPAL, $id_empresa, $id_categoria)
{
    //Traigo el listado de Categorias por empresa
    $noticias = NoticiaPorIdConVistasPorCategoria($id_categoria, $id_empresa);
    $i        = 20;
    foreach ($noticias as $unico) {
        $row .= file_get_contents("views/bloques/row_bloques_sin_visitas.html");
        $row = str_replace("{NOMBRE}", $unico->titulo, $row);
        $row = str_replace("{TOTAL_DE_CURSOS}", $unico->total_visitas, $row);
        $i++;
    }
    $PRINCIPAL = str_replace("{BLOQUE_NOTICIAS_SIMILARES}", utf8_encode($row), $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocaBloqueMasVistas($PRINCIPAL, $id_empresa)
{
    //Traigo el listado de Categorias por empresa
    $noticias = TraigoNoticasMasVistas($id_empresa);
    $i        = 20;
    foreach ($noticias as $unico) {
        $row .= file_get_contents("views/bloques/row_bloques_noticias.html");
        $row = str_replace("{NOMBRE}", $unico->titulo, $row);
        $row = str_replace("{ID_NOTICIA_ENCODEADA}", Encodear($unico->id), $row);
        $row = str_replace("{TOTAL_DE_CURSOS}", $unico->visitas, $row);
        $i++;
    }
    $PRINCIPAL = str_replace("{BLOQUE_MAS_VISTAS}", utf8_encode($row), $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocaBloqueCategoriasNoticias($PRINCIPAL, $id_empresa)
{
    $datos_empresa = DatosEmpresa($id_empresa);
    if ($datos_empresa[0]->bloque_categorias_noticias_derecha == 1) {
        $PRINCIPAL = str_replace("{BLOQUE_CATEGORIAS_DERECHA}", "", $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BLOQUE_CATEGORIAS_DERECHA}", file_get_contents("views/noticias/bloque_derecho_categorias.html"), $PRINCIPAL);
    }
    //Traigo el listado de Categorias por empresa
    $categorias = CategoriasNoticiasPorEmpresa($id_empresa);
    foreach ($categorias as $cat) {
        $row .= file_get_contents("views/bloques/row_bloques_categorias.html");
        $row = str_replace("{NOMBRE}", $cat->categoria, $row);
        $row = str_replace("{ID_CATEGORIA_ENCODEADA}", Encodear3($cat->id), $row);
        $row = str_replace("{TOTAL_DE_CURSOS}", $cat->total_noticia, $row);
    }
    $PRINCIPAL = str_replace("{BLOQUE_CATEGORIAS}", utf8_encode($row), $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocaMenuSecundario($PRINCIPAL, $id_empresa)
{
    return ($PRINCIPAL);
}
function ColocarEntornoEquipo($PRINCIPAL, $rut_jefe, $modalidad)
{
    if ($modalidad == "todos") {
        $PRINCIPAL     = str_replace("{ENTORNO_EQUIPO}", file_get_contents("views/miequipo/entorno_equipo.html"), $PRINCIPAL);
        $colaboradores = EsJefe($rut_jefe);
        $template_row  = file_get_contents("views/miequipo/row_equipo.html");
    } elseif ($modalidad == "todoequipo") {
        $PRINCIPAL     = str_replace("{ENTORNO_EQUIPO_TODO}", file_get_contents("views/miequipo/entorno_lideres.html"), $PRINCIPAL);
        $colaboradores = EsJefe($rut_jefe);
        $template_row  = file_get_contents("views/miequipo/row_lideres.html");
    } elseif ($modalidad == "todoequipoExcel") {
        $PRINCIPAL     = file_get_contents("views/miequipo/entorno_lideres_excel.html");
        $colaboradores = EsJefe($rut_jefe);
        $template_row  = file_get_contents("views/miequipo/row_lideres_excel.html");
    } else if ($modalidad == "lideres") {
        $PRINCIPAL         = str_replace("{ENTORNO_EQUIPO_LIDERES}", file_get_contents("views/miequipo/entorno_lideres.html"), $PRINCIPAL);
        $colaboradores     = ListadoUsuariosLideres($rut_jefe);
        $template_row      = file_get_contents("views/miequipo/row_lideres.html");
        $template_SUB1_row = file_get_contents("views/miequipo/row_sub_lideres.html");
    }
    foreach ($colaboradores as $unico) {
        //echo "modalidad $modalidad unico ".$unico->total."<br>";
        if ($modalidad == "lideres" and $unico->total == 0 and $unico->lider <> "1") {
            continue;
        }
        $row .= $template_row;
        $row = str_replace("{NOMBRE_COMPLETO}", "<span class='pad_izquierda0'>" . $unico->nombre_completo . "</span>", $row);
        $row = str_replace("{RUT}", "<span class='pad_izquierda0'>" . $unico->rut_completo . "</span>", $row);
        $row = str_replace("{EMAIL}", "<span class='pad_izquierda0'>" . $unico->email . "</span>", $row);
        $row = str_replace("{RUT_JEFE}", "<span class='pad_izquierda0'>" . $unico->rut_jefe . "</span>", $row);
        $row = str_replace("{NOMBRE_JEFE}", "<span class='pad_izquierda0'>" . $unico->nombre_jefe . "</span>", $row);
        if ($unico->total == 0) {
            $row = str_replace("{PERFIL}", "", $row);
        } else {
            $row = str_replace("{PERFIL}", "<span class='fa fa-user-plus'>", $row);
        }
        if ($unico->cargo) {
            $row = str_replace("{CARGO}", $unico->cargo, $row);
        } else {
            $row = str_replace("{CARGO}", "Sin Cargo", $row);
        }
        if ($unico->gerencia) {
            $row = str_replace("{GERENCIA}", $unico->gerencia, $row);
        } else {
            $row = str_replace("{GERENCIA}", "Sin Gerencia", $row);
        }
        //Veo en cuanta
        //Veo en cuantas accione está dado el rut del jefe y el rut del colaborador, independiente del id del objetivo
        $total_sugerencias = UsuariosPorSugerenciaJefeYColaborador($rut_jefe, $unico->rut);
        $row               = str_replace("{NUM_ACCIONES}", count($total_sugerencias), $row);
        //SUB 1 busca colaboradores abajo de cada linea
        if ($modalidad == "todos" OR $modalidad == "todoequipo" or $modalidad == "todoequipoExcel") {
            $colaboradoresSUB1 = EsJefe($unico->rut);
        } else if ($modalidad == "lideres") {
            $colaboradoresSUB1 = ListadoUsuariosLideres($unico->rut);
        }
        foreach ($colaboradoresSUB1 as $unicoSUB1) {
            if ($modalidad == "lideres" and $unicoSUB1->total == 0 and $unicoSUB1->lider <> "1") {
                continue;
            }
            $row_SUB1 .= $template_SUB1_row;
            $row_SUB1 = str_replace("{NOMBRE_COMPLETO}", $unicoSUB1->nombre_completo, $row_SUB1);
            $row_SUB1 = str_replace("{RUT}", $unicoSUB1->rut_completo, $row_SUB1);
            $row_SUB1 = str_replace("{EMAIL}", $unicoSUB1->email, $row_SUB1);
            $row_SUB1 = str_replace("{NOMBRE_JEFE}", $unicoSUB1->nombre_jefe, $row_SUB1);
            $row .= $template_row;
            $row = str_replace("{NOMBRE_COMPLETO}", " <span class='  pad_izquierda1'>" . $unicoSUB1->nombre_completo . "</span>", $row);
            $row = str_replace("{RUT}", " <span class='  pad_izquierda1'>" . $unicoSUB1->rut_completo . "</span>", $row);
            $row = str_replace("{EMAIL}", " <span class='  pad_izquierda1'>" . $unicoSUB1->email . "</span>", $row);
            $row = str_replace("{RUT_JEFE}", " <span class='  pad_izquierda1'>" . $unicoSUB1->rut_jefe . "</span>", $row);
            $row = str_replace("{NOMBRE_JEFE}", " <span class='  pad_izquierda1'>" . $unicoSUB1->nombre_jefe . "</span>", $row);
            if ($unicoSUB1->total == 0) {
                $row = str_replace("{PERFIL}", "", $row);
            } else {
                $row = str_replace("{PERFIL}", "<span class='fa fa-user-plus'>", $row);
            }
            if ($unico->cargo) {
                $row = str_replace("{CARGO}", $unicoSUB1->cargo, $row);
            } else {
                $row = str_replace("{CARGO}", "Sin Cargo", $row);
            }
            if ($unico->gerencia) {
                $row = str_replace("{GERENCIA}", $unicoSUB1->gerencia, $row);
            } else {
                $row = str_replace("{GERENCIA}", "Sin Gerencia", $row);
            }
            $total_sugerencias = UsuariosPorSugerenciaJefeYColaborador($rut_jefe, $unicoSUB1->rut);
            $row               = str_replace("{NUM_ACCIONES}", count($total_sugerencias), $row);
            //SUB 2 busca colaboradores abajo de cada linea
            if ($modalidad == "todos" OR $modalidad == "todoequipo" or $modalidad == "todoequipoExcel") {
                $colaboradoresSUB2 = EsJefe($unicoSUB1->rut);
            } else if ($modalidad == "lideres") {
                $colaboradoresSUB2 = ListadoUsuariosLideres($unicoSUB1->rut);
            }
            foreach ($colaboradoresSUB2 as $unicoSUB2) {
                if ($modalidad == "lideres" and $unicoSUB2->total == 0 and $unicoSUB2->lider <> "1") {
                    continue;
                }
                $row .= $template_row;
                $row = str_replace("{NOMBRE_COMPLETO}", " <span class=' pad_izquierda2'>" . $unicoSUB2->nombre_completo . "</span>", $row);
                $row = str_replace("{RUT}", " <span class=' pad_izquierda2'>" . $unicoSUB2->rut_completo . "</span>", $row);
                $row = str_replace("{EMAIL}", " <span class=' pad_izquierda2'>" . $unicoSUB2->email . "</span>", $row);
                $row = str_replace("{RUT_JEFE}", " <span class=' pad_izquierda2'>" . $unicoSUB2->rut_jefe . "</span>", $row);
                $row = str_replace("{NOMBRE_JEFE}", " <span class=' pad_izquierda2'>" . $unicoSUB2->nombre_jefe . "</span>", $row);
                if ($unicoSUB2->total == 0) {
                    $row = str_replace("{PERFIL}", "", $row);
                } else {
                    $row = str_replace("{PERFIL}", "<span class='fa fa-user-plus'>", $row);
                }
                if ($unicoSUB2->cargo) {
                    $row = str_replace("{CARGO}", $unicoSUB2->cargo, $row);
                } else {
                    $row = str_replace("{CARGO}", "Sin Cargo", $row);
                }
                if ($unicoSUB2->gerencia) {
                    $row = str_replace("{GERENCIA}", $unicoSUB2->gerencia, $row);
                } else {
                    $row = str_replace("{GERENCIA}", "Sin Gerencia", $row);
                }
                $total_sugerencias = UsuariosPorSugerenciaJefeYColaborador($rut_jefe, $unicoSUB2->rut);
                $row               = str_replace("{NUM_ACCIONES}", count($total_sugerencias), $row);
                //SUB 3 busca colaboradores abajo de cada linea
                if ($modalidad == "todos" OR $modalidad == "todoequipo" or $modalidad == "todoequipoExcel") {
                    $colaboradoresSUB3 = EsJefe($unicoSUB2->rut);
                } else if ($modalidad == "lideres") {
                    $colaboradoresSUB3 = ListadoUsuariosLideres($unicoSUB2->rut);
                }
                $colaboradoresSUB3 = EsJefe($unicoSUB2->rut);
                foreach ($colaboradoresSUB3 as $unicoSUB3) {
                    if ($modalidad == "lideres" and $unicoSUB3->total == 0 and $unicoSUB3->lider <> "1") {
                        continue;
                    }
                    $row .= $template_row;
                    $row = str_replace("{NOMBRE_COMPLETO}", " <span class=' pad_izquierda3'>" . $unicoSUB3->nombre_completo . "</span>", $row);
                    $row = str_replace("{RUT}", " <span class=' pad_izquierda3'>" . $unicoSUB3->rut_completo . "</span>", $row);
                    $row = str_replace("{EMAIL}", " <span class=' pad_izquierda3'>" . $unicoSUB3->email . "</span>", $row);
                    $row = str_replace("{RUT_JEFE}", " <span class=' pad_izquierda3'>" . $unicoSUB3->rut_jefe . "</span>", $row);
                    $row = str_replace("{NOMBRE_JEFE}", " <span class=' pad_izquierda3'>" . $unicoSUB3->nombre_jefe . "</span>", $row);
                    if ($unicoSUB3 > total == 0) {
                        $row = str_replace("{PERFIL}", "", $row);
                    } else {
                        $row = str_replace("{PERFIL}", "<span class='fa fa-user-plus'>", $row);
                    }
                    if ($unicoSUB3->cargo) {
                        $row = str_replace("{CARGO}", $unicoSUB3->cargo, $row);
                    } else {
                        $row = str_replace("{CARGO}", "Sin Cargo", $row);
                    }
                    if ($unicoSUB3->gerencia) {
                        $row = str_replace("{GERENCIA}", $unicoSUB3->gerencia, $row);
                    } else {
                        $row = str_replace("{GERENCIA}", "Sin Gerencia", $row);
                    }
                    $total_sugerencias = UsuariosPorSugerenciaJefeYColaborador($rut_jefe, $unicoSUB3->rut);
                    $row               = str_replace("{NUM_ACCIONES}", count($total_sugerencias), $row);
                    //SUB 4 busca colaboradores abajo de cada linea
                    if ($modalidad == "todos" OR $modalidad == "todoequipo" or $modalidad == "todoequipoExcel") {
                        $colaboradoresSUB4 = EsJefe($unicoSUB3->rut);
                    } else if ($modalidad == "lideres") {
                        $colaboradoresSUB4 = ListadoUsuariosLideres($unicoSUB3->rut);
                    }
                    $colaboradoresSUB4 = EsJefe($unicoSUB3->rut);
                    foreach ($colaboradoresSUB4 as $unicoSUB4) {
                        if ($modalidad == "lideres" and $unicoSUB4->total == 0 and $unicoSUB4->lider <> "1") {
                            continue;
                        }
                        $row .= $template_row;
                        $row = str_replace("{NOMBRE_COMPLETO}", " <span class=' pad_izquierda4'>" . $unicoSUB4->nombre_completo . "</span>", $row);
                        $row = str_replace("{RUT}", " <span class=' pad_izquierda4'>" . $unicoSUB4->rut_completo . "</span>", $row);
                        $row = str_replace("{EMAIL}", " <span class=' pad_izquierda4'>" . $unicoSUB4->email . "</span>", $row);
                        $row = str_replace("{RUT_JEFE}", " <span class=' pad_izquierda4'>" . $unicoSUB4->rut_jefe . "</span>", $row);
                        $row = str_replace("{NOMBRE_JEFE}", " <span class=' pad_izquierda4'>" . $unicoSUB4->nombre_jefe . "</span>", $row);
                        if ($unicoSUB4->total == 0) {
                            $row = str_replace("{PERFIL}", "", $row);
                        } else {
                            $row = str_replace("{PERFIL}", "<span class='fa fa-user-plus'>", $row);
                        }
                        if ($unicoSUB4->cargo) {
                            $row = str_replace("{CARGO}", $unicoSUB4->cargo, $row);
                        } else {
                            $row = str_replace("{CARGO}", "Sin Cargo", $row);
                        }
                        if ($unicoSUB4->gerencia) {
                            $row = str_replace("{GERENCIA}", $unicoSUB4->gerencia, $row);
                        } else {
                            $row = str_replace("{GERENCIA}", "Sin Gerencia", $row);
                        }
                        $total_sugerencias = UsuariosPorSugerenciaJefeYColaborador($rut_jefe, $unicoSUB4->rut);
                        $row               = str_replace("{NUM_ACCIONES}", count($total_sugerencias), $row);
                        //SUB 5 busca colaboradores abajo de cada linea
                        if ($modalidad == "todos" OR $modalidad == "todoequipo" or $modalidad == "todoequipoExcel") {
                            $colaboradoresSUB5 = EsJefe($unicoSUB4->rut);
                        } else if ($modalidad == "lideres") {
                            $colaboradoresSUB5 = ListadoUsuariosLideres($unicoSUB4->rut);
                        }
                        $colaboradoresSUB5 = EsJefe($unicoSUB4->rut);
                        foreach ($colaboradoresSUB5 as $unicoSUB5) {
                            if ($modalidad == "lideres" and $unicoSUB5->total == 0 and $unicoSUB5->lider <> "1") {
                                continue;
                            }
                            $row .= $template_row;
                            $row = str_replace("{NOMBRE_COMPLETO}", " <span class=' pad_izquierda5'>" . $unicoSUB5->nombre_completo . "</span>", $row);
                            $row = str_replace("{RUT}", " <span class=' pad_izquierda5'>" . $unicoSUB5->rut_completo . "</span>", $row);
                            $row = str_replace("{EMAIL}", " <span class=' pad_izquierda5'>" . $unicoSUB5->email . "</span>", $row);
                            $row = str_replace("{RUT_JEFE}", " <span class=' pad_izquierda5'>" . $unicoSUB5->rut_jefe . "</span>", $row);
                            $row = str_replace("{NOMBRE_JEFE}", " <span class=' pad_izquierda5'>" . $unicoSUB5->nombre_jefe . "</span>", $row);
                            if ($unicoSUB5->total == 0) {
                                $row = str_replace("{PERFIL}", "", $row);
                            } else {
                                $row = str_replace("{PERFIL}", "<span class='fa fa-user-plus'>", $row);
                            }
                            if ($unicoSUB5->cargo) {
                                $row = str_replace("{CARGO}", $unicoSUB5->cargo, $row);
                            } else {
                                $row = str_replace("{CARGO}", "Sin Cargo", $row);
                            }
                            if ($unicoSUB5->gerencia) {
                                $row = str_replace("{GERENCIA}", $unicoSUB5->gerencia, $row);
                            } else {
                                $row = str_replace("{GERENCIA}", "Sin Gerencia", $row);
                            }
                            $total_sugerencias = UsuariosPorSugerenciaJefeYColaborador($rut_jefe, $unicoSUB5->rut);
                            $row               = str_replace("{NUM_ACCIONES}", count($total_sugerencias), $row);
                        }
                    }
                }
            }
        }
    }
    if ($modalidad == "todoequipoExcel") {
        $PRINCIPAL = str_replace("{ROW_ENTORNO_EQUIPO}", ($row), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{ROW_ENTORNO_EQUIPO}", utf8_encode($row), $PRINCIPAL);
    }
    return ($PRINCIPAL);
}
function allSucursalesPorNombrePorEmpresa($buscar, $id_empresa)
{
    //$dataPersonas = allPersonasPorEmpresa($buscar, $id_empresa);
    $dataPersonas = allSucursalesPorEmpresa($buscar, $id_empresa);
    if ($dataPersonas) {
        foreach ($dataPersonas as $dataPersonas_aux) {
            echo utf8_encode($dataPersonas_aux->nombre) . " " . "|" . $dataPersonas_aux->id . "\n";
        }
    } else {
        $data = 'Sucursal inexistente';
    }
    return $data;
}
function allPersonasPorNombrePorEmpresa($buscar, $id_empresa, $rut)
{
    $datos_usuario = UsuarioEnBasePersonas($rut);
    //$dataPersonas = allPersonasPorEmpresa($buscar, $id_empresa);
    $dataPersonas  = allPersonasPorEmpresa($buscar, $id_empresa, $datos_usuario[0]->gerencia);
    if ($dataPersonas) {
        foreach ($dataPersonas as $dataPersonas_aux) {
            echo utf8_encode($dataPersonas_aux->nombre) . " " . utf8_encode($dataPersonas_aux->apaterno) . " " . utf8_encode($dataPersonas_aux->amaterno) . " " . "|" . $dataPersonas_aux->rut . "\n";
            //echo utf8_encode($dataPersonas_aux->nombre)."\n";
        }
    } else {
        $data = 'No Existe este nombre';
    }
    return $data;
}
function allPersonasPorNombrePorEmpresaMP($buscar, $id_empresa)
{
    //$dataPersonas = allPersonasPorEmpresa($buscar, $id_empresa);
    $dataPersonas = allPersonasPorEmpresaMP($buscar, $id_empresa);
    if ($dataPersonas) {
        foreach ($dataPersonas as $dataPersonas_aux) {
            echo utf8_encode($dataPersonas_aux->nombre) . " " . utf8_encode($dataPersonas_aux->apaterno) . " " . utf8_encode($dataPersonas_aux->amaterno) . " " . "|" . $dataPersonas_aux->rut . "\n";
            //echo utf8_encode($dataPersonas_aux->nombre)."\n";
        }
    } else {
        $data = 'No Existe este nombre, intenta nuevamente';
    }
    return $data;
}
function allArchivosBibliotecaPorEmpresaMP($buscar, $id_empresa)
{
    //$dataPersonas = allPersonasPorEmpresa($buscar, $id_empresa);
    $dataArchivos = allArchivosBibliotecaPorEmpresaMPDATA($buscar, $id_empresa);
    if ($dataArchivos) {
        foreach ($dataArchivos as $dataArchivo) {
            echo utf8_encode($dataArchivo->titulo) . " [" . utf8_encode($dataArchivo->NombreSubCat) . "]\n";
            //$data=$dataArchivo;
        }
    } else {
        $data = 'No Existen archivos con este nombre, intenta nuevamente';
    }
    return $data;
}
function allPersonasPorNombrePorEmpresaMP_GOPLAY($buscar, $id_empresa)
{
    //$dataPersonas = allPersonasPorEmpresa($buscar, $id_empresa);
    $dataPersonas = allPersonasPorEmpresaMP_GOPLAY($buscar, $id_empresa);
    if ($dataPersonas) {
        foreach ($dataPersonas as $dataPersonas_aux) {
            echo utf8_encode($dataPersonas_aux->nombre) . " " . utf8_encode($dataPersonas_aux->apaterno) . " " . utf8_encode($dataPersonas_aux->amaterno) . " " . "|" . $dataPersonas_aux->rut . "\n";
            //echo utf8_encode($dataPersonas_aux->nombre)."\n";
        }
    } else {
        $data = 'No Existe este nombre, intenta nuevamente';
    }
    return $data;
}
function allPersonasPorNombre($buscar)
{
    $dataPersonas = allPersonas($buscar);
    if ($dataPersonas) {
        foreach ($dataPersonas as $dataPersonas_aux) {
            echo utf8_encode($dataPersonas_aux->nombre_completo) . "|" . $dataPersonas_aux->rut . "\n";
        }
    } else {
        $data = 'No Existe este nombre';
    }
    return $data;
}

function DecodearConRut($valor)
{
    $arreglo    = explode("$", $valor);
    $arreglo[0] = Decodear3($arreglo[0]);
    $arreglo[1] = Decodear3($arreglo[1]);
    $arreglo[2] = Decodear3($arreglo[2]);
    $arreglo[3] = Decodear3($arreglo[3]);
    return ($arreglo);
}
function EncodearConRut($rut, $fecha_y_hora, $id_inscripcion)
{
    $datos_usuario = UsuarioEnBasePersonasCruceEmpresa2($rut);
    $id_empresa    = $datos_usuario[0]->idempresa;
    $tokem         = $datos_usuario[0]->tokem_validacion_externo;
    $valor         = Encodear3($rut) . "$" . Encodear3($tokem) . "$" . Encodear3($fecha_y_hora) . "$" . Encodear3($id_inscripcion);
    return ($valor);
}
function ColocaBotoneraDNC($html, $valor)
{
    //Seccion para colocar la botonera 1
    $rut  = $_SESSION["user_"];
    $html = str_replace("{BOTONERA_SUPERIOR_DNC}", file_get_contents("views/dnc/botonera_superior_dnc.html"), $html);
    if ($valor == 1) {
        $html = str_replace("{PESTANA1}", "active", $html);
        $html = str_replace("{PESTANA2}", "pasive", $html);
        $html = str_replace("{PESTANA3}", "pasive", $html);
        $html = str_replace("{PESTANA4}", "pasive", $html);
    } else if ($valor == 2) {
        $html = str_replace("{PESTANA1}", "pasive", $html);
        $html = str_replace("{PESTANA2}", "active", $html);
        $html = str_replace("{PESTANA3}", "pasive", $html);
        $html = str_replace("{PESTANA4}", "pasive", $html);
    } else if ($valor == 3) {
        $html = str_replace("{PESTANA1}", "pasive", $html);
        $html = str_replace("{PESTANA2}", "pasive", $html);
        $html = str_replace("{PESTANA3}", "active", $html);
        $html = str_replace("{PESTANA4}", "pasive", $html);
    } else if ($valor == 4) {
        $html = str_replace("{PESTANA1}", "pasive", $html);
        $html = str_replace("{PESTANA2}", "pasive", $html);
        $html = str_replace("{PESTANA3}", "pasive", $html);
        $html = str_replace("{PESTANA4}", "active", $html);
    }
    return ($html);
}
function PersonasIanctivasTemporalmente($PRINCIPAL, $evaluador)
{
    $personas_inactivas = TienePersonasInactivas($evaluador);
    if ($personas_inactivas) {
        $PRINCIPAL = str_replace("{BLOQUE_PERSONA_INACTIVAS}", file_get_contents("views/sgd/entorno_inactivos.html"), $PRINCIPAL);
        foreach ($personas_inactivas as $unico) {
            $row .= file_get_contents("views/sgd/row_colaboradores_inactivos.html");
            $row = ColocaDatosUsuario($row, $unico->evaluado);
        }
        $PRINCIPAL = str_replace("{LISTADO_EVALUADOS}", $row, $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BLOQUE_PERSONA_INACTIVAS}", "", $PRINCIPAL);
    }
    return ($PRINCIPAL);
}
function ObtenerDatosAvancesPorEvaluador($evaluador)
{
    $evaluados                    = EvaluadosDadoEvaluadorConDatosDeEvaluado($evaluador);
    $finalizado_individual_cont   = 0;
    $finalizado_validaciones_cont = 0;
    $finalizado_ajustes_cont      = 0;
    foreach ($evaluados as $eval) {
        $finalizado_individual = VerificaFinalizadoObjetivosIndividuales($eval->evaluado);
        if ($finalizado_individual)
            $finalizado_individual_cont++;
        $finalizado_ajustes = VerificaSiObjetivosEstanAjustados($eval->evaluado);
        if ($finalizado_ajustes)
            $finalizado_ajustes_cont++;
        $finalizado_validaciones = VerificaSiObjetivosEstanValidados($eval->evaluado);
        if ($finalizado_validaciones)
            $finalizado_validaciones_cont++;
    }
    //porcentaje proposicion Evaluados
    $arreglo[0] = number_format(($finalizado_individual_cont * 100) / count($evaluados), 0);
    //Porcentaje de finalizados ajustes
    $arreglo[1] = number_format(($finalizado_ajustes_cont * 100) / count($evaluados), 0);
    //Porcentaje de Validados
    $arreglo[2] = number_format(($finalizado_validaciones_cont * 100) / count($evaluados), 0);
    return ($arreglo);
}
function ColocaAvancesMiPerfil($PRINCIPAL, $evaluado)
{
    $finalizado_individual = VerificaFinalizadoObjetivosIndividuales($evaluado);
    if ($finalizado_individual) {
        $PRINCIPAL = str_replace("{POR_1}", "100%", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ICO_1}", '<span class="fa fa-check text-iconos fs14 mr10"></span>', $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{POR_1}", "0%", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ICO_1}", '<span class="fa fa-circle-thin text-iconos fs14 mr10"></span>', $PRINCIPAL);
    }
    $finalizado_ajustes = VerificaSiObjetivosEstanAjustados($evaluado);
    if ($finalizado_ajustes) {
        $PRINCIPAL = str_replace("{POR_2}", "100%", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ICO_2}", '<span class="fa fa-check text-iconos fs14 mr10"></span>', $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{POR_2}", "0%", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ICO_2}", '<span class="fa fa-circle-thin text-iconos fs14 mr10"></span>', $PRINCIPAL);
    }
    $finalizado_validaciones = VerificaSiObjetivosEstanValidados($evaluado);
    if ($finalizado_validaciones) {
        $PRINCIPAL = str_replace("{POR_3}", "100%", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ICO_3}", '<span class="fa fa-check text-iconos fs14 mr10"></span>', $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{POR_3}", "0%", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ICO_3}", '<span class="fa fa-circle-thin text-iconos fs14 mr10"></span>', $PRINCIPAL);
    }
    $finalizado_Feedback = TomoConocimientoEvaluado($evaluado);
    if ($finalizado_Feedback) {
        $PRINCIPAL = str_replace("{POR_4}", "100%", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ICO_4}", '<span class="fa fa-check text-iconos fs14 mr10"></span>', $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{POR_4}", "0%", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ICO_4}", '<span class="fa fa-circle-thin text-iconos fs14 mr10"></span>', $PRINCIPAL);
    }
    return ($PRINCIPAL);
}
function ColocaAvancesPorEvaluadorParaPestanaMisValidaciones($PRINCIPAL, $evaluador)
{
    //$evaluados=EvaluadosDadoEvaluadorConDatosDeEvaluado($evaluador);
    //$evaluados=EvaluadosDadoEvaluadorConDatosDeEvaluadoSinAe($evaluador);
    $evaluados                    = EvaluadosDadoEvaluadorConDatosDeEvaluadoSinAeParaPestanaMisValidaciones($evaluador);
    $finalizado_individual_cont   = 0;
    $finalizado_validaciones_cont = 0;
    $finalizado_ajustes_cont      = 0;
    $finalizado_feedback          = 0;
    $finalizado_feedback_cont     = 0;
    foreach ($evaluados as $eval) {
        $finalizado_individual = VerificaFinalizadoObjetivosIndividuales($eval->evaluado);
        if ($finalizado_individual)
            $finalizado_individual_cont++;
        $finalizado_ajustes = VerificaSiObjetivosEstanAjustados($eval->evaluado);
        if ($finalizado_ajustes)
            $finalizado_ajustes_cont++;
        $finalizado_validaciones = VerificaSiObjetivosEstanValidados($eval->evaluado);
        if ($finalizado_validaciones)
            $finalizado_validaciones_cont++;
        $finalizado_feedback = TomoConocimientoEvaluado($eval->evaluado);
        if ($finalizado_feedback)
            $finalizado_feedback_cont++;
    }
    $PRINCIPAL = str_replace("{POR_1}", number_format(($finalizado_individual_cont * 100) / count($evaluados), 0) . "%", $PRINCIPAL);
    if (number_format(($finalizado_individual_cont * 100) / count($evaluados), 0) == 100) {
        $PRINCIPAL = str_replace("{ICO_1}", '<span class="fa fa-check text-iconos fs14 mr10"></span>', $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{ICO_1}", '<span class="fa fa-circle-thin text-iconos fs14 mr10"></span>', $PRINCIPAL);
    }
    $PRINCIPAL = str_replace("{POR_2}", number_format(($finalizado_ajustes_cont * 100) / count($evaluados), 0) . "%", $PRINCIPAL);
    if (number_format(($finalizado_ajustes_cont * 100) / count($evaluados), 0) == 100) {
        $PRINCIPAL = str_replace("{ICO_2}", '<span class="fa fa-check text-iconos fs14 mr10"></span>', $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{ICO_2}", '<span class="fa fa-circle-thin text-iconos fs14 mr10"></span>', $PRINCIPAL);
    }
    $PRINCIPAL = str_replace("{POR_3}", number_format(($finalizado_validaciones_cont * 100) / count($evaluados), 0) . "%", $PRINCIPAL);
    if (number_format(($finalizado_validaciones_cont * 100) / count($evaluados), 0) == 100) {
        $PRINCIPAL = str_replace("{ICO_3}", '<span class="fa fa-check text-iconos fs14 mr10"></span>', $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{ICO_3}", '<span class="fa fa-circle-thin text-iconos fs14 mr10"></span>', $PRINCIPAL);
    }
    $PRINCIPAL = str_replace("{POR_4}", number_format(($finalizado_feedback_cont * 100) / count($evaluados), 0) . "%", $PRINCIPAL);
    if (number_format(($finalizado_feedback_cont * 100) / count($evaluados), 0) == 100) {
        $PRINCIPAL = str_replace("{ICO_4}", '<span class="fa fa-check text-iconos fs14 mr10"></span>', $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{ICO_4}", '<span class="fa fa-circle-thin text-iconos fs14 mr10"></span>', $PRINCIPAL);
    }
    return ($PRINCIPAL);
}
function ColocaAvancesPorEvaluador($PRINCIPAL, $evaluador, $id_proceso, $id_empresa, $desde_admin)
{
    //la variable desde_admin, es para cuando se llama desde el admin
    //$evaluados=EvaluadosDadoEvaluadorConDatosDeEvaluado($evaluador);
    //$evaluados=EvaluadosDadoEvaluadorConDatosDeEvaluadoSinAe($evaluador);
    $evaluados                    = EvaluadosDadoEvaluadorConDatosDeEvaluadoSinAePorProceso($evaluador, $id_proceso);
    $finalizado_individual_cont   = 0;
    $finalizado_validaciones_cont = 0;
    $finalizado_ajustes_cont      = 0;
    $finalizado_feedback          = 0;
    $finalizado_feedback_cont     = 0;
    //cantidad de textos por bitacora por evaluador
    $cantidad                     = CantidadBitacorasPorEvaluador($evaluador);
    foreach ($evaluados as $eval) {
        $finalizado_individual = VerificaFinalizadoObjetivosIndividuales($eval->evaluado);
        if ($finalizado_individual)
            $finalizado_individual_cont++;
        $finalizado_ajustes = VerificaSiObjetivosEstanAjustados($eval->evaluado);
        if ($finalizado_ajustes)
            $finalizado_ajustes_cont++;
        $finalizado_validaciones = VerificaSiObjetivosEstanValidados($eval->evaluado);
        if ($finalizado_validaciones)
            $finalizado_validaciones_cont++;
        $finalizado_feedback = TomoConocimientoEvaluado($eval->evaluado);
        if ($finalizado_feedback)
            $finalizado_feedback_cont++;
        $finalizado_ciclo_medio_1 = EstaFinalizadoEpata1($eval->evaluado, 42, 22);
        if ($finalizado_ciclo_medio_1)
            $finalizado_ciclo_1++;
        if ($finalizado_ciclo_medio_1[0]->comentario_evaluado && $finalizado_ciclo_medio_1[0]->comentario_evaluador) {
            $finalizado_ciclo_2++;
        }
    }
    $PRINCIPAL = str_replace("{POR_AVANCE_MEDIO_CICLO_1}", number_format(($finalizado_ciclo_1 * 100) / count($evaluados), 0) . "%", $PRINCIPAL);
    if (number_format(($finalizado_ciclo_1 * 100) / count($evaluados), 0) == 100) {
        $PRINCIPAL = str_replace("{ICO_AVANCE_MEDIO_CICLO_1}", '<span class="fa fa-check text-iconos fs14 mr10"></span>', $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{ICO_AVANCE_MEDIO_CICLO_1}", '<span class="fa fa-circle-thin text-iconos fs14 mr10"></span>', $PRINCIPAL);
    }
    $PRINCIPAL = str_replace("{POR_AVANCE_MEDIO_CICLO_2}", number_format(($finalizado_ciclo_2 * 100) / count($evaluados), 0) . "%", $PRINCIPAL);
    if (number_format(($finalizado_ciclo_2 * 100) / count($evaluados), 0) == 100) {
        $PRINCIPAL = str_replace("{ICO_AVANCE_MEDIO_CICLO_2}", '<span class="fa fa-check text-iconos fs14 mr10"></span>', $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{ICO_AVANCE_MEDIO_CICLO_2}", '<span class="fa fa-circle-thin text-iconos fs14 mr10"></span>', $PRINCIPAL);
    }
    $PRINCIPAL  = str_replace("{POR_1}", number_format(($finalizado_individual_cont * 100) / count($evaluados), 0) . "%", $PRINCIPAL);
    $arreglo[0] = number_format(($finalizado_individual_cont * 100) / count($evaluados), 0);
    if (number_format(($finalizado_individual_cont * 100) / count($evaluados), 0) == 100) {
        $PRINCIPAL = str_replace("{ICO_1}", '<span class="fa fa-check text-iconos fs14 mr10"></span>', $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{ICO_1}", '<span class="fa fa-circle-thin text-iconos fs14 mr10"></span>', $PRINCIPAL);
    }
    $PRINCIPAL = str_replace("{POR_2}", number_format(($finalizado_ajustes_cont * 100) / count($evaluados), 0) . "%", $PRINCIPAL);
    if (number_format(($finalizado_ajustes_cont * 100) / count($evaluados), 0) == 100) {
        $PRINCIPAL = str_replace("{ICO_2}", '<span class="fa fa-check text-iconos fs14 mr10"></span>', $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{ICO_2}", '<span class="fa fa-circle-thin text-iconos fs14 mr10"></span>', $PRINCIPAL);
    }
    $arreglo[1] = number_format(($finalizado_validaciones_cont * 100) / count($evaluados), 0);
    $PRINCIPAL  = str_replace("{POR_3}", number_format(($finalizado_validaciones_cont * 100) / count($evaluados), 0) . "%", $PRINCIPAL);
    if (number_format(($finalizado_validaciones_cont * 100) / count($evaluados), 0) == 100) {
        $PRINCIPAL = str_replace("{ICO_3}", '<span class="fa fa-check text-iconos fs14 mr10"></span>', $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{ICO_3}", '<span class="fa fa-circle-thin text-iconos fs14 mr10"></span>', $PRINCIPAL);
    }
    $PRINCIPAL = str_replace("{POR_4}", number_format(($finalizado_feedback_cont * 100) / count($evaluados), 0) . "%", $PRINCIPAL);
    if (number_format(($finalizado_feedback_cont * 100) / count($evaluados), 0) == 100) {
        $PRINCIPAL = str_replace("{ICO_4}", '<span class="fa fa-check text-iconos fs14 mr10"></span>', $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{ICO_4}", '<span class="fa fa-circle-thin text-iconos fs14 mr10"></span>', $PRINCIPAL);
    }
    $total_descargas = OBJETIVOS_InformesDescargadosPorEvaluadorProcesoEmpresa($evaluador, $id_proceso, $id_empresa);
    $PRINCIPAL       = str_replace("{AVANCE_DESCARGA_INFORMES}", number_format((count($total_descargas) * 100) / count($evaluados), 0) . "%", $PRINCIPAL);
    $arreglo[2]      = number_format((count($total_descargas) * 100) / count($evaluados), 0);
    if (number_format((count($total_descargas) * 100) / count($evaluados), 0) == 100) {
        $PRINCIPAL = str_replace("{ICO_AVANCE_DESCARGA_INFORMES}", '<span class="fa fa-check text-iconos fs14 mr10"></span>', $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{ICO_AVANCE_DESCARGA_INFORMES}", '<span class="fa fa-circle-thin text-iconos fs14 mr10"></span>', $PRINCIPAL);
    }
    $total_descargas             = OBJETIVOS_InformesDescargadosPorEvaluadorProcesoEmpresa($evaluador, $id_proceso, $id_empresa);
    $PRINCIPAL                   = str_replace("{CANTIDAD}", count($cantidad), $PRINCIPAL);
    //PROMEDIO AVANCE EVALUADOR
    $promedio_avance_fijacion    = ((($finalizado_individual_cont * 100) / count($evaluados)) + (($finalizado_validaciones_cont * 100) / count($evaluados)) + ((count($total_descargas) * 100) / count($evaluados))) / 3;
    $PRINCIPAL                   = str_replace("{AVANCE_TOTAL_FIJACION}", number_format($promedio_avance_fijacion, 0) . "%", $PRINCIPAL);
    //Promedio Avance Medio ciclo
    $promedio_avance_medio_ciclo = ((($finalizado_ciclo_1 * 100) / count($evaluados)) + (($finalizado_ciclo_2 * 100) / count($evaluados))) / 2;
    $PRINCIPAL                   = str_replace("{AVANCE_TOTAL_MEDIO_CICLO}", number_format($promedio_avance_medio_ciclo, 0) . "%", $PRINCIPAL);
    if ($desde_admin == "admin") {
        $arreglo[3] = $PRINCIPAL;
        $arreglo[4] = number_format($promedio_avance_fijacion, 0);
        $arreglo[5] = number_format($promedio_avance_medio_ciclo, 0);
        return ($arreglo);
    } else {
        return ($PRINCIPAL);
    }
}
function ObtenerRutaEvaluadoEvaluador($rut)
{
    $i               = 1;
    $datos_evaluador = UsuarioEnBasePersonas($rut);
    $ruta            = "<span class='DatosPersona'>" . $datos_evaluador[0]->nombre_completo . "</span>";
    while ($i == 1) {
        //obtengo el evaluador de la variable $rut
        $evaluador = ObtenerJefeRel2($rut);
        if ($evaluador) {
            $ruta .= " - <span class='DatosPersona'>" . $evaluador[0]->nombre_completo . "</span>";
            $rut = $evaluador[0]->rut;
        } else {
            $i = 2;
        }
    }
    return ($ruta);
}
function PorcentajeEvaluacion($evaluado, $evaluador)
{
    $finalizado = FinalizadoEvaluadoEvaluador($evaluado, $evaluador);
    if ($finalizado) {
        $porcentaje = "25";
    } else {
        $porcentaje = "0";
    }
    return ($porcentaje);
}
function CalculaNotaFinal($pond1, $pond2, $valor1, $valor2)
{
    if ($valor1 > 0 and $valor2 == 0) {
        $nota_final = $valor1;
    }
    if ($valor2 > 0 and $valor1 == 0) {
        $nota_final = $valor2;
    }
    if ($valor2 > 0 and $valor1 > 0) {
        $nota_final = (($pond1 / ($pond1 + $pond2)) * $valor1) + (($pond2 / ($pond1 + $pond2)) * $valor2);
    }
    //echo "<br>$pond1, $pond2, $valor1, $valor2 = $nota_final";
    return ($nota_final);
}
function ObtieneNotaObjetivos($evaluado, $evaluador, $id_proceso, $id_dimension)
{
    //echo $evaluado;
    //$objetivos=ObjetivosEspecificosConRespuesta($evaluado);
    //echo "$evaluado $evaluador $id_proceso $id_dimension";
    //echo "<br>";
    if ($id_dimension) {
        $objetivos  = ObjetivosEspecificosConRespuestaEvaluadoEvaluadorProcesoPorDimension($evaluado, $evaluador, $id_proceso, $id_dimension);
        $pond_total = $objetivos[0]->suma_ponderaciones_por_dimension;
    } else {
        $objetivos = ObjetivosEspecificosConRespuestaEvaluadoEvaluadorProceso($evaluado, $evaluador, $id_proceso);
        if ($_SESSION["id_empresa"] == 11 or $_SESSION["id_empresa"] == 30) {
            $pond_total = 30;
        } else {
            $pond_total = 100;
        }
    }
    $i = 0;
    foreach ($objetivos as $ob) {
        if ($ob->respuesta <> 0) {
            //if($_SESSION["id_empresa"]==11){
            $acumulador                 = $acumulador + (($ob->puntaje * $ob->ponderacion) / $pond_total);
            $acumulador_promedio_simple = $acumulador_promedio_simple + $ob->puntaje;
            $i++;
        }
    }
    $acumulador = $acumulador_promedio_simple / $i;
    return ($acumulador);
}
function ObtieneNotaObjetivosPorDimension($evaluado, $evaluador, $id_proceso, $id_dimension)
{
    $objetivos  = ObjetivosEspecificosConRespuestaEvaluadoEvaluadorProcesoPorDimensionSinTablaRespuesta($evaluado, $evaluador, $id_proceso, $id_dimension);
    $pond_total = $objetivos[0]->ponderacion_dimension;
    $i          = 1;
    foreach ($objetivos as $ob) {
        $i++;
        //$acumulador=$acumulador+(($ob->puntaje*$ob->ponderacion)/$pond_total);
        $acumulador = $acumulador + $ob->puntaje;
    }
    $acumulador = $acumulador / count($objetivos);
    return ($acumulador);
}
function ColocaResultadosTablaReumen($html, $evaluado, $evaluador, $id_proceso, $id_etapa_evaluacion, $id_proceso_desde_admin)
{
    //echo "<br>$evaluado, $evaluador, $id_proceso, $id_etapa_evaluacion<br>";
    $datos_eval_jefe = ObtenerJefeRelPorProceso($evaluado, $id_proceso);
    if ($evaluado == $evaluador) {
        //Traigo los datos de la Eval descendente
        //$datos_eval_jefe=ObtenerJefeRelPorProceso($evaluado, $id_proceso);
        //$evaluador=$datos_eval_jefe[0]->evaluador;
    }
    $datos_resumen                 = ResultadosFinales($evaluado, $evaluador, $id_proceso, $id_etapa_evaluacion);
    //echo "<pre>";
    //print_r($datos_resumen);
    $datos_proceso                 = TraeProcesosDeEvaluacionPorEmpresaYDiProceso($_SESSION["id_empresa"], $id_proceso);
    $decimales_para_reportes       = $datos_proceso[0]->decimales_puntajes;
    $rut_calibrador                = $datos_eval_jefe[0]->calibrador;
    //print_r($datos_resumen);
    //$nota_objetivo=ObtieneNotaObjetivos($evaluado, $evaluador, $id_proceso, "");
    //echo "$evaluado $evaluador $nota_objetivo <br><br><br>";
    //Verifico si esta evaluacion está finalizada. Si es si, coloca el boton de ver informe, si no, Ver informe desactivado
    $finalizado_evaluado_evaluador = FinalizadoEvaluadoEvaluador($evaluado, $evaluador, $id_proceso);
    if ($finalizado_evaluado_evaluador) {
        $html = str_replace("{BOTON_VE_INFORME}", file_get_contents("views/sgd/informe/boton_ve_informe.html"), $html);
        $html = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($evaluado), $html);
        $html = str_replace("{ID_PROCESO_ENCODEADO}", Encodear3($id_proceso), $html);
    } else {
        $html = str_replace("{BOTON_VE_INFORME}", file_get_contents("views/sgd/informe/boton_ve_informe_inac.html"), $html);
    }
    //BOJETIVOS INDIVIDUALES
    //if($datos_resumen[1]){f
    //EL IF Es para cuando está finalizada la evaluacion
    //if($datos_resumen[41]=="si"){
    if ($_SESSION["id_empresa"] <> 28) {
        if ($_SESSION["id_empresa"] == 43 or $_SESSION["id_empresa"] == 11 or $_SESSION["id_empresa"] == 41 or $_SESSION["id_empresa"] == 66) {
            //Este if se coloca para cuando tiene nota.
            if ($datos_resumen[31] or $_SESSION["id_empresa"] == 43) {
                //$html = str_replace("{RES_OBJ_IND}","<span class='etiquetaSGD  ".$datos_resumen[0]."'>".$datos_resumen[1]."</span>",$html);
                $html = str_replace("{ESTILO_OBJ_ESP_INT}", $datos_resumen[0], $html);
                $html = str_replace("{CRITERIO_OBJ_ESP_INT}", $datos_resumen[1], $html);
                //$html = str_replace("{NOTA_OBJ_ESP_INT}",round($datos_resumen[31])."% - ".round($datos_resumen[18])."%",$html);
                if ($_SESSION["id_empresa"] == 41) {
                    $html = str_replace("{NOTA_OBJ_ESP_INT}", ColocaDecimalesNotasFinales($decimales_para_reportes, $datos_resumen[31], "") . "", $html);
                } else {
                    //$html = str_replace("{NOTA_OBJ_ESP_INT}",round($datos_resumen[31])."%",$html);
                    $html = str_replace("{NOTA_OBJ_ESP_INT}", ColocaDecimalesNotasFinales(2, $datos_resumen[31], "") . "", $html);
                }
                $html = str_replace("{ICONO_OBJ_ESP_INT}", $datos_resumen[24], $html);
            } else {
                //$html = str_replace("{RES_OBJ_IND}","<span class='etiquetaSGD  etiquetaPrograma-pendiente'>Pendiente</span>",$html);
                $html = str_replace("{ESTILO_OBJ_ESP_INT}", "etiquetaPrograma-pendiente", $html);
                $html = str_replace("{CRITERIO_OBJ_ESP_INT}", "Pendiente", $html);
                $html = str_replace("{NOTA_OBJ_ESP_INT}", "", $html);
                $html = str_replace("{ICONO_OBJ_ESP_INT}", "", $html);
            }
        } else {
            //EL IF Es para cuando está finalizada la evaluacion
            if ($datos_resumen[41] == "si") {
                //$html = str_replace("{RES_OBJ_IND}","<span class='etiquetaSGD  ".$datos_resumen[0]."'>".$datos_resumen[1]."</span>",$html);
                $html = str_replace("{ESTILO_OBJ_ESP_INT}", $datos_resumen[0], $html);
                $html = str_replace("{CRITERIO_OBJ_ESP_INT}", $datos_resumen[1], $html);
                //$html = str_replace("{NOTA_OBJ_ESP_INT}",round($datos_resumen[31])."% - ".round($datos_resumen[18])."%",$html);
                $html = str_replace("{NOTA_OBJ_ESP_INT}", round($datos_resumen[31]) . "%", $html);
                $html = str_replace("{ICONO_OBJ_ESP_INT}", $datos_resumen[24], $html);
            } else {
                //$html = str_replace("{RES_OBJ_IND}","<span class='etiquetaSGD  etiquetaPrograma-pendiente'>Pendiente</span>",$html);
                $html = str_replace("{ESTILO_OBJ_ESP_INT}", "etiquetaPrograma-pendiente", $html);
                $html = str_replace("{CRITERIO_OBJ_ESP_INT}", "Pendiente", $html);
                $html = str_replace("{NOTA_OBJ_ESP_INT}", "", $html);
                $html = str_replace("{ICONO_OBJ_ESP_INT}", "", $html);
            }
        }
    }
    //COMPETENCIAS
    //if($datos_resumen[32]>0){
    if ($datos_resumen[41] == "si" or $evaluado <> $evaluador) {
        //$html = str_replace("{RES_COMP}","<span class='etiquetaSGD  ".$datos_resumen[2]."'>".$datos_resumen[3]."</span>",$html);
        //Para cuando es Chilquinta, veo si el rut de la sesion, es igual o distinto al evaluador
        //Si es distinto, lo muestro no mas
        //
        if ($_SESSION["id_empresa"] == 28) {
            if ($_SESSION["user_"] == $evaluador or $id_proceso_desde_admin) {
                $html = str_replace("{ESTILO_COMP_ESPE_INT}", $datos_resumen[2], $html);
                $html = str_replace("{CRITERIO_COMP_ESPE_INT}", $datos_resumen[3], $html);
                //$html = str_replace("{NOTA_COMP_ESPE_INT}",round($datos_resumen[32])."% - ".round($datos_resumen[19])."%",$html);
                //$html = str_replace("{NOTA_COMP_ESPE_INT}",ColocaDecimalesNotasFinales($decimales_para_reportes, $datos_resumen[32], "")."%",$html);
                $html = str_replace("{NOTA_COMP_ESPE_INT}", ColocaDecimalesNotasFinales($decimales_para_reportes, $datos_resumen[32], "") . "", $html);
                $html = str_replace("{ICONO_COMP_ESPE_INT}", $datos_resumen[25], $html);
            } else {
                //Veo si está liberado para el evaluado-evaluador-proceso
                $informe_liberado = TraeLiberadoEvaluadoEvaluadorProceso($evaluado, $evaluador, $id_proceso);
                if ($informe_liberado or $_SESSION["user_"] == $rut_calibrador) {
                    $html = str_replace("{ESTILO_COMP_ESPE_INT}", $datos_resumen[2], $html);
                    $html = str_replace("{CRITERIO_COMP_ESPE_INT}", $datos_resumen[3], $html);
                    //$html = str_replace("{NOTA_COMP_ESPE_INT}",round($datos_resumen[32])."% - ".round($datos_resumen[19])."%",$html);
                    //$html = str_replace("{NOTA_COMP_ESPE_INT}",ColocaDecimalesNotasFinales($decimales_para_reportes, $datos_resumen[32], "")."%",$html);
                    $html = str_replace("{NOTA_COMP_ESPE_INT}", ColocaDecimalesNotasFinales($decimales_para_reportes, $datos_resumen[32], "") . "", $html);
                    $html = str_replace("{ICONO_COMP_ESPE_INT}", $datos_resumen[25], $html);
                } else {
                    $html = str_replace("{ESTILO_COMP_ESPE_INT}", "etiquetaPrograma-pendiente", $html);
                    $html = str_replace("{CRITERIO_COMP_ESPE_INT}", "Pendiente", $html);
                    $html = str_replace("{NOTA_COMP_ESPE_INT}", "", $html);
                    $html = str_replace("{ICONO_COMP_ESPE_INT}", "", $html);
                }
            }
        } else {
            $html = str_replace("{ESTILO_COMP_ESPE_INT}", $datos_resumen[2], $html);
            $html = str_replace("{CRITERIO_COMP_ESPE_INT}", $datos_resumen[3], $html);
            //$html = str_replace("{NOTA_COMP_ESPE_INT}",round($datos_resumen[32])."% - ".round($datos_resumen[19])."%",$html);
            //$html = str_replace("{NOTA_COMP_ESPE_INT}",ColocaDecimalesNotasFinales($decimales_para_reportes, $datos_resumen[32], "")."%",$html);
            $html = str_replace("{NOTA_COMP_ESPE_INT}", ColocaDecimalesNotasFinales($decimales_para_reportes, $datos_resumen[32], "") . "", $html);
            $html = str_replace("{ICONO_COMP_ESPE_INT}", $datos_resumen[25], $html);
        }
    } else {
        $html = str_replace("{ESTILO_COMP_ESPE_INT}", "etiquetaPrograma-pendiente", $html);
        $html = str_replace("{CRITERIO_COMP_ESPE_INT}", "Pendiente", $html);
        $html = str_replace("{NOTA_COMP_ESPE_INT}", "", $html);
        $html = str_replace("{ICONO_COMP_ESPE_INT}", "", $html);
    }
    if ($id_empresa <> 28) {
        //if($datos_resumen[6]){
        if ($datos_resumen[41] == "si") {
            $html = str_replace("{NOTA_OBJ_COMP}", round($datos_resumen[6]) . "", $html);
            $html = str_replace("{CRITERIO_OBJ_ESP}", $datos_resumen[7], $html);
            $html = str_replace("{ICONO_COMP_ESPE}", $datos_resumen[9], $html);
            $html = str_replace("{ESTILO_COMP_ESPE}", $datos_resumen[8], $html);
        } else {
            $html = str_replace("{NOTA_OBJ_COMP}", "", $html);
            $html = str_replace("{CRITERIO_OBJ_ESP}", "Pendiente", $html);
            $html = str_replace("{ICONO_COMP_ESPE}", "", $html);
            $html = str_replace("{ESTILO_COMP_ESPE}", "etiquetaPrograma-pendiente", $html);
        }
        //    $html = str_replace("{ICONO_COMP_ESPE}",$datos_resumen[9],$html);
        //    $html = str_replace("{ESTILO_COMP_ESPE}",$datos_resumen[8],$html);
        //AREA//
        if ($datos_resumen[33] > 0) {
            $html = str_replace("{ESTILO_AREA_INT}", $datos_resumen[11], $html);
            $html = str_replace("{CRITERIO_AREA_INT}", $datos_resumen[10], $html);
            //$html = str_replace("{NOTA_AREA_INT}",round($datos_resumen[33])."% - ".round($datos_resumen[13])."%",$html);
            $html = str_replace("{NOTA_AREA_INT}", round($datos_resumen[33]), $html);
            $html = str_replace("{ICONO_AREA_INT}", $datos_resumen[12], $html);
        } else {
            $html = str_replace("{ESTILO_AREA_INT}", "etiquetaPrograma-pendiente", $html);
            $html = str_replace("{CRITERIO_AREA_INT}", "Pendiente", $html);
            $html = str_replace("{NOTA_AREA_INT}", "", $html);
            $html = str_replace("{ICONO_AREA_INT}", "", $html);
        }
        //EMPRESA - COORPORATIVOS
        if ($datos_resumen[34] > 0) {
            $html = str_replace("{ESTILO_CORP_INT}", $datos_resumen[15], $html);
            $html = str_replace("{CRITERIO_CORP_INT}", $datos_resumen[14], $html);
            //$html = str_replace("{NOTA_CORP_INT}",round($datos_resumen[34])."% - ".round($datos_resumen[17])."%",$html);
            $html = str_replace("{NOTA_CORP_INT}", round($datos_resumen[34]) . "", $html);
            $html = str_replace("{ICONO_CORP_INT}", $datos_resumen[16], $html);
        } else {
            $html = str_replace("{ESTILO_CORP_INT}", "etiquetaPrograma-pendiente", $html);
            $html = str_replace("{CRITERIO_CORP_INT}", "Pendiente", $html);
            $html = str_replace("{NOTA_CORP_INT}", "", $html);
            $html = str_replace("{ICONO_CORP_INT}", "", $html);
        }
        if ($datos_resumen[20]) {
            $html = str_replace("{CRITERIO_CORP_AREA}", $datos_resumen[21], $html);
            $html = str_replace("{ESTILO_CORP_AREA}", $datos_resumen[22], $html);
            $html = str_replace("{NOTA_CORP_AREA}", round($datos_resumen[20]) . "", $html);
            $html = str_replace("{ICONO_CORP_AREA}", $datos_resumen[23], $html);
        } else {
            $html = str_replace("{CRITERIO_CORP_AREA}", "etiquetaPrograma-pendiente", $html);
            $html = str_replace("{ESTILO_CORP_AREA}", "Pendiente", $html);
            $html = str_replace("{NOTA_CORP_AREA}", "", $html);
            $html = str_replace("{ICONO_CORP_AREA}", "", $html);
        }
        $html = str_replace("{ESTILO_COMP_ESPE_FINAL}", "etiquetaPrograma-pendiente", $html);
        $html = str_replace("{CRITERIO_COMP_ESPE_FINAL}", "Pendiente", $html);
        $html = str_replace("{NOTA_COMP_ESPE_FINAL}", "", $html);
        $html = str_replace("{ESTILO_OBJ_ESP_FINAL}", "etiquetaPrograma-pendiente", $html);
        $html = str_replace("{CRITERIO_OBJ_ESP_FINAL}", "Pendiente", $html);
        $html = str_replace("{NOTA_OBJ_ESP_FINAL}", "", $html);
        $html = str_replace("{ESTILO_AREA_FINAL}", "etiquetaPrograma-pendiente", $html);
        $html = str_replace("{CRITERIO_AREA_FINAL}", "Pendiente", $html);
        $html = str_replace("{NOTA_AREA_FINAL}", "", $html);
        $html = str_replace("{ESTILO_CORP_FINAL}", "etiquetaPrograma-pendiente", $html);
        $html = str_replace("{CRITERIO_CORP_FINAL}", "Pendiente", $html);
        $html = str_replace("{NOTA_CORP_FINAL}", "", $html);
    }
    $verifica_eval_finalizada = FinalizadoEvaluadoEvaluador($evaluado, $evaluador, $id_proceso);
    //if($verifica_eval_finalizada){
    //if($datos_resumen[27]){
    if ($datos_resumen[41] == "si") {
        //if($_SESSION["id_empresa"]<>41){
        //if($_SESSION["id_empresa"]<>411){
        //$html = str_replace("{NOTA_FINAL}",$datos_resumen[35]."% - ".$datos_resumen[27]."%",$html);
        //$html = str_replace("{NOTA_FINAL}",$datos_resumen[27]."%",$html);
        if ($_SESSION["id_empresa"] == 28) {
            if ($_SESSION["user_"] == $evaluador) {
                $html = str_replace("{NOTA_FINAL}", $datos_resumen[27] . "", $html);
                $html = str_replace("{CRITERIO_NOTA_FINAL}", $datos_resumen[28], $html);
                $html = str_replace("{ESTILO_NOTA_FINAL}", $datos_resumen[29], $html);
                $html = str_replace("{ICONO_NOTA_FINAL}", $datos_resumen[30], $html);
            } else {
                $informe_liberado = TraeLiberadoEvaluadoEvaluadorProceso($evaluado, $evaluador, $id_proceso);
                if ($informe_liberado or $id_proceso_desde_admin) {
                    $html = str_replace("{NOTA_FINAL}", $datos_resumen[27] . "", $html);
                    $html = str_replace("{CRITERIO_NOTA_FINAL}", $datos_resumen[28], $html);
                    $html = str_replace("{ESTILO_NOTA_FINAL}", $datos_resumen[29], $html);
                    $html = str_replace("{ICONO_NOTA_FINAL}", $datos_resumen[30], $html);
                } else {
                    $html = str_replace("{NOTA_FINAL}", "", $html);
                    $html = str_replace("{CRITERIO_NOTA_FINAL}", "Pendiente", $html);
                    $html = str_replace("{ESTILO_NOTA_FINAL}", "etiquetaPrograma-pendiente", $html);
                    $html = str_replace("{ICONO_NOTA_FINAL}", "", $html);
                }
            }
        } else {
            $html = str_replace("{NOTA_FINAL}", $datos_resumen[27] . "", $html);
            $html = str_replace("{CRITERIO_NOTA_FINAL}", $datos_resumen[28], $html);
            $html = str_replace("{ESTILO_NOTA_FINAL}", $datos_resumen[29], $html);
            $html = str_replace("{ICONO_NOTA_FINAL}", $datos_resumen[30], $html);
        }
        //}else{
        //    $html = str_replace("{NOTA_FINAL}","",$html);
        //    $html = str_replace("{CRITERIO_NOTA_FINAL}","Pendiente",$html);
        //    $html = str_replace("{ESTILO_NOTA_FINAL}","etiquetaPrograma-pendiente",$html);
        //    $html = str_replace("{ICONO_NOTA_FINAL}","",$html);
        //}
    } else {
        $html = str_replace("{NOTA_FINAL}", "", $html);
        $html = str_replace("{CRITERIO_NOTA_FINAL}", "Pendiente", $html);
        $html = str_replace("{ESTILO_NOTA_FINAL}", "etiquetaPrograma-pendiente", $html);
        $html = str_replace("{ICONO_NOTA_FINAL}", "", $html);
    }
    if ($datos_resumen[36]) {
        //$html = str_replace("{NOTA_COMP_ESPE_AE}",round($datos_resumen[36])."%",$html);
        //$html = str_replace("{NOTA_COMP_ESPE_AE}",ColocaDecimalesNotasFinales($decimales_para_reportes, $datos_resumen[36], "")."%",$html);
        $html = str_replace("{NOTA_COMP_ESPE_AE}", ColocaDecimalesNotasFinales($decimales_para_reportes, $datos_resumen[36], "") . "", $html);
        $html = str_replace("{CRITERIO_COMP_ESPE_AE}", $datos_resumen[39], $html);
        $html = str_replace("{ESTILO_COMP_ESPE_AE}", $datos_resumen[38], $html);
        $html = str_replace("{ICONO_COMP_ESPE_AE}", $datos_resumen[40], $html);
    } else {
        $html = str_replace("{NOTA_COMP_ESPE_AE}", "", $html);
        $html = str_replace("{CRITERIO_COMP_ESPE_AE}", "Pendiente", $html);
        $html = str_replace("{ESTILO_COMP_ESPE_AE}", "etiquetaPrograma-pendiente", $html);
        $html = str_replace("{ICONO_COMP_ESPE_AE}", "", $html);
    }
    return ($html);
}
function ListadoValidaObjetivosJefe($html, $evaluador, $id_objetivo, $sgd_version, $id_proceso)
{
    //En esta funcion traigo a todos los evaliados de este evaluador
    $evaluados = EvaluadosDadoEvaluador($evaluador);
    //Se muestran los objetivos individuales.
    if ($sgd_version == 2) {
        $total_html = file_get_contents("views/sgd/sgd_version2/entorno_equipo_valida_objetivos.html");
    } else {
        $total_html = file_get_contents("views/sgd/entorno_equipo_valida_objetivos.html");
    }
    //Primero veo si es que hay registro en la tabla de sesion
    $row           = "";
    $ok_finalizado = 0;
    foreach ($evaluados as $evaluado) {
        $verifica_finaliado = VerificaFinalizadoObjetivosIndividuales($evaluado->evaluado);
        if ($verifica_finaliado) {
            $row .= file_get_contents("views/sgd/row_colaboradores_valida_objetivos.html");
        } else {
        }
        $objetivos_validados_por_validador = VerificaSiObjetivosEstanValidados($evaluado->evaluado);
        if ($objetivos_validados_por_validador) {
            $row = str_replace("{FORMUARIO_FIJACION_OBJEIVOS_JEFE}", "", $row);
            $row = str_replace("{SECCION_COMENTARIOS}", "", $row);
        } else {
            $evaluado_enviado_a_validar = VerificaSiObjetivosEstanAjustados($evaluado->evaluado);
            if ($evaluado_enviado_a_validar) {
                $row = str_replace("{FORMUARIO_FIJACION_OBJEIVOS_JEFE}", file_get_contents("views/sgd/formulario_objetivos_jefe.html"), $row);
                $row = str_replace("{SECCION_COMENTARIOS}", file_get_contents("views/sgd/seccion_comentarios_validador.html"), $row);
            } else {
                $ultimo_comentario = ObtenerObjetivosDeRechazoUltimo($evaluado->evaluado);
                if ($ultimo_comentario) {
                    $row = str_replace("{FORMUARIO_FIJACION_OBJEIVOS_JEFE}", file_get_contents("views/sgd/formulario_objetivos_jefe.html"), $row);
                    $row = str_replace("{SECCION_COMENTARIOS}", file_get_contents("views/sgd/seccion_comentarios_validador.html"), $row);
                } else {
                    $row = str_replace("{FORMUARIO_FIJACION_OBJEIVOS_JEFE}", file_get_contents("views/sgd/formulario_objetivos_jefe.html"), $row);
                    $row = str_replace("{SECCION_COMENTARIOS}", "", $row);
                }
            }
        }
        $row                        = FormularioIngresaObjetivos($row, $evaluado->evaluado, $evaluador);
        $row                        = ColocaDatosUsuario($row, $evaluado->evaluado);
        $valores_objetivos          = ListadoObjetivosAValidar($evaluado->evaluado, $evaluador, $id_objetivo, "jefe", $id_proceso);
        $row                        = str_replace("{LISTADO_OBJETIVOS_A_EVALUAR}", $valores_objetivos[0], $row);
        $ponderaciones_bases        = DevuelvePonderacionesPorEvaluado($evaluado->evaluado, $id_proceso);
        $verifica_evaluado_validado = VerificaSiObjetivosEstanAjustados($evaluado->evaluado);
        /*if($verifica_evaluado_validado){
        $row = str_replace("{BOTON_JEFE_VALIDA_OBJETIVOS}",file_get_contents("views/sgd/boton_ve_objetivos.html"),$row);
        }else{
        $row = str_replace("{BOTON_JEFE_VALIDA_OBJETIVOS}",file_get_contents("views/sgd/boton_jefe_valida_objetivos.html"),$row);
        }*/
        if ($verifica_evaluado_validado) {
            $row = str_replace("{BOTON_VALIDA_INDIVIDUAL}", file_get_contents("views/sgd/boton_PDF_Objetivos.html"), $row);
        } else {
            if ($valores_objetivos[1] == $ponderaciones_bases[2]) {
                $row = str_replace("{BOTON_VALIDA_INDIVIDUAL}", file_get_contents("views/sgd/boton_jefe_envia_a_validar.html"), $row);
            } else {
                $row = str_replace("{BOTON_VALIDA_INDIVIDUAL}", "", $row);
            }
        }
        $row = str_replace("{BOTON_JEFE_VALIDA_OBJETIVOS}", "", $row);
        $row = str_replace("{TOTAL_SUMA_PONDERACION}", $valores_objetivos[1], $row);
        //$row = str_replace("{PONDERACION_OBJETIVOS_INDIVIDUALES}",$ponderaciones_bases[2],$row);
        $row = str_replace("{PONDERACION_OBJETIVOS_INDIVIDUALES}", 100, $row);
        if ($valores_objetivos[1] == $ponderaciones_bases[2]) {
            $row = str_replace("{OK}", "OK", $row);
        } else {
            $row = str_replace("{OK}", "", $row);
        }
        $row = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($evaluado->evaluado), $row);
        $row = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($evaluado->evaluado), $row);
        $row = str_replace("{RUT_EVALUADOR_ENCODEADO}", Encodear3($evaluador), $row);
        if ($valores_objetivos[1] == $ponderaciones_bases[2]) {
            $ok_finalizado++;
        }
    }
    $total_html = str_replace("{LISTADO_COLABORADORES}", ($row), $total_html);
    if ($ok_finalizado == count($evaluados)) {
        $ajustado = VerificaSiObjetivosEstanAjustadosEvaluador($evaluador);
        //if($ajustado){
        if (count($ajustado) == count($evaluados)) {
            $total_html = str_replace("{BOTON_ENVIA_A_VALIDAR_OBJETIVOS}", "", $total_html);
        } else {
            $total_html = str_replace("{BOTON_ENVIA_A_VALIDAR_OBJETIVOS}", file_get_contents("views/sgd/boton_envia_validacion_a_jefe_del_jefe.html"), $total_html);
        }
    } else {
        $total_html = str_replace("{BOTON_ENVIA_A_VALIDAR_OBJETIVOS}", file_get_contents("views/sgd/texto_no_enviar_a_validar.html"), $total_html);
    }
    $total_html = str_replace("{ID_PROCESO_ENCODEADO}", Encodear3($id_proceso), $total_html);
    $html       = str_replace("{ENTORNO_LISTADO_EVALUACION}", ($total_html), $html);
    return ($html);
}
function ListadoValidaJefeDelJefe($html, $evaluador, $id_objetivo)
{
    //En esta funcion traigo a todos los evaliados de este evaluador
    //$evaluados=EvaluadosDadoEvaluadorConDatosDeEvaluado($evaluador);
    $evaluados          = EvaluadosDadoEvaluadorConDatosDeEvaluadoSinAe($evaluador);
    //Se muestran los objetivos individuales.
    $total_html         = file_get_contents("views/sgd/validacion/entorno_listado.html");
    //Primero veo si es que hay registro en la tabla de sesion
    $row                = "";
    $ok_finalizado      = 0;
    $tiene_para_validar = 0;
    foreach ($evaluados as $evaluado) {
        //Verifico por cada uno, si tiene evaluados, solo si tiene, los muestro, sino aplico continue...
        $tiene_evaluados = TraeEvaluadosDadoEvaluadorSinAe($evaluado->evaluado);
        if (!$tiene_evaluados) {
            continue;
        }
        //en la siguente linea verifico si el evaluador finalizó sus ajustes de objetivos propuesttos por el evaluado.
        $verifica_ajustes_jefe = VerificaSiObjetivosEstanAjustadosEvaluador($evaluado->evaluado);
        if ($verifica_ajustes_jefe) {
            $row .= file_get_contents("views/sgd/validacion/row_dependientes.html");
            $tiene_para_validar++;
        } else {
            $row .= file_get_contents("views/sgd/validacion/row_dependientes_no_finalizado.html");
            $row = ColocaDatosUsuario($row, $evaluado->evaluado, 1);
            continue;
        }
        //$row = str_replace("{FORMUARIO_FIJACION_OBJEIVOS_JEFE}",file_get_contents("views/sgd/formulario_objetivos_jefe.html"),$row);
        $row          = str_replace("{FORMUARIO_FIJACION_OBJEIVOS_JEFE}", "", $row);
        //$row=FormularioIngresaObjetivos($row, $evaluado->evaluado, $evaluador);
        $row          = ColocaDatosUsuario($row, $evaluado->evaluado, "");
        //
        //Por cada evaluado, traigo a sus evaluados, y los muestro.
        //$dependientes=EvaluadosDadoEvaluadorConDatosDeEvaluado($evaluado->evaluado);
        $dependientes = EvaluadosDadoEvaluadorConDatosDeEvaluadoYValidador($evaluado->evaluado, $evaluador);
        $dep_row      = "";
        foreach ($dependientes as $dep) {
            //Verifico si este evaluado ya esta validado
            $verifica_validado = VerificaSiObjetivosEstanValidados($dep->evaluado);
            if ($verifica_validado) {
                $dep_row .= file_get_contents("views/sgd/validacion/row_colaboradores_validado.html");
                $dep_row = str_replace("{SECCION_VALIDA_VALIDADOR}", file_get_contents("views/sgd/validacion/formulario_validado.html"), $dep_row);
            } else {
                $dep_row .= file_get_contents("views/sgd/validacion/row_colaboradores_a_validar.html");
                $dep_row = str_replace("{SECCION_VALIDA_VALIDADOR}", file_get_contents("views/sgd/validacion/formulario_para_validar.html"), $dep_row);
            }
            //Traigo el ultimo comentario ingresado por el validador
            $ultimo_comentario = ObtenerObjetivosDeRechazoUltimo($dep->evaluado);
            $dep_row           = str_replace("{ULTIMO_COMENTARIO_INGRESADO}", $ultimo_comentario[0]->comentario, $dep_row);
            $dep_row           = str_replace("{NOMBRE}", utf8_encode($dep->nombre), $dep_row);
            $dep_row           = str_replace("{CARGO}", utf8_encode($dep->cargo), $dep_row);
            $dep_row           = str_replace("{EVALUADO}", $dep->nombre, $dep_row);
            $dep_row           = str_replace("{IMAGEN_DEPENDIENTE}", VerificaFotoPersonal($dep->evaluado), $dep_row);
            $valores_objetivos = ListadoObjetivosAValidar($dep->evaluado, $evaluado->evaluado, "", "validador");
            $dep_row           = str_replace("{LISTADO_OBJETIVOS_EVALUADO}", $valores_objetivos[0], $dep_row);
            $dep_row           = str_replace("{RUT_EVALUADO}", $dep->evaluado, $dep_row);
        }
        $row = str_replace("{LISTADO_DEPENDIENTES}", ($dep_row), $row);
    }
    $total_html = str_replace("{LISTADO_COLABORADORES}", ($row), $total_html);
    if ($ok_finalizado == count($evaluados)) {
        $ajustado = VerificaSiObjetivosEstanAjustadosEvaluador($evaluador);
        if ($ajustado) {
            $total_html = str_replace("{BOTON_ENVIA_A_VALIDAR_OBJETIVOS}", "", $total_html);
        } else {
            $total_html = str_replace("{BOTON_ENVIA_A_VALIDAR_OBJETIVOS}", file_get_contents("views/sgd/boton_envia_validacion_a_jefe_del_jefe.html"), $total_html);
        }
    } else {
        $total_html = str_replace("{BOTON_ENVIA_A_VALIDAR_OBJETIVOS}", "", $total_html);
    }
    if ($tiene_para_validar > 0) {
        $total_html = str_replace("{BOTON_JEFE_JEFE_VALIDA}", file_get_contents("views/sgd/validacion/jefe_jefe_tiene_para_validar.html"), $total_html);
    } else {
        $total_html = str_replace("{BOTON_JEFE_JEFE_VALIDA}", "", $total_html);
    }
    $html = str_replace("{ENTORNO_LISTADO_EVALUACION}", ($total_html), $html);
    return ($html);
}
function ResultadosFinales($evaluado, $evaluador, $id_proceso, $id_etapa_eval)
{
    if ($_SESSION["id_empresa"] == 11) {
        $datos_evaluado = UsuarioEnBasePersonas($evaluado);
    } else {
        $datos_evaluado = UsuarioEnBasePersonasConRelacionEvaluadoEvaluador($evaluado, $evaluador, $id_proceso);
    }
    //$datos_evaluado=UsuarioEnBasePersonas($evaluado);
    //echo "<br><br>";
    $id_empresa    = $datos_evaluado[0]->id_empresa;
    $id_area       = $datos_evaluado[0]->id_area;
    $datos_proceso = TraeProcesosDeEvaluacionPorEmpresaYDiProceso($_SESSION["id_empresa"], $id_proceso);
    //print_r($datos_proceso);echo "<br><br>";
    if ($datos_proceso[0]->decimales_puntaje) {
    }
    $ponderaciones = TraePonderacionesPorPerfil($datos_evaluado[0]->perfil_evaluacion);
    if ($id_empresa <> 28) {
        //Nota Objetivo
        if ($id_empresa == 43) {
            $arreglo[18] = ObtieneNotaObjetivosSinTablaRespuesta($evaluado, $evaluador, $id_proceso, "");
        } else {
            $arreglo[18] = ObtieneNotaObjetivos($evaluado, $evaluador, $id_proceso, "");
        }
        //Funcion para traer los resultados individuales de la Evaluacion intermedia en objetivos especificos y Evaluacion de competencias
        $nota_objetivos = $arreglo[18];
        $dato1          = ObtenerCriterioPuntajeMatrizNotaFinal($nota_objetivos, $evaluado, 0, "ind", $evaluador, $id_proceso);
        //COMENTADO 23112015 $nota_objetivos=$dato1[1];
        //Esta corresponde a la etiqueta css del promedio de los objetivos individuales
        $arreglo[0]     = $dato1[2];
        //Para mostrar
        //Este corresponde al Criterio
        $arreglo[1]     = $dato1[0];
        $arreglo[24]    = $dato1[3];
        $arreglo[18]    = round($dato1[1], 2);
    }
    $datos_nota_final_competencia = ObtieneNotaFinalCompetencias($datos_evaluado[0]->perfil_evaluacion, $evaluado, $evaluador, $id_proceso);
    $res_final                    = $datos_nota_final_competencia[0];
    $eval_finalizada              = $datos_nota_final_competencia[1];
    $dato2                        = ObtenerCriterioPuntajeMatrizNotaFinal($res_final, $evaluado, "", "comp", $evaluador, $id_proceso);
    $arreglo[19]                  = $res_final;
    $arreglo[19]                  = round($dato2[1], 2);
    //Esta corresponde a la etiqueta css de la nota final
    $arreglo[2]                   = $dato2[2];
    //Este corresponde al Criterio
    $arreglo[3]                   = $dato2[0];
    //ICONO
    $arreglo[25]                  = $dato2[3];
    //Icono Objetio especifico
    $arreglo[4]                   = $dato1[3];
    $arreglo[5]                   = $dato2[3];
    $arreglo[6]                   = round(CalculaNotaFinal($ponderaciones[0]->objetivos_individuales, $ponderaciones[0]->competencias, round($nota_objetivos, 2), round($res_final, 2)), 2);
    $dato3                        = ObtenerCriterioPuntajeMatriz($arreglo[6], $evaluado, 0);
    //Criterio nota final
    $arreglo[7]                   = $dato3[0];
    //Etiqueta CSS
    $arreglo[8]                   = $dato3[2];
    //Icono
    $arreglo[9]                   = $dato3[3];
    if ($arreglo[6] == 0) {
        //Criterio nota final
        $arreglo[7] = "Pendiente";
        //Etiqueta CSS
        $arreglo[8] = "etiquetaPrograma-pendiente";
        //Icono
        $arreglo[9] = "fa fa-circle-o";
    }
    if ($id_empresa <> 28) {
        //print_r($arreglo);
        //DATOS DEL AREA
        //dado el id del area, obtengo,
        $nota_area          = ObtengoUltimaNotaObjetivoArea($id_area, $id_empresa, $id_proceso);
        $datos_area         = ObtenerCriterioPuntajeMatrizNotaFinal($nota_area[0]->nota_area, $evaluado, "", "area", $evaluador, $id_proceso);
        $nota_area          = $datos_area[1];
        //Criterio Nota Area
        $arreglo[10]        = $datos_area[0];
        //Etiqueta CSS Nota Area
        $arreglo[11]        = $datos_area[2];
        //Icono nota area
        $arreglo[12]        = $datos_area[3];
        //Nota Area
        $arreglo[13]        = $datos_area[1];
        //OBJETIVOS EMPRESA
        $nota_empresa       = ObtengoUltimaNotaObjetivoEmpresa($id_empresa, $id_proceso);
        //$datos_empresa=ObtenerCriterioPuntajeMatriz($nota_empresa[0]->promedio_objetivos_corporativos, $evaluado, 0);
        $datos_empresa      = ObtenerCriterioPuntajeMatrizNotaFinal($nota_empresa[0]->promedio_objetivos_corporativos, $evaluado, 0, "corp", $evaluador, $id_proceso);
        $nota_empresa       = $datos_empresa[1];
        //Criterio Nota Empresa
        $arreglo[14]        = $datos_empresa[0];
        //Etiqueta CSS Nota Empresa
        $arreglo[15]        = $datos_empresa[2];
        //Icono nota Empresa
        $arreglo[16]        = $datos_empresa[3];
        //Nota Empresa
        $arreglo[17]        = $datos_empresa[1];
        //Nota Final entre Nota Objetivo Empresa y Objetivo Area
        $arreglo[20]        = CalculaNotaFinal($ponderaciones[0]->objetivos_area, $ponderaciones[0]->objetivos_empresa, $arreglo[13], $arreglo[17]);
        $datos_empresa_area = ObtenerCriterioPuntajeMatrizNotaFinal($arreglo[20], $evaluado, "", "corp", $evaluador, $id_proceso);
        //Criterio
        $arreglo[21]        = $datos_empresa_area[0];
        //etiqueta css
        $arreglo[22]        = $datos_empresa_area[2];
        //icono
        $arreglo[23]        = $datos_empresa_area[3];
        /*0
        echo $ponderaciones[0]->objetivos_area." ".$datos_area[1]." area<br>";
        echo $ponderaciones[0]->objetivos_empresa." ".$datos_empresa[1]." empresa<br>";
        echo $ponderaciones[0]->objetivos_individuales." ".$nota_objetivos." ind<br>";
        echo $ponderaciones[0]->competencias." ".$res_final." comp<br><br>";
        exit;*/
    }
    // CALCULO FINAL
    if ($nota_objetivos <> '') {
        $nota_final = (($ponderaciones[0]->objetivos_area * $datos_area[1]) / 100) + (($ponderaciones[0]->objetivos_empresa * $datos_empresa[1]) / 100) + (($nota_objetivos * $ponderaciones[0]->objetivos_individuales) / 100) + (($res_final * $ponderaciones[0]->competencias) / 100);
    }
    //if($evaluado=="17528702") {
    //echo "<br>$evaluado nota_objetivos $nota_objetivos, comp $res_final nota $nota_final";    }
    if ($nota_objetivos == '') {
        $nota_final = (($ponderaciones[0]->objetivos_area * $datos_area[1]) / 100) + (($ponderaciones[0]->objetivos_empresa * $datos_empresa[1]) / 100) + (($nota_objetivos * $ponderaciones[0]->objetivos_individuales) / 100) + (($res_final * 100 / 100));
    }
    //echo $nota_objetivos." ".$res_final."<br>";
    $arreglo[27]                  = ColocaDecimalesNotasFinales($datos_proceso[0]->decimales_puntajes, $nota_final, "");
    $datos_nota_final             = ObtenerCriterioPuntajeMatrizNotaFinal($arreglo[27], $evaluado, 0, "nota_final", $evaluador, $id_proceso);
    //echo "<br><br>";
    //Criterio
    $arreglo[28]                  = $datos_nota_final[0];
    //Etiqueta CSS Nota Empresa
    $arreglo[29]                  = $datos_nota_final[2];
    //Icono nota Empresa
    $arreglo[30]                  = $datos_nota_final[3];
    //Valor a mostar para objetivos especificos
    $arreglo[31]                  = $dato1[4];
    //Valor a mostar para competencias
    //$arreglo[32]=$dato2[4];
    $arreglo[32]                  = ColocaDecimalesNotasFinales($datos_proceso[0]->decimales_puntajes, $dato2[4], "");
    //print_r($datos_proceso);
    //Valor a mostar para area
    $arreglo[33]                  = $datos_area[4];
    //Valor a mostar para corporativos
    $arreglo[34]                  = $datos_empresa[4];
    //Nota final con datos a mostrar, y no con datos dfe campo puntaje
    $nota_final_con_datos_puntaje = (($ponderaciones[0]->objetivos_area * $arreglo[33]) / 100) + (($ponderaciones[0]->objetivos_empresa * $arreglo[34]) / 100) + (($arreglo[31] * $ponderaciones[0]->objetivos_individuales) / 100) + (($arreglo[32] * $ponderaciones[0]->competencias) / 100);
    //Nota final calculado con campo valor a mostrar
    $arreglo[35]                  = round($nota_final_con_datos_puntaje);
    $acum_dimension               = 0;
    $dimensiones                  = ObtengoDimensionesDadoPerfil($datos_evaluado[0]->perfil_evaluacion);
    //AUTOEVALUACION //OJOOO ESTO DEBE SER CON LA FUNCION QUE DEVUELVE LA NOTA FINAL
    foreach ($dimensiones as $dim) {
        //Ahora por cada dimension, traigo las competencias
        //$competencias=CompetenciasDadoDimension($dim->id_dimension);
        $competencias                    = CompetenciasDadoDimensionYPerfil($dim->id_dimension, $datos_evaluado[0]->perfil_evaluacion);
        //$competencias=CompetenciasDadoDimensionYPerfil($dim->id_dimension, $datos_evaluado[0]->perfil_evaluacion);
        $cont_competencias_por_dimension = 0;
        $acum_comp                       = 0;
        foreach ($competencias as $comp) {
            //Promedio de respuestas por competencias
            //$prom_com=PromedioRespuestasComp($evaluado, $evaluador, $comp->id);
            $prom_com  = PromedioRespuestasCompPorProceso($evaluado, $evaluado, $comp->id, $id_proceso);
            //echo "promedio ".$prom_com[0]->nota_competencia."<br>";
            $acum_comp = $acum_comp + $prom_com[0]->nota_competencia;
        }
        //el promedio de esta dimension
        $acum_dimension = $acum_dimension + ($acum_comp / count($competencias));
        //echo "promedio dimension ".($acum_comp/count($competencias))."   ".$acum_comp." --- ".count($competencias)."  <br>";
    }
    //ACA VERIFICO SI LA EVAL ESTA FINALIZADA
    $finalizada_eval_ae = FinalizadoEvaluadoEvaluador($evaluado, $evaluado, $id_proceso);
    if ($finalizada_eval_ae) {
        $res_final_ae = $acum_dimension / count($dimensiones);
    } else {
        $res_final_ae = "";
    }
    //echo $evaluado." ".count($dimensiones)."<br>";
    $dato_ae     = ObtenerCriterioPuntajeMatrizNotaFinal($res_final_ae, $evaluado, "", "comp", $evaluador, $id_proceso);
    $arreglo[36] = $res_final_ae;
    $arreglo[37] = $dato_ae[1];
    //print_r($dato2);
    //Esta corresponde a la etiqueta css de la nota final
    $arreglo[38] = $dato_ae[2];
    //Este corresponde al Criterio
    $arreglo[39] = $dato_ae[0];
    //ICONO
    $arreglo[40] = $dato_ae[3];
    $arreglo[41] = $eval_finalizada;
    return ($arreglo);
}
function InformeIndividualEval($html, $evaluado, $evaluador, $id_proceso, $id_empresa, $feedback, $pdf)
{
    //La variable feedback, es para cuando se ve el informe completo, desde la vista del evaluado.
    //echo "evaluado $evaluado, evaluador $evaluador, id_proceso, $id_proceso";
    $datos_proceso_evaluacion = TraeProcesosDeEvaluacionPorEmpresaYDiProceso($id_empresa, $id_proceso);
    $decimales_para_proceso   = $datos_proceso_evaluacion[0]->decimales_puntajes;
    //$datos_evaluado=UsuarioEnBasePersonas($evaluado);
    $datos_evaluado           = UsuarioEnBasePersonasConRelacionEvaluadoEvaluador($evaluado, $evaluador, $id_proceso);
    //Bloque Resumen Superior
    if ($id_empresa == 43) {
        $template_top = file_get_contents("views/sgd/informe/tabla_superior_informe_eval.html");
    } else if ($evaluado == $_SESSION["user_"]) {
        $template_top = file_get_contents("views/sgd/informe/" . $id_empresa . "_tabla_superior_informe_ae.html");
    } else {
        if ($pdf == "si") {
            $template_top = file_get_contents("views/sgd/informe/PDF_tabla_superior_informe.html");
        } else {
            $template_top = file_get_contents("views/sgd/informe/" . $id_empresa . "_tabla_superior_informe.html");
        }
    }
    //$total_evaluados.=ColocaDatosUsuario($template_top, $evaluado, "", $evaluador, $id_proceso);
    $total_evaluados .= ColocaDatosUsuarioSGD($template_top, $evaluado, "", $evaluador, $id_proceso);
    $total_evaluados = str_replace("{TABLA_RESUMEN1}", file_get_contents("views/sgd/informe/tabla_superior_resumen/tabla_resumen1_sinareacorp_dinamico.html"), $total_evaluados);
    //$total_evaluados=ArmaTemplareDeTablaResumen($total_evaluados, $_SESSION["ano_proceso_anual"], $id_empresa, $datos_evaluado[0]->perfil_evaluacion, $evaluado, $evaluador, "no");
    $total_evaluados = ArmaTemplareDeTablaResumen($total_evaluados, $_SESSION["ano_proceso_anual"], $id_empresa, $datos_evaluado[0]->perfil_evaluacion, $evaluado, $evaluador, "no");
    //exit;
    $html            = str_replace("{BLOQUE_RESUMEN_EVALUADO}", $total_evaluados, $html);
    $html            = str_replace("{PASOS}", "", $html);
    //Bloque de detalle por competencias
    //echo "evaluado $evaluado evaluador $evaluador";
    //$competencias=CompetenciasDadoPerfil($datos_evaluado[0]->perfil_evaluacion, $evaluado, $evaluador);
    $competencias    = CompetenciasDadoPerfilPorProceso($datos_evaluado[0]->perfil_evaluacion, $evaluado, $evaluador, $id_proceso);
    $html            = str_replace("{NOMBRE_INFORME_EVALUACION}", utf8_encode($datos_proceso_evaluacion[0]->titulo_informes_proceso), $html);
    $html            = str_replace("{GRAFICOROLES}", file_get_contents("views/sgd/graficos/" . $id_empresa . "_graficoRoles.html"), $html);
    $html            = str_replace("{GRAFICODETERMINANTES}", file_get_contents("views/sgd/graficos/" . $id_empresa . "_graficoDeterminantes.html"), $html);
    //Aca pregunto si es que se muestra o no el promedio de las competencias.
    if ($datos_proceso_evaluacion[0]->muestra_promedio_competencias == 1) {
        $row                      = file_get_contents("views/sgd/informe/row_informe1_comp.html");
        $row                      = str_replace("{NOMBRE}", "Promedio por Competencias", $row);
        $nota_final_competencias  = ObtieneNotaFinalCompetencias($datos_evaluado[0]->perfil_evaluacion, $evaluado, $evaluador, $id_proceso);
        //$criterios_nota_final=ObtenerCriterioPuntajeMatrizNotaFinal($nota_final_competencias[0], $evaluado, "", "comp");
        $criterios_nota_final     = ObtenerCriterioPuntajeMatrizNotaFinal($nota_final_competencias[0], $evaluado, "", "comp", $evaluador, $id_proceso);
        $row                      = str_replace("{NOMBRE}", "Promedio por Competencias", $row);
        $row                      = str_replace("{ESTILO_ETIQUETA}", $criterios_nota_final[2], $row);
        $row                      = str_replace("{ICONO}", $criterios_nota_final[3], $row);
        $row                      = str_replace("{CRITERIO}", $criterios_nota_final[0], $row);
        //$row = str_replace("{NOTA}",FormatearPorcentajesSinDecimal($nota_final_competencias[0])."%",$row);
        $row                      = str_replace("{NOTA}", FormatearPorcentajesSinDecimal($nota_final_competencias[0]) . "", $row);
        $template_row_competencia = file_get_contents("views/sgd/informe/row_informe1_comp_v2.html");
    } else {
        //BLOQUE PARA PROMEDIO DE LA COMPETENCIA
        if ($feedback == "feedback") {
            $template_row_competencia = file_get_contents("views/sgd/informe/row_informe1_comp_con_ae.html");
        } else if ($datos_proceso_evaluacion[0]->muestra_ae_evaluacion == 1 && $evaluado <> $_SESSION["user_"]) {
            if ($pdf == "pdf") {
                $template_row_competencia = file_get_contents("views/sgd/informe/row_informe1_comp_con_ae_PDF.html");
            } else {
                if ($_GET["mae"] == 1) {
                    $template_row_competencia = file_get_contents("views/sgd/informe/" . $id_empresa . "_row_informe1_comp.html");
                } else {
                    $template_row_competencia   = file_get_contents("views/sgd/informe/" . $id_empresa . "_row_informe1_comp_con_ae.html");
                    $template_solo_competencias = file_get_contents("views/sgd/informe/row_informe1_comp_con_ae.html");
                }
            }
        } else if ($datos_proceso_evaluacion[0]->muestra_ae_evaluacion == 2) {
            $template_row_competencia = file_get_contents("views/sgd/informe/row_informe1_comp_eval.html");
        } else {
            if ($_GET["veEval"] == 1) {
                $template_row_competencia   = file_get_contents("views/sgd/informe/" . $id_empresa . "_row_informe1_comp_con_ae.html");
                $template_solo_competencias = file_get_contents("views/sgd/informe/row_informe1_comp_con_ae.html");
            } else {
                $template_row_competencia = file_get_contents("views/sgd/informe/" . $id_empresa . "_row_informe1_comp.html");
            }
            //$template_row_competencia=file_get_contents("views/sgd/informe/row_informe1_comp.html");
        }
    }
    $i                                  = 0;
    $contador_graficos_por_competencias = 1;
    foreach ($competencias as $com) {
        //$row.=file_get_contents("views/sgd/informe/row_informe1_comp.html");
        $row .= $template_row_competencia;
        $criterios                         = ObtenerCriterioPuntajeMatrizNotaFinal($com->nota_promedio, $evaluado, "", "comp", $evaluador, $id_proceso);
        $row                               = str_replace("{NOMBRE}", $com->nombre_componente, $row);
        //$matriz_competencias[$i]["nombre"]=$com->sigla;
        $matriz_competencias[$i]["nombre"] = $com->nombre_componente;
        $row                               = str_replace("{DESCRIPCION}", $com->descripcion_componente, $row);
        $row                               = str_replace("{PONDERACION}", "", $row);
        $row                               = str_replace("{ESTILO_ETIQUETA}", $criterios[2], $row);
        $row                               = str_replace("{ICONO}", $criterios[3], $row);
        $row                               = str_replace("{CRITERIO}", $criterios[0], $row);
        //$row = str_replace("{NOTA}",FormatearPorcentajesSinDecimal($com->nota_promedio)."%",$row);
        //$row = str_replace("{NOTA}",ColocaDecimalesNotasFinales($decimales_para_proceso, $com->nota_promedio, $tipo)."%",$row);
        $row                               = str_replace("{NOTA}", ColocaDecimalesNotasFinales($decimales_para_proceso, $com->nota_promedio, $tipo) . "", $row);
        //Bloque para cuando es solo la competencia
        $row_solo_competencia .= $template_solo_competencias;
        $row_solo_competencia = str_replace("{NOMBRE}", $com->nombre_componente, $row_solo_competencia);
        $row_solo_competencia = str_replace("{DESCRIPCION}", $com->descripcion_componente, $row_solo_competencia);
        $row_solo_competencia = str_replace("{PONDERACION}", "", $row_solo_competencia);
        $row_solo_competencia = str_replace("{ESTILO_ETIQUETA}", $criterios[2], $row_solo_competencia);
        $row_solo_competencia = str_replace("{ICONO}", $criterios[3], $row_solo_competencia);
        $row_solo_competencia = str_replace("{CRITERIO}", $criterios[0], $row_solo_competencia);
        $row_solo_competencia = str_replace("{NOTA}", ColocaDecimalesNotasFinales($decimales_para_proceso, $com->nota_promedio, $tipo) . "", $row_solo_competencia);
        $arreglo_para_grafico_promedio_competencias .= round($com->nota_promedio, 2);
        $arreglo_para_grafico_promedio_competencias_texto .= '"' . $com->sigla . '" ';
        if ($contador_graficos_por_competencias < count($competencias)) {
            $arreglo_para_grafico_promedio_competencias .= ", ";
            $arreglo_para_grafico_promedio_competencias_texto .= ", ";
        }
        $contador_graficos_por_competencias++;
        //$matriz_competencias[$i]["nota"]=($com->nota_promedio);
        $matriz_competencias[$i]["nota"] = ($com->nota_promedio);
        $tiene_resultados                = CALCULA_TieneResultadosPorCometencciaCalculados($evaluado, $evaluador, $id_proceso, $com->id);
        if ($tiene_resultados) {
            //Actualiza
            CALCULA_ActualizaResultadosCalculados($evaluado, $evaluador, $datos_evaluado[0]->calibrador, $id_proceso, $com->id_componente, $com->nota_promedio, $criterios[0], $datos_evaluado[0]->perfil_evaluacion, $datos_evaluado[0]->subperfil);
        } else {
            //Inserta
            CALCULA_InsertaResultadosCalculados($evaluado, $evaluador, $datos_evaluado[0]->calibrador, $id_proceso, $com->id_componente, $com->nota_promedio, $criterios[0], $datos_evaluado[0]->perfil_evaluacion, $datos_evaluado[0]->subperfil);
        }
        if ($evaluado == $evaluador) {
            $datos_resumen_nota_final = ResultadosFinales($evaluado, $evaluado, $id_proceso, $id_etapa_evaluacion);
            ActualizaNotaFinalTablaFinalizados($evaluado, $evaluado, $id_proceso, $datos_resumen_nota_final[19], $datos_resumen_nota_final[3]);
        } else {
            $datos_resumen_nota_final = ResultadosFinales($evaluado, $evaluador, $id_proceso, $id_etapa_evaluacion);
            ActualizaNotaFinalTablaFinalizados($evaluado, $evaluador, $id_proceso, $datos_resumen_nota_final[19], $datos_resumen_nota_final[3]);
        }
        //AE
        //BLOQUE PARA MOSTRAR NOTAS AE
        $competencias_ae      = CompetenciasDadoPerfilPorCompetencia($datos_evaluado[0]->perfil_evaluacion, $evaluado, $evaluado, $com->id_competencia);
        $competencias_ae      = CompetenciasDadoPerfilPorCompetenciaPorProceso($datos_evaluado[0]->perfil_evaluacion, $evaluado, $evaluado, $com->id_competencia, $id_proceso);
        $criterios_ae         = ObtenerCriterioPuntajeMatrizNotaFinal($competencias_ae[0]->nota_promedio, $evaluado, "", "comp", $evaluador, $id_proceso);
        $row                  = str_replace("{ESTILO_ETIQUETA_AE}", $criterios_ae[2], $row);
        $row                  = str_replace("{ICONO_AE}", $criterios_ae[3], $row);
        $row                  = str_replace("{CRITERIO_AE}", $criterios_ae[0], $row);
        $row                  = str_replace("{NOTA_AE}", ColocaDecimalesNotasFinales($decimales_para_proceso, $competencias_ae[0]->nota_promedio, $tipo) . "", $row);
        //SECCION PARA ROLES / COMPETENCIAS
        $row_solo_competencia = str_replace("{ESTILO_ETIQUETA_AE}", $criterios_ae[2], $row_solo_competencia);
        $row_solo_competencia = str_replace("{ICONO_AE}", $criterios_ae[3], $row_solo_competencia);
        $row_solo_competencia = str_replace("{CRITERIO_AE}", $criterios_ae[0], $row_solo_competencia);
        $row_solo_competencia = str_replace("{NOTA_AE}", ColocaDecimalesNotasFinales($decimales_para_proceso, $competencias_ae[0]->nota_promedio, $tipo) . "", $row_solo_competencia);
        $arreglo_grafico_determinantes_valor .= $competencias_ae[0]->nota_promedio;
        $matriz_competencias[$i]["nota_ae"] = ($competencias_ae[0]->nota_promedio);
        $i++;
        //Por cada competencia veo si tiene mas de una pregunta ,si es asi, las muestra, con la
        //Respuesta correspondiente
        if ($com->muestra_preguntas_informe == 1) {
            $preguntas_por_competencias = PreguntasPorCompetenciaConRespuesta($com->id_competencia, $evaluado, $evaluador, $id_proceso);
            $row_preg                   = "";
            //echo "$evaluado $evaluador <br>";
            foreach ($preguntas_por_competencias as $preg_uni) {
                if ($feedback == "feedback") {
                    //$template_row_competencia=file_get_contents("views/sgd/informe/row_informe1_comp_con_ae.html");
                    $row_preg .= file_get_contents("views/sgd/informe/row_informe1.1_comp_con_ae.html");
                    //}else if($datos_proceso_evaluacion[0]->muestra_ae_evaluacion==1 && $evaluado<>$_SESSION["user_"]){
                } else if ($datos_proceso_evaluacion[0]->muestra_ae_evaluacion == 1 && $evaluado <> $_SESSION["user_"]) {
                    if ($pdf == "pdf") {
                        $row_preg .= file_get_contents("views/sgd/informe/row_informe1.1_comp_con_ae_PDF.html");
                    } else {
                        //$row_preg.=file_get_contents("views/sgd/informe/row_informe1.1_comp_con_ae.html");
                        if ($_GET["mae"] == 1) {
                            $row_preg .= file_get_contents("views/sgd/informe/" . $id_empresa . "_row_informe1.1_comp.html");
                            $row_comentario_por_pregunta = file_get_contents("views/sgd/informe/" . $id_empresa . "_row_informe_comentario_por_pregunta.html");
                        } else {
                            $row_preg .= file_get_contents("views/sgd/informe/" . $id_empresa . "_row_informe1.1_comp_con_ae.html");
                            $row_comentario_por_pregunta = file_get_contents("views/sgd/informe/" . $id_empresa . "_row_informe_comentario_por_pregunta_con_ae.html");
                        }
                    }
                } else if ($datos_proceso_evaluacion[0]->muestra_ae_evaluacion == 2) {
                    $row_preg .= file_get_contents("views/sgd/informe/row_informe1.1_comp_eval.html");
                } else {
                    if ($_GET["veEval"] == 1) {
                        $row_preg .= file_get_contents("views/sgd/informe/" . $id_empresa . "_row_informe1.1_comp_con_ae.html");
                        $row_comentario_por_pregunta = file_get_contents("views/sgd/informe/" . $id_empresa . "_row_informe_comentario_por_pregunta_con_ae.html");
                    } else {
                        //$row_preg.=file_get_contents("views/sgd/informe/row_informe1.1_comp.html");
                        $row_preg .= file_get_contents("views/sgd/informe/" . $id_empresa . "_row_informe1.1_comp.html");
                        $row_comentario_por_pregunta = file_get_contents("views/sgd/informe/" . $id_empresa . "_row_informe_comentario_por_pregunta.html");
                    }
                }
                $row_preg               = str_replace("{NOMBRE_1}", $preg_uni->pregunta . "", $row_preg);
                $row_preg               = str_replace("{DESCRIPCION_1}", "", $row_preg);
                $row_preg               = str_replace("{PONDERACION_1}", "", $row_preg);
                $criterios_detalle_preg = ObtenerCriterioPuntajeMatrizNotaFinal($preg_uni->puntaje, $evaluado, "", "comp", $evaluador, $id_proceso);
                $row_preg               = str_replace("{ESTILO_ETIQUETA_1}", $criterios_detalle_preg[2], $row_preg);
                $row_preg               = str_replace("{ICONO_1}", $criterios_detalle_preg[3], $row_preg);
                $row_preg               = str_replace("{CRITERIO_1}", $criterios_detalle_preg[0], $row_preg);
                //$row_preg = str_replace("{NOTA_1}",FormatearPorcentajesSinDecimal($preg_uni->puntaje)."%",$row_preg);
                //$row_preg = str_replace("{NOTA_1}",FormatearPorcentajesSinDecimal($preg_uni->puntaje)."",$row_preg);
                $row_preg               = str_replace("{NOTA_1}", ColocaDecimalesNotasFinales($decimales_para_proceso, $preg_uni->puntaje, $tipo) . "", $row_preg);
                ${"coontador_variable_dinamica" . $preg_uni->descripcion}++;
                //    echo ${"coontador_variable_dinamica".$preg_uni->descripcion}."<br>";
                //$arreglo_notas_por_descripcion[$preg_uni->id_determinante][${"coontador_variable_dinamica".$preg_uni->descripcion}][$preg_uni->id]=$preg_uni->puntaje;
                $arreglo_notas_por_descripcion[$preg_uni->id_determinante][$preg_uni->id] = $preg_uni->puntaje;
                //PARA AE
                $preguntas_por_competencias_ae                                            = PreguntasPorCompetenciaConRespuestaPorPregunta($com->id_competencia, $evaluado, $evaluado, $id_proceso, $preg_uni->id);
                $criterios_detalle_preg_ae                                                = ObtenerCriterioPuntajeMatrizNotaFinal($preguntas_por_competencias_ae[0]->puntaje, $evaluado, "", "comp", $evaluador, $id_proceso);
                $row_preg                                                                 = str_replace("{ESTILO_ETIQUETA_1_AE}", $criterios_detalle_preg_ae[2], $row_preg);
                $row_preg                                                                 = str_replace("{ICONO_1_AE}", $criterios_detalle_preg_ae[3], $row_preg);
                $row_preg                                                                 = str_replace("{CRITERIO_1_AE}", $criterios_detalle_preg_ae[0], $row_preg);
                //$row_preg = str_replace("{NOTA_1_AE}",FormatearPorcentajesSinDecimal($preguntas_por_competencias_ae[0]->puntaje)."",$row_preg);
                $row_preg                                                                 = str_replace("{NOTA_1_AE}", ColocaDecimalesNotasFinales($decimales_para_proceso, $preguntas_por_competencias_ae[0]->puntaje, $tipo) . "", $row_preg);
                //$row_preg = str_replace("{PORCENTAJEEVALPREGUNTA}",round(25*$preguntas_por_competencias_ae[0]->puntaje-25)."",$row_preg);
                $row_preg                                                                 = str_replace("{PORCENTAJEEVALPREGUNTA}", round(20 * $preguntas_por_competencias_ae[0]->puntaje) . "", $row_preg);
                $row_preg                                                                 = str_replace("{VALORPORCENTAJE}", ColocaDecimalesNotasFinales($decimales_para_proceso, $preguntas_por_competencias_ae[0]->puntaje, $tipo) . "", $row_preg);
                $row_preg                                                                 = str_replace("{ESTILO_ETIQUETA_1_AE}", $criterios_detalle_preg_ae[2], $row_preg);
                if ($preg_uni->comentario) {
                    //$row_preg = str_replace("{BLOQUE_COMENTARIO_POR_PREGUNTA}",file_get_contents("views/sgd/informe/".$id_empresa."_row_informe_comentario_por_pregunta.html"),$row_preg);
                    $row_preg = str_replace("{BLOQUE_COMENTARIO_POR_PREGUNTA}", $row_comentario_por_pregunta, $row_preg);
                    $row_preg = str_replace("{COMENTARIO_POR_PREGUNTA}", $preg_uni->comentario, $row_preg);
                } else {
                    $row_preg = str_replace("{BLOQUE_COMENTARIO_POR_PREGUNTA}", "", $row_preg);
                }
                if ($preguntas_por_competencias_ae[0]->comentario) {
                    $row_preg = str_replace("{BLOQUE_COMENTARIO_POR_PREGUNTA_AE}", $row_comentario_por_pregunta, $row_preg);
                    $row_preg = str_replace("{COMENTARIO_POR_PREGUNTA}", $preguntas_por_competencias_ae[0]->comentario, $row_preg);
                } else {
                    $row_preg = str_replace("{BLOQUE_COMENTARIO_POR_PREGUNTA_AE}", "", $row_preg);
                }
            }
        }
        $row .= $row_preg;
        //Aca si es PDF, verifico si tiene cometarios por competencias, si es asi, traigo los comentarios por competencia de ae y jefe, y si estan, concateno template
        $tiene_comentario_desc = TieneComentarioPorCompetencia($evaluado, $evaluador, $com->id_competencia, $id_empresa, $id_proceso);
        if ($tiene_comentario_desc) {
            $row .= file_get_contents("views/sgd/informe/row_informe_comentarios_por_competencias_PDF.html");
            $row = str_replace("{TIPO_COMENTARIO}", "Comentario Evaluaci&oacute;n", $row);
            $row = str_replace("{COMENTARIO}", $tiene_comentario_desc[0]->comentario, $row);
        }
        //print_r($tiene_comentario_desc);
        $tiene_comentario_ae = TieneComentarioPorCompetencia($evaluado, $evaluado, $comp->id_competencia, $id_empresa, $id_proceso);
        if ($tiene_comentario_ae) {
            $row .= file_get_contents("views/sgd/informe/row_informe_comentarios_por_competencias_PDF.html");
            $row = str_replace("{TIPO_COMENTARIO}", "Comentario Autoevaluaci&oacute;n", $row);
            $row = str_replace("{COMENTARIO}", $tiene_comentario_ae[0]->comentario, $row);
        }
    }
    //echo "<pre>";
    //print_r(($arreglo_notas_por_descripcion));
    //Traigo el total de los determinantes por empresa
    $total_determinantes    = TotalDeterminantes($id_empresa);
    $contador_determinantes = 1;
    foreach ($total_determinantes as $determinante) {
        //print_r(($arreglo_notas_por_descripcion[$determinante->id]));
        $acumulador_por_determinantes = 0;
        //for($l=1;$l<=count($arreglo_notas_por_descripcion[$determinante->id]);$l++){
        //$acumulador_por_determinantes++;
        //Traigo las preguntas por Determinantes
        $preguntas_por_determinante   = TraigoPreguntasPorDeterminantesEmpresa($determinante->id, $id_empresa);
        $acumulador_por_determinantes = 0;
        $suma_notas                   = 0;
        foreach ($preguntas_por_determinante as $preg_det) {
            //echo $preg_det->id;
            $acumulador_por_determinantes++;
            //echo $arreglo_notas_por_descripcion[$determinante->id][$preg_det->id];
            $suma_notas = $suma_notas + $arreglo_notas_por_descripcion[$determinante->id][$preg_det->id];
        }
        //echo $determinante->id." suma ".$suma_notas." contador ".$acumulador_por_determinantes."<br>";
        $promedio_determinantes = $suma_notas / $acumulador_por_determinantes;
        $row_dete .= file_get_contents("views/sgd/informe/row_informe_determinante.html");
        $row_dete                = str_replace("{NOMBRE}", utf8_encode($determinante->determinante), $row_dete);
        $criterios_determinantes = ObtenerCriterioPuntajeMatrizNotaFinal($promedio_determinantes, $evaluado, "", "comp", $evaluador, $id_proceso);
        $row_dete                = str_replace("{ESTILO_ETIQUETA}", $criterios_determinantes[2], $row_dete);
        $row_dete                = str_replace("{ICONO}", $criterios_determinantes[3], $row_dete);
        $row_dete                = str_replace("{CRITERIO}", $criterios_determinantes[0], $row_dete);
        $row_dete                = str_replace("{NOTA}", ColocaDecimalesNotasFinales($decimales_para_proceso, $promedio_determinantes, $tipo) . "", $row_dete);
        $arreglo_para_grafico_determinantes .= $promedio_determinantes;
        //$arreglo_para_grafico_determinantes_nombres.='"'.utf8_encode($determinante->determinante).'"';
        $arreglo_para_grafico_determinantes_nombres .= "'" . utf8_encode($determinante->sigla) . "'";
        if ($contador_determinantes < count($total_determinantes)) {
            $arreglo_para_grafico_determinantes .= ",";
            $arreglo_para_grafico_determinantes_nombres .= ",";
        }
        $contador_determinantes++;
        //}
    }
    //echo $arreglo_para_grafico_determinantes_nombres;
    //echo $arreglo_para_grafico_determinantes;
    //$html = str_replace("{ARREGLO_VALORES_DETERMINANTES}",$arreglo_para_grafico_determinantes,$html);
    //$html = str_replace("{ARREGLO_NOMBRE_DETERMINANTES}",$arreglo_para_grafico_determinantes_nombres,$html);
    $html = colocaGraficoPromedioPorDeterminantes($html, $evaluador, $id_proceso, $evaluado);
    //exit;
    $html = str_replace("{LISTADO_COMPETENCIAS}", utf8_encode($row), $html);
    $html = str_replace("{LISTADO_SOLO_COMPETENCIAS}", utf8_encode($row_solo_competencia), $html);
    for ($j = 1; $j <= count($arreglo_notas_por_descripcion); $j++) {
        //$row_dete.=file_get_contents("views/sgd/informe/row_informe_determinante.html");
    }
    //$html = str_replace("{LISTADO_DETERMINANTES}",utf8_encode($row_dete),$html);
    //OBJETIVOS ESPECIFICOS
    //Aca se especifican el detalle de los objetivos especificos
    //$objetivos=ObjetivosEspecificosConRespuesta($evaluado);
    $bloque_listado_objetivos_especificos = BloqueListadoObjetivoEspecificos($evaluado, $evaluador, $id_proceso, $id_empresa, "si");
    if ($bloque_listado_objetivos_especificos) {
        $html = str_replace("{BLOQUE_ESPECIFICOS}", file_get_contents("views/sgd/informe/" . $id_empresa . "_entorno_informe_bloque_objetivos.html"), $html);
        $html = str_replace("{LISTADO_OBJETIVOS}", utf8_encode($bloque_listado_objetivos_especificos), $html);
    } else {
        $html = str_replace("{BLOQUE_ESPECIFICOS}", "", $html);
    }
    //Objetivos Empresa
    $objetivos_empresa = ObjetivosDeEmpresaConNota($datos_evaluado[0]->id_empresa, $id_proceso);
    if ($objetivos_empresa) {
        $html = str_replace("{BLOQUE_COORPORATIVOS}", file_get_contents("views/sgd/informe/entorno_informe_bloque_corporativo.html"), $html);
        foreach ($objetivos_empresa as $ob) {
            //$row3.=file_get_contents("views/sgd/informe/row_informe1_desactivado.html");
            $row3 .= file_get_contents("views/sgd/informe/row_informe1.html");
            $row3   = str_replace("{NOMBRE}", $ob->descripcion_objetivo, $row3);
            $row3   = str_replace("{PONDERACION}", "30%", $row3);
            $row3   = str_replace("{DESCRIPCION}", "", $row3);
            $datos3 = ObtenerCriterioPuntajeMatrizNotaFinal($ob->nota, $evaluado, "", "corp", $evaluador, $id_proceso);
            $row3   = str_replace("{NOTA}", FormatearPorcentajesSinDecimal($ob->nota) . "%", $row3);
            $row3   = str_replace("{ESTILO_ETIQUETA}", $datos3[2], $row3);
            $row3   = str_replace("{CRITERIO}", $datos3[0], $row3);
            $row3   = str_replace("{ICONO}", $datos3[3], $row3);
        }
        $html = str_replace("{LISTADO_OBJETIVOS_CORPORATIVOS}", utf8_encode($row3), $html);
    } else {
        $html = str_replace("{BLOQUE_COORPORATIVOS}", "", $html);
    }
    //OBJETIVOS AREA
    $datos_usuario  = UsuarioEnBasePersonasInnerArea($evaluado);
    //con el id del area, y el id de la empresa, traigo los datos de los objetivos de area
    $objetivos_area = DatosObjetivosAreaConNota($datos_usuario[0]->id_area, $datos_usuario[0]->id_empresa, $id_proceso);
    if ($objetivos_area) {
        $html = str_replace("{BLOQUE_AREA}", file_get_contents("views/sgd/informe/entorno_informe_bloque_area.html"), $html);
        foreach ($objetivos_area as $objar) {
            //$row4.=file_get_contents("views/sgd/informe/row_informe1_desactivado.html");
            $row4 .= file_get_contents("views/sgd/informe/row_informe1.html");
            $row4   = str_replace("{NOMBRE}", $objar->descripcion_objetivo, $row4);
            $row4   = str_replace("{PONDERACION}", "30%", $row4);
            $row4   = str_replace("{DESCRIPCION}", "", $row4);
            $datos4 = ObtenerCriterioPuntajeMatrizNotaFinal($objar->nota, $evaluado, "", "area");
            $row4   = str_replace("{NOTA}", FormatearPorcentajesSinDecimal($objar->nota), $row4);
            $row4   = str_replace("{ESTILO_ETIQUETA}", $datos4[2], $row4);
            $row4   = str_replace("{CRITERIO}", $datos4[0], $row4);
            $row4   = str_replace("{ICONO}", $datos4[3], $row4);
        }
        $html = str_replace("{LISTADO_OBJETIVOS_AREA}", utf8_encode($row4), $html);
    } else {
        $html = str_replace("{BLOQUE_AREA}", "", $html);
    }
    $datos_evaluacion_resultados  = ResultadosFinales($evaluado, $evaluador, $id_procesoo);
    $html                         = str_replace("{ESTILO_OBJIND}", $datos_evaluacion_resultados[0], $html);
    $html                         = str_replace("{ICONO_OBJIND}", $datos_evaluacion_resultados[4], $html);
    $html                         = str_replace("{CRITERIO_OBJETIVOS_IND}", $datos_evaluacion_resultados[1], $html);
    $html                         = str_replace("{ESTILO_COMP}", $datos_evaluacion_resultados[2], $html);
    $html                         = str_replace("{ICONO_COMP}", $datos_evaluacion_resultados[5], $html);
    $html                         = str_replace("{CRITERIO_COMPETENCIAS}", $datos_evaluacion_resultados[3], $html);
    //Graficos Individuales
    $html                         = str_replace("{GRAFICO_COMPETENCIAS}", GraficoPorCompetenciasPorEvaluadorCalibrador($evaluador, $id_proceso, "", $evaluado), $html);
    //Grafico de Araña
    $html                         = str_replace("{GRAFICO_ARANA}", GraficoArana($matriz_competencias), $html);
    //BLOQUE DE COMENTARIO FINAL DE LA EVALUACION
    $tiene_preguntas_finales_desc = TieneComentariosFinalesSGD($evaluado, $evaluador, $id_proceso);
    $tiene_preguntas_finales_ae   = TieneComentariosFinalesSGD($evaluado, $evaluado, $id_proceso);
    if ($tiene_preguntas_finales_desc or $tiene_preguntas_finales_ae) {
        if ($pdf == "pdf") {
            $html = str_replace("{BLOQUE_COMENTARIOS_FINALES}", file_get_contents("views/sgd/informe/entorno_comentarios_finales_PDF.html"), $html);
            $html = str_replace("{BLOQUE_COMENTARIOS_FINALES_AE}", file_get_contents("views/sgd/informe/entorno_comentarios_finales_ae_PDF.html"), $html);
        } else {
            $html = str_replace("{BLOQUE_COMENTARIOS_FINALES}", file_get_contents("views/sgd/informe/entorno_comentarios_finales.html"), $html);
            $html = str_replace("{BLOQUE_COMENTARIOS_FINALES_AE}", file_get_contents("views/sgd/informe/entorno_comentarios_finales_ae.html"), $html);
        }
        $html = str_replace("{COMENTARIO_FINAL_DESC}", utf8_encode($tiene_preguntas_finales_desc[0]->comentario), $html);
        $html = str_replace("{COMENTARIO_FINAL_AE}", utf8_encode($tiene_preguntas_finales_ae[0]->comentario), $html);
    } else {
        $html = str_replace("{BLOQUE_COMENTARIOS_FINALES}", "", $html);
    }
    if ($pdf = "pdf") {
        $html = str_replace("{BLOQUE_COMENTARIOS_POR_COMPETENCIAS}", "", $html);
        $html = str_replace("{BLOQUE_COMENTARIOS_POR_COMPETENCIAS_AE}", "", $html);
    } else {
        $html = str_replace("{BLOQUE_COMENTARIOS_POR_COMPETENCIAS}", file_get_contents("views/sgd/informe/entorno_comentarios_por_competencia.html"), $html);
        $html = str_replace("{BLOQUE_COMENTARIOS_POR_COMPETENCIAS_AE}", file_get_contents("views/sgd/informe/entorno_comentarios_por_competencia_ae.html"), $html);
    }
    //$comentarios_por_competencias_des=TieneComentarioPorCompetenciaEvaluadoEvaluador($evaluado, $evaluador, $id_empresa, $id_proceso);
    //print_r($comentarios_por_competencias_des);
    //echo "<br><br>";
    //$comentarios_por_competencias_ae=TieneComentarioPorCompetenciaEvaluadoEvaluador($evaluado, $evaluado, $id_empresa, $id_proceso);
    //print_r($comentarios_por_competencias_ae);
    //if($comentarios_por_competencias_des or $comentarios_por_competencias_ae){
    foreach ($competencias as $comp) {
        //echo "<br>".$comp->id_competencia;
        $tiene_comentario_desc = TieneComentarioPorCompetencia($evaluado, $evaluador, $comp->id_competencia, $id_empresa, $id_proceso);
        //print_r($tiene_comentario_desc);
        $tiene_comentario_ae   = TieneComentarioPorCompetencia($evaluado, $evaluado, $comp->id_competencia, $id_empresa, $id_proceso);
        if ($tiene_comentario_desc or $tiene_comentario_ae) {
            if ($tiene_comentario_ae) {
                $row_comentarios_competencia_ae .= file_get_contents("views/sgd/informe/row_comentarios_competencias_ae.html");
                $row_comentarios_competencia_ae = str_replace("{COMPETENCIA}", $comp->nombre_componente, $row_comentarios_competencia_ae);
                $row_comentarios_competencia_ae = str_replace("{COMENTARIO_AE_SOLO}", $tiene_comentario_ae[0]->comentario, $row_comentarios_competencia_ae);
            }
            $row_comentarios_competencia .= file_get_contents("views/sgd/informe/row_comentarios_competencias.html");
            $row_comentarios_competencia = str_replace("{COMPETENCIA}", $comp->nombre_componente, $row_comentarios_competencia);
            $row_comentarios_competencia = str_replace("{COMENTARIO_DESC}", $tiene_comentario_desc[0]->comentario, $row_comentarios_competencia);
            $row_comentarios_competencia = str_replace("{COMENTARIO_AE}", $tiene_comentario_ae[0]->comentario, $row_comentarios_competencia);
        }
    }
    $html = str_replace("{ROW_COMENTARIOS_POR_COMPETENCIA}", utf8_encode($row_comentarios_competencia), $html);
    $html = str_replace("{ROW_COMENTARIOS_POR_COMPETENCIA_AE}", utf8_encode($row_comentarios_competencia_ae), $html);
    //}else{
    //    $html = str_replace("{ROW_COMENTARIOS_POR_COMPETENCIA}","No se ingresaron comentarios",$html);
    //}
    $html = str_replace("{ARREGLO_DATOS_GRAFICO_COMPETENCIAS}", $arreglo_para_grafico_promedio_competencias, $html);
    $html = str_replace("{ETIQUETAS_GRAFICO_COMPETENCIAS}", $arreglo_para_grafico_promedio_competencias_texto, $html);
    return ($html);
}
function TransformarNotaRespuestaPuntaje($respuesta, $rut, $dimension, $tipo_calculo)
{
    //echo "$respuesta, $rut, $dimension id empres ";
    //echo $_SESSION["id_empresa"];
    //exit;
    $id_empresa    = $_SESSION["id_empresa"];
    $datos_usuario = UsuarioEnBasePersonas($rut);
    //echo $respuesta." ";
    if ($id_empresa == 434) {
        //$respuesta=(($respuesta*100)/5)*1.2;
        $respuesta = (($respuesta * 25) - 25) * 1.2;
        //echo $respuesta;
        //exit;
        $registros = DatosCriterio($datos_usuario[0]->id_empresa, $datos_usuario[0]->perfil_evaluacion, $dimension);
        foreach ($registros as $reg) {
            //if($respuesta>$reg->rangomenor and $respuesta<=$reg->rangomayor){
            if ($respuesta >= $reg->rangomenor and $respuesta < $reg->rangomayor) {
                $criterio      = $reg->criterio;
                $valor_mostrar = $reg->valor_mostrar;
                //if($reg->puntaje>=0){
                if (isset($reg->puntaje)) {
                    $puntaje = $reg->puntaje;
                } else {
                    $puntaje = $respuesta;
                    //echo $reg->puntaje;
                    //echo "$puntaje";
                }
                $etiqueta     = $reg->etiqueta;
                $icono_estado = $reg->icono_estado;
            }
        }
        $arreglo[0] = $criterio;
        $arreglo[1] = $puntaje;
        $arreglo[2] = $etiqueta;
        $arreglo[3] = $icono_estado;
        $arreglo[4] = $valor_mostrar;
        //print_r($arreglo);exit;
        return ($arreglo);
    } else {
        $registros = DatosCriterio($datos_usuario[0]->id_empresa, $datos_usuario[0]->perfil_evaluacion, $dimension);
        foreach ($registros as $reg) {
            //if($respuesta>$reg->rangomenor and $respuesta<=$reg->rangomayor){
            if ($respuesta >= $reg->rangomenor and $respuesta < $reg->rangomayor) {
                $criterio      = $reg->criterio;
                $valor_mostrar = $reg->valor_mostrar;
                //if($reg->puntaje>=0){
                if (isset($reg->puntaje)) {
                    $puntaje = $reg->puntaje;
                } else {
                    $puntaje = $respuesta;
                    echo $reg->puntaje;
                }
                $etiqueta     = $reg->etiqueta;
                $icono_estado = $reg->icono_estado;
            }
        }
        $arreglo[0] = $criterio;
        $arreglo[1] = $puntaje;
        $arreglo[2] = $etiqueta;
        $arreglo[3] = $icono_estado;
        $arreglo[4] = $valor_mostrar;
        return ($arreglo);
    }
}
function ObtenerCriterioPuntajeMatriz($respuesta, $rut, $dimension, $tipo_calculo)
{
    //echo "$respuesta, $rut, $dimension";exit;
    $id_empresa = $_SESSION["id_empre"];
    if ($id_empresa == 433) {
    } else {
        $datos_usuario = UsuarioEnBasePersonas($rut);
        $registros     = DatosCriterio($datos_usuario[0]->id_empresa, $datos_usuario[0]->perfil_evaluacion, $dimension);
        foreach ($registros as $reg) {
            //if($respuesta>$reg->rangomenor and $respuesta<=$reg->rangomayor){
            if ($respuesta >= $reg->rangomenor and $respuesta < $reg->rangomayor) {
                $criterio      = $reg->criterio;
                $valor_mostrar = $reg->valor_mostrar;
                //if($reg->puntaje>=0){
                if (isset($reg->puntaje)) {
                    $puntaje = $reg->puntaje;
                } else {
                    $puntaje = $respuesta;
                    echo $reg->puntaje;
                }
                $etiqueta     = $reg->etiqueta;
                $icono_estado = $reg->icono_estado;
            }
        }
        $arreglo[0] = $criterio;
        $arreglo[1] = $puntaje;
        $arreglo[2] = $etiqueta;
        $arreglo[3] = $icono_estado;
        $arreglo[4] = $valor_mostrar;
        return ($arreglo);
    }
}
function ObtenerCriterioPuntajeMatrizNotaFinal($respuesta, $rut, $dimension, $tipo_nota, $evaluador, $id_proceso)
{
    //echo "aca $respuesta, $rut, $dimension, $tipo_nota<br>";
    if ($_SESSION["id_empresa"] == 11) {
        $datos_usuario = UsuarioEnBasePersonas($rut);
    } else {
        if ($rut) {
            $datos_usuario = UsuarioEnBasePersonasConRelacionEvaluadoEvaluador($rut, $evaluador, $id_proceso);
        } else {
            $datos_usuario = UsuarioEnBasePersonasConRelacionEvaluadoEvaluadorSoloEvaluador($evaluador, $id_proceso);
        }
    }
    //$datos_usuario=UsuarioEnBasePersonas($rut);
    //$registros=DatosCriterio($datos_usuario[0]->id_empresa, $datos_usuario[0]->perfil_evaluacion, $dimension);
    $registros = DatosCriterioPorPerfil($datos_usuario[0]->id_empresa, $datos_usuario[0]->perfil_evaluacion, $tipo_nota, $dimension);
    if ($rut == "11492205") {
        //echo "<br><br>";
        //echo $respuesta;
    }
    if ($tipo_nota == "comp") {
        //echo "dimension ".$dimension." ".$rut. "  ".$respuesta." ->RES  ".$tipo_nota;echo "<br>";
        //print_r($registros);
        //echo "<br><br>";
    }
    foreach ($registros as $reg) {
        //if($respuesta>$reg->rangomenor and $respuesta<=$reg->rangomayor){
        if ($respuesta >= $reg->rangomenor and $respuesta < $reg->rangomayor) {
            //echo "<br>";echo $respuesta." ".$reg->rangomenor." ".$reg->rangomayor." <br>";exit;
            $criterio      = $reg->criterio;
            $valor_mostrar = $reg->valor_mostrar;
            //if($reg->puntaje>=0){
            if (isset($reg->puntaje)) {
                $puntaje = $reg->puntaje;
                //echo $reg->puntaje."<br>";
            } else {
                $puntaje = $respuesta;
                echo $reg->puntaje;
            }
            $etiqueta     = $reg->etiqueta;
            $icono_estado = $reg->icono_estado;
        }
    }
    $arreglo[0] = $criterio;
    $arreglo[1] = $puntaje;
    $arreglo[2] = $etiqueta;
    $arreglo[3] = $icono_estado;
    //$arreglo[4]=$valor_mostrar;
    $arreglo[4] = $respuesta;
    //print_r($arreglo);echo "<br><br>";exit;
    return ($arreglo);
}
function DevuelveDatosEval($evaluado, $evaluador, $id_pregunta)
{
    $datos_evaluado = UsuarioEnBasePersonas2($evaluado);
    //id perfil de evaluacion
    $arreglo[0]     = $datos_evaluado[0]->perfil_evaluacion;
    $datos_relacion = EvaluadosDadoEvaluadorEvaluado($evaluador, $evaluado);
    //subperfil
    $arreglo[1]     = $datos_relacion[0]->subperfil;
    //Id proceso
    $arreglo[2]     = $datos_relacion[0]->id_proceso;
    //id empresa
    $arreglo[3]     = $datos_evaluado[0]->id_empresa;
    $datos          = DatosDadoIDPregunta($id_pregunta);
    //id_dimension
    $arreglo[4]     = $datos[0]->id_dimension;
    //id componente
    $arreglo[5]     = $datos[0]->id_componente;
    return ($arreglo);
}
function DevuelveDatosEvalPorProceso($evaluado, $evaluador, $id_pregunta, $id_proceso)
{
    $datos_evaluado = UsuarioEnBasePersonas2PorProceso($evaluado, $id_proceso);
    //id perfil de evaluacion
    $arreglo[0]     = $datos_evaluado[0]->perfil_evaluacion;
    $datos_relacion = EvaluadosDadoEvaluadorEvaluado($evaluador, $evaluado);
    //subperfil
    $arreglo[1]     = $datos_relacion[0]->subperfil;
    //Id proceso
    $arreglo[2]     = $datos_relacion[0]->id_proceso;
    //id empresa
    $arreglo[3]     = $datos_evaluado[0]->id_empresa;
    $datos          = DatosDadoIDPregunta($id_pregunta);
    //id_dimension
    $arreglo[4]     = $datos[0]->id_dimension;
    //id componente
    $arreglo[5]     = $datos[0]->id_componente;
    return ($arreglo);
}
function PaginacionSGDSoloEvaluador($evaluador, $pagina)
{
    $perfiles_dado_evaluador = TotalPerfilesDadoEvaluador($evaluador);
    $total_paginas           = $perfiles_dado_evaluador[0]->cantidad_componentes + 1;
    $tiene_sesion            = SesionSGDSoloEvaluador($evaluador, 1);
    //total de paginas
    if ($tiene_sesion) {
        $pagina = $tiene_sesion[0]->pagina;
    } else {
        $pagina = 1;
    }
    $paginacion = '<div class="pagination_sgd"><ul>';
    for ($i = 1; $i <= $total_paginas; $i++) {
        if ($pagina == $i) {
            //$paginacion.="<span class='pagination_sgd_activo'>".$i."</span>";
            $paginacion .= '<li ><a class="pagination_sgd_activo">' . $i . '</a></li>';
        } else {
            //$paginacion.=$i;
            $paginacion .= '<li><a href="#">' . $i . '</a></li>';
        }
    }
    $paginacion .= '</ul></div>';
    return ($paginacion);
}

function EntornoEvaluacionListado($html, $evaluador, $pagina, $id_proceso)
{
    //En esta funcion traigo a todos los evaliados de este evaluador
    $evaluados = EvaluadosDadoEvaluador($evaluador);
    if ($evaluados) {
        if ($pagina > 1) {
            $total_html = file_get_contents("views/sgd/evaluacion/entorno_equipo_evaluacion_competencia.html");
            //Se muestran las competencias para evaluar.
            $perfiles   = TotalPerfilesDadoEvaluador1($evaluador);
            //Aca tengo todos los perfiles, con esto, obtengo todas las competencias.
            for ($i = 0; $i < count($perfiles); $i++) {
                $sql .= " perfil_evaluacion='" . $perfiles[$i]->id_perfil_ev . "'";
                if ($perfiles[$i + 1]->id_perfil_ev)
                    $sql .= " or";
            }
            $componentes = TotalIdCompetencias($sql);
            if ($pagina > count($componentes) + 1) {
                InsertaEvaluadorFinalizado($evaluador, $id_proceso);
                //Aca ,por cada uno de los evaluados del evaluador, se inserta registro de finalizado evaluado evaluador
                foreach ($evaluados as $evaluad) {
                    InsertaEvaluadoEvaluadorFinalizado($evaluad->evaluado, $evaluador, $id_proceso);
                }
                echo "<script>
                            location.href='?sw=sgd2';
                    </script>";
                exit;
            }
            $total_html   = str_replace("{NOMBRE_COMPETENCIA}", utf8_encode($componentes[$pagina - 2]->nombre), $total_html);
            $total_html   = str_replace("{ID_ENCODEADO_COMPETENCIA}", $componentes[$pagina - 2]->id_componente, $total_html);
            $alternativas = AlternativasDadoIdGrupo($componentes[$pagina - 2]->id_alternativa);
            foreach ($alternativas as $alt) {
                $td .= file_get_contents("views/sgd/evaluacion/alternativa_encabezado.html");
                $td = str_replace("{DESCRIPCION_ALTERNATIVA}", $alt->alternativa, $td);
                //$td.='<td class="col-md-2 subtitulo_text_item_SGD borde_arribaabajoizquierdaderecha">'.$alt->alternativa.'</td>';
            }
            $total_html = str_replace("{NIVELES_TD}", utf8_encode($td), $total_html);
            foreach ($evaluados as $evaluado) {
                $row .= file_get_contents("views/sgd/evaluacion/row_colaboradores_evaluacion_comp.html");
                $row        = ColocaDatosUsuario($row, $evaluado->evaluado);
                $row        = str_replace("{NOMBRE_RADIO}", $evaluado->evaluado . "-" . $componentes[$pagina - 2]->id_componente, $row);
                $row        = str_replace("{NOMBRE_RADIO_SOLO_PREGUNTA}", $componentes[$pagina - 2]->id_componente, $row);
                $tiene_resp = TieneRespuestaCompetencia($evaluado->evaluado, $evaluador, $componentes[$pagina - 2]->id_componente);
                $row        = str_replace("{SELECT" . $tiene_resp[0]->respuesta . "}", "checked", $row);
            }
            $total_html = str_replace("{LISTADO_COLABORADORES}", ($row), $total_html);
        } else {
            //Se muestran los objetivos individuales.
            $total_html = file_get_contents("views/sgd/evaluacion/entorno_equipo_evaluacion.html");
            //Primero veo si es que hay registro en la tabla de sesion
            $row        = "";
            foreach ($evaluados as $evaluado) {
                $row .= file_get_contents("views/sgd/evaluacion/row_colaboradores_evaluacion.html");
                $row = ColocaDatosUsuario($row, $evaluado->evaluado);
                $row = str_replace("{LISTADO_OBJETIVOS_A_EVALUAR}", ListadoObjetivosEvaluacion($evaluado->evaluado, $evaluador), $row);
            }
            $total_html = str_replace("{LISTADO_COLABORADORES}", ($row), $total_html);
        }
        $html = str_replace("{PAGINACION_EVALUACION}", PaginacionSGDSoloEvaluador($evaluador, $pagina), $html);
    } else {
    }
    $html = str_replace("{ENTORNO_LISTADO_EVALUACION}", ($total_html), $html);
    return ($html);
}
function EntornoEvaluacion($html, $evaluado, $evaluador)
{
    //Objetivos Empresa
    $html = ColocaDatosUsuario($html, $evaluado);
    $html = MuestraObjetivos($html, $evaluado);
    $html = str_replace("{LISTADO_OBJETIVOS_INGRESADOS}", ListadoObjetivosIngresado($evaluado, $evaluador), $html);
    $html = str_replace("{SECCION_COMPETENCIAS}", MuestraListadoCompetencias($evaluado), $html);
    return ($html);
}
function ColocaDatosUsuario($html, $rut, $texto_mensaje, $rut_evaluador, $id_proceso, $pdf)
{
    if ($pdf == "pdf") {
        $html = str_replace("{SECCION_DATOS_USUARIO}", file_get_contents("views/sgd/datos_superior_usuario_pdf.html"), $html);
    } else {
        $html = str_replace("{SECCION_DATOS_USUARIO}", file_get_contents("views/sgd/datos_superior_usuario.html"), $html);
    }
    if ($rut_evaluador && $id_proceso) {
        $datos = DatosUsuarioConDatosEvaluadorPorProceso($rut, $rut_evaluador, $id_proceso);
        $html  = str_replace("{EVALUADOR}", utf8_encode($datos[0]->nombre_evaluador), $html);
    } else {
        $datos = DatosUsuarioLeftJefe($rut);
        if ($datos[0]->nombre_evaluador) {
            $html = str_replace("{EVALUADOR}", utf8_encode($datos[0]->nombre_evaluador), $html);
            $html = str_replace("{CARGO_EVALUADOR}", utf8_encode($datos[0]->cargo_evaluador), $html);
        } else {
            $html = str_replace("{EVALUADOR}", "Sin Evaluador", $html);
            $html = str_replace("{CARGO_EVALUADOR}", "Sin Evaluador", $html);
        }
    }
    //$html = str_replace("{SECCION_DATOS_USUARIO}",file_get_contents("views/sgd/datos_superior_usuario.html"),$html);
    if ($datos[0]->nombre_completo) {
        $html = str_replace("{NOMBRE_EVALUADO}", utf8_encode($datos[0]->nombre_completo), $html);
    } else if ($datos[0]->nombre && $datos[0]->apaterno && $datos[0]->amaterno) {
        $html = str_replace("{NOMBRE_EVALUADO}", utf8_encode($datos[0]->nombre) . " " . utf8_encode($datos[0]->apaterno) . " " . utf8_encode($datos[0]->amaterno), $html);
    } else if ($datos[0]->nombre) {
        $html = str_replace("{NOMBRE_EVALUADO}", utf8_encode($datos[0]->nombre), $html);
    }
    $html = str_replace("{NOMBRE}", utf8_encode($datos[0]->nombre_completo), $html);
    $html = str_replace("{CARGO_EVALUADO}", utf8_encode($datos[0]->cargo), $html);
    $html = str_replace("{CARGO}", utf8_encode($datos[0]->cargo), $html);
    $html = str_replace("{PERFIL_EVALUACION}", utf8_encode($datos[0]->nombre_perfil), $html);
    $html = str_replace("{IMAGEN_EVALUADO}", VerificaFotoPersonal($datos[0]->rut), $html);
    $html = str_replace("{IMG_FOTO}", VerificaFotoPersonal($datos[0]->rut), $html);
    if ($texto_mensaje == 1) {
        $html = str_replace("{MENSAJE}", file_get_contents("views/sgd/validacion/texto_no_validacion.html"), $html);
    } elseif ($texto_mensaje == 2) {
        $html = str_replace("{MENSAJE}", file_get_contents("views/sgd/texto_no_objetivos_jefe.html"), $html);
    } elseif ($texto_mensaje == "bitacora") {
        $html = str_replace("{MENSAJE}", file_get_contents("views/sgd/bitacora/boton_ingreso_formulario.html"), $html);
    } elseif ($texto_mensaje == "planes") {
        $html = str_replace("{MENSAJE}", file_get_contents("views/sgd/planes/boton_ingreso_formulario.html"), $html);
    } elseif ($texto_mensaje == "graficoFrecuenciaCompetencia ") {
        $html = str_replace("{MENSAJE}", "", $html);
    } elseif ($texto_mensaje == "sinmensaje") {
        $html = str_replace("{MENSAJE}", "", $html);
    } else {
        $html = str_replace("{MENSAJE}", "", $html);
    }
    //Verifico si el usuario es JEfe, si es asi, coloca boton Mi Equipo
    $es_evaluador = VerSiEsEvaluador($rut);
    if ($es_evaluador) {
        $html = str_replace("{EQUIPO}", '
                                            <a href="?sw=sgd2_e&er=' . Encodear3($rut) . '"><button class="btnver btn-gray btn-sm"><i class="fa fa-users pad_r"></i>Ver Equipo</button></a>', $html);
    } else {
        $html = str_replace("{EQUIPO}", "", $html);
    }
    if (file_exists("docs/dc/" . $rut . ".pdf")) {
        $html = str_replace("{DESCRIPCIONCARGO}", file_get_contents("views/sgd/boton_descripcion_cargo.html"), $html);
        $html = str_replace("{RUT}", $rut, $html);
    } else {
        $html = str_replace("{DESCRIPCIONCARGO}", "", $html);
    }
    return ($html);
}
function MuestraBotonCompetencias($html, $rut)
{
    $conocimiento_competencias = TomoConocimientoEvaluadoCompetencias($rut);
    if ($conocimiento_competencias) {
        $html = str_replace("{BOTON_COMPETENCIAS}", "", $html);
    } else {
        $aceptacion_objetivos = TomoConocimientoEvaluado($rut);
        if ($aceptacion_objetivos) {
            $html = str_replace("{BOTON_COMPETENCIAS}", file_get_contents("views/sgd/boton_conocimiento_comp.html"), $html);
        } else {
            $html = str_replace("{BOTON_COMPETENCIAS}", "", $html);
        }
    }
    return ($html);
}
function DevuelvePonderacionesPorEvaluado($rut, $id_proceso)
{
    //$datos_colaborador=UsuarioEnBasePersonas($rut);
    //$datos_colaborador=UsuarioEnBasePersonas($rut);
    $datos_colaborador = UsuarioEnBasePersonasConRelacionEvaluadoEvaluadorDadoEvaluado($rut, $id_proceso);
    $ponderaciones     = TraePonderacionesPorPerfil($datos_colaborador[0]->perfil_evaluacion);
    //Ponderacion Empresa
    $arreglo[0]        = $ponderaciones[0]->objetivos_empresa;
    //Ponderacion Area
    $arreglo[1]        = $ponderaciones[0]->objetivos_area;
    //Objetivos Individuales
    $arreglo[2]        = $ponderaciones[0]->objetivos_individuales;
    //Ponderacion Competencias
    $arreglo[3]        = $ponderaciones[0]->competencias;
    return ($arreglo);
}
function ColocaPonderaciones($html, $rut, $id_proceso)
{
    //$datos_colaborador=UsuarioEnBasePersonas($rut);
    $datos_colaborador = UsuarioEnBasePersonasConRelacionEvaluadoEvaluadorDadoEvaluado($rut, $id_proceso);
    $ponderaciones     = TraePonderacionesPorPerfil($datos_colaborador[0]->perfil_evaluacion);
    $html              = str_replace("{PONDERACION_OBJETIVOS_EMPRESA}", $ponderaciones[0]->objetivos_empresa . "%", $html);
    $html              = str_replace("{PONDERACION_OBJETIVOS_AREA}", $ponderaciones[0]->objetivos_area . "%", $html);
    $html              = str_replace("{PONDERACION_OBJETIVOS_INDIVIDUALES}", $ponderaciones[0]->objetivos_individuales . "%", $html);
    $html              = str_replace("{PONDERACION_COMPETENCIAS}", $ponderaciones[0]->competencias . "%", $html);
    return ($html);
}
function MuestraListadoCompetencias($rut, $id_proceso)
{
    $id_empresa        = $_SESSION["id_empresa"];
    $html              = file_get_contents("views/sgd/competencias/sgd3_entorno_componentes.html");
    //$datos_colaborador=UsuarioEnBasePersonas($rut);
    $datos_colaborador = UsuarioEnBasePersonasConRelacionEvaluadoEvaluadorDadoEvaluado($rut, $id_proceso);
    //Dado el perfil, traigo las competencias, prefuntas y alternativas
    //$matriz=TraeMatrizCompPregAlter($datos_colaborador[0]->perfil_evaluacion);
    //Dado el perfil, traigo las competencias
    $row               = "";
    $competencias      = CompetenciasDadoPerfil2($datos_colaborador[0]->perfil_evaluacion);
    foreach ($competencias as $comp_unica) {
        //Por cada competencia, coloco el encabezado, y traigo las preguntas de cada competencias
        $row .= file_get_contents("views/sgd/competencias/" . $id_empresa . "_row_vista_componentes.html");
        //$row = str_replace("{NOMBRE_COMPETENCIA}",$unico->nombre_componente,$row);
        $row                       = str_replace("{NOMBRE_COMPETENCIA}", $comp_unica->nombre_componente, $row);
        //Por cada competencia, traigo las preguntas
        $preguntas_por_competencia = PreguntasDadaCompetencia($comp_unica->id_componente);
        foreach ($preguntas_por_competencia as $preg) {
            $row .= file_get_contents("views/sgd/competencias/" . $id_empresa . "_row_vista_preguntas.html");
            if ($preg->descripcion) {
                $row = str_replace("{NOMBRE_PREGUNTA}", $preg->descripcion, $row);
            } else {
                $row = str_replace("{NOMBRE_PREGUNTA}", $preg->pregunta, $row);
            }
            //Por cada pregunta traigo las alternativas
            $alternativas = AlternativasDadoIdGrupo($preg->id_alternativa);
            $j            = 0;
            for ($i = 1; $i <= count($alternativas); $i++) {
                $row = str_replace("{ALT" . $i . "}", $alternativas[$i - 1]->alternativa, $row);
                $row = str_replace("{DESCRIPCION_ALT" . $i . "}", $alternativas[$i - 1]->descripcion, $row);
                $j++;
            }
        }
    }
    $html = str_replace("{LISTADO_COMPETENCIAS}", utf8_encode($row), $html);
    return ($html);
}
function ListadoTotalColaboradores($html, $rut, $proceso_anual, $id_empresa, $id_proceso, $tipo_sgd)
{
    //echo "$rut, $proceso_anual, $id_empresa, $id_proceso, $tipo_sgd";
    $datos_proceso_evaluacion = TraeProcesosDeEvaluacionDadoId($id_proceso);
    $id_proceso_anual         = $datos_proceso_evaluacion[0]->id_proceso_anual;
    $datos_proceso_anual      = DatosProcesoAnualPorId($id_proceso_anual);
    $html                     = str_replace("{ROW_PRIMER_JEFE}", file_get_contents("views/sgd/row_colaboradores.html"), $html);
    $html                     = ColocaDatosUsuario($html, $rut);
    //COMENTADO PARA OPTIMIZAR 22-11-2015
    //$html = str_replace("{TABLA_RESUMEN1}",file_get_contents("views/sgd/informe/tabla_resumen1.html"),$html);
    //COMENTADO PARA OPTIMIZAR 22-11-2015
    //$html = ColocaPonderaciones($html, $rut);
    $html                     = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($rut), $html);
    $datos_evaluado_jefe      = UsuarioEnBasePersonas($rut);
    //$html=ColocaResultadosTablaReumen($html, $rut, $datos_evaluado_jefe[0]->evaluador);
    //COMENTADO PARA OPTIMIZAR 22-11-2015
    //$total_evaluados=SemaforosEstadosObjetivos($total_evaluados, $ev->rut);
    $total_evaluados          = str_replace("{PARAMETROS_EVAL}", Encodear3($ev->rut . ";" . $rut), $total_evaluados);
    $datos_usuario            = UsuarioEnBasePersonas($rut);
    $html                     = str_replace("{NOMBRE_DEPENDIENTE}", utf8_encode($datos_usuario[0]->nombre), $html);
    $html                     = str_replace("{PARAMETROS_EVAL}", Encodear3($ev->rut . ";" . $rut), $html);
    if ($tipo_sgd == 2) {
        //$entorno=file_get_contents("views/sgd/sgd2_entorno_equipo_chilquinta.html");
        $entorno         = file_get_contents("views/sgd/" . $id_empresa . "_sgd2_entorno_equipo.html");
        $tiene_evaluados = TraeRelacionesSinAe($rut, $id_proceso);
        if ($tiene_evaluados) {
            /*if($id_empresa==43){
            $entorno = str_replace("{SECCION_EQUIPO_CONSOLIDADO}",file_get_contents("views/sgd/".$id_empresa."_vista_consolidada_equipo.html"),$entorno);
            }else{
            $entorno = str_replace("{SECCION_EQUIPO_CONSOLIDADO}",file_get_contents("views/sgd/vista_consolidada_equipo.html"),$entorno);
            }*/
            $entorno                            = str_replace("{SECCION_EQUIPO_CONSOLIDADO}", file_get_contents("views/sgd/" . $id_empresa . "_vista_consolidada_equipo.html"), $entorno);
            //aca debo validar si el evaluador tiene o no evaliuados finalizados, si es asi, muestra los graficos, si no, no.
            $evaluados_descendentes_finalizados = FinalizadoEvaluadorPorProcesoSinAe($rut, $id_proceso);
            if ($evaluados_descendentes_finalizados) {
                $entorno = str_replace("{SECCION_GRAFICOS_CONSOLIDADOS}", file_get_contents("views/sgd/" . $id_empresa . "_vista_consolidada_graficos.html"), $entorno);
                $entorno = str_replace("{GRAFICOROLES}", file_get_contents("views/sgd/graficos/" . $id_empresa . "_graficoRoles.html"), $entorno);
                $entorno = str_replace("{GRAFICODETERMINANTES}", file_get_contents("views/sgd/graficos/" . $id_empresa . "_graficoDeterminantes.html"), $entorno);
            } else {
                $entorno = str_replace("{SECCION_GRAFICOS_CONSOLIDADOS}", "", $entorno);
            }
            $entorno = str_replace("{GRAFICO1.1}", ConsolidadoLineal($rut, "", $id_proceso, $id_empresa), $entorno);
            $entorno = str_replace("{GRAFICO1.2}", GraficoPorCompetenciasPorEvaluadorCalibrador($rut, $id_proceso, ""), $entorno);
        } else {
            if ($id_empresa == 28) {
                $entorno = str_replace("{SECCION_EQUIPO_CONSOLIDADO}", file_get_contents("views/sgd/vista_consolidada_equipo.html"), $entorno);
                $entorno = str_replace("{SECCION_GRAFICOS_CONSOLIDADOS}", "", $entorno);
                $entorno = str_replace("{GRAFICO1.1}", "", $entorno);
                $entorno = str_replace("{GRAFICO1.2}", "", $entorno);
            } else {
                $entorno = str_replace("{SECCION_EQUIPO_CONSOLIDADO}", "", $entorno);
                $entorno = str_replace("{SECCION_GRAFICOS_CONSOLIDADOS}", "", $entorno);
            }
        }
    } else {
        $entorno = file_get_contents("views/sgd/sgd2_entorno_equipo.html");
    }
    //print_r($datos_proceso_anual);
    //valido, si es que este evaluador esta liberado para este proceso.
    //Si es asi, no muestro el boton Evaluar Equipo.
    $evaluador_liberado = TraeCantidadLiberadosPorEvaluador($rut, $id_proceso);
    if ($evaluador_liberado) {
        $entorno = str_replace("{BOTON_EVALUAR_EQUIPO}", "11", $entorno);
    } else {
        if ($datos_proceso_anual[0]->activo == 1) {
            $entorno = str_replace("{BOTON_EVALUAR_EQUIPO}", file_get_contents("views/sgd/" . $id_empresa . "_boton_evaluar_equipo.html"), $entorno);
        } else {
            $entorno = str_replace("{BOTON_EVALUAR_EQUIPO}", "222", $entorno);
        }
    }
    $entorno              = str_replace("{TABLA_DATOS_USUARIO_SUPERIOR}", file_get_contents("views/sgd/tabla_datos_superior_usuario.html"), $entorno);
    $entorno              = ColocaDatosUsuario($entorno, $rut, "graficoFrecuenciaCompetencia");
    //Aca valido si el evaluador termino sus evaluaciones, en tabla tbl_sgd_finalizados_evaluador.
    //$finalizado_evaluador=FinalizadoEvaluador($rut);
    $finalizado_evaluador = FinalizadoEvaluador($rut);
    if ($finalizado_evaluador) {
        $entorno = str_replace("{LINK_EVALUACION_EQUIPO}", "sgd2", $entorno);
    } else {
        $entorno = str_replace("{LINK_EVALUACION_EQUIPO}", "ev#pag", $entorno);
    }
    //Aca traigo ellistado total de los colaboradores
    //$evaluados=TraeEvaluadosDadoEvaluador($rut);
    //$evaluados=TraeEvaluadosDadoEvaluadorSinMiPerfil($rut);
    //$evaluados=TraeEvaluadosDadoEvaluadorPorProceso($rut);
    if ($id_empresa == 30 or $id_empresa == 11) {
        //$evaluados=TraeEvaluadosDadoEvaluadorPorProceso2($rut, 39);
        $evaluados = TraeEvaluadosDadoEvaluador($rut);
    } else {
        $evaluados = TraeEvaluadosDadoEvaluadorPorProceso2($rut, $id_proceso);
    }
    if (!$evaluados) {
        $html = str_replace("{ENTORNO_LISTADO_COLABORADORES}", "
            <div class='row'>
</div>
            ", $html);
    } else {
        $total_evaluados = "";
        $obj_fin         = 0;
        foreach ($evaluados as $ev) {
            if ($ev->rut == $ev->evaluador)
                continue;
            //COMENTADO PARA OPTIMIZAR 22-11-2015
            /*
            if($_SESSION["id_empresa"]==111){
            $row=file_get_contents("views/sgd/row_colaboradores.html");
            }else{
            $row=file_get_contents("views/sgd/listado_colaboradores/row_colaboradores_sin_evaluador.html");
            }*/
            if ($tipo_sgd == 2) {
                $row = file_get_contents("views/sgd/listado_colaboradores/" . $id_empresa . "_row_colaboradores_sin_evaluador.html");
            } else {
                $row = file_get_contents("views/sgd/listado_colaboradores/row_colaboradores_sin_evaluador.html");
            }
            //$total_evaluados.=ColocaDatosUsuario($row, $ev->rut);
            $total_evaluados .= ColocaDatosUsuarioSGD($row, $ev->rut, "", $rut, $id_proceso);
            //COMENTADO PARA OPTIMIZAR 22-11-2015
            /*
            if($_SESSION["id_empresa"]==111){
            $total_evaluados = str_replace("{TABLA_RESUMEN1}",file_get_contents("views/sgd/informe/tabla_resumen1.html"),$total_evaluados);
            }else
            {
            $total_evaluados = str_replace("{TABLA_RESUMEN1}",file_get_contents("views/sgd/informe/tabla_superior_resumen/tabla_resumen1_sinareacorp_dinamico.html"),$total_evaluados);
            $total_evaluados=ArmaTemplareDeTablaResumen($total_evaluados, $proceso_anual, $id_empresa, $ev->perfil_evaluacion, $ev->rut, $rut);
            }
            */
            //Veo si esta finalizada la Autoevaluacion, si es asi, muestro boton Ver Autoevaluacion
            $verifica_informe_ae = FinalizadoEvaluadoEvaluadorProProceso($ev->rut, $ev->rut, $ev->id_proceso);
            if ($verifica_informe_ae) {
                $total_evaluados = str_replace("{BOTON_VE_AE_}", file_get_contents("views/sgd/informe/tabla_superior_resumen/boton_ver_autoeval.html"), $total_evaluados);
            } else {
                $total_evaluados = str_replace("{BOTON_VE_AE_}", "adasd", $total_evaluados);
            }
            if ($tipo_sgd == 2) {
                $total_evaluados          = str_replace("{TABLA_RESUMEN1}", file_get_contents("views/sgd/informe/tabla_superior_resumen/tabla_resumen1_sinareacorp_dinamico_chilquinta.html"), $total_evaluados);
                $estado_liberado_feedback = LiberadoFeedbackLiberado($ev->rut, $ev->evaluador, $ev->calibrador, $ev->id_proceso, $id_empresa);
                $total_evaluados          = str_replace("{ETIQUETA_ESTADO}", $estado_liberado_feedback[0], $total_evaluados);
                //aca verifico de manera individual si es que fue liberado o no este evaluado
                if ($ev->rut == $ev->evaluador) {
                    $datos_relacion_jefatura = ObtenerJefeRelPorProceso($ev->rut, $id_proceso);
                    $evaluado_liberado       = TraeLiberadoEvaluadoEvaluadorCalibrador($ev->rut, $datos_relacion_jefatura[0]->evaluador, $datos_relacion_jefatura[0]->calibrador, $datos_relacion_jefatura[0]->id_proceso);
                } else {
                    $evaluado_liberado = TraeLiberadoEvaluadoEvaluadorCalibrador($ev->rut, $rut, $ev->calibrador, $ev->id_proceso);
                }
                $verifica_eval_finalizada = FinalizadoEvaluadoEvaluador($ev->rut, $rut, $ev->id_proceso);
                if ($evaluado_liberado) {
                    //$total_evaluados = str_replace("{BOTON_EVALUACION_INDIVIDUAL}","",$total_evaluados);
                    if ($verifica_eval_finalizada) {
                        $total_evaluados = str_replace("{BOTON_EVALUACION_INDIVIDUAL}", "", $total_evaluados);
                    } else {
                        if ($ev->rut == $ev->evaluador) {
                            $total_evaluados = str_replace("{BOTON_EVALUACION_INDIVIDUAL}", file_get_contents("views/sgd/informe/tabla_superior_resumen/boton_autoeval_individual.html"), $total_evaluados);
                        } else {
                            if ($id_empresa == 66) {
                                $total_evaluados = str_replace("{BOTON_EVALUACION_INDIVIDUAL}", "", $total_evaluados);
                            } else {
                                $total_evaluados = str_replace("{BOTON_EVALUACION_INDIVIDUAL}", file_get_contents("views/sgd/informe/tabla_superior_resumen/boton_eval_individual.html"), $total_evaluados);
                            }
                        }
                    }
                } else {
                    if ($datos_proceso_anual[0]->activo == 1) {
                        if ($ev->rut == $ev->evaluador) {
                            $total_evaluados = str_replace("{BOTON_EVALUACION_INDIVIDUAL}", file_get_contents("views/sgd/informe/tabla_superior_resumen/boton_autoeval_individual.html"), $total_evaluados);
                        } else {
                            if ($id_empresa == 66) {
                                $total_evaluados = str_replace("{BOTON_EVALUACION_INDIVIDUAL}", "", $total_evaluados);
                            } else {
                                $total_evaluados = str_replace("{BOTON_EVALUACION_INDIVIDUAL}", file_get_contents("views/sgd/informe/tabla_superior_resumen/boton_eval_individual.html"), $total_evaluados);
                            }
                        }
                    } else {
                        $total_evaluados = str_replace("{BOTON_EVALUACION_INDIVIDUAL}", "", $total_evaluados);
                    }
                }
                if ($ev->rut == $ev->evaluador) {
                    if ($evaluado_liberado) {
                        $total_evaluados = str_replace("{BOTON_FEEDBACK}", file_get_contents("views/sgd/boton_evalua_feedback.html"), $total_evaluados);
                    } else {
                        $total_evaluados = str_replace("{BOTON_FEEDBACK}", "", $total_evaluados);
                    }
                } else {
                    $total_evaluados = str_replace("{BOTON_FEEDBACK}", "", $total_evaluados);
                }
                //Verifico si está finalizada la evaluacion de este proceso
                if ($verifica_eval_finalizada) {
                    if ($evaluado_liberado) {
                        if ($ev->rut == $ev->evaluador) {
                            $total_evaluados = str_replace("{BOTON_VE_INFORME_POR_PROCESO}", "", $total_evaluados);
                        } else {
                            $total_evaluados = str_replace("{BOTON_VE_INFORME_POR_PROCESO}", file_get_contents("views/sgd/informe/tabla_superior_resumen/boton_ve_informe.html"), $total_evaluados);
                        }
                    } else {
                        $total_evaluados = str_replace("{BOTON_VE_INFORME_POR_PROCESO}", file_get_contents("views/sgd/informe/tabla_superior_resumen/boton_ve_informe.html"), $total_evaluados);
                    }
                } else {
                    $total_evaluados = str_replace("{BOTON_VE_INFORME_POR_PROCESO}", "", $total_evaluados);
                }
                $total_evaluados = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($ev->rut), $total_evaluados);
                $total_evaluados = str_replace("{ID_PROCESO_ENCODEADO}", Encodear3($id_proceso), $total_evaluados);
                //Aca traigo la nota final de cadaevaluadopara acumular y mostrar en el resumen superior
                //$datos_resumen=ResultadosFinales($ev->rut, $rut, $id_proceso, "");
                //if($datos_resumen[27]>0){
                //    $acummulador_notas=$acummulador_notas+$datos_resumen[27];
                //    $contador++;
                //}
            } else {
                $total_evaluados = str_replace("{TABLA_RESUMEN1}", file_get_contents("views/sgd/informe/tabla_superior_resumen/tabla_resumen1_sinareacorp_dinamico.html"), $total_evaluados);
            }
            $total_evaluados    = ArmaTemplareDeTablaResumen($total_evaluados, $proceso_anual, $id_empresa, $ev->perfil_evaluacion, $ev->rut, $rut, "no");
            //Verifico si está finalizado este evaluado en el proceso de objetivos
            $feedback_objetivos = TomoConocimientoEvaluado($ev->rut);
            if ($feedback_objetivos) {
                $obj_fin++;
            }
            //$total_evaluados = ColocaPonderaciones($total_evaluados, $ev->rut);
            $total_evaluados = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($ev->rut), $total_evaluados);
            //$total_evaluados=ColocaResultadosTablaReumen($total_evaluados, $ev->rut, $rut);
            $total_evaluados = SemaforosEstadosObjetivos($total_evaluados, $ev->rut, $_SESSION["ano_proceso_anual"]);
            //COMENTADO PARA OPTIMIZAR 22-11-2015
            //$total_evaluados = str_replace("{PARAMETROS_EVAL}",Encodear3($ev->rut.";".$rut),$total_evaluados);
        }
        $nota_final_evaluados = $acummulador_notas / $contador;
        /*
        if($nota_final_evaluados){
        $datos_nota_final_evaluados=ObtenerCriterioPuntajeMatrizNotaFinal($nota_final_evaluados, $rut, 0, "nota_final");
        $entorno = str_replace("{NOTA_FINAL}",ColocaDecimalesNotasFinales(2, $nota_final_evaluados),$entorno);
        $entorno = str_replace("{ESTILO_NOTA_FINAL}",$datos_nota_final_evaluados[2],$entorno);
        $entorno = str_replace("{ICONO_NOTA_FINAL}",$datos_nota_final_evaluados[3],$entorno);
        $entorno = str_replace("{CRITERIO_NOTA_FINAL}",$datos_nota_final_evaluados[0],$entorno);
        }else{
        $entorno = str_replace("{NOTA_FINAL}","",$entorno);
        $entorno = str_replace("{ESTILO_NOTA_FINAL}","etiquetaPrograma-pendiente",$entorno);
        $entorno = str_replace("{ICONO_NOTA_FINAL}","circle-icon-sgd-3",$entorno);
        $entorno = str_replace("{CRITERIO_NOTA_FINAL}","Pendiente",$entorno);
        }*/
        $entorno              = ObtieneResumenesNotasFinalesPorEvaluador($entorno, $rut, $id_proceso);
        //aca calculo el porcentaje de avance de objetivos de todos los colaboradores.
        $entorno              = str_replace("{POR_AVANCE_OBJ}", ($obj_fin * 100) / count($evaluados), $entorno);
        $entorno              = str_replace("{POR_AVANCE_EV_EQUIPO}", 0, $entorno);
        $entorno              = str_replace("{LISTADO_COLABORADORES}", ($total_evaluados), $entorno);
        $html                 = str_replace("{ENTORNO_LISTADO_COLABORADORES}", ($entorno), $html);
    }
    return ($html);
}
function SemaforosEstadosObjetivos($html, $rut, $proceso_anual)
{
    $id_empresa = $_SESSION["id_empresa"];
    if ($id_empresa == 28) {
        $tipo_semaforos = "";
    } else {
        $tipo_semaforos = "evaluacion";
    }
    $total_estados     = 7;
    $estado_finalizado = 0;
    $estados           = TraeDatosParaSemaforo($rut);
    $datos_evaluacion  = ObtenerJefeRel($rut);
    $semaforo_etapa_1  = 0;
    if ($proceso_anual) {
        //datosPRocesoAnual
        $datos_proceso_anual = DatosProcesoAnual($proceso_anual, $id_empresa);
        $procesos            = ProcesosEvalPorProcesoAnualParaTabla($datos_proceso_anual[0]->id, $tipo_semaforos);
        foreach ($procesos as $proc) {
            $template_etapas .= file_get_contents("views/sgd/listado_colaboradores/pasos/titulo.html");
            $etapas_por_proceso = EtapasPorProceso($proc->id_proceso);
            $template_etapas    = str_replace("{TITULO}", $proc->descripcion_proceso, $template_etapas);
            $template_etapas    = str_replace("{DESCRIPCION}", $proc->descripcion, $template_etapas);
            $template_etapas    = str_replace("{ETIQUETA_SEMAFORO}", $proc->etiqueta_semaforo, $template_etapas);
            foreach ($etapas_por_proceso as $eta) {
                $template_etapas .= file_get_contents("views/sgd/listado_colaboradores/pasos/etapa.html");
                $template_etapas = str_replace("{NOMBRE}", $eta->etapa, $template_etapas);
                $template_etapas = str_replace("{ETIQUETA_SEMAFORO}", $eta->etiqueta_semaforo, $template_etapas);
                $template_etapas = str_replace("{ID_ETAPA}", $eta->id, $template_etapas);
            }
            $template_etapas .= '<tr><td colspan="2" class="height12px"></td></tr>';
        }
        $html = str_replace("{PASOS}", utf8_encode($template_etapas), $html);
    } else {
        if ($estados[0]->dato_empresa_finalizado && $estados[0]->dato_area_finalizado) {
            $html = str_replace("{SEMAFORO1}", "fa fa-check text-iconos", $html);
            $estado_finalizado++;
            $semaforo_etapa_1++;
        } else {
            $html = str_replace("{SEMAFORO1}", "fa fa-circle-thin text-iconos", $html);
        }
        if ($estados[0]->dato_individual_finalizado) {
            $html = str_replace("{SEMAFORO2}", "fa fa-check text-iconos", $html);
            $estado_finalizado++;
            $semaforo_etapa_1++;
        } else {
            $html = str_replace("{SEMAFORO2}", "fa fa-circle-thin text-iconos", $html);
        }
        if ($estados[0]->dato_ajuste_jefatura) {
            $html = str_replace("{SEMAFORO3}", "fa fa-check text-iconos", $html);
            $estado_finalizado++;
            $semaforo_etapa_1++;
        } else {
            $html = str_replace("{SEMAFORO3}", "fa fa-circle-thin text-iconos", $html);
        }
        if ($estados[0]->dato_aceptacion_usuario) {
            $html = str_replace("{SEMAFORO5}", "fa fa-check text-iconos", $html);
            $html = str_replace("{SEMAFORO4}", "fa fa-check text-iconos", $html);
            $estado_finalizado++;
            $estado_finalizado++;
            $semaforo_etapa_1++;
            $semaforo_etapa_1++;
        } else {
            $html = str_replace("{SEMAFORO5}", "fa fa-circle-thin text-iconos", $html);
            $html = str_replace("{SEMAFORO4}", "fa fa-circle-thin text-iconos", $html);
        }
        if ($estados[0]->dato_aceptacion_competencias) {
            $html = str_replace("{SEMAFORO6}", "fa fa-check text-iconos", $html);
            $estado_finalizado++;
        } else {
            $html = str_replace("{SEMAFORO6}", "fa fa-circle-thin text-iconos", $html);
        }
    }
    if ($estados[0]->dato_ev_intermedia) {
        $html = str_replace("{SEMAFORO7}", "fa fa-check text-iconos", $html);
        $estado_finalizado++;
    } else {
        $html = str_replace("{SEMAFORO7}", "fa fa-circle-thin text-iconos", $html);
    }
    if ($estados[0]->dato_validacion_validador) {
        $html = str_replace("{SEMAFORO8}", "fa fa-check text-iconos", $html);
        $estado_finalizado++;
        $semaforo_etapa_1++;
    } else {
        $html = str_replace("{SEMAFORO8}", "fa fa-circle-thin text-iconos", $html);
    }
    $html = str_replace("{POR_AVANCE_OBJ}", number_format(($estado_finalizado * 100) / $total_estados, 0), $html);
    if ($semaforo_etapa_1 == 6) {
        $html = str_replace("{SEMAFOROETAPA1}", "circle-icon-sgd-rowcol etiquetaRowPrograma-terminado", $html);
    } else if ($semaforo_etapa_1 == 0) {
        $html = str_replace("{SEMAFOROETAPA1}", "circle-icon-sgd-rowcol etiquetaRowPrograma-pendiente", $html);
    } else {
        $html = str_replace("{SEMAFOROETAPA1}", "circle-icon-sgd-rowcol etiquetaRowPrograma-proceso", $html);
    }
    $html      = str_replace("{SEMAFOROETAPA2}", "circle-icon-sgd-rowcol etiquetaRowPrograma-pendiente", $html);
    $html      = str_replace("{SEMAFOROETAPA3}", "circle-icon-sgd-rowcol etiquetaRowPrograma-pendiente", $html);
    $por_mi_ev = PorcentajeEvaluacion($rut, $datos_evaluacion[0]->evaluador);
    $html      = str_replace("{POR_AVANCE_MI_EV}", $por_mi_ev, $html);
    return ($html);
}
function OptionsGenericoNombreDadoValores($tabla, $seleccionado, $campo_mostrar, $campo_valor, $order)
{
    $valores = ValorSelectDinaico2($tabla, $campo_mostrar, $campo_valor, $order);
    foreach ($valores as $val) {
        if ($val->id == $seleccionado) {
            $opciones .= "<option selected value='" . $val->id . "'>" . $val->nombre . "</option>";
        } else {
            $opciones .= "<option value='" . $val->id . "'>" . $val->nombre . "</option>";
        }
    }
    return (utf8_encode($opciones));
}
function OptionsGenericoNombreDadoValoresPorEmpresa($tabla, $seleccionado, $campo_mostrar, $campo_valor, $order, $id_empresa)
{
    if ($id_empresa) {
        $valores = ValorSelectDinaico2PorEmpresa($tabla, $campo_mostrar, $campo_valor, $order, $id_empresa);
    } else {
        $valores = ValorSelectDinaico2($tabla, $campo_mostrar, $campo_valor, $order);
    }
    foreach ($valores as $val) {
        if ($val->id == $seleccionado) {
            $opciones .= "<option selected value='" . $val->id . "'>" . $val->nombre . "</option>";
        } else {
            $opciones .= "<option value='" . $val->id . "'>" . $val->nombre . "</option>";
        }
    }
    return (utf8_encode($opciones));
}
function OptionsGenericoNombrePorEmpresa($tabla, $seleccionado, $id_empresa)
{
    $valores = ValorSelectDinaicoPorEmpresa($tabla, $id_empresa);
    foreach ($valores as $val) {
        if ($val->id == $seleccionado) {
            $opciones .= "<option selected value='" . $val->id . "'>" . $val->nombre . "</option>";
        } else {
            $opciones .= "<option value='" . $val->id . "'>" . $val->nombre . "</option>";
        }
    }
    return (utf8_encode($opciones));
}
function OptionsGenericoNombre($tabla, $seleccionado)
{
    $valores = ValorSelectDinaico($tabla);
    foreach ($valores as $val) {
        if ($val->id == $seleccionado) {
            $opciones .= "<option selected value='" . $val->id . "'>" . $val->nombre . "</option>";
        } else {
            $opciones .= "<option value='" . $val->id . "'>" . $val->nombre . "</option>";
        }
    }
    return (utf8_encode($opciones));
}
function OptionsGenerico($campo, $tabla, $seleccionado)
{
    $valores = SelectDistValor($campo, $tabla);
    foreach ($valores as $val) {
        if ($val->dato == $seleccionado) {
            $opciones .= "<option selected value='" . $val->dato . "'>" . $val->dato . "</option>";
        } else {
            $opciones .= "<option value='" . $val->dato . "'>" . $val->dato . "</option>";
        }
    }
    return (utf8_encode($opciones));
}
function OptionsProgramaPorEmpresa($seleccionado, $id_empresa)
{
    $valores = RelMallaProgramaPorEmpresa($id_empresa);
    foreach ($valores as $valor) {
        if ($valor->id_programa == $seleccionado) {
            $opciones .= "<option selected value='" . $valor->id_programa . "'>" . $valor->nombre_programa . "</option>";
        } else {
            $opciones .= "<option value='" . $valor->id_programa . "'>" . $valor->nombre_programa . "</option>";
        }
    }
    return ($opciones);
}
function OptionsGenericoPorEmpresa($campo, $tabla, $seleccionado, $id_empresa)
{
    if ($id_empresa) {
        $valores = SelectDistValorPorEmpresa($campo, $tabla, $id_empresa);
    } else {
        $valores = SelectDistValor($campo, $tabla);
    }
    foreach ($valores as $val) {
        if ($val->dato == $seleccionado) {
            $opciones .= "<option selected value='" . $val->dato . "'>" . $val->dato . "</option>";
        } else {
            $opciones .= "<option value='" . $val->dato . "'>" . $val->dato . "</option>";
        }
    }
    return (utf8_encode($opciones));
}
function EstadosObjetivosPorUsuario($html, $rut)
{
    return ($html);
}
function VerificaObjetivoEmpresaFinalizado($rut, $id_empresa)
{
    $verifica_finalizado = VerificaObjetivoEmpresa($rut, $id_empresa);
    if ($verifica_finalizado) {
        $arreglo[0] = "1";
    } else {
        $arreglo[0] = "0";
    }
    return ($arreglo);
}
function ListadoObjetivosEmpresa($rut)
{
    $html              = file_get_contents("views/sgd/sgd3_objetivos_empresa.html");
    $datos_usuario     = UsuarioEnBasePersonasInnerArea($rut);
    //print_r($datos_usuario);
    $objetivos_empresa = ObjetivosDeEmpresa($datos_usuario[0]->id_empresa);
    //print_r($objetivos_empresa);
    if (count($objetivos_empresa) == 0) {
        $total = file_get_contents("views/sgd/row_objetivos_empresa_no_tiene.html");
    } else {
        $total = "";
        foreach ($objetivos_empresa as $obj) {
            $total .= file_get_contents("views/sgd/row_objetivos_empresa.html");
            $total = str_replace("{OBJETIVO_EMPRESA}", utf8_encode($obj->descripcion_objetivo), $total);
        }
    }
    //Con este veo si finalizó o no los objetivos empresas
    $finalizado_objetivo_empresa = VerificaObjetivoEmpresa($rut, $datos_usuario[0]->id_empresa);
    if ($finalizado_objetivo_empresa) {
        $html  = str_replace("{BOTON_FINALIZA_EMPRESA}", file_get_contents("views/sgd/boton_ok_obj_empresa.html"), $html);
        $total = str_replace("{ESTILO_SEMAFORO}", "fa fa-check text-iconos", $total);
        $total = str_replace("{ESTILO_SEMAFORO_TR}", "tr_objetivos_activo ", $total);
    } else {
        $html  = str_replace("{BOTON_FINALIZA_EMPRESA}", file_get_contents("views/sgd/boton_pendiente.html"), $html);
        $html  = str_replace("{RUT_ENCODEADO}", Encodear3($rut), $html);
        $html  = str_replace("{ID_EMPRESA_ENCODEADA}", Encodear3($datos_usuario[0]->id_empresa), $html);
        $total = str_replace("{ESTILO_SEMAFORO}", "fa fa-circle-thin text-iconos", $total);
        $total = str_replace("{ESTILO_SEMAFORO_TR}", "tr_objetivos_pasivo ", $total);
    }
    $html = str_replace("{LISTADO_OBJETIVOS_EMPRESA}", $total, $html);
    return ($html);
}
function ListadoObjetivosArea($rut)
{
    $html           = file_get_contents("views/sgd/sgd3_objetivos_area.html");
    //Primero obtengo los datos del usuario, para traer el id del Area
    $datos_usuario  = UsuarioEnBasePersonasInnerArea($rut);
    //con el id del area, y el id de la empresa, traigo los datos de los objetivos de area
    $objetivos_area = DatosObjetivosArea($datos_usuario[0]->id_area, $datos_usuario[0]->id_empresa);
    if (count($objetivos_area) == 0) {
        $total = file_get_contents("views/sgd/row_objetivos_area_no_tiene.html");
        $total = str_replace("{AREA}", utf8_encode($datos_usuario[0]->nombre_area), $total);
    } else {
        foreach ($objetivos_area as $obj) {
            $total .= file_get_contents("views/sgd/row_objetivos_area.html");
            $total = str_replace("{AREA}", utf8_encode($obj->descripcion_objetivo), $total);
        }
    }
    //Aca verifico si es que fueron finalizados los objetivos de Area
    $objetivos_area_finalizado = VerificaFinalizadoObjetivosArea($rut, $datos_usuario[0]->id_area);
    if ($objetivos_area_finalizado) {
        $html  = str_replace("{BOTON_FINALIZA_OBJETIVOS_AREA}", file_get_contents("views/sgd/boton_ok_obj_area.html"), $html);
        $total = str_replace("{ESTILO_SEMAFORO}", "fa fa-check text-iconos", $total);
        $total = str_replace("{ESTILO_SEMAFORO_TR}", "tr_objetivos_activo ", $total);
    } else {
        $html  = str_replace("{BOTON_FINALIZA_OBJETIVOS_AREA}", file_get_contents("views/sgd/boton_pendiente_area.html"), $html);
        $html  = str_replace("{RUT_ENCODEADO}", Encodear3($rut), $html);
        $html  = str_replace("{ID_EMPRESA_ENCODEADA}", Encodear3($datos_usuario[0]->id_empresa), $html);
        $html  = str_replace("{ID_AREA_ENCODEADA}", Encodear3($datos_usuario[0]->id_area), $html);
        $total = str_replace("{ESTILO_SEMAFORO}", "fa fa-circle-thin text-iconos", $total);
        $total = str_replace("{ESTILO_SEMAFORO_TR}", "tr_objetivos_pasivo ", $total);
    }
    $html = str_replace("{LISTADO_OBJETIVOS_AREA}", $total, $html);
    return ($html);
}
function MuestraObjetivos($html, $rut, $id_proceso)
{
    if ($id_proceso) {
        $datos_usuario = UsuarioEnBasePersonasConRelacionEvaluadoEvaluadorDadoEvaluado($rut, $id_proceso);
    } else {
        $datos_usuario = UsuarioEnBasePersonasInnerArea($rut);
    }
    //Objetivos Empresa
    $listado_objetivos_empresa    = ListadoObjetivosEmpresa($rut);
    $html                         = str_replace("{BLOQUE_OBJETIVOS_EMPRESA}", $listado_objetivos_empresa, $html);
    //Verifico si esta finalizado los objetivos de empresa
    $objetivos_empresa_finalizado = VerificaObjetivoEmpresa($rut, $datos_usuario[0]->id_empresa);
    if ($objetivos_empresa_finalizado) {
        //Objetivos Area. Los muestro
        $listado_objetivos_area = ListadoObjetivosArea($rut);
        $html                   = str_replace("{BLOQUE_OBJETIVOS_AREA}", $listado_objetivos_area, $html);
    } else {
        //Objetivos Area. No los muestro hasta que se finalize.
        $html = str_replace("{BLOQUE_OBJETIVOS_AREA}", "", $html);
    }
    //Verifico si está finalizado los objetivos del area.
    $objetivos_area_finalizado = VerificaFinalizadoObjetivosArea($rut, $datos_usuario[0]->id_area);
    if ($objetivos_area_finalizado) {
        $html = str_replace("{BLOQUE_OBJETIVOS_INDIVIDUALES}", "", $html);
    } else {
        $html = str_replace("{BLOQUE_OBJETIVOS_INDIVIDUALES}", "", $html);
    }
    return ($html);
}
function MuestaDatosEval($html, $rut, $rut_evaluador, $id_proceso)
{
    //Datos del usuario
    //$html=ColocaDatosUsuario($html, $rut, "", $rut_evaluador, $id_proceso);
    $html = ColocaDatosUsuarioSGD($html, $rut, "", $rut_evaluador, $id_proceso);
    return ($html);
}
//FUNCION PARA OBTENER DIFERENTES DATOS DE UN CURSO, DADO EL ID DEL CURSO Y EL RUT
function ObtenerNotaEstadoCursoDadoIdCursoRut($id_curso, $rut)
{
    //OBTENGO TODOS LOS DATOS DEL CURSO
    $objetos                   = ObjetosDadoCurso($id_curso, $rut);
    //EN ESTA VARIABLE ACUMULO EL TOTAL DE OBJETIVOS QUE TIENEN NOTA
    $total_notas               = 0;
    //EN ESTA VARIABLE ACUMULO LAS NOTAS
    $acum_notas                = 0;
    //EN ESTA VARIABLE ACUMULO EL TOTAL DE LOS OBJETOS QUE SE ENCUENTRAN FINALIZADOS
    $total_objetos_finalizados = 0;
    foreach ($objetos as $ob) {
        //CON ESTA CONDICION VEO SI EL OBJETOS TIENE NOTA DE FINALIZACION
        if ($ob->nota_objeto >= "0") {
            //INCREMENTO EL TOTAL DE OBJETOS CON NOTAS
            $total_notas++;
            //LA NOTA LA ACUMULO EN UNA VARIABLE, PARA DESPUES SACAR EL PROMEDIO DEL CURSO
            $acum_notas = $acum_notas + $ob->nota_objeto;
        }
        //CON ESTA CONDICION VERIFICO SI EL OBJETO EN CUESTION EST? FINALIZADO
        if ($ob->fecha_finalizacion) {
            //EN LA SIGUIENTE, ACUMULO LOS OBJETIVOS FINALIZADOS, PARA DESPUES COMPARAR SI ESTAN TODOS FINAIZADOS
            $total_objetos_finalizados++;
        }
    }
    //EN EL ARREGLO[0], GUARDO LA NOTA DEL CURSO, EN BASE A LAS EVALUACIONES FINALIZADAS.
    $arreglo[0] = number_format($acum_notas / $total_notas, 0);
    //ESTA FUNCION ME ENTREGA DE VUELTA SI EST? O NO APROBADA EN BASE A LA NOTA CALCULADA.
    $estado     = ApruebaReprueba($arreglo[0]);
    //PRIMERO VEO SI EL CONTADOR DE OBJETOS FINALIZADOS ESTA EN 0, SI ES ASI, ES PORQUE NO SE HA FINALIZADO NINGUN OBJETO, POR ENDE ESTA NO INICIADO
    if ($total_objetos_finalizados == 0) {
        $arreglo[1] = "no_iniciado";
        //CON LA SIGUIENTE,VEO SI ESQUE ES DIFERENTE A 0 EL TOTAL DE OBJETIVOS, PERO MENOR AL TOTAL DE OBJETOS, IMPLICA QUE ESTA EN PROCESO
    } else if ($total_objetos_finalizados < count($objetos)) {
        $arreglo[1] = "en_proceso";
        //CON LA SIGUIENTE SE ASUME QUE ESTAN TODOS FINALIZADOS, Y DEVUELTA ENTREGA "SI" EST? O "NO" APROBADO EL CURSO.
    } else {
        $arreglo[1] = $estado[2];
    }
    return ($arreglo);
}
//OJO, que la variable, arreglo_post, se está enviando desde los filtros del administrador.
function ObtenerUsuariosDadoCurso($id_curso, $arreglo_post)
{
    //CON ESTA FUNCION OBTENGO EL LISTADO DE USUARIOS QUE ESTAN ASOCIADOS AL CURSO EN CUESTION
    //Primero obtengo las mallas del curso
    $mallas_dado_curso = ObtenerCargosDadoIdCurso($id_curso);
    //Con los datos de la tabla rel_malla, traigo a los usuarios
    $i                 = 0;
    $aprobados         = 0;
    $reprobados        = 0;
    foreach ($mallas_dado_curso as $valores) {
        //Con cada criterio, traigo los usuarios, y los voy guardando en un arreglo.
        //Traigo los usuarios
        $usuarios = TraeUsuariosDadoCriterio($valores->campo, $valores->cargo, $arreglo_post);
        foreach ($usuarios as $unico) {
            $arreglo_usurios[$i] = $unico->rut;
            $i++;
        }
    }
    $arreglo[0] = count($arreglo_usurios);
    for ($j = 0; $j < count($arreglo_usurios); $j++) {
        $aprueba_reprueba = ObtenerNotaEstadoCursoDadoIdCursoRut($id_curso, $arreglo_usurios[$j]);
        if ($aprueba_reprueba[1] == "si") {
            $aprobados++;
        } else if ($aprueba_reprueba[1] == "no") {
            $reprobados++;
        } else if ($aprueba_reprueba[1] == "no_iniciado") {
            $no_iniciados++;
        } else if ($aprueba_reprueba[1] == "en_proceso") {
            $en_proceso++;
        }
    }
    $arreglo[1] = $aprobados;
    $arreglo[2] = $reprobados;
    $arreglo[3] = $en_proceso;
    $arreglo[4] = $no_iniciados;
    return ($arreglo);
}
function TotalCursosPorUsuario($rut, $id_cargo, $id_empresa)
{
    //Dado el usuario, obtengo la malla, y su cantidad de programas.
    $datos_malla                  = ObtengoIdMalla($id_empresa, $id_cargo);
    $programas                    = ProgramasDadoMalla($datos_malla[0]->id_malla);
    $total_cursos                 = 0;
    $total_cursos_aprobados       = 0;
    $total_cursos_reprobados      = 0;
    $total_cursos_pendientes      = 0;
    $total_cursos_proceso         = 0;
    $acumulador_de_notas_de_curso = 0;
    foreach ($programas as $unico) {
        $datos_avance_porc_programa      = NotaPromedioProgramaDadoIdPrograma($rut, $unico->id);
        $total_cursos                    = $total_cursos + $datos_avance_porc_programa[3];
        $total_cursos_aprobados          = $total_cursos_aprobados + $datos_avance_porc_programa[4];
        $total_cursos_reprobados         = $total_cursos_reprobados + $datos_avance_porc_programa[5];
        $total_cursos_pendientes         = $total_cursos_pendientes + $datos_avance_porc_programa[6];
        $total_cursos_proceso            = $total_cursos_proceso + $datos_avance_porc_programa[7];
        $acumulador_de_notas_de_curso    = $acumulador_de_notas_de_curso + $datos_avance_porc_programa[8];
        $acumulador_de_total_notas_curso = $acumulador_de_total_notas_curso + $datos_avance_porc_programa[9];
    }
    //Total de Cursos por programa
    $arreglo_programa[0] = $total_cursos;
    $arreglo_programa[1] = $total_cursos_aprobados;
    $arreglo_programa[2] = $total_cursos_reprobados;
    $arreglo_programa[3] = $total_cursos_pendientes;
    $arreglo_programa[4] = $total_cursos_proceso;
    $arreglo_programa[5] = number_format($acumulador_de_notas_de_curso / $acumulador_de_total_notas_curso, 0);
    return ($arreglo_programa);
}
function DevuelveEstadoProgramaCursos($nota, $avance_programa, $id, $id_malla, $tipo)
{
    if ($tipo == "programa") {
        $nota_aprobacion = NotaAprobacionDadoMallaPrograma($id_malla, $id);
    } else if ($tipo == "curso") {
        $nota_aprobacion = DatosObjeto($id);
    }
    if ($avance_programa == 0) {
        $arreglo[0] = '<span class="fa fa-circle text-pendiente fs14 mr10"></span>&nbsp;<span class="etiquetaPrograma etiquetaPrograma-pendiente">Pendiente</span>';
        $arreglo[1] = "#777777";
        $arreglo[2] = "etiquetaPrograma-pendiente";
        $arreglo[3] = "txto1-pendiente";
    } else if ($avance_programa == 100) {
        if ($nota >= $nota_aprobacion[0]->nota_aprobacion) {
            $arreglo[0] = '<span class="fa fa-circle text-success fs14 mr10"></span>&nbsp;<span class="etiquetaPrograma etiquetaPrograma-aprobado">Aprobado</span>';
            $arreglo[1] = "#35d37d";
            $arreglo[2] = "etiquetaPrograma-aprobado";
            $arreglo[3] = "texto1-aprobado";
        } else {
            $arreglo[0] = '<span class="fa fa-circle text-danger fs14 mr10"></span>&nbsp;<span class="etiquetaPrograma etiquetaPrograma-reprobado">.Reprobado</span>';
            $arreglo[1] = "#ec6f5a";
            $arreglo[2] = "etiquetaPrograma-reprobado";
            $arreglo[3] = "texto1-reprobado";
        }
    } else {
        $arreglo[0] = '<span class="fa fa-circle text-warning fs14 mr10"></span>&nbsp;<span class="etiquetaPrograma etiquetaPrograma-proceso">En Proceso</span>';
        $arreglo[1] = "#f6bb42";
        $arreglo[2] = "etiquetaPrograma-proceso";
        $arreglo[3] = "texto1-proceso";
    }
    return ($arreglo);
}
function DevuelveEstadoPrograma($nota_programa, $avance_programa, $id_programa, $id_malla)
{
    $nota_programa_requerida = NotaAprobacionDadoMallaPrograma($id_malla, $id_programa);
    if ($avance_programa == 0) {
        $arreglo[0] = '<span class="fa fa-circle text-pendiente fs14 mr10"></span>&nbsp;<span class="etiquetaPrograma etiquetaPrograma-pendiente">Pendiente</span>';
        $arreglo[1] = "#777777";
        $arreglo[2] = "etiquetaPrograma-pendiente";
        $arreglo[3] = "txto1-pendiente";
    } else if ($avance_programa == 100) {
        if ($nota_programa >= $nota_programa_requerida[0]->nota_aprobacion) {
            $arreglo[0] = '<span class="fa fa-circle text-success fs14 mr10"></span>&nbsp;<span class="etiquetaPrograma etiquetaPrograma-aprobado">Aprobado</span>';
            $arreglo[1] = "#35d37d";
            $arreglo[2] = "etiquetaPrograma-aprobado";
            $arreglo[3] = "texto1-aprobado";
        } else {
            $arreglo[0] = '<span class="fa fa-circle text-danger fs14 mr10"></span>&nbsp;<span class="etiquetaPrograma etiquetaPrograma-reprobado">.Reprobado</span>';
            $arreglo[1] = "#ec6f5a";
            $arreglo[2] = "etiquetaPrograma-reprobado";
            $arreglo[3] = "texto1-reprobado";
        }
    } else {
        $arreglo[0] = '<span class="fa fa-circle text-warning fs14 mr10"></span>&nbsp;<span class="etiquetaPrograma etiquetaPrograma-proceso">En Proceso</span>';
        $arreglo[1] = "#f6bb42";
        $arreglo[2] = "etiquetaPrograma-proceso";
        $arreglo[3] = "texto1-proceso";
    }
    return ($arreglo);
}
function NotaPromedioProgramaDadoIdPrograma($rut, $id_programa)
{
    $cursos                              = CantidadCursosPorPrograma($id_programa);
    $total_cursos_fin                    = 0;
    $total_notas                         = 0;
    $acum_notas                          = 0;
    $acumulacion_tiempo                  = 0;
    $total_objetos_finalizados           = 0;
    $total_objetos                       = 0;
    $avance_general_malla                = 0;
    $acumulador_avance_por_curso         = 0;
    $total_cursos_aprobados              = 0;
    $total_cursos_reprobados             = 0;
    $total_cursos_pendientes             = 0;
    $total_cursos_proceso                = 0;
    //Con esta variable, voy acumulando la suma de las notas de los cursos
    $acumulador_notas_curso_por_programa = 0;
    //La siguiente varible, la ocupo para poder ir acumulando cuantos cursos voy a contar para sacar el promedio
    $total_cursos_para_promedio          = 0;
    foreach ($cursos as $cur) {
        $detalle_avance_curso = PorcentajeAvanceCurso($cur->id, $rut);
        //Ver si el curso está aprobado
        if ($detalle_avance_curso[4] == 1) {
            $total_cursos_aprobados++;
            //Ver si el curso no está aprobado
        } else if ($detalle_avance_curso[4] == 2) {
            $total_cursos_reprobados++;
            //Ver si el curso esta pendiente
        } else if ($detalle_avance_curso[4] == 3) {
            $total_cursos_pendientes++;
            //Ver si el curso está en proceso
        } else if ($detalle_avance_curso[4] == 4) {
            $total_cursos_proceso++;
        }
        if ($detalle_avance_curso[3] >= "0") {
            $acumulador_notas_curso_por_programa = $acumulador_notas_curso_por_programa + $detalle_avance_curso[3];
            $total_cursos_para_promedio++;
        }
        $total_objetos_finalizados_por_curso = 0;
        $curso_fin                           = VErificaCursoFinalizado($cur->id, $rut);
        if ($curso_fin) {
            $total_cursos_fin++;
        }
        $objetos = ObjetosDadoCurso($cur->id, $rut);
        foreach ($objetos as $ob) {
            $total_objetos++;
            if ($ob->nota_objeto >= "0") {
                $total_notas++;
                $acum_notas = $acum_notas + $ob->nota_objeto;
            }
            if ($ob->fecha_finalizacion) {
                $total_objetos_finalizados++;
                $total_objetos_finalizados_por_curso++;
            }
        }
        //ACA debiese sacar el promedio de cada curso, e ir acumulando, para despues aplicar el porcentaje correspondiente
        $acumulador_avance_por_curso = $acumulador_avance_por_curso + (($total_objetos_finalizados_por_curso * 100) / count($objetos));
    }
    @$arreglo[0] = number_format($acum_notas / $total_notas, 0);
    @$arreglo[1] = number_format(($total_objetos_finalizados * 100) / $total_objetos, 0);
    //Porcentaje de Avance
    @$arreglo[2] = number_format($acumulador_avance_por_curso / count($cursos), 0);
    //Total de cursos por programa
    $arreglo[3] = count($cursos);
    //Total de cursos aprobados por programa
    $arreglo[4] = $total_cursos_aprobados;
    //Total de cursos reprobados por programa
    $arreglo[5] = $total_cursos_reprobados;
    //Total d cursos pendientes por programa
    $arreglo[6] = $total_cursos_pendientes;
    //Total de cursos en proceso
    $arreglo[7] = $total_cursos_proceso;
    //la suma de todos los promedios de los cursos
    $arreglo[8] = $acumulador_notas_curso_por_programa;
    //este contador es para que despues se pueda promediar las notas de los cursos
    $arreglo[9] = $total_cursos_para_promedio;
    return ($arreglo);
}
function ColocarSliderPorNoticia($PRINCIPAL, $id_empresa)
{
    //$todos=TraeSliders($id_empresa);
    //$todos=TraeSlidersOrderByDesc($id_empresa);
    //Traigo las noticias de la empresa, con el campo slider = 1
   /* $todos = TraeSlidersPorNoticias($id_empresa);
    $i     = 1;
    foreach ($todos as $uno) {
        $li .= file_get_contents("views/slider/row_li.html");
        $row .= file_get_contents("views/slider/row_sliders_noticias.html");
        //if($uno->slider_activo==1){
        if ($i == 1) {
            $row = str_replace("{ACTIVO}", "active", $row);
            $li  = str_replace("{CLASS_ACTIVO}", 'class="active"', $li);
        } else {
            $row = str_replace("{ACTIVO}", '', $row);
            $li  = str_replace("{CLASS_ACTIVO}", "", $li);
        }
        $i++;
        $row = str_replace("{IMAGEN_SLIDER}", $uno->imagen_slider, $row);
        $li  = str_replace("{NUMERO}", $uno->slider_activo - 1, $li);
        if ($uno->link_target_blank) {
            $row = str_replace("{TITULO}", "<a target='_blank'  href='" . $uno->link_target_blank . "'><span class='caption-title_href'>" . $uno->titulo . "</span></a>", $row);
        } else if ($uno->titulo && $uno->contenido) {
            $row = str_replace("{TITULO}", "<a  href='?sw=detnot&id=" . Encodear($uno->id) . "'><span class='caption-title_href'>" . $uno->titulo . "</span></a>", $row);
        } else {
            $row = str_replace("{TITULO}", $uno->titulo, $row);
        }
        $row = str_replace("{SUBTITULO}", $uno->bajada, $row);
    }
    $PRINCIPAL = str_replace("{SLIDERS_TODOS}", utf8_encode($row), $PRINCIPAL);
    $PRINCIPAL = str_replace("{LISTADO_LI}", $li, $PRINCIPAL);
   */ return ($PRINCIPAL);
}
function ColocarSlider($PRINCIPAL)
{

    return ($PRINCIPAL);
}
function ColocarSlider3($PRINCIPAL)
{
    $todos = TraeSliders($_SESSION["id_empresa"]);
    foreach ($todos as $uno) {
        $row .= file_get_contents("views/home/row_sliders3.html");
        $row = str_replace("{ACTIVO}", $uno->activo, $row);
        $row = str_replace("{IMAGEN_SLIDER}", $uno->imagen, $row);
        $row = str_replace("{ALT_IMAGEN}", $uno->descripcion, $row);
        $row = str_replace("{TITULO}", $uno->titulo, $row);
        $row = str_replace("{SUBTITULO}", $uno->subtitulo, $row);
    }
    $PRINCIPAL = str_replace("{SLIDERS_TODOS}", utf8_encode($row), $PRINCIPAL);
    return ($PRINCIPAL);
}
function ColocarSlider2($PRINCIPAL)
{
    $todos = TraeSliders($_SESSION["id_empresa"]);
    foreach ($todos as $uno) {
        $row .= file_get_contents("views/home/row_sliders2.html");
        $row = str_replace("{ACTIVO}", $uno->activo, $row);
        $row = str_replace("{IMAGEN_SLIDER}", $uno->imagen, $row);
        $row = str_replace("{ALT_IMAGEN}", $uno->descripcion, $row);
        $row = str_replace("{TITULO}", $uno->titulo, $row);
        $row = str_replace("{SUBTITULO}", $uno->subtitulo, $row);
    }
    $PRINCIPAL = str_replace("{SLIDERS_TODOS}", utf8_encode($row), $PRINCIPAL);
    return ($PRINCIPAL);
}
function VerificaProgramaFinalizado($id_programa, $rut, $id_malla)
{
    //Primero verifico si el programa está finalizado
    $programa_finalizado = VeProgramaFinalizado($id_programa, $rut);
    if ($programa_finalizado) {
    } else {
        //Traigo los niveles del programa, para verificar si está finalizado o no, si es asi, inserto
        //el registro de programa finalizado
        $niveles          = NivelesDadoPrograma($id_programa);
        $nivel_finalizado = 0;
        if (count($niveles) > 0) {
            foreach ($niveles as $niv) {
                //Por cada uno verifico si están finalizados
                $verifica_nivel_finalizado = VerificaNivelFinalizadoDadoNivelPrograma($id_programa, $niv->id, $rut);
                if ($verifica_nivel_finalizado)
                    $nivel_finalizado++;
            }
            //Aca comparo, y si son iguales, inserto el registro de programa finalizado
            if ($nivel_finalizado == count($niveles)) {
                //Aca inserto el registro finalizado programa
                InsertaProgramaFinalizado($id_programa, $rut, $id_malla);
            }
        }
    }
}
function VerificaNivelFinalizado($id_nivel, $rut, $id_programa)
{
    $nivel_finalizado = VerificaNivelFinalizadoDadoNivelPrograma($id_programa, $id_nivel, $rut);
    if ($nivel_finalizado) {
    } else {
        //Traigo el total de cursos asociados a este nivel
        $total_cursos = CursosDadoNivel($id_nivel);
        foreach ($total_cursos as $curso_unico) {
            $curso_finalizado = VErificaCursoFinalizado($curso_unico->id, $rut);
            if ($curso_finalizado)
                $finalizado++;
        }
        if ($finalizado == count($total_cursos)) {
            //Inserto Finalizado
            InsertaNivelFinalizado($id_nivel, $rut, $id_programa);
        }
    }
}
function ArmaCronometro($id_curso, $id_evaluacion, $rut, $PRINCIPAL, $id_objeto, $id_inscripcion)
{

    $id_curso_encodeado=Encodear3($id_curso);
    $id_inscripcion_encodeado=Encodear3($id_inscripcion);
    $timestamp    = time();
    $datos_objeto = DatosObjeto($id_evaluacion);
    $id_objeto_encodeado=Encodear3($id_objeto);

    if ($datos_objeto[0]->currentorg) {
        $diff = strtotime($datos_objeto[0]->currentorg) - strtotime('TODAY'); //<-Time of countdown in seconds.  ie. 3600 = 1 hr. or 86400 = 1 day.
        //echo strtotime($datos_objeto[0]->currentorg) - strtotime('TODAY'); // 3600
    } else {
        $diff = 14400; //<-Time of countdown in seconds.  ie. 3600 = 1 hr. or 86400 = 1 day.
    }
    //MODIFICATION BELOW THIS LINE IS NOT REQUIRED.
    $hld_diff = $diff;
    if (isset($_SESSION['ts'])) {
        $slice = ($timestamp - $_SESSION['ts']);
        $diff  = $diff - $slice;
    }
    if (!isset($_SESSION['ts']) || $diff > $hld_diff || $diff < 0) {
        $diff           = $hld_diff;
        $_SESSION['ts'] = $timestamp;
    }
    //Below is demonstration of output.  Seconds could be passed to Javascript.
    $diff; //$diff holds seconds less than 3600 (1 hour);
    $hours   = floor($diff / 3600) . ' : ';
    $diff    = $diff % 3600;
    $minutes = floor($diff / 60) . ' : ';
    $diff    = $diff % 60;
    $seconds = $diff;
    //echo '<div id="timmer"></div>';
    //$PRINCIPAL = str_replace("{TIMMER}","<div id='strclock'></div><input type='text' readonly id='cronometro' name='cronometro'>",$PRINCIPAL);
?>
<?php
    $js_cronometro = '
<script type="text/javascript">
var hour = ' . floor((int)$hours) . ';
var min = ' . floor((int)$minutes) . ';
var sec = ' . floor((int)$seconds) . ';

var id_curso ="'.$id_curso.'";
var id_inscripcion ="'.$id_inscripcion.'";
var id_objeto ="'.$id_objeto.'";

function doSubmit() {
//btn_submit is the name of the SUBMIT button in the form
document.f1.btn_submit.click();
}
function countdown() {
if(sec <= 0 && min > 0) {
sec = 59;
min -= 1;
}
else if(min <= 0 && sec <= 0) {
min = 0;
sec = 0;
}
else {
sec -= 1;
}
if(min <= 0 && hour > 0) {
min = 59;
hour -= 1;
}
var pat = /^[0-9]{1}$/;
sec = (pat.test(sec) == true) ? "0"+sec : sec;
min = (pat.test(min) == true) ? "0"+min : min;
hour = (pat.test(hour) == true) ? "0"+hour : hour;
document.getElementById("strclock").innerHTML = hour+":"+min+":"+sec;
document.getElementById("cronometro").value= hour+":"+min+":"+sec;
setTimeout("countdown()",1000);
//AUTO SUBMIT
if(min == 00 && sec ==00  ){
    alert("Tiempo agotado");
    location.href="?sw=detalle_cursoCap_exit";
}
}
countdown();
</script>
';
?>
<!------- JAVA SCRIPT--------->
<?php
    echo utf8_encode($PRINCIPAL);
    $_SESSION["objeto_exit"]=$id_objeto;
    $_SESSION["inscripcion_exit"]=$id_inscripcion;
    $_SESSION["curso_exit"]=$id_curso;


    echo $js_cronometro;
    //print_r($_SESSION);



}
Function VerificaFotoPersonal($rut)
{
   
        $datos_usuario     = UsuarioEnBasePersonas($rut);
        $rut_completo      = $datos_usuario[0]->rut_completo;
        $ruta              = "img/personas/" . $rut;
        $ruta_rut_completo = "img/personas/" . $rut_completo;
    
        if (file_exists($ruta . ".jpg")) {
            $imagen = $ruta . ".jpg";
        } else if (file_exists($ruta . ".JPG")) {
            $imagen = $ruta . ".JPG";
        } else if (file_exists($ruta . ".gif")) {
            $imagen = $ruta . ".gif";
        } else if (file_exists($ruta_rut_completo . ".jpg")) {
            $imagen = $ruta_rut_completo . ".jpg";
        } else if (file_exists($ruta_rut_completo . ".JPG")) {
            $imagen = $ruta_rut_completo . ".JPG";
        } else if (file_exists($ruta_rut_completo . ".gif")) {
            $imagen = $ruta_rut_completo . ".gif";
        } else {
            $imagen = "img/sinfoto.png";
        }
    
    // avatar biografia
    //echo "<br><br>imagen $imagen rut $rut<br><br>";
    if ($imagen == "img/sinfoto.png" or $imagen == "img/personas/.jpg") {
        //echo "..avatar biografia rut $rut";
        $biografia = TraeDatosBiografiayUsuario($rut, $_SESSION["id_empresa"]);
        //print_r($biografia);



       if ($biografia[0]->miavatar <> '') {

                $imagen_def1 = "multimedia/" . ($biografia[0]->miavatar);
                    if (file_exists($imagen_def1)) {

                    $imagen=$imagen_def1;
                    //echo "<br>$rut El fichero $imagen_def1 existe. Avatar";
                }

                if($imagen==''){

                    $imagen_def2 = "multimedia/" . Encodear3($datos_usuario[0]->rut_completo) . ".jpg";
                        if (file_exists($imagen_def2)) {
                        $imagen=$imagen_def2;

                        //echo "<br>$rut El fichero $imagen_def2 existe. Default";
                    }
                }


        } else {
                    //echo "hola";


                    $imagen_def2 = "multimedia/" . Encodear3($datos_usuario[0]->rut_completo) . ".jpg";
                    //echo "imagen_def2 $imagen_def2";
                    if (file_exists($imagen_def2)) {
                    $imagen=$imagen_def2;

                    //echo "<br>$rut No Hay Avatar El fichero $imagen_def2 existe. Default";
                }

        }
        //echo "<br><br>imagen $imagen<br><br>";
    }
    //ultimo revision
    //echo $datos_usuario[0]->avatar;44
    //echo $datos_usuario[0]->avatar;
    //echo "<br>imagen $imagen";exit();
    return ($imagen);
}
function checkRemoteFile($url)
{
    $ch = curl_init();
    curl_setopt($ch, CURLOPT_URL, $url);
    // don't download content
    curl_setopt($ch, CURLOPT_NOBODY, 1);
    curl_setopt($ch, CURLOPT_FAILONERROR, 1);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
    if (curl_exec($ch) !== FALSE) {
        $valor = 1;
    } else {
        $valor = 0;
    }
    //echo $valor; exit();
    return $valor;
}
function ObtenerBrecha($valor, $requerido)
{
    if ($valor >= $requerido) {
        $arreglo[0] = "fa fa-circle text-success fs14 mr10";
        $arreglo[1] = "etiquetaAcreditacion etiquetaAcreditacion-acreditada";
        $arreglo[2] = "Acreditada";
        $arreglo[3] = "si";
    } else if ($valor < $requerido) {
        $arreglo[0] = "fa fa-circle text-warning fs14 mr10";
        $arreglo[1] = "etiquetaAcreditacion etiquetaAcreditacion-proceso";
        $arreglo[2] = "Brecha Media";
        $arreglo[3] = "no";
    }
    //ROJO
    //etiquetaAcreditacion etiquetaAcreditacion-noacreditada
    //fa fa-circle text-danger fs14 mr10
    return ($arreglo);
}
function CategoriaColoresResultadosEvalConductas($valor)
{
    if ($valor == 1) {
        $arreglo[0] = "etiqueta etiqueta-nivel0";
        $arreglo[1] = "Nulo";
    } else if ($valor == 2) {
        $arreglo[0] = "etiqueta etiqueta-nivel1";
        $arreglo[1] = "Inicial";
    } else if ($valor == 3) {
        $arreglo[0] = "etiqueta etiqueta-nivel2";
        $arreglo[1] = "Medio";
    } else if ($valor == 4) {
        $arreglo[0] = "etiqueta etiqueta-nivel3";
        $arreglo[1] = "Alto";
    }
    return ($arreglo);
}
function MuestraResultadosEvaluacionConducta($PRINCIPAL, $evaluador, $evaluado)
{
    $datos_evaluado     = UsuarioEnBasePersonas($evaluado);
    $cargo              = utf8_encode($datos_evaluado[0]->cargo);
    $PRINCIPAL          = str_replace("{NOMBRE}", $datos_evaluado[0]->nombre_completo, $PRINCIPAL);
    $PRINCIPAL          = str_replace("{GERENCIA}", $datos_evaluado[0]->gerencia, $PRINCIPAL);
    $PRINCIPAL          = str_replace("{CARGO}", $cargo, $PRINCIPAL);
    $PRINCIPAL          = str_replace("{FOTO_COLABORADOR}", VerificaFotoPersonal($datos_evaluado[0]->rut), $PRINCIPAL);
    $objetivos          = ListadoObjetivosDnc2($evaluador, $cargo);
    $requerido          = 3;
    $cantidad_conductas = 0;
    $certificadas       = 0;
    foreach ($objetivos as $obj) {
        $respuesta = TieneRegistroRespuestaEvConduccta($evaluado, $evaluador, $obj->id);
        if ($obj->conducta1) {
            $cantidad_conductas++;
            $row .= file_get_contents("views/dnc/row_dnc6.html");
            $row              = str_replace("{NOMBRE_CONDUCTA}", $obj->conducta1, $row);
            $rangos           = CategoriaColoresResultadosEvalConductas($respuesta[0]->nota_c1);
            $row              = str_replace("{CLASS_NIVEL}", $rangos[0], $row);
            $row              = str_replace("{NIVEL}", $rangos[1], $row);
            $rangos_requerido = CategoriaColoresResultadosEvalConductas($requerido);
            $row              = str_replace("{CLASS_NIVEL_REQUERIDO}", $rangos_requerido[0], $row);
            $row              = str_replace("{NIVEL_REQUERIDO}", $rangos_requerido[1], $row);
            //Brecha
            $brecha           = ObtenerBrecha($respuesta[0]->nota_c1, $requerido);
            $row              = str_replace("{BRECHA_ICONO}", $brecha[0], $row);
            $row              = str_replace("{BRECHA_COLOR}", $brecha[1], $row);
            $row              = str_replace("{BRECHA}", $brecha[2], $row);
            if ($brecha[3] == "si")
                $certificadas++;
        }
        if ($obj->conducta2) {
            $cantidad_conductas++;
            $row .= file_get_contents("views/dnc/row_dnc6.html");
            $row              = str_replace("{NOMBRE_CONDUCTA}", $obj->conducta2, $row);
            $rangos           = CategoriaColoresResultadosEvalConductas($respuesta[0]->nota_c2);
            $row              = str_replace("{CLASS_NIVEL}", $rangos[0], $row);
            $row              = str_replace("{NIVEL}", $rangos[1], $row);
            $rangos_requerido = CategoriaColoresResultadosEvalConductas($requerido);
            $row              = str_replace("{CLASS_NIVEL_REQUERIDO}", $rangos_requerido[0], $row);
            $row              = str_replace("{NIVEL_REQUERIDO}", $rangos_requerido[1], $row);
            //Brecha
            $brecha           = ObtenerBrecha($respuesta[0]->nota_c2, $requerido);
            $row              = str_replace("{BRECHA_ICONO}", $brecha[0], $row);
            $row              = str_replace("{BRECHA_COLOR}", $brecha[1], $row);
            $row              = str_replace("{BRECHA}", $brecha[2], $row);
            if ($brecha[3] == "si")
                $certificadas++;
        }
        if ($obj->conducta3) {
            $cantidad_conductas++;
            $row .= file_get_contents("views/dnc/row_dnc6.html");
            $row              = str_replace("{NOMBRE_CONDUCTA}", $obj->conducta3, $row);
            $rangos           = CategoriaColoresResultadosEvalConductas($respuesta[0]->nota_c3);
            $row              = str_replace("{CLASS_NIVEL}", $rangos[0], $row);
            $row              = str_replace("{NIVEL}", $rangos[1], $row);
            $rangos_requerido = CategoriaColoresResultadosEvalConductas($requerido);
            $row              = str_replace("{CLASS_NIVEL_REQUERIDO}", $rangos_requerido[0], $row);
            $row              = str_replace("{NIVEL_REQUERIDO}", $rangos_requerido[1], $row);
            //Brecha
            $brecha           = ObtenerBrecha($respuesta[0]->nota_c3, $requerido);
            $row              = str_replace("{BRECHA_ICONO}", $brecha[0], $row);
            $row              = str_replace("{BRECHA_COLOR}", $brecha[1], $row);
            $row              = str_replace("{BRECHA}", $brecha[2], $row);
            if ($brecha[3] == "si")
                $certificadas++;
        }
    }
    $PRINCIPAL = str_replace("{LISTADO_CONDUCTAS_EVALUADAS}", utf8_encode($row), $PRINCIPAL);
    $PRINCIPAL = str_replace("{CANTIDAD_CONDUCTAS}", $cantidad_conductas, $PRINCIPAL);
    $PRINCIPAL = str_replace("{CANTIDAD_ACREDITADAS}", $certificadas, $PRINCIPAL);
    return ($PRINCIPAL);
}
function SelectNiveleDebilidadEvalConducta($seleccionado)
{
    $alternativas = TraeDebilidadAlternativaEvConducta();
    $opciones     = "";
    foreach ($alternativas as $alt) {
        if ($alt->valor == $seleccionado) {
            $opciones .= "<option selected value='" . $alt->valor . "'>" . $alt->valor . "</option>";
        } else {
            $opciones .= "<option value='" . $alt->valor . "'>" . $alt->valor . "</option>";
        }
    }
    return ($opciones);
}
function SelectNiveleEvalConducta($seleccionado)
{
    $alternativas = TraeNivelesAlternativaEvConducta();
    $opciones     = "";
    foreach ($alternativas as $alt) {
        if ($alt->puntaje == $seleccionado) {
            $opciones .= "<option selected value='" . $alt->puntaje . "'>" . $alt->valor . "</option>";
        } else {
            $opciones .= "<option value='" . $alt->puntaje . "'>" . $alt->valor . "</option>";
        }
    }
    return ($opciones);
}
function ListadoConductasEvaluado($PRINCIPAL, $jefe, $evaluado)
{
    $datos_evaluado = UsuarioEnBasePersonas($evaluado);
    $cargo          = utf8_encode($datos_evaluado[0]->cargo);
    $PRINCIPAL      = str_replace("{NOMBRE}", $datos_evaluado[0]->nombre_completo, $PRINCIPAL);
    $PRINCIPAL      = str_replace("{FOTO_COLABORADOR}", VerificaFotoPersonal($datos_evaluado[0]->rut), $PRINCIPAL);
    $PRINCIPAL      = str_replace("{GERENCIA}", $datos_evaluado[0]->gerencia, $PRINCIPAL);
    $PRINCIPAL      = str_replace("{CARGO}", $cargo, $PRINCIPAL);
    //Dado el cargo, traigo los objetivos de ests.
    //$objetivos=ListadoObjetivosDncDadoCargo($cargo);
    $objetivos      = ListadoObjetivosDnc2($jefe, $cargo);
    foreach ($objetivos as $obj) {
        if ($obj->conducta1) {
            $row .= file_get_contents("views/dnc/row_dnc5.html");
            $tiene_registro = TieneRegistroRespuestaEvConduccta($evaluado, $jefe, $obj->id);
            $row            = str_replace("{OPCIONES_NIVEL_EVALUACION}", SelectNiveleEvalConducta($tiene_registro[0]->nota_c1), $row);
            $row            = str_replace("{OPCIONES_DEBILIDAD_ALTERNATIVA}", SelectNiveleDebilidadEvalConducta($tiene_registro[0]->debilidad_c1), $row);
            $row            = str_replace("{NOMBRE_CONDUCTA}", $obj->conducta1, $row);
            $row            = str_replace("{NUMERO_CONDUCTA}", "1", $row);
        }
        if ($obj->conducta2) {
            $row .= file_get_contents("views/dnc/row_dnc5.html");
            $row = str_replace("{OPCIONES_NIVEL_EVALUACION}", SelectNiveleEvalConducta($tiene_registro[0]->nota_c2), $row);
            $row = str_replace("{OPCIONES_DEBILIDAD_ALTERNATIVA}", SelectNiveleDebilidadEvalConducta($tiene_registro[0]->debilidad_c2), $row);
            $row = str_replace("{NOMBRE_CONDUCTA}", $obj->conducta2, $row);
            $row = str_replace("{NUMERO_CONDUCTA}", "2", $row);
            $row = str_replace("SELECT_" . $obj->id . "_2_" . $tiene_registro[0]->nota_c2 . "", "selected", $row);
        }
        if ($obj->conducta3) {
            $row .= file_get_contents("views/dnc/row_dnc5.html");
            $row = str_replace("{OPCIONES_NIVEL_EVALUACION}", SelectNiveleEvalConducta($tiene_registro[0]->nota_c3), $row);
            $row = str_replace("{OPCIONES_DEBILIDAD_ALTERNATIVA}", SelectNiveleDebilidadEvalConducta($tiene_registro[0]->debilidad_c3), $row);
            $row = str_replace("{NOMBRE_CONDUCTA}", $obj->conducta3, $row);
            $row = str_replace("{NUMERO_CONDUCTA}", "3", $row);
            $row = str_replace("SELECT_" . $obj->id . "_3_" . $tiene_registro[0]->nota_c3 . "", "selected", $row);
        }
        $row = str_replace("{ID_OBJETIVO}", $obj->id, $row);
    }
    $PRINCIPAL = str_replace("{EVALUADO_ENCODEADO}", Encodear3($evaluado), $PRINCIPAL);
    $PRINCIPAL = str_replace("{EVALUADOR_ENCODEADO}", Encodear3($jefe), $PRINCIPAL);
    $PRINCIPAL = str_replace("{CARGO_ENCODEADO}", Encodear3($cargo), $PRINCIPAL);
    $PRINCIPAL = str_replace("{LISTADO_CONDUCTAS}", utf8_encode($row), $PRINCIPAL);
    return ($PRINCIPAL);
}
function VerificaEvaluacionFinalizadaConducta($evaluado, $evaluador)
{
    $fin = EvaluacionFinConducta($evaluado, $evaluador);
    if ($fin) {
        $arreglo[0] = "fa fa-circle text-success fs14 mr10";
        $arreglo[1] = "Terminado";
        $arreglo[2] = file_get_contents("views/dnc/dnc4_boton_edita.html");
        $arreglo[3] = "si";
    } else {
        $arreglo[0] = "fa fa-circle text-danger fs14 mr10";
        $arreglo[1] = "Pendiente";
        $arreglo[2] = file_get_contents("views/dnc/dnc4_boton_ingresa.html");
        $arreglo[3] = "no";
    }
    return ($arreglo);
}
function ListadoColaboradoresPorJefe($PRINCIPAL, $jefe)
{
    $listado_colaboradores = EsJefe($jefe);
    $total_finalizados     = 0;
    foreach ($listado_colaboradores as $col) {
        $row .= file_get_contents("views/dnc/row_dnc4.html");
        $row    = str_replace("{NOMBRE}", $col->nombre_completo, $row);
        $row    = str_replace("{GERENCIA}", $col->gerencia, $row);
        $row    = str_replace("{CARGO}", $col->cargo, $row);
        $row    = str_replace("{FOTO_COLABORADOR}", VerificaFotoPersonal($col->rut), $row);
        $estado = VerificaEvaluacionFinalizadaConducta($col->rut, $jefe);
        if ($estado[3] == "si") {
            $total_finalizados++;
            $row = str_replace("{ETIQUETA_NOTA}", "Medio", $row);
            $row = str_replace("{CLASE_ETIQUETA_NOTA}", "etiqueta etiqueta-nivel2", $row);
        } else {
            $row = str_replace("{ETIQUETA_NOTA}", "", $row);
            $row = str_replace("{CLASE_ETIQUETA_NOTA}", "", $row);
        }
        $row = str_replace("{ICONO}", $estado[0], $row);
        $row = str_replace("{ESTADO}", $estado[1], $row);
        $row = str_replace("{OPCIONES}", $estado[2], $row);
        $row = str_replace("{EVALUADO_ENCODEADO}", Encodear3($col->rut), $row);
    }
    //Porcentaje_final=($total_finalizados*100)/count($listado_colaboradores);
    $PRINCIPAL = str_replace("{PORCENTAJE_AVANCE}", number_format(($total_finalizados * 100) / count($listado_colaboradores), 0), $PRINCIPAL);
    $PRINCIPAL = str_replace("{LISTADO_COLABORADORES}", utf8_encode($row), $PRINCIPAL);
    $PRINCIPAL = str_replace("{CANTIDAD_COLABORADORES}", count($listado_colaboradores), $PRINCIPAL);
    return ($PRINCIPAL);
}
function detect()
{
    $browser         = array(
        "IE",
        "OPERA",
        "MOZILLA",
        "NETSCAPE",
        "FIREFOX",
        "SAFARI",
        "CHROME"
    );
    $os              = array(
        "WIN",
        "MAC",
        "LINUX"
    );
    # definimos unos valores por defecto para el navegador y el sistema operativo
    $info['browser'] = "OTHER";
    $info['os']      = "OTHER";
    # buscamos el navegador con su sistema operativo
    foreach ($browser as $parent) {
        $s       = strpos(strtoupper($_SERVER['HTTP_USER_AGENT']), $parent);
        $f       = $s + strlen($parent);
        $version = substr($_SERVER['HTTP_USER_AGENT'], $f, 15);
        $version = preg_replace('/[^0-9,.]/', '', $version);
        if ($s) {
            $info['browser'] = $parent;
            $info['version'] = $version;
        }
    }
    # obtenemos el sistema operativo
    foreach ($os as $val) {
        if (strpos(strtoupper($_SERVER['HTTP_USER_AGENT']), $val) !== false)
            $info['os'] = $val;
    }
    # devolvemos el array de valores
    return $info;
}
function ValidarSesion($ambiente, $id_empresas, $url_front)
{
    //echo "ValidarSesion<br> ";
    //print_r($_SESSION);
    //sleep(5);
    if (isset($_SESSION["user_"]) && $_SESSION["user_"] !== '') {
        //Tiene session
        //Veo si el usuario esta en la base
        $existe_usuario_en_la_base = $datos_usuario = UsuarioEnBasePersonas($_SESSION["user_"]);

             if (!$existe_usuario_en_la_base) {
                $PRINCIPAL        = FuncionesTransversalesLogin(file_get_contents("" . $url_front . "/front/views/home/login.html"));
                $token_fecha_hora = Encodear3(date("Y-m-d") . " " . date("H:i:s"));
                $PRINCIPAL        = str_replace("{TOKEN_FECHA_HORA}", $token_fecha_hora, $PRINCIPAL);
                session_start();
                $_SESSION["token"] = $token_fecha_hora;
                echo $PRINCIPAL;
                exit;
            } else {
                if ($existe_usuario_en_la_base[0]->vigencia == "1") {
                    $PRINCIPAL        = FuncionesTransversalesLogin(file_get_contents("" . $url_front . "/front/views/home/login.html"));
                    $token_fecha_hora = Encodear3(date("Y-m-d") . " " . date("H:i:s"));
                    $PRINCIPAL        = str_replace("{TOKEN_FECHA_HORA}", $token_fecha_hora, $PRINCIPAL); 
                    session_start();
                    $_SESSION["token"] = $token_fecha_hora;
                    echo $PRINCIPAL;
                    exit;
                }
            }



        if ($ambiente == "detnot") {
            InsertaLogSistema($_SESSION["user_"], $ambiente, $id_empresas, Decodear($_GET["id"]), "", "", "", "");
        } else if ($ambiente == "GuardaLogVideoVisto") {
            InsertaLogSistema($_SESSION["user_"], $ambiente . "_" . $_POST["tipo_video"], $id_empresas, "", "", "", "", "");
        } else if ($ambiente == "veperfil") {
            $rut = $_POST["buscarRut"];
            if (!$rut) {
                $rut = Decodear3($_GET["r"]);
            }
            InsertaLogSistema($_SESSION["user_"], $ambiente, $id_empresas, $rut, "", "", "", "");
        } else if ($ambiente == "biblioteca") {
            InsertaLogSistema($_SESSION["user_"], $ambiente, $id_empresas, $_GET["id"], $_GET["p"], "", "", "");
        } else if ($ambiente == "detalle_cursoCap") {
            InsertaLogSistema($_SESSION["user_"], $ambiente, $id_empresas, Decodear3($_GET["idc"]), "", "", "", "");
        } else if ($ambiente == "contenido") {
            InsertaLogSistema($_SESSION["user_"], $ambiente, $id_empresas, Decodear3($_GET["i"]), "", "", "", "");
        } else if ($ambiente == "web") {
            //InsertaLogSistema($_SESSION["user_"], $ambiente, $id_empresas, "", "", $_GET["i"], $_GET["i"], $_GET["niv"]);
            InsertaLogSistema($_SESSION["user_"], $ambiente, $id_empresas, $_GET["id"], $_GET["p"], "", ($_GET["niv"]), Decodear3($_GET["i"]));
        } else {
            InsertaLogSistema($_SESSION["user_"], $ambiente, $id_empresas, "", "", "", "", "");
        }
    } else {
        if ($ambiente <> "CreateNewUser" && $ambiente <> "LogEmail" && $ambiente <> "entrada_inscripcion"
		&& $ambiente <> "ver_sesion_usuario"
		&& $ambiente <> "ver_sesion_usuario_matriz"
		&& $ambiente <> "LinkEnc"
		&& $ambiente <> "LinkEnc_Redirect" && $ambiente <> "LinkEnc_Redirect_enc"
		&& $ambiente <> "entrada_inscripcion_anonima"  && $ambiente <> "entrada" && $ambiente <> "entradaCap"  && $ambiente <> "logexternos" && $ambiente <> "logmatriz" && $ambiente <> "logext4F" && $ambiente <> "logext" && $ambiente <> "entrada_matriz" && $ambiente <> "entrada_matriz_externos" && $ambiente <> "entradaclg" && $ambiente <> "entradaLdap" && $ambiente <> "registerac" && $ambiente <> 'chpex' && $ambiente <> 'entrada_token' && $ambiente <> "entrada_token_ca" && $ambiente <> "cursos_ExteMas" && $ambiente <> "prevCa" && $ambiente <> "help" && $ambiente <> "autoLoginRel" && $ambiente <> "SF" && $ambiente <> "go_save_data_ext" && $ambiente <> "RegistraRelator" && $ambiente <> "checkUser" && $ambiente <> "checkUserLosAndes" && $ambiente <> "checkUserTaylor" && $ambiente <> "checkUserExt" && $ambiente <> "checkUserExterno" && $ambiente <> "checkUserBci" && $ambiente <> "CheckValRec" && $ambiente <> "regis" && $ambiente <> "oco" && $ambiente <> "entradac" && $ambiente <> "sendSolicitud" && $ambiente <> "sendClave" && $ambiente <> "iex") {
            if ($ambiente == "logw") {
                $PRINCIPAL = FuncionesTransversalesLogin(file_get_contents("views/home/login.html"));
                echo $PRINCIPAL;
                exit;
            } 
            
         
          


            else if ($ambiente == "login_ext") {
                //unset($_SESSION);
                //session_start(); $_SESSION = array(); if (isset($_COOKIE[session_name()])) {    setcookie(session_name(), '', time()-42000, '/'); } session_destroy();
                //$ambiente=($_GET["ambiente"]);
                //$im=($_GET["im"]);
                //exit();
                //$PRINCIPAL=FuncionesTransversales(file_get_contents("views/home/login_ext.html"));
                //echo $PRINCIPAL;
                unset($_SESSION);
                session_start();
                $_SESSION = array();
                if (isset($_COOKIE[session_name()])) {
                    setcookie(session_name(), '', time() - 42000, '/');
                }
                session_destroy();
                $ambiente  = ($_GET["ambiente"]);
                $im        = ($_GET["im"]);
                $id_mp     = ($_GET["id_mp"]);
                                $sess     = ($_GET["sess"]);

                $PRINCIPAL = FuncionesTransversales(file_get_contents("" . $url_front . "/front/views/home/login_ext.html"));
                $PRINCIPAL = str_replace("{AMBIENTE}", $ambiente, $PRINCIPAL);
                $PRINCIPAL = str_replace("{IM}", $im, $PRINCIPAL);
                $PRINCIPAL = str_replace("{ID_MP}", $id_mp, $PRINCIPAL);
                                $PRINCIPAL = str_replace("{SESS}", $sess, $PRINCIPAL);

                echo $PRINCIPAL;
            }


            else if ($ambiente == "login_externo") {
                //unset($_SESSION);
                //session_start(); $_SESSION = array(); if (isset($_COOKIE[session_name()])) {    setcookie(session_name(), '', time()-42000, '/'); } session_destroy();
                //$ambiente=($_GET["ambiente"]);
                //$im=($_GET["im"]);
                //exit();
                //$PRINCIPAL=FuncionesTransversales(file_get_contents("views/home/login_ext.html"));
                //echo $PRINCIPAL;
                unset($_SESSION);
                session_start();
			
				
				
                $_SESSION = array();
				
				
                if (isset($_COOKIE[session_name()])) {
                    setcookie(session_name(), '', time() - 42000, '/');
                }
                session_destroy();
    $ambiente=($_GET["ambiente"]);
    $im=($_GET["im"]);
    $id_mp=($_GET["id_mp"]);
    $amb=($_GET["amb"]);
    $idcat=($_GET["idcat"]);
    $idc=($_GET["idc"]);
    $site=($_GET["site"]);
    $linkext=($_GET["linkext"]);

                $PRINCIPAL = FuncionesTransversales(file_get_contents("" . $url_front . "/front/views/home/login_externo.html"));
    $PRINCIPAL = str_replace("{AMBIENTE}", $ambiente, $PRINCIPAL);
    $PRINCIPAL = str_replace("{IM}", $im, $PRINCIPAL);
    $PRINCIPAL = str_replace("{ID_MP}", $id_mp, $PRINCIPAL);
    $PRINCIPAL = str_replace("{AMB}", $amb, $PRINCIPAL);
    $PRINCIPAL = str_replace("{IDCAT}", $idcat, $PRINCIPAL);
    $PRINCIPAL = str_replace("{IDC}", $idc, $PRINCIPAL);
    $PRINCIPAL = str_replace("{SITE}", $site, $PRINCIPAL);
    $PRINCIPAL = str_replace("{LINKEXT}", $linkext, $PRINCIPAL);
    $PRINCIPAL = str_replace("{SESS}", $sess, $PRINCIPAL);

                echo utf8_encode($PRINCIPAL);
            }

            
			
			
			
			
			
			


            else if ($ambiente == "logminvestt") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_minvest_tecnico.html"));
                echo $PRINCIPAL;
                exit;
            }


            else if ($ambiente == "logminvestc") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_minvest_comercial.html"));
                echo $PRINCIPAL;
                exit;
            }



            else if ($ambiente == "loglp") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_lp.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logbanchile") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_banchile.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logbci_revG") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_bci_revG.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "log_los_andes_gracias") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_los_andes_gracias.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "log_los_andes_google_G") {
                unset($_SESSION);
                session_start();
                $_SESSION = array();
                if (isset($_COOKIE[session_name()])) {
                    setcookie(session_name(), '', time() - 42000, '/');
                }
                session_destroy();
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/75_login_los_andes_google.html"));
                echo $PRINCIPAL;
            } else if ($ambiente == "logbci_sessions") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_bci_sessions.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logsamsonite") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_samsonite.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logrfsgd") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_rfsgd.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logrfgud") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_rf_gud.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "log_rf_callcenter") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_rf_callcenter.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "login_dncrf") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_dncrf.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logrf") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_rf.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logbci_rev2") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_bci_rev2.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logbci_escuela") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/71_login_escuela.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logbci_rev") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_bci_rev.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "log_los_andes_google") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/75_login_los_andes_google.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "log_taylor_google") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/22_login_taylor.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "log_taylor_google2") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/22_login_taylor_G.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "log_taylor_google_logincorrecto") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/22_login_taylor_G.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "log_taylor_google_G") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/22_login_taylor_G.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logtransbank") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_transbank.html"));
                $PRINCIPAL = str_replace("{ID_EMPRESA_ENCODEADA}", Encodear3(58), $PRINCIPAL);
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "log_vf") {
                session_start();
                $tokem     = NoCSRF::generate('tokem');
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_vf.html"));
                //$tokem_login=date("Y-m-d")." ".date("H:i:s");
                $PRINCIPAL = str_replace("{TOKEM_LOGIN}", $tokem, $PRINCIPAL);
                //$_SESSION["tokem_login"]=encodear3($tokem_login);
                //print_r($_SESSION);
                echo $PRINCIPAL;
                exit;
            }
            else if ($ambiente == "log_educacion_financiera_ext") {
                session_start();
                $tokem     = NoCSRF::generate('tokem');
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_bci_educacion_financiera_ext.html"));
                //$tokem_login=date("Y-m-d")." ".date("H:i:s");
                $PRINCIPAL = str_replace("{TOKEM_LOGIN}", $tokem, $PRINCIPAL);
                //$_SESSION["tokem_login"]=encodear3($tokem_login);
                //print_r($_SESSION);
                echo $PRINCIPAL;
                exit;
            }
            else if ($ambiente == "logwom_academy") {
                session_start();
                $tokem     = NoCSRF::generate('tokem');
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_wom_academy.html"));
                //$tokem_login=date("Y-m-d")." ".date("H:i:s");
                $PRINCIPAL = str_replace("{TOKEM_LOGIN}", $tokem, $PRINCIPAL);
                //$_SESSION["tokem_login"]=encodear3($tokem_login);
                //print_r($_SESSION);
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logbestadobeme") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_bestadobeme.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logbestadorrll") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_bestadorrll.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logbe_fen") {
                echo "    <script>         location.href='../gurupagorut/front/?sw=com_mp_home';     </script>";
                exit;
            } else if ($ambiente == "logesachs") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_esachs.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logultramarv2") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_ultramarv2.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logultramarv2_form") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_ultramarv2_form.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logultramarv2_form_ldap") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_ultramarv2_form_ldap.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "loggopartners") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_gopartners.html"));
                echo $PRINCIPAL;
                exit;
            }
            else if ($ambiente == "log_encuestas") {
                    //print_r($_GET);
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_gopartners.html"));
                $PRINCIPAL = str_replace("{ID_ENC}", $_GET["id_enc"], $PRINCIPAL);

                $array_encuesta=datos_Encuesta_front_lb($_GET["id_enc"]);
                    //print_r($array_encuesta);
                    $PRINCIPAL = str_replace("{AMBIENTE}", $ambiente, $PRINCIPAL);
        $PRINCIPAL = str_replace("{IMAGEN}",        utf8_encode($array_encuesta[0]->imagensuperior), $PRINCIPAL);
        $PRINCIPAL = str_replace("{IMAGEN_BACKGROUND}",        utf8_encode($array_encuesta[0]->imageninferior), $PRINCIPAL);
        $PRINCIPAL = str_replace("{TITULO}",        utf8_encode($array_encuesta[0]->titulo), $PRINCIPAL);
        $PRINCIPAL = str_replace("{DESCRIPCION}",   utf8_encode($array_encuesta[0]->descripcion), $PRINCIPAL);
        $PRINCIPAL = str_replace("{DATOS}",         utf8_encode($array_encuesta[0]->bajada_texto), $PRINCIPAL);

if($array_encuesta[0]->imagenlogo<>""){
    $boton="<span class='badge badge-info'>Encuesta Desactiva</span>";

}   else {
    $boton="<center><button class='button button-3d button-info nomargin' type='submit'>¡Quiero Contestar!</button></center>";
}
        $PRINCIPAL = str_replace("{BOTON_INGRESAR}",   $boton, $PRINCIPAL);

                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logwom") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_wom.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logsisteco") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_sisteco.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logstc") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_stc.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logfalabella") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_falabella.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "lograbobank") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_rabobank.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logbestado") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_bestado.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logsparta") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_sparta.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logcmpc") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_cmpc.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "loggw") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_gw.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logbtgpactual") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_btgpactual.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logsiga") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_siga.html"));
                $PRINCIPAL = str_replace("{ID_EMPRESA_ENCODEADA}", Encodear3(27), $PRINCIPAL);
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logcompasscollege") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_compasscollege.html"));
                $PRINCIPAL = str_replace("{TOK_ENCODEADA}", Encodear3("Fr45GDs"), $PRINCIPAL);
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logcompass") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_compass.html"));
                $PRINCIPAL = str_replace("{TOK_ENCODEADA}", Encodear3("Fr45GDs"), $PRINCIPAL);
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logchilquinta") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_chilquinta.html"));
                $PRINCIPAL = str_replace("{TOK_ENCODEADA}", Encodear3("Fr45GDs"), $PRINCIPAL);
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logsg") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_sg.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logcial") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_cial.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logmasisa") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_masisa.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logsonda") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_sonda.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logcorpvida") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_corpvida.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logbsa") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_bsa.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "login_rfsgd") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_rfsgd.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "login_rf") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_rf.html"));
                $tokem     = NoCSRF::generate('tokem');
                $PRINCIPAL = str_replace("{TOKEM_LOGIN}", $tokem, $PRINCIPAL);
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logintime") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_intime.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logultramar") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_ultramar.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logturbus") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_turbus.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logemiliana") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_emiliana.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logskberge") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_skberge.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logminvestBK") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_minvest.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "logust") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_ust.html"));
                echo $PRINCIPAL;
                exit;
            } else if ($ambiente == "log_imperial") {
                $PRINCIPAL = FuncionesTransversales(file_get_contents("views/home/login_imperial.html"));
                echo $PRINCIPAL;
                exit;
            } else {
                //echo "aca";
                session_start();
                $_SESSION = array();
                if (isset($_COOKIE[session_name()])) {
                    setcookie(session_name(), '', time() - 42000, '/');
                }
                session_destroy();
                $PRINCIPAL        = FuncionesTransversalesLogin(file_get_contents("" . $url_front . "/front/views/home/login.html"));
                $token_fecha_hora = Encodear3(date("Y-m-d") . " " . date("H:i:s"));
                $PRINCIPAL        = str_replace("{TOKEN_FECHA_HORA}", $token_fecha_hora, $PRINCIPAL);
                session_start();
                $_SESSION["token"] = $token_fecha_hora;
                echo $PRINCIPAL;
                exit;
            }
        } else {
        }
    }
}
function PorcentajeAvanceIngresoObjetivosPorJefe($rut)
{
    $total_cargos      = count(ListadoCargosDistinct($rut));
    $total_finalizados = count(ListadoCargosFinalizadosPorJefe($rut));
    $porcentaje        = ($total_finalizados * 100) / $total_cargos;
    return (number_format($porcentaje, 0));
}
function ListadoObjetivosDnc($rut, $cargo, $html, $PRINCIPAL)
{
    $objetivos = ListadoObjetivosDnc2($rut, utf8_decode($cargo));
    if ($objetivos) {
        foreach ($objetivos as $obj) {
            $row .= file_get_contents("views/dnc/row_objetivos.html");
            $row = str_replace("{OBJETIVO}", utf8_encode($obj->objetivo), $row);
            $row = str_replace("{CONDUCTA1}", utf8_encode($obj->conducta1), $row);
            $row = str_replace("{CONDUCTA2}", utf8_encode($obj->conducta2), $row);
            $row = str_replace("{CONDUCTA3}", utf8_encode($obj->conducta3), $row);
            $row = str_replace("{ID_OBJETIVO_ENCODEADO}", Encodear3($obj->id), $row);
            $row = str_replace("{RUT_JEFE_ENCODEADO}", Encodear3($rut), $row);
            $row = str_replace("{CARGO_ENCODEADO}", Encodear3($cargo), $row);
        }
        $html = str_replace("{LISTA_OBJETIVOS}", ($row), $html);
    } else {
        //$html=file_get_contents("views/dnc/entorno_objetivos_ingresados_sin_finalizar.html");
        $html = "";
        //$html = str_replace("{LISTA_OBJETIVOS}","<tr><td colspan='4'>No existen objetivos ingresados para el cargo ".$cargo."</td></tr>",$html);
        $html = str_replace("{LISTA_OBJETIVOS}", "", $html);
    }
    $PRINCIPAL = str_replace("{ENTORNO_LISTADO_OBJETIVOS}", ($html), $PRINCIPAL);
    $PRINCIPAL = str_replace("{CARGO_ENCODEADO}", Encodear3($cargo), $PRINCIPAL);
    $PRINCIPAL = str_replace("{JEFE_ENCODEADO}", Encodear3($rut), $PRINCIPAL);
    $PRINCIPAL = str_replace("{CARGO}", ($cargo), $PRINCIPAL);
    return ($PRINCIPAL);
}
function FormularioObjetivoEdicion($PRINCIPAL, $rut, $id_cargo, $cargo)
{
    $PRINCIPAL      = str_replace("{CARGO}", ($cargo), $PRINCIPAL);
    $PRINCIPAL      = str_replace("{ID_CARGO_ENCODEADO}", Encodear3($id_cargo), $PRINCIPAL);
    $PRINCIPAL      = str_replace("{CARGO_ENCODEADO}", Encodear3($cargo), $PRINCIPAL);
    //Para el caaso cuando es edicion
    $datos_objetivo = DatosObjetivoDncDadoId($id_cargo);
    $PRINCIPAL      = str_replace("{OBJETIVO}", utf8_encode($datos_objetivo[0]->objetivo), $PRINCIPAL);
    $PRINCIPAL      = str_replace("{CONDUCTA1}", utf8_encode($datos_objetivo[0]->conducta1), $PRINCIPAL);
    $PRINCIPAL      = str_replace("{CONDUCTA2}", utf8_encode($datos_objetivo[0]->conducta2), $PRINCIPAL);
    $PRINCIPAL      = str_replace("{CONDUCTA3}", utf8_encode($datos_objetivo[0]->conducta3), $PRINCIPAL);
    return ($PRINCIPAL);
}
function FormularioObjetivo($PRINCIPAL, $rut, $cargo)
{
    $PRINCIPAL   = str_replace("{CARGO}", ($cargo), $PRINCIPAL);
    $PRINCIPAL   = str_replace("{CARGO_ENCODEADO}", Encodear3($cargo), $PRINCIPAL);
    $PRINCIPAL   = str_replace("{JEFE_ENCODEADO}", Encodear3($rut), $PRINCIPAL);
    //aca muestro el listado de los cumplimientos agrupados en dimensiones
    $dimensiones = TotalDimensionesDeCumplimientoDnc();
    foreach ($dimensiones as $dimen) {
        $entorno .= file_get_contents("views/dnc/entorno_cumplimientos_dimension.html");
        $entorno         = str_replace("{CLASE_DIMENSION}", $dimen->css, $entorno);
        $entorno         = str_replace("{NOMBRE_DIMENSION}", $dimen->dimension, $entorno);
        $entorno         = str_replace("{DESCRIPCION_DIMENSION}", $dimen->descripcion, $entorno);
        $comportamientos = ComportamientoDadoDimension($dimen->id);
        $i               = 1;
        $filas           = "";
        foreach ($comportamientos as $comp) {
            if ($i == 1) {
                $filas .= "<tr>";
            }
            $filas .= '<td class="textos_compo bg_accion" width="50%"><span class="color_celeste"><i class="fa fa-arrow-circle-o-right padRight10px" title="' . $comp->descripcion . '" style="cursor: pointer;"></i></span>' . $comp->comportamiento . '</td>';
            if ($i == 2) {
                $filas .= "</tr>";
                $i = 0;
            }
            $i++;
        }
        $entorno = str_replace("{LISTADO_CUMPLIMIENTOS}", $filas, $entorno);
    }
    $PRINCIPAL = str_replace("{TABLA_CUMPLIMIENTOS_EJEMPLO}", utf8_encode($entorno), $PRINCIPAL);
    return ($PRINCIPAL);
}
function EstadoDncJefeCargo($rut, $cargo)
{
    $verifica_finalizado = VerificaDNCFinalizado($rut, $cargo);
    if ($verifica_finalizado) {
        $estado[0] = "fa fa-circle text-success fs14 mr10";
        $estado[1] = "Terminado";
        $estado[2] = file_get_contents("views/dnc/opciones_edita.html");
    } else {
        $estado[0] = "fa fa-circle text-danger fs14 mr10";
        $estado[1] = "Pendiente";
        $estado[2] = file_get_contents("views/dnc/opciones_ingresa.html");
    }
    return ($estado);
}
function ListadoCargosPorJefe($PRINCIPAL, $rut)
{
    //con el rut del jefe, busco con un select distinct el listado de los cargos que tiene bajo su dependencia
    $cargos = ListadoCargosDistinct($rut);
    foreach ($cargos as $unico) {
        $row .= file_get_contents("views/dnc/row_dnc2.html");
        $row    = str_replace("{NOMBRE_CARGO}", utf8_encode($unico->cargo), $row);
        $row    = str_replace("{CANTIDAD_COLABORADORES}", $unico->numero_colaboradores, $row);
        $row    = str_replace("{RUT_JEFE}", $rut, $row);
        $Estado = EstadoDncJefeCargo($rut, utf8_encode($unico->cargo));
        $row    = str_replace("{OPCIONES}", $Estado[2], $row);
        $row    = str_replace("{ESTADO_CARGO}", $Estado[1], $row);
        $row    = str_replace("{COLOR_ESTADO}", $Estado[0], $row);
        $row    = str_replace("{CARGO_ENCODEADO}", Encodear3(utf8_encode($unico->cargo)), $row);
    }
    $PRINCIPAL                     = str_replace("{LISTADO_CARGOS}", ($row), $PRINCIPAL);
    $PRINCIPAL                     = str_replace("{PORCENTAJE_AVANCE}", PorcentajeAvanceIngresoObjetivosPorJefe($rut), $PRINCIPAL);
    $total_colaboradores           = count(EsJefe($rut));
    $PRINCIPAL                     = str_replace("{CANTIDAD_COLABORADORES}", $total_colaboradores, $PRINCIPAL);
    $cantidad_objetivos_ingresados = count(DatosObjetivoDncDadoJefe($rut));
    $PRINCIPAL                     = str_replace("{CANTIDAD_OBJETIVOS_DEFINIDOS}", $cantidad_objetivos_ingresados, $PRINCIPAL);
    $PRINCIPAL                     = str_replace("{CANTIDAD_CARGOS}", count($cargos), $PRINCIPAL);
    return ($PRINCIPAL);
}
function MuestraDatosCurso($PRINCIPAL, $id_curso)
{
    $total_objetos = count(ObjetosDadoCursoSoloId($id_curso));
    $datos_curso   = DetalleCurso($id_curso);
    $PRINCIPAL     = str_replace("{NOMBRE_CURSO}", utf8_encode($datos_curso[0]->nombre), $PRINCIPAL);
    $PRINCIPAL     = str_replace("{DESCRIPCION_CURSO}", utf8_encode($datos_curso[0]->descripcion), $PRINCIPAL);
    $PRINCIPAL     = str_replace("{CANTIDAD_MODULOS}", $total_objetos, $PRINCIPAL);
    $PRINCIPAL     = str_replace("{ID_CURSO_ENCODEADO}", Encodear3($id_curso), $PRINCIPAL);
    return ($PRINCIPAL);
}
////CHIS COMIENZA
$directorio_noticias = '../front/img/noticias/';
function NoticiasPrincipales($html, $variable)
{
    //Traigo las noticias
    if ($variable) {
        //$noticias=TraeNoticiasPrincipalesPorGerencia($_SESSION["id_empresa"], $variable);
        $noticias     = TraeNoticiasPrincipalesPorComunidad($_SESSION["id_empresa"], $variable);
        $row_template = file_get_contents("views/noticias/row_noticias_principales_comunidad.html");
    } else {
        $noticias     = TraeNoticiasPrincipales($_SESSION["id_empresa"], $variable);
        $row_template = file_get_contents("views/noticias/row_noticias_principales.html");
    }
    $total_html = "";
    foreach ($noticias as $not) {
        $row                 = $row_template;
        $TodoslosComentarios = TodosComentarios($not->id);
        $row                 = str_replace("{PORTADA}", imagen_existe($not->portada), $row);
        $row                 = str_replace("{TITULO}", $not->titulo, $row);
        $row                 = str_replace("{FECHA}", FechaTipoSpa($not->fecha_creacion), $row);
        //$row = str_replace("{CONTENIDO_CORTO}",substr($not->contenido, 0, 100),$row);
        $row                 = str_replace("{CONTENIDO_CORTO}", $not->bajada, $row);
        $row                 = str_replace("{ID_NOTICIA}", Encodear($not->id), $row);
        $row                 = str_replace("{COMENTARIOS}", count($TodoslosComentarios), $row);
        $row                 = str_replace("{CATEGORIA}", $not->nombre_categoria, $row);
        $row                 = str_replace("{IMAGEN_NOTICIA}", $not->portada, $row);
        //datos autor
        $datos_autor         = UsuarioEnBasePersonas($not->rut_creador);
        $row                 = str_replace("{AUTOR}", $datos_autor[0]->nombre . " " . $datos_autor[0]->apaterno . " " . $datos_autor[0]->apaterno, $row);
        $total_html .= $row;
    }
    //echo $total_html; exit;
    $html = str_replace("{COLUMNAS_NOTICIAS_PRINCIPALES}", utf8_encode($total_html), $html);
    $html = str_replace("{COLUMNAS_NOTICIAS_general_CUATRO_MUNDO}", utf8_encode($total_html), $html);
    //ACA COLOCO LAS NOTICIAS QUE SON PRINCIPALES
    return ($html);
}
function NoticiasPrincipalesCom($html, $variable)
{
    //Traigo las noticias
    if ($variable) {
        //$noticias=TraeNoticiasPrincipalesPorGerencia($_SESSION["id_empresa"], $variable);
        //$noticias=TraeNoticiasPrincipalesPorComunidad($_SESSION["id_empresa"], $variable);
        $row_template = file_get_contents("views/noticias/row_noticias_principales_comunidad.html");
    } else {
        $noticias     = TraeNoticiasPrincipalesCom($_SESSION["id_empresa"], $variable);
        $row_template = file_get_contents("views/noticias/row_noticias_principales.html");
    }
    $total_html = "";
    foreach ($noticias as $not) {
        $row                 = $row_template;
        $TodoslosComentarios = TodosComentarios($not->id);
        $row                 = str_replace("{PORTADA}", imagen_existe($not->portada), $row);
        $row                 = str_replace("{TITULO}", $not->titulo, $row);
        $row                 = str_replace("{FECHA}", FechaTipoSpa($not->fecha_creacion), $row);
        //$row = str_replace("{CONTENIDO_CORTO}",substr($not->contenido, 0, 100),$row);
        $row                 = str_replace("{CONTENIDO_CORTO}", $not->bajada, $row);
        $row                 = str_replace("{ID_NOTICIA}", Encodear($not->id), $row);
        $row                 = str_replace("{COMENTARIOS}", count($TodoslosComentarios), $row);
        $row                 = str_replace("{CATEGORIA}", $not->nombre_categoria, $row);
        $row                 = str_replace("{IMAGEN_NOTICIA}", $not->portada, $row);
        //datos autor
        $datos_autor         = UsuarioEnBasePersonas($not->rut_creador);
        $row                 = str_replace("{AUTOR}", $datos_autor[0]->nombre . " " . $datos_autor[0]->apaterno . " " . $datos_autor[0]->apaterno, $row);
        $total_html .= $row;
    }
    //echo $total_html; exit;
    $html = str_replace("{COLUMNAS_NOTICIAS_general_CUATRO_MUNDO}", utf8_encode($total_html), $html);
    //ACA COLOCO LAS NOTICIAS QUE SON PRINCIPALES
    return ($html);
}
function NoticiasSecundarias($html)
{
    //Traigo las noticias
    $noticias   = TraeNoticiasSecundarias($_SESSION["id_empresa"]);
    $total_html = "";
    foreach ($noticias as $not) {
        $row                 = file_get_contents("views/noticias/row_noticias_secundarias.html");
        $TodoslosComentarios = TodosComentarios($not->id);
        $row                 = str_replace("{PORTADA}", imagen_existe($not->portada), $row);
        $row                 = str_replace("{TITULO}", $not->titulo, $row);
        $row                 = str_replace("{FECHA}", FechaTipoSpa($not->fecha_creacion), $row);
        //$row = str_replace("{CONTENIDO_CORTO}",substr($not->contenido, 0, 100),$row);
        $row                 = str_replace("{CONTENIDO_CORTO}", $not->bajada, $row);
        $row                 = str_replace("{ID_NOTICIA}", Encodear($not->id), $row);
        $row                 = str_replace("{COMENTARIOS}", count($TodoslosComentarios), $row);
        $row                 = str_replace("{CATEGORIA}", $not->nombre_categoria, $row);
        $row                 = str_replace("{IMAGEN_NOTICIA}", $not->portada, $row);
        //datos autor
        $datos_autor         = UsuarioEnBasePersonas($not->rut_creador);
        $row                 = str_replace("{AUTOR}", $datos_autor[0]->nombre . " " . $datos_autor[0]->apaterno . " " . $datos_autor[0]->apaterno, $row);
        $total_html .= $row;
    }
    //echo $total_html; exit;
    $html = str_replace("{COLUMNAS_NOTICIAS_SECUNDARIAS}", utf8_encode($total_html), $html);
    //ACA COLOCO LAS NOTICIAS QUE SON PRINCIPALES
    return ($html);
}
function NoticiasTerciarias($html)
{
    //Traigo las noticias
    $noticias   = TraeNoticiasSecundarias($_SESSION["id_empresa"]);
    $total_html = "";
    foreach ($noticias as $not) {
        $row                 = file_get_contents("views/noticias/row_noticias_terciarias.html");
        $TodoslosComentarios = TodosComentarios($not->id);
        $row                 = str_replace("{PORTADA}", imagen_existe($not->portada), $row);
        $row                 = str_replace("{TITULO}", $not->titulo, $row);
        $row                 = str_replace("{FECHA}", FechaTipoSpa($not->fecha_creacion), $row);
        //$row = str_replace("{CONTENIDO_CORTO}",substr($not->contenido, 0, 100),$row);
        $row                 = str_replace("{CONTENIDO_CORTO}", $not->bajada, $row);
        $row                 = str_replace("{ID_NOTICIA}", Encodear($not->id), $row);
        $row                 = str_replace("{COMENTARIOS}", count($TodoslosComentarios), $row);
        $row                 = str_replace("{CATEGORIA}", $not->nombre_categoria, $row);
        $row                 = str_replace("{IMAGEN_NOTICIA}", $not->portada, $row);
        //datos autor
        $datos_autor         = UsuarioEnBasePersonas($not->rut_creador);
        $row                 = str_replace("{AUTOR}", $datos_autor[0]->nombre . " " . $datos_autor[0]->apaterno . " " . $datos_autor[0]->apaterno, $row);
        $total_html .= $row;
    }
    //echo $total_html; exit;
    $html = str_replace("{COLUMNAS_NOTICIAS_TERCIARIAS}", utf8_encode($total_html), $html);
    //ACA COLOCO LAS NOTICIAS QUE SON PRINCIPALES
    return ($html);
}
function BloqueBloqueBannerDinamico($html, $id_empresa, $rut)
{
    //Aca verifico si el usuario dijo no quiero ver o no mas el banner
    $vio_banner = VioBanner($rut, $id_empresa);
    if ($vio_banner) {
        $html = str_replace("{BANNER_DINAMICO}", "", $html);
        $html = str_replace("{FUNCION_ONLOAD}", "", $html);
    } else {
        $html = str_replace("{FUNCION_ONLOAD}", 'onload="SimularBoton();"', $html);
        $html = str_replace("{BANNER_DINAMICO}", file_get_contents("views/home/" . $id_empresa . "_banner_inicial.html"), $html);
    }
    return ($html);
}
function BloqueBloqueBannerDinamicoViajeBciFFVV($html, $id_empresa, $rut)
{
    //Aca verifico si el usuario dijo no quiero ver o no mas el banner
    $vio_banner = VioBanner($rut, $id_empresa);
    if ($vio_banner) {
        $html = str_replace("{BANNER_DINAMICO}", "", $html);
        $html = str_replace("{FUNCION_ONLOAD}", "", $html);
    } else {
        $html = str_replace("{FUNCION_ONLOAD}", 'onload="SimularBoton();"', $html);
        $html = str_replace("{BANNER_DINAMICO}", file_get_contents("views/home/" . $id_empresa . "_banner_inicial.html"), $html);
    }
    return ($html);
}
function BloqueFooterContenido($html)
{
    $row  = file_get_contents("views/footer_contenido/footer_contenido.html");
    $html = str_replace("{BLOQUEFOOTERCONTENIDO}", $row, $html);
    return ($html);
}
function BloqueLinks($html, $id_empresa)
{
    //traigo los links de interes de esta empresa
    $links = LinksInteresPorEmpresa($id_empresa);
    if ($links) {
        $i              = 1;
        $contador_total = 0;
        $entorno        = file_get_contents("views/link_interes/" . $id_empresa . "_entorno_links_interes.html");
        foreach ($links as $unico) {
            $contador_total++;
            if ($i == 1) {
                $rows .= "<div class='row'>";
            }
            if ($unico->link) {
                if ($unico->imagen) {
                    $rows .= file_get_contents("views/link_interes/" . $id_empresa . "_row_links_interes_conlink_imagen.html");
                } else {
                    $rows .= file_get_contents("views/link_interes/" . $id_empresa . "_row_links_interes_conlink.html");
                }
                $rows = str_replace("{LINK}", $unico->link, $rows);
                $rows = str_replace("{IMAGEN}", $unico->imagen, $rows);
                $rows = str_replace("{ID_LINK_ENCODEADO}", Encodear3($unico->id), $rows);
            } else {
                $rows .= file_get_contents("views/link_interes/" . $id_empresa . "_row_links_interes.html");
            }
            $rows = str_replace("{NOMBRE_LINK}", $unico->nombre, $rows);
            $rows = str_replace("{ICONO}", $unico->icono, $rows);
            $rows = str_replace("{DESCRIPCION}", $unico->descripcion, $rows);
            $i++;
            if ($i == 4 && $contador_total <> count($links)) {
                $rows .= "</div>";
                $i = 1;
            }
            if ($contador_total == count($links)) {
                $rows .= "</div>";
            }
        }
        $entorno = str_replace("{BLOQUE_LINKS}", utf8_encode($rows), $entorno);
        //$html = str_replace("{BLOQUE_LINKS}",utf8_encode($rows),$entorno);
        $html    = str_replace("{BLOQUE_LINKS_INTERES}", ($entorno), $html);
    } else {
        $html = str_replace("{BLOQUE_LINKS_INTERES}", "", $html);
    }
    /*$row=file_get_contents("views/links/bloque_links.html");
    $html = str_replace("{BLOQUE_LINKS}",$row,$html);
    */
    return ($html);
}
/*function BloqueLinksInteres($html){
$row=file_get_contents("views/links/bloque_links_interes.html");
$html = str_replace("{BLOQUE_LINKS_INTERES}",$row,$html);
return($html);
}
*/
function BloqueDocumentos($html)
{
    $row  = file_get_contents("views/biblioteca/bloque_ultimos_docs_home.html");
    $html = str_replace("{COLUMNAS_ULTIMOS_DOCUMENTOS}", $row, $html);
    return ($html);
}
function BloqueFotos($html, $id_empresa)
{
    $row      = file_get_contents("views/galeria/bloque_ultimas_fotos_home.html");
    //traigo las ultimas fotos
    //$archivos=TraeUltimasFotosSubidas(6);
    $archivos = TraeUltimasFotosSubidasPorEmpresa(6, $id_empresa);
    foreach ($archivos as $unico) {
        $imagen .= file_get_contents("views/galeria/row_bloque_ultimas_fotos_home.html");
        if ($unico->tipo == "video") {
            $imagen = str_replace("{IMAGEN}", $unico->archivo, $imagen);
            $imagen = str_replace("{IMAGEN2}", "video.jpg", $imagen);
        } else {
            $imagen = str_replace("{IMAGEN2}", $unico->archivo, $imagen);
            $imagen = str_replace("{IMAGEN}", $unico->archivo, $imagen);
        }
    }
    $row  = str_replace("{ROW_ULTIMAS_FOTOS}", $imagen, $row);
    $html = str_replace("{COLUMNAS_ULTIMAS_FOTOS}", $row, $html);
    return ($html);
}
function BloqueMiniSalonFama($html, $id_empresa)
{
    $ano        = 2015;
    //Dada la empresa, traigo a todos los que estan en la tabla de salon de la fama
    $bloque     = file_get_contents("views/salondelafama/bloquesalonfama.html");
    //Primero por traigo las categorias por la empresa
    $categorias = CategoriasSalonDeLaFamaPorEmpresaTipoBanners($id_empresa, 1);
    foreach ($categorias as $unico) {
        //Boton Propuesta
        if ($unico->tabla_usuarios == 1) {
            if ($id_empresa == 22) {
                $row .= file_get_contents("views/salondelafama/22_row_bloquesalonfama.html");
            } else {
                $row .= file_get_contents("views/salondelafama/row_bloquesalonfama.html");
            }
            $datos = TraeListadoClasicos($id_empresa, 1, "ORDER BY RAND()");
            $row   = str_replace("{TEXTO1}", $datos[0]->antiguedad . " a&ntilde;os en nuestra empresa.", $row);
            $row   = str_replace("{CATEGORIA_SALON}", "", $row);
            $row   = str_replace("{RESULTADO}", $datos[0]->antiguedad . " a&ntilde;os en nuestra empresa.", $row);
            $row   = str_replace("{BOTON_VER_DETALLE}", file_get_contents("views/salondelafama/boton_ver_detalle.html"), $row);
            $row   = str_replace("{ENVIRONMENT_BOTON}", $unico->environment_boton, $row);
            $row   = str_replace("{ID_CATEGORIA_SALON_FAMA_ENCODEADO}", Encodear3($unico->id), $row);
        } else {
            //$datos=ObtenerSalonPorCategoriaYEmpresa($id_empresa, $unico->id, 1);
            $datos = ObtenerSalonPorCategoriaYEmpresaPorAno($id_empresa, $unico->id, 1, $ano);
            if ($datos) {
                $row .= file_get_contents("views/salondelafama/row_bloquesalonfama.html");
            } else {
                $row .= file_get_contents("views/salondelafama/row_bloquesalonfama_sin.html");
            }
            if ($unico->ve_boton == 1) {
                $row = str_replace("{BOTON_VER_DETALLE}", file_get_contents("views/salondelafama/boton_ver_detalle.html"), $row);
                $row = str_replace("{ENVIRONMENT_BOTON}", $unico->environment_boton, $row);
                $row = str_replace("{ID_CATEGORIA_SALON_FAMA_ENCODEADO}", Encodear3($unico->id), $row);
            } else {
                $row = str_replace("{BOTON_VER_DETALLE}", "", $row);
            }
            if ($unico->proceso_anterior) {
                $row = str_replace("{BOTON_PROPUESTA}", file_get_contents("views/salondelafama/boton_dinamico.html"), $row);
                $row = str_replace("{VALUE}", "Ver " . $unico->proceso_anterior, $row);
                $row = str_replace("{CASE_BOTON_DINAMICO}", "?sw=listadoSalon&an=" . $unico->proceso_anterior . "&itip=" . Encodear3($unico->id), $row);
            }
            $row = str_replace("{TEXTO1}", $datos[0]->texto1, $row);
            $row = str_replace("{CATEGORIA_SALON}", $datos[0]->nombre_valor, $row);
            $row = str_replace("{RESULTADO}", $datos[0]->impacto, $row);
        }
        if ($unico->boton_propuesta == 1 && count($datos) > 0) {
            $row = str_replace("{BOTON_PROPUESTA}", file_get_contents("views/salondelafama/boton_ver_propuesta.html"), $row);
            $row = str_replace("{ID_CATEGORIA_ENCODEADO}", Encodear3($unico->id), $row);
        } else {
            $row = str_replace("{BOTON_PROPUESTA}", "", $row);
        }
        $row = str_replace("{NOMBRE_PERSONAS}", $datos[0]->nombre_persona . " " . $datos[0]->apaterno . " " . $datos[0]->amaterno . "<br>" . $datos[0]->ubicacion, $row);
        $row = str_replace("{CARGO_PERSONAS}", $datos[0]->cargo, $row);
        $row = str_replace("{URL_PERSONA}", VerificaFotoPersonal($datos[0]->rut), $row);
        $row = str_replace("{RUT_ENCODEADO}", Encodear3($datos[0]->rut), $row);
        $row = str_replace("{NOMBRE_CATEGORIA}", $unico->nombre, $row);
        $row = str_replace("{LOGO_CATEGORIA}", $unico->imagen, $row);
        $row = str_replace("{DESCRIPCION_CATEGORIA}", $unico->descripcion, $row);
        $row = str_replace("{TEXTO2}", $datos[0]->texto2, $row);
        $row = str_replace("{TEXTO3}", $datos[0]->texto3, $row);
        $row = str_replace("{TEXTO4}", $datos[0]->texto4, $row);
        $row = str_replace("{TEXTO5}", $datos[0]->texto5, $row);
    }
    //$row=file_get_contents("views/salondelafama/bloquesalonfama.html");
    $bloque = str_replace("{LISTADO_SALON_FAMA}", utf8_encode($row), $bloque);
    $html   = str_replace("{BLOQUE_MINISALONFAMA}", $bloque, $html);
    return ($html);
}
function BloqueTips($html)
{
    $row  = file_get_contents("views/bloques/bloquetipsseguridad.html");
    $html = str_replace("{BLOQUE_TIPS_SEGURIDAD}", $row, $html);
    return ($html);
}
function BloqueMiniBuenasPracticas($html, $id_empresa)
{
    $rut        = $_SESSION["user_"];
    //Aca en primer lugar veo si es que hay buenas practicas para esta empresa
    $categorias = CategoriasSalonDeLaFamaPorEmpresaTipoBanners($id_empresa, 2);
    if ($categorias) {
        //El entorno de los bloques de buenas practicas
        $entorno = file_get_contents("views/buenas_practicas/index.html");
        foreach ($categorias as $unico) {
            $datos = ObtenerSalonPorCategoriaYEmpresa($id_empresa, $unico->id, 1);
            if ($datos) {
                $row .= file_get_contents("views/" . $unico->template_row);
                $row .= file_get_contents("views/buenas_practicas/boton_vermas.html");
            } else {
                $entorno = file_get_contents("views/buenas_practicas/index_sin.html");
                $row .= file_get_contents("views/buenas_practicas/row2_sin.html");
                //$row.=file_get_contents("views/buenas_practicas/boton_vermas.html");
            }
            $row = str_replace("{ID_CATEGORIA_ENCODEADA}", Encodear3($unico->id), $row);
            $row = str_replace("{NOMBRE}", utf8_encode($datos[0]->nombre_persona) . " " . utf8_encode($datos[0]->apaterno) . " " . utf8_encode($datos[0]->amaterno), $row);
            $row = str_replace("{CARGO}", utf8_encode($datos[0]->cargo), $row);
            $row = str_replace("{URL_PERSONA}", VerificaFotoPersonal($datos[0]->rut), $row);
            $row = str_replace("{RUT_ENCODEADO}", Encodear3($datos[0]->rut), $row);
            $row = str_replace("{TEXTO1}", $datos[0]->texto1, $row);
            $row = str_replace("{TEXTO2}", $datos[0]->texto2, $row);
            $row = str_replace("{TEXTO3}", $datos[0]->texto3, $row);
            $row = str_replace("{TEXTO4}", $datos[0]->texto4, $row);
            $row = str_replace("{TEXTO5}", $datos[0]->texto5, $row);
            $row = str_replace("{VALOR_SITUACION}", utf8_encode($datos[0]->situacion), $row);
            $row = str_replace("{VALOR_ACCION}", utf8_encode($datos[0]->accion), $row);
            $row = str_replace("{VALOR_IMPACTO}", utf8_encode($datos[0]->impacto), $row);
            $row = str_replace("{FECHAPUBLICACION}", utf8_encode($datos[0]->fecha), $row);
            //Debo verificar, si para este usuario, ya tiene el megusta con este contenido
            $row = str_replace("{MEGUSTA}", ColocaMeGusta($datos[0]->id, "id_salonfama_publicados", $id_empresa, $rut), $row);
        }
        $entorno = str_replace("{BLOQUE_MINIBUENASPRACTICAS}", $row, $entorno);
        //$html = str_replace("{BLOQUE_MINIBUENASPRACTICAS}",$row,$html);
        $html    = str_replace("{BLOQUE_BUENAS_PRACTICAS}", $entorno, $html);
    } else {
        $html = str_replace("{BLOQUE_BUENAS_PRACTICAS}", "", $html);
    }
    $html = str_replace("{IMAGEN_INICIO_PAGINA}", $categorias[0]->imagen_inicio_pagina, $html);
    $html = str_replace("{TITULO}", utf8_encode($categorias[0]->titulo_listado), $html);
    $html = str_replace("{ID_CATEGORIA_ENCODEADO}", Encodear3($categorias[0]->id), $html);
    return ($html);
}
function BloqueMiniBuenasPracticas2($html)
{
    $row  = file_get_contents("views/bloques/bloquebuenaspracticas2.html");
    $html = str_replace("{BLOQUE_MINIBUENASPRACTICAS2}", $row, $html);
    return ($html);
}
function BloqueCumpleanos($html, $id_empresa)
{
    //$row=file_get_contents("views/bloques/bloquecumpleanos.html");
    //$html = str_replace("{BLOQUE_CUMPLEANOS}",$row,$html);
    //Cumpleaños por dia
    $cumpleaños = ObtenerCumpleanosPorDiaPorEmpresa($id_empresa);
    if ($cumpleaños) {
        foreach ($cumpleaños as $unico) {
            if ($id_empresa == 22) {
                $row .= file_get_contents("views/cumpleanos/22_row_bloquecumpleanos.html");
            } else {
                $row .= file_get_contents("views/cumpleanos/row_bloquecumpleanos.html");
            }
            if ($unico->nombre_completo) {
                $row = str_replace("{NOMBRE}", $unico->nombre_completo . "<br>" . $unico->ubicacion, $row);
            } else {
                $row = str_replace("{NOMBRE}", $unico->nombre_completo . "<br>" . $unico->ubicacion, $row);
            }
            $row = str_replace("{RUT_ENCODEADO}", Encodear3($unico->rut), $row);
            $row = str_replace("{CARGO}", $unico->cargo, $row);
            $row = str_replace("{FECHA_CUMPLEANOS}", formatearFecha($unico->fecha_nacimiento), $row);
            $row = str_replace("{UBICACION}", $unico->ubicacion, $row);
            $row = str_replace("{URL_PERSONA}", VerificaFotoPersonal($unico->rut), $row);
        }
    } else {
        //Veo si hay cumpleaños en el mes
        $cumpleanos_mes = ObtenerCumpleanosPorMesPorEmpresa($id_empresa, 4);
        foreach ($cumpleanos_mes as $unico) {
            if ($id_empresa == 22) {
                $row .= file_get_contents("views/cumpleanos/22_row_bloquecumpleanos.html");
            } else {
                $row .= file_get_contents("views/cumpleanos/row_bloquecumpleanos.html");
            }
            if (!$unico->nombre) {
                $row = str_replace("{NOMBRE}", $unico->nombre_completo, $row);
            } else {
                $row = str_replace("{NOMBRE}", $unico->nombre_completo, $row);
            }
            $row = str_replace("{RUT_ENCODEADO}", Encodear3($unico->rut), $row);
            $row = str_replace("{UBICACION}", "Ubicaion:" . $unico->ubicacion, $row);
            $row = str_replace("{CARGO}", $unico->cargo, $row);
            $row = str_replace("{FECHA_CUMPLEANOS}", formatearFecha($unico->fecha_nacimiento), $row);
            $row = str_replace("{URL_PERSONA}", VerificaFotoPersonal($unico->rut), $row);
        }
    }
    $html = str_replace("{BLOQUE_CUMPLEANOS}", utf8_Encode($row), $html);
    $html = str_replace("{MES_ENCODEADO}", Encodear3(date(m)), $html);
    return ($html);
}
function BloqueCumpleanosPorMes($html, $id_empresa)
{
    //$row=file_get_contents("views/bloques/bloquecumpleanos.html");
    //$html = str_replace("{BLOQUE_CUMPLEANOS}",$row,$html);
    //Cumpleaños por dia
    //Veo si hay cumpleaños en el mes
    $cumpleanos_mes = ObtenerCumpleanosPorMesPorEmpresaTodos($id_empresa, "");
    foreach ($cumpleanos_mes as $unico) {
        $row .= file_get_contents("views/cumpleanos/row_bloquecumpleanos.html");
        $row = str_replace("{NOMBRE}", $unico->nombre_completo, $row);
        $row = str_replace("{RUT_ENCODEADO}", Encodear3($unico->rut), $row);
        $row = str_replace("{CARGO}", $unico->cargo, $row);
        $row = str_replace("{FECHA_CUMPLEANOS}", formatearFecha($unico->fecha_nacimiento), $row);
        $row = str_replace("{URL_PERSONA}", VerificaFotoPersonal($unico->rut), $row);
    }
    $html = str_replace("{BLOQUE_LISTADO_CUMPLE_MES}", utf8_Encode($row), $html);
    return ($html);
}
function BloqueNuevosIngresos($html, $variable, $id_empresa)
{
    $row      = file_get_contents("views/bloques/bloquenuevosingresos.html");
    //Aca traigo 2 nuevos ingresos aleatorios
    //$usuarios=ObtieneMovimientosNuevosIngresos("1", "2", $variable);
    $usuarios = ObtieneMovimientosNuevosIngresosPorEmpresa("1", "2", $variable, $id_empresa);
    if ($variable) {
        $template_fila = file_get_contents("views/nuevos_ingresos/row_bloquenuevosingresos_por_gerencia.html");
    } else {
        $template_fila = file_get_contents("views/nuevos_ingresos/row_bloquenuevosingresos.html");
    }
    foreach ($usuarios as $unico) {
        //$fila.=file_get_contents("views/nuevos_ingresos/row_bloquenuevosingresos.html");
        $fila .= $template_fila;
        $fila = str_replace("{CARGO_A}", $unico->cargo_a, $fila);
        $fila = str_replace("{GERENCIA_A}", $unico->gerencia_a, $fila);
        $fila = str_replace("{CARGO_DE}", $unico->cargo_de, $fila);
        $fila = str_replace("{NOMBRE}", $unico->nombre . " " . $unico->apaterno . " " . $unico->amaterno . "<br>" . $unico->ubicacion, $fila);
        $fila = str_replace("{GERENCIA}", $unico->gerencia, $fila);
        $fila = str_replace("{URL_PERSONA}", VerificaFotoPersonal($unico->rut), $fila);
        $fila = str_replace("{RUT_ENCODEADO}", Encodear3($unico->rut), $fila);
    }
    $html = str_replace("{BLOQUE_NUEVOS_INGRESOS}", utf8_encode($fila), $html);
    return ($html);
}
function BloqueMovimientosInternos($html, $variable, $id_empresa, $limit)
{ /*
    $row = file_get_contents("views/bloques/bloquemovimientosinternos.html");
    if ($limit) {
        $limite = $limit;
    } else {
        $limite = "";
    }
    //$usuarios=ObtieneMovimientosNuevosIngresos("2", $limite, $variable);
    $usuarios = ObtieneMovimientosNuevosIngresosPorEmpresa("2", $limite, $variable, $id_empresa);
    if ($variable) {
        $template_fila = file_get_contents("views/nuevos_ingresos/row_bloquenuevosingresos_por_gerencia.html");
    } else {
        $template_fila = file_get_contents("views/movimientos_internos/row_bloquemovimientosinternos.html");
    }
    $i = 1;
    foreach ($usuarios as $unico) {
        //$fila.=file_get_contents("views/movimientos_internos/row_bloquemovimientosinternos.html");
        $fila .= $template_fila;
        $fila = str_replace("{CARGO_A}", $unico->cargo_a, $fila);
        $fila = str_replace("{CARGO_DE}", $unico->cargo_de, $fila);
        $fila = str_replace("{NOMBRE}", $unico->nombre . " " . $unico->apaterno . " " . $unico->amaterno, $fila);
        $fila = str_replace("{RUT_ENCODEADO}", Encodear3($unico->rut), $fila);
        $fila = str_replace("{GERENCIA_A}", $unico->gerencia_a, $fila);
        $fila = str_replace("{GERENCIA_DE}", $unico->gerencia_de, $fila);
        $fila = str_replace("{URL_PERSONA}", VerificaFotoPersonal($unico->rut), $fila);
        if ($variable) {
            if ($i == 3) {
                $i = 1;
                $fila .= "<div class='row'></div>";
            } else {
                $i++;
            }
        }
    }
    $html = str_replace("{BLOQUE_MOVIMIENTOS_INTERNOS}", utf8_encode($fila), $html);
    return ($html); */
}
function ListadoNoticias($html, $id_empresa, $id_categoria, $pagina)
{
    //cantidad de noticias por pagina
    $cantidad_por_pagina = 12;
    //Traigo las noticias
    if ($id_categoria > 0) {
        //$noticias=TraeNoticiasPorCategoria($id_empresa, $id_categoria);
        $noticias = TraeNoticiasPorCategoriaTodas($id_empresa, $id_categoria, $pagina, $cantidad_por_pagina);
    } else {
        $noticias = TraeNoticias($id_empresa, $pagina, $cantidad_por_pagina);
    }
    if ($noticias) {
        $total_html   = "";
        $contador_row = 1;
        foreach ($noticias as $not) {
            $row                 = file_get_contents("views/noticias/row_noticia.html");
            $TodoslosComentarios = TodosComentarios($not->id);
            $row                 = str_replace("{PORTADA}", imagen_existe($not->portada), $row);
            $row                 = str_replace("{TITULO}", $not->titulo, $row);
            $row                 = str_replace("{FECHA}", FechaTipoSpa($not->fecha_creacion), $row);
            //$row = str_replace("{CONTENIDO_CORTO}",substr($not->contenido, 0, 100),$row);
            $row                 = str_replace("{CONTENIDO_CORTO}", $not->bajada, $row);
            $row                 = str_replace("{ID_NOTICIA}", Encodear($not->id), $row);
            $row                 = str_replace("{COMENTARIOS}", count($TodoslosComentarios), $row);
            $row                 = str_replace("{CATEGORIA}", $not->nombre_categoria, $row);
            $datos_rut_creador   = UsuarioEnBasePersonas($not->rut_creador);
            $row                 = str_replace("{AUTOR}", $datos_rut_creador[0]->nombre . " " . $datos_rut_creador[0]->apaterno . " " . $datos_rut_creador[0]->amaterno, $row);
            $total_html .= $row;
            if ($contador_row == 3) {
                $total_html .= "<div class='row'></div>";
                $contador_row = 0;
            }
            $contador_row++;
        }
        //echo $total_html; exit;
        $html = str_replace("{LISTADO_NOTICIAS}", utf8_encode($total_html), $html);
    } else {
        $html = str_replace("{LISTADO_NOTICIAS}", file_get_contents("views/noticias/row_sin_noticia.html"), $html);
    }
    //ACA COLOCO LAS NOTICIAS QUE SON PRINCIPALES
    //PAGINACION DE NOTICIAS
    $html = str_replace("{PAGINACION_NOTICIAS}", ColocaPaginacionDeNoticias($pagina, $id_empresa, $cantidad_por_pagina, $id_categoria), $html);
    return ($html);
}
function DetalleNoticia($html, $id_noticia, $id_empresa)
{
    $rut             = $_SESSION["user_"];
    //$detalle_noticia=NoticiaPorId($id_noticia);
    $detalle_noticia = NoticiaPorIdConVistas($id_noticia, $id_empresa);
    if ($detalle_noticia[0]->ve_comentarios == 1) {
        $html = str_replace("{BLOQUE_COMENTARIOS}", "", $html);
    } else {
        $html = str_replace("{BLOQUE_COMENTARIOS}", file_get_contents("views/noticias/single_bloque_comentarios.html"), $html);
        $html = str_replace("{IDNOTICIA}", $id_noticia, $html);
    }
    if ($detalle_noticia[0]->nombre_video) {
        $html = str_replace("{BLOQUE_VIDEO}", file_get_contents("views/noticias/single_bloque_video.html"), $html);
        $html = str_replace("{NOMBRE_VIDEO}", $detalle_noticia[0]->nombre_video, $html);
        $html = str_replace("{ID_NOTICIA}", $id_noticia, $html);
    } else {
        $html = str_replace("{BLOQUE_VIDEO}", "", $html);
    }
    if ($detalle_noticia[0]->id_galeria) {
        $html = str_replace("{BLOQUE_GALERIA}", file_get_contents("views/noticias/single_bloque_galeria.html"), $html);
        $html = str_replace("{ID_GALERIA}", $detalle_noticia[0]->id_galeria, $html);
    } else {
        $html = str_replace("{BLOQUE_GALERIA}", "", $html);
    }
    if ($detalle_noticia[0]->id_biblioteca) {
        $html = str_replace("{BLOQUE_BIBLIOTECA}", file_get_contents("views/noticias/single_bloque_biblioteca.html"), $html);
        $html = str_replace("{ID_BIBLIOTECA}", $detalle_noticia[0]->id_galeria, $html);
    } else {
        $html = str_replace("{BLOQUE_BIBLIOTECA}", "", $html);
    }
    if ($detalle_noticia[0]->doc1) {
        $html = str_replace("{BLOQUE_DOCUMENTO1}", file_get_contents("views/noticias/single_bloque_documento.html"), $html);
        $html = str_replace("{NOMBRE_DOCUMENTO}", $detalle_noticia[0]->doc1, $html);
        $html = str_replace("{TEXTO_DOCUMENTO}", utf8_encode($detalle_noticia[0]->descripcion_doc1), $html);
    } else {
        $html = str_replace("{BLOQUE_DOCUMENTO1}", "", $html);
    }
    if ($detalle_noticia[0]->doc2) {
        $html = str_replace("{BLOQUE_DOCUMENTO2}", file_get_contents("views/noticias/single_bloque_documento.html"), $html);
        $html = str_replace("{NOMBRE_DOCUMENTO}", $detalle_noticia[0]->doc2, $html);
        $html = str_replace("{TEXTO_DOCUMENTO}", utf8_encode($detalle_noticia[0]->descripcion_doc2), $html);
    } else {
        $html = str_replace("{BLOQUE_DOCUMENTO2}", "", $html);
    }
    if ($detalle_noticia[0]->doc3) {
        $html = str_replace("{BLOQUE_DOCUMENTO3}", file_get_contents("views/noticias/single_bloque_documento.html"), $html);
        $html = str_replace("{NOMBRE_DOCUMENTO}", $detalle_noticia[0]->doc3, $html);
        $html = str_replace("{TEXTO_DOCUMENTO}", utf8_encode($detalle_noticia[0]->descripcion_doc3), $html);
    } else {
        $html = str_replace("{BLOQUE_DOCUMENTO3}", "", $html);
    }
    if ($detalle_noticia[0]->doc4) {
        $html = str_replace("{BLOQUE_DOCUMENTO4}", file_get_contents("views/noticias/single_bloque_documento.html"), $html);
        $html = str_replace("{NOMBRE_DOCUMENTO}", $detalle_noticia[0]->doc4, $html);
        $html = str_replace("{TEXTO_DOCUMENTO}", utf8_encode($detalle_noticia[0]->descripcion_doc4), $html);
    } else {
        $html = str_replace("{BLOQUE_DOCUMENTO4}", "", $html);
    }
    if ($detalle_noticia[0]->doc5) {
        $html = str_replace("{BLOQUE_DOCUMENTO5}", file_get_contents("views/noticias/single_bloque_documento.html"), $html);
        $html = str_replace("{NOMBRE_DOCUMENTO}", $detalle_noticia[0]->doc5, $html);
        $html = str_replace("{TEXTO_DOCUMENTO}", utf8_encode($detalle_noticia[0]->descripcion_doc5), $html);
    } else {
        $html = str_replace("{BLOQUE_DOCUMENTO5}", "", $html);
    }
    $TraerVotos = TraerVotos('tbl_noticias_likes', $id_noticia);
    $ExisteVoto = ExisteVoto('tbl_noticias_likes', $_SESSION["user_"], $id_noticia);
    if ($ExisteVoto) {
        $tegusta = 'a ti y ' . count($TraerVotos) . ' personas les gusta esto';
    } else {
        $tegusta = 'a ' . count($TraerVotos) . ' personas les gusta esto';
    }
    $html          = str_replace("{IDNOTICIA_ENCODEADA}", Encodear($id_noticia), $html);
    $html          = str_replace("{VISTO}", $detalle_noticia[0]->total_visitas, $html);
    $html          = str_replace("{TITULO}", utf8_encode($detalle_noticia[0]->titulo), $html);
    $html          = str_replace("{BAJADA}", utf8_encode($detalle_noticia[0]->bajada), $html);
    $html          = str_replace("{CONTENIDO}", utf8_encode($detalle_noticia[0]->contenido), $html);
    $html          = str_replace("{CATEGORIA}", utf8_encode($detalle_noticia[0]->nombre_categoria), $html);
    $html          = str_replace("{PERFIL}", utf8_encode($detalle_noticia[0]->perfil), $html);
    $html          = str_replace("{TAG}", SepararTag($detalle_noticia[0]->tag), $html);
    $html          = str_replace("{PORTADA}", imagen_existe($detalle_noticia[0]->portada), $html);
    $html          = str_replace("{LIKE}", $tegusta, $html);
    $html          = str_replace("{FECHA}", FechaTipoSpa($detalle_noticia[0]->fecha_creacion), $html);
    $html          = str_replace("{MEGUSTA}", ColocaMeGusta($id_noticia, "id_noticia", $id_empresa, $rut), $html);
    //Datos del Creador
    $datos_creador = UsuarioEnBasePersonas($detalle_noticia[0]->rut_creador);
    $html          = str_replace("{AUTOR}", $datos_creador[0]->nombre . " " . $datos_creador[0]->apaterno . " " . $datos_creador[0]->amaterno, $html);
    $html          = str_replace("{IDUSUARIO}", $_SESSION['user_'], $html);
    //galeria
    if ($detalle_noticia[0]->galeria) {
        global $directorio_galerias;
        $galeria = '';
        $dir     = $directorio_galerias . $detalle_noticia[0]->galeria . '/'; //nombre de la carpeta, carpeta global de galerias concatenada a nombre galeria
        $images  = glob("$dir{*.gif,*.jpg,*.png}", GLOB_BRACE);
        foreach ($images as $v) {
            $galeria .= '
    <a href="' . $v . '" data-lightbox="image-1" data-title="' . $detalle_noticia[0]->titulo . '">
    <img src="' . $v . '" border="0" style="width:150px;float:left;margin:10px;"  data-lightbox="roadtrip"/>
    </a>';
        }
        $html = str_replace("{GALERIA}", $galeria, $html);
    } else {
        $html = str_replace("{GALERIA}", '', $html);
    }
    $Comentarios      = TodosComentarios($id_noticia);
    $todoscomentarios = '';
    $i                = '';
    foreach ($Comentarios as $com) {
        $row           = file_get_contents("views/noticias/row_comentario.html");
        $NombreUsuario = UsuarioEnBasePersonas($com->id_usuario);
        $nombre        = $NombreUsuario[0]->nombre_completo;
        $row           = str_replace("{COMENTARIO}", $com->comentario, $row);
        $row           = str_replace("{FECHA}", FechaTipoSpa($com->fecha), $row);
        $row           = str_replace("{NOMBRE}", utf8_encode($nombre), $row);
        $row           = str_replace("{URL_FOTO_PERSONA}", ColocaImagenVerificaAvatar($com->id_usuario), $row);
        $todoscomentarios .= $row;
        $i++;
    }
    $html = str_replace("{COMENTARIOS}", $todoscomentarios, $html);
    $html = str_replace("{TOTALCOMENTARIOS}", $i, $html);
    return ($html);
}
function imagen_existe($imagen)
{
    global $directorio_noticias;
    $imagenexiste = $directorio_noticias . $imagen;
    $comprobacion = $directorio_noticias . 'noticiapordefecto.jpg';
    if (file_exists($imagenexiste)) {
        $comprobacion = $imagenexiste;
    }
    return $comprobacion;
}
function FechaTipoFeibu($datetime)
{
    $datetime = round((time() - strtotime($datetime)) / 60);
    if ($datetime < 1)
        return 'Hace unos segundos.';
    if ($datetime == 1)
        return 'Hace un minuto aproximadamente.';
    if ($datetime < 60)
        return 'Hace ' . $datetime . ' minutos.';
    if ($datetime >= 60) {
        $datetime = round($datetime / 60);
        if ($datetime == 1)
            return 'Hace una hora aproximadamente.';
        if ($datetime < 24)
            return 'Hace ' . $datetime . ' horas.';
        if ($datetime >= 24) {
            $datetime = round($datetime / 24);
            if ($datetime == 1)
                return 'Hace un dia aproximadamente.';
            if ($datetime < 7)
                return 'Hace ' . $datetime . ' dias.';
            if ($datetime >= 7) {
                $datetime = round($datetime / 7);
                if ($datetime == 1)
                    return 'Hace una semana aproximadamente.';
                if ($datetime < 4)
                    return 'Hace mas de una semana';
                else {
                    if ($_SESSION["id_empresa"] == 41) {
                        return '';
                    } else {
                        return 'Hace mas de un mes';
                    }
                }
            }
        }
    }
}
function FechaTipoSpa($datetime)
{
    $originalDate = $datetime;
    $newDate      = date("d-m-Y", strtotime($originalDate));
    return $newDate;
}
function SepararTag($tag)
{
    $valor_array = explode(',', $tag);
    $html        = '';
    foreach ($valor_array as $llave => $valores) {
        $html .= '<a href="#" rel="tag">' . $valores . '</a>';
    }
    return utf8_encode($html);
}
////FIN CHIS
function ObtenerCategoriaEvalJefe($nota, $requerido)
{
    $color_bajo   = "#e44c41";
    $color_cumple = "#88cd2a";
    $color_alto   = "#6adcfa";
    if ($nota < $requerido) {
        $arreglo[0] = "Bajo";
        $arreglo[1] = $color_bajo;
    } else if ($nota == $requerido) {
        $arreglo[0] = "Cumple";
        $arreglo[1] = $color_cumple;
    } else if ($nota > $requerido) {
        $arreglo[0] = "Sobre";
        $arreglo[1] = $color_alto;
    }
    if ($requerido <= 2) {
        $arreglo[2] = $color_bajo;
        $arreglo[3] = "Bajo";
    } else if ($requerido == 3) {
        $arreglo[2] = $color_cumple;
        $arreglo[3] = "Cumple";
    } else if ($requerido > 3) {
        $arreglo[2] = $color_alto;
        $arreglo[3] = "Sobre";
    }
    //Porcentaje
    return ($arreglo);
}
function MuestraInformeEvaluacionJefatura($PRINCIPAL, $id_programa, $evaluado, $evaluador)
{
    //traigo las respuestas de las conductas de este programa, que fueron evaluadas.
    $respuestas = TieneRespuestasEvaluacionJefeCrucePRogramas($evaluado, $evaluador, $id_programa);
    $conductas  = "";
    foreach ($respuestas as $resp) {
        $conductas .= file_get_contents("views/equipo/informe/row_conductas.html");
        $conductas       = str_replace("{NOMBRE_CONDUCTA}", $resp->nombre_conducta, $conductas);
        $valor_respuesta = ObtenerCategoriaEvalJefe($resp->respuesta, $resp->requerido);
        $conductas       = str_replace("{RESULTADO_RESPUESTA}", $valor_respuesta[0], $conductas);
        $conductas       = str_replace("{COLOR1}", $valor_respuesta[1], $conductas);
        $conductas       = str_replace("{COLOR2}", $valor_respuesta[2], $conductas);
        $conductas       = str_replace("{REQUERIDO}", $valor_respuesta[3], $conductas);
    }
    $PRINCIPAL        = str_replace("{LISTADO_CONDUCTAS_EVALUADAS}", $conductas, $PRINCIPAL);
    // Obtengo Comentarios de la Evaluacion de la JEfatura
    $comentarios_eval = TieneComentarioEvaluacionJefe($evaluado, $evaluador, $id_programa);
    $PRINCIPAL        = str_replace("{COMENTARIOS_MEJORA}", utf8_encode($comentarios_eval[0]->comentario), $PRINCIPAL);
    return ($PRINCIPAL);
}
function MuestraEvaluacionJefe($PRINCIPAL, $rut_evaluado, $rut_evaluador, $id_programa)
{
    $datos_programa               = DatosPrograma($id_programa);
    $alternativas                 = AlternativasDadoIdPrograma($datos_programa[0]->id_grupo_alternativa);
    $encabezado_html_alternativas = "";
    foreach ($alternativas as $alt) {
        $encabezado_html_alternativas .= '<div class="col-md-1 col-sm-1 subtitulo_skill' . $alt->estilo . '">' . utf8_encode($alt->alternativa) . '</div>';
    }
    //Con el id del programa, obtengo las conductas.
    $conductas = ObtenerConductasPorPrograma($id_programa);
    $preguntas = "";
    foreach ($conductas as $cond) {
        $preguntas .= file_get_contents("views/equipo/row_pregunta.html");
        $preguntas = str_replace("{NOMBRE_PREGUNTA}", $cond->nombre, $preguntas);
        //Aca traigo las alternativas dado el programa.
        $alter     = "";
        foreach ($alternativas as $alt) {
            //Verifico, si para este evaluado, evaluador, conducta y programa tieme respuesta, si es asi, muestro el template con la alternativa chequeada.
            $tiene_respuesta = TieneRespuestasEvaluacionJefe($rut_evaluado, $rut_evaluador, $cond->id, $id_programa);
            if ($alt->puntaje == $tiene_respuesta[0]->respuesta) {
                //if($tiene_respuesta){
                $alter .= file_get_contents("views/equipo/alternativa_pregunta_eval_jefe_seleccionada.html");
            } else {
                $alter .= file_get_contents("views/equipo/alternativa_pregunta_eval_jefe.html");
            }
            if ($alt->puntaje == $cond->requerido) {
                $alter = str_replace("{STILO_REQUERIDO}", " color_requerido", $alter);
            } else {
                $alter = str_replace("{STILO_REQUERIDO}", "", $alter);
            }
            $alter = str_replace("{VALUE}", $alt->puntaje, $alter);
        }
        $preguntas = str_replace("{OPTIONS_PREGUNTA_EVALUACION_JEFE}", $alter, $preguntas);
        $preguntas = str_replace("{ID_PREGUNTA_ENCODEADO}", $cond->id, $preguntas);
    }
    //Veo si tiene comentarios de la evaluacion de la jefatura
    $comentario_eval = TieneComentarioEvaluacionJefe($rut_evaluado, $rut_evaluador, $id_programa);
    $PRINCIPAL       = str_replace("{VALUE_MEJORA}", utf8_encode($comentario_eval[0]->comentario), $PRINCIPAL);
    //$PRINCIPAL = str_replace("{VALUE_MEJORA}",$comentario_eval[0]->comentario,$PRINCIPAL);
    $PRINCIPAL       = str_replace("{LISTADO_PREGUNTAS}", utf8_encode($preguntas), $PRINCIPAL);
    $PRINCIPAL       = str_replace("{EVALUADO_ENCODEADO}", Encodear3($rut_evaluado), $PRINCIPAL);
    $PRINCIPAL       = str_replace("{ID_PROGRAMA_ENCODEADO}", Encodear3($id_programa), $PRINCIPAL);
    $PRINCIPAL       = str_replace("{ENCABEZADO_OPCIONES_EVAL_JEFE}", ($encabezado_html_alternativas), $PRINCIPAL);
    return ($PRINCIPAL);
}
function MiEquipo($PRINCIPAL, $rut)
{
    //Verificar si es jefe, si es que lo es, viene el listado de colaboradores.
    $es_jefe = EsJefe($rut);
    if ($es_jefe) {
        $colaborador = "";
        foreach ($es_jefe as $col) {
            $colaborador .= file_get_contents("views/equipo/row_colaboradores.html");
            $colaborador        = str_replace("{NOMBRE}", $col->nombre_completo, $colaborador);
            $colaborador        = str_replace("{RUT_EVALUADO_ENCODEADO}", Encodear3($col->rut), $colaborador);
            $colaborador        = str_replace("{CARGO}", $col->cargo, $colaborador);
            $colaborador        = str_replace("{RUT}", $col->rut, $colaborador);
            $colaborador        = str_replace("{GERENCIA}", $col->gerencia, $colaborador);
            $colaborador        = str_replace("{FOTO_PERSONA}", "img/personas/" . $col->rut . ".jpg", $colaborador);
            $colaborador        = str_replace("{FECHA_INGRESO}", $col->fecha_ingreso, $colaborador);
            $mallas_por_empresa = MallasPorEmpresa($col->id_empresa);
            //Con el criterio malla, me indica si tiene o no asignada la malla encontrada para el usuario
            $criterio_malla     = VerificaCriterioMalla($mallas_por_empresa[0]->campo, $mallas_por_empresa[0]->valor, $col->rut, $col->id_empresa);
            if ($criterio_malla) {
                //Con la malla, traigo cuales son los programas.
                $programas = ProgramasDadoMallaTraeEvaluacionesJefe($mallas_por_empresa[0]->id_malla);
                if ($programas) {
                    //aca recorro el arreglo de programas.
                    //Cada uno de estos corresponde a las evaluaciones que el jefe debe realizar sobre el evaluado.
                    $evaluaciones_ver = "";
                    foreach ($programas as $prog) {
                        $evaluaciones_ver .= 'Programa: ' . $prog->nombre . ': <input type="button" value="Acceder"   onClick="location.href=\'?sw=evJef&ie=' . Encodear3($col->rut) . '&i=' . Encodear3($prog->id) . ' \' " ><br>';
                    }
                    //$evaluaciones_ver="si";
                } else {
                    $evaluaciones_ver = "No posee evaluaciones asocidas a los programas de su malla";
                }
            } else {
                $evaluaciones_ver = "No posee evaluaciones asocidas a los programas de su malla";
            }
            $colaborador = str_replace("{EVALUACIONES}", $evaluaciones_ver, $colaborador);
        }
        $PRINCIPAL = str_replace("{LISTADOS_COLABORADORES_EQUIPO}", $colaborador, $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{LISTADOS_COLABORADORES_EQUIPO}", file_get_contents("views/equipo/no_es_jefe.html"), $PRINCIPAL);
    }
    return ($PRINCIPAL);
}
function segundos_tiempo($segundos)
{
    $minutos    = $segundos / 60;
    $horas      = floor($minutos / 60);
    $minutos2   = $minutos % 60;
    $segundos_2 = $segundos % 60 % 60 % 60;
    if ($minutos2 < 10)
        $minutos2 = '0' . $minutos2;
    if ($segundos_2 < 10)
        $segundos_2 = '0' . $segundos_2;
    if ($segundos < 60) {
        /* segundos */
        $resultado = round($segundos) . ' Segundos';
    } elseif ($segundos > 60 && $segundos < 3600) {
        /* minutos */
        $resultado = $minutos2 . ':' . $segundos_2 . ' Minutos';
    } else {
        /* horas */
        $resultado = $horas . ':' . $minutos2 . ':' . $segundos_2 . ' Horas';
    }
    return $resultado;
}
/*function ArmaPaginacionEvaluacion($total_preguntas, $pagina_actual)
{
    $html       = "";
    $i          = 1;
    $paginacion = '<div class="pagination_sgd"><ul>';
    foreach ($total_preguntas as $preg) {
        if ($pagina_actual == $i) {
            $paginacion .= '<li ><a class="pagination_sgd_activo">' . $i . '</a></li>';
        } else {
            $paginacion .= '<li><a href="#">' . $i . '</a></li>';
        }
        $i++;
    }
    $paginacion .= '</ul></div>';
    return ($paginacion);
}
function ObtenerNotaDeEvaluacion($id_objeto, $rut)
{
    $respuestas  = RespuestasDadoRutObjeto($rut, $id_objeto);
    $correctas   = 0;
    $incorrectas = 0;
    foreach ($respuestas as $res) {
        if ($res->correcta == "1") {
            $correctas++;
        } else {
            $incorrectas++;
        }
    }
    $nota_eval = (100 * $correctas) / count($respuestas);
    return ($nota_eval);
}*/ 
function PorcentajeCursos($id_nivel, $rut)
{
    //Obtengo el total de los cursos dado el nivel
    $total_cursos = CursosDadoNivel($id_nivel);
    $finalizado   = 0;
    foreach ($total_cursos as $cur) {
        $verifica = VErificaCursoFinalizado($cur->id, $rut);
        if ($verifica) {
            $finalizado++;
        }
    }
    return (($finalizado * 100) / count($total_cursos));
}
function TotalParticipantes()
{
    //Con el id de empresa y el id de Malla,
    $criterio       = CriterioMallaPorEmpresaMalla($_SESSION["id_empresa"], $_SESSION["malla"]);
    $total_personas = PersonasDadoCriterio($criterio[0]->campo, $criterio[0]->valor);
    return (count($total_personas));
}
function PorcentajeAvanceCurso($id_curso, $rut)
{
    //en el indice 4 del arreglo, se dejaran 4 estados, para saber si esta aprobado, reprobado, no iniciado o incompleto
    //1=Aprobado
    //2=Reprobado
    //3=Pendiente
    //4=Incompleto
    //INDICE 0 = ESTADO + PROMEDIO DE NOTA
    //INDICE 1 = PORCENTAJE DE AVANCE
    //INDICE 2 = DEDO PARA ARRIBA
    //INDICE 3 = NOTA CURSO
    //INDICE 4 = ESTADO
    //INDICE 5 = COLOR DE ESTADO
    //INDICE 6 = BACKGROUND
    //INDICE 7 = COLOR DEL TEXTO
    //Obtengo los objetos del curso
    $total_objetos             = count(ObjetosDadoCurso($id_curso, $rut));
    //Obtenho el total de los cursos finalizados
    $total_objetos_finalizados = count(ObjetosFinalizadosDadoCursoYRut($id_curso, $rut));
    //si tiene objetos, entro al siguiente IF
    if ($total_objetos > 0) {
        //Si están todos finalizados
        if ($total_objetos == $total_objetos_finalizados) {
            //Aca en vez de mostrar Completo, debo mostrar si está aprobado o reprobado.
            //Obtengo la nota del curso, en base a los objetos finalizados.
            $promedio_curso     = PromedioDeEvaluacionesDadoCursoYRut($id_curso, $rut);
            //en la siguiente funcion, paso como parametro la nota del curso, y devuelta me devuelve iconos, estados, colores, etc.
            $aprobado_reprobado = ApruebaReprueba($promedio_curso[0]->promedio_nota_curso);
            //En la siguiente arreglo[0], concateno el estado más la nota del curso
            $arreglo[0]         = $aprobado_reprobado[3] . " " . $promedio_curso[0]->promedio_nota_curso . "%";
            $arreglo[1]         = "100";
            //en la sigguiente, es para colocar el dedo arriba o no colocar dedo.
            if ($aprobado_reprobado[2] == "si") {
                $arreglo[2] = 'class="fa fa-thumbs-o-up text-success fontsize20"';
                $arreglo[4] = 1;
                $arreglo[5] = "#35d37d";
                $arreglo[6] = "etiquetaPrograma-aprobado";
                $arreglo[7] = "texto1-aprobado";
            } else if ($aprobado_reprobado[2] == "no") {
                $arreglo[4] = 2;
                $arreglo[5] = "#ec6f5a";
                $arreglo[6] = "etiquetaPrograma-reprobado";
                $arreglo[7] = "texto1-reprobado";
            } else {
                $arreglo[0] = '<span class="etiquetaAprobadoReprobado etiquetaAprobadoReprobado-aprobado">Finalizado</span>';
                $arreglo[5] = "#35d37d";
                $arreglo[6] = "etiquetaPrograma-aprobado";
                $arreglo[7] = "texto1-aprobado";
            }
            $arreglo[3] = $promedio_curso[0]->promedio_nota_curso;
        } else {
            $porcentaje_avance = number_format(((100 * $total_objetos_finalizados) / $total_objetos), 0);
            $promedio_curso    = PromedioDeEvaluacionesDadoCursoYRut($id_curso, $rut);
            $arreglo[3]        = $promedio_curso[0]->promedio_nota_curso;
            if ($porcentaje_avance == "0") {
                $arreglo[0] = '<span class="fa fa-circle text-pendiente fs14 mr10"></span><span class="etiquetaAprobadoReprobado etiquetaAprobadoReprobado-pendiente">Pendiente</span>';
                $arreglo[1] = $porcentaje_avance;
                $arreglo[4] = 3;
                $arreglo[5] = "#777777";
                $arreglo[6] = "etiquetaPrograma-pendiente";
                $arreglo[7] = "txto1-pendiente";
            } else {
                $arreglo[0] = '<span class="fa fa-circle text-warning fs14 mr10"></span><span class="etiquetaAprobadoReprobado etiquetaAprobadoReprobado-proceso">En Proceso</span>';
                $arreglo[1] = $porcentaje_avance;
                $arreglo[4] = 4;
                $arreglo[5] = "#f6bb42";
                $arreglo[6] = "etiquetaPrograma-proceso";
                $arreglo[7] = "texto1-proceso";
            }
        }
    } else {
        $arreglo[0] = "Pendiente";
        $arreglo[1] = "0";
        $arreglo[4] = 3;
        $arreglo[5] = "#777777";
        $arreglo[6] = "etiquetaPrograma-pendiente";
        $arreglo[7] = "txto1-pendiente";
    }
    return ($arreglo);
}
function BarraNavegacion($PRINCIPAL, $seccion)
{
    return ($PRINCIPAL);
}
function ColoresYRangos($valor)
{

}
function VerificaFinalizaCurso($id_curso, $rut)
{
    /*$objetos_dado_curso                 = count(ObjetosDadoCursoCruceNota($id_curso, $rut));
    $objetos_finalizados_dado_curso_rut = ObjetosFinalizadosDadoCursoYRut($id_curso, $rut);
    if ($objetos_dado_curso == count($objetos_finalizados_dado_curso_rut)) {
        //Inserto registro en tabla de curso Finalizado
        InsertaCursoFinalizado($id_curso, $rut);
        //Como aca ya se que todos los objetos están finalizados, calculo la nota de del curso, con las notas de los objetos.
        //Aca actualizo
    }*/
}
function ObtieneIdDadoIdObjeto($id_objeto)
{
    $arreglo[0]   = $id_objeto;
    $datos_objeto = DatosObjeto($arreglo[0]);
    $arreglo[1]   = $datos_objeto[0]->id_curso;
    //print_r($arreglo);
}
function EstadoObjeto($id_objeto, $rut)
{
    $estado_objeto = VerObjetoFinalizado($id_objeto, $rut);
    if ($estado_objeto) {
        $arreglo[0] = "completo.png";
        $arreglo[1] = "si";
    } else {
        $arreglo[0] = "pendiente.png";
        $arreglo[1] = "no";
    }
    return ($arreglo);
}
function MuestraContenido($PRINCIPAL, $id_objeto, $rut)
{
    $datos_usuario = UsuarioEnBasePersonas($rut);
    $PRINCIPAL     = str_replace("{NOMBRE_USUARIO}", utf8_encode($datos_usuario[0]->nombre_completo), $PRINCIPAL);
    //Traigo los datos del Objetos
    $datos_objeto  = DatosObjeto($id_objeto);
    if ($datos_objeto[0]->extension_objeto) {
        //CAMPOS PARA SESSIONS
        //Esto quiere decir que tiene algun tipo de extension el objeto
        $datos_extension = DatosExtensionDeObjeto($datos_objeto[0]->extension_objeto);
        $deviceipad      = strtolower($_SERVER[‘HTTP_USER_AGENT’]);
        $deviceipod      = strtolower($_SERVER[‘HTTP_USER_AGENT’]);
        //$datos_navegador=DetectaSistema();
        $datos_navegador = MobileDetectFunction();
        //Si es PC
        if ($datos_navegador[0] == 3) {
            //$template_objeto=file_get_contents($datos_extension[0]->template);
            $template_objeto = ($datos_extension[0]->template);
            //$template_objeto = str_replace("{URL_OBJETO_LINK}",$datos_objeto[0]->url_objeto,$template_objeto);
            $PRINCIPAL       = str_replace("{BLOQUE_OBJETO}", file_get_contents($template_objeto), $PRINCIPAL);
            //$PRINCIPAL = str_replace("{BLOQUE_OBJETO}",$template_objeto,$PRINCIPAL);
            $PRINCIPAL       = str_replace("{URL_OBJETO}", $datos_extension[0]->template, $PRINCIPAL);
            $PRINCIPAL       = str_replace("{BLOQUE_OBJETO}", $template_objeto, $PRINCIPAL);
            $PRINCIPAL       = str_replace("{NOMBRE_DOCUMENTO}", $datos_objeto[0]->url_objeto, $PRINCIPAL);
            $PRINCIPAL       = str_replace("{NOMBRE_VIDEO_MP4}", $datos_objeto[0]->url_objeto, $PRINCIPAL);
            $PRINCIPAL       = str_replace("{URL_OBJETO_LINK}", $datos_objeto[0]->url_objeto, $PRINCIPAL);
            $PRINCIPAL       = str_replace("{EXTENSION_OBJETO}", $datos_objeto[0]->duracion_video, $PRINCIPAL);
        }
        //Si es Tablet
        else if ($datos_navegador[0] == 1) {
            $template_objeto = file_get_contents($datos_extension[0]->template_android);
            $PRINCIPAL       = str_replace("{BLOQUE_OBJETO}", $template_objeto, $PRINCIPAL);
            $PRINCIPAL       = str_replace("{NOMBRE_DOCUMENTO}", $datos_objeto[0]->url_objeto, $PRINCIPAL);
            $PRINCIPAL       = str_replace("{NOMBRE_VIDEO_MP4}", $datos_objeto[0]->url_objeto, $PRINCIPAL);
            $PRINCIPAL       = str_replace("{URL_OBJETO_LINK}", $datos_objeto[0]->url_objeto, $PRINCIPAL);
            $PRINCIPAL       = str_replace("{EXTENSION_OBJETO}", $datos_objeto[0]->duracion_video, $PRINCIPAL);
        }
        //Si es Mobile
        else if ($datos_navegador[0] == 2) {
            if (strstr($_SERVER['HTTP_USER_AGENT'], 'iPhone') || strstr($_SERVER['HTTP_USER_AGENT'], 'iPod')) {
                $template_objeto = file_get_contents($datos_extension[0]->template_iphone);
            } else {
                $template_objeto = file_get_contents($datos_extension[0]->template_android);
            }
            $PRINCIPAL = str_replace("{BLOQUE_OBJETO}", $template_objeto, $PRINCIPAL);
            $PRINCIPAL = str_replace("{NOMBRE_DOCUMENTO}", $datos_objeto[0]->url_objeto, $PRINCIPAL);
            $PRINCIPAL = str_replace("{NOMBRE_VIDEO_MP4}", $datos_objeto[0]->url_objeto, $PRINCIPAL);
            $PRINCIPAL = str_replace("{URL_OBJETO_LINK}", $datos_objeto[0]->url_objeto, $PRINCIPAL);
            $PRINCIPAL = str_replace("{EXTENSION_OBJETO}", $datos_objeto[0]->duracion_video, $PRINCIPAL);
        }
        //PARA SESSIONS
        $PRINCIPAL = str_replace("{TITULO}", utf8_encode($datos_objeto[0]->titulo), $PRINCIPAL);
        $PRINCIPAL = str_replace("{TEXTO_BAJADA}", utf8_encode($datos_objeto[0]->texto_bajada), $PRINCIPAL);
        $PRINCIPAL = str_replace("{BAJADA}", utf8_encode($datos_objeto[0]->bajada), $PRINCIPAL);
        $PRINCIPAL = str_replace("{URL_VIDEO}", utf8_encode($datos_objeto[0]->video), $PRINCIPAL);
        $PRINCIPAL = str_replace("{TRANSCRIPCION}", utf8_encode($datos_objeto[0]->transcripcion), $PRINCIPAL);
        if ($datos_objeto[0]->rut_relator) {
            $PRINCIPAL = str_replace("{BLOQUE_RELATOR}", file_get_contents("views/cursos/contenidos/bloque_relator_con_link.html"), $PRINCIPAL);
            $PRINCIPAL = str_replace("{RUT_RELATOR_ENCODEADO}", Encodear3($datos_objeto[0]->rut_relator), $PRINCIPAL);
        } else {
            $PRINCIPAL = str_replace("{BLOQUE_RELATOR}", file_get_contents("views/cursos/contenidos/bloque_relator_sin_link.html"), $PRINCIPAL);
        }
        $PRINCIPAL = str_replace("{BIO_RELATOR}", utf8_encode($datos_objeto[0]->bio_relator), $PRINCIPAL);
        $PRINCIPAL = str_replace("{URL_IMAGEN_RELATOR}", utf8_encode($datos_objeto[0]->foto_relator), $PRINCIPAL);
        $PRINCIPAL = str_replace("{URL_MIPERFIL}", VerificaFotoPersonal($rut), $PRINCIPAL);
        //Bloque con textos
        $PRINCIPAL = str_replace("{RESUMEN_EJECUTIVO}", ColocaBloqueTextosPorObjeto($datos_objeto[0]->id), $PRINCIPAL);
        //Bloque con citas
        $PRINCIPAL = str_replace("{ENTORNO_CITA}", ColocaBloqueCitasPorObjeto($datos_objeto[0]->id), $PRINCIPAL);
        //BLOQUE MP3
        $PRINCIPAL = str_replace("{ENTORNO_DOCUMENTOS}", ColocaBloqueDocumentosPorObjeto($datos_objeto[0]->id), $PRINCIPAL);
        //Bloque para Documentos
        $PRINCIPAL = str_replace("{ENTORNO_MP3}", ColocaBloqueMP3PorObjeto($datos_objeto[0]->id), $PRINCIPAL);
        //Bloque para Pregunta
        $PRINCIPAL = str_replace("{ENTORNO_PREGUNTA}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 1), $PRINCIPAL);
        //Bloque para Pregunta
        //Bloque para Comentarios - Post
        //Bloque para Pregunta 2
        $PRINCIPAL = str_replace("{ENTORNO_PREGUNTA_2}", ColocaBloquePreguntaPorObjeto($datos_objeto[0]->id, $rut, 2), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BLOQUE_OBJETO}", file_get_contents("views/cursos/contenidos/bloque_iframe.html"), $PRINCIPAL);
        $PRINCIPAL = str_replace("{URL_OBJETO}", $datos_objeto[0]->url, $PRINCIPAL);
        $PRINCIPAL = str_replace("{EXTENSION_OBJETO}", $datos_objeto[0]->duracion_video, $PRINCIPAL);
    }
    //Dado la extension del objeto, traigo el template a utilizar por el tipo de objeto.
    $PRINCIPAL         = str_replace("{NOMBRE_OBJETO}", utf8_encode($datos_objeto[0]->titulo), $PRINCIPAL);
    $PRINCIPAL         = str_replace("{NUMERO_OBJETO}", ($datos_objeto[0]->orden), $PRINCIPAL);
    //Seccion del Cronometro
    $PRINCIPAL         = BarraNavegacion($PRINCIPAL, "contenido");
    $PRINCIPAL         = str_replace("{CRONOMETRO_PARA_CONTENIDOS}", file_get_contents("views/cursos/contenidos/cronometro.html"), $PRINCIPAL);
    //Verifico si esta finalizado o no este objetos
    $objeto_finalizado = VerObjetoFinalizado($id_objeto, $rut);
    if ($objeto_finalizado) {
        $PRINCIPAL = str_replace("{BOTON_VOLVER}", file_get_contents("views/cursos/contenidos/boton_volver_curso.html"), $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_CURSO_ENCODEADO_VOLVER}", Encodear3($datos_objeto[0]->id_curso), $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_OBJETO_ENCODEADO}", Encodear3($id_objeto), $PRINCIPAL);
        $PRINCIPAL = str_replace("{ENVBOTON}", "backcont", $PRINCIPAL);
        $PRINCIPAL = str_replace("{BOTON_FINALIZAR}", file_get_contents("views/cursos/contenidos/boton_siguiente_curso.html"), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BOTON_FINALIZAR}", file_get_contents("views/cursos/contenidos/boton_finaliza_curso.html"), $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_OBJETIVO_ENCODEADO}", Encodear3($id_objeto), $PRINCIPAL);
        $PRINCIPAL = str_replace("{ENVBOTON}", "fincont", $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_OBJETO_ENCODEADO}", Encodear3($id_objeto), $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_CURSO_ENCODEADO}", Encodear3($datos_objeto[0]->id_curso), $PRINCIPAL);
        $PRINCIPAL = str_replace("{BOTON_VOLVER}", file_get_contents("views/cursos/contenidos/boton_volver_curso.html"), $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_CURSO_ENCODEADO_VOLVER}", Encodear3($datos_objeto[0]->id_curso), $PRINCIPAL);
        $PRINCIPAL = str_replace("{ID_OBJETO_ENCODEADO}", Encodear3($id_objeto), $PRINCIPAL);
        $PRINCIPAL = str_replace("{ENVBOTON}", "backcont", $PRINCIPAL);
    }
    return ($PRINCIPAL);
}
function ListadoObjetos($PRINCIPAL, $id_curso, $rut, $tipo)
{
    $objetos                     = ObjetosDadoCurso($id_curso, $rut);
    $detalle_curso               = DetalleCursoConSumaNavegacionPorObjeto($id_curso);
    $datos_usuario_cruce_empresa = UsuarioEnBasePersonasCruceEmpresa2($rut);
    $PRINCIPAL                   = str_replace("{DESCRIPCION}", utf8_encode($detalle_curso[0]->descripcion), $PRINCIPAL);
    $PRINCIPAL                   = str_replace("{DESCRIPCION_CURSO}", utf8_encode($detalle_curso[0]->descripcion), $PRINCIPAL);
    $PRINCIPAL                   = str_replace("{FECHAS}", $detalle_curso[0]->fecha_inicio . " - " . $detalle_curso[0]->fecha_finalizacion, $PRINCIPAL);
    $PRINCIPAL                   = str_replace("{DESCRIPCION_CURSO}", utf8_encode($detalle_curso[0]->descripcion), $PRINCIPAL);
    $porcentaje_avance_curso     = PorcentajeAvanceCurso($id_curso, $rut);
    $PRINCIPAL                   = str_replace("{ETIQUETA_FONDO_ESTADO}", $porcentaje_avance_curso[6], $PRINCIPAL);
    $PRINCIPAL                   = str_replace("{COLOR_ESTADO}", $porcentaje_avance_curso[5], $PRINCIPAL);
    $PRINCIPAL                   = str_replace("{PORCENTAJE_AVANCE}", $porcentaje_avance_curso[1], $PRINCIPAL);
    $PRINCIPAL                   = str_replace("{COMPLETO_INCOMPLETO}", $porcentaje_avance_curso[0], $PRINCIPAL);
    $PRINCIPAL                   = str_replace("{METODOLOGIA}", utf8_encode($detalle_curso[0]->nombre_modalidad), $PRINCIPAL);
    $PRINCIPAL                   = str_replace("{BAJADA_CURSO}", utf8_encode($detalle_curso[0]->bajada), $PRINCIPAL);
    $PRINCIPAL                   = str_replace("{IMAGEN}", utf8_encode($detalle_curso[0]->imagen), $PRINCIPAL);
    if ($detalle_curso[0]->imagen) {
        $PRINCIPAL = str_replace("{BLOQUE_IMAGEN_CURSO}", file_get_contents("views/cursos/template_imagen_curso.html"), $PRINCIPAL);
        $PRINCIPAL = str_replace("{IMG_IMAGEN_CURSO}", "img/logos_cursos/" . $detalle_curso[0]->imagen, $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BLOQUE_IMAGEN_CURSO}", "", $PRINCIPAL);
        $PRINCIPAL = str_replace("{IMG_IMAGEN_CURSO}", "img/img_curso.jpg", $PRINCIPAL);
    }
    //con esta funcion, pasando el rut y el id del curso, me devuelve los minutos navegados
    $navegacion_por_curso = SumaNavegacionesDadoRutYCurso($rut, $id_curso);
    $PRINCIPAL            = str_replace("{MINUTOS_NAVEGADOS}", $navegacion_por_curso[0]->total_tiempo, $PRINCIPAL);
    $PRINCIPAL            = str_replace("{MINUTOS_TOTAL_POR_CURSO}", $detalle_curso[0]->suma_total_tiempo, $PRINCIPAL);
    $total_html           = "";
    if (count($objetos) == 0) {
        echo "
    <script>
    alert('Este curso no posee objetos asociados');
    location.href='?sw=" . $datos_usuario_cruce_empresa[0]->case_home . "';
    </script>";
        exit;
    }
    foreach ($objetos as $unico) {
        //Primero verifico si la anterior esta finalizada y todo esto solo si es mayor a 1
        if ($unico->orden > 1) {
            //Ahora verifico que la anterior esté finalizada, sino lo está, muestro el template de lectura
            //primero obtengo el anterior
            $objeto_anterior     = DatosObjetoDadoRutCursoyOrden($id_curso, $unico->orden - 1);
            //Ahora veo si el anterior esta finalizado, junto al rut del usuario
            $final_objt_anterior = ObjetoFinalizadoDadoIdYRut($rut, $objeto_anterior[0]->id);
            if ($final_objt_anterior) {
                $ve_si_esta_finalizada = VerObjetoFinalizado($unico->id, $rut);
                if ($ve_si_esta_finalizada) {
                    $fila = file_get_contents("views/cursos/row_objeto_finalizado.html");
                } else {
                    $fila = file_get_contents("views/cursos/row_objeto.html");
                }
            } else {
                $fila = file_get_contents("views/cursos/row_objeto_desactivado.html");
            }
        } else {
            $ve_si_esta_finalizada = VerObjetoFinalizado($unico->id, $rut);
            if ($ve_si_esta_finalizada) {
                $fila = file_get_contents("views/cursos/row_objeto_finalizado.html");
            } else {
                $fila = file_get_contents("views/cursos/row_objeto.html");
            }
        }
        if ($tipo == "sessions") {
            $fila = file_get_contents("views/cursos/row_objeto_sessions.html");
        }
        if ($unico->tipo_de_objeto == "3") {
            $fila = str_replace("{TIEMPOMODULO_O_NUM_PREGUNTAS}", $unico->duracion_video, $fila);
        } else if ($unico->tipo_de_objeto == "5") {
            $fila = str_replace("{TIEMPOMODULO_O_NUM_PREGUNTAS}", "<b>Cantidad Preguntas: " . $unico->total_preguntas_por_objeto . "</b>", $fila);
        }
        $fila   = str_replace("{TIEMPOMODULO_O_NUM_PREGUNTAS}", "", $fila);
        $fila   = str_replace("{NOMBRE_OBJETO}", $unico->titulo, $fila);
        $fila   = str_replace("{TIPO_OBJETO}", $unico->tipo_objeto, $fila);
        $fila   = str_replace("{CLASE_ICONO}", $unico->icono, $fila);
        $fila   = str_replace("{BAJADA1}", $unico->bajada, $fila);
        $fila   = str_replace("{BAJADA2}", $unico->texto_bajada, $fila);
        $fila   = str_replace("{IMAGEN_MODULO}", $unico->imagen, $fila);
        $fila   = str_replace("{IMAGEN_MODULO_DINAMICO}", $unico->imagen, $fila);
        $fila   = str_replace("{AMBIENTE}", $unico->ambiente, $fila);
        $fila   = str_replace("{ID_OBJETO_ENCODEADO}", Encodear3($unico->id), $fila);
        $estado = EstadoObjeto($unico->id, $rut);
        //Estados
        if ($estado[1] == "si") {
            $total_finalizados++;
        }
        $fila = str_replace("{ICONO_ESTADO}", $estado[0], $fila);
        if ($unico->total_tiempo) {
            $fila = str_replace("{TIEMPO_NAVEGACION}", "<i class='fa fa-clock-o'></i>&nbsp;" . $unico->total_tiempo, $fila);
        } else if ($unico->nota_objeto >= "0") {
            $aprobado_reprobado = ApruebaReprueba($unico->nota_objeto);
            $fila               = str_replace("{TIEMPO_NAVEGACION}", "<img width='20%' src='img/" . $aprobado_reprobado[1] . "'>
    <span ><br><b>Nota: " . number_format($unico->nota_objeto, 0) . "%</b></span>
    ", $fila);
        } else {
            $fila = str_replace("{TIEMPO_NAVEGACION}", "", $fila);
        }
        if ($unico->nota_objeto >= "0") {
            $total_notas++;
            $acum_notas = $acum_notas + $unico->nota_objeto;
        }
        $total_html .= $fila;
    }
    if ($total_notas > 0) {
        $PRINCIPAL = str_replace("{PROMEDIO_NOTAS_POR_CURSO}", number_format($acum_notas / $total_notas, 0), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{PROMEDIO_NOTAS_POR_CURSO}", "0", $PRINCIPAL);
    }
    $porcentaje_avance_curso = (100 * $total_finalizados) / count($objetos);
    $PRINCIPAL               = str_replace("{PORCENTAJE_AVANCE_CURSO}", number_format($porcentaje_avance_curso, 0), $PRINCIPAL);
    $PRINCIPAL               = str_replace("{LISTADO_OBJETOS}", utf8_encode($total_html), $PRINCIPAL);
    $detalle_curso           = DetalleCurso($id_curso);
    $PRINCIPAL               = str_replace("{NOMBRE_CURSO}", utf8_encode($detalle_curso[0]->nombre), $PRINCIPAL);
    $PRINCIPAL               = str_replace("{CANTIDAD_OBJETOS}", count($objetos), $PRINCIPAL);
    //Total NAvegacion por Curso.
    $navegacion_por_curso    = SumaNavegacionesDadoRutYCurso($rut, $id_curso);
    $PRINCIPAL               = str_replace("{TOTAL_NAVEGACION_CURSO}", $navegacion_por_curso[0]->total_tiempo, $PRINCIPAL);
    return ($PRINCIPAL);
}
function ListadoObjetosCapacitacion($PRINCIPAL, $id_curso, $rut, $tipo, $id_inscripcion, $id_empresa, $id_template, $back_home, $im, $id_programa, $id_nivel, $vista, $id_inscripcion_usuario, $dia, $solo_video)
{
    //echo "function ListadoObjetosCapacitacion $id_curso, $rut, $tipo, $id_inscripcion";

    if ($vista == "") {
        //busca orden den curso
        $arr_curso = DatosCursoTodos($id_curso);
        if ($arr_curso[0]->numero_identificador == "ORDENPORESTADO") {
            $vista = 2; //vista 2 por estado
        } else {
            $vista = 1;
        }
    }
    //PARAMETROS_AUTOEVAL_SGD
    $objetos          = ObjetosDadoCursoOrden($id_curso, $rut, $vista, $dia);
    $detalle_curso    = DetalleCursoConSumaNavegacionPorObjeto($id_curso);
    $estado_por_curso = CAPACITACION_ObtenerEstadoAvanceCurso($rut, $id_curso, "", $id_empresa);
    $avances          = ColocaAvanceCursoPorPuntosDeObjetos($PRINCIPAL, $id_curso, $rut, $id_empresa);
    $PRINCIPAL        = $avances[0];
    if ($id_template <> '') {
        $template = "_" . $id_template;
    } else {
        $template = "";
    }
    if ($id_inscripcion) {
    } else {
        //Verifico si tiene registro o no  tiene registro en la tabla inscripcion_cierre
        $tiene_cierre_curso = TieneInscripcionCierreDadoRutYCursoEmpresa($rut, $id_curso, $id_empresa);
        if (!$tiene_cierre_curso) {
            InsertarInsripcionCierre($rut, $id_curso, $id_empresa);
        }
    }
    //Estado de Curso, dado la tabla inscripcion cierre
    $estado_curso                = CAPACITACION_ObtenerEstadoAvanceCurso($rut, $id_curso, $id_inscripcion, $id_empresa);
    
    
	if($id_curso=="bch_codcon") {
			$template="_2019";
  }
    
    
    $PRINCIPAL                   = str_replace("{ID_CURSO_ENCODEADO}", Encodear3($id_curso), $PRINCIPAL);
    $PRINCIPAL                   = str_replace("{ESTADO_CURSO}", $estado_por_curso[0], $PRINCIPAL);
    $PRINCIPAL                   = str_replace("{PORCENTAJE_AVANCE_CURSO_2}", $estado_por_curso[4], $PRINCIPAL);
    $PRINCIPAL                   = str_replace("{ESTADO_DE_CURSO}", $estado_por_curso[0], $PRINCIPAL);
    $PRINCIPAL                   = str_replace("{PORCENTAJE_AVANCE_CURSO}", $estado_curso[4], $PRINCIPAL);
    $PRINCIPAL                   = str_replace("{TIEMPO_NAVEGADO_POR_CURSO}", $estado_curso[5], $PRINCIPAL);
    $datos_usuario_cruce_empresa = UsuarioEnBasePersonasCruceEmpresa2($rut);
    $PRINCIPAL                   = str_replace("{DESCRIPCION}", utf8_encode($detalle_curso[0]->descripcion), $PRINCIPAL);
    $PRINCIPAL                   = str_replace("{textodescripcion}", utf8_encode($detalle_curso[0]->descripcion), $PRINCIPAL);
    $PRINCIPAL                   = str_replace("{DESCRIPCION_CURSO}", utf8_encode($detalle_curso[0]->descripcion), $PRINCIPAL);
    $PRINCIPAL                   = str_replace("{DESCRIPTOR_CURSO}", utf8_encode($detalle_curso[0]->descriptor), $PRINCIPAL);
    $PRINCIPAL                   = str_replace("{FECHAS}", $detalle_curso[0]->fecha_inicio . " - " . $detalle_curso[0]->fecha_finalizacion, $PRINCIPAL);
    $PRINCIPAL                   = str_replace("{DESCRIPCION_CURSO}", utf8_encode($detalle_curso[0]->descripcion), $PRINCIPAL);
    $porcentaje_avance_curso     = PorcentajeAvanceCurso($id_curso, $rut);
    $PRINCIPAL                   = str_replace("{ETIQUETA_FONDO_ESTADO}", $porcentaje_avance_curso[6], $PRINCIPAL);
    $PRINCIPAL                   = str_replace("{COLOR_ESTADO}", $porcentaje_avance_curso[5], $PRINCIPAL);
    $PRINCIPAL                   = str_replace("{PORCENTAJE_AVANCE}", $porcentaje_avance_curso[1], $PRINCIPAL);
    $PRINCIPAL                   = str_replace("{COMPLETO_INCOMPLETO}", $porcentaje_avance_curso[0], $PRINCIPAL);
    $PRINCIPAL                   = str_replace("{METODOLOGIA}", utf8_encode($detalle_curso[0]->nombre_modalidad), $PRINCIPAL);
    $PRINCIPAL                   = str_replace("{BAJADA_CURSO}", utf8_encode($detalle_curso[0]->bajada), $PRINCIPAL);
    $PRINCIPAL                   = str_replace("{IMAGEN}", utf8_encode($detalle_curso[0]->imagen), $PRINCIPAL);
    $PRINCIPAL                   = str_replace("{IMAGEN_BACK}", utf8_encode($detalle_curso[0]->imagen_back), $PRINCIPAL);
    $PRINCIPAL                   = str_replace("{NOMBRE_CURSO}", utf8_encode($detalle_curso[0]->nombre), $PRINCIPAL);
    //echo $detalle_curso[0]->imagen;
    if ($detalle_curso[0]->imagen) {
        $PRINCIPAL = str_replace("{BLOQUE_IMAGEN_CURSO}", file_get_contents("views/cursos/template_imagen_curso.html"), $PRINCIPAL);
        $PRINCIPAL = str_replace("{IMG_IMAGEN_CURSO}", "img/logos_cursos/" . $detalle_curso[0]->imagen, $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{BLOQUE_IMAGEN_CURSO}", "", $PRINCIPAL);
        $PRINCIPAL = str_replace("{IMG_IMAGEN_CURSO}", "img/img_curso.jpg", $PRINCIPAL);
    }
    //con esta funcion, pasando el rut y el id del curso, me devuelve los minutos navegados
    $navegacion_por_curso = SumaNavegacionesDadoRutYCurso($rut, $id_curso);
    $PRINCIPAL            = str_replace("{MINUTOS_NAVEGADOS}", $navegacion_por_curso[0]->total_tiempo, $PRINCIPAL);
    $PRINCIPAL            = str_replace("{MINUTOS_TOTAL_POR_CURSO}", $detalle_curso[0]->suma_total_tiempo, $PRINCIPAL);
    $total_html           = "";
    $total_htmlya         = "";
    $total_htmlno         = "";
    if (count($objetos) == 0) {
        echo "<script>alert('Este curso no posee objetos asociados');location.href='?sw=" . $datos_usuario_cruce_empresa[0]->case_home . "';</script>";
        exit;
    }
    
    
    foreach ($objetos as $unico) {



    //echo "<br>pasa por todo la rel $id_curso $id_inscripcion $rut ".$unico->id;

    $arr=BuscaRelIdInscripcionCursoObjeto($id_curso, $id_inscripcion, $unico->id);
    //print_r($arr);

     if($arr[0]->fecha_inicio<>''){         $unico->fecha_inicio=$arr[0]->fecha_inicio;}
     if($arr[0]->fecha_termino<>''){     $unico->fecha_termino=$arr[0]->fecha_termino;}
     if($arr[0]->hora_inicio<>''){     $unico->hora_inicio=$arr[0]->hora_inicio;}
     if($arr[0]->hora_termino<>''){     $unico->hora_termino=$arr[0]->hora_termino;}

        if ($unico->fecha_inicio <> '' OR $unico->fecha_termino <> '' OR $unico->hora_inicio <> '' OR $unico->hora_termino <> '') {
            $fecha_actual = date("Y-m-d");
            $hora_actual  = date("H:i:s");
            if ($unico->fecha_inicio == "") {
                $unico->fecha_inicio = "1900-01-01";
            }
            if ($unico->fecha_termino == "") {
                $unico->fecha_termino = "2200-01-01";
            }
            if ($unico->hora_inicio == "") {
                $unico->hora_inicio = "00:01";
            }
            if ($unico->hora_termino == "") {
                $unico->hora_termino = "23:59";
            }

            $mensaje_objeto = "";
            $accede_modulo  = 0;
            if ($fecha_actual < $unico->fecha_inicio) {
										$mensaje_objeto .= "El modulo se encuentra desactivado. La fecha de aplicaci&oacute;n es el " . $unico->fecha_inicio." y el horario de activaci&oacute;n es entre las ".$unico->hora_inicio." y ".$unico->termino."";
                		$accede_modulo = 1;
            } else if ($fecha_actual > $unico->fecha_termino) {
											$mensaje_objeto .= "El modulo se encuentra desactivado. La fecha de aplicaci&oacute;n es el " . $unico->fecha_inicio." y el horario de activaci&oacute;n es entre las ".$unico->hora_inicio." y ".$unico->termino."";                $accede_modulo = 1;
            } else if ($fecha_actual >= $unico->fecha_inicio && $fecha_actual <= $unico->fecha_termino) {
                if ($fecha_actual == $unico->fecha_inicio and $fecha_actual <> $unico->fecha_termino) {
                    //    echo "es hoy inicio";
                    if ($hora_actual < $unico->hora_inicio) {
											$mensaje_objeto .= "El modulo se encuentra desactivado. La fecha de aplicaci&oacute;n es el " . $unico->fecha_inicio." y el horario de activaci&oacute;n es entre las ".$unico->hora_inicio." y ".$unico->termino."";                        $accede_modulo = 1;
                    }
                } elseif ($fecha_actual == $unico->fecha_termino and $fecha_actual <> $unico->fecha_inicio) {
                    if ($hora_actual > $unico->hora_termino) {
											$mensaje_objeto .= "El modulo se encuentra desactivado. La fecha de aplicaci&oacute;n es el " . $unico->fecha_inicio." y el horario de activaci&oacute;n es entre las ".$unico->hora_inicio." y ".$unico->termino."";                        $accede_modulo = 1;
                    }
                } elseif ($fecha_actual == $unico->fecha_termino and $fecha_actual == $unico->fecha_inicio) {
                        //echo "es hoy termino e iniciohora ahora es ".$hora_actual." hora termino ".$unico->hora_termino." hora inicio".$unico->hora_inicio;
                    if ($hora_actual < $unico->hora_inicio) {
											$mensaje_objeto .= "El modulo se encuentra desactivado. La fecha de aplicaci&oacute;n es el " . $unico->fecha_inicio." y el horario de activaci&oacute;n es entre las ".$unico->hora_inicio." y ".$unico->termino."";                        $accede_modulo = 1;
                    }
                    if ($hora_actual > $unico->hora_termino) {
											$mensaje_objeto .= "El modulo se encuentra desactivado. La fecha de aplicaci&oacute;n es el " . $unico->fecha_inicio." y el horario de activaci&oacute;n es entre las ".$unico->hora_inicio." y ".$unico->termino."";                        $accede_modulo = 1;
                    }

                } else {
                    //$mensaje_objeto .= "<br> El Modulo Activo";
                    $accede_modulo = 0;
                }
            }
        }



        //echo $mensaje_objeto;
        //Primero verifico si la anterior esta finalizada y todo esto solo si es mayor a 1
        if ($unico->orden > 1) {
            //Ahora verifico que la anterior esté finalizada, sino lo está, muestro el template de lectura
            //primero obtengo el anterior
            $objeto_anterior     = DatosObjetoDadoRutCursoyOrden($id_curso, $unico->orden - 1);
            //Ahora veo si el anterior esta finalizado, junto al rut del usuario
            $final_objt_anterior = ObjetoFinalizadoDadoIdYRut($rut, $objeto_anterior[0]->id);
            //Si el objeto anterior esta finalizado
            if ($final_objt_anterior) {
                $ve_si_esta_finalizada = VerObjetoFinalizado($unico->id, $rut);
                if ($ve_si_esta_finalizada) {
                    if ($unico->idmoodleNO) {
                        //$fila=file_get_contents("views/c ursos/".$id_empresa."_row_objeto_finalizado_moodle".$template.".html");
                    } else {
                        $tiene_accion_pendiente = TieneAccionesPEndientes($rut, $id_empresa, $unico->id_curso, $unico->id);
                        if ($tiene_accion_pendiente) {
                            if ($tiene_accion_pendiente[0]->estado == 2) {
                                $fila           = file_get_contents("views/cursos/" . $id_empresa . "_row_objeto_finalizado_reprobado" . $template .$solo_video. ".html");
                                $img_transicion = $id_empresa . "_obj_reprobado.jpg";
                            } else if ($tiene_accion_pendiente[0]->estado === "0") {
                                //echo $unico->id;
                                $fila           = file_get_contents("views/cursos/" . $id_empresa . "_row_objeto_en_proceso" . $template .$solo_video. ".html");
                                $img_transicion = $id_empresa . "_obj_en_proceso.jpg";
                            } else if ($tiene_accion_pendiente[0]->estado == 1) {
                                $fila           = file_get_contents("views/cursos/" . $id_empresa . "_row_objeto_finalizado" . $template .$solo_video. ".html");
                                $img_transicion = $id_empresa . "_obj_finalizado.jpg";
                            }
                        } else {
                            $fila           = file_get_contents("views/cursos/" . $id_empresa . "_row_objeto_finalizado" . $template .$solo_video. ".html");
                            $img_transicion = $id_empresa . "_obj_finalizado.jpg";
                        }
                    }
                } else {
                    if ($unico->idmoodleNO) {
                        $fila                             = file_get_contents("views/cursos/" . $id_empresa . "_row_objeto_moodle" . $template .$solo_video. ".html");
                        $datos_del_curso_en_moodle        = ObtenerDatosMoodle($arreglo_datos_curso, $HTML, $bloque, $unico->id_scorm);
                        $porcentaje_Avance_de_Este_modulo = $datos_del_curso_en_moodle[0];
                        if ($porcentaje_Avance_de_Este_modulo == "100") {
                            //IngresoObjetoFinalizado($rut, $unico->id, $tiempo_navegado, "", "", $unico->id_curso);
                            //VerificaFinalizaCurso($unico->id_curso, $rut);
                            //CAPACITACIONActualizarDatosCierre($unico->id_curso, $rut, $id_empresa, $navegacion_por_curso[0]->total_tiempo);
                        }
                    } else {
                        //Aca Veo si este objeto esta en la tabla tbl_lms_acciones_pendientes con estado 0, para este objeto, para este cuso y para esta empresa.
                        //Si es asi, muestro el estado amarillo
                        //si no el desactivado
                        $tiene_accion_pendiente = TieneAccionesPEndientes($rut, $id_empresa, $unico->id_curso, $unico->id);
                        if ($tiene_accion_pendiente) {
                            if ($tiene_accion_pendiente[0]->estado == 0) {
                                $fila = file_get_contents("views/cursos/" . $id_empresa . "_row_objeto_en_proceso" . $template .$solo_video. ".html");
                            } else {
                                $fila = file_get_contents("views/cursos/" . $id_empresa . "_row_objeto" . $template .$solo_video. ".html");
                            }
                        } else {
                            //Voy a verificar si para este rut, empresa curso y objeto, esta en la tabla de tareas
                            //$fila=file_get_contents("views/cursos/".$id_empresa."_row_objeto.html");
                            $objeto_finalizado_pero_pendiente = VerificaObjetoNoFinalizadoPendiente($rut, $id_empresa, $unico->id_curso, $unico->id);
                            if ($objeto_finalizado_pero_pendiente) {
                                $fila = file_get_contents("views/cursos/" . $id_empresa . "_row_objeto_finalizado_pendiente" . $template .$solo_video. ".html");
                            } else {
                                $fila = file_get_contents("views/cursos/" . $id_empresa . "_row_objeto" . $template .$solo_video. ".html");
                                $fila = str_replace("{PARAMETROS_AUTOEVAL_SGD}", "ie=" . Encodear3($rut) . "&ip=" . Encodear3(120) . "&ae=1", $fila);
                            }
                        }
                    }
                }
            } else {
                $ve_si_esta_finalizada = VerObjetoFinalizado($unico->id, $rut);
                
               // echo "<br>id objeto ".$unico->id." rut  $rut".$ve_si_esta_finalizada;
                //print_r($ve_si_esta_finalizada);
                
                
                if ($ve_si_esta_finalizada) {
                    $fila = file_get_contents("views/cursos/" . $id_empresa . "_row_objeto_finalizado" . $template .$solo_video. ".html");
                } else {
                	// echo "<br>id objeto ".$unico->id." rut  $rut ".$ve_si_esta_finalizada;
                	//echo "no finalizado";
                    $objeto_anterior                           = DatosObjetoDadoRutCursoyOrden($id_curso, $unico->orden - 1);
                    $id_objeto_anterior                        = $objeto_anterior[0]->id;
                    $objeto_anterior_finalizado_pero_pendiente = VerificaObjetoNoFinalizadoPendiente($rut, $id_empresa, $objeto_anterior[0]->id_curso, $objeto_anterior[0]->id);
                    if ($objeto_anterior_finalizado_pero_pendiente) {
                        $fila = file_get_contents("views/cursos/" . $id_empresa . "_row_objeto" . $template .$solo_video. ".html");
                        
                        //echo "<br>BBB";
                    } else {
                        if ($unico->cm == "SIEMPREACTIVO") {
                            $fila = file_get_contents("views/cursos/" . $id_empresa . "_row_objeto" . $template .$solo_video. ".html");
                           // echo "DESCACTIVO pero activo";
                        } else {
                            $fila = file_get_contents("views/cursos/" . $id_empresa . "_row_objeto_desactivado" . $template .$solo_video. ".html");
                            // echo "DESCACTIVO";
                            //echo "<br>".$unico->id." template views/cursos/" . $id_empresa . "_row_objeto_desactivado" . $template .$solo_video. "";
                        }
                    }
                    //Ahora veo si el anterior esta finalizado, junto al rut del usuario
                    //$final_objt_anterior=ObjetoFinalizadoDadoIdYRut($rut, $objeto_anterior[0]->id);
                }
            }
            if ($unico->extension_objeto == "zip") {
                $fila = file_get_contents("views/cursos/" . $id_empresa . "_row_objeto_zip" . $template .$solo_video. ".html");
            }
        } else {
            $ve_si_esta_finalizada = VerObjetoFinalizado($unico->id, $rut);
            if ($ve_si_esta_finalizada) {
                //echo $unico->id;
                $tiene_accion_pendiente = TieneAccionesPEndientes($rut, $id_empresa, $unico->id_curso, $unico->id);
                if ($tiene_accion_pendiente) {
                    //if($tiene_accion_pendiente[0]->estado==0){
                    if ($tiene_accion_pendiente[0]->estado == 1) {
                        //echo "aa<br>";
                        //$fila=file_get_contents("views/cursos/".$id_empresa."_row_objeto_en_proceso".$template.".html");
                        $fila = file_get_contents("views/cursos/" . $id_empresa . "_row_objeto_finalizado" . $template .$solo_video. ".html");
                    } else if ($tiene_accion_pendiente[0]->estado === "0") {
                        //echo "bb<br>";
                        $fila = file_get_contents("views/cursos/" . $id_empresa . "_row_objeto_en_proceso" . $template .$solo_video. ".html");
                    } else {
                        //echo "cc<br>";
                        $fila = file_get_contents("views/cursos/" . $id_empresa . "_row_objeto" . $template .$solo_video. ".html");
                    }
                } else {
                    //echo "dd<br>";
                    $fila = file_get_contents("views/cursos/" . $id_empresa . "_row_objeto_finalizado" . $template .$solo_video. ".html");
                }
            } else {
                if ($unico->idmoodleNO) {
                    $fila                             = file_get_contents("views/cursos/" . $id_empresa . "_row_objeto_moodle" . $template .$solo_video. ".html");
                    $datos_del_curso_en_moodle        = ObtenerDatosMoodle($arreglo_datos_curso, $HTML, $bloque, $unico->id_scorm);
                    $porcentaje_Avance_de_Este_modulo = $datos_del_curso_en_moodle[0];
                    if ($porcentaje_Avance_de_Este_modulo == "100") {
                        //IngresoObjetoFinalizado($rut, $unico->id, $tiempo_navegado, "", "", $unico->id_curso);
                        //VerificaFinalizaCurso($unico->id_curso, $rut);
                        //CAPACITACIONActualizarDatosCierre($unico->id_curso, $rut, $id_empresa, $navegacion_por_curso[0]->total_tiempo);
                    }
                } else {
                    //si está en la tabla de tbl_objetos_no_finalizados, coloco row similar al de finalizado
                    $objeto_finalizado_pero_pendiente = VerificaObjetoNoFinalizadoPendiente($rut, $id_empresa, $unico->id_curso, $unico->id);
                    if ($objeto_finalizado_pero_pendiente) {
                        $fila = file_get_contents("views/cursos/" . $id_empresa . "_row_objeto_finalizado_pendiente" . $template .$solo_video. ".html");
                    } else {
                        $fila = file_get_contents("views/cursos/" . $id_empresa . "_row_objeto" . $template .$solo_video. ".html");
                    }
                }
            }
            if ($unico->extension_objeto == "zip") {
                $fila = file_get_contents("views/cursos/" . $id_empresa . "_row_objeto_zip" . $template .$solo_video. ".html");
            }
        }
        if($unico->tipo_de_objeto==3){
            $fila = str_replace("{ICONO_BP}", file_get_contents("views/cursos/" . $id_empresa . "_icono_bp_video.html"), $fila);
        }else if($unico->tipo_de_objeto==5){
            $fila = str_replace("{ICONO_BP}", file_get_contents("views/cursos/" . $id_empresa . "_icono_bp_trivia.html"), $fila);
        }
        $fila = str_replace("{URL_OBJETO_DIRECTO}", $unico->url_objeto, $fila);
        if (($unico->opcional == 1 or $unico->opcional == 2) and $unico->extension_objeto <> 25) {
            $fila = file_get_contents("views/cursos/" . $id_empresa . "_row_objeto" . $template .$solo_video. ".html");
        }
        if ($accede_modulo == 1) {
            $fila = file_get_contents("views/cursos/" . $id_empresa . "_row_objeto_desactivado" . $template .$solo_video. ".html");
        }
        $fila = str_replace("{MENSAJE_ACTIVACION_TIEMPO}", $mensaje_objeto, $fila);
        if ($unico->tipo_de_objeto == "3") {
            $fila = str_replace("{TIEMPOMODULO_O_NUM_PREGUNTAS}", $unico->duracion_video, $fila);
        } else if ($unico->tipo_de_objeto == "5") {
            $fila = str_replace("{TIEMPOMODULO_O_NUM_PREGUNTAS}", "<b>Cantidad Preguntas: " . $unico->total_preguntas_por_objeto . "</b>", $fila);
        }
        $fila = str_replace("{TIEMPOMODULO_O_NUM_PREGUNTAS}", "", $fila);
        $fila = str_replace("{NOMBRE_OBJETO}", $unico->titulo, $fila);
        $fila = str_replace("{TIPO_OBJETO}", $unico->tipo_objeto, $fila);
        $fila = str_replace("{CLASE_ICONO}", $unico->icono, $fila);
        $fila = str_replace("{BAJADA1}", $unico->bajada, $fila);
        $fila = str_replace("{BAJADA2}", $unico->texto_bajada, $fila);
        $fila = str_replace("{TEXTO_BAJADA}", $unico->texto_bajada, $fila);
        if ($unico->imagen == "") {
            $unico->imagen = "bci_icon_cont.png";
        } else {
            $unico->imagen = $unico->imagen;
        }

        if($id_inscripcion){
            $fila   = str_replace("{PARAMETROS_AUTOEVAL_SGD}", "&ii=".Encodear3($id_inscripcion)."", $fila);
        }else{
            $fila   = str_replace("{PARAMETROS_AUTOEVAL_SGD}", "", $fila);
        }

        $fila   = str_replace("{IMAGEN_MODULO}", "img/" . $unico->imagen, $fila);
        $fila   = str_replace("{IMAGEN_MODULO_ACTIVO}", "img/" . $unico->imagen . "_activo.png", $fila);
        $fila   = str_replace("{IMAGEN_MODULO_PASIVO}", "img/" . $unico->imagen . "_desactivo.png", $fila);
        $fila   = str_replace("{IMAGEN_MODULO_VISTO}", "img/" . $unico->imagen . "_visto.png", $fila);
        $fila   = str_replace("{IMAGEN_TRANSICION_FINALIZADO}", "img/" . $id_empresa . "_obj_finalizado.jpg", $fila);
        $fila   = str_replace("{IMAGEN_TRANSICION_EN_PROCESO}", "img/" . $id_empresa . "_obj_en_proceso.jpg", $fila);
        $fila   = str_replace("{IMAGEN_TRANSICION_NO_INICIADO}", "img/" . $id_empresa . "_obj_no_iniciado.jpg", $fila);
        $fila   = str_replace("{IMAGEN_MODULO_DINAMICO}", "" . $unico->imagen, $fila);
        $fila   = str_replace("{IMAGEN_TEXTOMODULO}", $unico->imagentexto, $fila);
        $fila   = str_replace("{PORC_AVANC}", $porcentaje_Avance_de_Este_modulo . "%", $fila);
        $fila   = str_replace("{AMBIENTE}", $unico->ambiente, $fila);
        $fila   = str_replace("{ID_OBJETO_ENCODEADO}", Encodear3($unico->id), $fila);
        $fila   = str_replace("{ID_OBJETO}", ($unico->id), $fila);
        $fila   = str_replace("{RUT_MOODLE}", $rut, $fila);
        $fila   = str_replace("{PASS_MOODLE}", "Gop.123456", $fila);
        $fila   = str_replace("{ID_MOODLE}", $unico->idmoodle, $fila);
        $fila   = str_replace("{CURRENTORG}", $unico->currentorg, $fila);
        $fila   = str_replace("{SCOID}", $unico->scoid, $fila);
        $fila   = str_replace("{CM}", $unico->cm, $fila);
        $fila   = str_replace("{ACTION}", $unico->urlmoodle, $fila);
        $estado = EstadoObjeto($unico->id, $rut);
        //Estados
        if ($estado[1] == "si") {
            $total_finalizados++;
        }
        $fila = str_replace("{ICONO_ESTADO}", $estado[0], $fila);
        if ($unico->total_tiempo) {
            $fila = str_replace("{TIEMPO_NAVEGACION}", "<i class='fa fa-clock-o'></i>&nbsp;" . $unico->total_tiempo, $fila);
        } else if ($unico->nota_objeto >= "0") {
            $aprobado_reprobado = ApruebaReprueba($unico->nota_objeto);
            $fila               = str_replace("{TIEMPO_NAVEGACION}", "<img width='20%' src='img/" . $aprobado_reprobado[1] . "'>
    				<span ><br><b>Nota: " . number_format($unico->nota_objeto, 0) . "%</b></span>
    				", $fila);
        } else {
            $fila = str_replace("{TIEMPO_NAVEGACION}", "", $fila);
        }
        if ($unico->nota_objeto >= "0") {
            $total_notas++;
            $acum_notas = $acum_notas + $unico->nota_objeto;
        }
        $total_html .= $fila;
        $total_htmlyatitulo = "";
        if ($unico->cm == "yarealizados") {
            $total_htmlya .= $fila;
            $total_htmlyatitulo = "<BR><SMALL><SPAN class='blanco'>Cursos ya realizados</SPAN></SMALL><br>    <div class='panel panel-default paper-shadow' data-z='0.5'>
    				<div class='panel-body'>";
        }
        if ($unico->cm <> "yarealizados") {
            $total_htmlno .= $fila;
        }
    }
    if ($total_notas > 0) {
        $PRINCIPAL = str_replace("{PROMEDIO_NOTAS_POR_CURSO}", number_format($acum_notas / $total_notas, 0), $PRINCIPAL);
    } else {
        $PRINCIPAL = str_replace("{PROMEDIO_NOTAS_POR_CURSO}", "0", $PRINCIPAL);
    }
    $porcentaje_avance_curso = (100 * $total_finalizados) / count($objetos);
    $PRINCIPAL               = str_replace("{PORCENTAJE_AVANCE_CURSO}", number_format($porcentaje_avance_curso, 0), $PRINCIPAL);
    $PRINCIPAL               = str_replace("{LISTADO_OBJETOS_NO_REALIZADOS}", utf8_encode($total_htmlno), $PRINCIPAL);
    $PRINCIPAL               = str_replace("{TITULO_OBJETOS_YA_REALIZADOS}", utf8_encode($total_htmlyatitulo), $PRINCIPAL);
    $PRINCIPAL               = str_replace("{LISTADO_OBJETOS_YA_REALIZADOS}", utf8_encode($total_htmlya), $PRINCIPAL);
    $PRINCIPAL               = str_replace("{LISTADO_OBJETOS".$dia."}", utf8_encode($total_html), $PRINCIPAL);
    $detalle_curso           = DetalleCurso($id_curso);
    $PRINCIPAL               = str_replace("{NOMBRE_CURSO}", utf8_encode($detalle_curso[0]->nombre), $PRINCIPAL);
    $PRINCIPAL               = str_replace("{CANTIDAD_OBJETOS}", count($objetos), $PRINCIPAL);
    //Total NAvegacion por Curso.
    $navegacion_por_curso    = SumaNavegacionesDadoRutYCurso($rut, $id_curso);
    $PRINCIPAL               = str_replace("{TOTAL_NAVEGACION_CURSO}", $navegacion_por_curso[0]->total_tiempo, $PRINCIPAL);
    return ($PRINCIPAL);
}
function my_simple_crypt_decodear($string)
{
    // you may change these values to your own
    $secret_key     = getenv('SECRET_KEY1');
    $secret_iv      = getenv('SECRET_IV1');
    $output         = false;
    $encrypt_method = "AES-256-CBC";
    $key            = hash('sha256', $secret_key);
    $iv             = substr(hash('sha256', $secret_iv), 0, 16);
    $output         = openssl_decrypt(base64_decode($string), $encrypt_method, $key, 0, $iv);
    return $output;
}
function my_simple_crypt_encodear($string)
{
    // you may change these values to your own
    $secret_key     = getenv('SECRET_KEY1');
    $secret_iv      = getenv('SECRET_IV1');
    $output         = false;
    $encrypt_method = "AES-256-CBC";
    $key            = hash('sha256', $secret_key);
    $iv             = substr(hash('sha256', $secret_iv), 0, 16);
    $output         = base64_encode(openssl_encrypt($string, $encrypt_method, $key, 0, $iv));
    return $output;
}
function Encodear3($valor)
{
    //$valor=Encodear(Encodear(Encodear($valor)));
    $valor = my_simple_crypt_encodear($valor, 'e');
    return ($valor);
}
function my_simple_crypt_decodear4($string)
{
    // you may change these values to your own
    $secret_key     = getenv('SECRET_KEY4');
    $secret_iv      = getenv('SECRET_IV4');
    $output         = false;
    $encrypt_method = "AES-256-CBC";
    $key            = hash('sha256', $secret_key);
    $iv             = substr(hash('sha256', $secret_iv), 0, 16);
    $output         = openssl_decrypt(base64_decode($string), $encrypt_method, $key, 0, $iv);
    return $output;
}
function my_simple_crypt_encodear4($string)
{
    // you may change these values to your own
    $secret_key     = getenv('SECRET_KEY4');
    $secret_iv      = getenv('SECRET_IV4');
    $output         = false;
    $encrypt_method = "AES-256-CBC";
    $key            = hash('sha256', $secret_key);
    $iv             = substr(hash('sha256', $secret_iv), 0, 16);
    $output         = base64_encode(openssl_encrypt($string, $encrypt_method, $key, 0, $iv));
    return $output;
}
function Encodear4($valor)
{
    //$valor=Encodear(Encodear(Encodear($valor)));
    $valor = my_simple_crypt_encodear4($valor, 'e');
    return ($valor);
}
function Decodear4($valor)
{
    //$valor=Decodear(Decodear(Decodear($valor)));
    //print_r($valor);
    $valor = my_simple_crypt_decodear4($valor, 'd');
    $valor      = VerificaArregloSQLInjectionDecodear($valor);

    return ($valor);
}
function Decodear3($valor)
{
    //$valor=Decodear(Decodear(Decodear($valor)));
    //print_r($valor);
    $valor = my_simple_crypt_decodear($valor, 'd');
    $valor      = VerificaArregloSQLInjectionDecodear($valor);
    return ($valor);
}
function Decodear5($valor)
{
    //$valor=Decodear(Decodear(Decodear($valor)));
    //print_r($valor);
    $valor = my_simple_crypt_decodear5($valor, 'd');
    //echo $valor;
    
    if($_SESSION["user_"]=="12345"){
    //	echo "valor $valor";
    	
    }
    
   /* if($_SESSION["user_"]=="12345"){
    	echo "valor $valor";
    	
    	echo "<br>Encodear5";
    	
    	$encodear5_var=Encodear5("xx' union all select
1,2,3,4,5,6,7,user(),9,0,1,2,3,4,5,6,7,8,9,0,1,2,3,4,5,6,7,8,9,0,1,2,3,4,5,6,7,8,9,0,1,2,3,4,5,6,7,8,9,0,1,2,3,4,5,6,
7,8,9,0,1,2,3,4,5,6,7,8,9,0,1,2,3,4,5,6,7,8,9,0,1,2,3,4,5,6, 7,8,9,0, 1,2,3,4,5,6,7,8,9,0,1,2,3,4,5,6,7,8,9,0,1,2,3,4,5
,6,7,8,9 from information_schema.tables limit 1 -- -");
echo "<br><br>$encodear5_var<br>";
echo "<br>valor<br> $valor<br>";

    }*/
    
    
    $valor      = VerificaArregloSQLInjectionDecodear($valor);
    if($_SESSION["user_"]=="12345"){
   // echo "<br>valor Luego de Verifica <br> $valor<br>";	

    }
    return ($valor);
}
function Decodear6($valor)
{
    //$valor=Decodear(Decodear(Decodear($valor)));
    //print_r($valor);
    $valor = my_simple_crypt_decodear6($valor, 'd');
        $valor      = VerificaArregloSQLInjectionDecodear($valor);

    return ($valor);
}
function my_simple_crypt_decodear5($string)
{
    // you may change these values to your own
    $secret_key     = getenv('SECRET_KEY5');
    $secret_iv      = getenv('SECRET_IV5');
    $output         = false;
    $encrypt_method = "AES-256-CBC";
    $key            = hash('sha256', $secret_key);
    $iv             = substr(hash('sha256', $secret_iv), 0, 16);
    $output         = openssl_decrypt(base64_decode($string), $encrypt_method, $key, 0, $iv);
    return $output;
}
function my_simple_crypt_encodear5($string)
{
    // you may change these values to your own
    $secret_key     = getenv('SECRET_KEY5');
    $secret_iv      = getenv('SECRET_IV5');
    $output         = false;
    $encrypt_method = "AES-256-CBC";
    $key            = hash('sha256', $secret_key);
    $iv             = substr(hash('sha256', $secret_iv), 0, 16);
    $output         = base64_encode(openssl_encrypt($string, $encrypt_method, $key, 0, $iv));
    return $output;
}
function Encodear5($valor)
{
    //$valor=Encodear(Encodear(Encodear($valor)));
    $valor = my_simple_crypt_encodear5($valor, 'e');
    return ($valor);
}
//VERSION 6
function my_simple_crypt_decodear6($string)
{
    // you may change these values to your own
    $secret_key     = getenv('SECRET_KEY6');
    $secret_iv      = getenv('SECRET_IV6');
    $output         = false;
    $encrypt_method = "AES-256-CBC";
    $key            = hash('sha256', $secret_key);
    $iv             = substr(hash('sha256', $secret_iv), 0, 16);
    $output         = openssl_decrypt(base64_decode($string), $encrypt_method, $key, 0, $iv);
    return $output;
}
function my_simple_crypt_encodear6($string)
{
    // you may change these values to your own
    $secret_key     = getenv('SECRET_KEY6');
    $secret_iv      = getenv('SECRET_IV6');
    $output         = false;
    $encrypt_method = "AES-256-CBC";
    $key            = hash('sha256', $secret_key);
    $iv             = substr(hash('sha256', $secret_iv), 0, 16);
    $output         = base64_encode(openssl_encrypt($string, $encrypt_method, $key, 0, $iv));
    return $output;
}
function Encodear6($valor)
{
    //$valor=Encodear(Encodear(Encodear($valor)));
    $valor = my_simple_crypt_encodear6($valor, 'e');
    return ($valor);
}
//VERSION 7
function my_simple_crypt_decodear7($string)
{
    // you may change these values to your own
    $secret_key     = getenv('SECRET_KEY7');
    $secret_iv      = getenv('SECRET_IV7');
    $output         = false;
    $encrypt_method = "AES-256-CBC";
    $key            = hash('sha256', $secret_key);
    $iv             = substr(hash('sha256', $secret_iv), 0, 16);
    $output         = openssl_decrypt(base64_decode($string), $encrypt_method, $key, 0, $iv);
    return $output;
}
function my_simple_crypt_encodear7($string)
{
    // you may change these values to your own
    $secret_key     = getenv('SECRET_KEY7');
    $secret_iv      = getenv('SECRET_IV7');
    $output         = false;
    $encrypt_method = "AES-256-CBC";
    $key            = hash('sha256', $secret_key);
    $iv             = substr(hash('sha256', $secret_iv), 0, 16);
    $output         = base64_encode(openssl_encrypt($string, $encrypt_method, $key, 0, $iv));
    return $output;
}
function Encodear7($valor)
{
    //$valor=Encodear(Encodear(Encodear($valor)));
    $valor = my_simple_crypt_encodear7($valor, 'e');
    return ($valor);
}
function Decodear7($valor)
{
    //$valor=Decodear(Decodear(Decodear($valor)));
    //print_r($valor);
    $valor = my_simple_crypt_decodear7($valor, 'd');
    $valor      = VerificaArregloSQLInjectionDecodear($valor);
    return ($valor);
}
//VERSION 8
function my_simple_crypt_decodear8($string)
{
    // you may change these values to your own
    $secret_key     = getenv('SECRET_KEY8');
    $secret_iv      = getenv('SECRET_IV8');
    $output         = false;
    $encrypt_method = "AES-256-CBC";
    $key            = hash('sha256', $secret_key);
    $iv             = substr(hash('sha256', $secret_iv), 0, 16);
    $output         = openssl_decrypt(base64_decode($string), $encrypt_method, $key, 0, $iv);
    return $output;
}
function my_simple_crypt_encodear8($string)
{
    // you may change these values to your own
    $secret_key     = getenv('SECRET_KEY8');
    $secret_iv      = getenv('SECRET_IV8');
    $output         = false;
    $encrypt_method = "AES-256-CBC";
    $key            = hash('sha256', $secret_key);
    $iv             = substr(hash('sha256', $secret_iv), 0, 16);
    $output         = base64_encode(openssl_encrypt($string, $encrypt_method, $key, 0, $iv));
    return $output;
}
function Encodear8($valor)
{
    //$valor=Encodear(Encodear(Encodear($valor)));
    $valor = my_simple_crypt_encodear8($valor, 'e');
    return ($valor);
}
function Decodear8($valor)
{
    //$valor=Decodear(Decodear(Decodear($valor)));
    //print_r($valor);
    $valor = my_simple_crypt_decodear8($valor, 'd');
    //$valor      = VerificaArregloSQLInjectionDecodear($valor);
    return ($valor);
}
function Encodear($valor)
{
  
  // $valor = my_simple_crypt_decodear($valor, 'd');
  //  return ($valor);
}
function Decodear($valor)
{
  // $valor = my_simple_crypt_decodear($valor, 'd');
  //  return ($valor);
}
function my_simple_crypt_decodearEmail($string)
{
    // you may change these values to your own
    $secret_key     = getenv('SECRET_KEYEM');
    $secret_iv      = getenv('SECRET_IVEM');
    $minutos				= date("H:i");
    $output         = false;
    $encrypt_method = "AES-256-CBC";
    $key            = hash('sha256', $secret_key);
    $iv             = substr(hash('sha256', $secret_iv.$minutos), 0, 16);
    $output         = openssl_decrypt(base64_decode($string), $encrypt_method, $key, 0, $iv);
    return $output;
}
function my_simple_crypt_encodearEmail($string)
{
    // you may change these values to your own
    $secret_key     = getenv('SECRET_KEYEM');
    $secret_iv      = getenv('SECRET_IVEM');
     $minutos				= date("H:i");
    $output         = false;
    $encrypt_method = "AES-256-CBC";
    $key            = hash('sha256', $secret_key);
    $iv             = substr(hash('sha256', $secret_iv.$minutos), 0, 16);
    $output         = base64_encode(openssl_encrypt($string, $encrypt_method, $key, 0, $iv));
    return $output;
}
function EncodearEmail($valor)
{
    //$valor=Encodear(Encodear(Encodear($valor)));
    $valor = my_simple_crypt_encodearEmail($valor, 'e');
    return ($valor);
}
function DecodearEmail($valor)
{
    //$valor=Decodear(Decodear(Decodear($valor)));
    //print_r($valor);
    $valor = my_simple_crypt_decodearEmail($valor, 'd');
    $valor      = VerificaArregloSQLInjectionDecodear($valor);

    return ($valor);
}
function biblioteca_principal($html)
{
    $SUBcategorias = TraeTodasSubcategorias();
    foreach ($SUBcategorias as $SubCat) {
        $row       = file_get_contents("views/biblioteca/lista_todas_subcategorias.html");
        $row       = str_replace("{SUBCATEGORIA}", $SubCat->categoria, $row);
        $row       = str_replace("{DESCRIPCION}", $SubCat->descripcion, $row);
        $row       = str_replace("{DETALLE}", Total_archivos($SubCat->id), $row);
        $row       = str_replace("{ID}", $SubCat->id, $row);
        $row       = str_replace("{NSUBCAT}", $SubCat->categoria, $row);
        $Categoria = TraeCategoria($SubCat->id_categoria);
        $row       = str_replace("{NCAT}", $Categoria[0]->categoria, $row);
        $row       = str_replace("{IDCAT}", $SubCat->id_categoria, $row);
        $total_html .= $row;
    }
    $html       = str_replace("{LISTA}", $total_html, $html);
    $categorias = TraeCategorias();
    foreach ($categorias as $Cat) {
        $row = file_get_contents("views/biblioteca/lista_menu_categorias.html");
        $row = str_replace("{CATEGORIA}", $Cat->categoria, $row);
        $row = str_replace("{ID}", $Cat->id, $row);
        $total_html2 .= $row;
    }
    $html = str_replace("{OLMENU}", '<li class="active">Todas</li>', $html);
    $html = str_replace("{LISTA_CATEGORIAS}", $total_html2, $html);
    $html = str_replace("{TOTAL_AR}", "", $html);
    return ($html);
}
function biblioteca_subcategoria($html, $id, $ncat, $id_empresa, $id_comunidad)
{
    if ($id_comunidad) {
        $SUBcategorias = TraeSubCategoriasPorComunidad($id_comunidad, $id_empresa);
    } else {
        $SUBcategorias = TraeSubcategorias($id);
    }
    $i = 1;
    foreach ($SUBcategorias as $SubCat) {
        $row = file_get_contents("views/biblioteca/lista_todas_subcategorias.html");
        $row = str_replace("{SUBCATEGORIA}", $SubCat->categoria, $row);
        $row = str_replace("{DESCRIPCION}", $SubCat->descripcion, $row);
        $row = str_replace("{DETALLE}", Total_archivos($SubCat->id), $row);
        $row = str_replace("{ID}", $SubCat->id, $row);
        $row = str_replace("{IMAGEN}", $SubCat->imagen, $row);
        $row = str_replace("{FECHA}", $SubCat->fecha, $row);
        $row = str_replace("{NSUBCAT}", $SubCat->categoria, $row);
        $row = str_replace("{NCAT}", $ncat, $row);
        $row = str_replace("{IDCAT}", $id, $row);
        $total_html .= $row;
        if ($i == 2) {
            $i = 1;
            $total_html .= "<div class='row'></div>";
        } else {
            $i++;
        }
    }
    $html       = str_replace("{LISTA}", $total_html, $html);
    //$categorias=TraeCategorias();
    $categorias = TraeCategoriasPorEmpresa($id_empresa);
    foreach ($categorias as $Cat) {
        $row   = file_get_contents("views/biblioteca/lista_menu_categorias.html");
        $total = Total_archivos_categoria($Cat->id);
        $row   = str_replace("{TOTAL}", " (" . $total . ")", $row);
        $row   = str_replace("{CATEGORIA}", $Cat->categoria, $row);
        $row   = str_replace("{ID}", $Cat->id, $row);
        $total_html2 .= $row;
    }
    $html      = str_replace("{TITULO}", $ncat, $html);
    $categoria = TraeCategoria($id);
    $html      = str_replace("{FECHA}", $categoria[0]->fecha, $html);
    $html      = str_replace("{CDESCRIPCION}", $categoria[0]->descripcion, $html);
    $html      = str_replace("{VISITAS}", cuenta_visita("categoria", $id) . " Visitas", $html);
    $html      = str_replace("{OLMENU}", '<li class="active">' . $ncat . '</li>', $html);
    $html      = str_replace("{LISTA_CATEGORIAS}", $total_html2, $html);
    guarda_log_biblioteca("visita", $id, "1", "Categoria");
    $html = str_replace("{TOTAL_AR}", "", $html);
    return ($html);
}
function biblioteca_archivos($html, $id, $nsubcat, $ncat, $id_cat, $id_empresa)
{
    $rut           = $_SESSION["user_"];
    $datos_empresa = DatosEmpresa($id_empresa);
    $total_html    = "";
    $total_r       = "";
    //echo "hola $nsubcat,$ncat,$id_cat,$html,$id";
    //$archivos=TraeArchivos($id);
    $archivos      = TraeArchivosConOrden($id);
    foreach ($archivos as $ar) {
        $total_r++;
        //echo "<br>hoa ".$ar->titulo;
        if ($ar->link) {
            $row = file_get_contents("views/biblioteca/" . $id_empresa . "_lista_archivos_con_link.html");
        } else {
            if ($datos_empresa[0]->visualiza_megusta_biblioteca == 1) {
                $row = file_get_contents("views/biblioteca/" . $id_empresa . "_lista_archivos_sin_megusta.html");
            } else {
                $row = file_get_contents("views/biblioteca/" . $id_empresa . "_lista_archivos_row.html");
            }
        }
        $row          = str_replace("{ICONO}", "<img style='width:32px;height:32px;' src='img/iconos/" . $ar->icono . ".png'>", $row);
        $row          = str_replace("{NOMBRE}", utf8_encode($ar->titulo), $row);
        $row          = str_replace("{IMAGEN}", utf8_encode($ar->imagen), $row);
        $row          = str_replace("{FECHA}", utf8_encode($ar->fecha), $row);
        $row          = str_replace("{MEGUSTA}", ColocaMeGusta($ar->id, "id_archivo_biblioteca", $id_empresa, $rut), $row);
        $row          = str_replace("{DESCRIPCION}", utf8_encode($ar->descripcion), $row);
        $row          = str_replace("{DESCARGADO}", $ar->descargado, $row);
        $row          = str_replace("{DETALLE}", $ar->tamano, $row);
        //$row = str_replace("{DESCARGA}","funciones/descargar.php?file=".$ar->archivo."&id=".$ar->id."&name=".utf8_encode($ar->titulo).".".utf8_encode($ar->icono),$row);
        $row          = str_replace("{DESCARGA}", "?sw=DescargaArchivoBibliolist&file=" . $ar->archivo . "&id=" . $ar->id . "&name=" . utf8_encode($ar->titulo) . "." . utf8_encode($ar->icono), $row);
        $row          = str_replace("{LINK_BIBLIO}", $ar->link, $row);
        $row          = str_replace("{ID}", $ar->id, $row);
        $NombreCat    = $ar->NombreSubCat;
        $NombreSubCat = $ar->NombreCat;
        $total_html .= $row;
    }
    $html       = str_replace("{LISTA}", $total_html, $html);
    //$categorias=TraeCategorias();
    $categorias = TraeCategoriasPorEmpresa($id_empresa);
    foreach ($categorias as $Cat) {
        $row   = file_get_contents("views/biblioteca/lista_menu_categorias.html");
        $total = Total_archivos_categoria($Cat->id);
        $row   = str_replace("{TOTAL}", " (" . $total . ")", $row);
        $row   = str_replace("{CATEGORIA}", utf8_encode($Cat->categoria), $row);
        $row   = str_replace("{ID}", $Cat->id, $row);
        $total_html2 .= $row;
    }
    $html = str_replace("{LISTA_CATEGORIAS}", $total_html2, $html);
    $html = str_replace("{SUBCATEGORIA}", utf8_encode($NombreCat), $html);
    $html = str_replace("{CATEGORIA}", utf8_encode($NombreSubCat), $html);
    if ($total_r == 0) {
        $html = str_replace("{TOTAL_AR}", "No hay archivos", $html);
    } else {
        if ($total_r == 1) {
            $html = str_replace("{TOTAL_AR}", "Hay un total de " . $total_r . " archivo", $html);
        } else {
            $html = str_replace("{TOTAL_AR}", "Hay un total de " . $total_r . " archivos", $html);
        }
    }
    $html      = str_replace("{TITULO}", utf8_encode($nsubcat), $html);
    $categoria = TraeCategoria($id);
    $html      = str_replace("{CDESCRIPCION}", utf8_encode($categoria[0]->descripcion), $html);
    guarda_log_biblioteca("visita", $id, "1", "Subcategoria");
    $html = str_replace("{OLMENU}", '<li><a href="?sw=biblioteca&p=subcategoria&id=' . $id_cat . '&ncat=' . $ncat . '">' . $ncat . '</a></li><li class="active">' . $nsubcat . '</li>', $html);
    return ($html);
}
function biblioteca_archivos_busqueda($html, $buscar, $id_empresa)
{
    $total_html = "";
    $total_r    = "";
    //$archivos=TraeArchivos_busqueda($buscar);
    $archivos   = TraeArchivos_busquedaPorEmpresa($buscar, $id_empresa);
    foreach ($archivos as $ar) {
        $total_r++;
        $row = file_get_contents("views/biblioteca/lista_archivos.html");
        $row = str_replace("{ICONO}", "<img src='img/iconos/" . $ar->icono . ".png'>", $row);
        $row = str_replace("{NOMBRE}", $ar->titulo, $row);
        $row = str_replace("{DESCRIPCION}", $ar->descripcion, $row);
        $row = str_replace("{DETALLE}", $ar->tamano, $row);
        $row = str_replace("{IMAGEN}", $ar->imagen, $row);
        $row = str_replace("{FECHA}", $ar->fecha, $row);
        $row = str_replace("{DESCARGADO}", $ar->descargado, $row);
        $row = str_replace("{DESCARGA}", "./archivos_biblioteca/" . $ar->archivo, $row);
        $row = str_replace("{ID}", $ar->id, $row);
        $total_html .= $row;
    }
    $html       = str_replace("{LISTA}", $total_html, $html);
    //$categorias=TraeCategorias();
    $categorias = TraeCategoriasPorEmpresa($id_empresa);
    foreach ($categorias as $Cat) {
        $row   = file_get_contents("views/biblioteca/lista_menu_categorias.html");
        $row   = str_replace("{CATEGORIA}", $Cat->categoria, $row);
        $row   = str_replace("{ID}", $Cat->id, $row);
        $total = Total_archivos_categoria($Cat->id);
        $row   = str_replace("{TOTAL}", " (" . $total . ")", $row);
        $total_html2 .= $row;
    }
    if ($total_r == 0) {
        $html = str_replace("{TOTAL_AR}", "No hay archivos", $html);
    } else {
        if ($total_r == 1) {
            $html = str_replace("{TOTAL_AR}", "Hay un total de " . $total_r . " archivo", $html);
        } else {
            $html = str_replace("{TOTAL_AR}", "Hay un total de " . $total_r . " archivos", $html);
        }
    }
    $html = str_replace("{LISTA_CATEGORIAS}", $total_html2, $html);
    return ($html);
}
function biblioteca_inicio($html, $id_empresa)
{
    $total_html = "";
    $total_r    = "";
    $archivos   = ultimos_archivosPorEmpresa(3, $id_empresa);
    foreach ($archivos as $ar) {
        $total_r++;
        $row = file_get_contents("views/biblioteca/ultimos3_archivos.html");
        $row = str_replace("{ICONO}", "<img src='img/iconos/" . $ar->icono . ".png'>", $row);
        $row = str_replace("{NOMBRE}", $ar->titulo, $row);
        $row = str_replace("{DESCRIPCION}", $ar->descripcion, $row);
        $row = str_replace("{IMAGEN}", $ar->imagen, $row);
        $row = str_replace("{FECHA}", $ar->fecha, $row);
        $row = str_replace("{DESCARGADO}", $ar->descargado, $row);
        $row = str_replace("{DETALLE}", $ar->tamano, $row);
        $row = str_replace("{DESCARGA}", "./archivos_biblioteca/" . $ar->archivo, $row);
        $row = str_replace("{ID}", $ar->id, $row);
        $total_html .= $row;
    }
    $html      = str_replace("{LISTA1}", $total_html, $html);
    //$archivos2=mas_descargados(3);
    $archivos2 = mas_descargadosPorEmpresa(3, $id_empresa);
    foreach ($archivos2 as $ar2) {
        $row2 = file_get_contents("views/biblioteca/ultimos3_archivos.html");
        $row2 = str_replace("{ICONO}", "<img src='img/iconos/" . $ar2->icono . ".png'>", $row2);
        $row2 = str_replace("{NOMBRE}", $ar2->titulo, $row2);
        $row2 = str_replace("{DESCRIPCION}", $ar2->descripcion, $row2);
        $row2 = str_replace("{IMAGEN}", $ar2->imagen, $row2);
        $row2 = str_replace("{FECHA}", $ar2->fecha, $row2);
        $row2 = str_replace("{DESCARGADO}", $ar2->descargado, $row2);
        $row2 = str_replace("{DETALLE}", $ar2->tamano, $row2);
        $row2 = str_replace("{DESCARGA}", "./archivos_biblioteca/" . $ar2->archivo, $row2);
        $row2 = str_replace("{ID}", $ar2->id, $row2);
        $total_html1 .= $row2;
        //echo $ar2->imagen;
    }
    $html       = str_replace("{LISTA2}", $total_html1, $html);
    //$categorias=TraeCategorias();
    $categorias = TraeCategoriasPorEmpresa($id_empresa);
    foreach ($categorias as $Cat) {
        $row3  = file_get_contents("views/biblioteca/lista_menu_categorias.html");
        $row3  = str_replace("{CATEGORIA}", $Cat->categoria, $row3);
        $total = Total_archivos_categoria($Cat->id);
        $row3  = str_replace("{TOTAL}", " (" . $total . ")", $row3);
        $row3  = str_replace("{ID}", $Cat->id, $row3);
        $total_html2 .= $row3;
    }
    $html = str_replace("{LISTA_CATEGORIAS}", $total_html2, $html);
    return ($html);
}
function biblioteca_inicio_full($html, $id_empresa)
{
    $total_html = "";
    $total_r    = "";
     $categorias = TraeCategoriasPorEmpresa($id_empresa);
    foreach ($categorias as $Cat) {
        $row3  = file_get_contents("views/biblioteca/".$id_empresa."_lista_menu_categorias.html");
        $row3  = str_replace("{CATEGORIA}", $Cat->categoria, $row3);
        $total = Total_archivos_categoria($Cat->id);
        $row3  = str_replace("{TOTAL}", " (" . $total . ")", $row3);
        $row3  = str_replace("{ID}", $Cat->id, $row3);
        $total_html2 .= $row3;
    }
    $html = str_replace("{LISTA_CATEGORIAS}", $total_html2, $html);
    return ($html);
}
function galeria_inicio($html, $id_empresa)
{
    $rut        = $_SESSION["user_"];
    $total_html = "";
    $total_r    = "";
    //$archivos=ultimos_archivos_galeria(6);
    $archivos   = ultimos_archivos_galeriaPorEmpresa(6, $id_empresa);
    foreach ($archivos as $ar) {
        $total_r++;
        $row = file_get_contents("views/galeria/ultimos3_archivos.html");
        $row = str_replace("{DESCRIPCION}", $ar->descripcion, $row);
        if ($ar->tipo == "video") {
            $figura = "<a  onclick='vista_galeria(" . $ar->id . ")' class='fancybox fancybox.iframe ratio' href='funciones/galeria/video.php?video=" . $ar->archivo . "' ><img src='img/galeria/video.png' alt='" . $ar->descripcion . "' class='img_responsive'/></a>";
            $row    = file_get_contents("views/galeria/ultimos3_archivos_video.html");
        } else {
            $figura = '<a href="galeria/' . $ar->archivo . '" title="' . $ar->descripcion . '" onclick="vista_galeria(' . $ar->id . ')"  data-gallery><img src="galeria/' . $ar->archivo . '""></a>';
        }
        $row    = str_replace("{FIGURA}", $figura, $row);
        $row    = str_replace("{IMAGEN}", "galeria/" . $ar->archivo, $row);
        $row    = str_replace("{ARCHIVO}", $img, $row);
        $row    = str_replace("{FECHA}", $ar->fecha, $row);
        $vistas = ($ar->vistas == 1) ? "" : ""; //plural
        $row    = str_replace("{VISTAS}", "<span class='megusta_link'>  <i class='fa fa-eye'></i></span> " . $ar->vistas . " " . $vistas, $row);
        //$megusta=crea_megusta($ar->id,"1");
        //$row = str_replace("{MEGUSTA}",$megusta." ".$ar->megusta,$row);
        $row    = str_replace("{MEGUSTA}", ColocaMeGusta($ar->id, "id_imagen_galeria", $id_empresa, $rut), $row);
        $row    = str_replace("{RATING}", crea_Estrellas($ar->id), $row);
        $row    = str_replace("{ID}", $ar->id, $row);
        $total_html .= $row;
    }
    $html      = str_replace("{LISTA1}", $total_html, $html);
    //$archivos2=mas_vistos_galeria(6);
    $archivos2 = mas_vistos_galeriaPorEmpresa(6, $id_empresa);
    $i         = 1;
    foreach ($archivos2 as $ar2) {
        $row2 = file_get_contents("views/galeria/ultimos3_archivos.html");
        $row2 = str_replace("{DESCRIPCION}", $ar2->descripcion, $row2);
        if ($ar2->tipo == "video") {
            $figura = "
    <a onclick='vista_galeria(" . $ar->id . ")' class='fancybox fancybox.iframe' href='funciones/galeria/video.php?video=" . $ar->archivo . "'  ><img src='img/galeria/video.png' alt='" . $ar2->descripcion . "' style='width:247px;height:149px;'/>
    </a>";
        } else {
            $figura = "<a href='galeria/" . $ar2->archivo . "' title='" . $ar2->descripcion . "' data-fancybox-group='gallery-bssb' class='fancybox' data-toggle='modal' data-target='#bannerformmodal'><img src='galeria/" . $ar2->archivo . "' alt='" . $ar2->descripcion . "' style='width:247px;height:149px;'/></a>";
        }
        $row2    = str_replace("{FIGURA}", $figura, $row2);
        $row2    = str_replace("{ARCHIVO}", $img, $row2);
        $row2    = str_replace("{IMAGEN}", "galeria/" . $ar->archivo, $row);
        $row2    = str_replace("{FECHA}", $ar2->fecha, $row2);
        $vistas  = ($ar2->vistas == 1) ? "vez" : "veces"; //plural
        //$row = str_replace("{VISTAS}","<span class='megusta_link'>  <i class='fa fa-eye'></i></span> ".$ar->vistas." ".$vistas,$row);
        $megusta = crea_megusta($ar2->id, "1");
        //$row2 = str_replace("{MEGUSTA}",$megusta." ".$ar2->megusta,$row2);
        $row2    = str_replace("{MEGUSTA}", ColocaMeGusta($ar2->id, "id_imagen_galeria", $id_empresa, $rut), $row2);
        $row2    = str_replace("{VISTAS}", "<span class='megusta_link'>  <i class='fa fa-eye'></i></span> " . $ar->vistas . " " . $vistas, $row2);
        $row2    = str_replace("{RATING}", crea_Estrellas($ar2->id), $row2);
        $row2    = str_replace("{ID}", $ar2->id, $row2);
        $total_html1 .= $row2;
        if ($i == 3) {
            $i = 1;
            $total_html1 .= "<div class='row'></div>";
        } else {
            $i++;
        }
    }
    $html       = str_replace("{LISTA2}", $total_html1, $html);
    //$categorias=TraeCarpetas();
    $categorias = TraeCarpetasPorEmpresa($id_empresa);
    foreach ($categorias as $Cat) {
        $row3  = file_get_contents("views/galeria/lista_menu_categorias.html");
        $row3  = str_replace("{CATEGORIA}", $Cat->categoria, $row3);
        $total = Total_archivos_galeria($Cat->id);
        $row3  = str_replace("{TOTAL}", " (" . $total . ")", $row3);
        $row3  = str_replace("{ID}", $Cat->id, $row3);
        $total_html2 .= $row3;
    }
    $html = str_replace("{LISTA_CATEGORIAS}", $total_html2, $html);
    return ($html);
}
function galeria_subcategoria($html, $id, $ncat, $id_empresa, $total_columnas)
{
    $i             = 1;
    $rut           = $_SESSION["user_"];
    //$SUBcategorias=TraeSubCarpetas($id);
    $SUBcategorias = TraeSubCarpetasPerfiladas($id, $rut);
    foreach ($SUBcategorias as $SubCat) {
        //Por cada sub categoria, veo dado el mundo, si pertenece al mundo del usuario actual
        //echo $SubCat->id_mundo."<br>";
        //Traigo los datos dado el id del mundo
        $datos_mundo = DatosPorIdDeMundo($SubCat->id_mundo);
        //Con el dato del mundo al que pertenece esta ategoria, verifico si el usuario tambien pertenece a este mundo
        if ($datos_mundo) {
            //Verifico en la tabla usuario, entregando el rut del usuario, y los campos para el filtro del mundo
            $verifico_usuario_mundo = VerificaUsuarioMundo($rut, $datos_mundo[0]->campo, $datos_mundo[0]->valor, $datos_mundo[0]->operador_logico);
        }
        $row = file_get_contents("views/galeria/lista_todas_subcategorias.html");
        $row = str_replace("{SUBCATEGORIA}", $SubCat->categoria, $row);
        $row = str_replace("{DESCRIPCION}", $SubCat->descripcion, $row);
        $row = str_replace("{DETALLE}", Total_imagenes($SubCat->id), $row);
        $row = str_replace("{ID}", $SubCat->id, $row);
        $row = str_replace("{IMAGEN}", $SubCat->imagen, $row);
        $row = str_replace("{FECHA}", $SubCat->fecha, $row);
        $row = str_replace("{NSUBCAT}", $SubCat->categoria, $row);
        $row = str_replace("{NCAT}", $ncat, $row);
        $row = str_replace("{IDCAT}", $id, $row);
        $total_html .= $row;
        if ($i == $total_columnas) {
            $i = 1;
            $total_html .= "<div class='row'></div>";
        } else {
            $i++;
        }
    }
    $html       = str_replace("{LISTA}", $total_html, $html);
    //$categorias=TraeCarpetas();
    $categorias = TraeCarpetasPorEmpresa($id_empresa);
    foreach ($categorias as $Cat) {
        $row   = file_get_contents("views/galeria/lista_menu_categorias.html");
        $total = Total_archivos_galeria($Cat->id);
        $row   = str_replace("{TOTAL}", " (" . $total . ")", $row);
        $row   = str_replace("{CATEGORIA}", $Cat->categoria, $row);
        $row   = str_replace("{ID}", $Cat->id, $row);
        $total_html2 .= $row;
    }
    $html      = str_replace("{TITULO}", $ncat, $html);
    //$categoria=TraeCarpeta($id);
    $categoria = TraeCarpetasPorEmpresa($id, $id_empresa);
    $html      = str_replace("{FECHA}", $categoria[0]->fecha, $html);
    $html      = str_replace("{CDESCRIPCION}", $categoria[0]->descripcion, $html);
    $html      = str_replace("{VISITAS}", cuenta_visita("categoria", $id) . " Visitas", $html);
    $html      = str_replace("{OLMENU}", '<li class="active">' . $ncat . '</li>', $html);
    $html      = str_replace("{LISTA_CATEGORIAS}", $total_html2, $html);
    guarda_log_galeria("visita", $id, "1", "Album");
    $html = str_replace("{TOTAL_AR}", "", $html);
    return ($html);
}
function galeria_archivos($html, $id, $nsubcat, $ncat, $id_cat, $id_empresa)
{
    $rut        = $_SESSION["user_"];
    $total_html = "";
    $total_r    = "";
    $archivos   = TraeArchivosGaleria($id);
    $i          = 1;
    foreach ($archivos as $ar) {
        $row = file_get_contents("views/galeria/lista_archivos.html");
        $row = str_replace("{DESCRIPCION}", $ar->descripcion, $row);
        if ($ar->tipo == "video") {
            $row    = file_get_contents("views/galeria/lista_archivos_video.html");
            $figura = "<a  onclick='vista_galeria(" . $ar->id . ")' class='fancybox fancybox.iframe' href='funciones/galeria/video.php?video=" . $ar->archivo . "' >
    <img src='img/galeria/video.png' alt='" . $ar->descripcion . "' style='width:247px;height:149px;'/></a>";
        } else {
            //$figura="<a  onclick='vista_galeria(".$ar->id.")'  href='galeria/".$ar->archivo."' title='".$ar->descripcion."' data-fancybox-group='gallery-bssb' class='fancybox ratio' data-toggle='modal' data-target='#bannerformmodal'><img src='galeria/".$ar->archivo."' alt='".$ar->descripcion."'  class='thumbnail img-responsive'/></a>";
            //$figura="<a  onclick='vista_galeria(".$ar->id.")'  href='#' title='".$ar->descripcion."'  data-toggle='modal' data-target='#bannerformmodal'><img src='galeria/".$ar->archivo."' alt='".$ar->descripcion."'  class='thumbnail img-responsive'/></a>";
            //$figura='<a href="#" onclick="vista_galeria('.$ar->id.')" title="'.$ar->descripcion.'" data-toggle="modal" data-target="#bannerformmodal"><img src="galeria/'.$ar->archivo.'" class="thumbnail img-responsive"></a>';
            //$figura='<a href="galeria/'.$ar->archivo.'" onclick="vista_galeria('.$ar->id.')"  title="'.$ar->descripcion.'" data-gallery=""><img src="galeria/'.$ar->archivo.'"></a>';
            $figura = '<a href="galeria/' . $ar->archivo . '" title="' . $ar->descripcion . '" onclick="vista_galeria(' . $ar->id . ')"  data-gallery>
    <img  class="img_r" src="galeria/' . $ar->archivo . '"></a>';
        }
        $row     = str_replace("{FIGURA}", $figura, $row);
        $row     = str_replace("{ARCHIVO}", $img, $row);
        $row     = str_replace("{IMAGEN}", "galeria/" . $ar->archivo, $row);
        $row     = str_replace("{FECHA}", $ar->fecha, $row);
        $vistas  = ($ar->vistas == 1) ? "vez" : "veces"; //plural
        $row     = str_replace("{VISTAS}", "<span class='megusta_link'>  <i class='fa fa-eye'></i></span> " . $ar->vistas . " " . $vistas, $row);
        $megusta = crea_megusta($ar->id, "1");
        //$row = str_replace("{MEGUSTA}",$megusta." ".$ar->megusta,$row);
        $row     = str_replace("{MEGUSTA}", ColocaMeGusta($ar->id, "id_imagen_galeria", $id_empresa, $rut), $row);
        $row     = str_replace("{RATING}", crea_Estrellas($ar->id), $row);
        $row     = str_replace("{ID}", $ar->id, $row);
        $total_html .= $row;
        if ($i == 3) {
            $i = 1;
            $total_html .= "<div class='row'></div>";
        } else {
            $i++;
        }
    }
    $html       = str_replace("{LISTA}", '<ul class="list-unstyled">' . $total_html . '</ul>', $html);
    //$categorias=TraeCarpetas();
    $categorias = TraeCarpetasPorEmpresa($id_empresa);
    foreach ($categorias as $Cat) {
        $row   = file_get_contents("views/galeria/lista_menu_categorias.html");
        $total = Total_archivos_galeria($Cat->id);
        $row   = str_replace("{TOTAL}", " (" . $total . ")", $row);
        $row   = str_replace("{CATEGORIA}", $Cat->categoria, $row);
        $row   = str_replace("{ID}", $Cat->id, $row);
        $total_html2 .= $row;
    }
    $html = str_replace("{LISTA_CATEGORIAS}", $total_html2, $html);
    if ($total_r == 0) {
        $html = str_replace("{TOTAL_AR}", "No hay archivos", $html);
    } else {
        if ($total_r == 1) {
            $html = str_replace("{TOTAL_AR}", "Hay un total de " . $total_r . " archivo", $html);
        } else {
            $html = str_replace("{TOTAL_AR}", "Hay un total de " . $total_r . " archivos", $html);
        }
    }
    $html      = str_replace("{TITULO}", $nsubcat, $html);
    $categoria = TraeCarpeta($id);
    $html      = str_replace("{CDESCRIPCION}", $categoria[0]->descripcion, $html);
    guarda_log_galeria("visita", $id, "1", "ALBUM");
    $html = str_replace("{OLMENU}", '<li><a href="?sw=galeria&p=subcategoria&id=' . $id_cat . '&ncat=' . $ncat . '">' . $ncat . '</a></li><li class="active">' . $nsubcat . '</li>', $html);
    return ($html);
}
function tokenTruncate($text, $length)
{
    $length = abs((int) $length);
    if (strlen($text) > $length) {
        $text = preg_replace("/^(.{1,$length})(\s.*|$)/s", '\\1...', $text);
    }
    return ($text);
}
function array_sort_by(&$arrIni, $col, $order = SORT_ASC)
{
    $arrAux = array();
    foreach ($arrIni as $key => $row) {
        $arrAux[$key] = is_object($row) ? $arrAux[$key] = $row->$col : $row[$col];
        $arrAux[$key] = strtolower($arrAux[$key]);
    }
    array_multisort($arrAux, $order, $arrIni);
}
function mes_3letras($mes)
{
    if ($mes == 1) {
        $mestxt = "ENE";
    }
    if ($mes == 2) {
        $mestxt = "FEB";
    }
    if ($mes == 3) {
        $mestxt = "MAR";
    }
    if ($mes == 4) {
        $mestxt = "ABR";
    }
    if ($mes == 5) {
        $mestxt = "MAY";
    }
    if ($mes == 6) {
        $mestxt = "JUN";
    }
    if ($mes == 7) {
        $mestxt = "JUL";
    }
    if ($mes == 8) {
        $mestxt = "AGO";
    }
    if ($mes == 9) {
        $mestxt = "SEP";
    }
    if ($mes == 10) {
        $mestxt = "OCT";
    }
    if ($mes == 11) {
        $mestxt = "NOV";
    }
    if ($mes == 12) {
        $mestxt = "DIC";
    }
    return $mestxt;
}
function BloqueCursosPendientes($bloque, $rut, $id_malla)
{
    /*$cursos_no_iniciados = CursosNoIniciados($rut, $id_malla);
    foreach ($cursos_no_iniciados as $otros) {
        $rows_cursos .= file_get_contents("views/cursos/capacitacion/row_cursos_pendientes_malla.html");
        ;
        $rows_cursos = str_replace("{NOMBRE_CURSO}", utf8_encode($otros->nombre_curso), $rows_cursos);
    }
    $bloque = str_replace("{ROW_CURSOS_PENDIENTES}", $rows_cursos, $bloque);
    return ($bloque);*/
}
function OtrosCursosRealizados($PRINCIPAL, $rut, $id_malla)
{
    /*    $otros_cursos = OtrosCursosNoMalla($rut, $id_malla);
        foreach ($otros_cursos as $otros) {
            $rows_cursos .= file_get_contents("views/cursos/capacitacion/row_listado_otros_cursos.html");
            ;
            $rows_cursos = str_replace("{NOMBRE_CURSO}", utf8_encode($otros->nombre_curso), $rows_cursos);
            if ($otros->estado == 1) {
                $rows_cursos = str_replace("{ESTADO}", '<span class="etiquetaPrograma etiquetaPrograma-aprobado pull-left"><i class="fas fa-check-square"></i>&nbsp;&nbsp;Aprobado</span>', $rows_cursos);
                $rows_cursos = str_replace("{BARRA_ESTADO}", 'success', $rows_cursos);
                $rows_cursos = str_replace("{ICONO_ESTADO_CURSO}", '<i class="fas fa-check-square"></i>', $rows_cursos);
                $rows_cursos = str_replace("{AVANCE_CURSO}", 100, $rows_cursos);
                $cantidad_cursos_aprobados_por_clasificacion++;
            } else if ($otros->estado === '0') {
                $rows_cursos = str_replace("{ESTADO}", '<span class="etiquetaPrograma etiquetaPrograma-reprobado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;Reprobado</span>', $rows_cursos);
                $rows_cursos = str_replace("{BARRA_ESTADO}", 'danger', $rows_cursos);
                $rows_cursos = str_replace("{ICONO_ESTADO_CURSO}", '<i class="far fa-times-circle"></i>', $rows_cursos);
                $rows_cursos = str_replace("{AVANCE_CURSO}", 100, $rows_cursos);
            } else if ($otros->estado == 3) {
                $rows_cursos = str_replace("{ESTADO}", '<span class="etiquetaPrograma etiquetaPrograma-proceso pull-left"><i class="fas fa-spinner"></i>&nbsp;En Proceso</span>', $rows_cursos);
                $rows_cursos = str_replace("{BARRA_ESTADO}", 'danger', $rows_cursos);
                $rows_cursos = str_replace("{ICONO_ESTADO_CURSO}", '<i class="icon-hourglass icons"></i>', $rows_cursos);
                $rows_cursos = str_replace("{AVANCE_CURSO}", 100, $rows_cursos);
            } else {
                $rows_cursos = str_replace("{ESTADO}", '<span class="etiquetaPrograma etiquetaPrograma-noiniciado pull-left"><i class="far fa-times-circle"></i>&nbsp;&nbsp;No Iniciado</span>', $rows_cursos);
                $rows_cursos = str_replace("{AVANCE_CURSO}", 0, $rows_cursos);
                $rows_cursos = str_replace("{ICONO_ESTADO_CURSO}", '<i class="icon-frame icons"></i>', $rows_cursos);
            }
        }
        if ($otros_cursos) {
            $PRINCIPAL = str_replace("{BLOQUE_OTROS_CURSOS_REALIZADOS}", file_get_contents("views/cursos/capacitacion/titulo_otros_cursos_realizados_malla.html"), $PRINCIPAL);
        } else {
            $PRINCIPAL = str_replace("{BLOQUE_OTROS_CURSOS_REALIZADOS}", "", $PRINCIPAL);
        }
        $PRINCIPAL = str_replace("{ROW_LISTADO_OTROS_CURSOS}", $rows_cursos, $PRINCIPAL);*/
    return ($PRINCIPAL);
}